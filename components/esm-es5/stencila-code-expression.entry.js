var __awaiter=this&&this.__awaiter||function(e,s,i,o){function t(e){return e instanceof i?e:new i((function(s){s(e)}))}return new(i||(i=Promise))((function(i,n){function r(e){try{a(o.next(e))}catch(s){n(s)}}function c(e){try{a(o["throw"](e))}catch(s){n(s)}}function a(e){e.done?i(e.value):t(e.value).then(r,c)}a((o=o.apply(e,s||[])).next())}))};var __generator=this&&this.__generator||function(e,s){var i={label:0,sent:function(){if(n[0]&1)throw n[1];return n[1]},trys:[],ops:[]},o,t,n,r;return r={next:c(0),throw:c(1),return:c(2)},typeof Symbol==="function"&&(r[Symbol.iterator]=function(){return this}),r;function c(e){return function(s){return a([e,s])}}function a(r){if(o)throw new TypeError("Generator is already executing.");while(i)try{if(o=1,t&&(n=r[0]&2?t["return"]:r[0]?t["throw"]||((n=t["return"])&&n.call(t),0):t.next)&&!(n=n.call(t,r[1])).done)return n;if(t=0,n)r=[r[0]&2,n.value];switch(r[0]){case 0:case 1:n=r;break;case 4:i.label++;return{value:r[1],done:false};case 5:i.label++;t=r[1];r=[0];continue;case 7:r=i.ops.pop();i.trys.pop();continue;default:if(!(n=i.trys,n=n.length>0&&n[n.length-1])&&(r[0]===6||r[0]===2)){i=0;continue}if(r[0]===3&&(!n||r[1]>n[0]&&r[1]<n[3])){i.label=r[1];break}if(r[0]===6&&i.label<n[1]){i.label=n[1];n=r;break}if(n&&i.label<n[2]){i.label=n[2];i.ops.push(r);break}if(n[2])i.ops.pop();i.trys.pop();continue}r=s.call(e,i)}catch(c){r=[6,c];t=0}finally{o=n=0}if(r[0]&5)throw r[1];return{value:r[0]?r[1]:void 0,done:true}}};import{r as registerInstance,f as createEvent,h,e as Host,c as getElement}from"./index-2305c23c.js";import{c}from"./schema-3c9b003e.js";import{C as CodeExecuteStatus}from"./codeExecuteStatus-b83cc6dd.js";import{i as isPending}from"./codeUtils-6d110640.js";import{f as fileFormatMap,a as lookupFormat}from"./languageUtils-2c49a4c4.js";import{L as LanguagePickerInline}from"./languageSelect-0bd074f6.js";var defaultCodeExpressionCss=".sc-stencila-code-expression-default-h,stencila-code-expression.sc-stencila-code-expression-default{--background:var(--color-neutral-50,#edf2f7);--background-editor:var(--color-stock,#fff);--background-output:var(--color-stock,#fff);--border:var(--color-neutral-100,#e2e8f0);-ms-flex-align:center;align-items:center;background-color:var(--background);border-color:var(--border);border-radius:.25rem;border-style:solid;border-width:1px;display:-ms-inline-flexbox;display:inline-flex;font-size:.875rem;line-height:1.25rem;line-height:1;padding:0;position:relative;vertical-align:text-bottom}.sc-stencila-code-expression-default-h stencila-tooltip.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default stencila-tooltip.sc-stencila-code-expression-default{-ms-flex-align:stretch;align-items:stretch;display:-ms-inline-flexbox;display:inline-flex;line-height:1;overflow:hidden;padding:0;vertical-align:bottom}.sc-stencila-code-expression-default-h .actions.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .actions.sc-stencila-code-expression-default{border-bottom-left-radius:.25rem;border-top-left-radius:.25rem;display:-ms-inline-flexbox;display:inline-flex;-ms-flex:0 1 auto;flex:0 1 auto;position:relative;white-space:nowrap}.sc-stencila-code-expression-default-h .actions.sc-stencila-code-expression-default stencila-button.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .actions.sc-stencila-code-expression-default stencila-button.sc-stencila-code-expression-default{-ms-flex-align:stretch;align-items:stretch;-ms-flex-item-align:start;align-self:flex-start;cursor:default;display:-ms-inline-flexbox;display:inline-flex;-ms-flex-negative:0;flex-shrink:0;overflow:hidden;-webkit-transition-duration:.15s;transition-duration:.15s;-webkit-transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;-webkit-transition-property:padding,width,max-width;transition-property:padding,width,max-width;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1)}.sc-stencila-code-expression-default-h .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default{cursor:default;display:inline-block;overflow:hidden;-webkit-transition-duration:.15s;transition-duration:.15s;-webkit-transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1);width:0}.hover.sc-stencila-code-expression-default-h .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,.isCodeVisible.sc-stencila-code-expression-default-h .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,.sc-stencila-code-expression-default-h:focus .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,.sc-stencila-code-expression-default-h:focus-within .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,.sc-stencila-code-expression-default-h:hover .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,stencila-code-expression.hover.sc-stencila-code-expression-default .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-default .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default:focus .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default:focus-within .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default:hover .actions.sc-stencila-code-expression-default .secondaryAction.sc-stencila-code-expression-default{display:-ms-inline-flexbox;display:inline-flex;max-width:100%;width:1.25rem}.sc-stencila-code-expression-default-h .executeStatus.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .executeStatus.sc-stencila-code-expression-default{--height:0.875rem;--width:0.875rem;cursor:pointer;padding:.25rem}.sc-stencila-code-expression-default-h .executeStatus.scheduled.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .executeStatus.scheduled.sc-stencila-code-expression-default{cursor:wait}.sc-stencila-code-expression-default-h .text.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .text.sc-stencila-code-expression-default{background-color:var(--background-editor);border-color:var(--border);color:#4a4a4a;color:var(--color-key,#4a4a4a);display:inline-block;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;line-height:1;min-width:0;overflow:hidden;padding:0;-webkit-transition-duration:.15s;transition-duration:.15s;-webkit-transition-property:width;transition-property:width;-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1);white-space:nowrap;width:0}.isCodeVisible.sc-stencila-code-expression-default-h .text.sc-stencila-code-expression-default,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-default .text.sc-stencila-code-expression-default{border-radius:.25rem;border-width:1px;display:inline-block;margin-right:.25rem;min-width:1em;padding:.25rem .5rem;white-space:pre-line;width:auto}.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=errors],.sc-stencila-code-expression-default-h [slot=errors].sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=errors],stencila-code-expression .sc-stencila-code-expression-default-s>[slot=errors],stencila-code-expression.sc-stencila-code-expression-default [slot=errors].sc-stencila-code-expression-default{display:none}.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error,.sc-stencila-code-expression-default-h [slot=errors].sc-stencila-code-expression-default stencila-code-error.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error,stencila-code-expression .sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error,stencila-code-expression.sc-stencila-code-expression-default [slot=errors].sc-stencila-code-expression-default stencila-code-error.sc-stencila-code-expression-default{background:none;border-style:none;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;line-height:1.5;padding:0}.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error stencila-details,.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error stencila-icon,.sc-stencila-code-expression-default-h [slot=errors].sc-stencila-code-expression-default stencila-code-error.sc-stencila-code-expression-default stencila-details.sc-stencila-code-expression-default,.sc-stencila-code-expression-default-h [slot=errors].sc-stencila-code-expression-default stencila-code-error.sc-stencila-code-expression-default stencila-icon.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error stencila-details,stencila-code-expression .sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error stencila-details,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error stencila-icon,stencila-code-expression .sc-stencila-code-expression-default-s>[slot=errors] stencila-code-error stencila-icon,stencila-code-expression.sc-stencila-code-expression-default [slot=errors].sc-stencila-code-expression-default stencila-code-error.sc-stencila-code-expression-default stencila-details.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default [slot=errors].sc-stencila-code-expression-default stencila-code-error.sc-stencila-code-expression-default stencila-icon.sc-stencila-code-expression-default{display:none}.sc-stencila-code-expression-default-h.isCodeVisible .sc-stencila-code-expression-default-s>[slot=errors],.isCodeVisible.sc-stencila-code-expression-default-h [slot=errors].sc-stencila-code-expression-default,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-default-s>[slot=errors],stencila-code-expression.isCodeVisible .sc-stencila-code-expression-default-s>[slot=errors],stencila-code-expression.isCodeVisible.sc-stencila-code-expression-default [slot=errors].sc-stencila-code-expression-default{display:inline-block}.sc-stencila-code-expression-default-h .divider.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default .divider.sc-stencila-code-expression-default{fill:var(--background);-ms-flex-item-align:center;align-self:center;background-color:var(--background-output);display:inline-block;display:none;width:.5rem}.isCodeVisible.sc-stencila-code-expression-default-h .divider.sc-stencila-code-expression-default,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-default .divider.sc-stencila-code-expression-default{display:inline-block}.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=output],.sc-stencila-code-expression-default-h [slot=output].sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=output],stencila-code-expression .sc-stencila-code-expression-default-s>[slot=output],stencila-code-expression.sc-stencila-code-expression-default [slot=output].sc-stencila-code-expression-default{background-color:#fff;background-color:var(--color-stock,#fff);background-color:var(--background-output);border-style:none;color:#4a4a4a;color:var(--color-key,#4a4a4a);display:inline-block;font-size:1rem;line-height:1.5rem;line-height:1.5;margin:0;padding:0 .25rem 0 .5rem;-webkit-transition:padding .12s ease-out;transition:padding .12s ease-out;white-space:normal}.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=output]:empty,.sc-stencila-code-expression-default-h [slot=output].sc-stencila-code-expression-default:empty,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=output]:empty,stencila-code-expression .sc-stencila-code-expression-default-s>[slot=output]:empty,stencila-code-expression.sc-stencila-code-expression-default [slot=output].sc-stencila-code-expression-default:empty{display:none}.sc-stencila-code-expression-default-h .sc-stencila-code-expression-default-s>[slot=output] *,.sc-stencila-code-expression-default-h [slot=output].sc-stencila-code-expression-default *.sc-stencila-code-expression-default,stencila-code-expression.sc-stencila-code-expression-default-s>[slot=output] *,stencila-code-expression .sc-stencila-code-expression-default-s>[slot=output] *,stencila-code-expression.sc-stencila-code-expression-default [slot=output].sc-stencila-code-expression-default *.sc-stencila-code-expression-default{background-color:#fff;background-color:var(--color-stock,#fff);border-style:none;color:#4a4a4a;color:var(--color-key,#4a4a4a);display:inline;font-size:1rem;line-height:1.5rem;line-height:1.5;margin:0;padding:0;white-space:normal}";var materialCodeExpressionCss=".sc-stencila-code-expression-material-h,stencila-code-expression.sc-stencila-code-expression-material{--background:var(--color-neutral-50,#edf2f7);--background-editor:var(--color-stock,#fff);--background-output:var(--color-stock,#fff);--border:var(--color-neutral-100,#e2e8f0);-ms-flex-align:center;align-items:center;background-color:var(--background);border-color:var(--border);border-radius:.25rem;border-style:solid;border-width:1px;display:-ms-inline-flexbox;display:inline-flex;font-size:.875rem;line-height:1.25rem;line-height:1;padding:0;position:relative;vertical-align:text-bottom}.sc-stencila-code-expression-material-h stencila-tooltip.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material stencila-tooltip.sc-stencila-code-expression-material{-ms-flex-align:stretch;align-items:stretch;display:-ms-inline-flexbox;display:inline-flex;line-height:1;overflow:hidden;padding:0;vertical-align:bottom}.sc-stencila-code-expression-material-h .actions.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .actions.sc-stencila-code-expression-material{border-bottom-left-radius:.25rem;border-top-left-radius:.25rem;display:-ms-inline-flexbox;display:inline-flex;-ms-flex:0 1 auto;flex:0 1 auto;position:relative;white-space:nowrap}.sc-stencila-code-expression-material-h .actions.sc-stencila-code-expression-material stencila-button.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .actions.sc-stencila-code-expression-material stencila-button.sc-stencila-code-expression-material{-ms-flex-align:stretch;align-items:stretch;-ms-flex-item-align:start;align-self:flex-start;cursor:default;display:-ms-inline-flexbox;display:inline-flex;-ms-flex-negative:0;flex-shrink:0;overflow:hidden;-webkit-transition-duration:.15s;transition-duration:.15s;-webkit-transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;-webkit-transition-property:padding,width,max-width;transition-property:padding,width,max-width;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1)}.sc-stencila-code-expression-material-h .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material{cursor:default;display:inline-block;overflow:hidden;-webkit-transition-duration:.15s;transition-duration:.15s;-webkit-transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,fill,stroke,opacity,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-text-decoration-color,-webkit-box-shadow,-webkit-transform,-webkit-filter,-webkit-backdrop-filter;-webkit-transition-timing-function:cubic-bezier(.4,0,.2,1);transition-timing-function:cubic-bezier(.4,0,.2,1);-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1);width:0}.hover.sc-stencila-code-expression-material-h .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,.isCodeVisible.sc-stencila-code-expression-material-h .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,.sc-stencila-code-expression-material-h:focus .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,.sc-stencila-code-expression-material-h:focus-within .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,.sc-stencila-code-expression-material-h:hover .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,stencila-code-expression.hover.sc-stencila-code-expression-material .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-material .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material:focus .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material:focus-within .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material:hover .actions.sc-stencila-code-expression-material .secondaryAction.sc-stencila-code-expression-material{display:-ms-inline-flexbox;display:inline-flex;max-width:100%;width:1.25rem}.sc-stencila-code-expression-material-h .executeStatus.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .executeStatus.sc-stencila-code-expression-material{--height:0.875rem;--width:0.875rem;cursor:pointer;padding:.25rem}.sc-stencila-code-expression-material-h .executeStatus.scheduled.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .executeStatus.scheduled.sc-stencila-code-expression-material{cursor:wait}.sc-stencila-code-expression-material-h .text.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .text.sc-stencila-code-expression-material{background-color:var(--background-editor);border-color:var(--border);color:#4a4a4a;color:var(--color-key,#4a4a4a);display:inline-block;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;line-height:1;min-width:0;overflow:hidden;padding:0;-webkit-transition-duration:.15s;transition-duration:.15s;-webkit-transition-property:width;transition-property:width;-webkit-transition-timing-function:cubic-bezier(0,0,.2,1);transition-timing-function:cubic-bezier(0,0,.2,1);white-space:nowrap;width:0}.isCodeVisible.sc-stencila-code-expression-material-h .text.sc-stencila-code-expression-material,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-material .text.sc-stencila-code-expression-material{border-radius:.25rem;border-width:1px;display:inline-block;margin-right:.25rem;min-width:1em;padding:.25rem .5rem;white-space:pre-line;width:auto}.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=errors],.sc-stencila-code-expression-material-h [slot=errors].sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=errors],stencila-code-expression .sc-stencila-code-expression-material-s>[slot=errors],stencila-code-expression.sc-stencila-code-expression-material [slot=errors].sc-stencila-code-expression-material{display:none}.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error,.sc-stencila-code-expression-material-h [slot=errors].sc-stencila-code-expression-material stencila-code-error.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error,stencila-code-expression .sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error,stencila-code-expression.sc-stencila-code-expression-material [slot=errors].sc-stencila-code-expression-material stencila-code-error.sc-stencila-code-expression-material{background:none;border-style:none;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;line-height:1.5;padding:0}.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error stencila-details,.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error stencila-icon,.sc-stencila-code-expression-material-h [slot=errors].sc-stencila-code-expression-material stencila-code-error.sc-stencila-code-expression-material stencila-details.sc-stencila-code-expression-material,.sc-stencila-code-expression-material-h [slot=errors].sc-stencila-code-expression-material stencila-code-error.sc-stencila-code-expression-material stencila-icon.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error stencila-details,stencila-code-expression .sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error stencila-details,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error stencila-icon,stencila-code-expression .sc-stencila-code-expression-material-s>[slot=errors] stencila-code-error stencila-icon,stencila-code-expression.sc-stencila-code-expression-material [slot=errors].sc-stencila-code-expression-material stencila-code-error.sc-stencila-code-expression-material stencila-details.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material [slot=errors].sc-stencila-code-expression-material stencila-code-error.sc-stencila-code-expression-material stencila-icon.sc-stencila-code-expression-material{display:none}.sc-stencila-code-expression-material-h.isCodeVisible .sc-stencila-code-expression-material-s>[slot=errors],.isCodeVisible.sc-stencila-code-expression-material-h [slot=errors].sc-stencila-code-expression-material,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-material-s>[slot=errors],stencila-code-expression.isCodeVisible .sc-stencila-code-expression-material-s>[slot=errors],stencila-code-expression.isCodeVisible.sc-stencila-code-expression-material [slot=errors].sc-stencila-code-expression-material{display:inline-block}.sc-stencila-code-expression-material-h .divider.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material .divider.sc-stencila-code-expression-material{fill:var(--background);-ms-flex-item-align:center;align-self:center;background-color:var(--background-output);display:inline-block;display:none;width:.5rem}.isCodeVisible.sc-stencila-code-expression-material-h .divider.sc-stencila-code-expression-material,stencila-code-expression.isCodeVisible.sc-stencila-code-expression-material .divider.sc-stencila-code-expression-material{display:inline-block}.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=output],.sc-stencila-code-expression-material-h [slot=output].sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=output],stencila-code-expression .sc-stencila-code-expression-material-s>[slot=output],stencila-code-expression.sc-stencila-code-expression-material [slot=output].sc-stencila-code-expression-material{background-color:#fff;background-color:var(--color-stock,#fff);background-color:var(--background-output);border-style:none;color:#4a4a4a;color:var(--color-key,#4a4a4a);display:inline-block;font-size:1rem;line-height:1.5rem;line-height:1.5;margin:0;padding:0 .25rem 0 .5rem;-webkit-transition:padding .12s ease-out;transition:padding .12s ease-out;white-space:normal}.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=output]:empty,.sc-stencila-code-expression-material-h [slot=output].sc-stencila-code-expression-material:empty,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=output]:empty,stencila-code-expression .sc-stencila-code-expression-material-s>[slot=output]:empty,stencila-code-expression.sc-stencila-code-expression-material [slot=output].sc-stencila-code-expression-material:empty{display:none}.sc-stencila-code-expression-material-h .sc-stencila-code-expression-material-s>[slot=output] *,.sc-stencila-code-expression-material-h [slot=output].sc-stencila-code-expression-material *.sc-stencila-code-expression-material,stencila-code-expression.sc-stencila-code-expression-material-s>[slot=output] *,stencila-code-expression .sc-stencila-code-expression-material-s>[slot=output] *,stencila-code-expression.sc-stencila-code-expression-material [slot=output].sc-stencila-code-expression-material *.sc-stencila-code-expression-material{background-color:#fff;background-color:var(--color-stock,#fff);border-style:none;color:#4a4a4a;color:var(--color-key,#4a4a4a);display:inline;font-size:1rem;line-height:1.5rem;line-height:1.5;margin:0;padding:0;white-space:normal}";var slots={text:"text",output:"output",errors:"errors"};var CodeExpressionComponent=function(){function e(e){var s=this;registerInstance(this,e);this.languageChange=createEvent(this,"stencila-language-change",7);this.allCodeVisibilityChange=createEvent(this,"stencila-code-visibility-change",7);this.contentChange=createEvent(this,"stencila-content-change",7);this.codeExecuteEvent=createEvent(this,"stencila-code-execute",7);this.codeExecuteCancelEvent=createEvent(this,"stencila-code-execute-cancel",7);var i,o;this.hoverTimeOut=undefined;this.hoverStartedAt=Date.now();this.readOnly=false;this.languageCapabilities=fileFormatMap;this.executableLanguages=(o=(i=window.stencilaWebClient)===null||i===void 0?void 0:i.executableLanguages)!==null&&o!==void 0?o:{};this.isExecutable=false;this.shiftIsPressed=false;this.onSelectLanguage=function(e){s.languageChange.emit(lookupFormat(e));s.programmingLanguage=e};this.hover=false;this.isCodeVisible=false;this.toggleCodeVisibility=function(e){e.preventDefault();if(e.shiftKey){s.allCodeVisibilityChange.emit({isVisible:!s.isCodeVisible})}else{s.isCodeVisible=!s.isCodeVisible}};this.selectTextSlot=function(){return s.el.querySelector(".".concat(slots.text))};this.contentChangeHandler=function(e){var i;var o=e.currentTarget;s.contentChange.emit((i=o.textContent)!==null&&i!==void 0?i:"")};this.handleKeyDown=function(e){if(e.key==="Enter"&&e.ctrlKey){e.preventDefault();s.execute().catch((function(e){console.error(e)}))}};this.checkIfExecutable=function(){var e,i;if(s.programmingLanguage===undefined||!s.executeHandler||Object.keys((e=s.executableLanguages)!==null&&e!==void 0?e:{}).length<=0){s.isExecutable=false;return}var o=lookupFormat(s.programmingLanguage).name;s.isExecutable=s.executeHandler!==undefined&&Object.values((i=s.executableLanguages)!==null&&i!==void 0?i:{}).some((function(e){return e.name===o}))};this.onExecuteHandler=function(e){if(e===void 0){e="Topological"}return __awaiter(s,void 0,void 0,(function(){var s,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,this.getContents()];case 1:s=o.sent();if(isPending(this.executeStatus)){this.codeExecuteCancelEvent.emit({nodeId:this.el.id,scope:"All"});return[2,s]}this.codeExecuteEvent.emit({nodeId:this.el.id,ordering:e});if(!(this.isExecutable&&this.executeHandler))return[3,3];return[4,this.executeHandler(s)];case 2:i=o.sent();this.codeExpression=i;return[2,i];case 3:return[2,s]}}))}))};this.executeRef=function(e){return s.execute(e)};this.onMouseOutHandler=function(e){var i=e.target;var o=e.relatedTarget;if(!(i===null||i===void 0?void 0:i.contains(o))){s.removeHoverState()}};this.addHoverState=function(){window.clearTimeout(s.hoverTimeOut);if(!s.hover){s.hover=true;s.hoverStartedAt=Date.now()}};this.removeHoverState=function(){var e=Date.now()-s.hoverStartedAt;if(s.hover&&e<60){s.hoverTimeOut=window.setTimeout((function(){s.hover=false}),3e3)}else if(s.hover){s.hover=false}};this.onKeyPress=function(e){s.shiftIsPressed=e.shiftKey};this.addKeyListeners=function(){window.addEventListener("keydown",s.onKeyPress);window.addEventListener("keyup",s.onKeyPress)};this.removeKeyListeners=function(){window.removeEventListener("keydown",s.onKeyPress);window.removeEventListener("keyup",s.onKeyPress);s.shiftIsPressed=false};this.generateContent=function(){var e;return[h("span",{class:"actions"},h("stencila-menu",{menuPosition:"bottom-start"},h(CodeExecuteStatus,{executeStatus:s.executeStatus,executeRequired:s.executeRequired,slot:"toggle"}),h("slot",{name:"code-dependencies"}),h("slot",{name:"code-dependents"})),h("stencila-button",{"aria-label":"Run Code",class:"run",onClick:function(e){return s.executeRef(e.shiftKey?"Single":"Topological")},color:"key",icon:isPending(s.executeStatus)?"stop":"play",iconOnly:true,minimal:true,size:"xsmall",tooltip:isPending(s.executeStatus)?"Cancel":s.shiftIsPressed?"Run only this code":"Run",onMouseEnter:s.addKeyListeners,onMouseLeave:s.removeKeyListeners}),h("stencila-button",{"aria-label":"".concat(s.isCodeVisible?"Hide":"Show"," Code"),class:"secondaryAction sourceToggle",onClick:s.toggleCodeVisibility,color:"key",icon:s.isCodeVisible?"eye-off":"eye",iconOnly:true,minimal:true,size:"xsmall",tooltip:"".concat(s.isCodeVisible?"Hide":"Show"," Code\nShift click to set for all code")}),h("span",{class:"secondaryAction"},h(LanguagePickerInline,{activeLanguage:(e=s.programmingLanguage)!==null&&e!==void 0?e:"",languageCapabilities:s.languageCapabilities,executableLanguages:s.executableLanguages,onSetLanguage:s.onSelectLanguage,disabled:s.readOnly})),h("span",{class:"text",contentEditable:!s.readOnly,spellcheck:"false",onBlur:s.removeHoverState,onInput:s.contentChangeHandler,tabIndex:s.isCodeVisible?0:-1,role:"textbox"},h("slot",{name:slots.text})),h("slot",{name:slots.errors})),h("svg",{class:"divider",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 24",preserveAspectRatio:"xMinYMin"},h("path",{d:"M8 12L1 0H0v24h1l7-12z"})),h("slot",{name:slots.output})]}}e.prototype.onDiscoverExecutableLanguages=function(e){var s=e.detail;this.executableLanguages=s.languages;this.checkIfExecutable()};e.prototype.onAllCodeVisibilityChange=function(e){this.isCodeVisible=e.detail.isVisible};e.prototype.componentWillLoad=function(){this.checkIfExecutable()};e.prototype.getTextContents=function(){return __awaiter(this,void 0,void 0,(function(){var e,s;return __generator(this,(function(i){s=this.selectTextSlot();return[2,Promise.resolve((e=s===null||s===void 0?void 0:s.textContent)!==null&&e!==void 0?e:"")]}))}))};e.prototype.getContents=function(){return __awaiter(this,void 0,void 0,(function(){var e,s,i;var o;return __generator(this,(function(t){switch(t.label){case 0:s=(e=Promise).resolve;i=c;o={};return[4,this.getTextContents()];case 1:return[2,s.apply(e,[i.apply(void 0,[(o.text=t.sent(),o.programmingLanguage=this.programmingLanguage,o)])])]}}))}))};e.prototype.execute=function(e){if(e===void 0){e="Topological"}return __awaiter(this,void 0,void 0,(function(){var s,i;return __generator(this,(function(o){switch(o.label){case 0:o.trys.push([0,2,,3]);return[4,this.onExecuteHandler(e)];case 1:s=o.sent();return[2,s];case 2:i=o.sent();console.error(i);return[2,new Error("Could not execute CodeExpression")];case 3:return[2]}}))}))};e.prototype.render=function(){return h(Host,{class:{hover:this.hover,isCodeVisible:this.isCodeVisible},onMouseEnter:this.addHoverState,onMouseOut:this.onMouseOutHandler,onKeyDown:this.handleKeyDown},this.generateContent())};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});return e}();CodeExpressionComponent.style={default:defaultCodeExpressionCss,material:materialCodeExpressionCss};export{CodeExpressionComponent as stencila_code_expression};
//# sourceMappingURL=stencila-code-expression.entry.js.map