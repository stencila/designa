{"version":3,"sources":["src/components/codeBlock/codeBlock.css?tag=stencila-code-block&mode=default&encapsulation=scoped","src/components/codeBlock/codeBlock.material.css?tag=stencila-code-block&mode=material&encapsulation=scoped","src/components/codeBlock/codeBlock.tsx"],"names":["defaultCodeBlockCss","codeBlockMaterialCss","CodeBlockComponent","class_1","hostRef","_this","this","autofocus","lineWrapping","lineNumbers","foldGutter","readOnly","keymap","handleLanguageChange","e","programmingLanguage","undefined","lookupFormat","name","detail","prototype","onDiscoverExecutableLanguages","_b","executableLanguages","languages","getContents","editorRef","_a","_c","sent","text","language","codeBlock","Error","getTextContents","getRef","render","h","Host","class","editorContainer","activeLanguage","onStencila-language-change","ref","el","slots","errors","label","caption","outputs"],"mappings":"2lDAAA,IAAMA,oBAAsB,m+DCA5B,IAAMC,qBAAuB,ggEC4BhBC,mBAAkB,WAR/B,SAAAC,EAAAC,GAAA,IAAAC,EAAAC,8BA6BiBA,KAAAC,UAAY,MAMpBD,KAAAE,aAAe,MAMfF,KAAAG,YAAc,KAMdH,KAAAI,WAAa,KAYbJ,KAAAK,SAAW,MAmBHL,KAAAM,OAAmB,GAY1BN,KAAAO,qBAAuB,SAACC,GAC9B,GACET,EAAKU,sBAAwBC,WAC7BC,aAAaZ,EAAKU,qBAAqBG,OAASJ,EAAEK,OAAOD,KACzD,CACAb,EAAKU,oBAAsBD,EAAEK,OAAOD,OA3BxCf,EAAAiB,UAAAC,8BAAA,SAA8BC,OAC5BH,EAAMG,EAAAH,OAENb,KAAKiB,oBAAsBJ,EAAOK,WAgCvBrB,EAAAiB,UAAAK,YAAN,uIACDnB,KAAKoB,UAAL,MAAA,CAAA,EAAA,GACyB,MAAA,CAAA,GAAMC,EAAArB,KAAKoB,aAAS,MAAAC,SAAA,OAAA,EAAAA,EAAEF,sBAA3CH,EAAqBM,EAAAC,OAAnBC,EAAIR,EAAAQ,KAAEC,EAAQT,EAAAS,SACtB,MAAA,CAAA,EAAOC,EAAU,CAAEF,KAAIA,EAAEf,oBAAqBgB,YAGhD,MAAM,IAAIE,MAAM,4CAOL9B,EAAAiB,UAAAc,gBAAN,mIACD5B,KAAKoB,UAAL,MAAA,CAAA,EAAA,GACe,MAAA,CAAA,GAAMC,EAAArB,KAAKoB,aAAS,MAAAC,SAAA,OAAA,EAAAA,EAAEF,sBAA/BK,EAASR,EAAAO,OAAmCC,KACpD,MAAA,CAAA,EAAOA,UAGT,MAAM,IAAIG,MAAM,4CAQL9B,EAAAiB,UAAAe,OAAN,sGACL,MAAA,CAAA,GAAOR,EAAArB,KAAKoB,aAAS,MAAAC,SAAA,OAAA,EAAAA,EAAEQ,iBAGlBhC,EAAAiB,UAAAgB,OAAA,WAAA,IAAA/B,EAAAC,KACL,OACE+B,EAACC,KAAI,KACHD,EAAA,SAAA,KACEA,EAAA,MAAA,KACEA,EAAA,MAAA,CACEE,MAAO,CACLC,gBAAiB,OAGnBH,EAAA,kBAAA,CACEI,eAAgBnC,KAAKS,oBACrBQ,oBAAqBjB,KAAKiB,oBAC1BhB,UAAWD,KAAKC,UAChBK,OAAQN,KAAKM,OACbD,SAAUL,KAAKK,SAAQ+B,6BACKpC,KAAKO,qBACjCH,WAAYJ,KAAKI,WACjBD,YAAaH,KAAKG,YAClBD,aAAcF,KAAKE,aACnBmC,IAAK,SAACC,GACJvC,EAAKqB,UAAYkB,IAGnBP,EAAA,OAAA,CAAMnB,KAAMhB,mBAAmB2C,MAAMf,OACrCO,EAAA,OAAA,CAAMnB,KAAMhB,mBAAmB2C,MAAMC,YAK3CT,EAAA,OAAA,CAAMnB,KAAMhB,mBAAmB2C,MAAME,QAErCV,EAAA,OAAA,CAAMnB,KAAMhB,mBAAmB2C,MAAMG,sBA9JhB,GACL9C,mBAAA2C,MAAQ,CAC9Bf,KAAM,OACNmB,QAAS,UACTH,OAAQ,SACRE,QAAS,UACTD,MAAO","sourcesContent":["@import '~@stencila/style-stencila/dist/molecules/codeBlock.css';\n","@import '~@stencila/style-stencila/dist/molecules/codeBlock.css';\n","import { EditorView } from '@codemirror/view'\nimport { Component, h, Host, Listen, Method, Prop } from '@stencil/core'\nimport { CodeBlock, codeBlock } from '@stencila/schema'\nimport {\n  CodeComponent,\n  DiscoverExecutableLanguagesEvent,\n} from '../code/codeTypes'\nimport { EditorUpdateHandlerCb } from '../editor/customizations/onUpdateHandlerExtension'\nimport { Keymap } from '../editor/editor'\nimport {\n  FileFormat,\n  FileFormatMap,\n  lookupFormat,\n} from '../editor/languageUtils'\n\n/**\n * @slot text - The source code of the `CodeChunk`. Corresponds to the `text` field in the Stencila `CodeChunk` Schema.\n * @slot label - `label` element label of the `CodeChunk`. Corresponds to the `label` field in the Stencila `CodeChunk` Schema.\n * @slot caption - `figcaption` content of the `CodeChunk`. Corresponds to the `caption` field in the Stencila `CodeChunk` Schema.\n */\n@Component({\n  tag: 'stencila-code-block',\n  styleUrls: {\n    default: 'codeBlock.css',\n    material: 'codeBlock.material.css',\n  },\n  scoped: true,\n})\nexport class CodeBlockComponent implements CodeComponent<CodeBlock> {\n  private static readonly slots = {\n    text: 'text',\n    outputs: 'outputs',\n    errors: 'errors',\n    caption: 'caption',\n    label: 'label',\n  }\n\n  public editorRef: HTMLStencilaEditorElement | undefined\n\n  /**\n   * Source code contents of the CodeChunk.\n   * Corresponds to the `text` property of the CodeBlock schema.\n   */\n  @Prop()\n  public text?: string\n\n  /**\n   * Autofocus the editor on page load\n   */\n  @Prop() public autofocus = false\n\n  /**\n   * Control line wrapping of text inside the editor\n   */\n  @Prop()\n  public lineWrapping = false\n\n  /**\n   * Determines the visibility of line numbers\n   */\n  @Prop()\n  public lineNumbers = true\n\n  /**\n   * Enables ability to fold sections of code if the syntax package supports it\n   */\n  @Prop()\n  public foldGutter = true\n\n  /**\n   * Programming language of the CodeChunk\n   */\n  @Prop({ mutable: true })\n  public programmingLanguage: string | undefined\n\n  /**\n   * Disallow editing of the editor contents when set to `true`\n   */\n  @Prop()\n  public readOnly = false\n\n  /**\n   * List of programming languages that can be executed in the current context\n   */\n  @Prop()\n  public executableLanguages?: FileFormatMap\n\n  @Listen('stencila-discover-executable-languages', { target: 'window' })\n  onDiscoverExecutableLanguages({\n    detail,\n  }: DiscoverExecutableLanguagesEvent): void {\n    this.executableLanguages = detail.languages\n  }\n\n  /**\n   * Custom keyboard shortcuts to pass along to CodeMirror\n   * @see https://codemirror.net/6/docs/ref/#keymap\n   */\n  @Prop() public keymap: Keymap[] = []\n\n  /**\n   * Callback function to invoke whenever the editor contents are updated.\n   */\n  @Prop()\n  public contentChangeHandler?: EditorUpdateHandlerCb\n\n  /**\n   * Listen for the `stencila-language-change` event emitted by the language dropdown\n   * provided by the child Editor component, and update the active language if necessary.\n   */\n  private handleLanguageChange = (e: CustomEvent<FileFormat>) => {\n    if (\n      this.programmingLanguage === undefined ||\n      lookupFormat(this.programmingLanguage).name !== e.detail.name\n    ) {\n      this.programmingLanguage = e.detail.name\n    }\n  }\n\n  /**\n   * Returns the `CodeChunk` node with the updated `text` content from the editor.\n   */\n  @Method()\n  public async getContents(): Promise<CodeBlock> {\n    if (this.editorRef) {\n      const { text, language } = await this.editorRef?.getContents()\n      return codeBlock({ text, programmingLanguage: language })\n    }\n\n    throw new Error('Could not get CodeChunk contents')\n  }\n\n  /**\n   * Returns the text contents from the editor\n   */\n  @Method()\n  public async getTextContents(): Promise<string> {\n    if (this.editorRef) {\n      const { text } = await this.editorRef?.getContents()\n      return text\n    }\n\n    throw new Error('Could not get CodeBlock contents')\n  }\n\n  /**\n   * Retrieve a reference to the internal CodeMirror editor.\n   * Allows for maintaining state from applications making use of this component.\n   */\n  @Method()\n  public async getRef(): Promise<EditorView | undefined> {\n    return this.editorRef?.getRef()\n  }\n\n  public render(): HTMLElement {\n    return (\n      <Host>\n        <figure>\n          <div>\n            <div\n              class={{\n                editorContainer: true,\n              }}\n            >\n              <stencila-editor\n                activeLanguage={this.programmingLanguage}\n                executableLanguages={this.executableLanguages}\n                autofocus={this.autofocus}\n                keymap={this.keymap}\n                readOnly={this.readOnly}\n                onStencila-language-change={this.handleLanguageChange}\n                foldGutter={this.foldGutter}\n                lineNumbers={this.lineNumbers}\n                lineWrapping={this.lineWrapping}\n                ref={(el) => {\n                  this.editorRef = el\n                }}\n              >\n                <slot name={CodeBlockComponent.slots.text} />\n                <slot name={CodeBlockComponent.slots.errors} />\n              </stencila-editor>\n            </div>\n          </div>\n\n          <slot name={CodeBlockComponent.slots.label} />\n\n          <slot name={CodeBlockComponent.slots.caption} />\n        </figure>\n      </Host>\n    )\n  }\n}\n"]}