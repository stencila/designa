var __extends=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(e,t,r,n){function i(e){return e instanceof r?e:new r((function(t){t(e)}))}return new(r||(r=Promise))((function(r,o){function a(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n["throw"](e))}catch(t){o(t)}}function l(e){e.done?r(e.value):i(e.value).then(a,s)}l((n=n.apply(e,t||[])).next())}))};var __generator=this&&this.__generator||function(e,t){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(e){return function(t){return l([e,t])}}function l(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;i=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}if(o[2])r.ops.pop();r.trys.pop();continue}a=t.call(e,r)}catch(s){a=[6,s];i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,o;n<i;n++){if(o||!(n in t)){if(!o)o=Array.prototype.slice.call(t,0,n);o[n]=t[n]}}return e.concat(o||Array.prototype.slice.call(t))};import{h,r as registerInstance,f as createEvent,e as Host,c as getElement}from"./index-2305c23c.js";import{g as getSlotByName}from"./slotSelectors-df70e421.js";import{a as lookupFormat,f as fileFormatMap}from"./languageUtils-2c49a4c4.js";var extend="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((function(e){return e?parseInt(e,36):1}));for(var i_1=1;i_1<extend.length;i_1++)extend[i_1]+=extend[i_1-1];function isExtendingChar(e){for(var t=1;t<extend.length;t+=2)if(extend[t]>e)return extend[t-1]<=e;return false}function isRegionalIndicator(e){return e>=127462&&e<=127487}var ZWJ=8205;function findClusterBreak(e,t,r,n){if(r===void 0){r=true}if(n===void 0){n=true}return(r?nextClusterBreak:prevClusterBreak)(e,t,n)}function nextClusterBreak(e,t,r){if(t==e.length)return t;if(t&&surrogateLow(e.charCodeAt(t))&&surrogateHigh(e.charCodeAt(t-1)))t--;var n=codePointAt(e,t);t+=codePointSize(n);while(t<e.length){var i=codePointAt(e,t);if(n==ZWJ||i==ZWJ||r&&isExtendingChar(i)){t+=codePointSize(i);n=i}else if(isRegionalIndicator(i)){var o=0,a=t-2;while(a>=0&&isRegionalIndicator(codePointAt(e,a))){o++;a-=2}if(o%2==0)break;else t+=2}else{break}}return t}function prevClusterBreak(e,t,r){while(t>0){var n=nextClusterBreak(e,t-2,r);if(n<t)return n;t--}return 0}function surrogateLow(e){return e>=56320&&e<57344}function surrogateHigh(e){return e>=55296&&e<56320}function codePointAt(e,t){var r=e.charCodeAt(t);if(!surrogateHigh(r)||t+1==e.length)return r;var n=e.charCodeAt(t+1);if(!surrogateLow(n))return r;return(r-55296<<10)+(n-56320)+65536}function fromCodePoint(e){if(e<=65535)return String.fromCharCode(e);e-=65536;return String.fromCharCode((e>>10)+55296,(e&1023)+56320)}function codePointSize(e){return e<65536?1:2}function countColumn(e,t,r){if(r===void 0){r=e.length}var n=0;for(var i=0;i<r;){if(e.charCodeAt(i)==9){n+=t-n%t;i++}else{n++;i=findClusterBreak(e,i)}}return n}function findColumn(e,t,r,n){for(var i=0,o=0;;){if(o>=t)return i;if(i==e.length)break;o+=e.charCodeAt(i)==9?r-o%r:1;i=findClusterBreak(e,i)}return n===true?-1:e.length}var Text=function(){function e(){}e.prototype.lineAt=function(e){if(e<0||e>this.length)throw new RangeError("Invalid position ".concat(e," in document of length ").concat(this.length));return this.lineInner(e,false,1,0)};e.prototype.line=function(e){if(e<1||e>this.lines)throw new RangeError("Invalid line number ".concat(e," in ").concat(this.lines,"-line document"));return this.lineInner(e,true,1,0)};e.prototype.replace=function(e,t,r){var n=[];this.decompose(0,e,n,2);if(r.length)r.decompose(0,r.length,n,1|2);this.decompose(t,this.length,n,1);return TextNode.from(n,this.length-(t-e)+r.length)};e.prototype.append=function(e){return this.replace(this.length,this.length,e)};e.prototype.slice=function(e,t){if(t===void 0){t=this.length}var r=[];this.decompose(e,t,r,0);return TextNode.from(r,t-e)};e.prototype.eq=function(e){if(e==this)return true;if(e.length!=this.length||e.lines!=this.lines)return false;var t=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1);var n=new RawTextCursor(this),i=new RawTextCursor(e);for(var o=t,a=t;;){n.next(o);i.next(o);o=0;if(n.lineBreak!=i.lineBreak||n.done!=i.done||n.value!=i.value)return false;a+=n.value.length;if(n.done||a>=r)return true}};e.prototype.iter=function(e){if(e===void 0){e=1}return new RawTextCursor(this,e)};e.prototype.iterRange=function(e,t){if(t===void 0){t=this.length}return new PartialTextCursor(this,e,t)};e.prototype.iterLines=function(e,t){var r;if(e==null){r=this.iter()}else{if(t==null)t=this.lines+1;var n=this.line(e).from;r=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new LineCursor(r)};e.prototype.toString=function(){return this.sliceString(0)};e.prototype.toJSON=function(){var e=[];this.flatten(e);return e};e.of=function(t){if(t.length==0)throw new RangeError("A document must have at least one line");if(t.length==1&&!t[0])return e.empty;return t.length<=32?new TextLeaf(t):TextNode.from(TextLeaf.split(t,[]))};return e}();var TextLeaf=function(e){__extends(t,e);function t(t,r){if(r===void 0){r=textLength(t)}var n=e.call(this)||this;n.text=t;n.length=r;return n}Object.defineProperty(t.prototype,"lines",{get:function(){return this.text.length},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"children",{get:function(){return null},enumerable:false,configurable:true});t.prototype.lineInner=function(e,t,r,n){for(var i=0;;i++){var o=this.text[i],a=n+o.length;if((t?r:a)>=e)return new Line(n,a,r,o);n=a+1;r++}};t.prototype.decompose=function(e,r,n,i){var o=e<=0&&r>=this.length?this:new t(sliceText(this.text,e,r),Math.min(r,this.length)-Math.max(0,e));if(i&1){var a=n.pop();var s=appendText(o.text,a.text.slice(),0,o.length);if(s.length<=32){n.push(new t(s,a.length+o.length))}else{var l=s.length>>1;n.push(new t(s.slice(0,l)),new t(s.slice(l)))}}else{n.push(o)}};t.prototype.replace=function(r,n,i){if(!(i instanceof t))return e.prototype.replace.call(this,r,n,i);var o=appendText(this.text,appendText(i.text,sliceText(this.text,0,r)),n);var a=this.length+i.length-(n-r);if(o.length<=32)return new t(o,a);return TextNode.from(t.split(o,[]),a)};t.prototype.sliceString=function(e,t,r){if(t===void 0){t=this.length}if(r===void 0){r="\n"}var n="";for(var i=0,o=0;i<=t&&o<this.text.length;o++){var a=this.text[o],s=i+a.length;if(i>e&&o)n+=r;if(e<s&&t>i)n+=a.slice(Math.max(0,e-i),t-i);i=s+1}return n};t.prototype.flatten=function(e){for(var t=0,r=this.text;t<r.length;t++){var n=r[t];e.push(n)}};t.prototype.scanIdentical=function(){return 0};t.split=function(e,r){var n=[],i=-1;for(var o=0,a=e;o<a.length;o++){var s=a[o];n.push(s);i+=s.length+1;if(n.length==32){r.push(new t(n,i));n=[];i=-1}}if(i>-1)r.push(new t(n,i));return r};return t}(Text);var TextNode=function(e){__extends(t,e);function t(t,r){var n=e.call(this)||this;n.children=t;n.length=r;n.lines=0;for(var i=0,o=t;i<o.length;i++){var a=o[i];n.lines+=a.lines}return n}t.prototype.lineInner=function(e,t,r,n){for(var i=0;;i++){var o=this.children[i],a=n+o.length,s=r+o.lines-1;if((t?s:a)>=e)return o.lineInner(e,t,r,n);n=a+1;r=s+1}};t.prototype.decompose=function(e,t,r,n){for(var i=0,o=0;o<=t&&i<this.children.length;i++){var a=this.children[i],s=o+a.length;if(e<=s&&t>=o){var l=n&((o<=e?1:0)|(s>=t?2:0));if(o>=e&&s<=t&&!l)r.push(a);else a.decompose(e-o,t-o,r,l)}o=s+1}};t.prototype.replace=function(r,n,i){if(i.lines<this.lines)for(var o=0,a=0;o<this.children.length;o++){var s=this.children[o],l=a+s.length;if(r>=a&&n<=l){var c=s.replace(r-a,n-a,i);var u=this.lines-s.lines+c.lines;if(c.lines<u>>5-1&&c.lines>u>>5+1){var f=this.children.slice();f[o]=c;return new t(f,this.length-(n-r)+i.length)}return e.prototype.replace.call(this,a,l,c)}a=l+1}return e.prototype.replace.call(this,r,n,i)};t.prototype.sliceString=function(e,t,r){if(t===void 0){t=this.length}if(r===void 0){r="\n"}var n="";for(var i=0,o=0;i<this.children.length&&o<=t;i++){var a=this.children[i],s=o+a.length;if(o>e&&i)n+=r;if(e<s&&t>o)n+=a.sliceString(e-o,t-o,r);o=s+1}return n};t.prototype.flatten=function(e){for(var t=0,r=this.children;t<r.length;t++){var n=r[t];n.flatten(e)}};t.prototype.scanIdentical=function(e,r){if(!(e instanceof t))return 0;var n=0;var i=r>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1],o=i[0],a=i[1],s=i[2],l=i[3];for(;;o+=r,a+=r){if(o==s||a==l)return n;var c=this.children[o],u=e.children[a];if(c!=u)return n+c.scanIdentical(u,r);n+=c.length+1}};t.from=function(e,r){if(r===void 0){r=e.reduce((function(e,t){return e+t.length+1}),-1)}var n=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];n+=a.lines}if(n<32){var s=[];for(var l=0,c=e;l<c.length;l++){var a=c[l];a.flatten(s)}return new TextLeaf(s,r)}var u=Math.max(32,n>>5),f=u<<1,h=u>>1;var d=[],p=0,g=-1,v=[];function m(e){var r;if(e.lines>f&&e instanceof t){for(var n=0,i=e.children;n<i.length;n++){var o=i[n];m(o)}}else if(e.lines>h&&(p>h||!p)){y();d.push(e)}else if(e instanceof TextLeaf&&p&&(r=v[v.length-1])instanceof TextLeaf&&e.lines+r.lines<=32){p+=e.lines;g+=e.length+1;v[v.length-1]=new TextLeaf(r.text.concat(e.text),r.length+1+e.length)}else{if(p+e.lines>u)y();p+=e.lines;g+=e.length+1;v.push(e)}}function y(){if(p==0)return;d.push(v.length==1?v[0]:t.from(v,g));g=-1;p=v.length=0}for(var b=0,w=e;b<w.length;b++){var x=w[b];m(x)}y();return d.length==1?d[0]:new t(d,r)};return t}(Text);Text.empty=new TextLeaf([""],0);function textLength(e){var t=-1;for(var r=0,n=e;r<n.length;r++){var i=n[r];t+=i.length+1}return t}function appendText(e,t,r,n){if(r===void 0){r=0}if(n===void 0){n=1e9}for(var i=0,o=0,a=true;o<e.length&&i<=n;o++){var s=e[o],l=i+s.length;if(l>=r){if(l>n)s=s.slice(0,n-i);if(i<r)s=s.slice(r-i);if(a){t[t.length-1]+=s;a=false}else t.push(s)}i=l+1}return t}function sliceText(e,t,r){return appendText(e,[""],t,r)}var RawTextCursor=function(){function e(e,t){if(t===void 0){t=1}this.dir=t;this.done=false;this.lineBreak=false;this.value="";this.nodes=[e];this.offsets=[t>0?1:(e instanceof TextLeaf?e.text.length:e.children.length)<<1]}e.prototype.nextInner=function(e,t){this.done=this.lineBreak=false;for(;;){var r=this.nodes.length-1;var n=this.nodes[r],i=this.offsets[r],o=i>>1;var a=n instanceof TextLeaf?n.text.length:n.children.length;if(o==(t>0?a:0)){if(r==0){this.done=true;this.value="";return this}if(t>0)this.offsets[r-1]++;this.nodes.pop();this.offsets.pop()}else if((i&1)==(t>0?0:1)){this.offsets[r]+=t;if(e==0){this.lineBreak=true;this.value="\n";return this}e--}else if(n instanceof TextLeaf){var s=n.text[o+(t<0?-1:0)];this.offsets[r]+=t;if(s.length>Math.max(0,e)){this.value=e==0?s:t>0?s.slice(e):s.slice(0,s.length-e);return this}e-=s.length}else{var s=n.children[o+(t<0?-1:0)];if(e>s.length){e-=s.length;this.offsets[r]+=t}else{if(t<0)this.offsets[r]--;this.nodes.push(s);this.offsets.push(t>0?1:(s instanceof TextLeaf?s.text.length:s.children.length)<<1)}}}};e.prototype.next=function(e){if(e===void 0){e=0}if(e<0){this.nextInner(-e,-this.dir);e=this.value.length}return this.nextInner(e,this.dir)};return e}();var PartialTextCursor=function(){function e(e,t,r){this.value="";this.done=false;this.cursor=new RawTextCursor(e,t>r?-1:1);this.pos=t>r?e.length:0;this.from=Math.min(t,r);this.to=Math.max(t,r)}e.prototype.nextInner=function(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to){this.value="";this.done=true;return this}e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);var r=t<0?this.pos-this.from:this.to-this.pos;if(e>r)e=r;r-=e;var n=this.cursor.next(e).value;this.pos+=(n.length+e)*t;this.value=n.length<=r?n:t<0?n.slice(n.length-r):n.slice(0,r);this.done=!this.value;return this};e.prototype.next=function(e){if(e===void 0){e=0}if(e<0)e=Math.max(e,this.from-this.pos);else if(e>0)e=Math.min(e,this.to-this.pos);return this.nextInner(e,this.cursor.dir)};Object.defineProperty(e.prototype,"lineBreak",{get:function(){return this.cursor.lineBreak&&this.value!=""},enumerable:false,configurable:true});return e}();var LineCursor=function(){function e(e){this.inner=e;this.afterBreak=true;this.value="";this.done=false}e.prototype.next=function(e){if(e===void 0){e=0}var t=this.inner.next(e),r=t.done,n=t.lineBreak,i=t.value;if(r){this.done=true;this.value=""}else if(n){if(this.afterBreak){this.value=""}else{this.afterBreak=true;this.next()}}else{this.value=i;this.afterBreak=false}return this};Object.defineProperty(e.prototype,"lineBreak",{get:function(){return false},enumerable:false,configurable:true});return e}();if(typeof Symbol!="undefined"){Text.prototype[Symbol.iterator]=function(){return this.iter()};RawTextCursor.prototype[Symbol.iterator]=PartialTextCursor.prototype[Symbol.iterator]=LineCursor.prototype[Symbol.iterator]=function(){return this}}var Line=function(){function e(e,t,r,n){this.from=e;this.to=t;this.number=r;this.text=n}Object.defineProperty(e.prototype,"length",{get:function(){return this.to-this.from},enumerable:false,configurable:true});return e}();var DefaultSplit=/\r\n?|\n/;var MapMode=function(e){e[e["Simple"]=0]="Simple";e[e["TrackDel"]=1]="TrackDel";e[e["TrackBefore"]=2]="TrackBefore";e[e["TrackAfter"]=3]="TrackAfter";return e}(MapMode||(MapMode={}));var ChangeDesc=function(){function e(e){this.sections=e}Object.defineProperty(e.prototype,"length",{get:function(){var e=0;for(var t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"newLength",{get:function(){var e=0;for(var t=0;t<this.sections.length;t+=2){var r=this.sections[t+1];e+=r<0?this.sections[t]:r}return e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0},enumerable:false,configurable:true});e.prototype.iterGaps=function(e){for(var t=0,r=0,n=0;t<this.sections.length;){var i=this.sections[t++],o=this.sections[t++];if(o<0){e(r,n,i);n+=i}else{n+=o}r+=i}};e.prototype.iterChangedRanges=function(e,t){if(t===void 0){t=false}iterChanges(this,e,t)};Object.defineProperty(e.prototype,"invertedDesc",{get:function(){var t=[];for(var r=0;r<this.sections.length;){var n=this.sections[r++],i=this.sections[r++];if(i<0)t.push(n,i);else t.push(i,n)}return new e(t)},enumerable:false,configurable:true});e.prototype.composeDesc=function(e){return this.empty?e:e.empty?this:composeSets(this,e)};e.prototype.mapDesc=function(e,t){if(t===void 0){t=false}return e.empty?this:mapSet(this,e,t)};e.prototype.mapPos=function(e,t,r){if(t===void 0){t=-1}if(r===void 0){r=MapMode.Simple}var n=0,i=0;for(var o=0;o<this.sections.length;){var a=this.sections[o++],s=this.sections[o++],l=n+a;if(s<0){if(l>e)return i+(e-n);i+=a}else{if(r!=MapMode.Simple&&l>=e&&(r==MapMode.TrackDel&&n<e&&l>e||r==MapMode.TrackBefore&&n<e||r==MapMode.TrackAfter&&l>e))return null;if(l>e||l==e&&t<0&&!a)return e==n||t<0?i:i+s;i+=s}n=l}if(e>n)throw new RangeError("Position ".concat(e," is out of range for changeset of length ").concat(n));return i};e.prototype.touchesRange=function(e,t){if(t===void 0){t=e}for(var r=0,n=0;r<this.sections.length&&n<=t;){var i=this.sections[r++],o=this.sections[r++],a=n+i;if(o>=0&&n<=t&&a>=e)return n<e&&a>t?"cover":true;n=a}return false};e.prototype.toString=function(){var e="";for(var t=0;t<this.sections.length;){var r=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+r+(n>=0?":"+n:"")}return e};e.prototype.toJSON=function(){return this.sections};e.fromJSON=function(t){if(!Array.isArray(t)||t.length%2||t.some((function(e){return typeof e!="number"})))throw new RangeError("Invalid JSON representation of ChangeDesc");return new e(t)};return e}();var ChangeSet=function(e){__extends(t,e);function t(t,r){var n=e.call(this,t)||this;n.inserted=r;return n}t.prototype.apply=function(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");iterChanges(this,(function(t,r,n,i,o){return e=e.replace(n,n+(r-t),o)}),false);return e};t.prototype.mapDesc=function(e,t){if(t===void 0){t=false}return mapSet(this,e,t,true)};t.prototype.invert=function(e){var r=this.sections.slice(),n=[];for(var i=0,o=0;i<r.length;i+=2){var a=r[i],s=r[i+1];if(s>=0){r[i]=s;r[i+1]=a;var l=i>>1;while(n.length<l)n.push(Text.empty);n.push(a?e.slice(o,o+a):Text.empty)}o+=a}return new t(r,n)};t.prototype.compose=function(e){return this.empty?e:e.empty?this:composeSets(this,e,true)};t.prototype.map=function(e,t){if(t===void 0){t=false}return e.empty?this:mapSet(this,e,t,true)};t.prototype.iterChanges=function(e,t){if(t===void 0){t=false}iterChanges(this,e,t)};Object.defineProperty(t.prototype,"desc",{get:function(){return new ChangeDesc(this.sections)},enumerable:false,configurable:true});t.prototype.filter=function(e){var r=[],n=[],i=[];var o=new SectionIter(this);e:for(var a=0,s=0;;){var l=a==e.length?1e9:e[a++];while(s<l||s==l&&o.len==0){if(o.done)break e;var c=Math.min(o.len,l-s);addSection(i,c,-1);var u=o.ins==-1?-1:o.off==0?o.ins:0;addSection(r,c,u);if(u>0)addInsert(n,r,o.text);o.forward(c);s+=c}var f=e[a++];while(s<f){if(o.done)break e;var c=Math.min(o.len,f-s);addSection(r,c,-1);addSection(i,c,o.ins==-1?-1:o.off==0?o.ins:0);o.forward(c);s+=c}}return{changes:new t(r,n),filtered:new ChangeDesc(i)}};t.prototype.toJSON=function(){var e=[];for(var t=0;t<this.sections.length;t+=2){var r=this.sections[t],n=this.sections[t+1];if(n<0)e.push(r);else if(n==0)e.push([r]);else e.push([r].concat(this.inserted[t>>1].toJSON()))}return e};t.of=function(e,r,n){var i=[],o=[],a=0;var s=null;function l(e){if(e===void 0){e=false}if(!e&&!i.length)return;if(a<r)addSection(i,r-a,-1);var n=new t(i,o);s=s?s.compose(n.map(s)):n;i=[];o=[];a=0}function c(e){if(Array.isArray(e)){for(var u=0,f=e;u<f.length;u++){var h=f[u];c(h)}}else if(e instanceof t){if(e.length!=r)throw new RangeError("Mismatched change set length (got ".concat(e.length,", expected ").concat(r,")"));l();s=s?s.compose(e.map(s)):e}else{var d=e.from,p=e.to,g=p===void 0?d:p,v=e.insert;if(d>g||d<0||g>r)throw new RangeError("Invalid change range ".concat(d," to ").concat(g," (in doc of length ").concat(r,")"));var m=!v?Text.empty:typeof v=="string"?Text.of(v.split(n||DefaultSplit)):v;var y=m.length;if(d==g&&y==0)return;if(d<a)l();if(d>a)addSection(i,d-a,-1);addSection(i,g-d,y);addInsert(o,i,m);a=g}}c(e);l(!s);return s};t.empty=function(e){return new t(e?[e,-1]:[],[])};t.fromJSON=function(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");var r=[],n=[];for(var i=0;i<e.length;i++){var o=e[i];if(typeof o=="number"){r.push(o,-1)}else if(!Array.isArray(o)||typeof o[0]!="number"||o.some((function(e,t){return t&&typeof e!="string"}))){throw new RangeError("Invalid JSON representation of ChangeSet")}else if(o.length==1){r.push(o[0],0)}else{while(n.length<i)n.push(Text.empty);n[i]=Text.of(o.slice(1));r.push(o[0],n[i].length)}}return new t(r,n)};return t}(ChangeDesc);function addSection(e,t,r,n){if(n===void 0){n=false}if(t==0&&r<=0)return;var i=e.length-2;if(i>=0&&r<=0&&r==e[i+1])e[i]+=t;else if(t==0&&e[i]==0)e[i+1]+=r;else if(n){e[i]+=t;e[i+1]+=r}else e.push(t,r)}function addInsert(e,t,r){if(r.length==0)return;var n=t.length-2>>1;if(n<e.length){e[e.length-1]=e[e.length-1].append(r)}else{while(e.length<n)e.push(Text.empty);e.push(r)}}function iterChanges(e,t,r){var n=e.inserted;for(var i=0,o=0,a=0;a<e.sections.length;){var s=e.sections[a++],l=e.sections[a++];if(l<0){i+=s;o+=s}else{var c=i,u=o,f=Text.empty;for(;;){c+=s;u+=l;if(l&&n)f=f.append(n[a-2>>1]);if(r||a==e.sections.length||e.sections[a+1]<0)break;s=e.sections[a++];l=e.sections[a++]}t(i,c,o,u,f);i=c;o=u}}}function mapSet(e,t,r,n){if(n===void 0){n=false}var i=[],o=n?[]:null;var a=new SectionIter(e),s=new SectionIter(t);for(var l=0,c=0;;){if(a.ins==-1){l+=a.len;a.next()}else if(s.ins==-1&&c<l){var u=Math.min(s.len,l-c);s.forward(u);addSection(i,u,-1);c+=u}else if(s.ins>=0&&(a.done||c<l||c==l&&(s.len<a.len||s.len==a.len&&!r))){addSection(i,s.ins,-1);while(l>c&&!a.done&&l+a.len<c+s.len){l+=a.len;a.next()}c+=s.len;s.next()}else if(a.ins>=0){var f=0,h=l+a.len;for(;;){if(s.ins>=0&&c>l&&c+s.len<h){f+=s.ins;c+=s.len;s.next()}else if(s.ins==-1&&c<h){var u=Math.min(s.len,h-c);f+=u;s.forward(u);c+=u}else{break}}addSection(i,f,a.ins);if(o)addInsert(o,i,a.text);l=h;a.next()}else if(a.done&&s.done){return o?new ChangeSet(i,o):new ChangeDesc(i)}else{throw new Error("Mismatched change set lengths")}}}function composeSets(e,t,r){if(r===void 0){r=false}var n=[];var i=r?[]:null;var o=new SectionIter(e),a=new SectionIter(t);for(var s=false;;){if(o.done&&a.done){return i?new ChangeSet(n,i):new ChangeDesc(n)}else if(o.ins==0){addSection(n,o.len,0,s);o.next()}else if(a.len==0&&!a.done){addSection(n,0,a.ins,s);if(i)addInsert(i,n,a.text);a.next()}else if(o.done||a.done){throw new Error("Mismatched change set lengths")}else{var l=Math.min(o.len2,a.len),c=n.length;if(o.ins==-1){var u=a.ins==-1?-1:a.off?0:a.ins;addSection(n,l,u,s);if(i&&u)addInsert(i,n,a.text)}else if(a.ins==-1){addSection(n,o.off?0:o.len,l,s);if(i)addInsert(i,n,o.textBit(l))}else{addSection(n,o.off?0:o.len,a.off?0:a.ins,s);if(i&&!a.off)addInsert(i,n,a.text)}s=(o.ins>l||a.ins>=0&&a.len>l)&&(s||n.length>c);o.forward2(l);a.forward(l)}}}var SectionIter=function(){function e(e){this.set=e;this.i=0;this.next()}e.prototype.next=function(){var e=this.set.sections;if(this.i<e.length){this.len=e[this.i++];this.ins=e[this.i++]}else{this.len=0;this.ins=-2}this.off=0};Object.defineProperty(e.prototype,"done",{get:function(){return this.ins==-2},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"len2",{get:function(){return this.ins<0?this.len:this.ins},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"text",{get:function(){var e=this.set.inserted,t=this.i-2>>1;return t>=e.length?Text.empty:e[t]},enumerable:false,configurable:true});e.prototype.textBit=function(e){var t=this.set.inserted,r=this.i-2>>1;return r>=t.length&&!e?Text.empty:t[r].slice(this.off,e==null?undefined:this.off+e)};e.prototype.forward=function(e){if(e==this.len)this.next();else{this.len-=e;this.off+=e}};e.prototype.forward2=function(e){if(this.ins==-1)this.forward(e);else if(e==this.ins)this.next();else{this.ins-=e;this.off+=e}};return e}();var SelectionRange=function(){function e(e,t,r){this.from=e;this.to=t;this.flags=r}Object.defineProperty(e.prototype,"anchor",{get:function(){return this.flags&16?this.to:this.from},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"head",{get:function(){return this.flags&16?this.from:this.to},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this.from==this.to},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"assoc",{get:function(){return this.flags&4?-1:this.flags&8?1:0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"bidiLevel",{get:function(){var e=this.flags&3;return e==3?null:e},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"goalColumn",{get:function(){var e=this.flags>>5;return e==33554431?undefined:e},enumerable:false,configurable:true});e.prototype.map=function(t,r){if(r===void 0){r=-1}var n,i;if(this.empty){n=i=t.mapPos(this.from,r)}else{n=t.mapPos(this.from,1);i=t.mapPos(this.to,-1)}return n==this.from&&i==this.to?this:new e(n,i,this.flags)};e.prototype.extend=function(e,t){if(t===void 0){t=e}if(e<=this.anchor&&t>=this.anchor)return EditorSelection.range(e,t);var r=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return EditorSelection.range(this.anchor,r)};e.prototype.eq=function(e){return this.anchor==e.anchor&&this.head==e.head};e.prototype.toJSON=function(){return{anchor:this.anchor,head:this.head}};e.fromJSON=function(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return EditorSelection.range(e.anchor,e.head)};return e}();var EditorSelection=function(){function e(e,t){if(t===void 0){t=0}this.ranges=e;this.mainIndex=t}e.prototype.map=function(t,r){if(r===void 0){r=-1}if(t.empty)return this;return e.create(this.ranges.map((function(e){return e.map(t,r)})),this.mainIndex)};e.prototype.eq=function(e){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return false;for(var t=0;t<this.ranges.length;t++)if(!this.ranges[t].eq(e.ranges[t]))return false;return true};Object.defineProperty(e.prototype,"main",{get:function(){return this.ranges[this.mainIndex]},enumerable:false,configurable:true});e.prototype.asSingle=function(){return this.ranges.length==1?this:new e([this.main])};e.prototype.addRange=function(t,r){if(r===void 0){r=true}return e.create([t].concat(this.ranges),r?0:this.mainIndex+1)};e.prototype.replaceRange=function(t,r){if(r===void 0){r=this.mainIndex}var n=this.ranges.slice();n[r]=t;return e.create(n,this.mainIndex)};e.prototype.toJSON=function(){return{ranges:this.ranges.map((function(e){return e.toJSON()})),main:this.mainIndex}};e.fromJSON=function(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new e(t.ranges.map((function(e){return SelectionRange.fromJSON(e)})),t.main)};e.single=function(t,r){if(r===void 0){r=t}return new e([e.range(t,r)],0)};e.create=function(t,r){if(r===void 0){r=0}if(t.length==0)throw new RangeError("A selection needs at least one range");for(var n=0,i=0;i<t.length;i++){var o=t[i];if(o.empty?o.from<=n:o.from<n)return normalized(t.slice(),r);n=o.to}return new e(t,r)};e.cursor=function(e,t,r,n){if(t===void 0){t=0}return new SelectionRange(e,e,(t==0?0:t<0?4:8)|(r==null?3:Math.min(2,r))|(n!==null&&n!==void 0?n:33554431)<<5)};e.range=function(e,t,r){var n=(r!==null&&r!==void 0?r:33554431)<<5;return t<e?new SelectionRange(t,e,16|n|8):new SelectionRange(e,t,n|(t>e?4:0))};return e}();function normalized(e,t){if(t===void 0){t=0}var r=e[t];e.sort((function(e,t){return e.from-t.from}));t=e.indexOf(r);for(var n=1;n<e.length;n++){var i=e[n],o=e[n-1];if(i.empty?i.from<=o.to:i.from<o.to){var a=o.from,s=Math.max(i.to,o.to);if(n<=t)t--;e.splice(--n,2,i.anchor>i.head?EditorSelection.range(s,a):EditorSelection.range(a,s))}}return new EditorSelection(e,t)}function checkSelection(e,t){for(var r=0,n=e.ranges;r<n.length;r++){var i=n[r];if(i.to>t)throw new RangeError("Selection points outside of document")}}var nextID=0;var Facet=function(){function e(e,t,r,n,i){this.combine=e;this.compareInput=t;this.compare=r;this.isStatic=n;this.extensions=i;this.id=nextID++;this.default=e([])}e.define=function(t){if(t===void 0){t={}}return new e(t.combine||function(e){return e},t.compareInput||function(e,t){return e===t},t.compare||(!t.combine?sameArray$1:function(e,t){return e===t}),!!t.static,t.enables)};e.prototype.of=function(e){return new FacetProvider([],this,0,e)};e.prototype.compute=function(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,1,t)};e.prototype.computeN=function(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new FacetProvider(e,this,2,t)};e.prototype.from=function(e,t){if(!t)t=function(e){return e};return this.compute([e],(function(r){return t(r.field(e))}))};return e}();function sameArray$1(e,t){return e==t||e.length==t.length&&e.every((function(e,r){return e===t[r]}))}var FacetProvider=function(){function e(e,t,r,n){this.dependencies=e;this.facet=t;this.type=r;this.value=n;this.id=nextID++}e.prototype.dynamicSlot=function(e){var t;var r=this.value;var n=this.facet.compareInput;var i=this.id,o=e[i]>>1,a=this.type==2;var s=false,l=false,c=[];for(var u=0,f=this.dependencies;u<f.length;u++){var h=f[u];if(h=="doc")s=true;else if(h=="selection")l=true;else if((((t=e[h.id])!==null&&t!==void 0?t:1)&1)==0)c.push(e[h.id])}return{create:function(e){e.values[o]=r(e);return 1},update:function(e,t){if(s&&t.docChanged||l&&(t.docChanged||t.selection)||c.some((function(t){return(ensureAddr(e,t)&1)>0}))){var i=r(e);if(a?!compareArray(i,e.values[o],n):!n(i,e.values[o])){e.values[o]=i;return 1}}return 0},reconfigure:function(e,t){var s=r(e);var l=t.config.address[i];if(l!=null){var c=getAddr(t,l);if(a?compareArray(s,c,n):n(s,c)){e.values[o]=c;return 0}}e.values[o]=s;return 1}}};return e}();function compareArray(e,t,r){if(e.length!=t.length)return false;for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return false;return true}function dynamicFacetSlot(e,t,r){var n=r.map((function(t){return e[t.id]}));var i=r.map((function(e){return e.type}));var o=n.filter((function(e){return!(e&1)}));var a=e[t.id]>>1;function s(e){var r=[];for(var o=0;o<n.length;o++){var a=getAddr(e,n[o]);if(i[o]==2)for(var s=0,l=a;s<l.length;s++){var c=l[s];r.push(c)}else r.push(a)}return t.combine(r)}return{create:function(e){for(var t=0,r=n;t<r.length;t++){var i=r[t];ensureAddr(e,i)}e.values[a]=s(e);return 1},update:function(e,r){if(!o.some((function(t){return ensureAddr(e,t)&1})))return 0;var n=s(e);if(t.compare(n,e.values[a]))return 0;e.values[a]=n;return 1},reconfigure:function(e,i){var o=n.some((function(t){return ensureAddr(e,t)&1}));var l=i.config.facets[t.id],c=i.facet(t);if(l&&!o&&sameArray$1(r,l)){e.values[a]=c;return 0}var u=s(e);if(t.compare(u,c)){e.values[a]=c;return 0}e.values[a]=u;return 1}}}var initField=Facet.define({static:true});var StateField=function(){function e(e,t,r,n,i){this.id=e;this.createF=t;this.updateF=r;this.compareF=n;this.spec=i;this.provides=undefined}e.define=function(t){var r=new e(nextID++,t.create,t.update,t.compare||function(e,t){return e===t},t);if(t.provide)r.provides=t.provide(r);return r};e.prototype.create=function(e){var t=this;var r=e.facet(initField).find((function(e){return e.field==t}));return((r===null||r===void 0?void 0:r.create)||this.createF)(e)};e.prototype.slot=function(e){var t=this;var r=e[this.id]>>1;return{create:function(e){e.values[r]=t.create(e);return 1},update:function(e,n){var i=e.values[r];var o=t.updateF(i,n);if(t.compareF(i,o))return 0;e.values[r]=o;return 1},reconfigure:function(e,n){if(n.config.address[t.id]!=null){e.values[r]=n.field(t);return 0}e.values[r]=t.create(e);return 1}}};e.prototype.init=function(e){return[this,initField.of({field:this,create:e})]};Object.defineProperty(e.prototype,"extension",{get:function(){return this},enumerable:false,configurable:true});return e}();var Prec_={lowest:4,low:3,default:2,high:1,highest:0};function prec(e){return function(t){return new PrecExtension(t,e)}}var Prec={lowest:prec(Prec_.lowest),low:prec(Prec_.low),default:prec(Prec_.default),high:prec(Prec_.high),highest:prec(Prec_.highest),fallback:prec(Prec_.lowest),extend:prec(Prec_.high),override:prec(Prec_.highest)};var PrecExtension=function(){function e(e,t){this.inner=e;this.prec=t}return e}();var Compartment=function(){function e(){}e.prototype.of=function(e){return new CompartmentInstance(this,e)};e.prototype.reconfigure=function(t){return e.reconfigure.of({compartment:this,extension:t})};e.prototype.get=function(e){return e.config.compartments.get(this)};return e}();var CompartmentInstance=function(){function e(e,t){this.compartment=e;this.inner=t}return e}();var Configuration=function(){function e(e,t,r,n,i,o){this.base=e;this.compartments=t;this.dynamicSlots=r;this.address=n;this.staticValues=i;this.facets=o;this.statusTemplate=[];while(this.statusTemplate.length<r.length)this.statusTemplate.push(0)}e.prototype.staticFacet=function(e){var t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]};e.resolve=function(t,r,n){var i=[];var o=Object.create(null);var a=new Map;for(var s=0,l=flatten(t,r,a);s<l.length;s++){var c=l[s];if(c instanceof StateField)i.push(c);else(o[c.facet.id]||(o[c.facet.id]=[])).push(c)}var u=Object.create(null);var f=[];var h=[];var d=function(e){u[e.id]=h.length<<1;h.push((function(t){return e.slot(t)}))};for(var p=0,g=i;p<g.length;p++){var v=g[p];d(v)}var m=n===null||n===void 0?void 0:n.config.facets;var y=function(e){var t=o[e],r=t[0].facet;var i=m&&m[e]||[];if(t.every((function(e){return e.type==0}))){u[r.id]=f.length<<1|1;if(sameArray$1(i,t)){f.push(n.facet(r))}else{var a=r.combine(t.map((function(e){return e.value})));f.push(n&&r.compare(a,n.facet(r))?n.facet(r):a)}}else{var s=function(e){if(e.type==0){u[e.id]=f.length<<1|1;f.push(e.value)}else{u[e.id]=h.length<<1;h.push((function(t){return e.dynamicSlot(t)}))}};for(var l=0,c=t;l<c.length;l++){var d=c[l];s(d)}u[r.id]=h.length<<1;h.push((function(e){return dynamicFacetSlot(e,r,t)}))}};for(var b in o){y(b)}var w=h.map((function(e){return e(u)}));return new e(t,a,w,u,f,o)};return e}();function flatten(e,t,r){var n=[[],[],[],[],[]];var i=new Map;function o(e,a){var s=i.get(e);if(s!=null){if(s>=a)return;var l=n[s].indexOf(e);if(l>-1)n[s].splice(l,1);if(e instanceof CompartmentInstance)r.delete(e.compartment)}i.set(e,a);if(Array.isArray(e)){for(var c=0,u=e;c<u.length;c++){var f=u[c];o(f,a)}}else if(e instanceof CompartmentInstance){if(r.has(e.compartment))throw new RangeError("Duplicate use of compartment in extensions");var h=t.get(e.compartment)||e.inner;r.set(e.compartment,h);o(h,a)}else if(e instanceof PrecExtension){o(e.inner,e.prec)}else if(e instanceof StateField){n[a].push(e);if(e.provides)o(e.provides,a)}else if(e instanceof FacetProvider){n[a].push(e);if(e.facet.extensions)o(e.facet.extensions,a)}else{var d=e.extension;if(!d)throw new Error("Unrecognized extension value in extension set (".concat(e,"). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks."));o(d,a)}}o(e,Prec_.default);return n.reduce((function(e,t){return e.concat(t)}))}function ensureAddr(e,t){if(t&1)return 2;var r=t>>1;var n=e.status[r];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;e.status[r]=4;var i=e.computeSlot(e,e.config.dynamicSlots[r]);return e.status[r]=2|i}function getAddr(e,t){return t&1?e.config.staticValues[t>>1]:e.values[t>>1]}var languageData=Facet.define();var allowMultipleSelections=Facet.define({combine:function(e){return e.some((function(e){return e}))},static:true});var lineSeparator=Facet.define({combine:function(e){return e.length?e[0]:undefined},static:true});var changeFilter=Facet.define();var transactionFilter=Facet.define();var transactionExtender=Facet.define();var readOnly=Facet.define({combine:function(e){return e.length?e[0]:false}});var Annotation=function(){function e(e,t){this.type=e;this.value=t}e.define=function(){return new AnnotationType};return e}();var AnnotationType=function(){function e(){}e.prototype.of=function(e){return new Annotation(this,e)};return e}();var StateEffectType=function(){function e(e){this.map=e}e.prototype.of=function(e){return new StateEffect(this,e)};return e}();var StateEffect=function(){function e(e,t){this.type=e;this.value=t}e.prototype.map=function(t){var r=this.type.map(this.value,t);return r===undefined?undefined:r==this.value?this:new e(this.type,r)};e.prototype.is=function(e){return this.type==e};e.define=function(e){if(e===void 0){e={}}return new StateEffectType(e.map||function(e){return e})};e.mapEffects=function(e,t){if(!e.length)return e;var r=[];for(var n=0,i=e;n<i.length;n++){var o=i[n];var a=o.map(t);if(a)r.push(a)}return r};return e}();StateEffect.reconfigure=StateEffect.define();StateEffect.appendConfig=StateEffect.define();var Transaction=function(){function e(t,r,n,i,o,a){this.startState=t;this.changes=r;this.selection=n;this.effects=i;this.annotations=o;this.scrollIntoView=a;this._doc=null;this._state=null;if(n)checkSelection(n,r.newLength);if(!o.some((function(t){return t.type==e.time})))this.annotations=o.concat(e.time.of(Date.now()))}Object.defineProperty(e.prototype,"newDoc",{get:function(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"newSelection",{get:function(){return this.selection||this.startState.selection.map(this.changes)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"state",{get:function(){if(!this._state)this.startState.applyTransaction(this);return this._state},enumerable:false,configurable:true});e.prototype.annotation=function(e){for(var t=0,r=this.annotations;t<r.length;t++){var n=r[t];if(n.type==e)return n.value}return undefined};Object.defineProperty(e.prototype,"docChanged",{get:function(){return!this.changes.empty},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"reconfigured",{get:function(){return this.startState.config!=this.state.config},enumerable:false,configurable:true});e.prototype.isUserEvent=function(t){var r=this.annotation(e.userEvent);return!!(r&&(r==t||r.length>t.length&&r.slice(0,t.length)==t&&r[t.length]=="."))};return e}();Transaction.time=Annotation.define();Transaction.userEvent=Annotation.define();Transaction.addToHistory=Annotation.define();Transaction.remote=Annotation.define();function joinRanges(e,t){var r=[];for(var n=0,i=0;;){var o=void 0,a=void 0;if(n<e.length&&(i==t.length||t[i]>=e[n])){o=e[n++];a=e[n++]}else if(i<t.length){o=t[i++];a=t[i++]}else return r;if(!r.length||r[r.length-1]<o)r.push(o,a);else if(r[r.length-1]<a)r[r.length-1]=a}}function mergeTransaction(e,t,r){var n;var i,o,a;if(r){i=t.changes;o=ChangeSet.empty(t.changes.length);a=e.changes.compose(t.changes)}else{i=t.changes.map(e.changes);o=e.changes.mapDesc(t.changes,true);a=e.changes.compose(i)}return{changes:a,selection:t.selection?t.selection.map(o):(n=e.selection)===null||n===void 0?void 0:n.map(i),effects:StateEffect.mapEffects(e.effects,i).concat(StateEffect.mapEffects(t.effects,o)),annotations:e.annotations.length?e.annotations.concat(t.annotations):t.annotations,scrollIntoView:e.scrollIntoView||t.scrollIntoView}}function resolveTransactionInner(e,t,r){var n=t.selection,i=asArray$1(t.annotations);if(t.userEvent)i=i.concat(Transaction.userEvent.of(t.userEvent));return{changes:t.changes instanceof ChangeSet?t.changes:ChangeSet.of(t.changes||[],r,e.facet(lineSeparator)),selection:n&&(n instanceof EditorSelection?n:EditorSelection.single(n.anchor,n.head)),effects:asArray$1(t.effects),annotations:i,scrollIntoView:!!t.scrollIntoView}}function resolveTransaction(e,t,r){var n=resolveTransactionInner(e,t.length?t[0]:{},e.doc.length);if(t.length&&t[0].filter===false)r=false;for(var i=1;i<t.length;i++){if(t[i].filter===false)r=false;var o=!!t[i].sequential;n=mergeTransaction(n,resolveTransactionInner(e,t[i],o?n.changes.newLength:e.doc.length),o)}var a=new Transaction(e,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return extendTransaction(r?filterTransaction(a):a)}function filterTransaction(e){var t=e.startState;var r=true;for(var n=0,i=t.facet(changeFilter);n<i.length;n++){var o=i[n];var a=o(e);if(a===false){r=false;break}if(Array.isArray(a))r=r===true?a:joinRanges(r,a)}if(r!==true){var s=void 0,l=void 0;if(r===false){l=e.changes.invertedDesc;s=ChangeSet.empty(t.doc.length)}else{var c=e.changes.filter(r);s=c.changes;l=c.filtered.invertedDesc}e=new Transaction(t,s,e.selection&&e.selection.map(l),StateEffect.mapEffects(e.effects,l),e.annotations,e.scrollIntoView)}var u=t.facet(transactionFilter);for(var f=u.length-1;f>=0;f--){var c=u[f](e);if(c instanceof Transaction)e=c;else if(Array.isArray(c)&&c.length==1&&c[0]instanceof Transaction)e=c[0];else e=resolveTransaction(t,asArray$1(c),false)}return e}function extendTransaction(e){var t=e.startState,r=t.facet(transactionExtender),n=e;for(var i=r.length-1;i>=0;i--){var o=r[i](e);if(o&&Object.keys(o).length)n=mergeTransaction(e,resolveTransactionInner(t,o,e.changes.newLength),true)}return n==e?e:new Transaction(t,e.changes,e.selection,n.effects,n.annotations,n.scrollIntoView)}var none$3=[];function asArray$1(e){return e==null?none$3:Array.isArray(e)?e:[e]}var CharCategory=function(e){e[e["Word"]=0]="Word";e[e["Space"]=1]="Space";e[e["Other"]=2]="Other";return e}(CharCategory||(CharCategory={}));var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;var wordChar;try{wordChar=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(_){}function hasWordChar(e){if(wordChar)return wordChar.test(e);for(var t=0;t<e.length;t++){var r=e[t];if(/\w/.test(r)||r>""&&(r.toUpperCase()!=r.toLowerCase()||nonASCIISingleCaseWordChar.test(r)))return true}return false}function makeCategorizer(e){return function(t){if(!/\S/.test(t))return CharCategory.Space;if(hasWordChar(t))return CharCategory.Word;for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>-1)return CharCategory.Word;return CharCategory.Other}}var EditorState=function(){function e(e,t,r,n,i,o){this.config=e;this.doc=t;this.selection=r;this.values=n;this.status=e.statusTemplate.slice();this.computeSlot=i;if(o)o._state=this;for(var a=0;a<this.config.dynamicSlots.length;a++)ensureAddr(this,a<<1);this.computeSlot=null}e.prototype.field=function(e,t){if(t===void 0){t=true}var r=this.config.address[e.id];if(r==null){if(t)throw new RangeError("Field is not present in this state");return undefined}ensureAddr(this,r);return getAddr(this,r)};e.prototype.update=function(){var e=[];for(var t=0;t<arguments.length;t++){e[t]=arguments[t]}return resolveTransaction(this,e,true)};e.prototype.applyTransaction=function(t){var r=this;var n=this.config,i=n.base,o=n.compartments;for(var a=0,s=t.effects;a<s.length;a++){var l=s[a];if(l.is(Compartment.reconfigure)){if(n){o=new Map;n.compartments.forEach((function(e,t){return o.set(t,e)}));n=null}o.set(l.value.compartment,l.value.extension)}else if(l.is(StateEffect.reconfigure)){n=null;i=l.value}else if(l.is(StateEffect.appendConfig)){n=null;i=asArray$1(i).concat(l.value)}}var c;if(!n){n=Configuration.resolve(i,o,this);var u=new e(n,this.doc,this.selection,n.dynamicSlots.map((function(){return null})),(function(e,t){return t.reconfigure(e,r)}),null);c=u.values}else{c=t.startState.values.slice()}new e(n,t.newDoc,t.newSelection,c,(function(e,r){return r.update(e,t)}),t)};e.prototype.replaceSelection=function(e){if(typeof e=="string")e=this.toText(e);return this.changeByRange((function(t){return{changes:{from:t.from,to:t.to,insert:e},range:EditorSelection.cursor(t.from+e.length)}}))};e.prototype.changeByRange=function(e){var t=this.selection;var r=e(t.ranges[0]);var n=this.changes(r.changes),i=[r.range];var o=asArray$1(r.effects);for(var a=1;a<t.ranges.length;a++){var s=e(t.ranges[a]);var l=this.changes(s.changes),c=l.map(n);for(var u=0;u<a;u++)i[u]=i[u].map(c);var f=n.mapDesc(l,true);i.push(s.range.map(f));n=n.compose(c);o=StateEffect.mapEffects(o,c).concat(StateEffect.mapEffects(asArray$1(s.effects),f))}return{changes:n,selection:EditorSelection.create(i,t.mainIndex),effects:o}};e.prototype.changes=function(t){if(t===void 0){t=[]}if(t instanceof ChangeSet)return t;return ChangeSet.of(t,this.doc.length,this.facet(e.lineSeparator))};e.prototype.toText=function(t){return Text.of(t.split(this.facet(e.lineSeparator)||DefaultSplit))};e.prototype.sliceDoc=function(e,t){if(e===void 0){e=0}if(t===void 0){t=this.doc.length}return this.doc.sliceString(e,t,this.lineBreak)};e.prototype.facet=function(e){var t=this.config.address[e.id];if(t==null)return e.default;ensureAddr(this,t);return getAddr(this,t)};e.prototype.toJSON=function(e){var t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(var r in e){var n=e[r];if(n instanceof StateField)t[r]=n.spec.toJSON(this.field(e[r]),this)}return t};e.fromJSON=function(t,r,n){if(r===void 0){r={}}if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");var i=[];if(n){var o=function(e){var r=n[e],o=t[e];i.push(r.init((function(e){return r.spec.fromJSON(o,e)})))};for(var a in n){o(a)}}return e.create({doc:t.doc,selection:EditorSelection.fromJSON(t.selection),extensions:r.extensions?i.concat([r.extensions]):i})};e.create=function(t){if(t===void 0){t={}}var r=Configuration.resolve(t.extensions||[],new Map);var n=t.doc instanceof Text?t.doc:Text.of((t.doc||"").split(r.staticFacet(e.lineSeparator)||DefaultSplit));var i=!t.selection?EditorSelection.single(0):t.selection instanceof EditorSelection?t.selection:EditorSelection.single(t.selection.anchor,t.selection.head);checkSelection(i,n.length);if(!r.staticFacet(allowMultipleSelections))i=i.asSingle();return new e(r,n,i,r.dynamicSlots.map((function(){return null})),(function(e,t){return t.create(e)}),null)};Object.defineProperty(e.prototype,"tabSize",{get:function(){return this.facet(e.tabSize)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lineBreak",{get:function(){return this.facet(e.lineSeparator)||"\n"},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"readOnly",{get:function(){return this.facet(readOnly)},enumerable:false,configurable:true});e.prototype.phrase=function(t){for(var r=0,n=this.facet(e.phrases);r<n.length;r++){var i=n[r];if(Object.prototype.hasOwnProperty.call(i,t))return i[t]}return t};e.prototype.languageDataAt=function(e,t,r){if(r===void 0){r=-1}var n=[];for(var i=0,o=this.facet(languageData);i<o.length;i++){var a=o[i];for(var s=0,l=a(this,t,r);s<l.length;s++){var c=l[s];if(Object.prototype.hasOwnProperty.call(c,e))n.push(c[e])}}return n};e.prototype.charCategorizer=function(e){return makeCategorizer(this.languageDataAt("wordChars",e).join(""))};e.prototype.wordAt=function(e){var t=this.doc.lineAt(e),r=t.text,n=t.from,i=t.length;var o=this.charCategorizer(e);var a=e-n,s=e-n;while(a>0){var l=findClusterBreak(r,a,false);if(o(r.slice(l,a))!=CharCategory.Word)break;a=l}while(s<i){var c=findClusterBreak(r,s);if(o(r.slice(s,c))!=CharCategory.Word)break;s=c}return a==s?null:EditorSelection.range(a+n,s+n)};return e}();EditorState.allowMultipleSelections=allowMultipleSelections;EditorState.tabSize=Facet.define({combine:function(e){return e.length?e[0]:4}});EditorState.lineSeparator=lineSeparator;EditorState.readOnly=readOnly;EditorState.phrases=Facet.define();EditorState.languageData=languageData;EditorState.changeFilter=changeFilter;EditorState.transactionFilter=transactionFilter;EditorState.transactionExtender=transactionExtender;Compartment.reconfigure=StateEffect.define();function combineConfig(e,t,r){if(r===void 0){r={}}var n={};for(var i=0,o=e;i<o.length;i++){var a=o[i];for(var s=0,l=Object.keys(a);s<l.length;s++){var c=l[s];var u=a[c],f=n[c];if(f===undefined)n[c]=u;else if(f===u||u===undefined);else if(Object.hasOwnProperty.call(r,c))n[c]=r[c](f,u);else throw new Error("Config merge conflict for field "+c)}}for(var c in t)if(n[c]===undefined)n[c]=t[c];return n}var C="ͼ";var COUNT=typeof Symbol=="undefined"?"__"+C:Symbol.for(C);var SET=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet");var top=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};var StyleModule=function(){function e(e,t){this.rules=[];var r=(t||{}).finish;function n(e){return/^@/.test(e)?[e]:e.split(/,\s*/)}function i(e,t,o,a){var s=[],l=/^@(\w+)\b/.exec(e[0]),c=l&&l[1]=="keyframes";if(l&&t==null)return o.push(e[0]+";");for(var u in t){var f=t[u];if(/&/.test(u)){i(u.split(/,\s*/).map((function(t){return e.map((function(e){return t.replace(/&/,e)}))})).reduce((function(e,t){return e.concat(t)})),f,o)}else if(f&&typeof f=="object"){if(!l)throw new RangeError("The value of a property ("+u+") should be a primitive value.");i(n(u),f,s,c)}else if(f!=null){s.push(u.replace(/_.*/,"").replace(/[A-Z]/g,(function(e){return"-"+e.toLowerCase()}))+": "+f+";")}}if(s.length||c){o.push((r&&!l&&!a?e.map(r):e).join(", ")+" {"+s.join(" ")+"}")}}for(var o in e)i(n(o),e[o],this.rules)}e.prototype.getRules=function(){return this.rules.join("\n")};e.newName=function(){var e=top[COUNT]||1;top[COUNT]=e+1;return C+e.toString(36)};e.mount=function(e,t){(e[SET]||new StyleSet(e)).mount(Array.isArray(t)?t:[t])};return e}();var adoptedSet=null;var StyleSet=function(){function e(e){if(!e.head&&e.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(adoptedSet){e.adoptedStyleSheets=[adoptedSet.sheet].concat(e.adoptedStyleSheets);return e[SET]=adoptedSet}this.sheet=new CSSStyleSheet;e.adoptedStyleSheets=[this.sheet].concat(e.adoptedStyleSheets);adoptedSet=this}else{this.styleTag=(e.ownerDocument||e).createElement("style");var t=e.head||e;t.insertBefore(this.styleTag,t.firstChild)}this.modules=[];e[SET]=this}e.prototype.mount=function(e){var t=this.sheet;var r=0,n=0;for(var i=0;i<e.length;i++){var o=e[i],a=this.modules.indexOf(o);if(a<n&&a>-1){this.modules.splice(a,1);n--;a=-1}if(a==-1){this.modules.splice(n++,0,o);if(t)for(var s=0;s<o.rules.length;s++)t.insertRule(o.rules[s],r++)}else{while(n<a)r+=this.modules[n++].rules.length;r+=o.rules.length;n++}}if(!t){var l="";for(var c=0;c<this.modules.length;c++)l+=this.modules[c].getRules()+"\n";this.styleTag.textContent=l}};return e}();var RangeValue=function(){function e(){}e.prototype.eq=function(e){return this==e};e.prototype.range=function(e,t){if(t===void 0){t=e}return new Range$1(e,t,this)};return e}();RangeValue.prototype.startSide=RangeValue.prototype.endSide=0;RangeValue.prototype.point=false;RangeValue.prototype.mapMode=MapMode.TrackDel;var Range$1=function(){function e(e,t,r){this.from=e;this.to=t;this.value=r}return e}();function cmpRange(e,t){return e.from-t.from||e.value.startSide-t.value.startSide}var Chunk=function(){function e(e,t,r,n){this.from=e;this.to=t;this.value=r;this.maxPoint=n}Object.defineProperty(e.prototype,"length",{get:function(){return this.to[this.to.length-1]},enumerable:false,configurable:true});e.prototype.findIndex=function(e,t,r,n){if(n===void 0){n=0}var i=r?this.to:this.from;for(var o=n,a=i.length;;){if(o==a)return o;var s=o+a>>1;var l=i[s]-e||(r?this.value[s].endSide:this.value[s].startSide)-t;if(s==o)return l>=0?o:a;if(l>=0)a=s;else o=s+1}};e.prototype.between=function(e,t,r,n){for(var i=this.findIndex(t,-1e9,true),o=this.findIndex(r,1e9,false,i);i<o;i++)if(n(this.from[i]+e,this.to[i]+e,this.value[i])===false)return false};e.prototype.map=function(t,r){var n=[],i=[],o=[],a=-1,s=-1;for(var l=0;l<this.value.length;l++){var c=this.value[l],u=this.from[l]+t,f=this.to[l]+t,h=void 0,d=void 0;if(u==f){var p=r.mapPos(u,c.startSide,c.mapMode);if(p==null)continue;h=d=p;if(c.startSide!=c.endSide){d=r.mapPos(u,c.endSide);if(d<h)continue}}else{h=r.mapPos(u,c.startSide);d=r.mapPos(f,c.endSide);if(h>d||h==d&&c.startSide>0&&c.endSide<=0)continue}if((d-h||c.endSide-c.startSide)<0)continue;if(a<0)a=h;if(c.point)s=Math.max(s,d-h);n.push(c);i.push(h-a);o.push(d-a)}return{mapped:n.length?new e(i,o,n,s):null,pos:a}};return e}();var RangeSet=function(){function e(t,r,n,i){if(n===void 0){n=e.empty}this.chunkPos=t;this.chunk=r;this.nextLayer=n;this.maxPoint=i}Object.defineProperty(e.prototype,"length",{get:function(){var e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"size",{get:function(){if(this.isEmpty)return 0;var e=this.nextLayer.size;for(var t=0,r=this.chunk;t<r.length;t++){var n=r[t];e+=n.value.length}return e},enumerable:false,configurable:true});e.prototype.chunkEnd=function(e){return this.chunkPos[e]+this.chunk[e].length};e.prototype.update=function(t){var r=t.add,n=r===void 0?[]:r,i=t.sort,o=i===void 0?false:i,a=t.filterFrom,s=a===void 0?0:a,l=t.filterTo,c=l===void 0?this.length:l;var u=t.filter;if(n.length==0&&!u)return this;if(o)n=n.slice().sort(cmpRange);if(this.isEmpty)return n.length?e.of(n):this;var f=new LayerCursor(this,null,-1).goto(0),h=0,d=[];var p=new RangeSetBuilder;while(f.value||h<n.length){if(h<n.length&&(f.from-n[h].from||f.startSide-n[h].value.startSide)>=0){var g=n[h++];if(!p.addInner(g.from,g.to,g.value))d.push(g)}else if(f.rangeIndex==1&&f.chunkIndex<this.chunk.length&&(h==n.length||this.chunkEnd(f.chunkIndex)<n[h].from)&&(!u||s>this.chunkEnd(f.chunkIndex)||c<this.chunkPos[f.chunkIndex])&&p.addChunk(this.chunkPos[f.chunkIndex],this.chunk[f.chunkIndex])){f.nextChunk()}else{if(!u||s>f.to||c<f.from||u(f.from,f.to,f.value)){if(!p.addInner(f.from,f.to,f.value))d.push(new Range$1(f.from,f.to,f.value))}f.next()}}return p.finishInner(this.nextLayer.isEmpty&&!d.length?e.empty:this.nextLayer.update({add:d,filter:u,filterFrom:s,filterTo:c}))};e.prototype.map=function(t){if(t.empty||this.isEmpty)return this;var r=[],n=[],i=-1;for(var o=0;o<this.chunk.length;o++){var a=this.chunkPos[o],s=this.chunk[o];var l=t.touchesRange(a,a+s.length);if(l===false){i=Math.max(i,s.maxPoint);r.push(s);n.push(t.mapPos(a))}else if(l===true){var c=s.map(a,t),u=c.mapped,f=c.pos;if(u){i=Math.max(i,u.maxPoint);r.push(u);n.push(f)}}}var h=this.nextLayer.map(t);return r.length==0?h:new e(n,r,h,i)};e.prototype.between=function(e,t,r){if(this.isEmpty)return;for(var n=0;n<this.chunk.length;n++){var i=this.chunkPos[n],o=this.chunk[n];if(t>=i&&e<=i+o.length&&o.between(i,e-i,t-i,r)===false)return}this.nextLayer.between(e,t,r)};e.prototype.iter=function(e){if(e===void 0){e=0}return HeapCursor.from([this]).goto(e)};Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this.nextLayer==this},enumerable:false,configurable:true});e.iter=function(e,t){if(t===void 0){t=0}return HeapCursor.from(e).goto(t)};e.compare=function(e,t,r,n,i){if(i===void 0){i=-1}var o=e.filter((function(e){return e.maxPoint>0||!e.isEmpty&&e.maxPoint>=i}));var a=t.filter((function(e){return e.maxPoint>0||!e.isEmpty&&e.maxPoint>=i}));var s=findSharedChunks(o,a,r);var l=new SpanCursor(o,s,i);var c=new SpanCursor(a,s,i);r.iterGaps((function(e,t,r){return compare(l,e,c,t,r,n)}));if(r.empty&&r.length==0)compare(l,0,c,0,0,n)};e.eq=function(e,t,r,n){if(r===void 0){r=0}if(n==null)n=1e9;var i=e.filter((function(e){return!e.isEmpty&&t.indexOf(e)<0}));var o=t.filter((function(t){return!t.isEmpty&&e.indexOf(t)<0}));if(i.length!=o.length)return false;if(!i.length)return true;var a=findSharedChunks(i,o);var s=new SpanCursor(i,a,0).goto(r),l=new SpanCursor(o,a,0).goto(r);for(;;){if(s.to!=l.to||!sameValues(s.active,l.active)||s.point&&(!l.point||!s.point.eq(l.point)))return false;if(s.to>n)return true;s.next();l.next()}};e.spans=function(e,t,r,n,i){if(i===void 0){i=-1}var o;var a=new SpanCursor(e,null,i,(o=n.filterPoint)===null||o===void 0?void 0:o.bind(n)).goto(t),s=t;var l=a.openStart;for(;;){var c=Math.min(a.to,r);if(a.point){n.point(s,c,a.point,a.activeForPoint(a.to),l);l=a.openEnd(c)+(a.to>c?1:0)}else if(c>s){n.span(s,c,a.active,l);l=a.openEnd(c)}if(a.to>r)break;s=a.to;a.next()}return l};e.of=function(e,t){if(t===void 0){t=false}var r=new RangeSetBuilder;for(var n=0,i=e instanceof Range$1?[e]:t?lazySort(e):e;n<i.length;n++){var o=i[n];r.add(o.from,o.to,o.value)}return r.finish()};return e}();RangeSet.empty=new RangeSet([],[],null,-1);function lazySort(e){if(e.length>1)for(var t=e[0],r=1;r<e.length;r++){var n=e[r];if(cmpRange(t,n)>0)return e.slice().sort(cmpRange);t=n}return e}RangeSet.empty.nextLayer=RangeSet.empty;var RangeSetBuilder=function(){function e(){this.chunks=[];this.chunkPos=[];this.chunkStart=-1;this.last=null;this.lastFrom=-1e9;this.lastTo=-1e9;this.from=[];this.to=[];this.value=[];this.maxPoint=-1;this.setMaxPoint=-1;this.nextLayer=null}e.prototype.finishChunk=function(e){this.chunks.push(new Chunk(this.from,this.to,this.value,this.maxPoint));this.chunkPos.push(this.chunkStart);this.chunkStart=-1;this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint);this.maxPoint=-1;if(e){this.from=[];this.to=[];this.value=[]}};e.prototype.add=function(t,r,n){if(!this.addInner(t,r,n))(this.nextLayer||(this.nextLayer=new e)).add(t,r,n)};e.prototype.addInner=function(e,t,r){var n=e-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");if(n<0)return false;if(this.from.length==250)this.finishChunk(true);if(this.chunkStart<0)this.chunkStart=e;this.from.push(e-this.chunkStart);this.to.push(t-this.chunkStart);this.last=r;this.lastFrom=e;this.lastTo=t;this.value.push(r);if(r.point)this.maxPoint=Math.max(this.maxPoint,t-e);return true};e.prototype.addChunk=function(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return false;if(this.from.length)this.finishChunk(true);this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint);this.chunks.push(t);this.chunkPos.push(e);var r=t.value.length-1;this.last=t.value[r];this.lastFrom=t.from[r]+e;this.lastTo=t.to[r]+e;return true};e.prototype.finish=function(){return this.finishInner(RangeSet.empty)};e.prototype.finishInner=function(e){if(this.from.length)this.finishChunk(false);if(this.chunks.length==0)return e;var t=new RangeSet(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);this.from=null;return t};return e}();function findSharedChunks(e,t,r){var n=new Map;for(var i=0,o=e;i<o.length;i++){var a=o[i];for(var s=0;s<a.chunk.length;s++)if(a.chunk[s].maxPoint<=0)n.set(a.chunk[s],a.chunkPos[s])}var l=new Set;for(var c=0,u=t;c<u.length;c++){var a=u[c];for(var f=0;f<a.chunk.length;f++){var h=n.get(a.chunk[f]);if(h!=null&&(r?r.mapPos(h):h)==a.chunkPos[f]&&!(r===null||r===void 0?void 0:r.touchesRange(h,h+a.chunk[f].length)))l.add(a.chunk[f])}}return l}var LayerCursor=function(){function e(e,t,r,n){if(n===void 0){n=0}this.layer=e;this.skip=t;this.minPoint=r;this.rank=n}Object.defineProperty(e.prototype,"startSide",{get:function(){return this.value?this.value.startSide:0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"endSide",{get:function(){return this.value?this.value.endSide:0},enumerable:false,configurable:true});e.prototype.goto=function(e,t){if(t===void 0){t=-1e9}this.chunkIndex=this.rangeIndex=0;this.gotoInner(e,t,false);return this};e.prototype.gotoInner=function(e,t,r){while(this.chunkIndex<this.layer.chunk.length){var n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++;r=false}if(this.chunkIndex<this.layer.chunk.length){var i=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,true);if(!r||this.rangeIndex<i)this.setRangeIndex(i)}this.next()};e.prototype.forward=function(e,t){if((this.to-e||this.endSide-t)<0)this.gotoInner(e,t,true)};e.prototype.next=function(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9;this.value=null;break}else{var e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex];var r=e+t.from[this.rangeIndex];this.from=r;this.to=e+t.to[this.rangeIndex];this.value=t.value[this.rangeIndex];this.setRangeIndex(this.rangeIndex+1);if(this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}};e.prototype.setRangeIndex=function(e){if(e==this.layer.chunk[this.chunkIndex].value.length){this.chunkIndex++;if(this.skip){while(this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]))this.chunkIndex++}this.rangeIndex=0}else{this.rangeIndex=e}};e.prototype.nextChunk=function(){this.chunkIndex++;this.rangeIndex=0;this.next()};e.prototype.compare=function(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide};return e}();var HeapCursor=function(){function e(e){this.heap=e}e.from=function(t,r,n){if(r===void 0){r=null}if(n===void 0){n=-1}var i=[];for(var o=0;o<t.length;o++){for(var a=t[o];!a.isEmpty;a=a.nextLayer){if(a.maxPoint>=n)i.push(new LayerCursor(a,r,n,o))}}return i.length==1?i[0]:new e(i)};Object.defineProperty(e.prototype,"startSide",{get:function(){return this.value?this.value.startSide:0},enumerable:false,configurable:true});e.prototype.goto=function(e,t){if(t===void 0){t=-1e9}for(var r=0,n=this.heap;r<n.length;r++){var i=n[r];i.goto(e,t)}for(var o=this.heap.length>>1;o>=0;o--)heapBubble(this.heap,o);this.next();return this};e.prototype.forward=function(e,t){for(var r=0,n=this.heap;r<n.length;r++){var i=n[r];i.forward(e,t)}for(var o=this.heap.length>>1;o>=0;o--)heapBubble(this.heap,o);if((this.to-e||this.value.endSide-t)<0)this.next()};e.prototype.next=function(){if(this.heap.length==0){this.from=this.to=1e9;this.value=null;this.rank=-1}else{var e=this.heap[0];this.from=e.from;this.to=e.to;this.value=e.value;this.rank=e.rank;if(e.value)e.next();heapBubble(this.heap,0)}};return e}();function heapBubble(e,t){for(var r=e[t];;){var n=(t<<1)+1;if(n>=e.length)break;var i=e[n];if(n+1<e.length&&i.compare(e[n+1])>=0){i=e[n+1];n++}if(r.compare(i)<0)break;e[n]=r;e[t]=i;t=n}}var SpanCursor=function(){function e(e,t,r,n){if(n===void 0){n=function(){return true}}this.minPoint=r;this.filterPoint=n;this.active=[];this.activeTo=[];this.activeRank=[];this.minActive=-1;this.point=null;this.pointFrom=0;this.pointRank=0;this.to=-1e9;this.endSide=0;this.openStart=-1;this.cursor=HeapCursor.from(e,t,r)}e.prototype.goto=function(e,t){if(t===void 0){t=-1e9}this.cursor.goto(e,t);this.active.length=this.activeTo.length=this.activeRank.length=0;this.minActive=-1;this.to=e;this.endSide=t;this.openStart=-1;this.next();return this};e.prototype.forward=function(e,t){while(this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0)this.removeActive(this.minActive);this.cursor.forward(e,t)};e.prototype.removeActive=function(e){remove(this.active,e);remove(this.activeTo,e);remove(this.activeRank,e);this.minActive=findMinIndex(this.active,this.activeTo)};e.prototype.addActive=function(e){var t=0,r=this.cursor,n=r.value,i=r.to,o=r.rank;while(t<this.activeRank.length&&this.activeRank[t]<=o)t++;insert(this.active,t,n);insert(this.activeTo,t,i);insert(this.activeRank,t,o);if(e)insert(e,t,this.cursor.from);this.minActive=findMinIndex(this.active,this.activeTo)};e.prototype.next=function(){var e=this.to,t=this.point;this.point=null;var r=this.openStart<0?[]:null,n=0;for(;;){var i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>e){this.to=this.activeTo[i];this.endSide=this.active[i].endSide;break}this.removeActive(i);if(r)remove(r,i)}else if(!this.cursor.value){this.to=this.endSide=1e9;break}else if(this.cursor.from>e){this.to=this.cursor.from;this.endSide=this.cursor.startSide;break}else{var o=this.cursor.value;if(!o.point){this.addActive(r);this.cursor.next()}else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to){this.cursor.next()}else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank)){this.cursor.next()}else{this.point=o;this.pointFrom=this.cursor.from;this.pointRank=this.cursor.rank;this.to=this.cursor.to;this.endSide=o.endSide;if(this.cursor.from<e)n=1;this.cursor.next();this.forward(this.to,this.endSide);break}}}if(r){var a=0;while(a<r.length&&r[a]<e)a++;this.openStart=a+n}};e.prototype.activeForPoint=function(e){if(!this.active.length)return this.active;var t=[];for(var r=this.active.length-1;r>=0;r--){if(this.activeRank[r]<this.pointRank)break;if(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)t.push(this.active[r])}return t.reverse()};e.prototype.openEnd=function(e){var t=0;for(var r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)t++;return t};return e}();function compare(e,t,r,n,i,o){e.goto(t);r.goto(n);var a=n+i;var s=n,l=n-t;for(;;){var c=e.to+l-r.to||e.endSide-r.endSide;var u=c<0?e.to+l:r.to,f=Math.min(u,a);if(e.point||r.point){if(!(e.point&&r.point&&(e.point==r.point||e.point.eq(r.point))&&sameValues(e.activeForPoint(e.to+l),r.activeForPoint(r.to))))o.comparePoint(s,f,e.point,r.point)}else{if(f>s&&!sameValues(e.active,r.active))o.compareRange(s,f,e.active,r.active)}if(u>a)break;s=u;if(c<=0)e.next();if(c>=0)r.next()}}function sameValues(e,t){if(e.length!=t.length)return false;for(var r=0;r<e.length;r++)if(e[r]!=t[r]&&!e[r].eq(t[r]))return false;return true}function remove(e,t){for(var r=t,n=e.length-1;r<n;r++)e[r]=e[r+1];e.pop()}function insert(e,t,r){for(var n=e.length-1;n>=t;n--)e[n+1]=e[n];e[t]=r}function findMinIndex(e,t){var r=-1,n=1e9;for(var i=0;i<t.length;i++)if((t[i]-n||e[i].endSide-e[r].endSide)<0){r=i;n=t[i]}return r}var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"};var shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};var chrome$1=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);var safari$1=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor);var gecko$1=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var mac=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ie$1=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);var brokenModifierNames=chrome$1&&(mac||+chrome$1[1]<57)||gecko$1&&mac;for(var i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(var i=1;i<=24;i++)base[i+111]="F"+i;for(var i=65;i<=90;i++){base[i]=String.fromCharCode(i+32);shift[i]=String.fromCharCode(i)}for(var code in base)if(!shift.hasOwnProperty(code))shift[code]=base[code];function keyName(e){var t=brokenModifierNames&&(e.ctrlKey||e.altKey||e.metaKey)||(safari$1||ie$1)&&e.shiftKey&&e.key&&e.key.length==1;var r=!t&&e.key||(e.shiftKey?shift:base)[e.keyCode]||e.key||"Unidentified";if(r=="Esc")r="Escape";if(r=="Del")r="Delete";if(r=="Left")r="ArrowLeft";if(r=="Up")r="ArrowUp";if(r=="Right")r="ArrowRight";if(r=="Down")r="ArrowDown";return r}function getSelection(e){var t;if(e.nodeType==11){t=e.getSelection?e:e.ownerDocument}else{t=e}return t.getSelection()}function contains(e,t){return t?e==t||e.contains(t.nodeType!=1?t.parentNode:t):false}function deepActiveElement(){var e=document.activeElement;while(e&&e.shadowRoot)e=e.shadowRoot.activeElement;return e}function hasSelection(e,t){if(!t.anchorNode)return false;try{return contains(e,t.anchorNode)}catch(_){return false}}function clientRectsFor(e){if(e.nodeType==3)return textRange(e,0,e.nodeValue.length).getClientRects();else if(e.nodeType==1)return e.getClientRects();else return[]}function isEquivalentPosition(e,t,r,n){return r?scanFor(e,t,r,n,-1)||scanFor(e,t,r,n,1):false}function domIndex(e){for(var t=0;;t++){e=e.previousSibling;if(!e)return t}}function scanFor(e,t,r,n,i){for(;;){if(e==r&&t==n)return true;if(t==(i<0?0:maxOffset(e))){if(e.nodeName=="DIV")return false;var o=e.parentNode;if(!o||o.nodeType!=1)return false;t=domIndex(e)+(i<0?0:1);e=o}else if(e.nodeType==1){e=e.childNodes[t+(i<0?-1:0)];if(e.nodeType==1&&e.contentEditable=="false")return false;t=i<0?maxOffset(e):0}else{return false}}}function maxOffset(e){return e.nodeType==3?e.nodeValue.length:e.childNodes.length}var Rect0={left:0,right:0,top:0,bottom:0};function flattenRect(e,t){var r=t?e.left:e.right;return{left:r,right:r,top:e.top,bottom:e.bottom}}function windowRect(e){return{left:0,right:e.innerWidth,top:0,bottom:e.innerHeight}}function scrollRectIntoView(e,t,r,n,i,o,a,s){var l=e.ownerDocument,c=l.defaultView;for(var u=e;u;){if(u.nodeType==1){var f=void 0,h=u==l.body;if(h){f=windowRect(c)}else{if(u.scrollHeight<=u.clientHeight&&u.scrollWidth<=u.clientWidth){u=u.parentNode;continue}var d=u.getBoundingClientRect();f={left:d.left,right:d.left+u.clientWidth,top:d.top,bottom:d.top+u.clientHeight}}var p=0,g=0;if(i=="nearest"){if(t.top<f.top){g=-(f.top-t.top+a);if(r>0&&t.bottom>f.bottom+g)g=t.bottom-f.bottom+g+a}else if(t.bottom>f.bottom){g=t.bottom-f.bottom+a;if(r<0&&t.top-g<f.top)g=-(f.top+g-t.top+a)}}else{var v=t.bottom-t.top,m=f.bottom-f.top;var y=i=="center"&&v<=m?t.top+v/2-m/2:i=="start"||i=="center"&&r<0?t.top-a:t.bottom-m+a;g=y-f.top}if(n=="nearest"){if(t.left<f.left){p=-(f.left-t.left+o);if(r>0&&t.right>f.right+p)p=t.right-f.right+p+o}else if(t.right>f.right){p=t.right-f.right+o;if(r<0&&t.left<f.left+p)p=-(f.left+p-t.left+o)}}else{var b=n=="center"?t.left+(t.right-t.left)/2-(f.right-f.left)/2:n=="start"==s?t.left-o:t.right-(f.right-f.left)+o;p=b-f.left}if(p||g){if(h){c.scrollBy(p,g)}else{if(g){var w=u.scrollTop;u.scrollTop+=g;g=u.scrollTop-w}if(p){var w=u.scrollLeft;u.scrollLeft+=p;p=u.scrollLeft-w}t={left:t.left-p,top:t.top-g,right:t.right-p,bottom:t.bottom-g}}}if(h)break;u=u.assignedSlot||u.parentNode;n=i="nearest"}else if(u.nodeType==11){u=u.host}else{break}}}var DOMSelectionState=function(){function e(){this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0}e.prototype.eq=function(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset};e.prototype.setRange=function(e){this.set(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)};e.prototype.set=function(e,t,r,n){this.anchorNode=e;this.anchorOffset=t;this.focusNode=r;this.focusOffset=n};return e}();var preventScrollSupported=null;function focusPreventScroll(e){if(e.setActive)return e.setActive();if(preventScrollSupported)return e.focus(preventScrollSupported);var t=[];for(var r=e;r;r=r.parentNode){t.push(r,r.scrollTop,r.scrollLeft);if(r==r.ownerDocument)break}e.focus(preventScrollSupported==null?{get preventScroll(){preventScrollSupported={preventScroll:true};return true}}:undefined);if(!preventScrollSupported){preventScrollSupported=false;for(var n=0;n<t.length;){var i=t[n++],o=t[n++],a=t[n++];if(i.scrollTop!=o)i.scrollTop=o;if(i.scrollLeft!=a)i.scrollLeft=a}}}var scratchRange;function textRange(e,t,r){if(r===void 0){r=t}var n=scratchRange||(scratchRange=document.createRange());n.setEnd(e,r);n.setStart(e,t);return n}function dispatchKey(e,t,r){var n={key:t,code:t,keyCode:r,which:r,cancelable:true};var i=new KeyboardEvent("keydown",n);i.synthetic=true;e.dispatchEvent(i);var o=new KeyboardEvent("keyup",n);o.synthetic=true;e.dispatchEvent(o);return i.defaultPrevented||o.defaultPrevented}function getRoot(e){while(e){if(e&&(e.nodeType==9||e.nodeType==11&&e.host))return e;e=e.assignedSlot||e.parentNode}return null}function clearAttributes(e){while(e.attributes.length)e.removeAttributeNode(e.attributes[0])}var DOMPos=function(){function e(e,t,r){if(r===void 0){r=true}this.node=e;this.offset=t;this.precise=r}e.before=function(t,r){return new e(t.parentNode,domIndex(t),r)};e.after=function(t,r){return new e(t.parentNode,domIndex(t)+1,r)};return e}();var noChildren=[];var ContentView=function(){function e(){this.parent=null;this.dom=null;this.dirty=2}Object.defineProperty(e.prototype,"editorView",{get:function(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){return null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"posAtStart",{get:function(){return this.parent?this.parent.posBefore(this):0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"posAtEnd",{get:function(){return this.posAtStart+this.length},enumerable:false,configurable:true});e.prototype.posBefore=function(e){var t=this.posAtStart;for(var r=0,n=this.children;r<n.length;r++){var i=n[r];if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")};e.prototype.posAfter=function(e){return this.posBefore(e)+e.length};e.prototype.coordsAt=function(e,t){return null};e.prototype.sync=function(t){if(this.dirty&2){var r=this.dom;var n=null,i=void 0;for(var o=0,a=this.children;o<a.length;o++){var s=a[o];if(s.dirty){if(!s.dom&&(i=n?n.nextSibling:r.firstChild)){var l=e.get(i);if(!l||!l.parent&&l.constructor==s.constructor)s.reuseDOM(i)}s.sync(t);s.dirty=0}i=n?n.nextSibling:r.firstChild;if(t&&!t.written&&t.node==r&&i!=s.dom)t.written=true;if(s.dom.parentNode==r){while(i&&i!=s.dom)i=rm$1(i)}else{r.insertBefore(s.dom,i)}n=s.dom}i=n?n.nextSibling:r.firstChild;if(i&&t&&t.node==r)t.written=true;while(i)i=rm$1(i)}else if(this.dirty&1){for(var c=0,u=this.children;c<u.length;c++){var s=u[c];if(s.dirty){s.sync(t);s.dirty=0}}}};e.prototype.reuseDOM=function(e){};e.prototype.localPosFromDOM=function(t,r){var n;if(t==this.dom){n=this.dom.childNodes[r]}else{var i=maxOffset(t)==0?0:r==0?-1:1;for(;;){var o=t.parentNode;if(o==this.dom)break;if(i==0&&o.firstChild!=o.lastChild){if(t==o.firstChild)i=-1;else i=1}t=o}if(i<0)n=t;else n=t.nextSibling}if(n==this.dom.firstChild)return 0;while(n&&!e.get(n))n=n.nextSibling;if(!n)return this.length;for(var a=0,s=0;;a++){var l=this.children[a];if(l.dom==n)return s;s+=l.length+l.breakAfter}};e.prototype.domBoundsAround=function(e,t,r){if(r===void 0){r=0}var n=-1,i=-1,o=-1,a=-1;for(var s=0,l=r,c=r;s<this.children.length;s++){var u=this.children[s],f=l+u.length;if(l<e&&f>t)return u.domBoundsAround(e,t,l);if(f>=e&&n==-1){n=s;i=l}if(l>t&&u.dom.parentNode==this.dom){o=s;a=c;break}c=f;l=f+u.breakAfter}return{from:i,to:a<0?r+this.length:a,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}};e.prototype.markDirty=function(e){if(e===void 0){e=false}this.dirty|=2;this.markParentsDirty(e)};e.prototype.markParentsDirty=function(e){for(var t=this.parent;t;t=t.parent){if(e)t.dirty|=2;if(t.dirty&1)return;t.dirty|=1;e=false}};e.prototype.setParent=function(e){if(this.parent!=e){this.parent=e;if(this.dirty)this.markParentsDirty(true)}};e.prototype.setDOM=function(e){if(this.dom)this.dom.cmView=null;this.dom=e;e.cmView=this};Object.defineProperty(e.prototype,"rootView",{get:function(){for(var e=this;;){var t=e.parent;if(!t)return e;e=t}},enumerable:false,configurable:true});e.prototype.replaceChildren=function(e,t,r){var n;if(r===void 0){r=noChildren}this.markDirty();for(var i=e;i<t;i++){var o=this.children[i];if(o.parent==this)o.destroy()}(n=this.children).splice.apply(n,__spreadArray([e,t-e],r,false));for(var a=0;a<r.length;a++)r[a].setParent(this)};e.prototype.ignoreMutation=function(e){return false};e.prototype.ignoreEvent=function(e){return false};e.prototype.childCursor=function(e){if(e===void 0){e=this.length}return new ChildCursor(this.children,e,this.children.length)};e.prototype.childPos=function(e,t){if(t===void 0){t=1}return this.childCursor().findPos(e,t)};e.prototype.toString=function(){var e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")};e.get=function(e){return e.cmView};Object.defineProperty(e.prototype,"isEditable",{get:function(){return true},enumerable:false,configurable:true});e.prototype.merge=function(e,t,r,n,i,o){return false};e.prototype.become=function(e){return false};e.prototype.getSide=function(){return 0};e.prototype.destroy=function(){this.parent=null};return e}();ContentView.prototype.breakAfter=0;function rm$1(e){var t=e.nextSibling;e.parentNode.removeChild(e);return t}var ChildCursor=function(){function e(e,t,r){this.children=e;this.pos=t;this.i=r;this.off=0}e.prototype.findPos=function(e,t){if(t===void 0){t=1}for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=e-this.pos;return this}var r=this.children[--this.i];this.pos-=r.length+r.breakAfter}};return e}();function replaceRange(e,t,r,n,i,o,a,s,l){var c=e.children;var u=c.length?c[t]:null;var f=o.length?o[o.length-1]:null;var h=f?f.breakAfter:a;if(t==n&&u&&!a&&!h&&o.length<2&&u.merge(r,i,o.length?f:null,r==0,s,l))return;if(n<c.length){var d=c[n];if(d&&i<d.length){if(t==n){d=d.split(i);i=0}if(!h&&f&&d.merge(0,i,f,true,0,l)){o[o.length-1]=d}else{if(i)d.merge(0,i,null,false,0,l);o.push(d)}}else if(d===null||d===void 0?void 0:d.breakAfter){if(f)f.breakAfter=1;else a=1}n++}if(u){u.breakAfter=a;if(r>0){if(!a&&o.length&&u.merge(r,u.length,o[0],false,s,0)){u.breakAfter=o.shift().breakAfter}else if(r<u.length||u.children.length&&u.children[u.children.length-1].length==0){u.merge(r,u.length,null,false,s,0)}t++}}while(t<n&&o.length){if(c[n-1].become(o[o.length-1])){n--;o.pop();l=o.length?0:s}else if(c[t].become(o[0])){t++;o.shift();s=o.length?0:l}else{break}}if(!o.length&&t&&n<c.length&&!c[t-1].breakAfter&&c[n].merge(0,0,c[t-1],false,s,l))t--;if(t<n||o.length)e.replaceChildren(t,n,o)}function mergeChildrenInto(e,t,r,n,i,o){var a=e.childCursor();var s=a.findPos(r,1),l=s.i,c=s.off;var u=a.findPos(t,-1),f=u.i,h=u.off;var d=t-r;for(var p=0,g=n;p<g.length;p++){var v=g[p];d+=v.length}e.length+=d;replaceRange(e,f,h,l,c,n,0,i,o)}var nav=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""};var doc=typeof document!="undefined"?document:{documentElement:{style:{}}};var ie_edge=/Edge\/(\d+)/.exec(nav.userAgent);var ie_upto10=/MSIE \d/.test(nav.userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(nav.userAgent);var ie=!!(ie_upto10||ie_11up||ie_edge);var gecko=!ie&&/gecko\/(\d+)/i.test(nav.userAgent);var chrome=!ie&&/Chrome\/(\d+)/.exec(nav.userAgent);var webkit="webkitFontSmoothing"in doc.documentElement.style;var safari=!ie&&/Apple Computer/.test(nav.vendor);var ios$1=safari&&(/Mobile\/\w+/.test(nav.userAgent)||nav.maxTouchPoints>2);var browser={mac:ios$1||/Mac/.test(nav.platform),windows:/Win/.test(nav.platform),linux:/Linux|X11/.test(nav.platform),ie:ie,ie_version:ie_upto10?doc.documentMode||6:ie_11up?+ie_11up[1]:ie_edge?+ie_edge[1]:0,gecko:gecko,gecko_version:gecko?+(/Firefox\/(\d+)/.exec(nav.userAgent)||[0,0])[1]:0,chrome:!!chrome,chrome_version:chrome?+chrome[1]:0,ios:ios$1,android:/Android\b/.test(nav.userAgent),webkit:webkit,safari:safari,webkit_version:webkit?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:doc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var MaxJoinLen=256;var TextView=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.text=t;return r}Object.defineProperty(t.prototype,"length",{get:function(){return this.text.length},enumerable:false,configurable:true});t.prototype.createDOM=function(e){this.setDOM(e||document.createTextNode(this.text))};t.prototype.sync=function(e){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(e&&e.node==this.dom)e.written=true;this.dom.nodeValue=this.text}};t.prototype.reuseDOM=function(e){if(e.nodeType==3)this.createDOM(e)};t.prototype.merge=function(e,r,n){if(n&&(!(n instanceof t)||this.length-(r-e)+n.length>MaxJoinLen))return false;this.text=this.text.slice(0,e)+(n?n.text:"")+this.text.slice(r);this.markDirty();return true};t.prototype.split=function(e){var r=new t(this.text.slice(e));this.text=this.text.slice(0,e);this.markDirty();return r};t.prototype.localPosFromDOM=function(e,t){return e==this.dom?t:t?this.text.length:0};t.prototype.domAtPos=function(e){return new DOMPos(this.dom,e)};t.prototype.domBoundsAround=function(e,t,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}};t.prototype.coordsAt=function(e,t){return textCoords(this.dom,e,t)};return t}(ContentView);var MarkView=function(e){__extends(t,e);function t(t,r,n){if(r===void 0){r=[]}if(n===void 0){n=0}var i=e.call(this)||this;i.mark=t;i.children=r;i.length=n;for(var o=0,a=r;o<a.length;o++){var s=a[o];s.setParent(i)}return i}t.prototype.setAttrs=function(e){clearAttributes(e);if(this.mark.class)e.className=this.mark.class;if(this.mark.attrs)for(var t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e};t.prototype.reuseDOM=function(e){if(e.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(e);this.dirty|=4|2}};t.prototype.sync=function(t){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.dirty&4)this.setAttrs(this.dom);e.prototype.sync.call(this,t)};t.prototype.merge=function(e,r,n,i,o,a){if(n&&(!(n instanceof t&&n.mark.eq(this.mark))||e&&o<=0||r<this.length&&a<=0))return false;mergeChildrenInto(this,e,r,n?n.children:[],o-1,a-1);this.markDirty();return true};t.prototype.split=function(e){var r=[],n=0,i=-1,o=0;for(var a=0,s=this.children;a<s.length;a++){var l=s[a];var c=n+l.length;if(c>e)r.push(n<e?l.split(e-n):l);if(i<0&&n>=e)i=o;n=c;o++}var u=this.length-e;this.length=e;if(i>-1){this.children.length=i;this.markDirty()}return new t(this.mark,r,u)};t.prototype.domAtPos=function(e){return inlineDOMAtPos(this.dom,this.children,e)};t.prototype.coordsAt=function(e,t){return coordsInChildren(this,e,t)};return t}(ContentView);function textCoords(e,t,r){var n=e.nodeValue.length;if(t>n)t=n;var i=t,o=t,a=0;if(t==0&&r<0||t==n&&r>=0){if(!(browser.chrome||browser.gecko)){if(t){i--;a=1}else{o++;a=-1}}}else{if(r<0)i--;else o++}var s=textRange(e,i,o).getClientRects();if(!s.length)return Rect0;var l=s[(a?a<0:r>=0)?0:s.length-1];if(browser.safari&&!a&&l.width==0)l=Array.prototype.find.call(s,(function(e){return e.width}))||l;return a?flattenRect(l,a<0):l||null}var WidgetView=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.widget=t;i.length=r;i.side=n;i.prevWidget=null;return i}t.create=function(e,r,n){return new(e.customView||t)(e,r,n)};t.prototype.split=function(e){var r=t.create(this.widget,this.length-e,this.side);this.length-=e;return r};t.prototype.sync=function(){if(!this.dom||!this.widget.updateDOM(this.dom)){if(this.dom&&this.prevWidget)this.prevWidget.destroy(this.dom);this.prevWidget=null;this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false"}};t.prototype.getSide=function(){return this.side};t.prototype.merge=function(e,r,n,i,o,a){if(n&&(!(n instanceof t)||!this.widget.compare(n.widget)||e>0&&o<=0||r<this.length&&a<=0))return false;this.length=e+(n?n.length:0)+(this.length-r);return true};t.prototype.become=function(e){if(e.length==this.length&&e instanceof t&&e.side==this.side){if(this.widget.constructor==e.widget.constructor){if(!this.widget.eq(e.widget))this.markDirty(true);if(this.dom&&!this.prevWidget)this.prevWidget=this.widget;this.widget=e.widget;return true}}return false};t.prototype.ignoreMutation=function(){return true};t.prototype.ignoreEvent=function(e){return this.widget.ignoreEvent(e)};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){if(this.length==0)return Text.empty;var e=this;while(e.parent)e=e.parent;var t=e.editorView,r=t&&t.state.doc,n=this.posAtStart;return r?r.slice(n,n+this.length):Text.empty},enumerable:false,configurable:true});t.prototype.domAtPos=function(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)};t.prototype.domBoundsAround=function(){return null};t.prototype.coordsAt=function(e,t){var r=this.dom.getClientRects(),n=null;if(!r.length)return Rect0;for(var i=e>0?r.length-1:0;;i+=e>0?-1:1){n=r[i];if(e>0?i==0:i==r.length-1||n.top<n.bottom)break}return e==0&&t>0||e==this.length&&t<=0?n:flattenRect(n,e==0)};Object.defineProperty(t.prototype,"isEditable",{get:function(){return false},enumerable:false,configurable:true});t.prototype.destroy=function(){e.prototype.destroy.call(this);if(this.dom)this.widget.destroy(this.dom)};return t}(ContentView);var CompositionView=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.domAtPos=function(e){var t=this.widget,r=t.topView,n=t.text;if(!r)return new DOMPos(n,Math.min(e,n.nodeValue.length));return scanCompositionTree(e,0,r,n,(function(e,t){return e.domAtPos(t)}),(function(e){return new DOMPos(n,Math.min(e,n.nodeValue.length))}))};t.prototype.sync=function(){this.setDOM(this.widget.toDOM())};t.prototype.localPosFromDOM=function(e,t){var r=this.widget,n=r.topView,i=r.text;if(!n)return Math.min(t,this.length);return posFromDOMInCompositionTree(e,t,n,i)};t.prototype.ignoreMutation=function(){return false};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return null},enumerable:false,configurable:true});t.prototype.coordsAt=function(e,t){var r=this.widget,n=r.topView,i=r.text;if(!n)return textCoords(i,e,t);return scanCompositionTree(e,t,n,i,(function(e,t,r){return e.coordsAt(t,r)}),(function(e,t){return textCoords(i,e,t)}))};t.prototype.destroy=function(){var t;e.prototype.destroy.call(this);(t=this.widget.topView)===null||t===void 0?void 0:t.destroy()};Object.defineProperty(t.prototype,"isEditable",{get:function(){return true},enumerable:false,configurable:true});return t}(WidgetView);function scanCompositionTree(e,t,r,n,i,o){if(r instanceof MarkView){for(var a=0,s=r.children;a<s.length;a++){var l=s[a];var c=contains(l.dom,n);var u=c?n.nodeValue.length:l.length;if(e<u||e==u&&l.getSide()<=0)return c?scanCompositionTree(e,t,l,n,i,o):i(l,e,t);e-=u}return i(r,r.length,-1)}else if(r.dom==n){return o(e,t)}else{return i(r,e,t)}}function posFromDOMInCompositionTree(e,t,r,n){if(r instanceof MarkView){for(var i=0,o=r.children;i<o.length;i++){var a=o[i];var s=0,l=contains(a.dom,n);if(contains(a.dom,e))return s+(l?posFromDOMInCompositionTree(e,t,a,n):a.localPosFromDOM(e,t));s+=l?n.nodeValue.length:a.length}}else if(r.dom==n){return Math.min(t,n.nodeValue.length)}return r.localPosFromDOM(e,t)}var WidgetBufferView=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.side=t;return r}Object.defineProperty(t.prototype,"length",{get:function(){return 0},enumerable:false,configurable:true});t.prototype.merge=function(){return false};t.prototype.become=function(e){return e instanceof t&&e.side==this.side};t.prototype.split=function(){return new t(this.side)};t.prototype.sync=function(){if(!this.dom){var e=document.createElement("img");e.className="cm-widgetBuffer";e.setAttribute("aria-hidden","true");this.setDOM(e)}};t.prototype.getSide=function(){return this.side};t.prototype.domAtPos=function(e){return DOMPos.before(this.dom)};t.prototype.localPosFromDOM=function(){return 0};t.prototype.domBoundsAround=function(){return null};t.prototype.coordsAt=function(e){var t=this.dom.getBoundingClientRect();var r=inlineSiblingRect(this,this.side>0?-1:1);return r&&r.top<t.bottom&&r.bottom>t.top?{left:t.left,right:t.right,top:r.top,bottom:r.bottom}:t};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return Text.empty},enumerable:false,configurable:true});return t}(ContentView);TextView.prototype.children=WidgetView.prototype.children=WidgetBufferView.prototype.children=noChildren;function inlineSiblingRect(e,t){var r=e.parent,n=r?r.children.indexOf(e):-1;while(r&&n>=0){if(t<0?n>0:n<r.children.length){var i=r.children[n+t];if(i instanceof TextView){var o=i.coordsAt(t<0?i.length:0,t);if(o)return o}n+=t}else if(r instanceof MarkView&&r.parent){n=r.parent.children.indexOf(r)+(t<0?0:1);r=r.parent}else{var a=r.dom.lastChild;if(a&&a.nodeName=="BR")return a.getClientRects()[0];break}}return undefined}function inlineDOMAtPos(e,t,r){var n=0;for(var i=0;n<t.length;n++){var o=t[n],a=i+o.length;if(a==i&&o.getSide()<=0)continue;if(r>i&&r<a&&o.dom.parentNode==e)return o.domAtPos(r-i);if(r<=i)break;i=a}for(;n>0;n--){var s=t[n-1].dom;if(s.parentNode==e)return DOMPos.after(s)}return new DOMPos(e,0)}function joinInlineInto(e,t,r){var n,i=e.children;if(r>0&&t instanceof MarkView&&i.length&&(n=i[i.length-1])instanceof MarkView&&n.mark.eq(t.mark)){joinInlineInto(n,t.children[0],r-1)}else{i.push(t);t.setParent(e)}e.length+=t.length}function coordsInChildren(e,t,r){for(var n=0,i=0;i<e.children.length;i++){var o=e.children[i],a=n+o.length,s=void 0;if((r<=0||a==e.length||o.getSide()>0?a>=t:a>t)&&(t<a||i+1==e.children.length||(s=e.children[i+1]).length||s.getSide()>0)){var l=0;if(a==n){if(o.getSide()<=0)continue;l=r=-o.getSide()}var c=o.coordsAt(Math.max(0,t-n),r);return l&&c?flattenRect(c,r<0):c}n=a}var u=e.dom.lastChild;if(!u)return e.dom.getBoundingClientRect();var f=clientRectsFor(u);return f[f.length-1]||null}function combineAttrs(e,t){for(var r in e){if(r=="class"&&t.class)t.class+=" "+e.class;else if(r=="style"&&t.style)t.style+=";"+e.style;else t[r]=e[r]}return t}function attrsEq(e,t){if(e==t)return true;if(!e||!t)return false;var r=Object.keys(e),n=Object.keys(t);if(r.length!=n.length)return false;for(var i=0,o=r;i<o.length;i++){var a=o[i];if(n.indexOf(a)==-1||e[a]!==t[a])return false}return true}function updateAttrs(e,t,r){if(t)for(var n in t)if(!(r&&n in r))e.removeAttribute(n);if(r)for(var i in r)if(!(t&&t[i]==r[i]))e.setAttribute(i,r[i])}var WidgetType=function(){function e(){}e.prototype.eq=function(e){return false};e.prototype.updateDOM=function(e){return false};e.prototype.compare=function(e){return this==e||this.constructor==e.constructor&&this.eq(e)};Object.defineProperty(e.prototype,"estimatedHeight",{get:function(){return-1},enumerable:false,configurable:true});e.prototype.ignoreEvent=function(e){return true};Object.defineProperty(e.prototype,"customView",{get:function(){return null},enumerable:false,configurable:true});e.prototype.destroy=function(e){};return e}();var BlockType=function(e){e[e["Text"]=0]="Text";e[e["WidgetBefore"]=1]="WidgetBefore";e[e["WidgetAfter"]=2]="WidgetAfter";e[e["WidgetRange"]=3]="WidgetRange";return e}(BlockType||(BlockType={}));var Decoration=function(e){__extends(t,e);function t(t,r,n,i){var o=e.call(this)||this;o.startSide=t;o.endSide=r;o.widget=n;o.spec=i;return o}Object.defineProperty(t.prototype,"heightRelevant",{get:function(){return false},enumerable:false,configurable:true});t.mark=function(e){return new MarkDecoration(e)};t.widget=function(e){var t=e.side||0,r=!!e.block;t+=r?t>0?3e8:-4e8:t>0?1e8:-1e8;return new PointDecoration(e,t,t,r,e.widget||null,false)};t.replace=function(e){var t=!!e.block,r,n;if(e.isBlockGap){r=-5e8;n=4e8}else{var i=getInclusive(e,t),o=i.start,a=i.end;r=(o?t?-3e8:-1:5e8)-1;n=(a?t?2e8:1:-6e8)+1}return new PointDecoration(e,r,n,t,e.widget||null,true)};t.line=function(e){return new LineDecoration(e)};t.set=function(e,t){if(t===void 0){t=false}return RangeSet.of(e,t)};t.prototype.hasHeight=function(){return this.widget?this.widget.estimatedHeight>-1:false};return t}(RangeValue);Decoration.none=RangeSet.empty;var MarkDecoration=function(e){__extends(t,e);function t(t){var r=this;var n=getInclusive(t),i=n.start,o=n.end;r=e.call(this,i?-1:5e8,o?1:-6e8,null,t)||this;r.tagName=t.tagName||"span";r.class=t.class||"";r.attrs=t.attributes||null;return r}t.prototype.eq=function(e){return this==e||e instanceof t&&this.tagName==e.tagName&&this.class==e.class&&attrsEq(this.attrs,e.attrs)};t.prototype.range=function(t,r){if(r===void 0){r=t}if(t>=r)throw new RangeError("Mark decorations may not be empty");return e.prototype.range.call(this,t,r)};return t}(Decoration);MarkDecoration.prototype.point=false;var LineDecoration=function(e){__extends(t,e);function t(t){return e.call(this,-2e8,-2e8,null,t)||this}t.prototype.eq=function(e){return e instanceof t&&attrsEq(this.spec.attributes,e.spec.attributes)};t.prototype.range=function(t,r){if(r===void 0){r=t}if(r!=t)throw new RangeError("Line decoration ranges must be zero-length");return e.prototype.range.call(this,t,r)};return t}(Decoration);LineDecoration.prototype.mapMode=MapMode.TrackBefore;LineDecoration.prototype.point=true;var PointDecoration=function(e){__extends(t,e);function t(t,r,n,i,o,a){var s=e.call(this,r,n,o,t)||this;s.block=i;s.isReplace=a;s.mapMode=!i?MapMode.TrackDel:r<=0?MapMode.TrackBefore:MapMode.TrackAfter;return s}Object.defineProperty(t.prototype,"type",{get:function(){return this.startSide<this.endSide?BlockType.WidgetRange:this.startSide<=0?BlockType.WidgetBefore:BlockType.WidgetAfter},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"heightRelevant",{get:function(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5},enumerable:false,configurable:true});t.prototype.eq=function(e){return e instanceof t&&widgetsEq(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide};t.prototype.range=function(t,r){if(r===void 0){r=t}if(this.isReplace&&(t>r||t==r&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&r!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return e.prototype.range.call(this,t,r)};return t}(Decoration);PointDecoration.prototype.point=true;function getInclusive(e,t){if(t===void 0){t=false}var r=e.inclusiveStart,n=e.inclusiveEnd;if(r==null)r=e.inclusive;if(n==null)n=e.inclusive;return{start:r!==null&&r!==void 0?r:t,end:n!==null&&n!==void 0?n:t}}function widgetsEq(e,t){return e==t||!!(e&&t&&e.compare(t))}function addRange(e,t,r,n){if(n===void 0){n=0}var i=r.length-1;if(i>=0&&r[i]+n>=e)r[i]=Math.max(r[i],t);else r.push(e,t)}var LineView=function(e){__extends(t,e);function t(){var t=e.apply(this,arguments)||this;t.children=[];t.length=0;t.prevAttrs=undefined;t.attrs=null;t.breakAfter=0;return t}t.prototype.merge=function(e,r,n,i,o,a){if(n){if(!(n instanceof t))return false;if(!this.dom)n.transferDOM(this)}if(i)this.setDeco(n?n.attrs:null);mergeChildrenInto(this,e,r,n?n.children:[],o,a);return true};t.prototype.split=function(e){var r=new t;r.breakAfter=this.breakAfter;if(this.length==0)return r;var n=this.childPos(e),i=n.i,o=n.off;if(o){r.append(this.children[i].split(o),0);this.children[i].merge(o,this.children[i].length,null,false,0,0);i++}for(var a=i;a<this.children.length;a++)r.append(this.children[a],0);while(i>0&&this.children[i-1].length==0)this.children[--i].destroy();this.children.length=i;this.markDirty();this.length=e;return r};t.prototype.transferDOM=function(e){if(!this.dom)return;e.setDOM(this.dom);e.prevAttrs=this.prevAttrs===undefined?this.attrs:this.prevAttrs;this.prevAttrs=undefined;this.dom=null};t.prototype.setDeco=function(e){if(!attrsEq(this.attrs,e)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty()}this.attrs=e}};t.prototype.append=function(e,t){joinInlineInto(this,e,t)};t.prototype.addLineDeco=function(e){var t=e.spec.attributes,r=e.spec.class;if(t)this.attrs=combineAttrs(t,this.attrs||{});if(r)this.attrs=combineAttrs({class:r},this.attrs||{})};t.prototype.domAtPos=function(e){return inlineDOMAtPos(this.dom,this.children,e)};t.prototype.reuseDOM=function(e){if(e.nodeName=="DIV"){this.setDOM(e);this.dirty|=4|2}};t.prototype.sync=function(t){var r;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}else if(this.dirty&4){clearAttributes(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}if(this.prevAttrs!==undefined){updateAttrs(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=undefined}e.prototype.sync.call(this,t);var n=this.dom.lastChild;while(n&&ContentView.get(n)instanceof MarkView)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((r=ContentView.get(n))===null||r===void 0?void 0:r.isEditable)==false&&(!browser.ios||!this.children.some((function(e){return e instanceof TextView})))){var i=document.createElement("BR");i.cmIgnore=true;this.dom.appendChild(i)}};t.prototype.measureTextSize=function(){if(this.children.length==0||this.length>20)return null;var e=0;for(var t=0,r=this.children;t<r.length;t++){var n=r[t];if(!(n instanceof TextView))return null;var i=clientRectsFor(n.dom);if(i.length!=1)return null;e+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length}};t.prototype.coordsAt=function(e,t){return coordsInChildren(this,e,t)};t.prototype.become=function(e){return false};Object.defineProperty(t.prototype,"type",{get:function(){return BlockType.Text},enumerable:false,configurable:true});t.find=function(e,r){for(var n=0,i=0;n<e.children.length;n++){var o=e.children[n],a=i+o.length;if(a>=r){if(o instanceof t)return o;if(a>r)break}i=a+o.breakAfter}return null};return t}(ContentView);var BlockWidgetView=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.widget=t;i.length=r;i.type=n;i.breakAfter=0;i.prevWidget=null;return i}t.prototype.merge=function(e,r,n,i,o,a){if(n&&(!(n instanceof t)||!this.widget.compare(n.widget)||e>0&&o<=0||r<this.length&&a<=0))return false;this.length=e+(n?n.length:0)+(this.length-r);return true};t.prototype.domAtPos=function(e){return e==0?DOMPos.before(this.dom):DOMPos.after(this.dom,e==this.length)};t.prototype.split=function(e){var r=this.length-e;this.length=e;var n=new t(this.widget,r,this.type);n.breakAfter=this.breakAfter;return n};Object.defineProperty(t.prototype,"children",{get:function(){return noChildren},enumerable:false,configurable:true});t.prototype.sync=function(){if(!this.dom||!this.widget.updateDOM(this.dom)){if(this.dom&&this.prevWidget)this.prevWidget.destroy(this.dom);this.prevWidget=null;this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false"}};Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Text.empty},enumerable:false,configurable:true});t.prototype.domBoundsAround=function(){return null};t.prototype.become=function(e){if(e instanceof t&&e.type==this.type&&e.widget.constructor==this.widget.constructor){if(!e.widget.eq(this.widget))this.markDirty(true);if(this.dom&&!this.prevWidget)this.prevWidget=this.widget;this.widget=e.widget;this.length=e.length;this.breakAfter=e.breakAfter;return true}return false};t.prototype.ignoreMutation=function(){return true};t.prototype.ignoreEvent=function(e){return this.widget.ignoreEvent(e)};t.prototype.destroy=function(){e.prototype.destroy.call(this);if(this.dom)this.widget.destroy(this.dom)};return t}(ContentView);var ContentBuilder=function(){function e(e,t,r,n){this.doc=e;this.pos=t;this.end=r;this.disallowBlockEffectsBelow=n;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=e.iter();this.skip=t}e.prototype.posCovered=function(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var e=this.content[this.content.length-1];return!e.breakAfter&&!(e instanceof BlockWidgetView&&e.type==BlockType.WidgetBefore)};e.prototype.getLine=function(){if(!this.curLine){this.content.push(this.curLine=new LineView);this.atCursorPos=true}return this.curLine};e.prototype.flushBuffer=function(e){if(this.pendingBuffer){this.curLine.append(wrapMarks(new WidgetBufferView(-1),e),e.length);this.pendingBuffer=0}};e.prototype.addBlockWidget=function(e){this.flushBuffer([]);this.curLine=null;this.content.push(e)};e.prototype.finish=function(e){if(!e)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine()};e.prototype.buildText=function(e,t,r){while(e>0){if(this.textOff==this.text.length){var n=this.cursor.next(this.skip),i=n.value,o=n.lineBreak,a=n.done;this.skip=0;if(a)throw new Error("Ran out of text content when drawing inline views");if(o){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;e--;continue}else{this.text=i;this.textOff=0}}var s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(0,r));this.getLine().append(wrapMarks(new TextView(this.text.slice(this.textOff,this.textOff+s)),t),r);this.atCursorPos=true;this.textOff+=s;e-=s;r=0}};e.prototype.span=function(e,t,r,n){this.buildText(t-e,r,n);this.pos=t;if(this.openStart<0)this.openStart=n};e.prototype.point=function(e,t,r,n,i){var o=t-e;if(r instanceof PointDecoration){if(r.block){var a=r.type;if(a==BlockType.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new BlockWidgetView(r.widget||new NullWidget("div"),o,a))}else{var s=WidgetView.create(r.widget||new NullWidget("span"),o,r.startSide);var l=this.atCursorPos&&!s.isEditable&&i<=n.length&&(e<t||r.startSide>0);var c=!s.isEditable&&(e<t||r.startSide<=0);var u=this.getLine();if(this.pendingBuffer==2&&!l)this.pendingBuffer=0;this.flushBuffer(n);if(l){u.append(wrapMarks(new WidgetBufferView(1),n),i);i=n.length+Math.max(0,i-n.length)}u.append(wrapMarks(s,n),i);this.atCursorPos=c;this.pendingBuffer=!c?0:e<t?1:2}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(r)}if(o){if(this.textOff+o<=this.text.length){this.textOff+=o}else{this.skip+=o-(this.text.length-this.textOff);this.text="";this.textOff=0}this.pos=t}if(this.openStart<0)this.openStart=i};e.prototype.filterPoint=function(e,t,r,n){if(n<this.disallowBlockEffectsBelow&&r instanceof PointDecoration){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return true};e.build=function(t,r,n,i,o){var a=new e(t,r,n,o);a.openEnd=RangeSet.spans(i,r,n,a);if(a.openStart<0)a.openStart=a.openEnd;a.finish(a.openEnd);return a};return e}();function wrapMarks(e,t){for(var r=0,n=t;r<n.length;r++){var i=n[r];e=new MarkView(i,[e],e.length)}return e}var NullWidget=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.tag=t;return r}t.prototype.eq=function(e){return e.tag==this.tag};t.prototype.toDOM=function(){return document.createElement(this.tag)};t.prototype.updateDOM=function(e){return e.nodeName.toLowerCase()==this.tag};return t}(WidgetType);var none$2=[];var clickAddsSelectionRange=Facet.define();var dragMovesSelection$1=Facet.define();var mouseSelectionStyle=Facet.define();var exceptionSink=Facet.define();var updateListener=Facet.define();var inputHandler$1=Facet.define();var scrollTo=StateEffect.define({map:function(e,t){return e.map(t)}});var centerOn=StateEffect.define({map:function(e,t){return e.map(t)}});var ScrollTarget=function(){function e(e,t,r,n,i){if(t===void 0){t="nearest"}if(r===void 0){r="nearest"}if(n===void 0){n=5}if(i===void 0){i=5}this.range=e;this.y=t;this.x=r;this.yMargin=n;this.xMargin=i}e.prototype.map=function(t){return t.empty?this:new e(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin)};return e}();var scrollIntoView$1=StateEffect.define({map:function(e,t){return e.map(t)}});function logException(e,t,r){var n=e.facet(exceptionSink);if(n.length)n[0](t);else if(window.onerror)window.onerror(String(t),r,undefined,undefined,t);else if(r)console.error(r+":",t);else console.error(t)}var editable=Facet.define({combine:function(e){return e.length?e[0]:true}});var PluginFieldProvider=function(){function e(e,t){this.field=e;this.get=t}return e}();var PluginField=function(){function e(){}e.prototype.from=function(e){return new PluginFieldProvider(this,e)};e.define=function(){return new e};return e}();PluginField.decorations=PluginField.define();PluginField.atomicRanges=PluginField.define();PluginField.scrollMargins=PluginField.define();var nextPluginID=0;var viewPlugin=Facet.define();var ViewPlugin=function(){function e(e,t,r){this.id=e;this.create=t;this.fields=r;this.extension=viewPlugin.of(this)}e.define=function(t,r){var n=r||{},i=n.eventHandlers,o=n.provide,a=n.decorations;var s=[];if(o)for(var l=0,c=Array.isArray(o)?o:[o];l<c.length;l++){var u=c[l];s.push(u)}if(i)s.push(domEventHandlers.from((function(e){return{plugin:e,handlers:i}})));if(a)s.push(PluginField.decorations.from(a));return new e(nextPluginID++,t,s)};e.fromClass=function(t,r){return e.define((function(e){return new t(e)}),r)};return e}();var domEventHandlers=PluginField.define();var PluginInstance=function(){function e(e){this.spec=e;this.mustUpdate=null;this.value=null}e.prototype.takeField=function(e,t){if(this.spec)for(var r=0,n=this.spec.fields;r<n.length;r++){var i=n[r],o=i.field,a=i.get;if(o==e)t.push(a(this.value))}};e.prototype.update=function(e){if(!this.value){if(this.spec){try{this.value=this.spec.create(e)}catch(r){logException(e.state,r,"CodeMirror plugin crashed");this.deactivate()}}}else if(this.mustUpdate){var t=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(t)}catch(r){logException(t.state,r,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy()}catch(_){}this.deactivate()}}}return this};e.prototype.destroy=function(e){var t;if((t=this.value)===null||t===void 0?void 0:t.destroy){try{this.value.destroy()}catch(r){logException(e.state,r,"CodeMirror plugin crashed")}}};e.prototype.deactivate=function(){this.spec=this.value=null};return e}();var editorAttributes=Facet.define();var contentAttributes=Facet.define();var decorations=Facet.define();var styleModule=Facet.define();var ChangedRange=function(){function e(e,t,r,n){this.fromA=e;this.toA=t;this.fromB=r;this.toB=n}e.prototype.join=function(t){return new e(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))};e.prototype.addToSet=function(e){var t=e.length,r=this;for(;t>0;t--){var n=e[t-1];if(n.fromA>r.toA)continue;if(n.toA<r.fromA)break;r=r.join(n);e.splice(t-1,1)}e.splice(t,0,r);return e};e.extendWithRanges=function(t,r){if(r.length==0)return t;var n=[];for(var i=0,o=0,a=0,s=0;;i++){var l=i==t.length?null:t[i],c=a-s;var u=l?l.fromB:1e9;while(o<r.length&&r[o]<u){var f=r[o],h=r[o+1];var d=Math.max(s,f),p=Math.min(u,h);if(d<=p)new e(d+c,p+c,d,p).addToSet(n);if(h>u)break;else o+=2}if(!l)return n;new e(l.fromA,l.toA,l.fromB,l.toB).addToSet(n);a=l.toA;s=l.toB}};return e}();var ViewUpdate=function(){function e(e,t,r){if(r===void 0){r=none$2}this.view=e;this.state=t;this.transactions=r;this.flags=0;this.startState=e.state;this.changes=ChangeSet.empty(this.startState.doc.length);for(var n=0,i=r;n<i.length;n++){var o=i[n];this.changes=this.changes.compose(o.changes)}var a=[];this.changes.iterChangedRanges((function(e,t,r,n){return a.push(new ChangedRange(e,t,r,n))}));this.changedRanges=a;var s=e.hasFocus;if(s!=e.inputState.notifiedFocused){e.inputState.notifiedFocused=s;this.flags|=1}}Object.defineProperty(e.prototype,"viewportChanged",{get:function(){return(this.flags&4)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"heightChanged",{get:function(){return(this.flags&2)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"geometryChanged",{get:function(){return this.docChanged||(this.flags&(8|2))>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"focusChanged",{get:function(){return(this.flags&1)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"docChanged",{get:function(){return!this.changes.empty},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"selectionSet",{get:function(){return this.transactions.some((function(e){return e.selection}))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"empty",{get:function(){return this.flags==0&&this.transactions.length==0},enumerable:false,configurable:true});return e}();var Direction=function(e){e[e["LTR"]=0]="LTR";e[e["RTL"]=1]="RTL";return e}(Direction||(Direction={}));var LTR=Direction.LTR,RTL=Direction.RTL;function dec(e){var t=[];for(var r=0;r<e.length;r++)t.push(1<<+e[r]);return t}var LowTypes=dec("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var ArabicTypes=dec("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var Brackets=Object.create(null),BracketStack=[];for(var _i=0,_e=["()","[]","{}"];_i<_e.length;_i++){var p=_e[_i];var l=p.charCodeAt(0),r=p.charCodeAt(1);Brackets[l]=r;Brackets[r]=-l}function charType(e){return e<=247?LowTypes[e]:1424<=e&&e<=1524?2:1536<=e&&e<=1785?ArabicTypes[e-1536]:1774<=e&&e<=2220?4:8192<=e&&e<=8203?256:e==8204?256:1}var BidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var BidiSpan=function(){function e(e,t,r){this.from=e;this.to=t;this.level=r}Object.defineProperty(e.prototype,"dir",{get:function(){return this.level%2?RTL:LTR},enumerable:false,configurable:true});e.prototype.side=function(e,t){return this.dir==t==e?this.to:this.from};e.find=function(e,t,r,n){var i=-1;for(var o=0;o<e.length;o++){var a=e[o];if(a.from<=t&&a.to>=t){if(a.level==r)return o;if(i<0||(n!=0?n<0?a.from<t:a.to>t:e[i].level>a.level))i=o}}if(i<0)throw new RangeError("Index out of range");return i};return e}();var types=[];function computeOrder(e,t){var r=e.length,n=t==LTR?1:2,i=t==LTR?2:1;if(!e||n==1&&!BidiRE.test(e))return trivialOrder(r);for(var o=0,a=n,s=n;o<r;o++){var l=charType(e.charCodeAt(o));if(l==512)l=a;else if(l==8&&s==4)l=16;types[o]=l==4?2:l;if(l&7)s=l;a=l}for(var c=0,a=n,s=n;c<r;c++){var l=types[c];if(l==128){if(c<r-1&&a==types[c+1]&&a&24)l=types[c]=a;else types[c]=256}else if(l==64){var u=c+1;while(u<r&&types[u]==64)u++;var f=c&&a==8||u<r&&types[u]==8?s==1?1:8:256;for(var h=c;h<u;h++)types[h]=f;c=u-1}else if(l==8&&s==1){types[c]=1}a=l;if(l&7)s=l}for(var d=0,p=0,g=0,v=void 0,m=void 0,l=void 0;d<r;d++){if(m=Brackets[v=e.charCodeAt(d)]){if(m<0){for(var y=p-3;y>=0;y-=3){if(BracketStack[y+1]==-m){var b=BracketStack[y+2];var w=b&2?n:!(b&4)?0:b&1?i:n;if(w)types[d]=types[BracketStack[y]]=w;p=y;break}}}else if(BracketStack.length==189){break}else{BracketStack[p++]=d;BracketStack[p++]=v;BracketStack[p++]=g}}else if((l=types[d])==2||l==1){var x=l==n;g=x?0:1;for(var y=p-3;y>=0;y-=3){var S=BracketStack[y+2];if(S&2)break;if(x){BracketStack[y+2]|=2}else{if(S&4)break;BracketStack[y+2]|=4}}}}for(var k=0;k<r;k++){if(types[k]==256){var u=k+1;while(u<r&&types[u]==256)u++;var C=(k?types[k-1]:n)==1;var M=(u<r?types[u]:n)==1;var f=C==M?C?1:2:n;for(var h=k;h<u;h++)types[h]=f;k=u-1}}var A=[];if(n==1){for(var P=0;P<r;){var T=P,E=types[P++]!=1;while(P<r&&E==(types[P]!=1))P++;if(E){for(var h=P;h>T;){var u=h,D=types[--h]!=2;while(h>T&&D==(types[h-1]!=2))h--;A.push(new BidiSpan(h,u,D?2:1))}}else{A.push(new BidiSpan(T,P,0))}}}else{for(var O=0;O<r;){var T=O,E=types[O++]==2;while(O<r&&E==(types[O]==2))O++;A.push(new BidiSpan(T,O,E?1:2))}}return A}function trivialOrder(e){return[new BidiSpan(0,e,0)]}var movedOver="";function moveVisually(e,t,r,n,i){var o;var a=n.head-e.from,s=-1;if(a==0){if(!i||!e.length)return null;if(t[0].level!=r){a=t[0].side(false,r);s=0}}else if(a==e.length){if(i)return null;var l=t[t.length-1];if(l.level!=r){a=l.side(true,r);s=t.length-1}}if(s<0)s=BidiSpan.find(t,a,(o=n.bidiLevel)!==null&&o!==void 0?o:-1,n.assoc);var c=t[s];if(a==c.side(i,r)){c=t[s+=i?1:-1];a=c.side(!i,r)}var u=i==(c.dir==r);var f=findClusterBreak(e.text,a,u);movedOver=e.text.slice(Math.min(a,f),Math.max(a,f));if(f!=c.side(i,r))return EditorSelection.cursor(f+e.from,u?-1:1,c.level);var h=s==(i?t.length-1:0)?null:t[s+(i?1:-1)];if(!h&&c.level!=r)return EditorSelection.cursor(i?e.to:e.from,i?-1:1,r);if(h&&h.level<c.level)return EditorSelection.cursor(h.side(!i,r)+e.from,i?1:-1,h.level);return EditorSelection.cursor(f+e.from,i?-1:1,c.level)}var LineBreakPlaceholder="￿";var DOMReader=function(){function e(e,t){this.points=e;this.text="";this.lineSeparator=t.facet(EditorState.lineSeparator)}e.prototype.append=function(e){this.text+=e};e.prototype.lineBreak=function(){this.text+=LineBreakPlaceholder};e.prototype.readRange=function(e,t){if(!e)return this;var r=e.parentNode;for(var n=e;;){this.findPointBefore(r,n);this.readNode(n);var i=n.nextSibling;if(i==t)break;var o=ContentView.get(n),a=ContentView.get(i);if(o&&a?o.breakAfter:(o?o.breakAfter:isBlockElement(n))||isBlockElement(i)&&(n.nodeName!="BR"||n.cmIgnore))this.lineBreak();n=i}this.findPointBefore(r,t);return this};e.prototype.readTextNode=function(e){var t=e.nodeValue;for(var r=0,n=this.points;r<n.length;r++){var i=n[r];if(i.node==e)i.pos=this.text.length+Math.min(i.offset,t.length)}for(var o=0,a=this.lineSeparator?null:/\r\n?|\n/g;;){var s=-1,l=1,c=void 0;if(this.lineSeparator){s=t.indexOf(this.lineSeparator,o);l=this.lineSeparator.length}else if(c=a.exec(t)){s=c.index;l=c[0].length}this.append(t.slice(o,s<0?t.length:s));if(s<0)break;this.lineBreak();if(l>1)for(var u=0,f=this.points;u<f.length;u++){var i=f[u];if(i.node==e&&i.pos>this.text.length)i.pos-=l-1}o=s+l}};e.prototype.readNode=function(e){if(e.cmIgnore)return;var t=ContentView.get(e);var r=t&&t.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(var n=r.iter();!n.next().done;){if(n.lineBreak)this.lineBreak();else this.append(n.value)}}else if(e.nodeType==3){this.readTextNode(e)}else if(e.nodeName=="BR"){if(e.nextSibling)this.lineBreak()}else if(e.nodeType==1){this.readRange(e.firstChild,null)}};e.prototype.findPointBefore=function(e,t){for(var r=0,n=this.points;r<n.length;r++){var i=n[r];if(i.node==e&&e.childNodes[i.offset]==t)i.pos=this.text.length}};e.prototype.findPointInside=function(e,t){for(var r=0,n=this.points;r<n.length;r++){var i=n[r];if(e.nodeType==3?i.node==e:e.contains(i.node))i.pos=this.text.length+Math.min(t,i.offset)}};return e}();function isBlockElement(e){return e.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(e.nodeName)}var DOMPoint=function(){function e(e,t){this.node=e;this.offset=t;this.pos=-1}return e}();var DocView=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.view=t;r.compositionDeco=Decoration.none;r.decorations=[];r.pluginDecorationLength=0;r.minWidth=0;r.minWidthFrom=0;r.minWidthTo=0;r.impreciseAnchor=null;r.impreciseHead=null;r.forceSelection=false;r.lastUpdate=Date.now();r.setDOM(t.contentDOM);r.children=[new LineView];r.children[0].setParent(r);r.updateDeco();r.updateInner([new ChangedRange(0,0,0,t.state.doc.length)],0);return r}Object.defineProperty(t.prototype,"root",{get:function(){return this.view.root},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"editorView",{get:function(){return this.view},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"length",{get:function(){return this.view.state.doc.length},enumerable:false,configurable:true});t.prototype.update=function(e){var t=this;var r=e.changedRanges;if(this.minWidth>0&&r.length){if(!r.every((function(e){var r=e.fromA,n=e.toA;return n<t.minWidthFrom||r>t.minWidthTo}))){this.minWidth=this.minWidthFrom=this.minWidthTo=0}else{this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)}}if(this.view.inputState.composing<0)this.compositionDeco=Decoration.none;else if(e.transactions.length||this.dirty)this.compositionDeco=computeCompositionDeco(this.view,e.changes);if((browser.ie||browser.chrome)&&!this.compositionDeco.size&&e&&e.state.doc.lines!=e.startState.doc.lines)this.forceSelection=true;var n=this.decorations,i=this.updateDeco();var o=findChangedDeco(n,i,e.changes);r=ChangedRange.extendWithRanges(r,o);if(this.dirty==0&&r.length==0){return false}else{this.updateInner(r,e.startState.doc.length);if(e.transactions.length)this.lastUpdate=Date.now();return true}};t.prototype.updateInner=function(e,t){var r=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(e,t);var n=this.view.observer;n.ignore((function(){r.dom.style.height=r.view.viewState.contentHeight+"px";r.dom.style.minWidth=r.minWidth?r.minWidth+"px":"";var e=browser.chrome||browser.ios?{node:n.selectionRange.focusNode,written:false}:undefined;r.sync(e);r.dirty=0;if(e&&(e.written||n.selectionRange.focusNode!=e.node))r.forceSelection=true;r.dom.style.height=""}));var i=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(var o=0,a=this.children;o<a.length;o++){var s=a[o];if(s instanceof BlockWidgetView&&s.widget instanceof BlockGapWidget)i.push(s.dom)}n.updateGaps(i)};t.prototype.updateChildren=function(e,t){var r=this.childCursor(t);for(var n=e.length-1;;n--){var i=n>=0?e[n]:null;if(!i)break;var o=i.fromA,a=i.toA,s=i.fromB,l=i.toB;var c=ContentBuilder.build(this.view.state.doc,s,l,this.decorations,this.pluginDecorationLength),u=c.content,f=c.breakAtStart,h=c.openStart,d=c.openEnd;var p=r.findPos(a,1),g=p.i,v=p.off;var m=r.findPos(o,-1),y=m.i,b=m.off;replaceRange(this,y,b,g,v,u,f,h,d)}};t.prototype.updateSelection=function(e,t){var r=this;if(e===void 0){e=false}if(t===void 0){t=false}if(e)this.view.observer.readSelectionRange();if(!(t||this.mayControlSelection())||browser.ios&&this.view.inputState.rapidCompositionStart)return;var n=this.forceSelection;this.forceSelection=false;var i=this.view.state.selection.main;var o=this.domAtPos(i.anchor);var a=i.empty?o:this.domAtPos(i.head);if(browser.gecko&&i.empty&&betweenUneditable(o)){var s=document.createTextNode("");this.view.observer.ignore((function(){return o.node.insertBefore(s,o.node.childNodes[o.offset]||null)}));o=a=new DOMPos(s,0);n=true}var l=this.view.observer.selectionRange;if(n||!l.focusNode||!isEquivalentPosition(o.node,o.offset,l.anchorNode,l.anchorOffset)||!isEquivalentPosition(a.node,a.offset,l.focusNode,l.focusOffset)){this.view.observer.ignore((function(){var e;if(browser.android&&browser.chrome&&r.dom.contains(l.focusNode)&&inUneditable(l.focusNode,r.dom)){r.dom.blur();r.dom.focus({preventScroll:true})}var t=getSelection(r.root);if(i.empty){if(browser.gecko){var n=nextToUneditable(o.node,o.offset);if(n&&n!=(1|2)){var s=nearbyTextNode(o.node,o.offset,n==1?1:-1);if(s)o=new DOMPos(s,n==1?0:s.nodeValue.length)}}t.collapse(o.node,o.offset);if(i.bidiLevel!=null&&l.cursorBidiLevel!=null)l.cursorBidiLevel=i.bidiLevel}else if(t.extend){t.collapse(o.node,o.offset);t.extend(a.node,a.offset)}else{var c=document.createRange();if(i.anchor>i.head)e=[a,o],o=e[0],a=e[1];c.setEnd(a.node,a.offset);c.setStart(o.node,o.offset);t.removeAllRanges();t.addRange(c)}}));this.view.observer.setSelectionRange(o,a)}this.impreciseAnchor=o.precise?null:new DOMPos(l.anchorNode,l.anchorOffset);this.impreciseHead=a.precise?null:new DOMPos(l.focusNode,l.focusOffset)};t.prototype.enforceCursorAssoc=function(){if(this.compositionDeco.size)return;var e=this.view.state.selection.main;var t=getSelection(this.root);if(!e.empty||!e.assoc||!t.modify)return;var r=LineView.find(this,e.head);if(!r)return;var n=r.posAtStart;if(e.head==n||e.head==n+r.length)return;var i=this.coordsAt(e.head,-1),o=this.coordsAt(e.head,1);if(!i||!o||i.bottom>o.top)return;var a=this.domAtPos(e.head+e.assoc);t.collapse(a.node,a.offset);t.modify("move",e.assoc<0?"forward":"backward","lineboundary")};t.prototype.mayControlSelection=function(){return this.view.state.facet(editable)?this.root.activeElement==this.dom:hasSelection(this.dom,this.view.observer.selectionRange)};t.prototype.nearest=function(e){for(var t=e;t;){var r=ContentView.get(t);if(r&&r.rootView==this)return r;t=t.parentNode}return null};t.prototype.posFromDOM=function(e,t){var r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,t)+r.posAtStart};t.prototype.domAtPos=function(e){var t=this.childCursor().findPos(e,-1),r=t.i,n=t.off;for(;r<this.children.length-1;){var i=this.children[r];if(n<i.length||i instanceof LineView)break;r++;n=0}return this.children[r].domAtPos(n)};t.prototype.coordsAt=function(e,t){for(var r=this.length,n=this.children.length-1;;n--){var i=this.children[n],o=r-i.breakAfter-i.length;if(e>o||e==o&&i.type!=BlockType.WidgetBefore&&i.type!=BlockType.WidgetAfter&&(!n||t==2||this.children[n-1].breakAfter||this.children[n-1].type==BlockType.WidgetBefore&&t>-2))return i.coordsAt(e-o,t);r=o}};t.prototype.measureVisibleLineHeights=function(){var e=[],t=this.view.viewState.viewport,r=t.from,n=t.to;var i=this.view.contentDOM.clientWidth;var o=i>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var a=-1;for(var s=0,l=0;l<this.children.length;l++){var c=this.children[l],u=s+c.length;if(u>n)break;if(s>=r){var f=c.dom.getBoundingClientRect();e.push(f.height);if(o){var h=c.dom.lastChild;var d=h?clientRectsFor(h):[];if(d.length){var p=d[d.length-1];var g=this.view.textDirection==Direction.LTR?p.right-f.left:f.right-p.left;if(g>a){a=g;this.minWidth=i;this.minWidthFrom=s;this.minWidthTo=u}}}}s=u+c.breakAfter}return e};t.prototype.measureTextSize=function(){var e=this;for(var t=0,r=this.children;t<r.length;t++){var n=r[t];if(n instanceof LineView){var i=n.measureTextSize();if(i)return i}}var o=document.createElement("div"),a,s;o.className="cm-line";o.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore((function(){e.dom.appendChild(o);var t=clientRectsFor(o.firstChild)[0];a=o.getBoundingClientRect().height;s=t?t.width/27:7;o.remove()}));return{lineHeight:a,charWidth:s}};t.prototype.childCursor=function(e){if(e===void 0){e=this.length}var t=this.children.length;if(t)e-=this.children[--t].length;return new ChildCursor(this.children,e,t)};t.prototype.computeBlockGapDeco=function(){var e=[],t=this.view.viewState;for(var r=0,n=0;;n++){var i=n==t.viewports.length?null:t.viewports[n];var o=i?i.from-1:this.length;if(o>r){var a=t.lineBlockAt(o).bottom-t.lineBlockAt(r).top;e.push(Decoration.replace({widget:new BlockGapWidget(a),block:true,inclusive:true,isBlockGap:true}).range(r,o))}if(!i)break;r=i.to+1}return Decoration.set(e)};t.prototype.updateDeco=function(){var e=this.view.pluginField(PluginField.decorations);this.pluginDecorationLength=e.length;return this.decorations=__spreadArray(__spreadArray(__spreadArray([],e,true),this.view.state.facet(decorations),true),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco],false)};t.prototype.scrollIntoView=function(e){var t=e.range;var r=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),n;if(!r)return;if(!t.empty&&(n=this.coordsAt(t.anchor,t.anchor>t.head?-1:1)))r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)};var i=0,o=0,a=0,s=0;for(var l=0,c=this.view.pluginField(PluginField.scrollMargins);l<c.length;l++){var u=c[l];if(u){var f=u.left,h=u.right,d=u.top,p=u.bottom;if(f!=null)i=Math.max(i,f);if(h!=null)o=Math.max(o,h);if(d!=null)a=Math.max(a,d);if(p!=null)s=Math.max(s,p)}}var g={left:r.left-i,top:r.top-a,right:r.right+o,bottom:r.bottom+s};scrollRectIntoView(this.view.scrollDOM,g,t.head<t.anchor?-1:1,e.x,e.y,e.xMargin,e.yMargin,this.view.textDirection==Direction.LTR)};return t}(ContentView);function betweenUneditable(e){return e.node.nodeType==1&&e.node.firstChild&&(e.offset==0||e.node.childNodes[e.offset-1].contentEditable=="false")&&(e.offset==e.node.childNodes.length||e.node.childNodes[e.offset].contentEditable=="false")}var BlockGapWidget=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.height=t;return r}t.prototype.toDOM=function(){var e=document.createElement("div");this.updateDOM(e);return e};t.prototype.eq=function(e){return e.height==this.height};t.prototype.updateDOM=function(e){e.style.height=this.height+"px";return true};Object.defineProperty(t.prototype,"estimatedHeight",{get:function(){return this.height},enumerable:false,configurable:true});return t}(WidgetType);function compositionSurroundingNode(e){var t=e.observer.selectionRange;var r=t.focusNode&&nearbyTextNode(t.focusNode,t.focusOffset,0);if(!r)return null;var n=e.docView.nearest(r);if(!n)return null;if(n instanceof LineView){var i=r;while(i.parentNode!=n.dom)i=i.parentNode;var o=i.previousSibling;while(o&&!ContentView.get(o))o=o.previousSibling;var a=o?ContentView.get(o).posAtEnd:n.posAtStart;return{from:a,to:a,node:i,text:r}}else{for(;;){var s=n.parent;if(!s)return null;if(s instanceof LineView)break;n=s}var l=n.posAtStart;return{from:l,to:l+n.length,node:n.dom,text:r}}}function computeCompositionDeco(e,t){var r=compositionSurroundingNode(e);if(!r)return Decoration.none;var n=r.from,i=r.to,o=r.node,a=r.text;var s=t.mapPos(n,1),l=Math.max(s,t.mapPos(i,-1));var c=e.state,u=o.nodeType==3?o.nodeValue:new DOMReader([],c).readRange(o.firstChild,null).text;if(l-s<u.length){if(c.doc.sliceString(s,Math.min(c.doc.length,s+u.length),LineBreakPlaceholder)==u)l=s+u.length;else if(c.doc.sliceString(Math.max(0,l-u.length),l,LineBreakPlaceholder)==u)s=l-u.length;else return Decoration.none}else if(c.doc.sliceString(s,l,LineBreakPlaceholder)!=u){return Decoration.none}var f=ContentView.get(o);if(f instanceof CompositionView)f=f.widget.topView;else if(f)f.parent=null;return Decoration.set(Decoration.replace({widget:new CompositionWidget(o,a,f)}).range(s,l))}var CompositionWidget=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this)||this;i.top=t;i.text=r;i.topView=n;return i}t.prototype.eq=function(e){return this.top==e.top&&this.text==e.text};t.prototype.toDOM=function(){return this.top};t.prototype.ignoreEvent=function(){return false};Object.defineProperty(t.prototype,"customView",{get:function(){return CompositionView},enumerable:false,configurable:true});return t}(WidgetType);function nearbyTextNode(e,t,r){for(;;){if(e.nodeType==3)return e;if(e.nodeType==1&&t>0&&r<=0){e=e.childNodes[t-1];t=maxOffset(e)}else if(e.nodeType==1&&t<e.childNodes.length&&r>=0){e=e.childNodes[t];t=0}else{return null}}}function nextToUneditable(e,t){if(e.nodeType!=1)return 0;return(t&&e.childNodes[t-1].contentEditable=="false"?1:0)|(t<e.childNodes.length&&e.childNodes[t].contentEditable=="false"?2:0)}var DecorationComparator$1=function(){function e(){this.changes=[]}e.prototype.compareRange=function(e,t){addRange(e,t,this.changes)};e.prototype.comparePoint=function(e,t){addRange(e,t,this.changes)};return e}();function findChangedDeco(e,t,r){var n=new DecorationComparator$1;RangeSet.compare(e,t,r,n);return n.changes}function inUneditable(e,t){for(var r=e;r&&r!=t;r=r.assignedSlot||r.parentNode){if(r.nodeType==1&&r.contentEditable=="false"){return true}}return false}function groupAt(e,t,r){if(r===void 0){r=1}var n=e.charCategorizer(t);var i=e.doc.lineAt(t),o=t-i.from;if(i.length==0)return EditorSelection.cursor(t);if(o==0)r=1;else if(o==i.length)r=-1;var a=o,s=o;if(r<0)a=findClusterBreak(i.text,o,false);else s=findClusterBreak(i.text,o);var l=n(i.text.slice(a,s));while(a>0){var c=findClusterBreak(i.text,a,false);if(n(i.text.slice(c,a))!=l)break;a=c}while(s<i.length){var u=findClusterBreak(i.text,s);if(n(i.text.slice(s,u))!=l)break;s=u}return EditorSelection.range(a+i.from,s+i.from)}function getdx(e,t){return t.left>e?t.left-e:Math.max(0,e-t.right)}function getdy(e,t){return t.top>e?t.top-e:Math.max(0,e-t.bottom)}function yOverlap(e,t){return e.top<t.bottom-1&&e.bottom>t.top+1}function upTop(e,t){return t<e.top?{top:t,left:e.left,right:e.right,bottom:e.bottom}:e}function upBot(e,t){return t>e.bottom?{top:e.top,left:e.left,right:e.right,bottom:t}:e}function domPosAtCoords(e,t,r){var n,i,o,a;var s,l,c,u;for(var f=e.firstChild;f;f=f.nextSibling){var h=clientRectsFor(f);for(var d=0;d<h.length;d++){var p=h[d];if(i&&yOverlap(i,p))p=upTop(upBot(p,i.bottom),i.top);var g=getdx(t,p),v=getdy(r,p);if(g==0&&v==0)return f.nodeType==3?domPosInText(f,t,r):domPosAtCoords(f,t,r);if(!n||a>v||a==v&&o>g){n=f;i=p;o=g;a=v}if(g==0){if(r>p.bottom&&(!c||c.bottom<p.bottom)){s=f;c=p}else if(r<p.top&&(!u||u.top>p.top)){l=f;u=p}}else if(c&&yOverlap(c,p)){c=upBot(c,p.bottom)}else if(u&&yOverlap(u,p)){u=upTop(u,p.top)}}}if(c&&c.bottom>=r){n=s;i=c}else if(u&&u.top<=r){n=l;i=u}if(!n)return{node:e,offset:0};var m=Math.max(i.left,Math.min(i.right,t));if(n.nodeType==3)return domPosInText(n,m,r);if(!o&&n.contentEditable=="true")return domPosAtCoords(n,m,r);var y=Array.prototype.indexOf.call(e.childNodes,n)+(t>=(i.left+i.right)/2?1:0);return{node:e,offset:y}}function domPosInText(e,t,r){var n=e.nodeValue.length;var i=-1,o=1e9,a=0;for(var s=0;s<n;s++){var l=textRange(e,s,s+1).getClientRects();for(var c=0;c<l.length;c++){var u=l[c];if(u.top==u.bottom)continue;if(!a)a=t-u.left;var f=(u.top>r?u.top-r:r-u.bottom)-1;if(u.left-1<=t&&u.right+1>=t&&f<o){var h=t>=(u.left+u.right)/2,d=h;if(browser.chrome||browser.gecko){var p=textRange(e,s).getBoundingClientRect();if(p.left==u.right)d=!h}if(f<=0)return{node:e,offset:s+(d?1:0)};i=s+(d?1:0);o=f}}}return{node:e,offset:i>-1?i:a>0?e.nodeValue.length:0}}function posAtCoords(e,t,r,n){var i;var o=t.x,a=t.y;if(n===void 0){n=-1}var s;var l=e.contentDOM.getBoundingClientRect(),c=l.top+e.viewState.paddingTop;var u,f=e.viewState.docHeight;var h=a-c;if(h<0)return 0;if(h>f)return e.state.doc.length;for(var d=e.defaultLineHeight/2,p=false;;){u=e.elementAtHeight(h);if(u.type==BlockType.Text)break;for(;;){h=n>0?u.bottom+d:u.top-d;if(h>=0&&h<=f)break;if(p)return r?null:0;p=true;n=-n}}a=c+h;var g=u.from;if(g<e.viewport.from)return e.viewport.from==0?0:r?null:posAtCoordsImprecise(e,l,u,o,a);if(g>e.viewport.to)return e.viewport.to==e.state.doc.length?e.state.doc.length:r?null:posAtCoordsImprecise(e,l,u,o,a);var v=e.dom.ownerDocument;var m=e.root.elementFromPoint?e.root:v;var y=m.elementFromPoint(o,a);if(y&&!e.contentDOM.contains(y))y=null;if(!y){o=Math.max(l.left+1,Math.min(l.right-1,o));y=m.elementFromPoint(o,a);if(y&&!e.contentDOM.contains(y))y=null}var b,w=-1;if(y&&((s=e.docView.nearest(y))===null||s===void 0?void 0:s.isEditable)!=false){if(v.caretPositionFromPoint){var x=v.caretPositionFromPoint(o,a);if(x)b=x.offsetNode,w=x.offset}else if(v.caretRangeFromPoint){var S=v.caretRangeFromPoint(o,a);if(S){b=S.startContainer,w=S.startOffset;if(browser.safari&&isSuspiciousCaretResult(b,w,o))b=undefined}}}if(!b||!e.docView.dom.contains(b)){var k=LineView.find(e.docView,g);if(!k)return h>u.top+u.height/2?u.to:u.from;i=domPosAtCoords(k.dom,o,a),b=i.node,w=i.offset}return e.docView.posFromDOM(b,w)}function posAtCoordsImprecise(e,t,r,n,i){var o=Math.round((n-t.left)*e.defaultCharacterWidth);if(e.lineWrapping&&r.height>e.defaultLineHeight*1.5){var a=Math.floor((i-r.top)/e.defaultLineHeight);o+=a*e.viewState.heightOracle.lineLength}var s=e.state.sliceDoc(r.from,r.to);return r.from+findColumn(s,o,e.state.tabSize)}function isSuspiciousCaretResult(e,t,r){var n;if(e.nodeType!=3||t!=(n=e.nodeValue.length))return false;for(var i=e.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return false;return textRange(e,n-1,n).getBoundingClientRect().left>r}function moveToLineBoundary(e,t,r,n){var i=e.state.doc.lineAt(t.head);var o=!n||!e.lineWrapping?null:e.coordsAtPos(t.assoc<0&&t.head>i.from?t.head-1:t.head);if(o){var a=e.dom.getBoundingClientRect();var s=e.posAtCoords({x:r==(e.textDirection==Direction.LTR)?a.right-1:a.left+1,y:(o.top+o.bottom)/2});if(s!=null)return EditorSelection.cursor(s,r?-1:1)}var l=LineView.find(e.docView,t.head);var c=l?r?l.posAtEnd:l.posAtStart:r?i.to:i.from;return EditorSelection.cursor(c,r?-1:1)}function moveByChar(e,t,r,n){var i=e.state.doc.lineAt(t.head),o=e.bidiSpans(i);for(var a=t,s=null;;){var l=moveVisually(i,o,e.textDirection,a,r),c=movedOver;if(!l){if(i.number==(r?e.state.doc.lines:1))return a;c="\n";i=e.state.doc.line(i.number+(r?1:-1));o=e.bidiSpans(i);l=EditorSelection.cursor(r?i.from:i.to)}if(!s){if(!n)return l;s=n(c)}else if(!s(c)){return a}a=l}}function byGroup(e,t,r){var n=e.state.charCategorizer(t);var i=n(r);return function(e){var t=n(e);if(i==CharCategory.Space)i=t;return i==t}}function moveVertically(e,t,r,n){var i=t.head,o=r?1:-1;if(i==(r?e.state.doc.length:0))return EditorSelection.cursor(i,t.assoc);var a=t.goalColumn,s;var l=e.contentDOM.getBoundingClientRect();var c=e.coordsAtPos(i),u=e.documentTop;if(c){if(a==null)a=c.left-l.left;s=o<0?c.top:c.bottom}else{var f=e.viewState.lineBlockAt(i-u);if(a==null)a=Math.min(l.right-l.left,e.defaultCharacterWidth*(i-f.from));s=(o<0?f.top:f.bottom)+u}var h=l.left+a;var d=n!==null&&n!==void 0?n:e.defaultLineHeight>>1;for(var p=0;;p+=10){var g=s+(d+p)*o;var v=posAtCoords(e,{x:h,y:g},false,o);if(g<l.top||g>l.bottom||(o<0?v<i:v>i))return EditorSelection.cursor(v,t.assoc,undefined,a)}}function skipAtoms(e,t,r){var n=e.pluginField(PluginField.atomicRanges);var i=function(){var e=false;for(var i=0,o=n;i<o.length;i++){var a=o[i];a.between(r.from-1,r.from+1,(function(n,i,o){if(r.from>n&&r.from<i){r=t.from>r.from?EditorSelection.cursor(n,1):EditorSelection.cursor(i,-1);e=true}}))}if(!e)return{value:r}};for(;;){var o=i();if(typeof o==="object")return o.value}}var InputState=function(){function e(e){var t=this;this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=undefined;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var r=function(r){var i=handlers[r];e.contentDOM.addEventListener(r,(function(n){if(!eventBelongsToEditor(e,n)||t.ignoreDuringComposition(n))return;if(r=="keydown"&&t.keydown(e,n))return;if(t.mustFlushObserver(n))e.observer.forceFlush();if(t.runCustomHandlers(r,e,n))n.preventDefault();else i(e,n)}));n.registeredEvents.push(r)};var n=this;for(var i in handlers){r(i)}this.notifiedFocused=e.hasFocus;this.ensureHandlers(e);if(browser.safari)e.contentDOM.addEventListener("input",(function(){return null}))}e.prototype.setSelectionOrigin=function(e){this.lastSelectionOrigin=e;this.lastSelectionTime=Date.now()};e.prototype.ensureHandlers=function(e){var t=this;var r=this.customHandlers=e.pluginField(domEventHandlers);for(var n=0,i=r;n<i.length;n++){var o=i[n];var a=function(r){if(s.registeredEvents.indexOf(r)<0&&r!="scroll"){s.registeredEvents.push(r);e.contentDOM.addEventListener(r,(function(n){if(!eventBelongsToEditor(e,n))return;if(t.runCustomHandlers(r,e,n))n.preventDefault()}))}};var s=this;for(var l in o.handlers){a(l)}}};e.prototype.runCustomHandlers=function(e,t,r){for(var n=0,i=this.customHandlers;n<i.length;n++){var o=i[n];var a=o.handlers[e];if(a){try{if(a.call(o.plugin,r,t)||r.defaultPrevented)return true}catch(s){logException(t.state,s)}}}return false};e.prototype.runScrollHandlers=function(e,t){for(var r=0,n=this.customHandlers;r<n.length;r++){var i=n[r];var o=i.handlers.scroll;if(o){try{o.call(i.plugin,t,e)}catch(a){logException(e.state,a)}}}};e.prototype.keydown=function(e,t){var r=this;this.lastKeyCode=t.keyCode;this.lastKeyTime=Date.now();if(t.keyCode==9&&Date.now()<this.lastEscPress+2e3)return true;if(browser.android&&browser.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8)){e.observer.delayAndroidKey(t.key,t.keyCode);return true}var n;if(browser.ios&&(n=PendingKeys.find((function(e){return e.keyCode==t.keyCode})))&&!(t.ctrlKey||t.altKey||t.metaKey)&&!t.synthetic){this.pendingIOSKey=n;setTimeout((function(){return r.flushIOSKey(e)}),250);return true}return false};e.prototype.flushIOSKey=function(e){var t=this.pendingIOSKey;if(!t)return false;this.pendingIOSKey=undefined;return dispatchKey(e.contentDOM,t.key,t.keyCode)};e.prototype.ignoreDuringComposition=function(e){if(!/^key/.test(e.type))return false;if(this.composing>0)return true;if(browser.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true}return false};e.prototype.mustFlushObserver=function(e){return e.type=="keydown"&&e.keyCode!=229||e.type=="compositionend"&&!browser.ios};e.prototype.startMouseSelection=function(e){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=e};e.prototype.update=function(e){if(this.mouseSelection)this.mouseSelection.update(e);if(e.transactions.length)this.lastKeyCode=this.lastSelectionTime=0};e.prototype.destroy=function(){if(this.mouseSelection)this.mouseSelection.destroy()};return e}();var PendingKeys=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var modifierCodes=[16,17,18,20,91,92,224,225];var MouseSelection=function(){function e(e,t,r,n){this.view=e;this.style=r;this.mustSelect=n;this.lastEvent=t;var i=e.contentDOM.ownerDocument;i.addEventListener("mousemove",this.move=this.move.bind(this));i.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=t.shiftKey;this.multiple=e.state.facet(EditorState.allowMultipleSelections)&&addsSelectionRange(e,t);this.dragMove=dragMovesSelection(e,t);this.dragging=isInPrimarySelection(e,t)&&getClickType(t)==1?null:false;if(this.dragging===false){t.preventDefault();this.select(t)}}e.prototype.move=function(e){if(e.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=e)};e.prototype.up=function(e){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)e.preventDefault();this.destroy()};e.prototype.destroy=function(){var e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move);e.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null};e.prototype.select=function(e){var t=this.style.get(e,this.extend,this.multiple);if(this.mustSelect||!t.eq(this.view.state.selection)||t.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:t,userEvent:"select.pointer",scrollIntoView:true});this.mustSelect=false};e.prototype.update=function(e){var t=this;if(e.docChanged&&this.dragging)this.dragging=this.dragging.map(e.changes);if(this.style.update(e))setTimeout((function(){return t.select(t.lastEvent)}),20)};return e}();function addsSelectionRange(e,t){var r=e.state.facet(clickAddsSelectionRange);return r.length?r[0](t):browser.mac?t.metaKey:t.ctrlKey}function dragMovesSelection(e,t){var r=e.state.facet(dragMovesSelection$1);return r.length?r[0](t):browser.mac?!t.altKey:!t.ctrlKey}function isInPrimarySelection(e,t){var r=e.state.selection.main;if(r.empty)return false;var n=getSelection(e.root);if(n.rangeCount==0)return true;var i=n.getRangeAt(0).getClientRects();for(var o=0;o<i.length;o++){var a=i[o];if(a.left<=t.clientX&&a.right>=t.clientX&&a.top<=t.clientY&&a.bottom>=t.clientY)return true}return false}function eventBelongsToEditor(e,t){if(!t.bubbles)return true;if(t.defaultPrevented)return false;for(var r=t.target,n=void 0;r!=e.contentDOM;r=r.parentNode)if(!r||r.nodeType==11||(n=ContentView.get(r))&&n.ignoreEvent(t))return false;return true}var handlers=Object.create(null);var brokenClipboardAPI=browser.ie&&browser.ie_version<15||browser.ios&&browser.webkit_version<604;function capturePaste(e){var t=e.dom.parentNode;if(!t)return;var r=t.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px";r.focus();setTimeout((function(){e.focus();r.remove();doPaste(e,r.value)}),50)}function doPaste(e,t){var r=e.state,n,i=1,o=r.toText(t);var a=o.lines==r.selection.ranges.length;var s=lastLinewiseCopy!=null&&r.selection.ranges.every((function(e){return e.empty}))&&lastLinewiseCopy==o.toString();if(s){var l=-1;n=r.changeByRange((function(e){var n=r.doc.lineAt(e.from);if(n.from==l)return{range:e};l=n.from;var s=r.toText((a?o.line(i++).text:t)+r.lineBreak);return{changes:{from:n.from,insert:s},range:EditorSelection.cursor(e.from+s.length)}}))}else if(a){n=r.changeByRange((function(e){var t=o.line(i++);return{changes:{from:e.from,to:e.to,insert:t.text},range:EditorSelection.cursor(e.from+t.length)}}))}else{n=r.replaceSelection(o)}e.dispatch(n,{userEvent:"input.paste",scrollIntoView:true})}handlers.keydown=function(e,t){e.inputState.setSelectionOrigin("select");if(t.keyCode==27)e.inputState.lastEscPress=Date.now();else if(modifierCodes.indexOf(t.keyCode)<0)e.inputState.lastEscPress=0};var lastTouch=0;handlers.touchstart=function(e,t){lastTouch=Date.now();e.inputState.setSelectionOrigin("select.pointer")};handlers.touchmove=function(e){e.inputState.setSelectionOrigin("select.pointer")};handlers.mousedown=function(e,t){e.observer.flush();if(lastTouch>Date.now()-2e3&&getClickType(t)==1)return;var r=null;for(var n=0,i=e.state.facet(mouseSelectionStyle);n<i.length;n++){var o=i[n];r=o(e,t);if(r)break}if(!r&&t.button==0)r=basicMouseSelection(e,t);if(r){var a=e.root.activeElement!=e.contentDOM;if(a)e.observer.ignore((function(){return focusPreventScroll(e.contentDOM)}));e.inputState.startMouseSelection(new MouseSelection(e,t,r,a))}};function rangeForClick(e,t,r,n){if(n==1){return EditorSelection.cursor(t,r)}else if(n==2){return groupAt(e.state,t,r)}else{var i=LineView.find(e.docView,t),o=e.state.doc.lineAt(i?i.posAtEnd:t);var a=i?i.posAtStart:o.from,s=i?i.posAtEnd:o.to;if(s<e.state.doc.length&&s==o.to)s++;return EditorSelection.range(a,s)}}var insideY=function(e,t){return e>=t.top&&e<=t.bottom};var inside=function(e,t,r){return insideY(t,r)&&e>=r.left&&e<=r.right};function findPositionSide(e,t,r,n){var i=LineView.find(e.docView,t);if(!i)return 1;var o=t-i.posAtStart;if(o==0)return 1;if(o==i.length)return-1;var a=i.coordsAt(o,-1);if(a&&inside(r,n,a))return-1;var s=i.coordsAt(o,1);if(s&&inside(r,n,s))return 1;return a&&insideY(n,a)?-1:1}function queryPos(e,t){var r=e.posAtCoords({x:t.clientX,y:t.clientY},false);return{pos:r,bias:findPositionSide(e,r,t.clientX,t.clientY)}}var BadMouseDetail=browser.ie&&browser.ie_version<=11;var lastMouseDown=null,lastMouseDownCount=0,lastMouseDownTime=0;function getClickType(e){if(!BadMouseDetail)return e.detail;var t=lastMouseDown,r=lastMouseDownTime;lastMouseDown=e;lastMouseDownTime=Date.now();return lastMouseDownCount=!t||r>Date.now()-400&&Math.abs(t.clientX-e.clientX)<2&&Math.abs(t.clientY-e.clientY)<2?(lastMouseDownCount+1)%3:1}function basicMouseSelection(e,t){var r=queryPos(e,t),n=getClickType(t);var i=e.state.selection;var o=r,a=t;return{update:function(e){if(e.docChanged){if(r)r.pos=e.changes.mapPos(r.pos);i=i.map(e.changes);a=null}},get:function(t,s,l){var c;if(a&&t.clientX==a.clientX&&t.clientY==a.clientY)c=o;else{c=o=queryPos(e,t);a=t}if(!c||!r)return i;var u=rangeForClick(e,c.pos,c.bias,n);if(r.pos!=c.pos&&!s){var f=rangeForClick(e,r.pos,r.bias,n);var h=Math.min(f.from,u.from),d=Math.max(f.to,u.to);u=h<u.from?EditorSelection.range(h,d):EditorSelection.range(d,h)}if(s)return i.replaceRange(i.main.extend(u.from,u.to));else if(l)return i.addRange(u);else return EditorSelection.create([u])}}}handlers.dragstart=function(e,t){var r=e.state.selection.main;var n=e.inputState.mouseSelection;if(n)n.dragging=r;if(t.dataTransfer){t.dataTransfer.setData("Text",e.state.sliceDoc(r.from,r.to));t.dataTransfer.effectAllowed="copyMove"}};function dropText(e,t,r,n){if(!r)return;var i=e.posAtCoords({x:t.clientX,y:t.clientY},false);t.preventDefault();var o=e.inputState.mouseSelection;var a=n&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null;var s={from:i,insert:r};var l=e.state.changes(a?[a,s]:s);e.focus();e.dispatch({changes:l,selection:{anchor:l.mapPos(i,-1),head:l.mapPos(i,1)},userEvent:a?"move.drop":"input.drop"})}handlers.drop=function(e,t){if(!t.dataTransfer)return;if(e.state.readOnly)return t.preventDefault();var r=t.dataTransfer.files;if(r&&r.length){t.preventDefault();var n=Array(r.length),i=0;var o=function(){if(++i==r.length)dropText(e,t,n.filter((function(e){return e!=null})).join(e.state.lineBreak),false)};var a=function(e){var t=new FileReader;t.onerror=o;t.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(t.result))n[e]=t.result;o()};t.readAsText(r[e])};for(var s=0;s<r.length;s++){a(s)}}else{dropText(e,t,t.dataTransfer.getData("Text"),true)}};handlers.paste=function(e,t){if(e.state.readOnly)return t.preventDefault();e.observer.flush();var r=brokenClipboardAPI?null:t.clipboardData;if(r){doPaste(e,r.getData("text/plain"));t.preventDefault()}else{capturePaste(e)}};function captureCopy(e,t){var r=e.dom.parentNode;if(!r)return;var n=r.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px";n.value=t;n.focus();n.selectionEnd=t.length;n.selectionStart=0;setTimeout((function(){n.remove();e.focus()}),50)}function copiedRange(e){var t=[],r=[],n=false;for(var i=0,o=e.selection.ranges;i<o.length;i++){var a=o[i];if(!a.empty){t.push(e.sliceDoc(a.from,a.to));r.push(a)}}if(!t.length){var s=-1;for(var l=0,c=e.selection.ranges;l<c.length;l++){var u=c[l].from;var f=e.doc.lineAt(u);if(f.number>s){t.push(f.text);r.push({from:f.from,to:Math.min(e.doc.length,f.to+1)})}s=f.number}n=true}return{text:t.join(e.lineBreak),ranges:r,linewise:n}}var lastLinewiseCopy=null;handlers.copy=handlers.cut=function(e,t){var r=copiedRange(e.state),n=r.text,i=r.ranges,o=r.linewise;if(!n&&!o)return;lastLinewiseCopy=o?n:null;var a=brokenClipboardAPI?null:t.clipboardData;if(a){t.preventDefault();a.clearData();a.setData("text/plain",n)}else{captureCopy(e,n)}if(t.type=="cut"&&!e.state.readOnly)e.dispatch({changes:i,scrollIntoView:true,userEvent:"delete.cut"})};handlers.focus=handlers.blur=function(e){setTimeout((function(){if(e.hasFocus!=e.inputState.notifiedFocused)e.update([])}),10)};function forceClearComposition(e,t){if(e.docView.compositionDeco.size){e.inputState.rapidCompositionStart=t;try{e.update([])}finally{e.inputState.rapidCompositionStart=false}}}handlers.compositionstart=handlers.compositionupdate=function(e){if(e.inputState.compositionFirstChange==null)e.inputState.compositionFirstChange=true;if(e.inputState.composing<0){e.inputState.composing=0;if(e.docView.compositionDeco.size){e.observer.flush();forceClearComposition(e,true)}}};handlers.compositionend=function(e){e.inputState.composing=-1;e.inputState.compositionEndedAt=Date.now();e.inputState.compositionFirstChange=null;setTimeout((function(){if(e.inputState.composing<0)forceClearComposition(e,false)}),50)};handlers.contextmenu=function(e){e.inputState.lastContextMenu=Date.now()};handlers.beforeinput=function(e,t){var r;var n;if(browser.chrome&&browser.android&&(n=PendingKeys.find((function(e){return e.inputType==t.inputType})))){e.observer.delayAndroidKey(n.key,n.keyCode);if(n.key=="Backspace"||n.key=="Delete"){var i=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout((function(){var t;if((((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0)>i+10&&e.hasFocus){e.contentDOM.blur();e.focus()}}),100)}}};var wrappingWhiteSpace=["pre-wrap","normal","pre-line","break-spaces"];var HeightOracle=function(){function e(){this.doc=Text.empty;this.lineWrapping=false;this.direction=Direction.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false}e.prototype.heightForGap=function(e,t){var r=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;if(this.lineWrapping)r+=Math.ceil((t-e-r*this.lineLength*.5)/this.lineLength);return this.lineHeight*r};e.prototype.heightForLine=function(e){if(!this.lineWrapping)return this.lineHeight;var t=1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5)));return t*this.lineHeight};e.prototype.setDoc=function(e){this.doc=e;return this};e.prototype.mustRefreshForStyle=function(e,t){return wrappingWhiteSpace.indexOf(e)>-1!=this.lineWrapping||this.direction!=t};e.prototype.mustRefreshForHeights=function(e){var t=false;for(var r=0;r<e.length;r++){var n=e[r];if(n<0){r++}else if(!this.heightSamples[Math.floor(n*10)]){t=true;this.heightSamples[Math.floor(n*10)]=true}}return t};e.prototype.refresh=function(e,t,r,n,i,o){var a=wrappingWhiteSpace.indexOf(e)>-1;var s=Math.round(r)!=Math.round(this.lineHeight)||this.lineWrapping!=a||this.direction!=t;this.lineWrapping=a;this.direction=t;this.lineHeight=r;this.charWidth=n;this.lineLength=i;if(s){this.heightSamples={};for(var l=0;l<o.length;l++){var c=o[l];if(c<0)l++;else this.heightSamples[Math.floor(c*10)]=true}}return s};return e}();var MeasuredHeights=function(){function e(e,t){this.from=e;this.heights=t;this.index=0}Object.defineProperty(e.prototype,"more",{get:function(){return this.index<this.heights.length},enumerable:false,configurable:true});return e}();var BlockInfo=function(){function e(e,t,r,n,i){this.from=e;this.length=t;this.top=r;this.height=n;this.type=i}Object.defineProperty(e.prototype,"to",{get:function(){return this.from+this.length},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"bottom",{get:function(){return this.top+this.height},enumerable:false,configurable:true});e.prototype.join=function(t){var r=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(t.type)?t.type:[t]);return new e(this.from,this.length+t.length,this.top,this.height+t.height,r)};e.prototype.moveY=function(t){return!t?this:new e(this.from,this.length,this.top+t,this.height,Array.isArray(this.type)?this.type.map((function(e){return e.moveY(t)})):this.type)};return e}();var QueryType$1=function(e){e[e["ByPos"]=0]="ByPos";e[e["ByHeight"]=1]="ByHeight";e[e["ByPosNoHeight"]=2]="ByPosNoHeight";return e}(QueryType$1||(QueryType$1={}));var Epsilon=.001;var HeightMap=function(){function e(e,t,r){if(r===void 0){r=2}this.length=e;this.height=t;this.flags=r}Object.defineProperty(e.prototype,"outdated",{get:function(){return(this.flags&2)>0},set:function(e){this.flags=(e?2:0)|this.flags&~2},enumerable:false,configurable:true});e.prototype.setHeight=function(e,t){if(this.height!=t){if(Math.abs(this.height-t)>Epsilon)e.heightChanged=true;this.height=t}};e.prototype.replace=function(t,r,n){return e.of(n)};e.prototype.decomposeLeft=function(e,t){t.push(this)};e.prototype.decomposeRight=function(e,t){t.push(this)};e.prototype.applyChanges=function(e,t,r,n){var i=this;for(var o=n.length-1;o>=0;o--){var a=n[o],s=a.fromA,l=a.toA,c=a.fromB,u=a.toB;var f=i.lineAt(s,QueryType$1.ByPosNoHeight,t,0,0);var h=f.to>=l?f:i.lineAt(l,QueryType$1.ByPosNoHeight,t,0,0);u+=h.to-l;l=h.to;while(o>0&&f.from<=n[o-1].toA){s=n[o-1].fromA;c=n[o-1].fromB;o--;if(s<f.from)f=i.lineAt(s,QueryType$1.ByPosNoHeight,t,0,0)}c+=f.from-s;s=f.from;var d=NodeBuilder.build(r,e,c,u);i=i.replace(s,l,d)}return i.updateHeight(r,0)};e.empty=function(){return new HeightMapText(0,0)};e.of=function(t){if(t.length==1)return t[0];var r=0,n=t.length,i=0,o=0;for(;;){if(r==n){if(i>o*2){var a=t[r-1];if(a.break)t.splice(--r,1,a.left,null,a.right);else t.splice(--r,1,a.left,a.right);n+=1+a.break;i-=a.size}else if(o>i*2){var a=t[n];if(a.break)t.splice(n,1,a.left,null,a.right);else t.splice(n,1,a.left,a.right);n+=2+a.break;o-=a.size}else{break}}else if(i<o){var s=t[r++];if(s)i+=s.size}else{var s=t[--n];if(s)o+=s.size}}var l=0;if(t[r-1]==null){l=1;r--}else if(t[r]==null){l=1;n++}return new HeightMapBranch(e.of(t.slice(0,r)),l,e.of(t.slice(n)))};return e}();HeightMap.prototype.size=1;var HeightMapBlock=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this,t,r)||this;i.type=n;return i}t.prototype.blockAt=function(e,t,r,n){return new BlockInfo(n,this.length,r,this.height,this.type)};t.prototype.lineAt=function(e,t,r,n,i){return this.blockAt(0,r,n,i)};t.prototype.forEachLine=function(e,t,r,n,i,o){o(this.blockAt(0,r,n,i))};t.prototype.updateHeight=function(e,t,r,n){if(t===void 0){t=0}if(r===void 0){r=false}if(n&&n.from<=t&&n.more)this.setHeight(e,n.heights[n.index++]);this.outdated=false;return this};t.prototype.toString=function(){return"block(".concat(this.length,")")};return t}(HeightMap);var HeightMapText=function(e){__extends(t,e);function t(t,r){var n=e.call(this,t,r,BlockType.Text)||this;n.collapsed=0;n.widgetHeight=0;return n}t.prototype.replace=function(e,r,n){var i=n[0];if(n.length==1&&(i instanceof t||i instanceof HeightMapGap&&i.flags&4)&&Math.abs(this.length-i.length)<10){if(i instanceof HeightMapGap)i=new t(i.length,this.height);else i.height=this.height;if(!this.outdated)i.outdated=false;return i}else{return HeightMap.of(n)}};t.prototype.updateHeight=function(e,t,r,n){if(t===void 0){t=0}if(r===void 0){r=false}if(n&&n.from<=t&&n.more)this.setHeight(e,n.heights[n.index++]);else if(r||this.outdated)this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed)));this.outdated=false;return this};t.prototype.toString=function(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")")};return t}(HeightMapBlock);var HeightMapGap=function(e){__extends(t,e);function t(t){return e.call(this,t,0)||this}t.prototype.lines=function(e,t){var r=e.lineAt(t).number,n=e.lineAt(t+this.length).number;return{firstLine:r,lastLine:n,lineHeight:this.height/(n-r+1)}};t.prototype.blockAt=function(e,t,r,n){var i=this.lines(t,n),o=i.firstLine,a=i.lastLine,s=i.lineHeight;var l=Math.max(0,Math.min(a-o,Math.floor((e-r)/s)));var c=t.line(o+l),u=c.from,f=c.length;return new BlockInfo(u,f,r+s*l,s,BlockType.Text)};t.prototype.lineAt=function(e,t,r,n,i){if(t==QueryType$1.ByHeight)return this.blockAt(e,r,n,i);if(t==QueryType$1.ByPosNoHeight){var o=r.lineAt(e),a=o.from,s=o.to;return new BlockInfo(a,s-a,0,0,BlockType.Text)}var l=this.lines(r,i),c=l.firstLine,u=l.lineHeight;var f=r.lineAt(e),h=f.from,d=f.length,p=f.number;return new BlockInfo(h,d,n+u*(p-c),u,BlockType.Text)};t.prototype.forEachLine=function(e,t,r,n,i,o){var a=this.lines(r,i),s=a.firstLine,l=a.lineHeight;for(var c=Math.max(e,i),u=Math.min(i+this.length,t);c<=u;){var f=r.lineAt(c);if(c==e)n+=l*(f.number-s);o(new BlockInfo(f.from,f.length,n,l,BlockType.Text));n+=l;c=f.to+1}};t.prototype.replace=function(e,r,n){var i=this.length-r;if(i>0){var o=n[n.length-1];if(o instanceof t)n[n.length-1]=new t(o.length+i);else n.push(null,new t(i-1))}if(e>0){var a=n[0];if(a instanceof t)n[0]=new t(e+a.length);else n.unshift(new t(e-1),null)}return HeightMap.of(n)};t.prototype.decomposeLeft=function(e,r){r.push(new t(e-1),null)};t.prototype.decomposeRight=function(e,r){r.push(null,new t(this.length-e-1))};t.prototype.updateHeight=function(e,r,n,i){if(r===void 0){r=0}if(n===void 0){n=false}var o=r+this.length;if(i&&i.from<=r+this.length&&i.more){var a=[],s=Math.max(r,i.from),l=-1;var c=e.heightChanged;if(i.from>r)a.push(new t(i.from-r-1).updateHeight(e,r));while(s<=o&&i.more){var u=e.doc.lineAt(s).length;if(a.length)a.push(null);var f=i.heights[i.index++];if(l==-1)l=f;else if(Math.abs(f-l)>=Epsilon)l=-2;var h=new HeightMapText(u,f);h.outdated=false;a.push(h);s+=u+1}if(s<=o)a.push(null,new t(o-s).updateHeight(e,s));var d=HeightMap.of(a);e.heightChanged=c||l<0||Math.abs(d.height-this.height)>=Epsilon||Math.abs(l-this.lines(e.doc,r).lineHeight)>=Epsilon;return d}else if(n||this.outdated){this.setHeight(e,e.heightForGap(r,r+this.length));this.outdated=false}return this};t.prototype.toString=function(){return"gap(".concat(this.length,")")};return t}(HeightMap);var HeightMapBranch=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this,t.length+r+n.length,t.height+n.height,r|(t.outdated||n.outdated?2:0))||this;i.left=t;i.right=n;i.size=t.size+n.size;return i}Object.defineProperty(t.prototype,"break",{get:function(){return this.flags&1},enumerable:false,configurable:true});t.prototype.blockAt=function(e,t,r,n){var i=r+this.left.height;return e<i?this.left.blockAt(e,t,r,n):this.right.blockAt(e,t,i,n+this.left.length+this.break)};t.prototype.lineAt=function(e,t,r,n,i){var o=n+this.left.height,a=i+this.left.length+this.break;var s=t==QueryType$1.ByHeight?e<o:e<a;var l=s?this.left.lineAt(e,t,r,n,i):this.right.lineAt(e,t,r,o,a);if(this.break||(s?l.to<a:l.from>a))return l;var c=t==QueryType$1.ByPosNoHeight?QueryType$1.ByPosNoHeight:QueryType$1.ByPos;if(s)return l.join(this.right.lineAt(a,c,r,o,a));else return this.left.lineAt(a,c,r,n,i).join(l)};t.prototype.forEachLine=function(e,t,r,n,i,o){var a=n+this.left.height,s=i+this.left.length+this.break;if(this.break){if(e<s)this.left.forEachLine(e,t,r,n,i,o);if(t>=s)this.right.forEachLine(e,t,r,a,s,o)}else{var l=this.lineAt(s,QueryType$1.ByPos,r,n,i);if(e<l.from)this.left.forEachLine(e,l.from-1,r,n,i,o);if(l.to>=e&&l.from<=t)o(l);if(t>l.to)this.right.forEachLine(l.to+1,t,r,a,s,o)}};t.prototype.replace=function(e,t,r){var n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,r));var i=[];if(e>0)this.decomposeLeft(e,i);var o=i.length;for(var a=0,s=r;a<s.length;a++){var l=s[a];i.push(l)}if(e>0)mergeGaps(i,o-1);if(t<this.length){var c=i.length;this.decomposeRight(t,i);mergeGaps(i,c)}return HeightMap.of(i)};t.prototype.decomposeLeft=function(e,t){var r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,t);t.push(this.left);if(this.break){r++;if(e>=r)t.push(null)}if(e>r)this.right.decomposeLeft(e-r,t)};t.prototype.decomposeRight=function(e,t){var r=this.left.length,n=r+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);if(e<r)this.left.decomposeRight(e,t);if(this.break&&e<n)t.push(null);t.push(this.right)};t.prototype.balanced=function(e,t){if(e.size>2*t.size||t.size>2*e.size)return HeightMap.of(this.break?[e,null,t]:[e,t]);this.left=e;this.right=t;this.height=e.height+t.height;this.outdated=e.outdated||t.outdated;this.size=e.size+t.size;this.length=e.length+this.break+t.length;return this};t.prototype.updateHeight=function(e,t,r,n){if(t===void 0){t=0}if(r===void 0){r=false}var i=this,o=i.left,a=i.right,s=t+o.length+this.break,l=null;if(n&&n.from<=t+o.length&&n.more)l=o=o.updateHeight(e,t,r,n);else o.updateHeight(e,t,r);if(n&&n.from<=s+a.length&&n.more)l=a=a.updateHeight(e,s,r,n);else a.updateHeight(e,s,r);if(l)return this.balanced(o,a);this.height=this.left.height+this.right.height;this.outdated=false;return this};t.prototype.toString=function(){return this.left+(this.break?" ":"-")+this.right};return t}(HeightMap);function mergeGaps(e,t){var r,n;if(e[t]==null&&(r=e[t-1])instanceof HeightMapGap&&(n=e[t+1])instanceof HeightMapGap)e.splice(t-1,3,new HeightMapGap(r.length+1+n.length))}var relevantWidgetHeight=5;var NodeBuilder=function(){function e(e,t){this.pos=e;this.oracle=t;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=e}Object.defineProperty(e.prototype,"isCovered",{get:function(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering},enumerable:false,configurable:true});e.prototype.span=function(e,t){if(this.lineStart>-1){var r=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];if(n instanceof HeightMapText)n.length+=r-this.pos;else if(r>this.pos||!this.isCovered)this.nodes.push(new HeightMapText(r-this.pos,-1));this.writtenTo=r;if(t>r){this.nodes.push(null);this.writtenTo++;this.lineStart=-1}}this.pos=t};e.prototype.point=function(e,t,r){if(e<t||r.heightRelevant){var n=r.widget?r.widget.estimatedHeight:0;if(n<0)n=this.oracle.lineHeight;var i=t-e;if(r.block){this.addBlock(new HeightMapBlock(i,n,r.type))}else if(i||n>=relevantWidgetHeight){this.addLineDeco(n,i)}}else if(t>e){this.span(e,t)}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to};e.prototype.enterLine=function(){if(this.lineStart>-1)return;var e=this.oracle.doc.lineAt(this.pos),t=e.from,r=e.to;this.lineStart=t;this.lineEnd=r;if(this.writtenTo<t){if(this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,t-1));this.nodes.push(null)}if(this.pos>t)this.nodes.push(new HeightMapText(this.pos-t,-1));this.writtenTo=this.pos};e.prototype.blankContent=function(e,t){var r=new HeightMapGap(t-e);if(this.oracle.doc.lineAt(e).to==t)r.flags|=4;return r};e.prototype.ensureLine=function(){this.enterLine();var e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof HeightMapText)return e;var t=new HeightMapText(0,-1);this.nodes.push(t);return t};e.prototype.addBlock=function(e){this.enterLine();if(e.type==BlockType.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(e);this.writtenTo=this.pos=this.pos+e.length;if(e.type!=BlockType.WidgetBefore)this.covering=e};e.prototype.addLineDeco=function(e,t){var r=this.ensureLine();r.length+=t;r.collapsed+=t;r.widgetHeight=Math.max(r.widgetHeight,e);this.writtenTo=this.pos=this.pos+t};e.prototype.finish=function(e){var t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(t instanceof HeightMapText)&&!this.isCovered)this.nodes.push(new HeightMapText(0,-1));else if(this.writtenTo<this.pos||t==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var r=e;for(var n=0,i=this.nodes;n<i.length;n++){var o=i[n];if(o instanceof HeightMapText)o.updateHeight(this.oracle,r);r+=o?o.length:1}return this.nodes};e.build=function(t,r,n,i){var o=new e(n,t);RangeSet.spans(r,n,i,o,0);return o.finish(n)};return e}();function heightRelevantDecoChanges(e,t,r){var n=new DecorationComparator;RangeSet.compare(e,t,r,n,0);return n.changes}var DecorationComparator=function(){function e(){this.changes=[]}e.prototype.compareRange=function(){};e.prototype.comparePoint=function(e,t,r,n){if(e<t||r&&r.heightRelevant||n&&n.heightRelevant)addRange(e,t,this.changes,5)};return e}();function visiblePixelRange(e,t){var r=e.getBoundingClientRect();var n=Math.max(0,r.left),i=Math.min(innerWidth,r.right);var o=Math.max(0,r.top),a=Math.min(innerHeight,r.bottom);var s=e.ownerDocument.body;for(var l=e.parentNode;l&&l!=s;){if(l.nodeType==1){var c=l;var u=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&u.overflow!="visible"){var f=c.getBoundingClientRect();n=Math.max(n,f.left);i=Math.min(i,f.right);o=Math.max(o,f.top);a=Math.min(a,f.bottom)}l=u.position=="absolute"||u.position=="fixed"?c.offsetParent:c.parentNode}else if(l.nodeType==11){l=l.host}else{break}}return{left:n-r.left,right:Math.max(n,i)-r.left,top:o-(r.top+t),bottom:Math.max(o,a)-(r.top+t)}}function fullPixelRange(e,t){var r=e.getBoundingClientRect();return{left:0,right:r.right-r.left,top:t,bottom:r.bottom-(r.top+t)}}var LineGap=function(){function e(e,t,r){this.from=e;this.to=t;this.size=r}e.same=function(e,t){if(e.length!=t.length)return false;for(var r=0;r<e.length;r++){var n=e[r],i=t[r];if(n.from!=i.from||n.to!=i.to||n.size!=i.size)return false}return true};e.prototype.draw=function(e){return Decoration.replace({widget:new LineGapWidget(this.size,e)}).range(this.from,this.to)};return e}();var LineGapWidget=function(e){__extends(t,e);function t(t,r){var n=e.call(this)||this;n.size=t;n.vertical=r;return n}t.prototype.eq=function(e){return e.size==this.size&&e.vertical==this.vertical};t.prototype.toDOM=function(){var e=document.createElement("div");if(this.vertical){e.style.height=this.size+"px"}else{e.style.width=this.size+"px";e.style.height="2px";e.style.display="inline-block"}return e};Object.defineProperty(t.prototype,"estimatedHeight",{get:function(){return this.vertical?this.size:-1},enumerable:false,configurable:true});return t}(WidgetType);var ViewState=function(){function e(e){this.state=e;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.heightOracle=new HeightOracle;this.scaler=IdScaler;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=HeightMap.empty().applyChanges(e.facet(decorations),Text.empty,this.heightOracle.setDoc(e.doc),[new ChangedRange(0,0,0,e.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Decoration.set(this.lineGaps.map((function(e){return e.draw(false)})));this.computeVisibleRanges()}e.prototype.updateForViewport=function(){var e=[this.viewport],t=this.state.selection.main;var r=function(r){var i=r?t.head:t.anchor;if(!e.some((function(e){var t=e.from,r=e.to;return i>=t&&i<=r}))){var o=n.lineBlockAt(i),a=o.from,s=o.to;e.push(new Viewport(a,s))}};var n=this;for(var i=0;i<=1;i++){r(i)}this.viewports=e.sort((function(e,t){return e.from-t.from}));this.scaler=this.heightMap.height<=7e6?IdScaler:new BigScaler(this.heightOracle.doc,this.heightMap,this.viewports)};e.prototype.updateViewportLines=function(){var e=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(function(t){e.viewportLines.push(e.scaler.scale==1?t:scaleBlock(t,e.scaler))}))};e.prototype.update=function(e,t){if(t===void 0){t=null}var r=this.state;this.state=e.state;var n=this.state.facet(decorations);var i=e.changedRanges;var o=ChangedRange.extendWithRanges(i,heightRelevantDecoChanges(e.startState.facet(decorations),n,e?e.changes:ChangeSet.empty(this.state.doc.length)));var a=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,r.doc,this.heightOracle.setDoc(this.state.doc),o);if(this.heightMap.height!=a)e.flags|=2;var s=o.length?this.mapViewport(this.viewport,e.changes):this.viewport;if(t&&(t.range.head<s.from||t.range.head>s.to)||!this.viewportIsAppropriate(s))s=this.getViewport(0,t);var l=!e.changes.empty||e.flags&2||s.from!=this.viewport.from||s.to!=this.viewport.to;this.viewport=s;this.updateForViewport();if(l)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes)));e.flags|=this.computeVisibleRanges();if(t)this.scrollTarget=t;if(!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc)this.mustEnforceCursorAssoc=true};e.prototype.measure=function(e){var t=e.contentDOM,r=window.getComputedStyle(t);var n=this.heightOracle;var i=r.whiteSpace,o=r.direction=="rtl"?Direction.RTL:Direction.LTR;var a=this.heightOracle.mustRefreshForStyle(i,o);var s=a||this.mustMeasureContent||this.contentDOMHeight!=t.clientHeight;var l=0,c=0;if(this.editorWidth!=e.scrollDOM.clientWidth){if(n.lineWrapping)s=true;this.editorWidth=e.scrollDOM.clientWidth;l|=8}if(s){this.mustMeasureContent=false;this.contentDOMHeight=t.clientHeight;var u=parseInt(r.paddingTop)||0,f=parseInt(r.paddingBottom)||0;if(this.paddingTop!=u||this.paddingBottom!=f){l|=8;this.paddingTop=u;this.paddingBottom=f}}var h=(this.printing?fullPixelRange:visiblePixelRange)(t,this.paddingTop);var d=h.top-this.pixelViewport.top,p=h.bottom-this.pixelViewport.bottom;this.pixelViewport=h;var g=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(g!=this.inView){this.inView=g;if(g)s=true}if(!this.inView)return 0;var v=t.clientWidth;if(this.contentDOMWidth!=v||this.editorHeight!=e.scrollDOM.clientHeight){this.contentDOMWidth=v;this.editorHeight=e.scrollDOM.clientHeight;l|=8}if(s){var m=e.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(m))a=true;if(a||n.lineWrapping&&Math.abs(v-this.contentDOMWidth)>n.charWidth){var y=e.docView.measureTextSize(),b=y.lineHeight,w=y.charWidth;a=n.refresh(i,o,b,w,v/w,m);if(a){e.docView.minWidth=0;l|=8}}if(d>0&&p>0)c=Math.max(d,p);else if(d<0&&p<0)c=Math.min(d,p);n.heightChanged=false;this.heightMap=this.heightMap.updateHeight(n,0,a,new MeasuredHeights(this.viewport.from,m));if(n.heightChanged)l|=2}var x=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(x)this.viewport=this.getViewport(c,this.scrollTarget);this.updateForViewport();if(l&2||x)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps));l|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;e.docView.enforceCursorAssoc()}return l};Object.defineProperty(e.prototype,"visibleTop",{get:function(){return this.scaler.fromDOM(this.pixelViewport.top)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"visibleBottom",{get:function(){return this.scaler.fromDOM(this.pixelViewport.bottom)},enumerable:false,configurable:true});e.prototype.getViewport=function(e,t){var r=.5-Math.max(-.5,Math.min(.5,e/1e3/2));var n=this.heightMap,i=this.state.doc,o=this,a=o.visibleTop,s=o.visibleBottom;var l=new Viewport(n.lineAt(a-r*1e3,QueryType$1.ByHeight,i,0,0).from,n.lineAt(s+(1-r)*1e3,QueryType$1.ByHeight,i,0,0).to);if(t){var c=t.range.head;if(c<l.from||c>l.to){var u=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top);var f=n.lineAt(c,QueryType$1.ByPos,i,0,0),h=void 0;if(t.y=="center")h=(f.top+f.bottom)/2-u/2;else if(t.y=="start"||t.y=="nearest"&&c<l.from)h=f.top;else h=f.bottom-u;l=new Viewport(n.lineAt(h-1e3/2,QueryType$1.ByHeight,i,0,0).from,n.lineAt(h+u+1e3/2,QueryType$1.ByHeight,i,0,0).to)}}return l};e.prototype.mapViewport=function(e,t){var r=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new Viewport(this.heightMap.lineAt(r,QueryType$1.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,QueryType$1.ByPos,this.state.doc,0,0).to)};e.prototype.viewportIsAppropriate=function(e,t){var r=e.from,n=e.to;if(t===void 0){t=0}if(!this.inView)return true;var i=this.heightMap.lineAt(r,QueryType$1.ByPos,this.state.doc,0,0).top;var o=this.heightMap.lineAt(n,QueryType$1.ByPos,this.state.doc,0,0).bottom;var a=this,s=a.visibleTop,l=a.visibleBottom;return(r==0||i<=s-Math.max(10,Math.min(-t,250)))&&(n==this.state.doc.length||o>=l+Math.max(10,Math.min(t,250)))&&(i>s-2*1e3&&o<l+2*1e3)};e.prototype.mapLineGaps=function(e,t){if(!e.length||t.empty)return e;var r=[];for(var n=0,i=e;n<i.length;n++){var o=i[n];if(!t.touchesRange(o.from,o.to))r.push(new LineGap(t.mapPos(o.from),t.mapPos(o.to),o.size))}return r};e.prototype.ensureLineGaps=function(e){var t=[];if(this.heightOracle.direction!=Direction.LTR)return t;var r=function(r){if(r.length<4e3)return"continue";var i=lineStructure(r.from,r.to,n.state);if(i.total<4e3)return"continue";var o=void 0,a=void 0;if(n.heightOracle.lineWrapping){var s=2e3/n.heightOracle.lineLength*n.heightOracle.lineHeight;o=findPosition(i,(n.visibleTop-r.top-s)/r.height);a=findPosition(i,(n.visibleBottom-r.top+s)/r.height)}else{var l=i.total*n.heightOracle.charWidth;var c=2e3*n.heightOracle.charWidth;o=findPosition(i,(n.pixelViewport.left-c)/l);a=findPosition(i,(n.pixelViewport.right+c)/l)}var u=[];if(o>r.from)u.push({from:r.from,to:o});if(a<r.to)u.push({from:a,to:r.to});var f=n.state.selection.main;if(f.from>=r.from&&f.from<=r.to)cutRange(u,f.from-10,f.from+10);if(!f.empty&&f.to>=r.from&&f.to<=r.to)cutRange(u,f.to-10,f.to+10);var h=function(o,a){if(a-o>1e3){t.push(find(e,(function(e){return e.from>=r.from&&e.to<=r.to&&Math.abs(e.from-o)<1e3&&Math.abs(e.to-a)<1e3}))||new LineGap(o,a,n.gapSize(r,o,a,i)))}};for(var d=0,p=u;d<p.length;d++){var g=p[d],v=g.from,m=g.to;h(v,m)}};var n=this;for(var i=0,o=this.viewportLines;i<o.length;i++){var a=o[i];r(a)}return t};e.prototype.gapSize=function(e,t,r,n){var i=findFraction(n,r)-findFraction(n,t);if(this.heightOracle.lineWrapping){return e.height*i}else{return n.total*this.heightOracle.charWidth*i}};e.prototype.updateLineGaps=function(e){var t=this;if(!LineGap.same(e,this.lineGaps)){this.lineGaps=e;this.lineGapDeco=Decoration.set(e.map((function(e){return e.draw(t.heightOracle.lineWrapping)})))}};e.prototype.computeVisibleRanges=function(){var e=this.state.facet(decorations);if(this.lineGaps.length)e=e.concat(this.lineGapDeco);var t=[];RangeSet.spans(e,this.viewport.from,this.viewport.to,{span:function(e,r){t.push({from:e,to:r})},point:function(){}},20);var r=t.length!=this.visibleRanges.length||this.visibleRanges.some((function(e,r){return e.from!=t[r].from||e.to!=t[r].to}));this.visibleRanges=t;return r?4:0};e.prototype.lineBlockAt=function(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find((function(t){return t.from<=e&&t.to>=e}))||scaleBlock(this.heightMap.lineAt(e,QueryType$1.ByPos,this.state.doc,0,0),this.scaler)};e.prototype.lineBlockAtHeight=function(e){return scaleBlock(this.heightMap.lineAt(this.scaler.fromDOM(e),QueryType$1.ByHeight,this.state.doc,0,0),this.scaler)};e.prototype.elementAtHeight=function(e){return scaleBlock(this.heightMap.blockAt(this.scaler.fromDOM(e),this.state.doc,0,0),this.scaler)};Object.defineProperty(e.prototype,"docHeight",{get:function(){return this.scaler.toDOM(this.heightMap.height)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"contentHeight",{get:function(){return this.docHeight+this.paddingTop+this.paddingBottom},enumerable:false,configurable:true});return e}();var Viewport=function(){function e(e,t){this.from=e;this.to=t}return e}();function lineStructure(e,t,r){var n=[],i=e,o=0;RangeSet.spans(r.facet(decorations),e,t,{span:function(){},point:function(e,t){if(e>i){n.push({from:i,to:e});o+=e-i}i=t}},20);if(i<t){n.push({from:i,to:t});o+=t-i}return{total:o,ranges:n}}function findPosition(e,t){var r=e.total,n=e.ranges;if(t<=0)return n[0].from;if(t>=1)return n[n.length-1].to;var i=Math.floor(r*t);for(var o=0;;o++){var a=n[o],s=a.from,l=a.to,c=l-s;if(i<=c)return s+i;i-=c}}function findFraction(e,t){var r=0;for(var n=0,i=e.ranges;n<i.length;n++){var o=i[n],a=o.from,s=o.to;if(t<=s){r+=t-a;break}r+=s-a}return r/e.total}function cutRange(e,t,r){for(var n=0;n<e.length;n++){var i=e[n];if(i.from<r&&i.to>t){var o=[];if(i.from<t)o.push({from:i.from,to:t});if(i.to>r)o.push({from:r,to:i.to});e.splice.apply(e,__spreadArray([n,1],o,false));n+=o.length-1}}}function find(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(t(i))return i}return undefined}var IdScaler={toDOM:function(e){return e},fromDOM:function(e){return e},scale:1};var BigScaler=function(){function e(e,t,r){var n=0,i=0,o=0;this.viewports=r.map((function(r){var i=r.from,o=r.to;var a=t.lineAt(i,QueryType$1.ByPos,e,0,0).top;var s=t.lineAt(o,QueryType$1.ByPos,e,0,0).bottom;n+=s-a;return{from:i,to:o,top:a,bottom:s,domTop:0,domBottom:0}}));this.scale=(7e6-n)/(t.height-n);for(var a=0,s=this.viewports;a<s.length;a++){var l=s[a];l.domTop=o+(l.top-i)*this.scale;o=l.domBottom=l.domTop+(l.bottom-l.top);i=l.bottom}}e.prototype.toDOM=function(e){for(var t=0,r=0,n=0;;t++){var i=t<this.viewports.length?this.viewports[t]:null;if(!i||e<i.top)return n+(e-r)*this.scale;if(e<=i.bottom)return i.domTop+(e-i.top);r=i.bottom;n=i.domBottom}};e.prototype.fromDOM=function(e){for(var t=0,r=0,n=0;;t++){var i=t<this.viewports.length?this.viewports[t]:null;if(!i||e<i.domTop)return r+(e-n)/this.scale;if(e<=i.domBottom)return i.top+(e-i.domTop);r=i.bottom;n=i.domBottom}};return e}();function scaleBlock(e,t){if(t.scale==1)return e;var r=t.toDOM(e.top),n=t.toDOM(e.bottom);return new BlockInfo(e.from,e.length,r,n-r,Array.isArray(e.type)?e.type.map((function(e){return scaleBlock(e,t)})):e.type)}var theme=Facet.define({combine:function(e){return e.join(" ")}});var darkTheme=Facet.define({combine:function(e){return e.indexOf(true)>-1}});var baseThemeID=StyleModule.newName(),baseLightID=StyleModule.newName(),baseDarkID=StyleModule.newName();var lightDarkIDs={"&light":"."+baseLightID,"&dark":"."+baseDarkID};function buildTheme(e,t,r){return new StyleModule(t,{finish:function(t){return/&/.test(t)?t.replace(/&\w*/,(function(t){if(t=="&")return e;if(!r||!r[t])throw new RangeError("Unsupported selector: ".concat(t));return r[t]})):e+" "+t}})}var baseTheme$8=buildTheme("."+baseThemeID,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},lightDarkIDs);var observeOptions={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var useCharData=browser.ie&&browser.ie_version<=11;var DOMObserver=function(){function e(e,t,r){var n=this;this.view=e;this.onChange=t;this.onScrollChanged=r;this.active=false;this.selectionRange=new DOMSelectionState;this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.scrollTargets=[];this.intersection=null;this.resize=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=e.contentDOM;this.observer=new MutationObserver((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];n.queue.push(o)}if((browser.ie&&browser.ie_version<=11||browser.ios&&e.composing)&&t.some((function(e){return e.type=="childList"&&e.removedNodes.length||e.type=="characterData"&&e.oldValue.length>e.target.nodeValue.length})))n.flushSoon();else n.flush()}));if(useCharData)this.onCharData=function(e){n.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue});n.flushSoon()};this.onSelectionChange=this.onSelectionChange.bind(this);window.addEventListener("resize",this.onResize=this.onResize.bind(this));if(typeof ResizeObserver=="function"){this.resize=new ResizeObserver((function(){if(n.view.docView.lastUpdate<Date.now()-75)n.onResize()}));this.resize.observe(e.scrollDOM)}window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this));this.start();window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this));if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver((function(e){if(n.parentCheck<0)n.parentCheck=setTimeout(n.listenForScroll.bind(n),1e3);if(e.length>0&&e[e.length-1].intersectionRatio>0!=n.intersecting){n.intersecting=!n.intersecting;if(n.intersecting!=n.view.inView)n.onScrollChanged(document.createEvent("Event"))}}),{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver((function(e){if(e.length>0&&e[e.length-1].intersectionRatio>0)n.onScrollChanged(document.createEvent("Event"))}),{})}this.listenForScroll();this.readSelectionRange();this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}e.prototype.onScroll=function(e){if(this.intersecting)this.flush(false);this.onScrollChanged(e)};e.prototype.onResize=function(){var e=this;if(this.resizeTimeout<0)this.resizeTimeout=setTimeout((function(){e.resizeTimeout=-1;e.view.requestMeasure()}),50)};e.prototype.onPrint=function(){var e=this;this.view.viewState.printing=true;this.view.measure();setTimeout((function(){e.view.viewState.printing=false;e.view.requestMeasure()}),500)};e.prototype.updateGaps=function(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((function(t,r){return t!=e[r]})))){this.gapIntersection.disconnect();for(var t=0,r=e;t<r.length;t++){var n=r[t];this.gapIntersection.observe(n)}this.gaps=e}};e.prototype.onSelectionChange=function(e){if(!this.readSelectionRange()||this.delayedAndroidKey)return;var t=this.view,r=this.selectionRange;if(t.state.facet(editable)?t.root.activeElement!=this.dom:!hasSelection(t.dom,r))return;var n=r.anchorNode&&t.docView.nearest(r.anchorNode);if(n&&n.ignoreEvent(e))return;if((browser.ie&&browser.ie_version<=11||browser.android&&browser.chrome)&&!t.state.selection.main.empty&&r.focusNode&&isEquivalentPosition(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset))this.flushSoon();else this.flush(false)};e.prototype.readSelectionRange=function(){var e=this.view.root,t=getSelection(e);var r=browser.safari&&e.nodeType==11&&deepActiveElement()==this.view.contentDOM&&safariSelectionRangeHack(this.view)||t;if(this.selectionRange.eq(r))return false;this.selectionRange.setRange(r);return this.selectionChanged=true};e.prototype.setSelectionRange=function(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset);this.selectionChanged=false};e.prototype.listenForScroll=function(){this.parentCheck=-1;var e=0,t=null;for(var r=this.dom;r;){if(r.nodeType==1){if(!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==r)e++;else if(!t)t=this.scrollTargets.slice(0,e);if(t)t.push(r);r=r.assignedSlot||r.parentNode}else if(r.nodeType==11){r=r.host}else{break}}if(e<this.scrollTargets.length&&!t)t=this.scrollTargets.slice(0,e);if(t){for(var n=0,i=this.scrollTargets;n<i.length;n++){var r=i[n];r.removeEventListener("scroll",this.onScroll)}for(var o=0,a=this.scrollTargets=t;o<a.length;o++){var r=a[o];r.addEventListener("scroll",this.onScroll)}}};e.prototype.ignore=function(e){if(!this.active)return e();try{this.stop();return e()}finally{this.start();this.clear()}};e.prototype.start=function(){if(this.active)return;this.observer.observe(this.dom,observeOptions);if(useCharData)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true};e.prototype.stop=function(){if(!this.active)return;this.active=false;this.observer.disconnect();if(useCharData)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)};e.prototype.clear=function(){this.processRecords();this.queue.length=0;this.selectionChanged=false};e.prototype.delayAndroidKey=function(e,t){var r=this;if(!this.delayedAndroidKey)requestAnimationFrame((function(){var e=r.delayedAndroidKey;r.delayedAndroidKey=null;var t=r.view.state;if(dispatchKey(r.view.contentDOM,e.key,e.keyCode))r.processRecords();else r.flush();if(r.view.state==t)r.view.update([])}));if(!this.delayedAndroidKey||e=="Enter")this.delayedAndroidKey={key:e,keyCode:t}};e.prototype.flushSoon=function(){var e=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout((function(){e.delayedFlush=-1;e.flush()}),20)};e.prototype.forceFlush=function(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush()}};e.prototype.processRecords=function(){var e=this.queue;for(var t=0,r=this.observer.takeRecords();t<r.length;t++){var n=r[t];e.push(n)}if(e.length)this.queue=[];var i=-1,o=-1,a=false;for(var s=0,l=e;s<l.length;s++){var c=l[s];var u=this.readMutation(c);if(!u)continue;if(u.typeOver)a=true;if(i==-1){i=u.from,o=u.to}else{i=Math.min(u.from,i);o=Math.max(u.to,o)}}return{from:i,to:o,typeOver:a}};e.prototype.flush=function(e){if(e===void 0){e=true}if(this.delayedFlush>=0||this.delayedAndroidKey)return;if(e)this.readSelectionRange();var t=this.processRecords(),r=t.from,n=t.to,i=t.typeOver;var o=this.selectionChanged&&hasSelection(this.dom,this.selectionRange);if(r<0&&!o)return;this.selectionChanged=false;var a=this.view.state;this.onChange(r,n,i);if(this.view.state==a)this.view.update([])};e.prototype.readMutation=function(e){var t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;t.markDirty(e.type=="attributes");if(e.type=="attributes")t.dirty|=4;if(e.type=="childList"){var r=findChild(t,e.previousSibling||e.target.previousSibling,-1);var n=findChild(t,e.nextSibling||e.target.nextSibling,1);return{from:r?t.posAfter(r):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:false}}else if(e.type=="characterData"){return{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}else{return null}};e.prototype.destroy=function(){var e,t,r;this.stop();(e=this.intersection)===null||e===void 0?void 0:e.disconnect();(t=this.gapIntersection)===null||t===void 0?void 0:t.disconnect();(r=this.resize)===null||r===void 0?void 0:r.disconnect();for(var n=0,i=this.scrollTargets;n<i.length;n++){var o=i[n];o.removeEventListener("scroll",this.onScroll)}window.removeEventListener("scroll",this.onScroll);window.removeEventListener("resize",this.onResize);window.removeEventListener("beforeprint",this.onPrint);this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout)};return e}();function findChild(e,t,r){while(t){var n=ContentView.get(t);if(n&&n.parent==e)return n;var i=t.parentNode;t=i!=e.dom?i:r>0?t.nextSibling:t.previousSibling}return null}function safariSelectionRangeHack(e){var t;var r=null;function n(e){e.preventDefault();e.stopImmediatePropagation();r=e.getTargetRanges()[0]}e.contentDOM.addEventListener("beforeinput",n,true);document.execCommand("indent");e.contentDOM.removeEventListener("beforeinput",n,true);if(!r)return null;var i=r.startContainer,o=r.startOffset;var a=r.endContainer,s=r.endOffset;var l=e.docView.domAtPos(e.state.selection.main.anchor);if(isEquivalentPosition(l.node,l.offset,a,s))t=[a,s,i,o],i=t[0],o=t[1],a=t[2],s=t[3];return{anchorNode:i,anchorOffset:o,focusNode:a,focusOffset:s}}function applyDOMChange(e,t,r,n){var i,o;var a=e.state.selection.main;if(t>-1){var s=e.docView.domBoundsAround(t,r,0);if(!s||e.state.readOnly)return;var l=s.from,c=s.to;var u=e.docView.impreciseHead||e.docView.impreciseAnchor?[]:selectionPoints(e);var f=new DOMReader(u,e.state);f.readRange(s.startDOM,s.endDOM);var h=a.from,d=null;if(e.inputState.lastKeyCode===8&&e.inputState.lastKeyTime>Date.now()-100||browser.android&&f.text.length<c-l){h=a.to;d="end"}var p=findDiff(e.state.doc.sliceString(l,c,LineBreakPlaceholder),f.text,h-l,d);if(p){if(browser.chrome&&e.inputState.lastKeyCode==13&&p.toB==p.from+2&&f.text.slice(p.from,p.toB)==LineBreakPlaceholder+LineBreakPlaceholder)p.toB--;i={from:l+p.from,to:l+p.toA,insert:Text.of(f.text.slice(p.from,p.toB).split(LineBreakPlaceholder))}}o=selectionFromPoints(u,l)}else if(e.hasFocus||!e.state.facet(editable)){var g=e.observer.selectionRange;var v=e.docView,m=v.impreciseHead,y=v.impreciseAnchor;var b=m&&m.node==g.focusNode&&m.offset==g.focusOffset||!contains(e.contentDOM,g.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(g.focusNode,g.focusOffset);var w=y&&y.node==g.anchorNode&&y.offset==g.anchorOffset||!contains(e.contentDOM,g.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(g.anchorNode,g.anchorOffset);if(b!=a.head||w!=a.anchor)o=EditorSelection.single(w,b)}if(!i&&!o)return;if(!i&&n&&!a.empty&&o&&o.main.empty)i={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,a.to)};else if(i&&i.from>=a.from&&i.to<=a.to&&(i.from!=a.from||i.to!=a.to)&&a.to-a.from-(i.to-i.from)<=4)i={from:a.from,to:a.to,insert:e.state.doc.slice(a.from,i.from).append(i.insert).append(e.state.doc.slice(i.to,a.to))};if(i){var x=e.state;if(browser.ios&&e.inputState.flushIOSKey(e))return;if(browser.android&&(i.from==a.from&&i.to==a.to&&i.insert.length==1&&i.insert.lines==2&&dispatchKey(e.contentDOM,"Enter",13)||i.from==a.from-1&&i.to==a.to&&i.insert.length==0&&dispatchKey(e.contentDOM,"Backspace",8)||i.from==a.from&&i.to==a.to+1&&i.insert.length==0&&dispatchKey(e.contentDOM,"Delete",46)))return;var S=i.insert.toString();if(e.state.facet(inputHandler$1).some((function(t){return t(e,i.from,i.to,S)})))return;if(e.inputState.composing>=0)e.inputState.composing++;var k=void 0;if(i.from>=a.from&&i.to<=a.to&&i.to-i.from>=(a.to-a.from)/3&&(!o||o.main.empty&&o.main.from==i.from+i.insert.length)&&e.inputState.composing<0){var C=a.from<i.from?x.sliceDoc(a.from,i.from):"";var M=a.to>i.to?x.sliceDoc(i.to,a.to):"";k=x.replaceSelection(e.state.toText(C+i.insert.sliceString(0,undefined,e.state.lineBreak)+M))}else{var A=x.changes(i);var P=o&&!x.selection.main.eq(o.main)&&o.main.to<=A.newLength?o.main:undefined;if(x.selection.ranges.length>1&&e.inputState.composing>=0&&i.to<=a.to&&i.to>=a.to-10){var T=e.state.sliceDoc(i.from,i.to);var E=compositionSurroundingNode(e)||e.state.doc.lineAt(a.head);var D=a.to-i.to,O=a.to-a.from;k=x.changeByRange((function(t){if(t.from==a.from&&t.to==a.to)return{changes:A,range:P||t.map(A)};var r=t.to-D,n=r-T.length;if(t.to-t.from!=O||e.state.sliceDoc(n,r)!=T||E&&t.to>=E.from&&t.from<=E.to)return{range:t};var o=x.changes({from:n,to:r,insert:i.insert}),s=t.to-a.to;return{changes:o,range:!P?t.map(o):EditorSelection.range(Math.max(0,P.anchor+s),Math.max(0,P.head+s))}}))}else{k={changes:A,selection:P&&x.selection.replaceRange(P)}}}var B="input.type";if(e.composing){B+=".compose";if(e.inputState.compositionFirstChange){B+=".start";e.inputState.compositionFirstChange=false}}e.dispatch(k,{scrollIntoView:true,userEvent:B})}else if(o&&!o.main.eq(a)){var L=false,B="select";if(e.inputState.lastSelectionTime>Date.now()-50){if(e.inputState.lastSelectionOrigin=="select")L=true;B=e.inputState.lastSelectionOrigin}e.dispatch({selection:o,scrollIntoView:L,userEvent:B})}}function findDiff(e,t,r,n){var i=Math.min(e.length,t.length);var o=0;while(o<i&&e.charCodeAt(o)==t.charCodeAt(o))o++;if(o==i&&e.length==t.length)return null;var a=e.length,s=t.length;while(a>0&&s>0&&e.charCodeAt(a-1)==t.charCodeAt(s-1)){a--;s--}if(n=="end"){var l=Math.max(0,o-Math.min(a,s));r-=a+l-o}if(a<o&&e.length<t.length){var c=r<=o&&r>=a?o-r:0;o-=c;s=o+(s-a);a=o}else if(s<o){var c=r<=o&&r>=s?o-r:0;o-=c;a=o+(a-s);s=o}return{from:o,toA:a,toB:s}}function selectionPoints(e){var t=[];if(e.root.activeElement!=e.contentDOM)return t;var r=e.observer.selectionRange,n=r.anchorNode,i=r.anchorOffset,o=r.focusNode,a=r.focusOffset;if(n){t.push(new DOMPoint(n,i));if(o!=n||a!=i)t.push(new DOMPoint(o,a))}return t}function selectionFromPoints(e,t){if(e.length==0)return null;var r=e[0].pos,n=e.length==2?e[1].pos:r;return r>-1&&n>-1?EditorSelection.single(r+t,n+t):null}var EditorView=function(){function e(e){var t=this;if(e===void 0){e={}}this.plugins=[];this.pluginMap=new Map;this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=e.dispatch||function(e){return t.update([e])};this.dispatch=this.dispatch.bind(this);this.root=e.root||getRoot(e.parent)||document;this.viewState=new ViewState(e.state||EditorState.create());this.plugins=this.state.facet(viewPlugin).map((function(e){return new PluginInstance(e)}));for(var r=0,n=this.plugins;r<n.length;r++){var i=n[r];i.update(this)}this.observer=new DOMObserver(this,(function(e,r,n){applyDOMChange(t,e,r,n)}),(function(e){t.inputState.runScrollHandlers(t,e);if(t.observer.intersecting)t.measure()}));this.inputState=new InputState(this);this.docView=new DocView(this);this.mountStyles();this.updateAttrs();this.updateState=0;this.requestMeasure();if(e.parent)e.parent.appendChild(this.dom)}Object.defineProperty(e.prototype,"state",{get:function(){return this.viewState.state},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"viewport",{get:function(){return this.viewState.viewport},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"visibleRanges",{get:function(){return this.viewState.visibleRanges},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"inView",{get:function(){return this.viewState.inView},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"composing",{get:function(){return this.inputState.composing>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"compositionStarted",{get:function(){return this.inputState.composing>=0},enumerable:false,configurable:true});e.prototype.dispatch=function(){var e;var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}this._dispatch(t.length==1&&t[0]instanceof Transaction?t[0]:(e=this.state).update.apply(e,t))};e.prototype.update=function(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var t=false,r;var n=this.state;for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=a.state}if(this.destroyed){this.viewState.state=n;return}if(n.facet(EditorState.phrases)!=this.state.facet(EditorState.phrases))return this.setState(n);r=new ViewUpdate(this,n,e);var s=this.viewState.scrollTarget;try{this.updateState=2;for(var l=0,c=e;l<c.length;l++){var a=c[l];if(s)s=s.map(a.changes);if(a.scrollIntoView){var u=a.state.selection.main;s=new ScrollTarget(u.empty?u:EditorSelection.cursor(u.head,u.head>u.anchor?-1:1))}for(var f=0,h=a.effects;f<h.length;f++){var d=h[f];if(d.is(scrollTo))s=new ScrollTarget(d.value);else if(d.is(centerOn))s=new ScrollTarget(d.value,"center");else if(d.is(scrollIntoView$1))s=d.value}}this.viewState.update(r,s);this.bidiCache=CachedOrder.update(this.bidiCache,r.changes);if(!r.empty){this.updatePlugins(r);this.inputState.update(r)}t=this.docView.update(r);if(this.state.facet(styleModule)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(e);this.docView.updateSelection(t,e.some((function(e){return e.isUserEvent("select.pointer")})))}finally{this.updateState=0}if(r.startState.facet(theme)!=r.state.facet(theme))this.viewState.mustMeasureContent=true;if(t||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)this.requestMeasure();if(!r.empty)for(var p=0,g=this.state.facet(updateListener);p<g.length;p++){var v=g[p];v(r)}};e.prototype.setState=function(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;var t=this.hasFocus;try{for(var r=0,n=this.plugins;r<n.length;r++){var i=n[r];i.destroy(this)}this.viewState=new ViewState(e);this.plugins=e.facet(viewPlugin).map((function(e){return new PluginInstance(e)}));this.pluginMap.clear();for(var o=0,a=this.plugins;o<a.length;o++){var i=a[o];i.update(this)}this.docView=new DocView(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[]}finally{this.updateState=0}if(t)this.focus();this.requestMeasure()};e.prototype.updatePlugins=function(e){var t=e.startState.facet(viewPlugin),r=e.state.facet(viewPlugin);if(t!=r){var n=[];for(var i=0,o=r;i<o.length;i++){var a=o[i];var s=t.indexOf(a);if(s<0){n.push(new PluginInstance(a))}else{var l=this.plugins[s];l.mustUpdate=e;n.push(l)}}for(var c=0,u=this.plugins;c<u.length;c++){var l=u[c];if(l.mustUpdate!=e)l.destroy(this)}this.plugins=n;this.pluginMap.clear();this.inputState.ensureHandlers(this)}else{for(var f=0,h=this.plugins;f<h.length;f++){var d=h[f];d.mustUpdate=e}}for(var p=0;p<this.plugins.length;p++)this.plugins[p].update(this)};e.prototype.measure=function(e){var t;var r=this;if(e===void 0){e=true}if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;if(e)this.observer.flush();var n=null;try{for(var i=0;;i++){this.updateState=1;var o=this.viewport;var a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}var s=[];if(!(a&4))t=[s,this.measureRequests],this.measureRequests=t[0],s=t[1];var l=s.map((function(e){try{return e.read(r)}catch(t){logException(r.state,t);return BadMeasure}}));var c=new ViewUpdate(this,this.state),u=false,f=false;c.flags|=a;if(!n)n=c;else n.flags|=a;this.updateState=2;if(!c.empty){this.updatePlugins(c);this.inputState.update(c);this.updateAttrs();u=this.docView.update(c)}for(var h=0;h<s.length;h++)if(l[h]!=BadMeasure){try{var d=s[h];if(d.write)d.write(l[h],this)}catch(m){logException(this.state,m)}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;f=true}if(u)this.docView.updateSelection(true);if(this.viewport.from==o.from&&this.viewport.to==o.to&&!f&&this.measureRequests.length==0)break}}finally{this.updateState=0;this.measureScheduled=-1}if(n&&!n.empty)for(var p=0,g=this.state.facet(updateListener);p<g.length;p++){var v=g[p];v(n)}};Object.defineProperty(e.prototype,"themeClasses",{get:function(){return baseThemeID+" "+(this.state.facet(darkTheme)?baseDarkID:baseLightID)+" "+this.state.facet(theme)},enumerable:false,configurable:true});e.prototype.updateAttrs=function(){var e=this;var t=attrsFromFacet(this,editorAttributes,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var r={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet(editable)?"false":"true",class:"cm-content",style:"".concat(browser.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)r["aria-readonly"]="true";attrsFromFacet(this,contentAttributes,r);this.observer.ignore((function(){updateAttrs(e.contentDOM,e.contentAttrs,r);updateAttrs(e.dom,e.editorAttrs,t)}));this.editorAttrs=t;this.contentAttrs=r};e.prototype.showAnnouncements=function(t){var r=true;for(var n=0,i=t;n<i.length;n++){var o=i[n];for(var a=0,s=o.effects;a<s.length;a++){var l=s[a];if(l.is(e.announce)){if(r)this.announceDOM.textContent="";r=false;var c=this.announceDOM.appendChild(document.createElement("div"));c.textContent=l.value}}}};e.prototype.mountStyles=function(){this.styleModules=this.state.facet(styleModule);StyleModule.mount(this.root,this.styleModules.concat(baseTheme$8).reverse())};e.prototype.readMeasured=function(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false)};e.prototype.requestMeasure=function(e){var t=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame((function(){return t.measure()}));if(e){if(e.key!=null)for(var r=0;r<this.measureRequests.length;r++){if(this.measureRequests[r].key===e.key){this.measureRequests[r]=e;return}}this.measureRequests.push(e)}};e.prototype.pluginField=function(e){var t=[];for(var r=0,n=this.plugins;r<n.length;r++){var i=n[r];i.update(this).takeField(e,t)}return t};e.prototype.plugin=function(e){var t=this.pluginMap.get(e);if(t===undefined||t&&t.spec!=e)this.pluginMap.set(e,t=this.plugins.find((function(t){return t.spec==e}))||null);return t&&t.update(this).value};Object.defineProperty(e.prototype,"documentTop",{get:function(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"documentPadding",{get:function(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}},enumerable:false,configurable:true});e.prototype.blockAtHeight=function(e,t){var r=ensureTop(t,this);return this.elementAtHeight(e-r).moveY(r)};e.prototype.elementAtHeight=function(e){this.readMeasured();return this.viewState.elementAtHeight(e)};e.prototype.visualLineAtHeight=function(e,t){var r=ensureTop(t,this);return this.lineBlockAtHeight(e-r).moveY(r)};e.prototype.lineBlockAtHeight=function(e){this.readMeasured();return this.viewState.lineBlockAtHeight(e)};e.prototype.viewportLines=function(e,t){var r=ensureTop(t,this);for(var n=0,i=this.viewportLineBlocks;n<i.length;n++){var o=i[n];e(o.moveY(r))}};Object.defineProperty(e.prototype,"viewportLineBlocks",{get:function(){return this.viewState.viewportLines},enumerable:false,configurable:true});e.prototype.visualLineAt=function(e,t){if(t===void 0){t=0}return this.lineBlockAt(e).moveY(t+this.viewState.paddingTop)};e.prototype.lineBlockAt=function(e){return this.viewState.lineBlockAt(e)};Object.defineProperty(e.prototype,"contentHeight",{get:function(){return this.viewState.contentHeight},enumerable:false,configurable:true});e.prototype.moveByChar=function(e,t,r){return skipAtoms(this,e,moveByChar(this,e,t,r))};e.prototype.moveByGroup=function(e,t){var r=this;return skipAtoms(this,e,moveByChar(this,e,t,(function(t){return byGroup(r,e.head,t)})))};e.prototype.moveToLineBoundary=function(e,t,r){if(r===void 0){r=true}return moveToLineBoundary(this,e,t,r)};e.prototype.moveVertically=function(e,t,r){return skipAtoms(this,e,moveVertically(this,e,t,r))};e.prototype.scrollPosIntoView=function(e){this.dispatch({effects:scrollTo.of(EditorSelection.cursor(e))})};e.prototype.domAtPos=function(e){return this.docView.domAtPos(e)};e.prototype.posAtDOM=function(e,t){if(t===void 0){t=0}return this.docView.posFromDOM(e,t)};e.prototype.posAtCoords=function(e,t){if(t===void 0){t=true}this.readMeasured();return posAtCoords(this,e,t)};e.prototype.coordsAtPos=function(e,t){if(t===void 0){t=1}this.readMeasured();var r=this.docView.coordsAt(e,t);if(!r||r.left==r.right)return r;var n=this.state.doc.lineAt(e),i=this.bidiSpans(n);var o=i[BidiSpan.find(i,e-n.from,-1,t)];return flattenRect(r,o.dir==Direction.LTR==t>0)};Object.defineProperty(e.prototype,"defaultCharacterWidth",{get:function(){return this.viewState.heightOracle.charWidth},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"defaultLineHeight",{get:function(){return this.viewState.heightOracle.lineHeight},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"textDirection",{get:function(){return this.viewState.heightOracle.direction},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lineWrapping",{get:function(){return this.viewState.heightOracle.lineWrapping},enumerable:false,configurable:true});e.prototype.bidiSpans=function(e){if(e.length>MaxBidiLine)return trivialOrder(e.length);var t=this.textDirection;for(var r=0,n=this.bidiCache;r<n.length;r++){var i=n[r];if(i.from==e.from&&i.dir==t)return i.order}var o=computeOrder(e.text,this.textDirection);this.bidiCache.push(new CachedOrder(e.from,e.to,t,o));return o};Object.defineProperty(e.prototype,"hasFocus",{get:function(){var e;return(document.hasFocus()||browser.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM},enumerable:false,configurable:true});e.prototype.focus=function(){var e=this;this.observer.ignore((function(){focusPreventScroll(e.contentDOM);e.docView.updateSelection()}))};e.prototype.destroy=function(){for(var e=0,t=this.plugins;e<t.length;e++){var r=t[e];r.destroy(this)}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true};e.scrollIntoView=function(e,t){if(t===void 0){t={}}return scrollIntoView$1.of(new ScrollTarget(typeof e=="number"?EditorSelection.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))};e.domEventHandlers=function(e){return ViewPlugin.define((function(){return{}}),{eventHandlers:e})};e.theme=function(e,t){var r=StyleModule.newName();var n=[theme.of(r),styleModule.of(buildTheme(".".concat(r),e))];if(t&&t.dark)n.push(darkTheme.of(true));return n};e.baseTheme=function(e){return Prec.lowest(styleModule.of(buildTheme("."+baseThemeID,e,lightDarkIDs)))};return e}();EditorView.scrollTo=scrollTo;EditorView.centerOn=centerOn;EditorView.styleModule=styleModule;EditorView.inputHandler=inputHandler$1;EditorView.exceptionSink=exceptionSink;EditorView.updateListener=updateListener;EditorView.editable=editable;EditorView.mouseSelectionStyle=mouseSelectionStyle;EditorView.dragMovesSelection=dragMovesSelection$1;EditorView.clickAddsSelectionRange=clickAddsSelectionRange;EditorView.decorations=decorations;EditorView.darkTheme=darkTheme;EditorView.contentAttributes=contentAttributes;EditorView.editorAttributes=editorAttributes;EditorView.lineWrapping=EditorView.contentAttributes.of({class:"cm-lineWrapping"});EditorView.announce=StateEffect.define();var MaxBidiLine=4096;function ensureTop(e,t){return(e==null?t.contentDOM.getBoundingClientRect().top:e)+t.viewState.paddingTop}var BadMeasure={};var CachedOrder=function(){function e(e,t,r,n){this.from=e;this.to=t;this.dir=r;this.order=n}e.update=function(t,r){if(r.empty)return t;var n=[],i=t.length?t[t.length-1].dir:Direction.LTR;for(var o=Math.max(0,t.length-10);o<t.length;o++){var a=t[o];if(a.dir==i&&!r.touchesRange(a.from,a.to))n.push(new e(r.mapPos(a.from,1),r.mapPos(a.to,-1),a.dir,a.order))}return n};return e}();function attrsFromFacet(e,t,r){for(var n=e.state.facet(t),i=n.length-1;i>=0;i--){var o=n[i],a=typeof o=="function"?o(e):o;if(a)combineAttrs(a,r)}return r}var currentPlatform=browser.mac?"mac":browser.windows?"win":browser.linux?"linux":"key";function normalizeKeyName(e,t){var r=e.split(/-(?!$)/);var n=r[r.length-1];if(n=="Space")n=" ";var i,o,a,s;for(var l=0;l<r.length-1;++l){var c=r[l];if(/^(cmd|meta|m)$/i.test(c))s=true;else if(/^a(lt)?$/i.test(c))i=true;else if(/^(c|ctrl|control)$/i.test(c))o=true;else if(/^s(hift)?$/i.test(c))a=true;else if(/^mod$/i.test(c)){if(t=="mac")s=true;else o=true}else throw new Error("Unrecognized modifier name: "+c)}if(i)n="Alt-"+n;if(o)n="Ctrl-"+n;if(s)n="Meta-"+n;if(a)n="Shift-"+n;return n}function modifiers(e,t,r){if(t.altKey)e="Alt-"+e;if(t.ctrlKey)e="Ctrl-"+e;if(t.metaKey)e="Meta-"+e;if(r!==false&&t.shiftKey)e="Shift-"+e;return e}var handleKeyEvents=EditorView.domEventHandlers({keydown:function(e,t){return runHandlers(getKeymap(t.state),e,t,"editor")}});var keymap=Facet.define({enables:handleKeyEvents});var Keymaps=new WeakMap;function getKeymap(e){var t=e.facet(keymap);var r=Keymaps.get(t);if(!r)Keymaps.set(t,r=buildKeymap(t.reduce((function(e,t){return e.concat(t)}),[])));return r}function runScopeHandlers(e,t,r){return runHandlers(getKeymap(e.state),t,e,r)}var storedPrefix=null;var PrefixTimeout=4e3;function buildKeymap(e,t){if(t===void 0){t=currentPlatform}var r=Object.create(null);var n=Object.create(null);var i=function(e,t){var r=n[e];if(r==null)n[e]=t;else if(r!=t)throw new Error("Key binding "+e+" is used both as a regular binding and as a multi-stroke prefix")};var o=function(e,n,o,a){var s=r[e]||(r[e]=Object.create(null));var l=n.split(/ (?!$)/).map((function(e){return normalizeKeyName(e,t)}));var c=function(t){var r=l.slice(0,t).join(" ");i(r,true);if(!s[r])s[r]={preventDefault:true,commands:[function(t){var n=storedPrefix={view:t,prefix:r,scope:e};setTimeout((function(){if(storedPrefix==n)storedPrefix=null}),PrefixTimeout);return true}]}};for(var u=1;u<l.length;u++){c(u)}var f=l.join(" ");i(f,false);var h=s[f]||(s[f]={preventDefault:false,commands:[]});h.commands.push(o);if(a)h.preventDefault=true};for(var a=0,s=e;a<s.length;a++){var l=s[a];var c=l[t]||l.key;if(!c)continue;for(var u=0,f=l.scope?l.scope.split(" "):["editor"];u<f.length;u++){var h=f[u];o(h,c,l.run,l.preventDefault);if(l.shift)o(h,"Shift-"+c,l.shift,l.preventDefault)}}return r}function runHandlers(e,t,r,n){var i=keyName(t),o=i.length==1&&i!=" ";var a="",s=false;if(storedPrefix&&storedPrefix.view==r&&storedPrefix.scope==n){a=storedPrefix.prefix+" ";if(s=modifierCodes.indexOf(t.keyCode)<0)storedPrefix=null}var l=function(e){if(e){for(var t=0,n=e.commands;t<n.length;t++){var i=n[t];if(i(r))return true}if(e.preventDefault)s=true}return false};var c=e[n],u;if(c){if(l(c[a+modifiers(i,t,!o)]))return true;if(o&&(t.shiftKey||t.altKey||t.metaKey)&&(u=base[t.keyCode])&&u!=i){if(l(c[a+modifiers(u,t,true)]))return true}else if(o&&t.shiftKey){if(l(c[a+modifiers(i,t,true)]))return true}}return s}var CanHidePrimary=!browser.ios;var selectionConfig=Facet.define({combine:function(e){return combineConfig(e,{cursorBlinkRate:1200,drawRangeCursor:true},{cursorBlinkRate:function(e,t){return Math.min(e,t)},drawRangeCursor:function(e,t){return e||t}})}});function drawSelection(e){if(e===void 0){e={}}return[selectionConfig.of(e),drawSelectionPlugin,hideNativeSelection]}var Piece=function(){function e(e,t,r,n,i){this.left=e;this.top=t;this.width=r;this.height=n;this.className=i}e.prototype.draw=function(){var e=document.createElement("div");e.className=this.className;this.adjust(e);return e};e.prototype.adjust=function(e){e.style.left=this.left+"px";e.style.top=this.top+"px";if(this.width>=0)e.style.width=this.width+"px";e.style.height=this.height+"px"};e.prototype.eq=function(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className};return e}();var drawSelectionPlugin=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.rangePieces=[];this.cursors=[];this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)};this.selectionLayer=e.scrollDOM.appendChild(document.createElement("div"));this.selectionLayer.className="cm-selectionLayer";this.selectionLayer.setAttribute("aria-hidden","true");this.cursorLayer=e.scrollDOM.appendChild(document.createElement("div"));this.cursorLayer.className="cm-cursorLayer";this.cursorLayer.setAttribute("aria-hidden","true");e.requestMeasure(this.measureReq);this.setBlinkRate()}e.prototype.setBlinkRate=function(){this.cursorLayer.style.animationDuration=this.view.state.facet(selectionConfig).cursorBlinkRate+"ms"};e.prototype.update=function(e){var t=e.startState.facet(selectionConfig)!=e.state.facet(selectionConfig);if(t||e.selectionSet||e.geometryChanged||e.viewportChanged)this.view.requestMeasure(this.measureReq);if(e.transactions.some((function(e){return e.scrollIntoView})))this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink";if(t)this.setBlinkRate()};e.prototype.readPos=function(){var e=this;var t=this.view.state,r=t.facet(selectionConfig);var n=t.selection.ranges.map((function(t){return t.empty?[]:measureRange(e.view,t)})).reduce((function(e,t){return e.concat(t)}));var i=[];for(var o=0,a=t.selection.ranges;o<a.length;o++){var s=a[o];var l=s==t.selection.main;if(s.empty?!l||CanHidePrimary:r.drawRangeCursor){var c=measureCursor(this.view,s,l);if(c)i.push(c)}}return{rangePieces:n,cursors:i}};e.prototype.drawSel=function(e){var t=this;var r=e.rangePieces,n=e.cursors;if(r.length!=this.rangePieces.length||r.some((function(e,r){return!e.eq(t.rangePieces[r])}))){this.selectionLayer.textContent="";for(var i=0,o=r;i<o.length;i++){var a=o[i];this.selectionLayer.appendChild(a.draw())}this.rangePieces=r}if(n.length!=this.cursors.length||n.some((function(e,r){return!e.eq(t.cursors[r])}))){var s=this.cursorLayer.children;if(s.length!==n.length){this.cursorLayer.textContent="";for(var l=0,c=n;l<c.length;l++){var u=c[l];this.cursorLayer.appendChild(u.draw())}}else{n.forEach((function(e,t){return e.adjust(s[t])}))}this.cursors=n}};e.prototype.destroy=function(){this.selectionLayer.remove();this.cursorLayer.remove()};return e}());var themeSpec={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if(CanHidePrimary)themeSpec[".cm-line"].caretColor="transparent !important";var hideNativeSelection=Prec.highest(EditorView.theme(themeSpec));function getBase(e){var t=e.scrollDOM.getBoundingClientRect();var r=e.textDirection==Direction.LTR?t.left:t.right-e.scrollDOM.clientWidth;return{left:r-e.scrollDOM.scrollLeft,top:t.top-e.scrollDOM.scrollTop}}function wrappedLine(e,t,r){var n=EditorSelection.cursor(t);return{from:Math.max(r.from,e.moveToLineBoundary(n,false,true).from),to:Math.min(r.to,e.moveToLineBoundary(n,true,true).from),type:BlockType.Text}}function blockAt(e,t){var r=e.lineBlockAt(t);if(Array.isArray(r.type))for(var n=0,i=r.type;n<i.length;n++){var o=i[n];if(o.to>t||o.to==t&&(o.to==r.to||o.type==BlockType.Text))return o}return r}function measureRange(e,t){if(t.to<=e.viewport.from||t.from>=e.viewport.to)return[];var r=Math.max(t.from,e.viewport.from),n=Math.min(t.to,e.viewport.to);var i=e.textDirection==Direction.LTR;var o=e.contentDOM,a=o.getBoundingClientRect(),s=getBase(e);var l=window.getComputedStyle(o.firstChild);var c=a.left+parseInt(l.paddingLeft)+Math.min(0,parseInt(l.textIndent));var u=a.right-parseInt(l.paddingRight);var f=blockAt(e,r),h=blockAt(e,n);var d=f.type==BlockType.Text?f:null;var p=h.type==BlockType.Text?h:null;if(e.lineWrapping){if(d)d=wrappedLine(e,r,d);if(p)p=wrappedLine(e,n,p)}if(d&&p&&d.from==p.from){return b(w(t.from,t.to,d))}else{var g=d?w(t.from,null,d):x(f,false);var v=p?w(null,t.to,p):x(h,true);var m=[];if((d||f).to<(p||h).from-1)m.push(y(c,g.bottom,u,v.top));else if(g.bottom<v.top&&e.elementAtHeight((g.bottom+v.top)/2).type==BlockType.Text)g.bottom=v.top=(g.bottom+v.top)/2;return b(g).concat(m).concat(b(v))}function y(e,t,r,n){return new Piece(e-s.left,t-s.top-.01,r-e,n-t+.01,"cm-selectionBackground")}function b(e){var t=e.top,r=e.bottom,n=e.horizontal;var i=[];for(var o=0;o<n.length;o+=2)i.push(y(n[o],t,n[o+1],r));return i}function w(t,r,n){var o=1e9,a=-1e9,s=[];function l(t,r,l,f,h){var d=e.coordsAtPos(t,t==n.to?-2:2);var p=e.coordsAtPos(l,l==n.from?2:-2);o=Math.min(d.top,p.top,o);a=Math.max(d.bottom,p.bottom,a);if(h==Direction.LTR)s.push(i&&r?c:d.left,i&&f?u:p.right);else s.push(!i&&f?c:p.left,!i&&r?u:d.right)}var f=t!==null&&t!==void 0?t:n.from,h=r!==null&&r!==void 0?r:n.to;for(var d=0,p=e.visibleRanges;d<p.length;d++){var g=p[d];if(g.to>f&&g.from<h){for(var v=Math.max(g.from,f),m=Math.min(g.to,h);;){var y=e.state.doc.lineAt(v);for(var b=0,w=e.bidiSpans(y);b<w.length;b++){var x=w[b];var S=x.from+y.from,k=x.to+y.from;if(S>=m)break;if(k>v)l(Math.max(S,v),t==null&&S<=f,Math.min(k,m),r==null&&k>=h,x.dir)}v=y.to+1;if(v>=m)break}}}if(s.length==0)l(f,t==null,h,r==null,e.textDirection);return{top:o,bottom:a,horizontal:s}}function x(e,t){var r=a.top+(t?e.top:e.bottom);return{top:r,bottom:r,horizontal:[]}}}function measureCursor(e,t,r){var n=e.coordsAtPos(t.head,t.assoc||1);if(!n)return null;var i=getBase(e);return new Piece(n.left-i.left,n.top-i.top,-1,n.bottom-n.top,r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}function iterMatches(e,t,r,n,i){t.lastIndex=0;for(var o=e.iterRange(r,n),a=r,s=void 0;!o.next().done;a+=o.value.length){if(!o.lineBreak)while(s=t.exec(o.value))i(a+s.index,a+s.index+s[0].length,s)}}function matchRanges(e,t){var r=e.visibleRanges;if(r.length==1&&r[0].from==e.viewport.from&&r[0].to==e.viewport.to)return r;var n=[];for(var i=0,o=r;i<o.length;i++){var a=o[i],s=a.from,l=a.to;s=Math.max(e.state.doc.lineAt(s).from,s-t);l=Math.min(e.state.doc.lineAt(l).to,l+t);if(n.length&&n[n.length-1].to>=s)n[n.length-1].to=l;else n.push({from:s,to:l})}return n}var MatchDecorator=function(){function e(e){var t=e.regexp,r=e.decoration,n=e.boundary,i=e.maxLength,o=i===void 0?1e3:i;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=t;this.getDeco=typeof r=="function"?r:function(){return r};this.boundary=n;this.maxLength=o}e.prototype.createDeco=function(e){var t=this;var r=new RangeSetBuilder;for(var n=0,i=matchRanges(e,this.maxLength);n<i.length;n++){var o=i[n],a=o.from,s=o.to;iterMatches(e.state.doc,this.regexp,a,s,(function(n,i,o){return r.add(n,i,t.getDeco(o,e,n))}))}return r.finish()};e.prototype.updateDeco=function(e,t){var r=1e9,n=-1;if(e.docChanged)e.changes.iterChanges((function(t,i,o,a){if(a>e.view.viewport.from&&o<e.view.viewport.to){r=Math.min(o,r);n=Math.max(a,n)}}));if(e.viewportChanged||n-r>1e3)return this.createDeco(e.view);if(n>-1)return this.updateRange(e.view,t.map(e.changes),r,n);return t};e.prototype.updateRange=function(e,t,r,n){var i=this;var o=function(o){var s=Math.max(o.from,r),l=Math.min(o.to,n);if(l>s){var c=e.state.doc.lineAt(s),u=c.to<l?e.state.doc.lineAt(l):c;var f=Math.max(o.from,c.from),h=Math.min(o.to,u.to);if(a.boundary){for(;s>c.from;s--)if(a.boundary.test(c.text[s-1-c.from])){f=s;break}for(;l<u.to;l++)if(a.boundary.test(u.text[l-u.from])){h=l;break}}var d=[],p=void 0;if(c==u){a.regexp.lastIndex=f-c.from;while((p=a.regexp.exec(c.text))&&p.index<h-c.from){var g=p.index+c.from;d.push(a.getDeco(p,e,g).range(g,g+p[0].length))}}else{iterMatches(e.state.doc,a.regexp,f,h,(function(t,r,n){return d.push(i.getDeco(n,e,t).range(t,r))}))}t=t.update({filterFrom:f,filterTo:h,filter:function(e,t){return e<f||t>h},add:d})}};var a=this;for(var s=0,l=e.visibleRanges;s<l.length;s++){var c=l[s];o(c)}return t};return e}();var UnicodeRegexpSupport=/x/.unicode!=null?"gu":"g";var Specials=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮\ufeff￹-￼]",UnicodeRegexpSupport);var Names={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};var _supportsTabSize=null;function supportsTabSize(){var e;if(_supportsTabSize==null&&typeof document!="undefined"&&document.body){var t=document.body.style;_supportsTabSize=((e=t.tabSize)!==null&&e!==void 0?e:t.MozTabSize)!=null}return _supportsTabSize||false}var specialCharConfig=Facet.define({combine:function(e){var t=combineConfig(e,{render:null,specialChars:Specials,addSpecialChars:null});if(t.replaceTabs=!supportsTabSize())t.specialChars=new RegExp("\t|"+t.specialChars.source,UnicodeRegexpSupport);if(t.addSpecialChars)t.specialChars=new RegExp(t.specialChars.source+"|"+t.addSpecialChars.source,UnicodeRegexpSupport);return t}});function highlightSpecialChars(e){if(e===void 0){e={}}return[specialCharConfig.of(e),specialCharPlugin()]}var _plugin=null;function specialCharPlugin(){return _plugin||(_plugin=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.decorations=Decoration.none;this.decorationCache=Object.create(null);this.decorator=this.makeDecorator(e.state.facet(specialCharConfig));this.decorations=this.decorator.createDeco(e)}e.prototype.makeDecorator=function(e){var t=this;return new MatchDecorator({regexp:e.specialChars,decoration:function(r,n,i){var o=n.state.doc;var a=codePointAt(r[0],0);if(a==9){var s=o.lineAt(i);var l=n.state.tabSize,c=countColumn(s.text,l,i-s.from);return Decoration.replace({widget:new TabWidget((l-c%l)*t.view.defaultCharacterWidth)})}return t.decorationCache[a]||(t.decorationCache[a]=Decoration.replace({widget:new SpecialCharWidget(e,a)}))},boundary:e.replaceTabs?undefined:/[^]/})};e.prototype.update=function(e){var t=e.state.facet(specialCharConfig);if(e.startState.facet(specialCharConfig)!=t){this.decorator=this.makeDecorator(t);this.decorations=this.decorator.createDeco(e.view)}else{this.decorations=this.decorator.updateDeco(e,this.decorations)}};return e}(),{decorations:function(e){return e.decorations}}))}var DefaultPlaceholder="•";function placeholder$1(e){if(e>=32)return DefaultPlaceholder;if(e==10)return"␤";return String.fromCharCode(9216+e)}var SpecialCharWidget=function(e){__extends(t,e);function t(t,r){var n=e.call(this)||this;n.options=t;n.code=r;return n}t.prototype.eq=function(e){return e.code==this.code};t.prototype.toDOM=function(e){var t=placeholder$1(this.code);var r=e.state.phrase("Control character")+" "+(Names[this.code]||"0x"+this.code.toString(16));var n=this.options.render&&this.options.render(this.code,r,t);if(n)return n;var i=document.createElement("span");i.textContent=t;i.title=r;i.setAttribute("aria-label",r);i.className="cm-specialChar";return i};t.prototype.ignoreEvent=function(){return false};return t}(WidgetType);var TabWidget=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.width=t;return r}t.prototype.eq=function(e){return e.width==this.width};t.prototype.toDOM=function(){var e=document.createElement("span");e.textContent="\t";e.className="cm-tab";e.style.width=this.width+"px";return e};t.prototype.ignoreEvent=function(){return false};return t}(WidgetType);var ios=typeof navigator!="undefined"&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);var Outside="-10000px";var TooltipViewManager=function(){function e(e,t,r){this.facet=t;this.createTooltipView=r;this.input=e.state.facet(t);this.tooltips=this.input.filter((function(e){return e}));this.tooltipViews=this.tooltips.map(r)}e.prototype.update=function(e){var t=e.state.facet(this.facet);var r=t.filter((function(e){return e}));if(t===this.input){for(var n=0,i=this.tooltipViews;n<i.length;n++){var o=i[n];if(o.update)o.update(e)}return false}var a=[];for(var s=0;s<r.length;s++){var l=r[s],c=-1;if(!l)continue;for(var u=0;u<this.tooltips.length;u++){var f=this.tooltips[u];if(f&&f.create==l.create)c=u}if(c<0){a[s]=this.createTooltipView(l)}else{var h=a[s]=this.tooltipViews[c];if(h.update)h.update(e)}}for(var d=0,p=this.tooltipViews;d<p.length;d++){var g=p[d];if(a.indexOf(g)<0)g.dom.remove()}this.input=t;this.tooltips=r;this.tooltipViews=a;return true};return e}();function windowSpace(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}var tooltipConfig=Facet.define({combine:function(e){var t,r,n;return{position:ios?"absolute":((t=e.find((function(e){return e.position})))===null||t===void 0?void 0:t.position)||"fixed",parent:((r=e.find((function(e){return e.parent})))===null||r===void 0?void 0:r.parent)||null,tooltipSpace:((n=e.find((function(e){return e.tooltipSpace})))===null||n===void 0?void 0:n.tooltipSpace)||windowSpace}}});var tooltipPlugin=ViewPlugin.fromClass(function(){function e(e){var t=this;var r;this.view=e;this.inView=true;this.lastTransaction=0;this.measureTimeout=-1;var n=e.state.facet(tooltipConfig);this.position=n.position;this.parent=n.parent;this.classes=e.themeClasses;this.createContainer();this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this};this.manager=new TooltipViewManager(e,showTooltip,(function(e){return t.createTooltip(e)}));this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver((function(e){if(Date.now()>t.lastTransaction-50&&e.length>0&&e[e.length-1].intersectionRatio<1)t.measureSoon()}),{threshold:[1]}):null;this.observeIntersection();(r=e.dom.ownerDocument.defaultView)===null||r===void 0?void 0:r.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this));this.maybeMeasure()}e.prototype.createContainer=function(){if(this.parent){this.container=document.createElement("div");this.container.style.position="relative";this.container.className=this.view.themeClasses;this.parent.appendChild(this.container)}else{this.container=this.view.dom}};e.prototype.observeIntersection=function(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(var e=0,t=this.manager.tooltipViews;e<t.length;e++){var r=t[e];this.intersectionObserver.observe(r.dom)}}};e.prototype.measureSoon=function(){var e=this;if(this.measureTimeout<0)this.measureTimeout=setTimeout((function(){e.measureTimeout=-1;e.maybeMeasure()}),50)};e.prototype.update=function(e){if(e.transactions.length)this.lastTransaction=Date.now();var t=this.manager.update(e);if(t)this.observeIntersection();var r=t||e.geometryChanged;var n=e.state.facet(tooltipConfig);if(n.position!=this.position){this.position=n.position;for(var i=0,o=this.manager.tooltipViews;i<o.length;i++){var a=o[i];a.dom.style.position=this.position}r=true}if(n.parent!=this.parent){if(this.parent)this.container.remove();this.parent=n.parent;this.createContainer();for(var s=0,l=this.manager.tooltipViews;s<l.length;s++){var c=l[s];this.container.appendChild(c.dom)}r=true}else if(this.parent&&this.view.themeClasses!=this.classes){this.classes=this.container.className=this.view.themeClasses}if(r)this.maybeMeasure()};e.prototype.createTooltip=function(e){var t=e.create(this.view);t.dom.classList.add("cm-tooltip");if(e.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){var r=document.createElement("div");r.className="cm-tooltip-arrow";t.dom.appendChild(r)}t.dom.style.position=this.position;t.dom.style.top=Outside;this.container.appendChild(t.dom);if(t.mount)t.mount(this.view);return t};e.prototype.destroy=function(){var e,t;(e=this.view.dom.ownerDocument.defaultView)===null||e===void 0?void 0:e.removeEventListener("resize",this.measureSoon);for(var r=0,n=this.manager.tooltipViews;r<n.length;r++){var i=n[r].dom;i.remove()}(t=this.intersectionObserver)===null||t===void 0?void 0:t.disconnect();clearTimeout(this.measureTimeout)};e.prototype.readMeasure=function(){var e=this;var t=this.view.dom.getBoundingClientRect();return{editor:t,parent:this.parent?this.container.getBoundingClientRect():t,pos:this.manager.tooltips.map((function(t,r){var n=e.manager.tooltipViews[r];return n.getCoords?n.getCoords(t.pos):e.view.coordsAtPos(t.pos)})),size:this.manager.tooltipViews.map((function(e){var t=e.dom;return t.getBoundingClientRect()})),space:this.view.state.facet(tooltipConfig).tooltipSpace(this.view)}};e.prototype.writeMeasure=function(e){var t=e.editor,r=e.space;var n=[];for(var i=0;i<this.manager.tooltips.length;i++){var o=this.manager.tooltips[i],a=this.manager.tooltipViews[i],s=a.dom;var l=e.pos[i],c=e.size[i];if(!l||l.bottom<=Math.max(t.top,r.top)||l.top>=Math.min(t.bottom,r.bottom)||l.right<Math.max(t.left,r.left)-.1||l.left>Math.min(t.right,r.right)+.1){s.style.top=Outside;continue}var u=o.arrow?a.dom.querySelector(".cm-tooltip-arrow"):null;var f=u?7:0;var h=c.right-c.left,d=c.bottom-c.top;var p=a.offset||noOffset,g=this.view.textDirection==Direction.LTR;var v=c.width>r.right-r.left?g?r.left:r.right-c.width:g?Math.min(l.left-(u?14:0)+p.x,r.right-h):Math.max(r.left,l.left-h+(u?14:0)-p.x);var m=!!o.above;if(!o.strictSide&&(m?l.top-(c.bottom-c.top)-p.y<r.top:l.bottom+(c.bottom-c.top)+p.y>r.bottom)&&m==r.bottom-l.bottom>l.top-r.top)m=!m;var y=m?l.top-d-f-p.y:l.bottom+f+p.y;var b=v+h;if(a.overlap!==true)for(var w=0,x=n;w<x.length;w++){var S=x[w];if(S.left<b&&S.right>v&&S.top<y+d&&S.bottom>y)y=m?S.top-d-2-f:S.bottom+f+2}if(this.position=="absolute"){s.style.top=y-e.parent.top+"px";s.style.left=v-e.parent.left+"px"}else{s.style.top=y+"px";s.style.left=v+"px"}if(u)u.style.left="".concat(l.left+(g?p.x:-p.x)-(v+14-7),"px");if(a.overlap!==true)n.push({left:v,top:y,right:b,bottom:y+d});s.classList.toggle("cm-tooltip-above",m);s.classList.toggle("cm-tooltip-below",!m);if(a.positioned)a.positioned()}};e.prototype.maybeMeasure=function(){if(this.manager.tooltips.length){if(this.view.inView)this.view.requestMeasure(this.measureReq);if(this.inView!=this.view.inView){this.inView=this.view.inView;if(!this.inView)for(var e=0,t=this.manager.tooltipViews;e<t.length;e++){var r=t[e];r.dom.style.top=Outside}}}};return e}(),{eventHandlers:{scroll:function(){this.maybeMeasure()}}});var baseTheme$7=EditorView.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"".concat(7,"px"),width:"".concat(7*2,"px"),position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"".concat(7,"px solid transparent"),borderRight:"".concat(7,"px solid transparent")},".cm-tooltip-above &":{bottom:"-".concat(7,"px"),"&:before":{borderTop:"".concat(7,"px solid #bbb")},"&:after":{borderTop:"".concat(7,"px solid #f5f5f5"),bottom:"1px"}},".cm-tooltip-below &":{top:"-".concat(7,"px"),"&:before":{borderBottom:"".concat(7,"px solid #bbb")},"&:after":{borderBottom:"".concat(7,"px solid #f5f5f5"),top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}});var noOffset={x:0,y:0};var showTooltip=Facet.define({enables:[tooltipPlugin,baseTheme$7]});function getTooltip(e,t){var r=e.plugin(tooltipPlugin);if(!r)return null;var n=r.manager.tooltips.indexOf(t);return n<0?null:r.manager.tooltipViews[n]}var DefaultBufferLength=1024;var nextPropID=0;var Range=function(){function e(e,t){this.from=e;this.to=t}return e}();var NodeProp=function(){function e(e){if(e===void 0){e={}}this.id=nextPropID++;this.perNode=!!e.perNode;this.deserialize=e.deserialize||function(){throw new Error("This node type doesn't define a deserialize function")}}e.prototype.add=function(e){var t=this;if(this.perNode)throw new RangeError("Can't add per-node props to node types");if(typeof e!="function")e=NodeType.match(e);return function(r){var n=e(r);return n===undefined?null:[t,n]}};return e}();NodeProp.closedBy=new NodeProp({deserialize:function(e){return e.split(" ")}});NodeProp.openedBy=new NodeProp({deserialize:function(e){return e.split(" ")}});NodeProp.group=new NodeProp({deserialize:function(e){return e.split(" ")}});NodeProp.contextHash=new NodeProp({perNode:true});NodeProp.lookAhead=new NodeProp({perNode:true});NodeProp.mounted=new NodeProp({perNode:true});var MountedTree=function(){function e(e,t,r){this.tree=e;this.overlay=t;this.parser=r}return e}();var noProps=Object.create(null);var NodeType=function(){function e(e,t,r,n){if(n===void 0){n=0}this.name=e;this.props=t;this.id=r;this.flags=n}e.define=function(t){var r=t.props&&t.props.length?Object.create(null):noProps;var n=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0);var i=new e(t.name||"",r,t.id,n);if(t.props)for(var o=0,a=t.props;o<a.length;o++){var s=a[o];if(!Array.isArray(s))s=s(i);if(s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");r[s[0].id]=s[1]}}return i};e.prototype.prop=function(e){return this.props[e.id]};Object.defineProperty(e.prototype,"isTop",{get:function(){return(this.flags&1)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"isSkipped",{get:function(){return(this.flags&2)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"isError",{get:function(){return(this.flags&4)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"isAnonymous",{get:function(){return(this.flags&8)>0},enumerable:false,configurable:true});e.prototype.is=function(e){if(typeof e=="string"){if(this.name==e)return true;var t=this.prop(NodeProp.group);return t?t.indexOf(e)>-1:false}return this.id==e};e.match=function(e){var t=Object.create(null);for(var r in e)for(var n=0,i=r.split(" ");n<i.length;n++){var o=i[n];t[o]=e[r]}return function(e){for(var r=e.prop(NodeProp.group),n=-1;n<(r?r.length:0);n++){var i=t[n<0?e.name:r[n]];if(i)return i}}};return e}();NodeType.none=new NodeType("",Object.create(null),0,8);var NodeSet=function(){function e(e){this.types=e;for(var t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}e.prototype.extend=function(){var t=[];for(var r=0;r<arguments.length;r++){t[r]=arguments[r]}var n=[];for(var i=0,o=this.types;i<o.length;i++){var a=o[i];var s=null;for(var l=0,c=t;l<c.length;l++){var u=c[l];var f=u(a);if(f){if(!s)s=Object.assign({},a.props);s[f[0].id]=f[1]}}n.push(s?new NodeType(a.name,s,a.id,a.flags):a)}return new e(n)};return e}();var CachedNode=new WeakMap,CachedInnerNode=new WeakMap;var Tree=function(){function e(e,t,r,n,i){this.type=e;this.children=t;this.positions=r;this.length=n;this.props=null;if(i&&i.length){this.props=Object.create(null);for(var o=0,a=i;o<a.length;o++){var s=a[o],l=s[0],c=s[1];this.props[typeof l=="number"?l:l.id]=c}}}e.prototype.toString=function(){var e=this.prop(NodeProp.mounted);if(e&&!e.overlay)return e.tree.toString();var t="";for(var r=0,n=this.children;r<n.length;r++){var i=n[r];var o=i.toString();if(o){if(t)t+=",";t+=o}}return!this.type.name?t:(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":"")};e.prototype.cursor=function(e,t){if(t===void 0){t=0}var r=e!=null&&CachedNode.get(this)||this.topNode;var n=new TreeCursor(r);if(e!=null){n.moveTo(e,t);CachedNode.set(this,n._tree)}return n};e.prototype.fullCursor=function(){return new TreeCursor(this.topNode,1)};Object.defineProperty(e.prototype,"topNode",{get:function(){return new TreeNode(this,0,0,null)},enumerable:false,configurable:true});e.prototype.resolve=function(e,t){if(t===void 0){t=0}var r=resolveNode(CachedNode.get(this)||this.topNode,e,t,false);CachedNode.set(this,r);return r};e.prototype.resolveInner=function(e,t){if(t===void 0){t=0}var r=resolveNode(CachedInnerNode.get(this)||this.topNode,e,t,true);CachedInnerNode.set(this,r);return r};e.prototype.iterate=function(e){var t=e.enter,r=e.leave,n=e.from,i=n===void 0?0:n,o=e.to,a=o===void 0?this.length:o;var s=function(){var e=l.cursor(),t=function(){return e.node};c=e};var l=this,c,u;s();for(var f=c,h=u;;){var d=false;if(f.from<=a&&f.to>=i&&(f.type.isAnonymous||t(f.type,f.from,f.to,h)!==false)){if(f.firstChild())continue;if(!f.type.isAnonymous)d=true}for(;;){if(d&&r)r(f.type,f.from,f.to,h);d=f.type.isAnonymous;if(f.nextSibling())break;if(!f.parent())return;d=true}}};e.prototype.prop=function(e){return!e.perNode?this.type.prop(e):this.props?this.props[e.id]:undefined};Object.defineProperty(e.prototype,"propValues",{get:function(){var e=[];if(this.props)for(var t in this.props)e.push([+t,this.props[t]]);return e},enumerable:false,configurable:true});e.prototype.balance=function(t){var r=this;if(t===void 0){t={}}return this.children.length<=8?this:balanceRange(NodeType.none,this.children,this.positions,0,this.children.length,0,this.length,(function(t,n,i){return new e(r.type,t,n,i,r.propValues)}),t.makeTree||function(t,r,n){return new e(NodeType.none,t,r,n)})};e.build=function(e){return buildTree(e)};return e}();Tree.empty=new Tree(NodeType.none,[],[],0);var FlatBufferCursor=function(){function e(e,t){this.buffer=e;this.index=t}Object.defineProperty(e.prototype,"id",{get:function(){return this.buffer[this.index-4]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"start",{get:function(){return this.buffer[this.index-3]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"end",{get:function(){return this.buffer[this.index-2]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"size",{get:function(){return this.buffer[this.index-1]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"pos",{get:function(){return this.index},enumerable:false,configurable:true});e.prototype.next=function(){this.index-=4};e.prototype.fork=function(){return new e(this.buffer,this.index)};return e}();var TreeBuffer=function(){function e(e,t,r){this.buffer=e;this.length=t;this.set=r}Object.defineProperty(e.prototype,"type",{get:function(){return NodeType.none},enumerable:false,configurable:true});e.prototype.toString=function(){var e=[];for(var t=0;t<this.buffer.length;){e.push(this.childString(t));t=this.buffer[t+3]}return e.join(",")};e.prototype.childString=function(e){var t=this.buffer[e],r=this.buffer[e+3];var n=this.set.types[t],i=n.name;if(/\W/.test(i)&&!n.isError)i=JSON.stringify(i);e+=4;if(r==e)return i;var o=[];while(e<r){o.push(this.childString(e));e=this.buffer[e+3]}return i+"("+o.join(",")+")"};e.prototype.findChild=function(e,t,r,n,i){var o=this.buffer,a=-1;for(var s=e;s!=t;s=o[s+3]){if(checkSide(i,n,o[s+1],o[s+2])){a=s;if(r>0)break}}return a};e.prototype.slice=function(t,r,n,i){var o=this.buffer;var a=new Uint16Array(r-t);for(var s=t,l=0;s<r;){a[l++]=o[s++];a[l++]=o[s++]-n;a[l++]=o[s++]-n;a[l++]=o[s++]-t}return new e(a,i-n,this.set)};return e}();function checkSide(e,t,r,n){switch(e){case-2:return r<t;case-1:return n>=t&&r<t;case 0:return r<t&&n>t;case 1:return r<=t&&n>t;case 2:return n>t;case 4:return true}}function enterUnfinishedNodesBefore(e,t){var r=e.childBefore(t);while(r){var n=r.lastChild;if(!n||n.to!=r.to)break;if(n.type.isError&&n.from==n.to){e=r;r=n.prevSibling}else{r=n}}return e}function resolveNode(e,t,r,n){var i;while(e.from==e.to||(r<1?e.from>=t:e.from>t)||(r>-1?e.to<=t:e.to<t)){var o=!n&&e instanceof TreeNode&&e.index<0?null:e.parent;if(!o)return e;e=o}if(n)for(var a=e,o=a.parent;o;a=o,o=a.parent){if(a instanceof TreeNode&&a.index<0&&((i=o.enter(t,r,true))===null||i===void 0?void 0:i.from)!=a.from)e=o}for(;;){var s=e.enter(t,r,n);if(!s)return e;e=s}}var TreeNode=function(){function e(e,t,r,n){this.node=e;this._from=t;this.index=r;this._parent=n}Object.defineProperty(e.prototype,"type",{get:function(){return this.node.type},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"name",{get:function(){return this.node.type.name},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"from",{get:function(){return this._from},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"to",{get:function(){return this._from+this.node.length},enumerable:false,configurable:true});e.prototype.nextChild=function(t,r,n,i,o){if(o===void 0){o=0}for(var a=this;;){for(var s=a.node,l=s.children,c=s.positions,u=r>0?l.length:-1;t!=u;t+=r){var f=l[t],h=c[t]+a._from;if(!checkSide(i,n,h,h+f.length))continue;if(f instanceof TreeBuffer){if(o&2)continue;var d=f.findChild(0,f.buffer.length,r,n-h,i);if(d>-1)return new BufferNode(new BufferContext(a,f,t,h),null,d)}else if(o&1||(!f.type.isAnonymous||hasChild(f))){var p=void 0;if(!(o&1)&&f.props&&(p=f.prop(NodeProp.mounted))&&!p.overlay)return new e(p.tree,h,t,a);var g=new e(f,h,t,a);return o&1||!g.type.isAnonymous?g:g.nextChild(r<0?f.children.length-1:0,r,n,i)}}if(o&1||!a.type.isAnonymous)return null;if(a.index>=0)t=a.index+r;else t=r<0?-1:a._parent.node.children.length;a=a._parent;if(!a)return null}};Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.nextChild(0,1,0,4)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.nextChild(this.node.children.length-1,-1,0,4)},enumerable:false,configurable:true});e.prototype.childAfter=function(e){return this.nextChild(0,1,e,2)};e.prototype.childBefore=function(e){return this.nextChild(this.node.children.length-1,-1,e,-2)};e.prototype.enter=function(t,r,n,i){if(n===void 0){n=true}if(i===void 0){i=true}var o;if(n&&(o=this.node.prop(NodeProp.mounted))&&o.overlay){var a=t-this.from;for(var s=0,l=o.overlay;s<l.length;s++){var c=l[s],u=c.from,f=c.to;if((r>0?u<=a:u<a)&&(r<0?f>=a:f>a))return new e(o.tree,o.overlay[0].from+this.from,-1,this)}}return this.nextChild(0,1,t,r,i?0:2)};e.prototype.nextSignificantParent=function(){var e=this;while(e.type.isAnonymous&&e._parent)e=e._parent;return e};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent?this._parent.nextSignificantParent():null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"nextSibling",{get:function(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"prevSibling",{get:function(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"cursor",{get:function(){return new TreeCursor(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"tree",{get:function(){return this.node},enumerable:false,configurable:true});e.prototype.toTree=function(){return this.node};e.prototype.resolve=function(e,t){if(t===void 0){t=0}return resolveNode(this,e,t,false)};e.prototype.resolveInner=function(e,t){if(t===void 0){t=0}return resolveNode(this,e,t,true)};e.prototype.enterUnfinishedNodesBefore=function(e){return enterUnfinishedNodesBefore(this,e)};e.prototype.getChild=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=getChildren(this,e,t,r);return n.length?n[0]:null};e.prototype.getChildren=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}return getChildren(this,e,t,r)};e.prototype.toString=function(){return this.node.toString()};return e}();function getChildren(e,t,r,n){var i=e.cursor,o=[];if(!i.firstChild())return o;if(r!=null)while(!i.type.is(r))if(!i.nextSibling())return o;for(;;){if(n!=null&&i.type.is(n))return o;if(i.type.is(t))o.push(i.node);if(!i.nextSibling())return n==null?o:[]}}var BufferContext=function(){function e(e,t,r,n){this.parent=e;this.buffer=t;this.index=r;this.start=n}return e}();var BufferNode=function(){function e(e,t,r){this.context=e;this._parent=t;this.index=r;this.type=e.buffer.set.types[e.buffer.buffer[r]]}Object.defineProperty(e.prototype,"name",{get:function(){return this.type.name},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"from",{get:function(){return this.context.start+this.context.buffer.buffer[this.index+1]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"to",{get:function(){return this.context.start+this.context.buffer.buffer[this.index+2]},enumerable:false,configurable:true});e.prototype.child=function(t,r,n){var i=this.context.buffer;var o=i.findChild(this.index+4,i.buffer[this.index+3],t,r-this.context.start,n);return o<0?null:new e(this.context,this,o)};Object.defineProperty(e.prototype,"firstChild",{get:function(){return this.child(1,0,4)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"lastChild",{get:function(){return this.child(-1,0,4)},enumerable:false,configurable:true});e.prototype.childAfter=function(e){return this.child(1,e,2)};e.prototype.childBefore=function(e){return this.child(-1,e,-2)};e.prototype.enter=function(t,r,n,i){if(i===void 0){i=true}if(!i)return null;var o=this.context.buffer;var a=o.findChild(this.index+4,o.buffer[this.index+3],r>0?1:-1,t-this.context.start,r);return a<0?null:new e(this.context,this,a)};Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent||this.context.parent.nextSignificantParent()},enumerable:false,configurable:true});e.prototype.externalSibling=function(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)};Object.defineProperty(e.prototype,"nextSibling",{get:function(){var t=this.context.buffer;var r=t.buffer[this.index+3];if(r<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length))return new e(this.context,this._parent,r);return this.externalSibling(1)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"prevSibling",{get:function(){var t=this.context.buffer;var r=this._parent?this._parent.index+4:0;if(this.index==r)return this.externalSibling(-1);return new e(this.context,this._parent,t.findChild(r,this.index,-1,0,4))},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"cursor",{get:function(){return new TreeCursor(this)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"tree",{get:function(){return null},enumerable:false,configurable:true});e.prototype.toTree=function(){var e=[],t=[];var r=this.context.buffer;var n=this.index+4,i=r.buffer[this.index+3];if(i>n){var o=r.buffer[this.index+1],a=r.buffer[this.index+2];e.push(r.slice(n,i,o,a));t.push(0)}return new Tree(this.type,e,t,this.to-this.from)};e.prototype.resolve=function(e,t){if(t===void 0){t=0}return resolveNode(this,e,t,false)};e.prototype.resolveInner=function(e,t){if(t===void 0){t=0}return resolveNode(this,e,t,true)};e.prototype.enterUnfinishedNodesBefore=function(e){return enterUnfinishedNodesBefore(this,e)};e.prototype.toString=function(){return this.context.buffer.childString(this.index)};e.prototype.getChild=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}var n=getChildren(this,e,t,r);return n.length?n[0]:null};e.prototype.getChildren=function(e,t,r){if(t===void 0){t=null}if(r===void 0){r=null}return getChildren(this,e,t,r)};return e}();var TreeCursor=function(){function e(e,t){if(t===void 0){t=0}this.mode=t;this.buffer=null;this.stack=[];this.index=0;this.bufferNode=null;if(e instanceof TreeNode){this.yieldNode(e)}else{this._tree=e.context.parent;this.buffer=e.context;for(var r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e;this.yieldBuf(e.index)}}Object.defineProperty(e.prototype,"name",{get:function(){return this.type.name},enumerable:false,configurable:true});e.prototype.yieldNode=function(e){if(!e)return false;this._tree=e;this.type=e.type;this.from=e.from;this.to=e.to;return true};e.prototype.yieldBuf=function(e,t){this.index=e;var r=this.buffer,n=r.start,i=r.buffer;this.type=t||i.set.types[i.buffer[e]];this.from=n+i.buffer[e+1];this.to=n+i.buffer[e+2];return true};e.prototype.yield=function(e){if(!e)return false;if(e instanceof TreeNode){this.buffer=null;return this.yieldNode(e)}this.buffer=e.context;return this.yieldBuf(e.index,e.type)};e.prototype.toString=function(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()};e.prototype.enterChild=function(e,t,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree.node.children.length-1:0,e,t,r,this.mode));var n=this.buffer.buffer;var i=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,r);if(i<0)return false;this.stack.push(this.index);return this.yieldBuf(i)};e.prototype.firstChild=function(){return this.enterChild(1,0,4)};e.prototype.lastChild=function(){return this.enterChild(-1,0,4)};e.prototype.childAfter=function(e){return this.enterChild(1,e,2)};e.prototype.childBefore=function(e){return this.enterChild(-1,e,-2)};e.prototype.enter=function(e,t,r,n){if(r===void 0){r=true}if(n===void 0){n=true}if(!this.buffer)return this.yield(this._tree.enter(e,t,r&&!(this.mode&1),n));return n?this.enterChild(1,e,t):false};e.prototype.parent=function(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());var e=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();this.buffer=null;return this.yieldNode(e)};e.prototype.sibling=function(e){if(!this.buffer)return!this._tree._parent?false:this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode));var t=this.buffer.buffer,r=this.stack.length-1;if(e<0){var n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{var i=t.buffer[this.index+3];if(i<(r<0?t.buffer.length:t.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):false};e.prototype.nextSibling=function(){return this.sibling(1)};e.prototype.prevSibling=function(){return this.sibling(-1)};e.prototype.atLastNode=function(e){var t,r;var n,i,o=this.buffer;if(o){if(e>0){if(this.index<o.buffer.buffer.length)return false}else{for(var a=0;a<this.index;a++)if(o.buffer.buffer[a+3]<this.index)return false}n=o.index,i=o.parent}else{t=this._tree,n=t.index,i=t._parent}for(;i;r=i,n=r.index,i=r._parent){if(n>-1)for(var s=n+e,l=e<0?-1:i.node.children.length;s!=l;s+=e){var c=i.node.children[s];if(this.mode&1||c instanceof TreeBuffer||!c.type.isAnonymous||hasChild(c))return false}}return true};e.prototype.move=function(e,t){if(t&&this.enterChild(e,0,4))return true;for(;;){if(this.sibling(e))return true;if(this.atLastNode(e)||!this.parent())return false}};e.prototype.next=function(e){if(e===void 0){e=true}return this.move(1,e)};e.prototype.prev=function(e){if(e===void 0){e=true}return this.move(-1,e)};e.prototype.moveTo=function(e,t){if(t===void 0){t=0}while(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))if(!this.parent())break;while(this.enterChild(1,e,t)){}return this};Object.defineProperty(e.prototype,"node",{get:function(){if(!this.buffer)return this._tree;var e=this.bufferNode,t=null,r=0;if(e&&e.context==this.buffer){e:for(var n=this.index,i=this.stack.length;i>=0;){for(var o=e;o;o=o._parent)if(o.index==n){if(n==this.index)return o;t=o;r=i+1;break e}n=this.stack[--i]}}for(var a=r;a<this.stack.length;a++)t=new BufferNode(this.buffer,t,this.stack[a]);return this.bufferNode=new BufferNode(this.buffer,t,this.index)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"tree",{get:function(){return this.buffer?null:this._tree.node},enumerable:false,configurable:true});return e}();function hasChild(e){return e.children.some((function(e){return e instanceof TreeBuffer||!e.type.isAnonymous||hasChild(e)}))}function buildTree(e){var t;var r=e.buffer,n=e.nodeSet,i=e.maxBufferLength,o=i===void 0?DefaultBufferLength:i,a=e.reused,s=a===void 0?[]:a,l=e.minRepeatType,c=l===void 0?n.types.length:l;var u=Array.isArray(r)?new FlatBufferCursor(r,r.length):r;var f=n.types;var h=0,d=0;function p(e,t,r,i,a){var l=u.id,w=u.start,x=u.end,S=u.size;var k=d;while(S<0){u.next();if(S==-1){var C=s[l];r.push(C);i.push(w-e);return}else if(S==-3){h=l;return}else if(S==-4){d=l;return}else{throw new RangeError("Unrecognized record size: ".concat(S))}}var M=f[l],A,P;var T=w-e;if(x-w<=o&&(P=y(u.pos-t,a))){var E=new Uint16Array(P.size-P.skip);var D=u.pos-P.size,O=E.length;while(u.pos>D)O=b(P.start,E,O);A=new TreeBuffer(E,x-P.start,n);T=P.start-e}else{var D=u.pos-S;u.next();var B=[],L=[];var R=l>=c?l:-1;var I=0,N=x;while(u.pos>D){if(R>=0&&u.id==R&&u.size>=0){if(u.end<=N-o){v(B,L,w,I,u.end,N,R,k);I=B.length;N=u.end}u.next()}else{p(w,D,B,L,R)}}if(R>=0&&I>0&&I<B.length)v(B,L,w,I,w,N,R,k);B.reverse();L.reverse();if(R>-1&&I>0){var F=g(M);A=balanceRange(M,B,L,0,B.length,0,x-w,F,F)}else{A=m(M,B,L,x-w,k-x)}}r.push(A);i.push(T)}function g(e){return function(t,r,n){var i=0,o=t.length-1,a,s;if(o>=0&&(a=t[o])instanceof Tree){if(!o&&a.type==e&&a.length==n)return a;if(s=a.prop(NodeProp.lookAhead))i=r[o]+a.length+s}return m(e,t,r,n,i)}}function v(e,t,r,i,o,a,s,l){var c=[],u=[];while(e.length>i){c.push(e.pop());u.push(t.pop()+r-o)}e.push(m(n.types[s],c,u,a-o,l-a));t.push(o-r)}function m(e,t,r,n,i,o){if(i===void 0){i=0}if(h){var a=[NodeProp.contextHash,h];o=o?[a].concat(o):[a]}if(i>25){var a=[NodeProp.lookAhead,i];o=o?[a].concat(o):[a]}return new Tree(e,t,r,n,o)}function y(e,t){var r=u.fork();var n=0,i=0,a=0,s=r.end-o;var l={size:0,start:0,skip:0};e:for(var f=r.pos-e;r.pos>f;){var h=r.size;if(r.id==t&&h>=0){l.size=n;l.start=i;l.skip=a;a+=4;n+=4;r.next();continue}var d=r.pos-h;if(h<0||d<f||r.start<s)break;var p=r.id>=c?4:0;var g=r.start;r.next();while(r.pos>d){if(r.size<0){if(r.size==-3)p+=4;else break e}else if(r.id>=c){p+=4}r.next()}i=g;n+=h;a+=p}if(t<0||n==e){l.size=n;l.start=i;l.skip=a}return l.size>4?l:undefined}function b(e,t,r){var n=u.id,i=u.start,o=u.end,a=u.size;u.next();if(a>=0&&n<c){var s=r;if(a>4){var l=u.pos-(a-4);while(u.pos>l)r=b(e,t,r)}t[--r]=s;t[--r]=o-e;t[--r]=i-e;t[--r]=n}else if(a==-3){h=n}else if(a==-4){d=n}return r}var w=[],x=[];while(u.pos>0)p(e.start||0,e.bufferStart||0,w,x,-1);var S=(t=e.length)!==null&&t!==void 0?t:w.length?x[0]+w[0].length:0;return new Tree(f[e.topID],w.reverse(),x.reverse(),S)}var nodeSizeCache=new WeakMap;function nodeSize(e,t){if(!e.isAnonymous||t instanceof TreeBuffer||t.type!=e)return 1;var r=nodeSizeCache.get(t);if(r==null){r=1;for(var n=0,i=t.children;n<i.length;n++){var o=i[n];if(o.type!=e||!(o instanceof Tree)){r=1;break}r+=nodeSize(e,o)}nodeSizeCache.set(t,r)}return r}function balanceRange(e,t,r,n,i,o,a,s,l){var c=0;for(var u=n;u<i;u++)c+=nodeSize(e,t[u]);var f=Math.ceil(c*1.5/8);var h=[],d=[];function p(t,r,n,i,a){for(var s=n;s<i;){var c=s,u=r[s],g=nodeSize(e,t[s]);s++;for(;s<i;s++){var v=nodeSize(e,t[s]);if(g+v>=f)break;g+=v}if(s==c+1){if(g>f){var m=t[c];p(m.children,m.positions,0,m.children.length,r[c]+a);continue}h.push(t[c])}else{var y=r[s-1]+t[s-1].length-u;h.push(balanceRange(e,t,r,c,s,u,y,null,l))}d.push(u+a-o)}}p(t,r,n,i,0);return(s||l)(h,d,a)}var TreeFragment=function(){function e(e,t,r,n,i,o){if(i===void 0){i=false}if(o===void 0){o=false}this.from=e;this.to=t;this.tree=r;this.offset=n;this.open=(i?1:0)|(o?2:0)}Object.defineProperty(e.prototype,"openStart",{get:function(){return(this.open&1)>0},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"openEnd",{get:function(){return(this.open&2)>0},enumerable:false,configurable:true});e.addTree=function(t,r,n){if(r===void 0){r=[]}if(n===void 0){n=false}var i=[new e(0,t.length,t,0,false,n)];for(var o=0,a=r;o<a.length;o++){var s=a[o];if(s.to>t.length)i.push(s)}return i};e.applyChanges=function(t,r,n){if(n===void 0){n=128}if(!r.length)return t;var i=[];var o=1,a=t.length?t[0]:null;for(var s=0,l=0,c=0;;s++){var u=s<r.length?r[s]:null;var f=u?u.fromA:1e9;if(f-l>=n)while(a&&a.from<f){var h=a;if(l>=h.from||f<=h.to||c){var d=Math.max(h.from,l)-c,p=Math.min(h.to,f)-c;h=d>=p?null:new e(d,p,h.tree,h.offset+c,s>0,!!u)}if(h)i.push(h);if(a.to>f)break;a=o<t.length?t[o++]:null}if(!u)break;l=u.toA;c=u.toA-u.toB}return i};return e}();var Parser=function(){function e(){}e.prototype.startParse=function(e,t,r){if(typeof e=="string")e=new StringInput(e);r=!r?[new Range(0,e.length)]:r.length?r.map((function(e){return new Range(e.from,e.to)})):[new Range(0,0)];return this.createParse(e,t||[],r)};e.prototype.parse=function(e,t,r){var n=this.startParse(e,t,r);for(;;){var i=n.advance();if(i)return i}};return e}();var StringInput=function(){function e(e){this.string=e}Object.defineProperty(e.prototype,"length",{get:function(){return this.string.length},enumerable:false,configurable:true});e.prototype.chunk=function(e){return this.string.slice(e)};Object.defineProperty(e.prototype,"lineChunks",{get:function(){return false},enumerable:false,configurable:true});e.prototype.read=function(e,t){return this.string.slice(e,t)};return e}();function parseMixed(e){return function(t,r,n,i){return new MixedParse(t,e,r,n,i)}}var InnerParse=function(){function e(e,t,r,n,i){this.parser=e;this.parse=t;this.overlay=r;this.target=n;this.ranges=i}return e}();var ActiveOverlay=function(){function e(e,t,r,n,i,o,a){this.parser=e;this.predicate=t;this.mounts=r;this.index=n;this.start=i;this.target=o;this.prev=a;this.depth=0;this.ranges=[]}return e}();var stoppedInner=new NodeProp({perNode:true});var MixedParse=function(){function e(e,t,r,n,i){this.nest=t;this.input=r;this.fragments=n;this.ranges=i;this.inner=[];this.innerDone=0;this.baseTree=null;this.stoppedAt=null;this.baseParse=e}e.prototype.advance=function(){if(this.baseParse){var e=this.baseParse.advance();if(!e)return null;this.baseParse=null;this.baseTree=e;this.startInner();if(this.stoppedAt!=null)for(var t=0,r=this.inner;t<r.length;t++){var n=r[t];n.parse.stopAt(this.stoppedAt)}}if(this.innerDone==this.inner.length){var i=this.baseTree;if(this.stoppedAt!=null)i=new Tree(i.type,i.children,i.positions,i.length,i.propValues.concat([[stoppedInner,this.stoppedAt]]));return i}var o=this.inner[this.innerDone],a=o.parse.advance();if(a){this.innerDone++;var s=Object.assign(Object.create(null),o.target.props);s[NodeProp.mounted.id]=new MountedTree(a,o.overlay,o.parser);o.target.props=s}return null};Object.defineProperty(e.prototype,"parsedPos",{get:function(){if(this.baseParse)return 0;var e=this.input.length;for(var t=this.innerDone;t<this.inner.length;t++){if(this.inner[t].ranges[0].from<e)e=Math.min(e,this.inner[t].parse.parsedPos)}return e},enumerable:false,configurable:true});e.prototype.stopAt=function(e){this.stoppedAt=e;if(this.baseParse)this.baseParse.stopAt(e);else for(var t=this.innerDone;t<this.inner.length;t++)this.inner[t].parse.stopAt(e)};e.prototype.startInner=function(){var e=new FragmentCursor(this.fragments);var t=null;var r=null;var n=new TreeCursor(new TreeNode(this.baseTree,this.ranges[0].from,0,null),1);e:for(var i=void 0,o=void 0;this.stoppedAt==null||n.from<this.stoppedAt;){var a=true,s=void 0;if(e.hasNode(n)){if(t){var l=t.mounts.find((function(e){return e.frag.from<=n.from&&e.frag.to>=n.to&&e.mount.overlay}));if(l){var c=function(e){var r=e.from+l.pos,i=e.to+l.pos;if(r>=n.from&&i<=n.to&&!t.ranges.some((function(e){return e.from<i&&e.to>r})))t.ranges.push({from:r,to:i})};for(var u=0,f=l.mount.overlay;u<f.length;u++){var h=f[u];c(h)}}}a=false}else if(r&&(o=checkCover(r.ranges,n.from,n.to))){a=o!=2}else if(!n.type.isAnonymous&&n.from<n.to&&(i=this.nest(n,this.input))){if(!n.tree)materialize(n);var d=e.findMounts(n.from,i.parser);if(typeof i.overlay=="function"){t=new ActiveOverlay(i.parser,i.overlay,d,this.inner.length,n.from,n.tree,t)}else{var p=punchRanges(this.ranges,i.overlay||[new Range(n.from,n.to)]);if(p.length)this.inner.push(new InnerParse(i.parser,i.parser.startParse(this.input,enterFragments(d,p),p),i.overlay?i.overlay.map((function(e){return new Range(e.from-n.from,e.to-n.from)})):null,n.tree,p));if(!i.overlay)a=false;else if(p.length)r={ranges:p,depth:0,prev:r}}}else if(t&&(s=t.predicate(n))){if(s===true)s=new Range(n.from,n.to);if(s.from<s.to)t.ranges.push(s)}if(a&&n.firstChild()){if(t)t.depth++;if(r)r.depth++}else{for(;;){if(n.nextSibling())break;if(!n.parent())break e;if(t&&!--t.depth){var p=punchRanges(this.ranges,t.ranges);if(p.length)this.inner.splice(t.index,0,new InnerParse(t.parser,t.parser.startParse(this.input,enterFragments(t.mounts,p),p),t.ranges.map((function(e){return new Range(e.from-t.start,e.to-t.start)})),t.target,p));t=t.prev}if(r&&!--r.depth)r=r.prev}}}};return e}();function checkCover(e,t,r){for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.from>=r)break;if(o.to>t)return o.from<=t&&o.to>=r?2:1}return 0}function sliceBuf(e,t,r,n,i,o){if(t<r){var a=e.buffer[t+1],s=e.buffer[r-2];n.push(e.slice(t,r,a,s));i.push(a-o)}}function materialize(e){var t=e.node,r=0;do{e.parent();r++}while(!e.tree);var n=0,i=e.tree,o=0;for(;;n++){o=i.positions[n]+e.from;if(o<=t.from&&o+i.children[n].length>=t.to)break}var a=i.children[n],s=a.buffer;function l(e,r,n,i,c){var u=e;while(s[u+2]+o<=t.from)u=s[u+3];var f=[],h=[];sliceBuf(a,e,u,f,h,i);var d=s[u+1],p=s[u+2];var g=d+o==t.from&&p+o==t.to&&s[u]==t.type.id;f.push(g?t.toTree():l(u+4,s[u+3],a.set.types[s[u]],d,p-d));h.push(d-i);sliceBuf(a,s[u+3],r,f,h,i);return new Tree(n,f,h,c)}i.children[n]=l(0,s.length,NodeType.none,0,a.length);for(var c=0;c<=r;c++)e.childAfter(t.from)}var StructureCursor=function(){function e(e,t){this.offset=t;this.done=false;this.cursor=e.fullCursor()}e.prototype.moveTo=function(e){var t=this.cursor,r=e-this.offset;while(!this.done&&t.from<r){if(t.to>=e&&t.enter(r,1,false,false));else if(!t.next(false))this.done=true}};e.prototype.hasNode=function(e){this.moveTo(e.from);if(!this.done&&this.cursor.from+this.offset==e.from&&this.cursor.tree){for(var t=this.cursor.tree;;){if(t==e.tree)return true;if(t.children.length&&t.positions[0]==0&&t.children[0]instanceof Tree)t=t.children[0];else break}}return false};return e}();var FragmentCursor=function(){function e(e){var t;this.fragments=e;this.curTo=0;this.fragI=0;if(e.length){var r=this.curFrag=e[0];this.curTo=(t=r.tree.prop(stoppedInner))!==null&&t!==void 0?t:r.to;this.inner=new StructureCursor(r.tree,-r.offset)}else{this.curFrag=this.inner=null}}e.prototype.hasNode=function(e){while(this.curFrag&&e.from>=this.curTo)this.nextFrag();return this.curFrag&&this.curFrag.from<=e.from&&this.curTo>=e.to&&this.inner.hasNode(e)};e.prototype.nextFrag=function(){var e;this.fragI++;if(this.fragI==this.fragments.length){this.curFrag=this.inner=null}else{var t=this.curFrag=this.fragments[this.fragI];this.curTo=(e=t.tree.prop(stoppedInner))!==null&&e!==void 0?e:t.to;this.inner=new StructureCursor(t.tree,-t.offset)}};e.prototype.findMounts=function(e,t){var r;var n=[];if(this.inner){this.inner.cursor.moveTo(e,1);for(var i=this.inner.cursor.node;i;i=i.parent){var o=(r=i.tree)===null||r===void 0?void 0:r.prop(NodeProp.mounted);if(o&&o.parser==t){for(var a=this.fragI;a<this.fragments.length;a++){var s=this.fragments[a];if(s.from>=i.to)break;if(s.tree==this.curFrag.tree)n.push({frag:s,pos:i.from-s.offset,mount:o})}}}}return n};return e}();function punchRanges(e,t){var r=null,n=t;for(var i=1,o=0;i<e.length;i++){var a=e[i-1].to,s=e[i].from;for(;o<n.length;o++){var l=n[o];if(l.from>=s)break;if(l.to<=a)continue;if(!r)n=r=t.slice();if(l.from<a){r[o]=new Range(l.from,a);if(l.to>s)r.splice(o+1,0,new Range(s,l.to))}else if(l.to>s){r[o--]=new Range(s,l.to)}else{r.splice(o--,1)}}}return n}function findCoverChanges(e,t,r,n){var i=0,o=0,a=false,s=false,l=-1e9;var c=[];for(;;){var u=i==e.length?1e9:a?e[i].to:e[i].from;var f=o==t.length?1e9:s?t[o].to:t[o].from;if(a!=s){var h=Math.max(l,r),d=Math.min(u,f,n);if(h<d)c.push(new Range(h,d))}l=Math.min(u,f);if(l==1e9)break;if(u==l){if(!a)a=true;else{a=false;i++}}if(f==l){if(!s)s=true;else{s=false;o++}}}return c}function enterFragments(e,t){var r=[];var n=function(e,n,i){var o=e+(n.overlay?n.overlay[0].from:0),a=o+n.tree.length;var s=Math.max(i.from,o),l=Math.min(i.to,a);if(n.overlay){var c=n.overlay.map((function(t){return new Range(t.from+e,t.to+e)}));var u=findCoverChanges(t,c,s,l);for(var f=0,h=s;;f++){var d=f==u.length,p=d?l:u[f].from;if(p>h)r.push(new TreeFragment(h,p,n.tree,-o,i.from>=h,i.to<=p));if(d)break;h=u[f].to}}else{r.push(new TreeFragment(s,l,n.tree,-o,i.from>=o,i.to<=a))}};for(var i=0,o=e;i<o.length;i++){var a=o[i],s=a.pos,l=a.mount,c=a.frag;n(s,l,c)}return r}var languageDataProp=new NodeProp;function defineLanguageFacet(e){return Facet.define({combine:e?function(t){return t.concat(e)}:undefined})}var Language=function(){function e(e,t,r,n){if(n===void 0){n=[]}this.data=e;this.topNode=r;if(!EditorState.prototype.hasOwnProperty("tree"))Object.defineProperty(EditorState.prototype,"tree",{get:function(){return syntaxTree(this)}});this.parser=t;this.extension=[language.of(this),EditorState.languageData.of((function(e,t,r){return e.facet(languageDataFacetAt(e,t,r))}))].concat(n)}e.prototype.isActiveAt=function(e,t,r){if(r===void 0){r=-1}return languageDataFacetAt(e,t,r)==this.data};e.prototype.findRegions=function(e){var t=this;var r=e.facet(language);if((r===null||r===void 0?void 0:r.data)==this.data)return[{from:0,to:e.doc.length}];if(!r||!r.allowsNesting)return[];var n=[];var i=function(e,r){if(e.prop(languageDataProp)==t.data){n.push({from:r,to:r+e.length});return}var o=e.prop(NodeProp.mounted);if(o){if(o.tree.prop(languageDataProp)==t.data){if(o.overlay)for(var a=0,s=o.overlay;a<s.length;a++){var l=s[a];n.push({from:l.from+r,to:l.to+r})}else n.push({from:r,to:r+e.length});return}else if(o.overlay){var c=n.length;i(o.tree,o.overlay[0].from+r);if(n.length>c)return}}for(var u=0;u<e.children.length;u++){var f=e.children[u];if(f instanceof Tree)i(f,e.positions[u]+r)}};i(syntaxTree(e),0);return n};Object.defineProperty(e.prototype,"allowsNesting",{get:function(){return true},enumerable:false,configurable:true});return e}();Language.setState=StateEffect.define();function languageDataFacetAt(e,t,r){var n=e.facet(language);if(!n)return null;var i=n.data;if(n.allowsNesting){for(var o=syntaxTree(e).topNode;o;o=o.enter(t,r,true,false))i=o.type.prop(languageDataProp)||i}return i}var LRLanguage=function(e){__extends(t,e);function t(t,r){var n=e.call(this,t,r,r.topNode)||this;n.parser=r;return n}t.define=function(e){var r=defineLanguageFacet(e.languageData);return new t(r,e.parser.configure({props:[languageDataProp.add((function(e){return e.isTop?r:undefined}))]}))};t.prototype.configure=function(e){return new t(this.data,this.parser.configure(e))};Object.defineProperty(t.prototype,"allowsNesting",{get:function(){return this.parser.wrappers.length>0},enumerable:false,configurable:true});return t}(Language);function syntaxTree(e){var t=e.field(Language.state,false);return t?t.tree:Tree.empty}var DocInput=function(){function e(e,t){if(t===void 0){t=e.length}this.doc=e;this.length=t;this.cursorPos=0;this.string="";this.cursor=e.iter()}e.prototype.syncTo=function(e){this.string=this.cursor.next(e-this.cursorPos).value;this.cursorPos=e+this.string.length;return this.cursorPos-this.string.length};e.prototype.chunk=function(e){this.syncTo(e);return this.string};Object.defineProperty(e.prototype,"lineChunks",{get:function(){return true},enumerable:false,configurable:true});e.prototype.read=function(e,t){var r=this.cursorPos-this.string.length;if(e<r||t>=this.cursorPos)return this.doc.sliceString(e,t);else return this.string.slice(e-r,t-r)};return e}();var currentContext=null;var ParseContext=function(){function e(e,t,r,n,i,o,a,s){if(r===void 0){r=[]}this.parser=e;this.state=t;this.fragments=r;this.tree=n;this.treeLen=i;this.viewport=o;this.skipped=a;this.scheduleOn=s;this.parse=null;this.tempSkipped=[]}e.prototype.startParse=function(){return this.parser.startParse(new DocInput(this.state.doc),this.fragments)};e.prototype.work=function(e,t){var r=this;if(t!=null&&t>=this.state.doc.length)t=undefined;if(this.tree!=Tree.empty&&this.isDone(t!==null&&t!==void 0?t:this.state.doc.length)){this.takeTree();return true}return this.withContext((function(){var n;var i=Date.now()+e;if(!r.parse)r.parse=r.startParse();if(t!=null&&(r.parse.stoppedAt==null||r.parse.stoppedAt>t)&&t<r.state.doc.length)r.parse.stopAt(t);for(;;){var o=r.parse.advance();if(o){r.fragments=r.withoutTempSkipped(TreeFragment.addTree(o,r.fragments,r.parse.stoppedAt!=null));r.treeLen=(n=r.parse.stoppedAt)!==null&&n!==void 0?n:r.state.doc.length;r.tree=o;r.parse=null;if(r.treeLen<(t!==null&&t!==void 0?t:r.state.doc.length))r.parse=r.startParse();else return true}if(Date.now()>i)return false}}))};e.prototype.takeTree=function(){var e=this;var t,r;if(this.parse&&(t=this.parse.parsedPos)>=this.treeLen){if(this.parse.stoppedAt==null||this.parse.stoppedAt>t)this.parse.stopAt(t);this.withContext((function(){while(!(r=e.parse.advance())){}}));this.treeLen=t;this.tree=r;this.fragments=this.withoutTempSkipped(TreeFragment.addTree(this.tree,this.fragments,true));this.parse=null}};e.prototype.withContext=function(e){var t=currentContext;currentContext=this;try{return e()}finally{currentContext=t}};e.prototype.withoutTempSkipped=function(e){for(var t=void 0;t=this.tempSkipped.pop();)e=cutFragments(e,t.from,t.to);return e};e.prototype.changes=function(t,r){var n=this,i=n.fragments,o=n.tree,a=n.treeLen,s=n.viewport,l=n.skipped;this.takeTree();if(!t.empty){var c=[];t.iterChangedRanges((function(e,t,r,n){return c.push({fromA:e,toA:t,fromB:r,toB:n})}));i=TreeFragment.applyChanges(i,c);o=Tree.empty;a=0;s={from:t.mapPos(s.from,-1),to:t.mapPos(s.to,1)};if(this.skipped.length){l=[];for(var u=0,f=this.skipped;u<f.length;u++){var h=f[u];var d=t.mapPos(h.from,1),p=t.mapPos(h.to,-1);if(d<p)l.push({from:d,to:p})}}}return new e(this.parser,r,i,o,a,s,l,this.scheduleOn)};e.prototype.updateViewport=function(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return false;this.viewport=e;var t=this.skipped.length;for(var r=0;r<this.skipped.length;r++){var n=this.skipped[r],i=n.from,o=n.to;if(i<e.to&&o>e.from){this.fragments=cutFragments(this.fragments,i,o);this.skipped.splice(r--,1)}}if(this.skipped.length>=t)return false;this.reset();return true};e.prototype.reset=function(){if(this.parse){this.takeTree();this.parse=null}};e.prototype.skipUntilInView=function(e,t){this.skipped.push({from:e,to:t})};e.getSkippingParser=function(e){return new(function(t){__extends(r,t);function r(){return t!==null&&t.apply(this,arguments)||this}r.prototype.createParse=function(t,r,n){var i=n[0].from,o=n[n.length-1].to;var a={parsedPos:i,advance:function(){var t=currentContext;if(t){for(var r=0,a=n;r<a.length;r++){var s=a[r];t.tempSkipped.push(s)}if(e)t.scheduleOn=t.scheduleOn?Promise.all([t.scheduleOn,e]):e}this.parsedPos=o;return new Tree(NodeType.none,[],[],o-i)},stoppedAt:null,stopAt:function(){}};return a};return r}(Parser))};e.prototype.isDone=function(e){e=Math.min(e,this.state.doc.length);var t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e};e.get=function(){return currentContext};return e}();function cutFragments(e,t,r){return TreeFragment.applyChanges(e,[{fromA:t,toA:r,fromB:t,toB:r}])}var LanguageState=function(){function e(e){this.context=e;this.tree=e.tree}e.prototype.apply=function(t){if(!t.docChanged)return this;var r=this.context.changes(t.changes,t.state);var n=this.context.treeLen==t.startState.doc.length?undefined:Math.max(t.changes.mapPos(this.context.treeLen),r.viewport.to);if(!r.work(20,n))r.takeTree();return new e(r)};e.init=function(t){var r=Math.min(3e3,t.doc.length);var n=new ParseContext(t.facet(language).parser,t,[],Tree.empty,0,{from:0,to:r},[],null);if(!n.work(20,r))n.takeTree();return new e(n)};return e}();Language.state=StateField.define({create:LanguageState.init,update:function(e,t){for(var r=0,n=t.effects;r<n.length;r++){var i=n[r];if(i.is(Language.setState))return i.value}if(t.startState.facet(language)!=t.state.facet(language))return LanguageState.init(t.state);return e.apply(t)}});var requestIdle=function(e){var t=setTimeout((function(){return e()}),500);return function(){return clearTimeout(t)}};if(typeof requestIdleCallback!="undefined")requestIdle=function(e){var t=-1,r=setTimeout((function(){t=requestIdleCallback(e,{timeout:500-100})}),100);return function(){return t<0?clearTimeout(r):cancelIdleCallback(t)}};var parseWorker=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.working=null;this.workScheduled=0;this.chunkEnd=-1;this.chunkBudget=-1;this.work=this.work.bind(this);this.scheduleWork()}e.prototype.update=function(e){var t=this.view.state.field(Language.state).context;if(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)this.scheduleWork();if(e.docChanged){if(this.view.hasFocus)this.chunkBudget+=50;this.scheduleWork()}this.checkAsyncSchedule(t)};e.prototype.scheduleWork=function(){if(this.working)return;var e=this.view.state,t=e.field(Language.state);if(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))this.working=requestIdle(this.work)};e.prototype.work=function(e){this.working=null;var t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)){this.chunkEnd=t+3e4;this.chunkBudget=3e3}if(this.chunkBudget<=0)return;var r=this.view,n=r.state,i=r.viewport.to,o=n.field(Language.state);if(o.tree==o.context.tree&&o.context.isDone(i+1e5))return;var a=Math.min(this.chunkBudget,100,e?Math.max(25,e.timeRemaining()-5):1e9);var s=o.context.treeLen<i&&n.doc.length>i+1e3;var l=o.context.work(a,i+(s?0:1e5));this.chunkBudget-=Date.now()-t;if(l||this.chunkBudget<=0){o.context.takeTree();this.view.dispatch({effects:Language.setState.of(new LanguageState(o.context))})}if(this.chunkBudget>0&&!(l&&!s))this.scheduleWork();this.checkAsyncSchedule(o.context)};e.prototype.checkAsyncSchedule=function(e){var t=this;if(e.scheduleOn){this.workScheduled++;e.scheduleOn.then((function(){return t.scheduleWork()})).catch((function(e){return logException(t.view.state,e)})).then((function(){return t.workScheduled--}));e.scheduleOn=null}};e.prototype.destroy=function(){if(this.working)this.working()};e.prototype.isWorking=function(){return this.working||this.workScheduled>0};return e}(),{eventHandlers:{focus:function(){this.scheduleWork()}}});var language=Facet.define({combine:function(e){return e.length?e[0]:null},enables:[Language.state,parseWorker]});var LanguageSupport=function(){function e(e,t){if(t===void 0){t=[]}this.language=e;this.support=t;this.extension=[e,t]}return e}();var LanguageDescription=function(){function e(e,t,r,n,i,o){if(o===void 0){o=undefined}this.name=e;this.alias=t;this.extensions=r;this.filename=n;this.loadFunc=i;this.support=o;this.loading=null}e.prototype.load=function(){var e=this;return this.loading||(this.loading=this.loadFunc().then((function(t){return e.support=t}),(function(t){e.loading=null;throw t})))};e.of=function(t){var r=t.load,n=t.support;if(!r){if(!n)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");r=function(){return Promise.resolve(n)}}return new e(t.name,(t.alias||[]).concat(t.name).map((function(e){return e.toLowerCase()})),t.extensions||[],t.filename,r,n)};e.matchFilename=function(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.filename&&i.filename.test(t))return i}var o=/\.([^.]+)$/.exec(t);if(o)for(var a=0,s=e;a<s.length;a++){var i=s[a];if(i.extensions.indexOf(o[1])>-1)return i}return null};e.matchLanguageName=function(e,t,r){if(r===void 0){r=true}t=t.toLowerCase();for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.alias.some((function(e){return e==t})))return o}if(r)for(var a=0,s=e;a<s.length;a++){var o=s[a];for(var l=0,c=o.alias;l<c.length;l++){var u=c[l];var f=t.indexOf(u);if(f>-1&&(u.length>2||!/\w/.test(t[f-1])&&!/\w/.test(t[f+u.length])))return o}}return null};return e}();var indentService=Facet.define();var indentUnit=Facet.define({combine:function(e){if(!e.length)return"  ";if(!/^(?: +|\t+)$/.test(e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(e[0]));return e[0]}});function getIndentUnit(e){var t=e.facet(indentUnit);return t.charCodeAt(0)==9?e.tabSize*t.length:t.length}function indentString(e,t){var r="",n=e.tabSize;if(e.facet(indentUnit).charCodeAt(0)==9)while(t>=n){r+="\t";t-=n}for(var i=0;i<t;i++)r+=" ";return r}function getIndentation(e,t){if(e instanceof EditorState)e=new IndentContext(e);for(var r=0,n=e.state.facet(indentService);r<n.length;r++){var i=n[r];var o=i(e,t);if(o!=null)return o}var a=syntaxTree(e.state);return a?syntaxIndentation(e,a,t):null}var IndentContext=function(){function e(e,t){if(t===void 0){t={}}this.state=e;this.options=t;this.unit=getIndentUnit(e)}e.prototype.lineAt=function(e,t){if(t===void 0){t=1}var r=this.state.doc.lineAt(e);var n=this.options,i=n.simulateBreak,o=n.simulateDoubleBreak;if(i!=null&&i>=r.from&&i<=r.to){if(o&&i==e)return{text:"",from:e};else if(t<0?i<e:i<=e)return{text:r.text.slice(i-r.from),from:i};else return{text:r.text.slice(0,i-r.from),from:r.from}}return r};e.prototype.textAfterPos=function(e,t){if(t===void 0){t=1}if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";var r=this.lineAt(e,t),n=r.text,i=r.from;return n.slice(e-i,Math.min(n.length,e+100-i))};e.prototype.column=function(e,t){if(t===void 0){t=1}var r=this.lineAt(e,t),n=r.text,i=r.from;var o=this.countColumn(n,e-i);var a=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;if(a>-1)o+=a-this.countColumn(n,n.search(/\S|$/));return o};e.prototype.countColumn=function(e,t){if(t===void 0){t=e.length}return countColumn(e,this.state.tabSize,t)};e.prototype.lineIndent=function(e,t){if(t===void 0){t=1}var r=this.lineAt(e,t),n=r.text,i=r.from;var o=this.options.overrideIndentation;if(o){var a=o(i);if(a>-1)return a}return this.countColumn(n,n.search(/\S|$/))};Object.defineProperty(e.prototype,"simulatedBreak",{get:function(){return this.options.simulateBreak||null},enumerable:false,configurable:true});return e}();var indentNodeProp=new NodeProp;function syntaxIndentation(e,t,r){return indentFrom(t.resolveInner(r).enterUnfinishedNodesBefore(r),r,e)}function ignoreClosed(e){return e.pos==e.options.simulateBreak&&e.options.simulateDoubleBreak}function indentStrategy(e){var t=e.type.prop(indentNodeProp);if(t)return t;var r=e.firstChild,n;if(r&&(n=r.type.prop(NodeProp.closedBy))){var i=e.lastChild,o=i&&n.indexOf(i.name)>-1;return function(e){return delimitedStrategy(e,true,1,undefined,o&&!ignoreClosed(e)?i.from:undefined)}}return e.parent==null?topIndent:null}function indentFrom(e,t,r){for(;e;e=e.parent){var n=indentStrategy(e);if(n)return n(new TreeIndentContext(r,t,e))}return null}function topIndent(){return 0}var TreeIndentContext=function(e){__extends(t,e);function t(t,r,n){var i=e.call(this,t.state,t.options)||this;i.base=t;i.pos=r;i.node=n;return i}Object.defineProperty(t.prototype,"textAfter",{get:function(){return this.textAfterPos(this.pos)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"baseIndent",{get:function(){var e=this.state.doc.lineAt(this.node.from);for(;;){var t=this.node.resolve(e.from);while(t.parent&&t.parent.from==t.from)t=t.parent;if(isParent(t,this.node))break;e=this.state.doc.lineAt(t.from)}return this.lineIndent(e.from)},enumerable:false,configurable:true});t.prototype.continue=function(){var e=this.node.parent;return e?indentFrom(e,this.pos,this.base):0};return t}(IndentContext);function isParent(e,t){for(var r=t;r;r=r.parent)if(e==r)return true;return false}function bracketedAligned(e){var t=e.node;var r=t.childAfter(t.from),n=t.lastChild;if(!r)return null;var i=e.options.simulateBreak;var o=e.state.doc.lineAt(r.from);var a=i==null||i<=o.from?o.to:Math.min(o.to,i);for(var s=r.to;;){var l=t.childAfter(s);if(!l||l==n)return null;if(!l.type.isSkipped)return l.from<a?r:null;s=l.to}}function delimitedIndent(e){var t=e.closing,r=e.align,n=r===void 0?true:r,i=e.units,o=i===void 0?1:i;return function(e){return delimitedStrategy(e,n,o,t)}}function delimitedStrategy(e,t,r,n,i){var o=e.textAfter,a=o.match(/^\s*/)[0].length;var s=n&&o.slice(a,a+n.length)==n||i==e.pos+a;var l=t?bracketedAligned(e):null;if(l)return s?e.column(l.from):e.column(l.to);return e.baseIndent+(s?0:e.unit*r)}var flatIndent=function(e){return e.baseIndent};function continuedIndent(e){var t=e===void 0?{}:e,r=t.except,n=t.units,i=n===void 0?1:n;return function(e){var t=r&&r.test(e.textAfter);return e.baseIndent+(t?0:i*e.unit)}}var foldService=Facet.define();var foldNodeProp=new NodeProp;function foldInside$1(e){var t=e.firstChild,r=e.lastChild;return t&&t.to<r.from?{from:t.to,to:r.type.isError?e.to:r.from}:null}function syntaxFolding(e,t,r){var n=syntaxTree(e);if(n.length==0)return null;var i=n.resolveInner(r);var o=null;for(var a=i;a;a=a.parent){if(a.to<=r||a.from>r)continue;if(o&&a.from<t)break;var s=a.type.prop(foldNodeProp);if(s){var l=s(a,e);if(l&&l.from<=r&&l.from>=t&&l.to>r)o=l}}return o}function foldable(e,t,r){for(var n=0,i=e.facet(foldService);n<i.length;n++){var o=i[n];var a=o(e,t,r);if(a)return a}return syntaxFolding(e,t,r)}var CompletionContext=function(){function e(e,t,r){this.state=e;this.pos=t;this.explicit=r;this.abortListeners=[]}e.prototype.tokenBefore=function(e){var t=syntaxTree(this.state).resolveInner(this.pos,-1);while(t&&e.indexOf(t.name)<0)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null};e.prototype.matchBefore=function(e){var t=this.state.doc.lineAt(this.pos);var r=Math.max(t.from,this.pos-250);var n=t.text.slice(r-t.from,this.pos-t.from);var i=n.search(ensureAnchor(e,false));return i<0?null:{from:r+i,to:this.pos,text:n.slice(i)}};Object.defineProperty(e.prototype,"aborted",{get:function(){return this.abortListeners==null},enumerable:false,configurable:true});e.prototype.addEventListener=function(e,t){if(e=="abort"&&this.abortListeners)this.abortListeners.push(t)};return e}();function toSet(e){var t=Object.keys(e).join("");var r=/\w/.test(t);if(r)t=t.replace(/\w/g,"");return"[".concat(r?"\\w":"").concat(t.replace(/[^\w\s]/g,"\\$&"),"]")}function prefixMatch(e){var t=Object.create(null),r=Object.create(null);for(var n=0,i=e;n<i.length;n++){var o=i[n].label;t[o[0]]=true;for(var a=1;a<o.length;a++)r[o[a]]=true}var s=toSet(t)+toSet(r)+"*$";return[new RegExp("^"+s),new RegExp(s)]}function completeFromList(e){var t=e.map((function(e){return typeof e=="string"?{label:e}:e}));var r=t.every((function(e){return/^\w+$/.test(e.label)}))?[/\w*$/,/\w+$/]:prefixMatch(t),n=r[0],i=r[1];return function(e){var r=e.matchBefore(i);return r||e.explicit?{from:r?r.from:e.pos,options:t,span:n}:null}}function ifNotIn(e,t){return function(r){for(var n=syntaxTree(r.state).resolveInner(r.pos,-1);n;n=n.parent)if(e.indexOf(n.name)>-1)return null;return t(r)}}var Option=function(){function e(e,t,r){this.completion=e;this.source=t;this.match=r}return e}();function cur(e){return e.selection.main.head}function ensureAnchor(e,t){var r;var n=e.source;var i=t&&n[0]!="^",o=n[n.length-1]!="$";if(!i&&!o)return e;return new RegExp("".concat(i?"^":"","(?:").concat(n,")").concat(o?"$":""),(r=e.flags)!==null&&r!==void 0?r:e.ignoreCase?"i":"")}var pickedCompletion=Annotation.define();function applyCompletion(e,t){var r=t.completion.apply||t.completion.label;var n=t.source;if(typeof r=="string"){e.dispatch({changes:{from:n.from,to:n.to,insert:r},selection:{anchor:n.from+r.length},userEvent:"input.complete",annotations:pickedCompletion.of(t.completion)})}else{r(e,t.completion,n.from,n.to)}}var SourceCache=new WeakMap;function asSource(e){if(!Array.isArray(e))return e;var t=SourceCache.get(e);if(!t)SourceCache.set(e,t=completeFromList(e));return t}var FuzzyMatcher=function(){function e(e){this.pattern=e;this.chars=[];this.folded=[];this.any=[];this.precise=[];this.byWord=[];for(var t=0;t<e.length;){var r=codePointAt(e,t),n=codePointSize(r);this.chars.push(r);var i=e.slice(t,t+n),o=i.toUpperCase();this.folded.push(codePointAt(o==i?i.toLowerCase():o,0));t+=n}this.astral=e.length!=this.chars.length}e.prototype.match=function(e){if(this.pattern.length==0)return[0];if(e.length<this.pattern.length)return null;var t=this,r=t.chars,n=t.folded,i=t.any,o=t.precise,a=t.byWord;if(r.length==1){var s=codePointAt(e,0);return s==r[0]?[0,0,codePointSize(s)]:s==n[0]?[-200,0,codePointSize(s)]:null}var l=e.indexOf(this.pattern);if(l==0)return[0,0,this.pattern.length];var c=r.length,u=0;if(l<0){for(var f=0,h=Math.min(e.length,200);f<h&&u<c;){var d=codePointAt(e,f);if(d==r[u]||d==n[u])i[u++]=f;f+=codePointSize(d)}if(u<c)return null}var p=0;var g=0,v=false;var m=0,y=-1,b=-1;var w=/[a-z]/.test(e),x=true;for(var S=0,h=Math.min(e.length,200),k=0;S<h&&g<c;){var d=codePointAt(e,S);if(l<0){if(p<c&&d==r[p])o[p++]=S;if(m<c){if(d==r[m]||d==n[m]){if(m==0)y=S;b=S+1;m++}else{m=0}}}var C=void 0,M=d<255?d>=48&&d<=57||d>=97&&d<=122?2:d>=65&&d<=90?1:0:(C=fromCodePoint(d))!=C.toLowerCase()?1:C!=C.toUpperCase()?2:0;if(!S||M==1&&w||k==0&&M!=0){if(r[g]==d||n[g]==d&&(v=true))a[g++]=S;else if(a.length)x=false}k=M;S+=codePointSize(d)}if(g==c&&a[0]==0&&x)return this.result(-100+(v?-200:0),a,e);if(m==c&&y==0)return[-200-e.length,0,b];if(l>-1)return[-700-e.length,l,l+this.pattern.length];if(m==c)return[-200+-700-e.length,y,b];if(g==c)return this.result(-100+(v?-200:0)+-700+(x?0:-1100),a,e);return r.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,e)};e.prototype.result=function(e,t,r){var n=[e-r.length],i=1;for(var o=0,a=t;o<a.length;o++){var s=a[o];var l=s+(this.astral?codePointSize(codePointAt(r,s)):1);if(i>1&&n[i-1]==s)n[i-1]=l;else{n[i++]=s;n[i++]=l}}return n};return e}();var completionConfig=Facet.define({combine:function(e){return combineConfig(e,{activateOnTyping:true,override:null,maxRenderedOptions:100,defaultKeymap:true,optionClass:function(){return""},aboveCursor:false,icons:true,addToOptions:[]},{defaultKeymap:function(e,t){return e&&t},icons:function(e,t){return e&&t},optionClass:function(e,t){return function(r){return joinClass(e(r),t(r))}},addToOptions:function(e,t){return e.concat(t)}})}});function joinClass(e,t){return e?t?e+" "+t:e:t}function optionContent(e){var t=e.addToOptions.slice();if(e.icons)t.push({render:function(e){var t;var r=document.createElement("div");r.classList.add("cm-completionIcon");if(e.type)(t=r.classList).add.apply(t,e.type.split(/\s+/g).map((function(e){return"cm-completionIcon-"+e})));r.setAttribute("aria-hidden","true");return r},position:20});t.push({render:function(e,t,r){var n=document.createElement("span");n.className="cm-completionLabel";var i=e.label,o=0;for(var a=1;a<r.length;){var s=r[a++],l=r[a++];if(s>o)n.appendChild(document.createTextNode(i.slice(o,s)));var c=n.appendChild(document.createElement("span"));c.appendChild(document.createTextNode(i.slice(s,l)));c.className="cm-completionMatchedText";o=l}if(o<i.length)n.appendChild(document.createTextNode(i.slice(o)));return n},position:50},{render:function(e){if(!e.detail)return null;var t=document.createElement("span");t.className="cm-completionDetail";t.textContent=e.detail;return t},position:80});return t.sort((function(e,t){return e.position-t.position})).map((function(e){return e.render}))}function rangeAroundSelected(e,t,r){if(e<=r)return{from:0,to:e};if(t<=e>>1){var n=Math.floor(t/r);return{from:n*r,to:(n+1)*r}}var i=Math.floor((e-t)/r);return{from:e-(i+1)*r,to:e-i*r}}var CompletionTooltip=function(){function e(e,t){var r=this;this.view=e;this.stateField=t;this.info=null;this.placeInfo={read:function(){return r.measureInfo()},write:function(e){return r.positionInfo(e)},key:this};var n=e.state.field(t);var i=n.open,o=i.options,a=i.selected;var s=e.state.facet(completionConfig);this.optionContent=optionContent(s);this.optionClass=s.optionClass;this.range=rangeAroundSelected(o.length,a,s.maxRenderedOptions);this.dom=document.createElement("div");this.dom.className="cm-tooltip-autocomplete";this.dom.addEventListener("mousedown",(function(t){for(var n=t.target,i=void 0;n&&n!=r.dom;n=n.parentNode){if(n.nodeName=="LI"&&(i=/-(\d+)$/.exec(n.id))&&+i[1]<o.length){applyCompletion(e,o[+i[1]]);t.preventDefault();return}}}));this.list=this.dom.appendChild(this.createListBox(o,n.id,this.range));this.list.addEventListener("scroll",(function(){if(r.info)r.view.requestMeasure(r.placeInfo)}))}e.prototype.mount=function(){this.updateSel()};e.prototype.update=function(e){if(e.state.field(this.stateField)!=e.startState.field(this.stateField))this.updateSel()};e.prototype.positioned=function(){if(this.info)this.view.requestMeasure(this.placeInfo)};e.prototype.updateSel=function(){var e=this;var t=this.view.state.field(this.stateField),r=t.open;if(r.selected<this.range.from||r.selected>=this.range.to){this.range=rangeAroundSelected(r.options.length,r.selected,this.view.state.facet(completionConfig).maxRenderedOptions);this.list.remove();this.list=this.dom.appendChild(this.createListBox(r.options,t.id,this.range));this.list.addEventListener("scroll",(function(){if(e.info)e.view.requestMeasure(e.placeInfo)}))}if(this.updateSelectedOption(r.selected)){if(this.info){this.info.remove();this.info=null}var n=r.options[r.selected].completion;var i=n.info;if(!i)return;var o=typeof i==="string"?document.createTextNode(i):i(n);if(!o)return;if("then"in o){o.then((function(r){if(r&&e.view.state.field(e.stateField,false)==t)e.addInfoPane(r)})).catch((function(t){return logException(e.view.state,t,"completion info")}))}else{this.addInfoPane(o)}}};e.prototype.addInfoPane=function(e){var t=this.info=document.createElement("div");t.className="cm-tooltip cm-completionInfo";t.appendChild(e);this.dom.appendChild(t);this.view.requestMeasure(this.placeInfo)};e.prototype.updateSelectedOption=function(e){var t=null;for(var r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++){if(n==e){if(!r.hasAttribute("aria-selected")){r.setAttribute("aria-selected","true");t=r}}else{if(r.hasAttribute("aria-selected"))r.removeAttribute("aria-selected")}}if(t)scrollIntoView(this.list,t);return t};e.prototype.measureInfo=function(){var e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;var t=this.dom.getBoundingClientRect();var r=this.info.getBoundingClientRect();var n=e.getBoundingClientRect();if(n.top>Math.min(innerHeight,t.bottom)-10||n.bottom<Math.max(0,t.top)+10)return null;var i=Math.max(0,Math.min(n.top,innerHeight-r.height))-t.top;var o=this.view.textDirection==Direction.RTL;var a=t.left,s=innerWidth-t.right;if(o&&a<Math.min(r.width,s))o=false;else if(!o&&s<Math.min(r.width,a))o=true;return{top:i,left:o}};e.prototype.positionInfo=function(e){if(this.info){this.info.style.top=(e?e.top:-1e6)+"px";if(e){this.info.classList.toggle("cm-completionInfo-left",e.left);this.info.classList.toggle("cm-completionInfo-right",!e.left)}}};e.prototype.createListBox=function(e,t,r){var n=document.createElement("ul");n.id=t;n.setAttribute("role","listbox");n.setAttribute("aria-expanded","true");for(var i=r.from;i<r.to;i++){var o=e[i],a=o.completion,s=o.match;var l=n.appendChild(document.createElement("li"));l.id=t+"-"+i;l.setAttribute("role","option");var c=this.optionClass(a);if(c)l.className=c;for(var u=0,f=this.optionContent;u<f.length;u++){var h=f[u];var d=h(a,this.view.state,s);if(d)l.appendChild(d)}}if(r.from)n.classList.add("cm-completionListIncompleteTop");if(r.to<e.length)n.classList.add("cm-completionListIncompleteBottom");return n};return e}();function completionTooltip(e){return function(t){return new CompletionTooltip(t,e)}}function scrollIntoView(e,t){var r=e.getBoundingClientRect();var n=t.getBoundingClientRect();if(n.top<r.top)e.scrollTop-=r.top-n.top;else if(n.bottom>r.bottom)e.scrollTop+=n.bottom-r.bottom}var MaxOptions=300;function score(e){return(e.boost||0)*100+(e.apply?10:0)+(e.info?5:0)+(e.type?1:0)}function sortOptions(e,t){var r=[],n=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];if(a.hasResult()){if(a.result.filter===false){for(var s=0,l=a.result.options;s<l.length;s++){var c=l[s];r.push(new Option(c,a,[1e9-n++]))}}else{var u=new FuzzyMatcher(t.sliceDoc(a.from,a.to)),f=void 0;for(var h=0,d=a.result.options;h<d.length;h++){var c=d[h];if(f=u.match(c.label)){if(c.boost!=null)f[0]+=c.boost;r.push(new Option(c,a,f))}}}}}var p=[],g=null;for(var v=0,m=r.sort(cmpOption);v<m.length;v++){var y=m[v];if(p.length==MaxOptions)break;if(!g||g.label!=y.completion.label||g.detail!=y.completion.detail||g.type!=y.completion.type||g.apply!=y.completion.apply)p.push(y);else if(score(y.completion)>score(g))p[p.length-1]=y;g=y.completion}return p}var CompletionDialog=function(){function e(e,t,r,n,i){this.options=e;this.attrs=t;this.tooltip=r;this.timestamp=n;this.selected=i}e.prototype.setSelected=function(t,r){return t==this.selected||t>=this.options.length?this:new e(this.options,makeAttrs(r,t),this.tooltip,this.timestamp,t)};e.build=function(t,r,n,i,o){var a=sortOptions(t,r);if(!a.length)return null;var s=0;if(i&&i.selected){var l=i.options[i.selected].completion;for(var c=0;c<a.length;c++)if(a[c].completion==l){s=c;break}}return new e(a,makeAttrs(n,s),{pos:t.reduce((function(e,t){return t.hasResult()?Math.min(e,t.from):e}),1e8),create:completionTooltip(completionState),above:o.aboveCursor},i?i.timestamp:Date.now(),s)};e.prototype.map=function(t){return new e(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:t.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)};return e}();var CompletionState=function(){function e(e,t,r){this.active=e;this.id=t;this.open=r}e.start=function(){return new e(none$1,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)};e.prototype.update=function(t){var r=this;var n=t.state,i=n.facet(completionConfig);var o=i.override||n.languageDataAt("autocomplete",cur(n)).map(asSource);var a=o.map((function(e){var n=r.active.find((function(t){return t.source==e}))||new ActiveSource(e,r.active.some((function(e){return e.state!=0}))?1:0);return n.update(t,i)}));if(a.length==this.active.length&&a.every((function(e,t){return e==r.active[t]})))a=this.active;var s=t.selection||a.some((function(e){return e.hasResult()&&t.changes.touchesRange(e.from,e.to)}))||!sameResults(a,this.active)?CompletionDialog.build(a,n,this.id,this.open,i):this.open&&t.docChanged?this.open.map(t.changes):this.open;if(!s&&a.every((function(e){return e.state!=1}))&&a.some((function(e){return e.hasResult()})))a=a.map((function(e){return e.hasResult()?new ActiveSource(e.source,0):e}));for(var l=0,c=t.effects;l<c.length;l++){var u=c[l];if(u.is(setSelectedEffect))s=s&&s.setSelected(u.value,this.id)}return a==this.active&&s==this.open?this:new e(a,this.id,s)};Object.defineProperty(e.prototype,"tooltip",{get:function(){return this.open?this.open.tooltip:null},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"attrs",{get:function(){return this.open?this.open.attrs:baseAttrs},enumerable:false,configurable:true});return e}();function sameResults(e,t){if(e==t)return true;for(var r=0,n=0;;){while(r<e.length&&!e[r].hasResult)r++;while(n<t.length&&!t[n].hasResult)n++;var i=r==e.length,o=n==t.length;if(i||o)return i==o;if(e[r++].result!=t[n++].result)return false}}var baseAttrs={"aria-autocomplete":"list"};function makeAttrs(e,t){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":e+"-"+t,"aria-controls":e}}var none$1=[];function cmpOption(e,t){var r=t.match[0]-e.match[0];if(r)return r;return e.completion.label.localeCompare(t.completion.label)}function getUserEvent(e){return e.isUserEvent("input.type")?"input":e.isUserEvent("delete.backward")?"delete":null}var ActiveSource=function(){function e(e,t,r){if(r===void 0){r=-1}this.source=e;this.state=t;this.explicitPos=r}e.prototype.hasResult=function(){return false};e.prototype.update=function(t,r){var n=getUserEvent(t),i=this;if(n)i=i.handleUserEvent(t,n,r);else if(t.docChanged)i=i.handleChange(t);else if(t.selection&&i.state!=0)i=new e(i.source,0);for(var o=0,a=t.effects;o<a.length;o++){var s=a[o];if(s.is(startCompletionEffect))i=new e(i.source,1,s.value?cur(t.state):-1);else if(s.is(closeCompletionEffect))i=new e(i.source,0);else if(s.is(setActiveEffect))for(var l=0,c=s.value;l<c.length;l++){var u=c[l];if(u.source==i.source)i=u}}return i};e.prototype.handleUserEvent=function(t,r,n){return r=="delete"||!n.activateOnTyping?this.map(t.changes):new e(this.source,1)};e.prototype.handleChange=function(t){return t.changes.touchesRange(cur(t.startState))?new e(this.source,0):this.map(t.changes)};e.prototype.map=function(t){return t.empty||this.explicitPos<0?this:new e(this.source,this.state,t.mapPos(this.explicitPos))};return e}();var ActiveResult=function(e){__extends(t,e);function t(t,r,n,i,o,a){var s=e.call(this,t,2,r)||this;s.result=n;s.from=i;s.to=o;s.span=a;return s}t.prototype.hasResult=function(){return true};t.prototype.handleUserEvent=function(e,r,n){var i=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1);var a=cur(e.state);if((this.explicitPos<0?a<=i:a<this.from)||a>o||r=="delete"&&cur(e.startState)==this.from)return new ActiveSource(this.source,r=="input"&&n.activateOnTyping?1:0);var s=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos);if(this.span&&(i==o||this.span.test(e.state.sliceDoc(i,o))))return new t(this.source,s,this.result,i,o,this.span);return new ActiveSource(this.source,1,s)};t.prototype.handleChange=function(e){return e.changes.touchesRange(this.from,this.to)?new ActiveSource(this.source,0):this.map(e.changes)};t.prototype.map=function(e){return e.empty?this:new t(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1),this.span)};return t}(ActiveSource);var startCompletionEffect=StateEffect.define();var closeCompletionEffect=StateEffect.define();var setActiveEffect=StateEffect.define({map:function(e,t){return e.map((function(e){return e.map(t)}))}});var setSelectedEffect=StateEffect.define();var completionState=StateField.define({create:function(){return CompletionState.start()},update:function(e,t){return e.update(t)},provide:function(e){return[showTooltip.from(e,(function(e){return e.tooltip})),EditorView.contentAttributes.from(e,(function(e){return e.attrs}))]}});var CompletionInteractMargin=75;function moveCompletionSelection(e,t){if(t===void 0){t="option"}return function(r){var n=r.state.field(completionState,false);if(!n||!n.open||Date.now()-n.open.timestamp<CompletionInteractMargin)return false;var i=1,o;if(t=="page"&&(o=getTooltip(r,n.open.tooltip)))i=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1);var a=n.open.selected+i*(e?1:-1),s=n.open.options.length;if(a<0)a=t=="page"?0:s-1;else if(a>=s)a=t=="page"?s-1:0;r.dispatch({effects:setSelectedEffect.of(a)});return true}}var acceptCompletion=function(e){var t=e.state.field(completionState,false);if(e.state.readOnly||!t||!t.open||Date.now()-t.open.timestamp<CompletionInteractMargin)return false;applyCompletion(e,t.open.options[t.open.selected]);return true};var startCompletion=function(e){var t=e.state.field(completionState,false);if(!t)return false;e.dispatch({effects:startCompletionEffect.of(true)});return true};var closeCompletion=function(e){var t=e.state.field(completionState,false);if(!t||!t.active.some((function(e){return e.state!=0})))return false;e.dispatch({effects:closeCompletionEffect.of(null)});return true};var RunningQuery=function(){function e(e,t){this.active=e;this.context=t;this.time=Date.now();this.updates=[];this.done=undefined}return e}();var DebounceTime=50,MaxUpdateCount=50,MinAbortTime=1e3;var completionPlugin=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.debounceUpdate=-1;this.running=[];this.debounceAccept=-1;this.composing=0;for(var t=0,r=e.state.field(completionState).active;t<r.length;t++){var n=r[t];if(n.state==1)this.startQuery(n)}}e.prototype.update=function(e){var t;var r=this;var n=e.state.field(completionState);if(!e.selectionSet&&!e.docChanged&&e.startState.field(completionState)==n)return;var i=e.transactions.some((function(e){return(e.selection||e.docChanged)&&!getUserEvent(e)}));for(var o=0;o<this.running.length;o++){var a=this.running[o];if(i||a.updates.length+e.transactions.length>MaxUpdateCount&&Date.now()-a.time>MinAbortTime){for(var s=0,l=a.context.abortListeners;s<l.length;s++){var c=l[s];try{c()}catch(d){logException(this.view.state,d)}}a.context.abortListeners=null;this.running.splice(o--,1)}else{(t=a.updates).push.apply(t,e.transactions)}}if(this.debounceUpdate>-1)clearTimeout(this.debounceUpdate);this.debounceUpdate=n.active.some((function(e){return e.state==1&&!r.running.some((function(t){return t.active.source==e.source}))}))?setTimeout((function(){return r.startUpdate()}),DebounceTime):-1;if(this.composing!=0)for(var u=0,f=e.transactions;u<f.length;u++){var h=f[u];if(getUserEvent(h)=="input")this.composing=2;else if(this.composing==2&&h.selection)this.composing=3}};e.prototype.startUpdate=function(){this.debounceUpdate=-1;var e=this.view.state,t=e.field(completionState);var r=function(e){if(e.state==1&&!n.running.some((function(t){return t.active.source==e.source})))n.startQuery(e)};var n=this;for(var i=0,o=t.active;i<o.length;i++){var a=o[i];r(a)}};e.prototype.startQuery=function(e){var t=this;var r=this.view.state,n=cur(r);var i=new CompletionContext(r,n,e.explicitPos==n);var o=new RunningQuery(e,i);this.running.push(o);Promise.resolve(e.source(i)).then((function(e){if(!o.context.aborted){o.done=e||null;t.scheduleAccept()}}),(function(e){t.view.dispatch({effects:closeCompletionEffect.of(null)});logException(t.view.state,e)}))};e.prototype.scheduleAccept=function(){var e=this;if(this.running.every((function(e){return e.done!==undefined})))this.accept();else if(this.debounceAccept<0)this.debounceAccept=setTimeout((function(){return e.accept()}),DebounceTime)};e.prototype.accept=function(){var e;if(this.debounceAccept>-1)clearTimeout(this.debounceAccept);this.debounceAccept=-1;var t=[];var r=this.view.state.facet(completionConfig);var n=function(n){var a=i.running[n];if(a.done===undefined)return o=n,"continue";i.running.splice(n--,1);if(a.done){var s=new ActiveResult(a.active.source,a.active.explicitPos,a.done,a.done.from,(e=a.done.to)!==null&&e!==void 0?e:cur(a.updates.length?a.updates[0].startState:i.view.state),a.done.span&&a.done.filter!==false?ensureAnchor(a.done.span,true):null);for(var l=0,c=a.updates;l<c.length;l++){var u=c[l];s=s.update(u,r)}if(s.hasResult()){t.push(s);return o=n,"continue"}}var f=i.view.state.field(completionState).active.find((function(e){return e.source==a.active.source}));if(f&&f.state==1){if(a.done==null){var s=new ActiveSource(a.active.source,0);for(var h=0,d=a.updates;h<d.length;h++){var u=d[h];s=s.update(u,r)}if(s.state!=1)t.push(s)}else{i.startQuery(f)}}o=n};var i=this,o;for(var a=0;a<this.running.length;a++){n(a);a=o}if(t.length)this.view.dispatch({effects:setActiveEffect.of(t)})};return e}(),{eventHandlers:{compositionstart:function(){this.composing=1},compositionend:function(){var e=this;if(this.composing==3){setTimeout((function(){return e.view.dispatch({effects:startCompletionEffect.of(false)})}),20)}this.composing=0}}});var baseTheme$6=EditorView.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var FieldPos=function(){function e(e,t,r,n){this.field=e;this.line=t;this.from=r;this.to=n}return e}();var FieldRange=function(){function e(e,t,r){this.field=e;this.from=t;this.to=r}e.prototype.map=function(t){var r=t.mapPos(this.from,-1,MapMode.TrackDel);var n=t.mapPos(this.to,1,MapMode.TrackDel);return r==null||n==null?null:new e(this.field,r,n)};return e}();var Snippet=function(){function e(e,t){this.lines=e;this.fieldPositions=t}e.prototype.instantiate=function(e,t){var r=[],n=[t];var i=e.doc.lineAt(t),o=/^\s*/.exec(i.text)[0];for(var a=0,s=this.lines;a<s.length;a++){var l=s[a];if(r.length){var c=o,u=/^\t*/.exec(l)[0].length;for(var f=0;f<u;f++)c+=e.facet(indentUnit);n.push(t+c.length-u);l=c+l.slice(u)}r.push(l);t+=l.length+1}var h=this.fieldPositions.map((function(e){return new FieldRange(e.field,n[e.line]+e.from,n[e.line]+e.to)}));return{text:r,ranges:h}};e.parse=function(t){var r=[];var n=[],i=[],o;for(var a=0,s=t.split(/\r\n?|\n/);a<s.length;a++){var l=s[a];while(o=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(l)){var c=o[1]?+o[1]:null,u=o[2]||o[3]||"",f=-1;for(var h=0;h<r.length;h++){if(c!=null?r[h].seq==c:u?r[h].name==u:false)f=h}if(f<0){var d=0;while(d<r.length&&(c==null||r[d].seq!=null&&r[d].seq<c))d++;r.splice(d,0,{seq:c,name:u});f=d;for(var p=0,g=i;p<g.length;p++){var v=g[p];if(v.field>=f)v.field++}}i.push(new FieldPos(f,n.length,o.index,o.index+u.length));l=l.slice(0,o.index)+u+l.slice(o.index+o[0].length)}n.push(l)}return new e(n,i)};return e}();var fieldMarker=Decoration.widget({widget:new(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.toDOM=function(){var e=document.createElement("span");e.className="cm-snippetFieldPosition";return e};t.prototype.ignoreEvent=function(){return false};return t}(WidgetType))});var fieldRange=Decoration.mark({class:"cm-snippetField"});var ActiveSnippet=function(){function e(e,t){this.ranges=e;this.active=t;this.deco=Decoration.set(e.map((function(e){return(e.from==e.to?fieldMarker:fieldRange).range(e.from,e.to)})))}e.prototype.map=function(t){var r=[];for(var n=0,i=this.ranges;n<i.length;n++){var o=i[n];var a=o.map(t);if(!a)return null;r.push(a)}return new e(r,this.active)};e.prototype.selectionInsideField=function(e){var t=this;return e.ranges.every((function(e){return t.ranges.some((function(r){return r.field==t.active&&r.from<=e.from&&r.to>=e.to}))}))};return e}();var setActive=StateEffect.define({map:function(e,t){return e&&e.map(t)}});var moveToField=StateEffect.define();var snippetState=StateField.define({create:function(){return null},update:function(e,t){for(var r=0,n=t.effects;r<n.length;r++){var i=n[r];if(i.is(setActive))return i.value;if(i.is(moveToField)&&e)return new ActiveSnippet(e.ranges,i.value)}if(e&&t.docChanged)e=e.map(t.changes);if(e&&t.selection&&!e.selectionInsideField(t.selection))e=null;return e},provide:function(e){return EditorView.decorations.from(e,(function(e){return e?e.deco:Decoration.none}))}});function fieldSelection(e,t){return EditorSelection.create(e.filter((function(e){return e.field==t})).map((function(e){return EditorSelection.range(e.from,e.to)})))}function snippet(e){var t=Snippet.parse(e);return function(e,r,n,i){var o=t.instantiate(e.state,n),a=o.text,s=o.ranges;var l={changes:{from:n,to:i,insert:Text.of(a)}};if(s.length)l.selection=fieldSelection(s,0);if(s.length>1){var c=new ActiveSnippet(s,0);var u=l.effects=[setActive.of(c)];if(e.state.field(snippetState,false)===undefined)u.push(StateEffect.appendConfig.of([snippetState,addSnippetKeymap,snippetPointerHandler,baseTheme$6]))}e.dispatch(e.state.update(l))}}function moveField(e){return function(t){var r=t.state,n=t.dispatch;var i=r.field(snippetState,false);if(!i||e<0&&i.active==0)return false;var o=i.active+e,a=e>0&&!i.ranges.some((function(t){return t.field==o+e}));n(r.update({selection:fieldSelection(i.ranges,o),effects:setActive.of(a?null:new ActiveSnippet(i.ranges,o))}));return true}}var clearSnippet=function(e){var t=e.state,r=e.dispatch;var n=t.field(snippetState,false);if(!n)return false;r(t.update({effects:setActive.of(null)}));return true};var nextSnippetField=moveField(1);var prevSnippetField=moveField(-1);var defaultSnippetKeymap=[{key:"Tab",run:nextSnippetField,shift:prevSnippetField},{key:"Escape",run:clearSnippet}];var snippetKeymap=Facet.define({combine:function(e){return e.length?e[0]:defaultSnippetKeymap}});var addSnippetKeymap=Prec.highest(keymap.compute([snippetKeymap],(function(e){return e.facet(snippetKeymap)})));function snippetCompletion(e,t){return Object.assign(Object.assign({},t),{apply:snippet(e)})}var snippetPointerHandler=EditorView.domEventHandlers({mousedown:function(e,t){var r=t.state.field(snippetState,false),n;if(!r||(n=t.posAtCoords({x:e.clientX,y:e.clientY}))==null)return false;var i=r.ranges.find((function(e){return e.from<=n&&e.to>=n}));if(!i||i.field==r.active)return false;t.dispatch({selection:fieldSelection(r.ranges,i.field),effects:setActive.of(r.ranges.some((function(e){return e.field>i.field}))?new ActiveSnippet(r.ranges,i.field):null)});return true}});function wordRE(e){var t=e.replace(/[\\[.+*?(){|^$]/g,"\\$&");try{return new RegExp("[\\p{Alphabetic}\\p{Number}_".concat(t,"]+"),"ug")}catch(r){return new RegExp("[w".concat(t,"]"),"g")}}function mapRE(e,t){return new RegExp(t(e.source),e.unicode?"u":"")}var wordCaches=Object.create(null);function wordCache(e){return wordCaches[e]||(wordCaches[e]=new WeakMap)}function storeWords(e,t,r,n,i){for(var o=e.iterLines(),a=0;!o.next().done;){var s=o.value,l=void 0;t.lastIndex=0;while(l=t.exec(s)){if(!n[l[0]]&&a+l.index!=i){r.push({type:"text",label:l[0]});n[l[0]]=true;if(r.length>=2e3)return}}a+=s.length+1}}function collectWords(e,t,r,n,i){var o=e.length>=1e3;var a=o&&t.get(e);if(a)return a;var s=[],l=Object.create(null);if(e.children){var c=0;for(var u=0,f=e.children;u<f.length;u++){var h=f[u];if(h.length>=1e3){for(var d=0,p=collectWords(h,t,r,n-c,i-c);d<p.length;d++){var g=p[d];if(!l[g.label]){l[g.label]=true;s.push(g)}}}else{storeWords(h,r,s,l,i-c)}c+=h.length+1}}else{storeWords(e,r,s,l,i)}if(o&&s.length<2e3)t.set(e,s);return s}var completeAnyWord=function(e){var t=e.state.languageDataAt("wordChars",e.pos).join("");var r=wordRE(t);var n=e.matchBefore(mapRE(r,(function(e){return e+"$"})));if(!n&&!e.explicit)return null;var i=n?n.from:e.pos;var o=collectWords(e.state.doc,wordCache(t),r,5e4,i);return{from:i,options:o,span:mapRE(r,(function(e){return"^"+e}))}};function autocompletion(e){if(e===void 0){e={}}return[completionState,completionConfig.of(e),completionPlugin,completionKeymapExt,baseTheme$6]}var completionKeymap=[{key:"Ctrl-Space",run:startCompletion},{key:"Escape",run:closeCompletion},{key:"ArrowDown",run:moveCompletionSelection(true)},{key:"ArrowUp",run:moveCompletionSelection(false)},{key:"PageDown",run:moveCompletionSelection(true,"page")},{key:"PageUp",run:moveCompletionSelection(false,"page")},{key:"Enter",run:acceptCompletion}];var completionKeymapExt=Prec.highest(keymap.computeN([completionConfig],(function(e){return e.facet(completionConfig).defaultKeymap?[completionKeymap]:[]})));var defaults$1={brackets:["(","[","{","'",'"'],before:")]}'\":;>"};var closeBracketEffect=StateEffect.define({map:function(e,t){var r=t.mapPos(e,-1,MapMode.TrackAfter);return r==null?undefined:r}});var skipBracketEffect=StateEffect.define({map:function(e,t){return t.mapPos(e)}});var closedBracket=new(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t}(RangeValue));closedBracket.startSide=1;closedBracket.endSide=-1;var bracketState=StateField.define({create:function(){return RangeSet.empty},update:function(e,t){if(t.selection){var r=t.state.doc.lineAt(t.selection.main.head).from;var n=t.startState.doc.lineAt(t.startState.selection.main.head).from;if(r!=t.changes.mapPos(n,-1))e=RangeSet.empty}e=e.map(t.changes);var i=function(t){if(t.is(closeBracketEffect))e=e.update({add:[closedBracket.range(t.value,t.value+1)]});else if(t.is(skipBracketEffect))e=e.update({filter:function(e){return e!=t.value}})};for(var o=0,a=t.effects;o<a.length;o++){var s=a[o];i(s)}return e}});function closeBrackets(){return[inputHandler,bracketState]}var definedClosing="()[]{}<>";function closing(e){for(var t=0;t<definedClosing.length;t+=2)if(definedClosing.charCodeAt(t)==e)return definedClosing.charAt(t+1);return fromCodePoint(e<128?e:e+1)}function config(e,t){return e.languageDataAt("closeBrackets",t)[0]||defaults$1}var android=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent);var inputHandler=EditorView.inputHandler.of((function(e,t,r,n){if((android?e.composing:e.compositionStarted)||e.state.readOnly)return false;var i=e.state.selection.main;if(n.length>2||n.length==2&&codePointSize(codePointAt(n,0))==1||t!=i.from||r!=i.to)return false;var o=insertBracket(e.state,n);if(!o)return false;e.dispatch(o);return true}));var deleteBracketPair=function(e){var t=e.state,r=e.dispatch;if(t.readOnly)return false;var n=config(t,t.selection.main.head);var i=n.brackets||defaults$1.brackets;var o=null,a=t.changeByRange((function(e){if(e.empty){var r=prevChar(t.doc,e.head);for(var n=0,a=i;n<a.length;n++){var s=a[n];if(s==r&&nextChar(t.doc,e.head)==closing(codePointAt(s,0)))return{changes:{from:e.head-s.length,to:e.head+s.length},range:EditorSelection.cursor(e.head-s.length),userEvent:"delete.backward"}}}return{range:o=e}}));if(!o)r(t.update(a,{scrollIntoView:true}));return!o};var closeBracketsKeymap=[{key:"Backspace",run:deleteBracketPair}];function insertBracket(e,t){var r=config(e,e.selection.main.head);var n=r.brackets||defaults$1.brackets;for(var i=0,o=n;i<o.length;i++){var a=o[i];var s=closing(codePointAt(a,0));if(t==a)return s==a?handleSame(e,a,n.indexOf(a+a+a)>-1):handleOpen(e,a,s,r.before||defaults$1.before);if(t==s&&closedBracketAt(e,e.selection.main.from))return handleClose(e,a,s)}return null}function closedBracketAt(e,t){var r=false;e.field(bracketState).between(0,e.doc.length,(function(e){if(e==t)r=true}));return r}function nextChar(e,t){var r=e.sliceString(t,t+2);return r.slice(0,codePointSize(codePointAt(r,0)))}function prevChar(e,t){var r=e.sliceString(t-2,t);return codePointSize(codePointAt(r,0))==r.length?r:r.slice(1)}function handleOpen(e,t,r,n){var i=null,o=e.changeByRange((function(o){if(!o.empty)return{changes:[{insert:t,from:o.from},{insert:r,from:o.to}],effects:closeBracketEffect.of(o.to+t.length),range:EditorSelection.range(o.anchor+t.length,o.head+t.length)};var a=nextChar(e.doc,o.head);if(!a||/\s/.test(a)||n.indexOf(a)>-1)return{changes:{insert:t+r,from:o.head},effects:closeBracketEffect.of(o.head+t.length),range:EditorSelection.cursor(o.head+t.length)};return{range:i=o}}));return i?null:e.update(o,{scrollIntoView:true,userEvent:"input.type"})}function handleClose(e,t,r){var n=null,i=e.selection.ranges.map((function(t){if(t.empty&&nextChar(e.doc,t.head)==r)return EditorSelection.cursor(t.head+r.length);return n=t}));return n?null:e.update({selection:EditorSelection.create(i,e.selection.mainIndex),scrollIntoView:true,effects:e.selection.ranges.map((function(e){var t=e.from;return skipBracketEffect.of(t)}))})}function handleSame(e,t,r){var n=null,i=e.changeByRange((function(i){if(!i.empty)return{changes:[{insert:t,from:i.from},{insert:t,from:i.to}],effects:closeBracketEffect.of(i.to+t.length),range:EditorSelection.range(i.anchor+t.length,i.head+t.length)};var o=i.head,a=nextChar(e.doc,o);if(a==t){if(nodeStart(e,o)){return{changes:{insert:t+t,from:o},effects:closeBracketEffect.of(o+t.length),range:EditorSelection.cursor(o+t.length)}}else if(closedBracketAt(e,o)){var s=r&&e.sliceDoc(o,o+t.length*3)==t+t+t;return{range:EditorSelection.cursor(o+t.length*(s?3:1)),effects:skipBracketEffect.of(o)}}}else if(r&&e.sliceDoc(o-2*t.length,o)==t+t&&nodeStart(e,o-2*t.length)){return{changes:{insert:t+t+t+t,from:o},effects:closeBracketEffect.of(o+t.length),range:EditorSelection.cursor(o+t.length)}}else if(e.charCategorizer(o)(a)!=CharCategory.Word){var l=e.sliceDoc(o-1,o);if(l!=t&&e.charCategorizer(o)(l)!=CharCategory.Word&&!probablyInString(e,o,t))return{changes:{insert:t+t,from:o},effects:closeBracketEffect.of(o+t.length),range:EditorSelection.cursor(o+t.length)}}return{range:n=i}}));return n?null:e.update(i,{scrollIntoView:true,userEvent:"input.type"})}function nodeStart(e,t){var r=syntaxTree(e).resolveInner(t+1);return r.parent&&r.from==t}function probablyInString(e,t,r){var n=syntaxTree(e).resolveInner(t,-1);for(var i=0;i<5;i++){if(e.sliceDoc(n.from,n.from+r.length)==r)return true;var o=n.to==t&&n.parent;if(!o)break;n=o}return false}var baseTheme$5=EditorView.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}});var DefaultScanDist=1e4,DefaultBrackets="()[]{}";var bracketMatchingConfig=Facet.define({combine:function(e){return combineConfig(e,{afterCursor:true,brackets:DefaultBrackets,maxScanDistance:DefaultScanDist})}});var matchingMark=Decoration.mark({class:"cm-matchingBracket"}),nonmatchingMark=Decoration.mark({class:"cm-nonmatchingBracket"});var bracketMatchingState=StateField.define({create:function(){return Decoration.none},update:function(e,t){if(!t.docChanged&&!t.selection)return e;var r=[];var n=t.state.facet(bracketMatchingConfig);for(var i=0,o=t.state.selection.ranges;i<o.length;i++){var a=o[i];if(!a.empty)continue;var s=matchBrackets(t.state,a.head,-1,n)||a.head>0&&matchBrackets(t.state,a.head-1,1,n)||n.afterCursor&&(matchBrackets(t.state,a.head,1,n)||a.head<t.state.doc.length&&matchBrackets(t.state,a.head+1,-1,n));if(!s)continue;var l=s.matched?matchingMark:nonmatchingMark;r.push(l.range(s.start.from,s.start.to));if(s.end)r.push(l.range(s.end.from,s.end.to))}return Decoration.set(r,true)},provide:function(e){return EditorView.decorations.from(e)}});var bracketMatchingUnique=[bracketMatchingState,baseTheme$5];function bracketMatching(e){if(e===void 0){e={}}return[bracketMatchingConfig.of(e),bracketMatchingUnique]}function matchingNodes(e,t,r){var n=e.prop(t<0?NodeProp.openedBy:NodeProp.closedBy);if(n)return n;if(e.name.length==1){var i=r.indexOf(e.name);if(i>-1&&i%2==(t<0?1:0))return[r[i+t]]}return null}function matchBrackets(e,t,r,n){if(n===void 0){n={}}var i=n.maxScanDistance||DefaultScanDist,o=n.brackets||DefaultBrackets;var a=syntaxTree(e),s=a.resolveInner(t,r);for(var l=s;l;l=l.parent){var c=matchingNodes(l.type,r,o);if(c&&l.from<l.to)return matchMarkedBrackets(e,t,r,l,c,o)}return matchPlainBrackets(e,t,r,a,s.type,i,o)}function matchMarkedBrackets(e,t,r,n,i,o){var a=n.parent,s={from:n.from,to:n.to};var l=0,c=a===null||a===void 0?void 0:a.cursor;if(c&&(r<0?c.childBefore(n.from):c.childAfter(n.to)))do{if(r<0?c.to<=n.from:c.from>=n.to){if(l==0&&i.indexOf(c.type.name)>-1&&c.from<c.to){return{start:s,end:{from:c.from,to:c.to},matched:true}}else if(matchingNodes(c.type,r,o)){l++}else if(matchingNodes(c.type,-r,o)){l--;if(l==0)return{start:s,end:c.from==c.to?undefined:{from:c.from,to:c.to},matched:false}}}}while(r<0?c.prevSibling():c.nextSibling());return{start:s,matched:false}}function matchPlainBrackets(e,t,r,n,i,o,a){var s=r<0?e.sliceDoc(t-1,t):e.sliceDoc(t,t+1);var l=a.indexOf(s);if(l<0||l%2==0!=r>0)return null;var c={from:r<0?t-1:t,to:r>0?t+1:t};var u=e.doc.iterRange(t,r>0?e.doc.length:0),f=0;for(var h=0;!u.next().done&&h<=o;){var d=u.value;if(r<0)h+=d.length;var p=t+h*r;for(var g=r>0?0:d.length-1,v=r>0?d.length:-1;g!=v;g+=r){var m=a.indexOf(d[g]);if(m<0||n.resolve(p+g,1).type!=i)continue;if(m%2==0==r>0){f++}else if(f==1){return{start:c,end:{from:p+g,to:p+g+1},matched:m>>1==l>>1}}else{f--}}if(r>0)h+=d.length}return u.done?{start:c,matched:false}:null}function updateSel(e,t){return EditorSelection.create(e.ranges.map(t),e.mainIndex)}function setSel(e,t){return e.update({selection:t,scrollIntoView:true,userEvent:"select"})}function moveSel(e,t){var r=e.state,n=e.dispatch;var i=updateSel(r.selection,t);if(i.eq(r.selection))return false;n(setSel(r,i));return true}function rangeEnd(e,t){return EditorSelection.cursor(t?e.to:e.from)}function cursorByChar(e,t){return moveSel(e,(function(r){return r.empty?e.moveByChar(r,t):rangeEnd(r,t)}))}var cursorCharLeft=function(e){return cursorByChar(e,e.textDirection!=Direction.LTR)};var cursorCharRight=function(e){return cursorByChar(e,e.textDirection==Direction.LTR)};function cursorByGroup(e,t){return moveSel(e,(function(r){return r.empty?e.moveByGroup(r,t):rangeEnd(r,t)}))}var cursorGroupLeft=function(e){return cursorByGroup(e,e.textDirection!=Direction.LTR)};var cursorGroupRight=function(e){return cursorByGroup(e,e.textDirection==Direction.LTR)};function interestingNode(e,t,r){if(t.type.prop(r))return true;var n=t.to-t.from;return n&&(n>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function moveBySyntax(e,t,r){var n=syntaxTree(e).resolveInner(t.head);var i=r?NodeProp.closedBy:NodeProp.openedBy;for(var o=t.head;;){var a=r?n.childAfter(o):n.childBefore(o);if(!a)break;if(interestingNode(e,a,i))n=a;else o=r?a.to:a.from}var s=n.type.prop(i),l,c;if(s&&(l=r?matchBrackets(e,n.from,1):matchBrackets(e,n.to,-1))&&l.matched)c=r?l.end.to:l.end.from;else c=r?n.to:n.from;return EditorSelection.cursor(c,r?-1:1)}var cursorSyntaxLeft=function(e){return moveSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection!=Direction.LTR)}))};var cursorSyntaxRight=function(e){return moveSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection==Direction.LTR)}))};function cursorByLine(e,t){return moveSel(e,(function(r){if(!r.empty)return rangeEnd(r,t);var n=e.moveVertically(r,t);return n.head!=r.head?n:e.moveToLineBoundary(r,t)}))}var cursorLineUp=function(e){return cursorByLine(e,false)};var cursorLineDown=function(e){return cursorByLine(e,true)};function cursorByPage(e,t){var r=e.state,n=updateSel(r.selection,(function(r){return r.empty?e.moveVertically(r,t,e.dom.clientHeight):rangeEnd(r,t)}));if(n.eq(r.selection))return false;var i=e.coordsAtPos(r.selection.main.head);var o=e.scrollDOM.getBoundingClientRect();e.dispatch(setSel(r,n),{effects:i&&i.top>o.top&&i.bottom<o.bottom?EditorView.scrollIntoView(n.main.head,{y:"start",yMargin:i.top-o.top}):undefined});return true}var cursorPageUp=function(e){return cursorByPage(e,false)};var cursorPageDown=function(e){return cursorByPage(e,true)};function moveByLineBoundary(e,t,r){var n=e.lineBlockAt(t.head),i=e.moveToLineBoundary(t,r);if(i.head==t.head&&i.head!=(r?n.to:n.from))i=e.moveToLineBoundary(t,r,false);if(!r&&i.head==n.from&&n.length){var o=/^\s*/.exec(e.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;if(o&&t.head!=n.from+o)i=EditorSelection.cursor(n.from+o)}return i}var cursorLineBoundaryForward=function(e){return moveSel(e,(function(t){return moveByLineBoundary(e,t,true)}))};var cursorLineBoundaryBackward=function(e){return moveSel(e,(function(t){return moveByLineBoundary(e,t,false)}))};var cursorLineStart=function(e){return moveSel(e,(function(t){return EditorSelection.cursor(e.lineBlockAt(t.head).from,1)}))};var cursorLineEnd=function(e){return moveSel(e,(function(t){return EditorSelection.cursor(e.lineBlockAt(t.head).to,-1)}))};function toMatchingBracket(e,t,r){var n=false,i=updateSel(e.selection,(function(t){var i=matchBrackets(e,t.head,-1)||matchBrackets(e,t.head,1)||t.head>0&&matchBrackets(e,t.head-1,1)||t.head<e.doc.length&&matchBrackets(e,t.head+1,-1);if(!i||!i.end)return t;n=true;var o=i.start.from==t.head?i.end.to:i.end.from;return r?EditorSelection.range(t.anchor,o):EditorSelection.cursor(o)}));if(!n)return false;t(setSel(e,i));return true}var cursorMatchingBracket=function(e){var t=e.state,r=e.dispatch;return toMatchingBracket(t,r,false)};function extendSel(e,t){var r=updateSel(e.state.selection,(function(e){var r=t(e);return EditorSelection.range(e.anchor,r.head,r.goalColumn)}));if(r.eq(e.state.selection))return false;e.dispatch(setSel(e.state,r));return true}function selectByChar(e,t){return extendSel(e,(function(r){return e.moveByChar(r,t)}))}var selectCharLeft=function(e){return selectByChar(e,e.textDirection!=Direction.LTR)};var selectCharRight=function(e){return selectByChar(e,e.textDirection==Direction.LTR)};function selectByGroup(e,t){return extendSel(e,(function(r){return e.moveByGroup(r,t)}))}var selectGroupLeft=function(e){return selectByGroup(e,e.textDirection!=Direction.LTR)};var selectGroupRight=function(e){return selectByGroup(e,e.textDirection==Direction.LTR)};var selectSyntaxLeft=function(e){return extendSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection!=Direction.LTR)}))};var selectSyntaxRight=function(e){return extendSel(e,(function(t){return moveBySyntax(e.state,t,e.textDirection==Direction.LTR)}))};function selectByLine(e,t){return extendSel(e,(function(r){return e.moveVertically(r,t)}))}var selectLineUp=function(e){return selectByLine(e,false)};var selectLineDown=function(e){return selectByLine(e,true)};function selectByPage(e,t){return extendSel(e,(function(r){return e.moveVertically(r,t,e.dom.clientHeight)}))}var selectPageUp=function(e){return selectByPage(e,false)};var selectPageDown=function(e){return selectByPage(e,true)};var selectLineBoundaryForward=function(e){return extendSel(e,(function(t){return moveByLineBoundary(e,t,true)}))};var selectLineBoundaryBackward=function(e){return extendSel(e,(function(t){return moveByLineBoundary(e,t,false)}))};var selectLineStart=function(e){return extendSel(e,(function(t){return EditorSelection.cursor(e.lineBlockAt(t.head).from)}))};var selectLineEnd=function(e){return extendSel(e,(function(t){return EditorSelection.cursor(e.lineBlockAt(t.head).to)}))};var cursorDocStart=function(e){var t=e.state,r=e.dispatch;r(setSel(t,{anchor:0}));return true};var cursorDocEnd=function(e){var t=e.state,r=e.dispatch;r(setSel(t,{anchor:t.doc.length}));return true};var selectDocStart=function(e){var t=e.state,r=e.dispatch;r(setSel(t,{anchor:t.selection.main.anchor,head:0}));return true};var selectDocEnd=function(e){var t=e.state,r=e.dispatch;r(setSel(t,{anchor:t.selection.main.anchor,head:t.doc.length}));return true};var selectAll=function(e){var t=e.state,r=e.dispatch;r(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"}));return true};var selectLine=function(e){var t=e.state,r=e.dispatch;var n=selectedLineBlocks(t).map((function(e){var r=e.from,n=e.to;return EditorSelection.range(r,Math.min(n+1,t.doc.length))}));r(t.update({selection:EditorSelection.create(n),userEvent:"select"}));return true};var selectParentSyntax=function(e){var t=e.state,r=e.dispatch;var n=updateSel(t.selection,(function(e){var r;var n=syntaxTree(t).resolveInner(e.head,1);while(!(n.from<e.from&&n.to>=e.to||n.to>e.to&&n.from<=e.from||!((r=n.parent)===null||r===void 0?void 0:r.parent)))n=n.parent;return EditorSelection.range(n.to,n.from)}));r(setSel(t,n));return true};var simplifySelection=function(e){var t=e.state,r=e.dispatch;var n=t.selection,i=null;if(n.ranges.length>1)i=EditorSelection.create([n.main]);else if(!n.main.empty)i=EditorSelection.create([EditorSelection.cursor(n.main.head)]);if(!i)return false;r(setSel(t,i));return true};function deleteBy(e,t){var r=e.state,n=e.dispatch;if(r.readOnly)return false;var i="delete.selection";var o=r.changeByRange((function(e){var r=e.from,n=e.to;if(r==n){var o=t(r);if(o<r)i="delete.backward";else if(o>r)i="delete.forward";r=Math.min(r,o);n=Math.max(n,o)}return r==n?{range:e}:{changes:{from:r,to:n},range:EditorSelection.cursor(r)}}));if(o.changes.empty)return false;n(r.update(o,{scrollIntoView:true,userEvent:i}));return true}function skipAtomic(e,t,r){if(e instanceof EditorView)for(var n=0,i=e.pluginField(PluginField.atomicRanges);n<i.length;n++){var o=i[n];o.between(t,t,(function(e,n){if(e<t&&n>t)t=r?n:e}))}return t}var deleteByChar=function(e,t){return deleteBy(e,(function(r){var n=e.state,i=n.doc.lineAt(r),o,a;if(!t&&r>i.from&&r<i.from+200&&!/[^ \t]/.test(o=i.text.slice(0,r-i.from))){if(o[o.length-1]=="\t")return r-1;var s=countColumn(o,n.tabSize),l=s%getIndentUnit(n)||getIndentUnit(n);for(var c=0;c<l&&o[o.length-1-c]==" ";c++)r--;a=r}else{a=findClusterBreak(i.text,r-i.from,t,t)+i.from;if(a==r&&i.number!=(t?n.doc.lines:1))a+=t?1:-1}return skipAtomic(e,a,t)}))};var deleteCharBackward=function(e){return deleteByChar(e,false)};var deleteCharForward=function(e){return deleteByChar(e,true)};var deleteByGroup=function(e,t){return deleteBy(e,(function(r){var n=r,i=e.state,o=i.doc.lineAt(n);var a=i.charCategorizer(n);for(var s=null;;){if(n==(t?o.to:o.from)){if(n==r&&o.number!=(t?i.doc.lines:1))n+=t?1:-1;break}var l=findClusterBreak(o.text,n-o.from,t)+o.from;var c=o.text.slice(Math.min(n,l)-o.from,Math.max(n,l)-o.from);var u=a(c);if(s!=null&&u!=s)break;if(c!=" "||n!=r)s=u;n=l}return skipAtomic(e,n,t)}))};var deleteGroupBackward=function(e){return deleteByGroup(e,false)};var deleteGroupForward=function(e){return deleteByGroup(e,true)};var deleteToLineEnd=function(e){return deleteBy(e,(function(t){var r=e.lineBlockAt(t).to;return skipAtomic(e,t<r?r:Math.min(e.state.doc.length,t+1),true)}))};var deleteToLineStart=function(e){return deleteBy(e,(function(t){var r=e.lineBlockAt(t).from;return skipAtomic(e,t>r?r:Math.max(0,t-1),false)}))};var splitLine=function(e){var t=e.state,r=e.dispatch;if(t.readOnly)return false;var n=t.changeByRange((function(e){return{changes:{from:e.from,to:e.to,insert:Text.of(["",""])},range:EditorSelection.cursor(e.from)}}));r(t.update(n,{scrollIntoView:true,userEvent:"input"}));return true};var transposeChars=function(e){var t=e.state,r=e.dispatch;if(t.readOnly)return false;var n=t.changeByRange((function(e){if(!e.empty||e.from==0||e.from==t.doc.length)return{range:e};var r=e.from,n=t.doc.lineAt(r);var i=r==n.from?r-1:findClusterBreak(n.text,r-n.from,false)+n.from;var o=r==n.to?r+1:findClusterBreak(n.text,r-n.from,true)+n.from;return{changes:{from:i,to:o,insert:t.doc.slice(r,o).append(t.doc.slice(i,r))},range:EditorSelection.cursor(o)}}));if(n.changes.empty)return false;r(t.update(n,{scrollIntoView:true,userEvent:"move.character"}));return true};function selectedLineBlocks(e){var t=[],r=-1;for(var n=0,i=e.selection.ranges;n<i.length;n++){var o=i[n];var a=e.doc.lineAt(o.from),s=e.doc.lineAt(o.to);if(!o.empty&&o.to==s.from)s=e.doc.lineAt(o.to-1);if(r>=a.number){var l=t[t.length-1];l.to=s.to;l.ranges.push(o)}else{t.push({from:a.from,to:s.to,ranges:[o]})}r=s.number+1}return t}function moveLine(e,t,r){if(e.readOnly)return false;var n=[],i=[];for(var o=0,a=selectedLineBlocks(e);o<a.length;o++){var s=a[o];if(r?s.to==e.doc.length:s.from==0)continue;var l=e.doc.lineAt(r?s.to+1:s.from-1);var c=l.length+1;if(r){n.push({from:s.to,to:l.to},{from:s.from,insert:l.text+e.lineBreak});for(var u=0,f=s.ranges;u<f.length;u++){var h=f[u];i.push(EditorSelection.range(Math.min(e.doc.length,h.anchor+c),Math.min(e.doc.length,h.head+c)))}}else{n.push({from:l.from,to:s.from},{from:s.to,insert:e.lineBreak+l.text});for(var d=0,p=s.ranges;d<p.length;d++){var h=p[d];i.push(EditorSelection.range(h.anchor-c,h.head-c))}}}if(!n.length)return false;t(e.update({changes:n,scrollIntoView:true,selection:EditorSelection.create(i,e.selection.mainIndex),userEvent:"move.line"}));return true}var moveLineUp=function(e){var t=e.state,r=e.dispatch;return moveLine(t,r,false)};var moveLineDown=function(e){var t=e.state,r=e.dispatch;return moveLine(t,r,true)};function copyLine(e,t,r){if(e.readOnly)return false;var n=[];for(var i=0,o=selectedLineBlocks(e);i<o.length;i++){var a=o[i];if(r)n.push({from:a.from,insert:e.doc.slice(a.from,a.to)+e.lineBreak});else n.push({from:a.to,insert:e.lineBreak+e.doc.slice(a.from,a.to)})}t(e.update({changes:n,scrollIntoView:true,userEvent:"input.copyline"}));return true}var copyLineUp=function(e){var t=e.state,r=e.dispatch;return copyLine(t,r,false)};var copyLineDown=function(e){var t=e.state,r=e.dispatch;return copyLine(t,r,true)};var deleteLine=function(e){if(e.state.readOnly)return false;var t=e.state,r=t.changes(selectedLineBlocks(t).map((function(e){var r=e.from,n=e.to;if(r>0)r--;else if(n<t.doc.length)n++;return{from:r,to:n}})));var n=updateSel(t.selection,(function(t){return e.moveVertically(t,true)})).map(r);e.dispatch({changes:r,selection:n,scrollIntoView:true,userEvent:"delete.line"});return true};function isBetweenBrackets(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};var r=syntaxTree(e).resolveInner(t);var n=r.childBefore(t),i=r.childAfter(t),o;if(n&&i&&n.to<=t&&i.from>=t&&(o=n.type.prop(NodeProp.closedBy))&&o.indexOf(i.name)>-1&&e.doc.lineAt(n.to).from==e.doc.lineAt(i.from).from)return{from:n.to,to:i.from};return null}var insertNewlineAndIndent=newlineAndIndent(false);var insertBlankLine=newlineAndIndent(true);function newlineAndIndent(e){return function(t){var r=t.state,n=t.dispatch;if(r.readOnly)return false;var i=r.changeByRange((function(t){var n=t.from,i=t.to,o=r.doc.lineAt(n);var a=!e&&n==i&&isBetweenBrackets(r,n);if(e)n=i=(i<=o.to?o:r.doc.lineAt(i)).to;var s=new IndentContext(r,{simulateBreak:n,simulateDoubleBreak:!!a});var l=getIndentation(s,n);if(l==null)l=/^\s*/.exec(r.doc.lineAt(n).text)[0].length;while(i<o.to&&/\s/.test(o.text[i-o.from]))i++;if(a)n=a.from,i=a.to;else if(n>o.from&&n<o.from+100&&!/\S/.test(o.text.slice(0,n)))n=o.from;var c=["",indentString(r,l)];if(a)c.push(indentString(r,s.lineIndent(o.from,-1)));return{changes:{from:n,to:i,insert:Text.of(c)},range:EditorSelection.cursor(n+1+c[1].length)}}));n(r.update(i,{scrollIntoView:true,userEvent:"input"}));return true}}function changeBySelectedLine(e,t){var r=-1;return e.changeByRange((function(n){var i=[];for(var o=n.from;o<=n.to;){var a=e.doc.lineAt(o);if(a.number>r&&(n.empty||n.to>a.from)){t(a,i,n);r=a.number}o=a.to+1}var s=e.changes(i);return{changes:i,range:EditorSelection.range(s.mapPos(n.anchor,1),s.mapPos(n.head,1))}}))}var indentSelection=function(e){var t=e.state,r=e.dispatch;if(t.readOnly)return false;var n=Object.create(null);var i=new IndentContext(t,{overrideIndentation:function(e){var t=n[e];return t==null?-1:t}});var o=changeBySelectedLine(t,(function(e,r,o){var a=getIndentation(i,e.from);if(a==null)return;if(!/\S/.test(e.text))a=0;var s=/^\s*/.exec(e.text)[0];var l=indentString(t,a);if(s!=l||o.from<e.from+s.length){n[e.from]=a;r.push({from:e.from,to:e.from+s.length,insert:l})}}));if(!o.changes.empty)r(t.update(o,{userEvent:"indent"}));return true};var indentMore=function(e){var t=e.state,r=e.dispatch;if(t.readOnly)return false;r(t.update(changeBySelectedLine(t,(function(e,r){r.push({from:e.from,insert:t.facet(indentUnit)})})),{userEvent:"input.indent"}));return true};var indentLess=function(e){var t=e.state,r=e.dispatch;if(t.readOnly)return false;r(t.update(changeBySelectedLine(t,(function(e,r){var n=/^\s*/.exec(e.text)[0];if(!n)return;var i=countColumn(n,t.tabSize),o=0;var a=indentString(t,Math.max(0,i-getIndentUnit(t)));while(o<n.length&&o<a.length&&n.charCodeAt(o)==a.charCodeAt(o))o++;r.push({from:e.from+o,to:e.from+n.length,insert:a.slice(o)})})),{userEvent:"delete.dedent"}));return true};var emacsStyleKeymap=[{key:"Ctrl-b",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Ctrl-f",run:cursorCharRight,shift:selectCharRight},{key:"Ctrl-p",run:cursorLineUp,shift:selectLineUp},{key:"Ctrl-n",run:cursorLineDown,shift:selectLineDown},{key:"Ctrl-a",run:cursorLineStart,shift:selectLineStart},{key:"Ctrl-e",run:cursorLineEnd,shift:selectLineEnd},{key:"Ctrl-d",run:deleteCharForward},{key:"Ctrl-h",run:deleteCharBackward},{key:"Ctrl-k",run:deleteToLineEnd},{key:"Ctrl-Alt-h",run:deleteGroupBackward},{key:"Ctrl-o",run:splitLine},{key:"Ctrl-t",run:transposeChars},{key:"Ctrl-v",run:cursorPageDown}];var standardKeymap=[{key:"ArrowLeft",run:cursorCharLeft,shift:selectCharLeft,preventDefault:true},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:cursorGroupLeft,shift:selectGroupLeft},{mac:"Cmd-ArrowLeft",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward},{key:"ArrowRight",run:cursorCharRight,shift:selectCharRight,preventDefault:true},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:cursorGroupRight,shift:selectGroupRight},{mac:"Cmd-ArrowRight",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward},{key:"ArrowUp",run:cursorLineUp,shift:selectLineUp,preventDefault:true},{mac:"Cmd-ArrowUp",run:cursorDocStart,shift:selectDocStart},{mac:"Ctrl-ArrowUp",run:cursorPageUp,shift:selectPageUp},{key:"ArrowDown",run:cursorLineDown,shift:selectLineDown,preventDefault:true},{mac:"Cmd-ArrowDown",run:cursorDocEnd,shift:selectDocEnd},{mac:"Ctrl-ArrowDown",run:cursorPageDown,shift:selectPageDown},{key:"PageUp",run:cursorPageUp,shift:selectPageUp},{key:"PageDown",run:cursorPageDown,shift:selectPageDown},{key:"Home",run:cursorLineBoundaryBackward,shift:selectLineBoundaryBackward},{key:"Mod-Home",run:cursorDocStart,shift:selectDocStart},{key:"End",run:cursorLineBoundaryForward,shift:selectLineBoundaryForward},{key:"Mod-End",run:cursorDocEnd,shift:selectDocEnd},{key:"Enter",run:insertNewlineAndIndent},{key:"Mod-a",run:selectAll},{key:"Backspace",run:deleteCharBackward,shift:deleteCharBackward},{key:"Delete",run:deleteCharForward},{key:"Mod-Backspace",mac:"Alt-Backspace",run:deleteGroupBackward},{key:"Mod-Delete",mac:"Alt-Delete",run:deleteGroupForward},{mac:"Mod-Backspace",run:deleteToLineStart},{mac:"Mod-Delete",run:deleteToLineEnd}].concat(emacsStyleKeymap.map((function(e){return{mac:e.key,run:e.run,shift:e.shift}})));var defaultKeymap=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:cursorSyntaxLeft,shift:selectSyntaxLeft},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:cursorSyntaxRight,shift:selectSyntaxRight},{key:"Alt-ArrowUp",run:moveLineUp},{key:"Shift-Alt-ArrowUp",run:copyLineUp},{key:"Alt-ArrowDown",run:moveLineDown},{key:"Shift-Alt-ArrowDown",run:copyLineDown},{key:"Escape",run:simplifySelection},{key:"Mod-Enter",run:insertBlankLine},{key:"Alt-l",mac:"Ctrl-l",run:selectLine},{key:"Mod-i",run:selectParentSyntax,preventDefault:true},{key:"Mod-[",run:indentLess},{key:"Mod-]",run:indentMore},{key:"Mod-Alt-\\",run:indentSelection},{key:"Shift-Mod-k",run:deleteLine},{key:"Shift-Mod-\\",run:cursorMatchingBracket}].concat(standardKeymap);var toggleComment=function(e){var t=getConfig(e.state);return t.line?toggleLineComment(e):t.block?toggleBlockCommentByLine(e):false};function command(e,t){return function(r){var n=r.state,i=r.dispatch;if(n.readOnly)return false;var o=e(t,n);if(!o)return false;i(n.update(o));return true}}var toggleLineComment=command(changeLineComment,0);var toggleBlockComment=command(changeBlockComment,0);var toggleBlockCommentByLine=command((function(e,t){return changeBlockComment(e,t,selectedLineRanges(t))}),0);var commentKeymap=[{key:"Mod-/",run:toggleComment},{key:"Alt-A",run:toggleBlockComment}];function getConfig(e,t){if(t===void 0){t=e.selection.main.head}var r=e.languageDataAt("commentTokens",t);return r.length?r[0]:{}}var SearchMargin=50;function findBlockComment(e,t,r,n){var i=t.open,o=t.close;var a=e.sliceDoc(r-SearchMargin,r);var s=e.sliceDoc(n,n+SearchMargin);var l=/\s*$/.exec(a)[0].length,c=/^\s*/.exec(s)[0].length;var u=a.length-l;if(a.slice(u-i.length,u)==i&&s.slice(c,c+o.length)==o){return{open:{pos:r-l,margin:l&&1},close:{pos:n+c,margin:c&&1}}}var f,h;if(n-r<=2*SearchMargin){f=h=e.sliceDoc(r,n)}else{f=e.sliceDoc(r,r+SearchMargin);h=e.sliceDoc(n-SearchMargin,n)}var d=/^\s*/.exec(f)[0].length,p=/\s*$/.exec(h)[0].length;var g=h.length-p-o.length;if(f.slice(d,d+i.length)==i&&h.slice(g,g+o.length)==o){return{open:{pos:r+d+i.length,margin:/\s/.test(f.charAt(d+i.length))?1:0},close:{pos:n-p-o.length,margin:/\s/.test(h.charAt(g-1))?1:0}}}return null}function selectedLineRanges(e){var t=[];for(var r=0,n=e.selection.ranges;r<n.length;r++){var i=n[r];var o=e.doc.lineAt(i.from);var a=i.to<=o.to?o:e.doc.lineAt(i.to);var s=t.length-1;if(s>=0&&t[s].to>o.from)t[s].to=a.to;else t.push({from:o.from,to:a.to})}return t}function changeBlockComment(e,t,r){if(r===void 0){r=t.selection.ranges}var n=r.map((function(e){return getConfig(t,e.from).block}));if(!n.every((function(e){return e})))return null;var i=r.map((function(e,r){return findBlockComment(t,n[r],e.from,e.to)}));if(e!=2&&!i.every((function(e){return e}))){return{changes:t.changes(r.map((function(e,t){if(i[t])return[];return[{from:e.from,insert:n[t].open+" "},{from:e.to,insert:" "+n[t].close}]})))}}else if(e!=1&&i.some((function(e){return e}))){var o=[];for(var a=0,s;a<i.length;a++)if(s=i[a]){var l=n[a],c=s.open,u=s.close;o.push({from:c.pos-l.open.length,to:c.pos+c.margin},{from:u.pos-u.margin,to:u.pos+l.close.length})}return{changes:o}}return null}function changeLineComment(e,t,r){if(r===void 0){r=t.selection.ranges}var n=[];var i=-1;for(var o=0,a=r;o<a.length;o++){var s=a[o],l=s.from,c=s.to;var u=n.length,f=1e9;for(var h=l;h<=c;){var d=t.doc.lineAt(h);if(d.from>i&&(l==c||c>d.from)){i=d.from;var p=getConfig(t,h).line;if(!p)continue;var g=/^\s*/.exec(d.text)[0].length;var v=g==d.length;var m=d.text.slice(g,g+p.length)==p?g:-1;if(g<d.text.length&&g<f)f=g;n.push({line:d,comment:m,token:p,indent:g,empty:v,single:false})}h=d.to+1}if(f<1e9)for(var y=u;y<n.length;y++)if(n[y].indent<n[y].line.text.length)n[y].indent=f;if(n.length==u+1)n[u].single=true}if(e!=2&&n.some((function(e){return e.comment<0&&(!e.empty||e.single)}))){var b=[];for(var w=0,x=n;w<x.length;w++){var S=x[w],d=S.line,p=S.token,g=S.indent,k=S.empty,C=S.single;if(C||!k)b.push({from:d.from+g,insert:p+" "})}var M=t.changes(b);return{changes:M,selection:t.selection.map(M,1)}}else if(e!=1&&n.some((function(e){return e.comment>=0}))){var b=[];for(var A=0,P=n;A<P.length;A++){var T=P[A],d=T.line,E=T.comment,p=T.token;if(E>=0){var l=d.from+E,c=l+p.length;if(d.text[c-d.from]==" ")c++;b.push({from:l,to:c})}}return{changes:b}}return null}var GutterMarker=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.compare=function(e){return this==e||this.constructor==e.constructor&&this.eq(e)};t.prototype.eq=function(e){return false};t.prototype.destroy=function(e){};return t}(RangeValue);GutterMarker.prototype.elementClass="";GutterMarker.prototype.toDOM=undefined;GutterMarker.prototype.mapMode=MapMode.TrackBefore;GutterMarker.prototype.startSide=GutterMarker.prototype.endSide=-1;GutterMarker.prototype.point=true;var gutterLineClass=Facet.define();var defaults={class:"",renderEmptyElements:false,elementStyle:"",markers:function(){return RangeSet.empty},lineMarker:function(){return null},lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}};var activeGutters=Facet.define();function gutter(e){return[gutters(),activeGutters.of(Object.assign(Object.assign({},defaults),e))]}var baseTheme$4=EditorView.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}});var unfixGutters=Facet.define({combine:function(e){return e.some((function(e){return e}))}});function gutters(e){var t=[gutterView,baseTheme$4];if(e&&e.fixed===false)t.push(unfixGutters.of(true));return t}var gutterView=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.prevViewport=e.viewport;this.dom=document.createElement("div");this.dom.className="cm-gutters";this.dom.setAttribute("aria-hidden","true");this.dom.style.minHeight=this.view.contentHeight+"px";this.gutters=e.state.facet(activeGutters).map((function(t){return new SingleGutterView(e,t)}));for(var t=0,r=this.gutters;t<r.length;t++){var n=r[t];this.dom.appendChild(n.dom)}this.fixed=!e.state.facet(unfixGutters);if(this.fixed){this.dom.style.position="sticky"}this.syncGutters(false);e.scrollDOM.insertBefore(this.dom,e.contentDOM)}e.prototype.update=function(e){if(this.updateGutters(e)){var t=this.prevViewport,r=e.view.viewport;var n=Math.min(t.to,r.to)-Math.max(t.from,r.from);this.syncGutters(n<(r.to-r.from)*.8)}if(e.geometryChanged)this.dom.style.minHeight=this.view.contentHeight+"px";if(this.view.state.facet(unfixGutters)!=!this.fixed){this.fixed=!this.fixed;this.dom.style.position=this.fixed?"sticky":""}this.prevViewport=e.view.viewport};e.prototype.syncGutters=function(e){var t=this;var r=this.dom.nextSibling;if(e)this.dom.remove();var n=RangeSet.iter(this.view.state.facet(gutterLineClass),this.view.viewport.from);var i=[];var o=this.gutters.map((function(e){return new UpdateContext(e,t.view.viewport,-t.view.documentPadding.top)}));for(var a=0,s=this.view.viewportLineBlocks;a<s.length;a++){var l=s[a];var c=void 0;if(Array.isArray(l.type)){for(var u=0,f=l.type;u<f.length;u++){var h=f[u];if(h.type==BlockType.Text){c=h;break}}}else{c=l.type==BlockType.Text?l:undefined}if(!c)continue;if(i.length)i=[];advanceCursor(n,i,l.from);for(var d=0,p=o;d<p.length;d++){var g=p[d];g.line(this.view,c,i)}}for(var v=0,m=o;v<m.length;v++){var g=m[v];g.finish()}if(e)this.view.scrollDOM.insertBefore(this.dom,r)};e.prototype.updateGutters=function(e){var t=e.startState.facet(activeGutters),r=e.state.facet(activeGutters);var n=e.docChanged||e.heightChanged||e.viewportChanged||!RangeSet.eq(e.startState.facet(gutterLineClass),e.state.facet(gutterLineClass),e.view.viewport.from,e.view.viewport.to);if(t==r){for(var i=0,o=this.gutters;i<o.length;i++){var a=o[i];if(a.update(e))n=true}}else{n=true;var s=[];for(var l=0,c=r;l<c.length;l++){var u=c[l];var f=t.indexOf(u);if(f<0){s.push(new SingleGutterView(this.view,u))}else{this.gutters[f].update(e);s.push(this.gutters[f])}}for(var h=0,d=this.gutters;h<d.length;h++){var p=d[h];p.dom.remove();if(s.indexOf(p)<0)p.destroy()}for(var g=0,v=s;g<v.length;g++){var p=v[g];this.dom.appendChild(p.dom)}this.gutters=s}return n};e.prototype.destroy=function(){for(var e=0,t=this.gutters;e<t.length;e++){var r=t[e];r.destroy()}this.dom.remove()};return e}(),{provide:PluginField.scrollMargins.from((function(e){if(e.gutters.length==0||!e.fixed)return null;return e.view.textDirection==Direction.LTR?{left:e.dom.offsetWidth}:{right:e.dom.offsetWidth}}))});function asArray(e){return Array.isArray(e)?e:[e]}function advanceCursor(e,t,r){while(e.value&&e.from<=r){if(e.from==r)t.push(e.value);e.next()}}var UpdateContext=function(){function e(e,t,r){this.gutter=e;this.height=r;this.localMarkers=[];this.i=0;this.cursor=RangeSet.iter(e.markers,t.from)}e.prototype.line=function(e,t,r){if(this.localMarkers.length)this.localMarkers=[];advanceCursor(this.cursor,this.localMarkers,t.from);var n=r.length?this.localMarkers.concat(r):this.localMarkers;var i=this.gutter.config.lineMarker(e,t,n);if(i)n.unshift(i);var o=this.gutter;if(n.length==0&&!o.config.renderEmptyElements)return;var a=t.top-this.height;if(this.i==o.elements.length){var s=new GutterElement(e,t.height,a,n);o.elements.push(s);o.dom.appendChild(s.dom)}else{o.elements[this.i].update(e,t.height,a,n)}this.height=t.bottom;this.i++};e.prototype.finish=function(){var e=this.gutter;while(e.elements.length>this.i){var t=e.elements.pop();e.dom.removeChild(t.dom);t.destroy()}};return e}();var SingleGutterView=function(){function e(e,t){this.view=e;this.config=t;this.elements=[];this.spacer=null;this.dom=document.createElement("div");this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");var r=function(r){n.dom.addEventListener(r,(function(n){var i=e.lineBlockAtHeight(n.clientY-e.documentTop);if(t.domEventHandlers[r](e,i,n))n.preventDefault()}))};var n=this;for(var i in t.domEventHandlers){r(i)}this.markers=asArray(t.markers(e));if(t.initialSpacer){this.spacer=new GutterElement(e,0,0,[t.initialSpacer(e)]);this.dom.appendChild(this.spacer.dom);this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none"}}e.prototype.update=function(e){var t=this.markers;this.markers=asArray(this.config.markers(e.view));if(this.spacer&&this.config.updateSpacer){var r=this.config.updateSpacer(this.spacer.markers[0],e);if(r!=this.spacer.markers[0])this.spacer.update(e.view,0,0,[r])}var n=e.view.viewport;return!RangeSet.eq(this.markers,t,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):false)};e.prototype.destroy=function(){for(var e=0,t=this.elements;e<t.length;e++){var r=t[e];r.destroy()}};return e}();var GutterElement=function(){function e(e,t,r,n){this.height=-1;this.above=0;this.markers=[];this.dom=document.createElement("div");this.update(e,t,r,n)}e.prototype.update=function(e,t,r,n){if(this.height!=t)this.dom.style.height=(this.height=t)+"px";if(this.above!=r)this.dom.style.marginTop=(this.above=r)?r+"px":"";if(!sameMarkers(this.markers,n))this.setMarkers(e,n)};e.prototype.setMarkers=function(e,t){var r="cm-gutterElement",n=this.dom.firstChild;for(var i=0,o=0;;){var a=o,s=i<t.length?t[i++]:null,l=false;if(s){var c=s.elementClass;if(c)r+=" "+c;for(var u=o;u<this.markers.length;u++)if(this.markers[u].compare(s)){a=u;l=true;break}}else{a=this.markers.length}while(o<a){var f=this.markers[o++];if(f.toDOM){f.destroy(n);var h=n.nextSibling;n.remove();n=h}}if(!s)break;if(s.toDOM){if(l)n=n.nextSibling;else this.dom.insertBefore(s.toDOM(e),n)}if(l)o++}this.dom.className=r;this.markers=t};e.prototype.destroy=function(){this.setMarkers(null,[])};return e}();function sameMarkers(e,t){if(e.length!=t.length)return false;for(var r=0;r<e.length;r++)if(!e[r].compare(t[r]))return false;return true}var lineNumberMarkers=Facet.define();var lineNumberConfig=Facet.define({combine:function(e){return combineConfig(e,{formatNumber:String,domEventHandlers:{}},{domEventHandlers:function(e,t){var r=Object.assign({},e);var n=function(e){var n=r[e],i=t[e];r[e]=n?function(e,t,r){return n(e,t,r)||i(e,t,r)}:i};for(var i in t){n(i)}return r}})}});var NumberMarker=function(e){__extends(t,e);function t(t){var r=e.call(this)||this;r.number=t;return r}t.prototype.eq=function(e){return this.number==e.number};t.prototype.toDOM=function(){return document.createTextNode(this.number)};return t}(GutterMarker);function formatNumber(e,t){return e.state.facet(lineNumberConfig).formatNumber(t,e.state)}var lineNumberGutter=activeGutters.compute([lineNumberConfig],(function(e){return{class:"cm-lineNumbers",renderEmptyElements:false,markers:function(e){return e.state.facet(lineNumberMarkers)},lineMarker:function(e,t,r){if(r.some((function(e){return e.toDOM})))return null;return new NumberMarker(formatNumber(e,e.state.doc.lineAt(t.from).number))},lineMarkerChange:function(e){return e.startState.facet(lineNumberConfig)!=e.state.facet(lineNumberConfig)},initialSpacer:function(e){return new NumberMarker(formatNumber(e,maxLineNumber(e.state.doc.lines)))},updateSpacer:function(e,t){var r=formatNumber(t.view,maxLineNumber(t.view.state.doc.lines));return r==e.number?e:new NumberMarker(r)},domEventHandlers:e.facet(lineNumberConfig).domEventHandlers}}));function lineNumbers(e){if(e===void 0){e={}}return[lineNumberConfig.of(e),gutters(),lineNumberGutter]}function maxLineNumber(e){var t=9;while(t<e)t=t*10+9;return t}function mapRange(e,t){var r=t.mapPos(e.from,1),n=t.mapPos(e.to,-1);return r>=n?undefined:{from:r,to:n}}var foldEffect=StateEffect.define({map:mapRange});var unfoldEffect=StateEffect.define({map:mapRange});function selectedLines(e){var t=[];var r=function(r){if(t.some((function(e){return e.from<=r&&e.to>=r})))return"continue";t.push(e.lineBlockAt(r))};for(var n=0,i=e.state.selection.ranges;n<i.length;n++){var o=i[n].head;r(o)}return t}var foldState=StateField.define({create:function(){return Decoration.none},update:function(e,t){e=e.map(t.changes);var r=function(t){if(t.is(foldEffect)&&!foldExists(e,t.value.from,t.value.to))e=e.update({add:[foldWidget.range(t.value.from,t.value.to)]});else if(t.is(unfoldEffect))e=e.update({filter:function(e,r){return t.value.from!=e||t.value.to!=r},filterFrom:t.value.from,filterTo:t.value.to})};for(var n=0,i=t.effects;n<i.length;n++){var o=i[n];r(o)}if(t.selection){var a=false,s=t.selection.main.head;e.between(s,s,(function(e,t){if(e<s&&t>s)a=true}));if(a)e=e.update({filterFrom:s,filterTo:s,filter:function(e,t){return t<=s||e>=s}})}return e},provide:function(e){return EditorView.decorations.from(e)}});function foldInside(e,t,r){var n;var i=null;(n=e.field(foldState,false))===null||n===void 0?void 0:n.between(t,r,(function(e,t){if(!i||i.from>e)i={from:e,to:t}}));return i}function foldExists(e,t,r){var n=false;e.between(t,t,(function(e,i){if(e==t&&i==r)n=true}));return n}function maybeEnable(e,t){return e.field(foldState,false)?t:t.concat(StateEffect.appendConfig.of(codeFolding()))}var foldCode=function(e){for(var t=0,r=selectedLines(e);t<r.length;t++){var n=r[t];var i=foldable(e.state,n.from,n.to);if(i){e.dispatch({effects:maybeEnable(e.state,[foldEffect.of(i),announceFold(e,i)])});return true}}return false};var unfoldCode=function(e){if(!e.state.field(foldState,false))return false;var t=[];for(var r=0,n=selectedLines(e);r<n.length;r++){var i=n[r];var o=foldInside(e.state,i.from,i.to);if(o)t.push(unfoldEffect.of(o),announceFold(e,o,false))}if(t.length)e.dispatch({effects:t});return t.length>0};function announceFold(e,t,r){if(r===void 0){r=true}var n=e.state.doc.lineAt(t.from).number,i=e.state.doc.lineAt(t.to).number;return EditorView.announce.of("".concat(e.state.phrase(r?"Folded lines":"Unfolded lines")," ").concat(n," ").concat(e.state.phrase("to")," ").concat(i,"."))}var foldAll=function(e){var t=e.state,r=[];for(var n=0;n<t.doc.length;){var i=e.lineBlockAt(n),o=foldable(t,i.from,i.to);if(o)r.push(foldEffect.of(o));n=(o?e.lineBlockAt(o.to):i).to+1}if(r.length)e.dispatch({effects:maybeEnable(e.state,r)});return!!r.length};var unfoldAll=function(e){var t=e.state.field(foldState,false);if(!t||!t.size)return false;var r=[];t.between(0,e.state.doc.length,(function(e,t){r.push(unfoldEffect.of({from:e,to:t}))}));e.dispatch({effects:r});return true};var foldKeymap=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:foldCode},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:unfoldCode},{key:"Ctrl-Alt-[",run:foldAll},{key:"Ctrl-Alt-]",run:unfoldAll}];var defaultConfig={placeholderDOM:null,placeholderText:"…"};var foldConfig=Facet.define({combine:function(e){return combineConfig(e,defaultConfig)}});function codeFolding(e){var t=[foldState,baseTheme$3];if(e)t.push(foldConfig.of(e));return t}var foldWidget=Decoration.replace({widget:new(function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.toDOM=function(e){var t=e.state,r=t.facet(foldConfig);var n=function(t){var r=e.lineBlockAt(e.posAtDOM(t.target));var n=foldInside(e.state,r.from,r.to);if(n)e.dispatch({effects:unfoldEffect.of(n)});t.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(e,n);var i=document.createElement("span");i.textContent=r.placeholderText;i.setAttribute("aria-label",t.phrase("folded code"));i.title=t.phrase("unfold");i.className="cm-foldPlaceholder";i.onclick=n;return i};return t}(WidgetType))});var foldGutterDefaults={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{}};var FoldMarker=function(e){__extends(t,e);function t(t,r){var n=e.call(this)||this;n.config=t;n.open=r;return n}t.prototype.eq=function(e){return this.config==e.config&&this.open==e.open};t.prototype.toDOM=function(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);var t=document.createElement("span");t.textContent=this.open?this.config.openText:this.config.closedText;t.title=e.state.phrase(this.open?"Fold line":"Unfold line");return t};return t}(GutterMarker);function foldGutter(e){if(e===void 0){e={}}var t=Object.assign(Object.assign({},foldGutterDefaults),e);var r=new FoldMarker(t,true),n=new FoldMarker(t,false);var i=ViewPlugin.fromClass(function(){function e(e){this.from=e.viewport.from;this.markers=this.buildMarkers(e)}e.prototype.update=function(e){if(e.docChanged||e.viewportChanged||e.startState.facet(language)!=e.state.facet(language)||e.startState.field(foldState,false)!=e.state.field(foldState,false))this.markers=this.buildMarkers(e.view)};e.prototype.buildMarkers=function(e){var t=new RangeSetBuilder;for(var i=0,o=e.viewportLineBlocks;i<o.length;i++){var a=o[i];var s=foldInside(e.state,a.from,a.to)?n:foldable(e.state,a.from,a.to)?r:null;if(s)t.add(a.from,a.from,s)}return t.finish()};return e}());var o=t.domEventHandlers;return[i,gutter({class:"cm-foldGutter",markers:function(e){var t;return((t=e.plugin(i))===null||t===void 0?void 0:t.markers)||RangeSet.empty},initialSpacer:function(){return new FoldMarker(t,false)},domEventHandlers:Object.assign(Object.assign({},o),{click:function(e,t,r){if(o.click&&o.click(e,t,r))return true;var n=foldInside(e.state,t.from,t.to);if(n){e.dispatch({effects:unfoldEffect.of(n)});return true}var i=foldable(e.state,t.from,t.to);if(i){e.dispatch({effects:foldEffect.of(i)});return true}return false}})}),codeFolding()]}var baseTheme$3=EditorView.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});var nextTagID=0;var Tag=function(){function e(e,t,r){this.set=e;this.base=t;this.modified=r;this.id=nextTagID++}e.define=function(t){if(t===null||t===void 0?void 0:t.base)throw new Error("Can not derive from a modified tag");var r=new e([],null,[]);r.set.push(r);if(t)for(var n=0,i=t.set;n<i.length;n++){var o=i[n];r.set.push(o)}return r};e.defineModifier=function(){var e=new Modifier;return function(t){if(t.modified.indexOf(e)>-1)return t;return Modifier.get(t.base||t,t.modified.concat(e).sort((function(e,t){return e.id-t.id})))}};return e}();var nextModifierID=0;var Modifier=function(){function e(){this.instances=[];this.id=nextModifierID++}e.get=function(t,r){if(!r.length)return t;var n=r[0].instances.find((function(e){return e.base==t&&sameArray(r,e.modified)}));if(n)return n;var i=[],o=new Tag(i,t,r);for(var a=0,s=r;a<s.length;a++){var l=s[a];l.instances.push(o)}var c=permute(r);for(var u=0,f=t.set;u<f.length;u++){var h=f[u];for(var d=0,p=c;d<p.length;d++){var g=p[d];i.push(e.get(h,g))}}return o};return e}();function sameArray(e,t){return e.length==t.length&&e.every((function(e,r){return e==t[r]}))}function permute(e){var t=[e];for(var r=0;r<e.length;r++){for(var n=0,i=permute(e.slice(0,r).concat(e.slice(r+1)));n<i.length;n++){var o=i[n];t.push(o)}}return t}function styleTags(e){var t=Object.create(null);for(var r in e){var n=e[r];if(!Array.isArray(n))n=[n];for(var i=0,o=r.split(" ");i<o.length;i++){var a=o[i];if(a){var s=[],l=2,c=a;for(var u=0;;){if(c=="..."&&u>0&&u+3==a.length){l=1;break}var f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(c);if(!f)throw new RangeError("Invalid path: "+a);s.push(f[0]=="*"?null:f[0][0]=='"'?JSON.parse(f[0]):f[0]);u+=f[0].length;if(u==a.length)break;var h=a[u++];if(u==a.length&&h=="!"){l=0;break}if(h!="/")throw new RangeError("Invalid path: "+a);c=a.slice(u)}var d=s.length-1,p=s[d];if(!p)throw new RangeError("Invalid path: "+a);var g=new Rule(n,l,d>0?s.slice(0,d):null);t[p]=g.sort(t[p])}}}return ruleNodeProp.add(t)}var ruleNodeProp=new NodeProp;var highlightStyle=Facet.define({combine:function(e){return e.length?HighlightStyle.combinedMatch(e):null}});var fallbackHighlightStyle=Facet.define({combine:function(e){return e.length?e[0].match:null}});function getHighlightStyle(e){return e.facet(highlightStyle)||e.facet(fallbackHighlightStyle)}var Rule=function(){function e(e,t,r,n){this.tags=e;this.mode=t;this.context=r;this.next=n}e.prototype.sort=function(e){if(!e||e.depth<this.depth){this.next=e;return this}e.next=this.sort(e.next);return e};Object.defineProperty(e.prototype,"depth",{get:function(){return this.context?this.context.length:0},enumerable:false,configurable:true});return e}();var HighlightStyle=function(){function e(e,t){this.map=Object.create(null);var r;function n(e){var t=StyleModule.newName();(r||(r=Object.create(null)))["."+t]=e;return t}this.all=typeof t.all=="string"?t.all:t.all?n(t.all):null;for(var i=0,o=e;i<o.length;i++){var a=o[i];var s=(a.class||n(Object.assign({},a,{tag:null})))+(this.all?" "+this.all:"");var l=a.tag;if(!Array.isArray(l))this.map[l.id]=s;else for(var c=0,u=l;c<u.length;c++){var f=u[c];this.map[f.id]=s}}this.module=r?new StyleModule(r):null;this.scope=t.scope||null;this.match=this.match.bind(this);var h=[treeHighlighter];if(this.module)h.push(EditorView.styleModule.of(this.module));this.extension=h.concat(highlightStyle.of(this));this.fallback=h.concat(fallbackHighlightStyle.of(this))}e.prototype.match=function(e,t){if(this.scope&&t!=this.scope)return null;for(var r=0,n=e.set;r<n.length;r++){var i=n[r];var o=this.map[i.id];if(o!==undefined){if(i!=e)this.map[e.id]=o;return o}}return this.map[e.id]=this.all};e.combinedMatch=function(e){if(e.length==1)return e[0].match;var t=e.some((function(e){return e.scope}))?undefined:Object.create(null);return function(r,n){var i=t&&t[r.id];if(i!==undefined)return i;var o=null;for(var a=0,s=e;a<s.length;a++){var l=s[a];var c=l.match(r,n);if(c)o=o?o+" "+c:c}if(t)t[r.id]=o;return o}};e.define=function(t,r){return new e(t,r||{})};e.get=function(e,t,r){var n=getHighlightStyle(e);return n&&n(t,r||NodeType.none)};return e}();var TreeHighlighter=function(){function e(e){this.markCache=Object.create(null);this.tree=syntaxTree(e.state);this.decorations=this.buildDeco(e,getHighlightStyle(e.state))}e.prototype.update=function(e){var t=syntaxTree(e.state),r=getHighlightStyle(e.state);var n=r!=e.startState.facet(highlightStyle);if(t.length<e.view.viewport.to&&!n&&t.type==this.tree.type){this.decorations=this.decorations.map(e.changes)}else if(t!=this.tree||e.viewportChanged||n){this.tree=t;this.decorations=this.buildDeco(e.view,r)}};e.prototype.buildDeco=function(e,t){var r=this;if(!t||!this.tree.length)return Decoration.none;var n=new RangeSetBuilder;for(var i=0,o=e.visibleRanges;i<o.length;i++){var a=o[i],s=a.from,l=a.to;highlightTreeRange(this.tree,s,l,t,(function(e,t,i){n.add(e,t,r.markCache[i]||(r.markCache[i]=Decoration.mark({class:i})))}))}return n.finish()};return e}();var treeHighlighter=Prec.high(ViewPlugin.fromClass(TreeHighlighter,{decorations:function(e){return e.decorations}}));var nodeStack=[""];var HighlightBuilder=function(){function e(e,t,r){this.at=e;this.style=t;this.span=r;this.class=""}e.prototype.startSpan=function(e,t){if(t!=this.class){this.flush(e);if(e>this.at)this.at=e;this.class=t}};e.prototype.flush=function(e){if(e>this.at&&this.class)this.span(this.at,e,this.class)};e.prototype.highlightRange=function(e,t,r,n,i,o){var a=e.type,s=e.from,l=e.to;if(s>=r||l<=t)return;nodeStack[i]=a.name;if(a.isTop)o=a;var c=n;var u=a.prop(ruleNodeProp),f=false;while(u){if(!u.context||matchContext(u.context,nodeStack,i)){for(var h=0,d=u.tags;h<d.length;h++){var p=d[h];var g=this.style(p,o);if(g){if(c)c+=" ";c+=g;if(u.mode==1)n+=(n?" ":"")+g;else if(u.mode==0)f=true}}break}u=u.next}this.startSpan(e.from,c);if(f)return;var v=e.tree&&e.tree.prop(NodeProp.mounted);if(v&&v.overlay){var m=e.node.enter(v.overlay[0].from+s,1);var y=e.firstChild();for(var b=0,w=s;;b++){var x=b<v.overlay.length?v.overlay[b]:null;var S=x?x.from+s:l;var k=Math.max(t,w),C=Math.min(r,S);if(k<C&&y){while(e.from<C){this.highlightRange(e,k,C,n,i+1,o);this.startSpan(Math.min(r,e.to),c);if(e.to>=S||!e.nextSibling())break}}if(!x||S>r)break;w=x.to+s;if(w>t){this.highlightRange(m.cursor,Math.max(t,x.from+s),Math.min(r,w),n,i,v.tree.type);this.startSpan(w,c)}}if(y)e.parent()}else if(e.firstChild()){do{if(e.to<=t)continue;if(e.from>=r)break;this.highlightRange(e,t,r,n,i+1,o);this.startSpan(Math.min(r,e.to),c)}while(e.nextSibling());e.parent()}};return e}();function highlightTreeRange(e,t,r,n,i){var o=new HighlightBuilder(t,n,i);o.highlightRange(e.cursor(),t,r,"",0,e.type);o.flush(r)}function matchContext(e,t,r){if(e.length>r-1)return false;for(var n=r-1,i=e.length-1;i>=0;i--,n--){var o=e[i];if(o&&o!=t[n])return false}return true}var t=Tag.define;var comment=t(),name=t(),typeName=t(name),propertyName=t(name),literal=t(),string=t(literal),number=t(literal),content=t(),heading=t(content),keyword=t(),operator=t(),punctuation=t(),bracket=t(punctuation),meta=t();var tags={comment:comment,lineComment:t(comment),blockComment:t(comment),docComment:t(comment),name:name,variableName:t(name),typeName:typeName,tagName:t(typeName),propertyName:propertyName,attributeName:t(propertyName),className:t(name),labelName:t(name),namespace:t(name),macroName:t(name),literal:literal,string:string,docString:t(string),character:t(string),attributeValue:t(string),number:number,integer:t(number),float:t(number),bool:t(literal),regexp:t(literal),escape:t(literal),color:t(literal),url:t(literal),keyword:keyword,self:t(keyword),null:t(keyword),atom:t(keyword),unit:t(keyword),modifier:t(keyword),operatorKeyword:t(keyword),controlKeyword:t(keyword),definitionKeyword:t(keyword),moduleKeyword:t(keyword),operator:operator,derefOperator:t(operator),arithmeticOperator:t(operator),logicOperator:t(operator),bitwiseOperator:t(operator),compareOperator:t(operator),updateOperator:t(operator),definitionOperator:t(operator),typeOperator:t(operator),controlOperator:t(operator),punctuation:punctuation,separator:t(punctuation),bracket:bracket,angleBracket:t(bracket),squareBracket:t(bracket),paren:t(bracket),brace:t(bracket),content:content,heading:heading,heading1:t(heading),heading2:t(heading),heading3:t(heading),heading4:t(heading),heading5:t(heading),heading6:t(heading),contentSeparator:t(content),list:t(content),quote:t(content),emphasis:t(content),strong:t(content),link:t(content),monospace:t(content),strikethrough:t(content),inserted:t(),deleted:t(),changed:t(),invalid:t(),meta:meta,documentMeta:t(meta),annotation:t(meta),processingInstruction:t(meta),definition:Tag.defineModifier(),constant:Tag.defineModifier(),function:Tag.defineModifier(),standard:Tag.defineModifier(),local:Tag.defineModifier(),special:Tag.defineModifier()};var defaultHighlightStyle=HighlightStyle.define([{tag:tags.link,textDecoration:"underline"},{tag:tags.heading,textDecoration:"underline",fontWeight:"bold"},{tag:tags.emphasis,fontStyle:"italic"},{tag:tags.strong,fontWeight:"bold"},{tag:tags.strikethrough,textDecoration:"line-through"},{tag:tags.keyword,color:"#708"},{tag:[tags.atom,tags.bool,tags.url,tags.contentSeparator,tags.labelName],color:"#219"},{tag:[tags.literal,tags.inserted],color:"#164"},{tag:[tags.string,tags.deleted],color:"#a11"},{tag:[tags.regexp,tags.escape,tags.special(tags.string)],color:"#e40"},{tag:tags.definition(tags.variableName),color:"#00f"},{tag:tags.local(tags.variableName),color:"#30a"},{tag:[tags.typeName,tags.namespace],color:"#085"},{tag:tags.className,color:"#167"},{tag:[tags.special(tags.variableName),tags.macroName],color:"#256"},{tag:tags.definition(tags.propertyName),color:"#00c"},{tag:tags.comment,color:"#940"},{tag:tags.meta,color:"#7a757a"},{tag:tags.invalid,color:"#f00"}]);var fromHistory=Annotation.define();var isolateHistory=Annotation.define();var invertedEffects=Facet.define();var historyConfig=Facet.define({combine:function(e){return combineConfig(e,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function changeEnd(e){var t=0;e.iterChangedRanges((function(e,r){return t=r}));return t}var historyField_=StateField.define({create:function(){return HistoryState.empty},update:function(e,t){var r=t.state.facet(historyConfig);var n=t.annotation(fromHistory);if(n){var i=t.docChanged?EditorSelection.single(changeEnd(t.changes)):undefined;var o=HistEvent.fromTransaction(t,i),a=n.side;var s=a==0?e.undone:e.done;if(o)s=updateBranch(s,s.length,r.minDepth,o);else s=addSelection(s,t.startState.selection);return new HistoryState(a==0?n.rest:s,a==0?s:n.rest)}var l=t.annotation(isolateHistory);if(l=="full"||l=="before")e=e.isolate();if(t.annotation(Transaction.addToHistory)===false)return!t.changes.empty?e.addMapping(t.changes.desc):e;var c=HistEvent.fromTransaction(t);var u=t.annotation(Transaction.time),f=t.annotation(Transaction.userEvent);if(c)e=e.addChanges(c,u,f,r.newGroupDelay,r.minDepth);else if(t.selection)e=e.addSelection(t.startState.selection,u,f,r.newGroupDelay);if(l=="full"||l=="after")e=e.isolate();return e},toJSON:function(e){return{done:e.done.map((function(e){return e.toJSON()})),undone:e.undone.map((function(e){return e.toJSON()}))}},fromJSON:function(e){return new HistoryState(e.done.map(HistEvent.fromJSON),e.undone.map(HistEvent.fromJSON))}});function history(e){if(e===void 0){e={}}return[historyField_,historyConfig.of(e),EditorView.domEventHandlers({beforeinput:function(e,t){var r=e.inputType=="historyUndo"?undo:e.inputType=="historyRedo"?redo:null;if(!r)return false;e.preventDefault();return r(t)}})]}var historyField=historyField_;function cmd(e,t){return function(r){var n=r.state,i=r.dispatch;if(!t&&n.readOnly)return false;var o=n.field(historyField_,false);if(!o)return false;var a=o.pop(e,n,t);if(!a)return false;i(a);return true}}var undo=cmd(0,false);var redo=cmd(1,false);var undoSelection=cmd(0,true);var redoSelection=cmd(1,true);var HistEvent=function(){function e(e,t,r,n,i){this.changes=e;this.effects=t;this.mapped=r;this.startSelection=n;this.selectionsAfter=i}e.prototype.setSelAfter=function(t){return new e(this.changes,this.effects,this.mapped,this.startSelection,t)};e.prototype.toJSON=function(){var e,t,r;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map((function(e){return e.toJSON()}))}};e.fromJSON=function(t){return new e(t.changes&&ChangeSet.fromJSON(t.changes),[],t.mapped&&ChangeDesc.fromJSON(t.mapped),t.startSelection&&EditorSelection.fromJSON(t.startSelection),t.selectionsAfter.map(EditorSelection.fromJSON))};e.fromTransaction=function(t,r){var n=none;for(var i=0,o=t.startState.facet(invertedEffects);i<o.length;i++){var a=o[i];var s=a(t);if(s.length)n=n.concat(s)}if(!n.length&&t.changes.empty)return null;return new e(t.changes.invert(t.startState.doc),n,undefined,r||t.startState.selection,none)};e.selection=function(t){return new e(undefined,none,undefined,undefined,t)};return e}();function updateBranch(e,t,r,n){var i=t+1>r+20?t-r-1:0;var o=e.slice(i,t);o.push(n);return o}function isAdjacent(e,t){var r=[],n=false;e.iterChangedRanges((function(e,t){return r.push(e,t)}));t.iterChangedRanges((function(e,t,i,o){for(var a=0;a<r.length;){var s=r[a++],l=r[a++];if(o>=s&&i<=l)n=true}}));return n}function eqSelectionShape(e,t){return e.ranges.length==t.ranges.length&&e.ranges.filter((function(e,r){return e.empty!=t.ranges[r].empty})).length===0}function conc(e,t){return!e.length?t:!t.length?e:e.concat(t)}var none=[];var MaxSelectionsPerEvent=200;function addSelection(e,t){if(!e.length){return[HistEvent.selection([t])]}else{var r=e[e.length-1];var n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-MaxSelectionsPerEvent));if(n.length&&n[n.length-1].eq(t))return e;n.push(t);return updateBranch(e,e.length-1,1e9,r.setSelAfter(n))}}function popSelection(e){var t=e[e.length-1];var r=e.slice();r[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1));return r}function addMappingToBranch(e,t){if(!e.length)return e;var r=e.length,n=none;while(r){var i=mapEvent(e[r-1],t,n);if(i.changes&&!i.changes.empty||i.effects.length){var o=e.slice(0,r);o[r-1]=i;return o}else{t=i.mapped;r--;n=i.selectionsAfter}}return n.length?[HistEvent.selection(n)]:none}function mapEvent(e,t,r){var n=conc(e.selectionsAfter.length?e.selectionsAfter.map((function(e){return e.map(t)})):none,r);if(!e.changes)return HistEvent.selection(n);var i=e.changes.map(t),o=t.mapDesc(e.changes,true);var a=e.mapped?e.mapped.composeDesc(o):o;return new HistEvent(i,StateEffect.mapEffects(e.effects,t),a,e.startSelection.map(o),n)}var joinableUserEvent=/^(input\.type|delete)($|\.)/;var HistoryState=function(){function e(e,t,r,n){if(r===void 0){r=0}if(n===void 0){n=undefined}this.done=e;this.undone=t;this.prevTime=r;this.prevUserEvent=n}e.prototype.isolate=function(){return this.prevTime?new e(this.done,this.undone):this};e.prototype.addChanges=function(t,r,n,i,o){var a=this.done,s=a[a.length-1];if(s&&s.changes&&!s.changes.empty&&t.changes&&(!n||joinableUserEvent.test(n))&&(!s.selectionsAfter.length&&r-this.prevTime<i&&isAdjacent(s.changes,t.changes)||n=="input.type.compose")){a=updateBranch(a,a.length-1,o,new HistEvent(t.changes.compose(s.changes),conc(t.effects,s.effects),s.mapped,s.startSelection,none))}else{a=updateBranch(a,a.length,o,t)}return new e(a,none,r,n)};e.prototype.addSelection=function(t,r,n,i){var o=this.done.length?this.done[this.done.length-1].selectionsAfter:none;if(o.length>0&&r-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&eqSelectionShape(o[o.length-1],t))return this;return new e(addSelection(this.done,t),this.undone,r,n)};e.prototype.addMapping=function(t){return new e(addMappingToBranch(this.done,t),addMappingToBranch(this.undone,t),this.prevTime,this.prevUserEvent)};e.prototype.pop=function(e,t,r){var n=e==0?this.done:this.undone;if(n.length==0)return null;var i=n[n.length-1];if(r&&i.selectionsAfter.length){return t.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:fromHistory.of({side:e,rest:popSelection(n)}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:true})}else if(!i.changes){return null}else{var o=n.length==1?none:n.slice(0,n.length-1);if(i.mapped)o=addMappingToBranch(o,i.mapped);return t.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:fromHistory.of({side:e,rest:o}),filter:false,userEvent:e==0?"undo":"redo",scrollIntoView:true})}};return e}();HistoryState.empty=new HistoryState(none,none);var historyKeymap=[{key:"Mod-z",run:undo,preventDefault:true},{key:"Mod-y",mac:"Mod-Shift-z",run:redo,preventDefault:true},{key:"Mod-u",run:undoSelection,preventDefault:true},{key:"Alt-u",mac:"Mod-Shift-u",run:redoSelection,preventDefault:true}];var panelConfig=Facet.define({combine:function(e){var t,r;for(var n=0,i=e;n<i.length;n++){var o=i[n];t=t||o.topContainer;r=r||o.bottomContainer}return{topContainer:t,bottomContainer:r}}});function getPanel(e,t){var r=e.plugin(panelPlugin);var n=r?r.specs.indexOf(t):-1;return n>-1?r.panels[n]:null}var panelPlugin=ViewPlugin.fromClass(function(){function e(e){this.input=e.state.facet(showPanel);this.specs=this.input.filter((function(e){return e}));this.panels=this.specs.map((function(t){return t(e)}));var t=e.state.facet(panelConfig);this.top=new PanelGroup(e,true,t.topContainer);this.bottom=new PanelGroup(e,false,t.bottomContainer);this.top.sync(this.panels.filter((function(e){return e.top})));this.bottom.sync(this.panels.filter((function(e){return!e.top})));for(var r=0,n=this.panels;r<n.length;r++){var i=n[r];i.dom.classList.add("cm-panel");if(i.mount)i.mount()}}e.prototype.update=function(e){var t=e.state.facet(panelConfig);if(this.top.container!=t.topContainer){this.top.sync([]);this.top=new PanelGroup(e.view,true,t.topContainer)}if(this.bottom.container!=t.bottomContainer){this.bottom.sync([]);this.bottom=new PanelGroup(e.view,false,t.bottomContainer)}this.top.syncClasses();this.bottom.syncClasses();var r=e.state.facet(showPanel);if(r!=this.input){var n=r.filter((function(e){return e}));var i=[],o=[],a=[],s=[];for(var l=0,c=n;l<c.length;l++){var u=c[l];var f=this.specs.indexOf(u),h=void 0;if(f<0){h=u(e.view);s.push(h)}else{h=this.panels[f];if(h.update)h.update(e)}i.push(h);(h.top?o:a).push(h)}this.specs=n;this.panels=i;this.top.sync(o);this.bottom.sync(a);for(var d=0,p=s;d<p.length;d++){var g=p[d];g.dom.classList.add("cm-panel");if(g.mount)g.mount()}}else{for(var v=0,m=this.panels;v<m.length;v++){var g=m[v];if(g.update)g.update(e)}}};e.prototype.destroy=function(){this.top.sync([]);this.bottom.sync([])};return e}(),{provide:PluginField.scrollMargins.from((function(e){return{top:e.top.scrollMargin(),bottom:e.bottom.scrollMargin()}}))});var PanelGroup=function(){function e(e,t,r){this.view=e;this.top=t;this.container=r;this.dom=undefined;this.classes="";this.panels=[];this.syncClasses()}e.prototype.sync=function(e){for(var t=0,r=this.panels;t<r.length;t++){var n=r[t];if(n.destroy&&e.indexOf(n)<0)n.destroy()}this.panels=e;this.syncDOM()};e.prototype.syncDOM=function(){if(this.panels.length==0){if(this.dom){this.dom.remove();this.dom=undefined}return}if(!this.dom){this.dom=document.createElement("div");this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom";this.dom.style[this.top?"top":"bottom"]="0";var e=this.container||this.view.dom;e.insertBefore(this.dom,this.top?e.firstChild:null)}var t=this.dom.firstChild;for(var r=0,n=this.panels;r<n.length;r++){var i=n[r];if(i.dom.parentNode==this.dom){while(t!=i.dom)t=rm(t);t=t.nextSibling}else{this.dom.insertBefore(i.dom,t)}}while(t)t=rm(t)};e.prototype.scrollMargin=function(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)};e.prototype.syncClasses=function(){if(!this.container||this.classes==this.view.themeClasses)return;for(var e=0,t=this.classes.split(" ");e<t.length;e++){var r=t[e];if(r)this.container.classList.remove(r)}for(var n=0,i=(this.classes=this.view.themeClasses).split(" ");n<i.length;n++){var r=i[n];if(r)this.container.classList.add(r)}};return e}();function rm(e){var t=e.nextSibling;e.remove();return t}var baseTheme$2=EditorView.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}});var showPanel=Facet.define({enables:[panelPlugin,baseTheme$2]});function crelt(){var e=arguments[0];if(typeof e=="string")e=document.createElement(e);var t=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var i=r[n];if(typeof i=="string")e.setAttribute(n,i);else if(i!=null)e[n]=i}t++}for(;t<arguments.length;t++)add(e,arguments[t]);return e}function add(e,t){if(typeof t=="string"){e.appendChild(document.createTextNode(t))}else if(t==null);else if(t.nodeType!=null){e.appendChild(t)}else if(Array.isArray(t)){for(var r=0;r<t.length;r++)add(e,t[r])}else{throw new RangeError("Unsupported child node: "+t)}}var basicNormalize=typeof String.prototype.normalize=="function"?function(e){return e.normalize("NFKD")}:function(e){return e};var SearchCursor=function(){function e(e,t,r,n,i){if(r===void 0){r=0}if(n===void 0){n=e.length}this.value={from:0,to:0};this.done=false;this.matches=[];this.buffer="";this.bufferPos=0;this.iter=e.iterRange(r,n);this.bufferStart=r;this.normalize=i?function(e){return i(basicNormalize(e))}:basicNormalize;this.query=this.normalize(t)}e.prototype.peek=function(){if(this.bufferPos==this.buffer.length){this.bufferStart+=this.buffer.length;this.iter.next();if(this.iter.done)return-1;this.bufferPos=0;this.buffer=this.iter.value}return codePointAt(this.buffer,this.bufferPos)};e.prototype.next=function(){while(this.matches.length)this.matches.pop();return this.nextOverlapping()};e.prototype.nextOverlapping=function(){for(;;){var e=this.peek();if(e<0){this.done=true;return this}var t=fromCodePoint(e),r=this.bufferStart+this.bufferPos;this.bufferPos+=codePointSize(e);var n=this.normalize(t);for(var i=0,o=r;;i++){var a=n.charCodeAt(i);var s=this.match(a,o);if(s){this.value=s;return this}if(i==n.length-1)break;if(o==r&&i<t.length&&t.charCodeAt(i)==a)o++}}};e.prototype.match=function(e,t){var r=null;for(var n=0;n<this.matches.length;n+=2){var i=this.matches[n],o=false;if(this.query.charCodeAt(i)==e){if(i==this.query.length-1){r={from:this.matches[n+1],to:t+1}}else{this.matches[n]++;o=true}}if(!o){this.matches.splice(n,2);n-=2}}if(this.query.charCodeAt(0)==e){if(this.query.length==1)r={from:t,to:t+1};else this.matches.push(1,t)}return r};return e}();if(typeof Symbol!="undefined")SearchCursor.prototype[Symbol.iterator]=function(){return this};var empty={from:-1,to:-1,match:/.*/.exec("")};var baseFlags="gm"+(/x/.unicode==null?"":"u");var RegExpCursor=function(){function e(e,t,r,n,i){if(n===void 0){n=0}if(i===void 0){i=e.length}this.to=i;this.curLine="";this.done=false;this.value=empty;if(/\\[sWDnr]|\n|\r|\[\^/.test(t))return new MultilineRegExpCursor(e,t,r,n,i);this.re=new RegExp(t,baseFlags+((r===null||r===void 0?void 0:r.ignoreCase)?"i":""));this.iter=e.iter();var o=e.lineAt(n);this.curLineStart=o.from;this.matchPos=n;this.getLine(this.curLineStart)}e.prototype.getLine=function(e){this.iter.next(e);if(this.iter.lineBreak){this.curLine=""}else{this.curLine=this.iter.value;if(this.curLineStart+this.curLine.length>this.to)this.curLine=this.curLine.slice(0,this.to-this.curLineStart);this.iter.next()}};e.prototype.nextLine=function(){this.curLineStart=this.curLineStart+this.curLine.length+1;if(this.curLineStart>this.to)this.curLine="";else this.getLine(0)};e.prototype.next=function(){for(var e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;var t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){var r=this.curLineStart+t.index,n=r+t[0].length;this.matchPos=n+(r==n?1:0);if(r==this.curLine.length)this.nextLine();if(r<n||r>this.value.to){this.value={from:r,to:n,match:t};return this}e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to){this.nextLine();e=0}else{this.done=true;return this}}};return e}();var flattened=new WeakMap;var FlattenedDoc=function(){function e(e,t){this.from=e;this.text=t}Object.defineProperty(e.prototype,"to",{get:function(){return this.from+this.text.length},enumerable:false,configurable:true});e.get=function(t,r,n){var i=flattened.get(t);if(!i||i.from>=n||i.to<=r){var o=new e(r,t.sliceString(r,n));flattened.set(t,o);return o}if(i.from==r&&i.to==n)return i;var a=i.text,s=i.from;if(s>r){a=t.sliceString(r,s)+a;s=r}if(i.to<n)a+=t.sliceString(i.to,n);flattened.set(t,new e(s,a));return new e(r,a.slice(r-s,n-s))};return e}();var MultilineRegExpCursor=function(){function e(e,t,r,n,i){this.text=e;this.to=i;this.done=false;this.value=empty;this.matchPos=n;this.re=new RegExp(t,baseFlags+((r===null||r===void 0?void 0:r.ignoreCase)?"i":""));this.flat=FlattenedDoc.get(e,n,this.chunkEnd(n+5e3))}e.prototype.chunkEnd=function(e){return e>=this.to?this.to:this.text.lineAt(e).to};e.prototype.next=function(){for(;;){var e=this.re.lastIndex=this.matchPos-this.flat.from;var t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e){this.re.lastIndex=e+1;t=this.re.exec(this.flat.text)}if(t&&this.flat.to<this.to&&t.index+t[0].length>this.flat.text.length-10)t=null;if(t){var r=this.flat.from+t.index,n=r+t[0].length;this.value={from:r,to:n,match:t};this.matchPos=n+(r==n?1:0);return this}else{if(this.flat.to==this.to){this.done=true;return this}this.flat=FlattenedDoc.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};return e}();if(typeof Symbol!="undefined"){RegExpCursor.prototype[Symbol.iterator]=MultilineRegExpCursor.prototype[Symbol.iterator]=function(){return this}}function validRegExp(e){try{return true}catch(t){return false}}function createLineDialog(e){var t=crelt("input",{class:"cm-textfield",name:"line"});var r=crelt("form",{class:"cm-gotoLine",onkeydown:function(t){if(t.keyCode==27){t.preventDefault();e.dispatch({effects:dialogEffect.of(false)});e.focus()}else if(t.keyCode==13){t.preventDefault();n()}},onsubmit:function(e){e.preventDefault();n()}},crelt("label",e.state.phrase("Go to line"),": ",t)," ",crelt("button",{class:"cm-button",type:"submit"},e.state.phrase("go")));function n(){var r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!r)return;var n=e.state,i=n.doc.lineAt(n.selection.main.head);var o=r[1],a=r[2],s=r[3],l=r[4];var c=s?+s.slice(1):0;var u=a?+a:i.number;if(a&&l){var f=u/100;if(o)f=f*(o=="-"?-1:1)+i.number/n.doc.lines;u=Math.round(n.doc.lines*f)}else if(a&&o){u=u*(o=="-"?-1:1)+i.number}var h=n.doc.line(Math.max(1,Math.min(n.doc.lines,u)));e.dispatch({effects:dialogEffect.of(false),selection:EditorSelection.cursor(h.from+Math.max(0,Math.min(c,h.length))),scrollIntoView:true});e.focus()}return{dom:r,pos:-10}}var dialogEffect=StateEffect.define();var dialogField=StateField.define({create:function(){return true},update:function(e,t){for(var r=0,n=t.effects;r<n.length;r++){var i=n[r];if(i.is(dialogEffect))e=i.value}return e},provide:function(e){return showPanel.from(e,(function(e){return e?createLineDialog:null}))}});var gotoLine=function(e){var t=getPanel(e,createLineDialog);if(!t){var r=[dialogEffect.of(true)];if(e.state.field(dialogField,false)==null)r.push(StateEffect.appendConfig.of([dialogField,baseTheme$1]));e.dispatch({effects:r});t=getPanel(e,createLineDialog)}if(t)t.dom.querySelector("input").focus();return true};var baseTheme$1=EditorView.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}});var selectWord=function(e){var t=e.state,r=e.dispatch;var n=t.selection;var i=EditorSelection.create(n.ranges.map((function(e){return t.wordAt(e.head)||EditorSelection.cursor(e.head)})),n.mainIndex);if(i.eq(n))return false;r(t.update({selection:i}));return true};function findNextOccurrence(e,t){var r=e.selection,n=r.main,i=r.ranges;var o=e.wordAt(n.head),a=o&&o.from==n.from&&o.to==n.to;var s=function(r,n){n.next();if(n.done){if(r)return{value:null};n=new SearchCursor(e.doc,t,0,Math.max(0,i[i.length-1].from-1));r=true}else{if(r&&i.some((function(e){return e.from==n.value.from})))return l=r,c=n,"continue";if(a){var o=e.wordAt(n.value.from);if(!o||o.from!=n.value.from||o.to!=n.value.to)return l=r,c=n,"continue"}return{value:n.value}}l=r;c=n};var l,c;for(var u=false,f=new SearchCursor(e.doc,t,i[i.length-1].to);;){var h=s(u,f);u=l;f=c;if(typeof h==="object")return h.value}}var selectNextOccurrence=function(e){var t=e.state,r=e.dispatch;var n=t.selection.ranges;if(n.some((function(e){return e.from===e.to})))return selectWord({state:t,dispatch:r});var i=t.sliceDoc(n[0].from,n[0].to);if(t.selection.ranges.some((function(e){return t.sliceDoc(e.from,e.to)!=i})))return false;var o=findNextOccurrence(t,i);if(!o)return false;r(t.update({selection:t.selection.addRange(EditorSelection.range(o.from,o.to),false),effects:EditorView.scrollIntoView(o.to)}));return true};var searchConfigFacet=Facet.define({combine:function(e){var t;return{top:e.reduce((function(e,t){return e!==null&&e!==void 0?e:t.top}),undefined)||false,caseSensitive:e.reduce((function(e,t){return e!==null&&e!==void 0?e:t.caseSensitive||t.matchCase}),undefined)||false,createPanel:((t=e.find((function(e){return e.createPanel})))===null||t===void 0?void 0:t.createPanel)||function(e){return new SearchPanel(e)}}}});function search(e){return e?[searchConfigFacet.of(e),searchExtensions]:searchExtensions}var SearchQuery=function(){function e(e){this.search=e.search;this.caseSensitive=!!e.caseSensitive;this.regexp=!!e.regexp;this.replace=e.replace||"";this.valid=!!this.search&&(!this.regexp||validRegExp());this.unquoted=this.search.replace(/\\([nrt\\])/g,(function(e,t){return t=="n"?"\n":t=="r"?"\r":t=="t"?"\t":"\\"}))}e.prototype.eq=function(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp};e.prototype.create=function(){return this.regexp?new RegExpQuery(this):new StringQuery(this)};e.prototype.getCursor=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=e.length}return this.regexp?regexpCursor(this,e,t,r):stringCursor(this,e,t,r)};return e}();var QueryType=function(){function e(e){this.spec=e}return e}();function stringCursor(e,t,r,n){return new SearchCursor(t,e.unquoted,r,n,e.caseSensitive?undefined:function(e){return e.toLowerCase()})}var StringQuery=function(e){__extends(t,e);function t(t){return e.call(this,t)||this}t.prototype.nextMatch=function(e,t,r){var n=stringCursor(this.spec,e,r,e.length).nextOverlapping();if(n.done)n=stringCursor(this.spec,e,0,t).nextOverlapping();return n.done?null:n.value};t.prototype.prevMatchInRange=function(e,t,r){for(var n=r;;){var i=Math.max(t,n-1e4-this.spec.unquoted.length);var o=stringCursor(this.spec,e,i,n),a=null;while(!o.nextOverlapping().done)a=o.value;if(a)return a;if(i==t)return null;n-=1e4}};t.prototype.prevMatch=function(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.length)};t.prototype.getReplacement=function(e){return this.spec.replace};t.prototype.matchAll=function(e,t){var r=stringCursor(this.spec,e,0,e.length),n=[];while(!r.next().done){if(n.length>=t)return null;n.push(r.value)}return n};t.prototype.highlight=function(e,t,r,n){var i=stringCursor(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,e.length));while(!i.next().done)n(i.value.from,i.value.to)};return t}(QueryType);function regexpCursor(e,t,r,n){return new RegExpCursor(t,e.search,e.caseSensitive?undefined:{ignoreCase:true},r,n)}var RegExpQuery=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}t.prototype.nextMatch=function(e,t,r){var n=regexpCursor(this.spec,e,r,e.length).next();if(n.done)n=regexpCursor(this.spec,e,0,t).next();return n.done?null:n.value};t.prototype.prevMatchInRange=function(e,t,r){for(var n=1;;n++){var i=Math.max(t,r-n*1e4);var o=regexpCursor(this.spec,e,i,r),a=null;while(!o.next().done)a=o.value;if(a&&(i==t||a.from>i+10))return a;if(i==t)return null}};t.prototype.prevMatch=function(e,t,r){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,r,e.length)};t.prototype.getReplacement=function(e){return this.spec.replace.replace(/\$([$&\d+])/g,(function(t,r){return r=="$"?"$":r=="&"?e.match[0]:r!="0"&&+r<e.match.length?e.match[r]:t}))};t.prototype.matchAll=function(e,t){var r=regexpCursor(this.spec,e,0,e.length),n=[];while(!r.next().done){if(n.length>=t)return null;n.push(r.value)}return n};t.prototype.highlight=function(e,t,r,n){var i=regexpCursor(this.spec,e,Math.max(0,t-250),Math.min(r+250,e.length));while(!i.next().done)n(i.value.from,i.value.to)};return t}(QueryType);var setSearchQuery=StateEffect.define();var togglePanel=StateEffect.define();var searchState=StateField.define({create:function(e){return new SearchState(defaultQuery(e).create(),null)},update:function(e,t){for(var r=0,n=t.effects;r<n.length;r++){var i=n[r];if(i.is(setSearchQuery))e=new SearchState(i.value.create(),e.panel);else if(i.is(togglePanel))e=new SearchState(e.query,i.value?createSearchPanel:null)}return e},provide:function(e){return showPanel.from(e,(function(e){return e.panel}))}});var SearchState=function(){function e(e,t){this.query=e;this.panel=t}return e}();var matchMark=Decoration.mark({class:"cm-searchMatch"}),selectedMatchMark=Decoration.mark({class:"cm-searchMatch cm-searchMatch-selected"});var searchHighlighter=ViewPlugin.fromClass(function(){function e(e){this.view=e;this.decorations=this.highlight(e.state.field(searchState))}e.prototype.update=function(e){var t=e.state.field(searchState);if(t!=e.startState.field(searchState)||e.docChanged||e.selectionSet||e.viewportChanged)this.decorations=this.highlight(t)};e.prototype.highlight=function(e){var t=e.query,r=e.panel;if(!r||!t.spec.valid)return Decoration.none;var n=this.view;var i=new RangeSetBuilder;for(var o=0,a=n.visibleRanges,s=a.length;o<s;o++){var l=a[o],c=l.from,u=l.to;while(o<s-1&&u>a[o+1].from-2*250)u=a[++o].to;t.highlight(n.state.doc,c,u,(function(e,t){var r=n.state.selection.ranges.some((function(r){return r.from==e&&r.to==t}));i.add(e,t,r?selectedMatchMark:matchMark)}))}return i.finish()};return e}(),{decorations:function(e){return e.decorations}});function searchCommand(e){return function(t){var r=t.state.field(searchState,false);return r&&r.query.spec.valid?e(t,r):openSearchPanel(t)}}var findNext=searchCommand((function(e,t){var r=t.query;var n=e.state.selection.main,i=n.from,o=n.to;var a=r.nextMatch(e.state.doc,i,o);if(!a||a.from==i&&a.to==o)return false;e.dispatch({selection:{anchor:a.from,head:a.to},scrollIntoView:true,effects:announceMatch(e,a),userEvent:"select.search"});return true}));var findPrevious=searchCommand((function(e,t){var r=t.query;var n=e.state,i=n.selection.main,o=i.from,a=i.to;var s=r.prevMatch(n.doc,o,a);if(!s)return false;e.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:true,effects:announceMatch(e,s),userEvent:"select.search"});return true}));var selectMatches=searchCommand((function(e,t){var r=t.query;var n=r.matchAll(e.state.doc,1e3);if(!n||!n.length)return false;e.dispatch({selection:EditorSelection.create(n.map((function(e){return EditorSelection.range(e.from,e.to)}))),userEvent:"select.search.matches"});return true}));var selectSelectionMatches=function(e){var t=e.state,r=e.dispatch;var n=t.selection;if(n.ranges.length>1||n.main.empty)return false;var i=n.main,o=i.from,a=i.to;var s=[],l=0;for(var c=new SearchCursor(t.doc,t.sliceDoc(o,a));!c.next().done;){if(s.length>1e3)return false;if(c.value.from==o)l=s.length;s.push(EditorSelection.range(c.value.from,c.value.to))}r(t.update({selection:EditorSelection.create(s,l),userEvent:"select.search.matches"}));return true};var replaceNext=searchCommand((function(e,t){var r=t.query;var n=e.state,i=n.selection.main,o=i.from,a=i.to;if(n.readOnly)return false;var s=r.nextMatch(n.doc,o,o);if(!s)return false;var l=[],c,u;if(s.from==o&&s.to==a){u=n.toText(r.getReplacement(s));l.push({from:s.from,to:s.to,insert:u});s=r.nextMatch(n.doc,s.from,s.to)}if(s){var f=l.length==0||l[0].from>=s.to?0:s.to-s.from-u.length;c={anchor:s.from-f,head:s.to-f}}e.dispatch({changes:l,selection:c,scrollIntoView:!!c,effects:s?announceMatch(e,s):undefined,userEvent:"input.replace"});return true}));var replaceAll=searchCommand((function(e,t){var r=t.query;if(e.state.readOnly)return false;var n=r.matchAll(e.state.doc,1e9).map((function(e){var t=e.from,n=e.to;return{from:t,to:n,insert:r.getReplacement(e)}}));if(!n.length)return false;e.dispatch({changes:n,userEvent:"input.replace.all"});return true}));function createSearchPanel(e){return e.state.facet(searchConfigFacet).createPanel(e)}function defaultQuery(e,t){var r;var n=e.selection.main;var i=n.empty||n.to>n.from+100?"":e.sliceDoc(n.from,n.to);var o=(r=t===null||t===void 0?void 0:t.caseSensitive)!==null&&r!==void 0?r:e.facet(searchConfigFacet).caseSensitive;return t&&!i?t:new SearchQuery({search:i.replace(/\n/g,"\\n"),caseSensitive:o})}var openSearchPanel=function(e){var t=e.state.field(searchState,false);if(t&&t.panel){var r=getPanel(e,createSearchPanel);if(!r)return false;var n=r.dom.querySelector("[name=search]");if(n!=e.root.activeElement){var i=defaultQuery(e.state,t.query.spec);if(i.valid)e.dispatch({effects:setSearchQuery.of(i)});n.focus();n.select()}}else{e.dispatch({effects:[togglePanel.of(true),t?setSearchQuery.of(defaultQuery(e.state,t.query.spec)):StateEffect.appendConfig.of(searchExtensions)]})}return true};var closeSearchPanel=function(e){var t=e.state.field(searchState,false);if(!t||!t.panel)return false;var r=getPanel(e,createSearchPanel);if(r&&r.dom.contains(e.root.activeElement))e.focus();e.dispatch({effects:togglePanel.of(false)});return true};var searchKeymap=[{key:"Mod-f",run:openSearchPanel,scope:"editor search-panel"},{key:"F3",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:true},{key:"Mod-g",run:findNext,shift:findPrevious,scope:"editor search-panel",preventDefault:true},{key:"Escape",run:closeSearchPanel,scope:"editor search-panel"},{key:"Mod-Shift-l",run:selectSelectionMatches},{key:"Alt-g",run:gotoLine},{key:"Mod-d",run:selectNextOccurrence,preventDefault:true}];var SearchPanel=function(){function e(e){var t=this;this.view=e;var r=this.query=e.state.field(searchState).query.spec;this.commit=this.commit.bind(this);this.searchField=crelt("input",{value:r.search,placeholder:phrase(e,"Find"),"aria-label":phrase(e,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit});this.replaceField=crelt("input",{value:r.replace,placeholder:phrase(e,"Replace"),"aria-label":phrase(e,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit});this.caseField=crelt("input",{type:"checkbox",name:"case",checked:r.caseSensitive,onchange:this.commit});this.reField=crelt("input",{type:"checkbox",name:"re",checked:r.regexp,onchange:this.commit});function n(e,t,r){return crelt("button",{class:"cm-button",name:e,onclick:t,type:"button"},r)}this.dom=crelt("div",{onkeydown:function(e){return t.keydown(e)},class:"cm-search"},__spreadArray([this.searchField,n("next",(function(){return findNext(e)}),[phrase(e,"next")]),n("prev",(function(){return findPrevious(e)}),[phrase(e,"previous")]),n("select",(function(){return selectMatches(e)}),[phrase(e,"all")]),crelt("label",null,[this.caseField,phrase(e,"match case")]),crelt("label",null,[this.reField,phrase(e,"regexp")])],e.state.readOnly?[]:[crelt("br"),this.replaceField,n("replace",(function(){return replaceNext(e)}),[phrase(e,"replace")]),n("replaceAll",(function(){return replaceAll(e)}),[phrase(e,"replace all")]),crelt("button",{name:"close",onclick:function(){return closeSearchPanel(e)},"aria-label":phrase(e,"close"),type:"button"},["×"])],true))}e.prototype.commit=function(){var e=new SearchQuery({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});if(!e.eq(this.query)){this.query=e;this.view.dispatch({effects:setSearchQuery.of(e)})}};e.prototype.keydown=function(e){if(runScopeHandlers(this.view,e,"search-panel")){e.preventDefault()}else if(e.keyCode==13&&e.target==this.searchField){e.preventDefault();(e.shiftKey?findPrevious:findNext)(this.view)}else if(e.keyCode==13&&e.target==this.replaceField){e.preventDefault();replaceNext(this.view)}};e.prototype.update=function(e){for(var t=0,r=e.transactions;t<r.length;t++){var n=r[t];for(var i=0,o=n.effects;i<o.length;i++){var a=o[i];if(a.is(setSearchQuery)&&!a.value.eq(this.query))this.setQuery(a.value)}}};e.prototype.setQuery=function(e){this.query=e;this.searchField.value=e.search;this.replaceField.value=e.replace;this.caseField.checked=e.caseSensitive;this.reField.checked=e.regexp};e.prototype.mount=function(){this.searchField.select()};Object.defineProperty(e.prototype,"pos",{get:function(){return 80},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"top",{get:function(){return this.view.state.facet(searchConfigFacet).top},enumerable:false,configurable:true});return e}();function phrase(e,t){return e.state.phrase(t)}var AnnounceMargin=30;var Break=/[\s\.,:;?!]/;function announceMatch(e,t){var r=t.from,n=t.to;var i=e.state.doc.lineAt(r).from,o=e.state.doc.lineAt(n).to;var a=Math.max(i,r-AnnounceMargin),s=Math.min(o,n+AnnounceMargin);var l=e.state.sliceDoc(a,s);if(a!=i){for(var c=0;c<AnnounceMargin;c++)if(!Break.test(l[c+1])&&Break.test(l[c])){l=l.slice(c);break}}if(s!=o){for(var u=l.length-1;u>l.length-AnnounceMargin;u--)if(!Break.test(l[u-1])&&Break.test(l[u])){l=l.slice(0,u);break}}return EditorView.announce.of("".concat(e.state.phrase("current match"),". ").concat(l," ").concat(e.state.phrase("on line")," ").concat(e.state.doc.lineAt(r).number))}var baseTheme=EditorView.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});var searchExtensions=[searchState,Prec.lowest(searchHighlighter),baseTheme];var LanguagePicker=function(e){var t=lookupFormat(e.activeLanguage);var r=Object.keys(e.executableLanguages).length>0;var n=r?Object.entries(e.languageCapabilities).reduce((function(t,r){var n;var i=r[0],o=r[1];return Object.keys(e.executableLanguages).includes(i)?t:Object.assign(Object.assign({},t),(n={},n[i]=o,n))}),{}):e.languageCapabilities;return h("label",{"aria-label":"Programming Language"},h("stencila-icon",{icon:"terminal"}),h("select",{onChange:e.onSetLanguage,ref:e.setRef,disabled:e.disabled},r&&Object.values(e.executableLanguages).map((function(e){return h("option",{value:e.name,selected:e.name===t.name},e.name)})),h("option",{disabled:true},"Not executable"),Object.values(n).map((function(e){return h("option",{value:e.name,selected:e.name===t.name},e.name)}))))};var updateErrors=StateEffect.define();var errorPanel=function(){var e=document.createElement("div");var t=false;var r=function(r){if(r){e.appendChild(r);t=true}};return{dom:e,update:function(e){for(var n=0,i=e.transactions;n<i.length;n++){var o=i[n];for(var a=0,s=o.effects;a<s.length;a++){var l=s[a];if(l.is(updateErrors)){if(!t&&l.value.slotRef){r(l.value.slotRef)}}}}}}};var codeErrors=function(){return showPanel.of(errorPanel)};var updateListenerExtension=function(e){return EditorView.updateListener.of((function(t){if(t.docChanged){e(t)}}))};var defaultEditorCss="*.sc-stencila-editor-default,.sc-stencila-editor-default:after,.sc-stencila-editor-default:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-editor-default{font-size:16px}.hidden.sc-stencila-editor-default{display:none}.sc-stencila-editor-default-h,stencila-editor.sc-stencila-editor-default{--gutter-background:var(\n    --color-background,var(--color-neutral-50,#e9eaf1)\n  );--gutter-color:var(--color-neutral-500,#6e7591);--border-width:1px;--background-color:transparent;all:initial;display:-ms-flexbox;display:flex;max-width:100%}.sc-stencila-editor-default-h .editorContainer.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default .editorContainer.sc-stencila-editor-default{background-color:var(--background-color);border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;border-width:1px;border-width:var(--border-width);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;max-width:100%}.sc-stencila-editor-default-h .editorContainer.sc-stencila-editor-default:focus-within,stencila-editor.sc-stencila-editor-default .editorContainer.sc-stencila-editor-default:focus-within{-webkit-box-shadow:inset 0 0 0 2px var(--color-neutral-200);box-shadow:inset 0 0 0 2px var(--color-neutral-200)}.sc-stencila-editor-default-h .editor.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default .editor.sc-stencila-editor-default{cursor:text;-ms-flex-positive:1;flex-grow:1;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;max-width:100%;overflow:auto}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-editor,.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-editor *,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-editor *{font-family:monospace;font-family:var(--font-family-mono,monospace)}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-editor{line-height:1.5}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .codemirror-focused,stencila-editor.sc-stencila-editor-default-s>.editorContainer .codemirror-focused{outline:2px solid transparent;outline-offset:2px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .codemirror-scroller,stencila-editor.sc-stencila-editor-default-s>.editorContainer .codemirror-scroller{overflow:auto}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-gutters,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-gutters{background-color:var(--gutter-background);color:var(--gutter-color)}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li{font-size:90%;padding-bottom:2px;padding-top:2px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-completionIcon,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-completionIcon{min-width:1.375em;min-width:2ch}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer stencila-code-error,stencila-editor.sc-stencila-editor-default-s>.editorContainer stencila-code-error{border-bottom-style:solid;border-radius:0;border-width:0 0 1px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer stencila-code-error:last-of-type,stencila-editor.sc-stencila-editor-default-s>.editorContainer stencila-code-error:last-of-type{border-bottom-width:0}.sc-stencila-editor-default-h menu.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default{border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-top-width:1px;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin:0;padding:1px 0}.sc-stencila-editor-default-h menu.sc-stencila-editor-default stencila-icon.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default stencila-icon.sc-stencila-editor-default{--height:1em;--width:1em;margin-right:.25rem}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-style:none;color:#444a5e;color:var(--color-neutral-700,#444a5e);font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.75rem;line-height:1rem;margin-right:.5rem;text-align:left}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default option.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default option.sc-stencila-editor-default{font-family:sans-serif;font-family:var(--font-family-body,sans-serif);text-align:right}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:active,.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:focus,.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:hover,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:active,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:focus,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:hover{color:#1f212a;color:var(--color-neutral-900,#1f212a)}";var editorMaterialCss="*.sc-stencila-editor-material,.sc-stencila-editor-material:after,.sc-stencila-editor-material:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-editor-material{font-size:16px}.hidden.sc-stencila-editor-material{display:none}.sc-stencila-editor-material-h,stencila-editor.sc-stencila-editor-material{--gutter-background:var(\n    --color-background,var(--color-neutral-50,#e9eaf1)\n  );--gutter-color:var(--color-neutral-500,#6e7591);--border-width:1px;--background-color:transparent;all:initial;display:-ms-flexbox;display:flex;max-width:100%}.sc-stencila-editor-material-h .editorContainer.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material .editorContainer.sc-stencila-editor-material{background-color:var(--background-color);border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;border-width:1px;border-width:var(--border-width);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;max-width:100%}.sc-stencila-editor-material-h .editorContainer.sc-stencila-editor-material:focus-within,stencila-editor.sc-stencila-editor-material .editorContainer.sc-stencila-editor-material:focus-within{-webkit-box-shadow:inset 0 0 0 2px var(--color-neutral-200);box-shadow:inset 0 0 0 2px var(--color-neutral-200)}.sc-stencila-editor-material-h .editor.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material .editor.sc-stencila-editor-material{cursor:text;-ms-flex-positive:1;flex-grow:1;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;max-width:100%;overflow:auto}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-editor,.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-editor *,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-editor *{font-family:monospace;font-family:var(--font-family-mono,monospace)}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-editor{line-height:1.5}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .codemirror-focused,stencila-editor.sc-stencila-editor-material-s>.editorContainer .codemirror-focused{outline:2px solid transparent;outline-offset:2px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .codemirror-scroller,stencila-editor.sc-stencila-editor-material-s>.editorContainer .codemirror-scroller{overflow:auto}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-gutters,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-gutters{background-color:var(--gutter-background);color:var(--gutter-color)}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li{font-size:90%;padding-bottom:2px;padding-top:2px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-completionIcon,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-completionIcon{min-width:1.375em;min-width:2ch}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer stencila-code-error,stencila-editor.sc-stencila-editor-material-s>.editorContainer stencila-code-error{border-bottom-style:solid;border-radius:0;border-width:0 0 1px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer stencila-code-error:last-of-type,stencila-editor.sc-stencila-editor-material-s>.editorContainer stencila-code-error:last-of-type{border-bottom-width:0}.sc-stencila-editor-material-h menu.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material{border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-top-width:1px;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin:0;padding:1px 0}.sc-stencila-editor-material-h menu.sc-stencila-editor-material stencila-icon.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material stencila-icon.sc-stencila-editor-material{--height:1em;--width:1em;margin-right:.25rem}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-style:none;color:#444a5e;color:var(--color-neutral-700,#444a5e);font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.75rem;line-height:1rem;margin-right:.5rem;text-align:left}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material option.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material option.sc-stencila-editor-material{font-family:sans-serif;font-family:var(--font-family-body,sans-serif);text-align:right}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:active,.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:focus,.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:hover,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:active,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:focus,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:hover{color:#1f212a;color:var(--color-neutral-900,#1f212a)}";var slots={text:"text",errors:"errors"};var cssClasses={container:"editorContainer",editor:"editor"};var cssIds={editorTarget:"editorTarget"};var Editor=function(){function e(e){var t=this;registerInstance(this,e);this.languageChange=createEvent(this,"stencila-language-change",7);this.contentChange=createEvent(this,"stencila-content-change",7);var r,n,i,o;this.isReady=false;this.isUpdatingContent=false;this.languageCapabilities=fileFormatMap;this.executableLanguages=(n=(r=window.stencilaWebClient)===null||r===void 0?void 0:r.executableLanguages)!==null&&n!==void 0?n:{};this.readOnly=false;this.readOnlyConf=new Compartment;this.activeLanguage=(o=(i=this.languageCapabilities.R)===null||i===void 0?void 0:i.name)!==null&&o!==void 0?o:"";this.dispatchEffect=function(e){var r,n,i;var o=(r=t.editorRef)===null||r===void 0?void 0:r.state;var a=(n=o===null||o===void 0?void 0:o.update({effects:[e]}))!==null&&n!==void 0?n:{};(i=t.editorRef)===null||i===void 0?void 0:i.dispatch(a)};this.getLang=function(e){return __awaiter(t,void 0,void 0,(function(){var t,r,n,r,i,r,o,r,a,r,s,l,c,c,u,f,h,r,d,p,r,d,p,g;return __generator(this,(function(v){switch(v.label){case 0:t=lookupFormat(e).name.toLowerCase();switch(t){case"bash":return[3,1];case"zsh":return[3,1];case"latex":return[3,4];case"toml":return[3,7];case"yaml":return[3,10];case"dockerfile":return[3,13];case"html":return[3,16];case"javascript":return[3,18];case"typescript":return[3,20];case"json":return[3,22];case"xml":return[3,24];case"calc":return[3,26];case"python":return[3,26];case"r":return[3,28];case"rmd":return[3,31];case"md":return[3,35];case"markdown":return[3,35];case"sql":return[3,37]}return[3,35];case 1:return[4,import("./index-3b0b5738.js")];case 2:r=v.sent().StreamLanguage;return[4,import("./shell-f1520e9d.js")];case 3:n=v.sent().shell;return[2,r.define(n)];case 4:return[4,import("./index-3b0b5738.js")];case 5:r=v.sent().StreamLanguage;return[4,import("./stex-5289b311.js")];case 6:i=v.sent().stexMath;return[2,r.define(i)];case 7:return[4,import("./index-3b0b5738.js")];case 8:r=v.sent().StreamLanguage;return[4,import("./toml-9561606b.js")];case 9:o=v.sent().toml;return[2,r.define(o)];case 10:return[4,import("./index-3b0b5738.js")];case 11:r=v.sent().StreamLanguage;return[4,import("./yaml-c86188d3.js")];case 12:a=v.sent().yaml;return[2,r.define(a)];case 13:return[4,import("./index-3b0b5738.js")];case 14:r=v.sent().StreamLanguage;return[4,import("./dockerfile-fbfef70c.js")];case 15:s=v.sent().dockerFile;return[2,r.define(s)];case 16:return[4,import("./index-fa83f062.js")];case 17:l=v.sent().html;return[2,l()];case 18:return[4,import("./index-12d58319.js")];case 19:c=v.sent().javascript;return[2,c()];case 20:return[4,import("./index-12d58319.js")];case 21:c=v.sent().javascript;return[2,c({typescript:true})];case 22:return[4,import("./index-cec7f230.js")];case 23:u=v.sent().json;return[2,u()];case 24:return[4,import("./index-20290304.js")];case 25:f=v.sent().xml;return[2,f()];case 26:return[4,import("./index-d887d8aa.js")];case 27:h=v.sent().python;return[2,h()];case 28:return[4,import("./index-3b0b5738.js")];case 29:r=v.sent().StreamLanguage;return[4,import("./r-6f6c9fd0.js")];case 30:d=v.sent().r;return[2,r.define(d)];case 31:return[4,import("./index-74ae9671.js")];case 32:p=v.sent().markdown;return[4,import("./index-3b0b5738.js")];case 33:r=v.sent().StreamLanguage;return[4,import("./r-6f6c9fd0.js")];case 34:d=v.sent().r;return[2,p({defaultCodeLanguage:r.define(d)})];case 35:return[4,import("./index-74ae9671.js")];case 36:p=v.sent().markdown;return[2,p()];case 37:return[4,import("./index-29265033.js")];case 38:g=v.sent().sql;return[2,g()]}}))}))};this.languageConf=new Compartment;this.setEditorSyntax=function(e){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.getLang(e)];case 1:t=r.sent();this.dispatchEffect(this.languageConf.reconfigure(t));return[2]}}))}))};this.setLanguagePickerRef=function(e){return t.languagePickerRef=e};this.onSelectLanguage=function(e){return __awaiter(t,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){t=e.currentTarget;r=lookupFormat(t.value);this.languageChange.emit(r);return[2,this.setEditorSyntax(r.name)]}))}))};this.execute=function(){t.getContents().then((function(e){return t.executeHandler?t.executeHandler(e):e})).catch((function(e){console.error(e);return false}));return true};this.autofocus=false;this.lineNumbersConf=new Compartment;this.lineNumbers=true;this.lineWrappingConf=new Compartment;this.lineWrapping=false;this.foldGutterConf=new Compartment;this.foldGutter=true;this.keymap=[];this.setErrors=function(){var e;(e=t.editorRef)===null||e===void 0?void 0:e.dispatch({effects:updateErrors.of({slotRef:t.errorsSlot})})};this.getCodeMirrorConfig=function(e){if(e===void 0){e={}}return __awaiter(t,void 0,void 0,(function(){var t,r,n,i,o,a,s;var l=this;return __generator(this,(function(c){switch(c.label){case 0:t=Object.assign({language:this.activeLanguage,foldGutterEnabled:this.foldGutter,lineNumbersEnabled:this.lineNumbers,lineWrappingEnabled:this.lineWrapping},e),r=t.language,n=t.foldGutterEnabled,i=t.lineNumbersEnabled,o=t.lineWrappingEnabled;return[4,this.getLang(r)];case 1:a=c.sent();s=[history(),autocompletion(),EditorState.languageData.of((function(){return[{autocomplete:completeAnyWord}]})),bracketMatching(),closeBrackets(),Prec.fallback(defaultHighlightStyle),this.languageConf.of(a),this.lineWrappingConf.of(o?EditorView.lineWrapping:[]),this.lineNumbersConf.of(i?lineNumbers():[]),this.foldGutterConf.of(n?foldGutter():[]),drawSelection(),EditorState.allowMultipleSelections.of(true),search({top:true}),highlightSpecialChars(),keymap.of(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],this.keymap,true),commentKeymap,true),closeBracketsKeymap,true),historyKeymap,true),foldKeymap,true),searchKeymap,true),[{key:"Ctrl-Space",run:startCompletion},{key:"Ctrl-Enter",run:this.execute}],false),defaultKeymap,true)),this.readOnlyConf.of(EditorView.editable.of(!this.readOnly)),codeErrors(),updateListenerExtension((function(e){var t;(t=l.contentChangeHandler)===null||t===void 0?void 0:t.call(l,e);if(!l.isUpdatingContent){l.contentChange.emit(e)}}))];return[2,s]}}))}))};this.initCodeMirror=function(){return __awaiter(t,void 0,void 0,(function(){var e,t,r,n,i,o,a,s,l;var c,u;return __generator(this,(function(f){switch(f.label){case 0:r=this.el;n=getSlotByName(r)(slots.text)[0];i=(t=(e=this.contents)!==null&&e!==void 0?e:n===null||n===void 0?void 0:n.textContent)!==null&&t!==void 0?t:"";o=this;a=EditorView.bind;c={};l=(s=EditorState).create;u={doc:i};return[4,this.getCodeMirrorConfig()];case 1:o.editorRef=new(a.apply(EditorView,[void 0,(c.state=l.apply(s,[(u.extensions=f.sent(),u)]),c)]));this.isReady=true;return[2]}}))}))};this.attachEditorToDom=function(){var e,r,n;var i=(e=t.editorRef)===null||e===void 0?void 0:e.dom;if(i){(n=(r=t.el)===null||r===void 0?void 0:r.querySelector("#".concat(cssIds.editorTarget)))===null||n===void 0?void 0:n.replaceWith(i)}};this.setContentsHandler=function(e){var r,n,i,o;t.isUpdatingContent=true;var a=(r=t.editorRef)===null||r===void 0?void 0:r.state;var s=(i=a===null||a===void 0?void 0:a.update({changes:{from:0,to:a.doc.length,insert:e},selection:(n=t.editorRef)===null||n===void 0?void 0:n.state.selection}))!==null&&i!==void 0?i:{};(o=t.editorRef)===null||o===void 0?void 0:o.dispatch(s);t.isUpdatingContent=false};this.textSlotObserver=new MutationObserver((function(){var e,r;var n=(r=(e=t.textSlot)===null||e===void 0?void 0:e.textContent)!==null&&r!==void 0?r:"";t.setContentsHandler(n)}));this.stopEventPropagation=function(e){e.stopPropagation()};this.focus=function(){var e;(e=t.editorRef)===null||e===void 0?void 0:e.focus()}}e.prototype.contentsChanged=function(e,t){if(e!==t){this.setContentsHandler(e)}};e.prototype.onDiscoverExecutableLanguages=function(e){var t=e.detail;this.executableLanguages=t.languages};e.prototype.readOnlyChanged=function(e,t){if(e!==t){this.dispatchEffect(this.readOnlyConf.reconfigure(EditorView.editable.of(!this.readOnly)))}};e.prototype.activeLanguageChanged=function(e,t){if(e!==t){this.setEditorSyntax(e).catch((function(e){console.log(e)}))}};e.prototype.onSetLineNumbers=function(e,t){if(e!==t){this.dispatchEffect(this.lineNumbersConf.reconfigure(e?lineNumbers():[]))}};e.prototype.onSetLineWrapping=function(e,t){if(e!==t){this.dispatchEffect(this.lineWrappingConf.reconfigure(e?EditorView.lineWrapping:[]))}};e.prototype.onSetfoldGutter=function(e,t){if(e!==t){this.dispatchEffect(this.foldGutterConf.reconfigure(e?foldGutter():[]))}};e.prototype.getContents=function(){var e,t,r,n;return Promise.resolve({text:(t=(e=this.editorRef)===null||e===void 0?void 0:e.state.doc.toString())!==null&&t!==void 0?t:"",language:lookupFormat((n=(r=this.languagePickerRef)===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:this.activeLanguage).name.toLowerCase()})};e.prototype.setContents=function(e){this.setContentsHandler(e);return Promise.resolve(e)};e.prototype.getState=function(){var e;return Promise.resolve((e=this.editorRef)===null||e===void 0?void 0:e.state.toJSON({history:historyField}))};e.prototype.setState=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n,i,o,a,s;var l;return __generator(this,(function(c){switch(c.label){case 0:if(!((t=this.editorRef)===null||t===void 0))return[3,1];r=void 0;return[3,3];case 1:i=(n=t).setState;a=(o=EditorState).fromJSON;s=[e];l={};return[4,this.getCodeMirrorConfig()];case 2:r=i.apply(n,[a.apply(o,s.concat([(l.extensions=c.sent(),l),{history:historyField}]))]);c.label=3;case 3:r;return[2]}}))}))};e.prototype.setStateFromString=function(e){return __awaiter(this,void 0,void 0,(function(){var t,r,n,i,o,a;var s;return __generator(this,(function(l){switch(l.label){case 0:if(!((t=this.editorRef)===null||t===void 0))return[3,1];r=void 0;return[3,3];case 1:i=(n=t).setState;a=(o=EditorState).create;s={doc:e};return[4,this.getCodeMirrorConfig()];case 2:r=i.apply(n,[a.apply(o,[(s.extensions=l.sent(),s)])]);l.label=3;case 3:r;return[2]}}))}))};e.prototype.getRef=function(){return __awaiter(this,void 0,void 0,(function(){var e=this;return __generator(this,(function(t){if(this.editorRef){return[2,this.editorRef]}return[2,new Promise((function(t,r){var n=true;var i=3e3;var o=setTimeout((function(){n=false}),i);var a=function(){setInterval((function(){if(e.editorRef&&e.isReady){clearTimeout(o);t(e.editorRef)}else if(!n){r(new Error("Editor wasn’t instantiated in time (".concat(i,"ms), please try again.")))}else{a()}}),100)};a()}))]}))}))};e.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){try{return[2,this.initCodeMirror()]}catch(t){console.log("Encountered error while initializing code editor\n",t)}return[2]}))}))};e.prototype.componentDidLoad=function(){this.attachEditorToDom();if(this.autofocus){this.focus()}if(this.textSlot){this.textSlotObserver.observe(this.textSlot,{childList:true,characterData:true,subtree:true})}if(this.errorsSlot){this.setErrors()}};e.prototype.disconnectedCallback=function(){var e;this.textSlotObserver.disconnect();(e=this.editorRef)===null||e===void 0?void 0:e.destroy()};e.prototype.render=function(){var e=this;return h(Host,null,h("div",{class:cssClasses.container},h("div",{class:cssClasses.editor,onKeyDown:this.stopEventPropagation,onClick:this.focus},h("div",{class:"hidden",ref:function(t){return e.textSlot=t}},h("slot",{name:slots.text})),h("div",{ref:function(t){return e.errorsSlot=t}},h("slot",{name:slots.errors})),h("div",{id:cssIds.editorTarget})),h("menu",null,h(LanguagePicker,{activeLanguage:this.activeLanguage,disabled:this.readOnly,onSetLanguage:this.onSelectLanguage,languageCapabilities:this.languageCapabilities,executableLanguages:this.executableLanguages,setRef:this.setLanguagePickerRef}))))};Object.defineProperty(e.prototype,"el",{get:function(){return getElement(this)},enumerable:false,configurable:true});Object.defineProperty(e,"watchers",{get:function(){return{contents:["contentsChanged"],readOnly:["readOnlyChanged"],activeLanguage:["activeLanguageChanged"],lineNumbers:["onSetLineNumbers"],lineWrapping:["onSetLineWrapping"],foldGutter:["onSetfoldGutter"]}},enumerable:false,configurable:true});return e}();Editor.style={default:defaultEditorCss,material:editorMaterialCss};export{Editor as A,DefaultBufferLength as D,EditorView as E,Language as L,NodeProp as N,Parser as P,Tree as T,NodeType as a,styleTags as b,ParseContext as c,defineLanguageFacet as d,NodeSet as e,LanguageSupport as f,getIndentUnit as g,LRLanguage as h,indentService as i,indentNodeProp as j,continuedIndent as k,languageDataProp as l,foldNodeProp as m,foldInside$1 as n,EditorSelection as o,parseMixed as p,snippetCompletion as q,flatIndent as r,syntaxTree as s,tags as t,delimitedIndent as u,ifNotIn as v,completeFromList as w,Prec as x,keymap as y,LanguageDescription as z};
//# sourceMappingURL=stencila-editor-a35809c0.js.map