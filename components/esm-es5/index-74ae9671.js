var __extends=this&&this.__extends||function(){var e=function(t,r){e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r))e[r]=t[r]};return e(t,r)};return function(t,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");e(t,r);function n(){this.constructor=t}t.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __spreadArray=this&&this.__spreadArray||function(e,t,r){if(r||arguments.length===2)for(var n=0,i=t.length,a;n<i;n++){if(a||!(n in t)){if(!a)a=Array.prototype.slice.call(t,0,n);a[n]=t[n]}}return e.concat(a||Array.prototype.slice.call(t))};var _a;import{a as NodeType,N as NodeProp,e as NodeSet,P as Parser,T as Tree,p as parseMixed,L as Language,s as syntaxTree,o as EditorSelection,x as Prec,y as keymap,f as LanguageSupport,d as defineLanguageFacet,b as styleTags,t as tags,m as foldNodeProp,j as indentNodeProp,l as languageDataProp,z as LanguageDescription,c as ParseContext}from"./stencila-editor-a35809c0.js";import{html}from"./index-fa83f062.js";import"./index-2305c23c.js";import"./slotSelectors-df70e421.js";import"./languageUtils-2c49a4c4.js";import"./index-82af852d.js";import"./index-12d58319.js";var CompositeBlock=function(){function e(e,t,r,n,i,a,s){this.type=e;this.value=t;this.from=r;this.hash=n;this.end=i;this.children=a;this.positions=s;this.hashProp=[[NodeProp.contextHash,n]]}e.create=function(t,r,n,i,a){var s=i+(i<<8)+t+(r<<4)|0;return new e(t,r,n,s,a,[],[])};e.prototype.addChild=function(e,t){if(e.prop(NodeProp.contextHash)!=this.hash)e=new Tree(e.type,e.children,e.positions,e.length,this.hashProp);this.children.push(e);this.positions.push(t)};e.prototype.toTree=function(e,t){var r=this;if(t===void 0){t=this.end}var n=this.children.length-1;if(n>=0)t=Math.max(t,this.positions[n]+this.children[n].length+this.from);var i=new Tree(e.types[this.type],this.children,this.positions,t-this.from).balance({makeTree:function(e,t,n){return new Tree(NodeType.none,e,t,n,r.hashProp)}});return i};return e}();var Type;(function(e){e[e["Document"]=1]="Document";e[e["CodeBlock"]=2]="CodeBlock";e[e["FencedCode"]=3]="FencedCode";e[e["Blockquote"]=4]="Blockquote";e[e["HorizontalRule"]=5]="HorizontalRule";e[e["BulletList"]=6]="BulletList";e[e["OrderedList"]=7]="OrderedList";e[e["ListItem"]=8]="ListItem";e[e["ATXHeading1"]=9]="ATXHeading1";e[e["ATXHeading2"]=10]="ATXHeading2";e[e["ATXHeading3"]=11]="ATXHeading3";e[e["ATXHeading4"]=12]="ATXHeading4";e[e["ATXHeading5"]=13]="ATXHeading5";e[e["ATXHeading6"]=14]="ATXHeading6";e[e["SetextHeading1"]=15]="SetextHeading1";e[e["SetextHeading2"]=16]="SetextHeading2";e[e["HTMLBlock"]=17]="HTMLBlock";e[e["LinkReference"]=18]="LinkReference";e[e["Paragraph"]=19]="Paragraph";e[e["CommentBlock"]=20]="CommentBlock";e[e["ProcessingInstructionBlock"]=21]="ProcessingInstructionBlock";e[e["Escape"]=22]="Escape";e[e["Entity"]=23]="Entity";e[e["HardBreak"]=24]="HardBreak";e[e["Emphasis"]=25]="Emphasis";e[e["StrongEmphasis"]=26]="StrongEmphasis";e[e["Link"]=27]="Link";e[e["Image"]=28]="Image";e[e["InlineCode"]=29]="InlineCode";e[e["HTMLTag"]=30]="HTMLTag";e[e["Comment"]=31]="Comment";e[e["ProcessingInstruction"]=32]="ProcessingInstruction";e[e["URL"]=33]="URL";e[e["HeaderMark"]=34]="HeaderMark";e[e["QuoteMark"]=35]="QuoteMark";e[e["ListMark"]=36]="ListMark";e[e["LinkMark"]=37]="LinkMark";e[e["EmphasisMark"]=38]="EmphasisMark";e[e["CodeMark"]=39]="CodeMark";e[e["CodeText"]=40]="CodeText";e[e["CodeInfo"]=41]="CodeInfo";e[e["LinkTitle"]=42]="LinkTitle";e[e["LinkLabel"]=43]="LinkLabel"})(Type||(Type={}));var LeafBlock=function(){function e(e,t){this.start=e;this.content=t;this.marks=[];this.parsers=[]}return e}();var Line=function(){function e(){this.text="";this.baseIndent=0;this.basePos=0;this.depth=0;this.markers=[];this.pos=0;this.indent=0;this.next=-1}e.prototype.forward=function(){if(this.basePos>this.pos)this.forwardInner()};e.prototype.forwardInner=function(){var e=this.skipSpace(this.basePos);this.indent=this.countIndent(e,this.pos,this.indent);this.pos=e;this.next=e==this.text.length?-1:this.text.charCodeAt(e)};e.prototype.skipSpace=function(e){return skipSpace(this.text,e)};e.prototype.reset=function(e){this.text=e;this.baseIndent=this.basePos=this.pos=this.indent=0;this.forwardInner();this.depth=1;while(this.markers.length)this.markers.pop()};e.prototype.moveBase=function(e){this.basePos=e;this.baseIndent=this.countIndent(e,this.pos,this.indent)};e.prototype.moveBaseColumn=function(e){this.baseIndent=e;this.basePos=this.findColumn(e)};e.prototype.addMarker=function(e){this.markers.push(e)};e.prototype.countIndent=function(e,t,r){if(t===void 0){t=0}if(r===void 0){r=0}for(var n=t;n<e;n++)r+=this.text.charCodeAt(n)==9?4-r%4:1;return r};e.prototype.findColumn=function(e){var t=0;for(var r=0;t<this.text.length&&r<e;t++)r+=this.text.charCodeAt(t)==9?4-r%4:1;return t};e.prototype.scrub=function(){if(!this.baseIndent)return this.text;var e="";for(var t=0;t<this.basePos;t++)e+=" ";return e+this.text.slice(this.basePos)};return e}();function skipForList(e,t,r){if(r.pos==r.text.length||e!=t.block&&r.indent>=t.stack[r.depth+1].value+r.baseIndent)return true;if(r.indent>=r.baseIndent+4)return false;var n=(e.type==Type.OrderedList?isOrderedList:isBulletList)(r,t,false);return n>0&&(e.type!=Type.BulletList||isHorizontalRule(r,t,false)<0)&&r.text.charCodeAt(r.pos+n-1)==e.value}var DefaultSkipMarkup=(_a={},_a[Type.Blockquote]=function(e,t,r){if(r.next!=62)return false;r.markers.push(elt(Type.QuoteMark,t.lineStart+r.pos,t.lineStart+r.pos+1));r.moveBase(r.pos+(space(r.text.charCodeAt(r.pos+1))?2:1));e.end=t.lineStart+r.text.length;return true},_a[Type.ListItem]=function(e,t,r){if(r.indent<r.baseIndent+e.value&&r.next>-1)return false;r.moveBaseColumn(r.baseIndent+e.value);return true},_a[Type.OrderedList]=skipForList,_a[Type.BulletList]=skipForList,_a[Type.Document]=function(){return true},_a);function space(e){return e==32||e==9||e==10||e==13}function skipSpace(e,t){if(t===void 0){t=0}while(t<e.length&&space(e.charCodeAt(t)))t++;return t}function skipSpaceBack(e,t,r){while(t>r&&space(e.charCodeAt(t-1)))t--;return t}function isFencedCode(e){if(e.next!=96&&e.next!=126)return-1;var t=e.pos+1;while(t<e.text.length&&e.text.charCodeAt(t)==e.next)t++;if(t<e.pos+3)return-1;if(e.next==96)for(var r=t;r<e.text.length;r++)if(e.text.charCodeAt(r)==96)return-1;return t}function isBlockquote(e){return e.next!=62?-1:e.text.charCodeAt(e.pos+1)==32?2:1}function isHorizontalRule(e,t,r){if(e.next!=42&&e.next!=45&&e.next!=95)return-1;var n=1;for(var i=e.pos+1;i<e.text.length;i++){var a=e.text.charCodeAt(i);if(a==e.next)n++;else if(!space(a))return-1}if(r&&e.next==45&&isSetextUnderline(e)>-1&&e.depth==t.stack.length)return-1;return n<3?-1:1}function inList(e,t){for(var r=e.stack.length-1;r>=0;r--)if(e.stack[r].type==t)return true;return false}function isBulletList(e,t,r){return(e.next==45||e.next==43||e.next==42)&&(e.pos==e.text.length-1||space(e.text.charCodeAt(e.pos+1)))&&(!r||inList(t,Type.BulletList)||e.skipSpace(e.pos+2)<e.text.length)?1:-1}function isOrderedList(e,t,r){var n=e.pos,i=e.next;for(;;){if(i>=48&&i<=57)n++;else break;if(n==e.text.length)return-1;i=e.text.charCodeAt(n)}if(n==e.pos||n>e.pos+9||i!=46&&i!=41||n<e.text.length-1&&!space(e.text.charCodeAt(n+1))||r&&!inList(t,Type.OrderedList)&&(e.skipSpace(n+1)==e.text.length||n>e.pos+1||e.next!=49))return-1;return n+1-e.pos}function isAtxHeading(e){if(e.next!=35)return-1;var t=e.pos+1;while(t<e.text.length&&e.text.charCodeAt(t)==35)t++;if(t<e.text.length&&e.text.charCodeAt(t)!=32)return-1;var r=t-e.pos;return r>6?-1:r}function isSetextUnderline(e){if(e.next!=45&&e.next!=61||e.indent>=e.baseIndent+4)return-1;var t=e.pos+1;while(t<e.text.length&&e.text.charCodeAt(t)==e.next)t++;var r=t;while(t<e.text.length&&space(e.text.charCodeAt(t)))t++;return t==e.text.length?r:-1}var EmptyLine=/^[ \t]*$/,CommentEnd=/-->/,ProcessingEnd=/\?>/;var HTMLBlockStyle=[[/^<(?:script|pre|style)(?:\s|>|$)/i,/<\/(?:script|pre|style)>/i],[/^\s*<!--/,CommentEnd],[/^\s*<\?/,ProcessingEnd],[/^\s*<![A-Z]/,/>/],[/^\s*<!\[CDATA\[/,/\]\]>/],[/^\s*<\/?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|\/?>|$)/i,EmptyLine],[/^\s*(?:<\/[a-z][\w-]*\s*>|<[a-z][\w-]*(\s+[a-z:_][\w-.]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*>)\s*$/i,EmptyLine]];function isHTMLBlock(e,t,r){if(e.next!=60)return-1;var n=e.text.slice(e.pos);for(var i=0,a=HTMLBlockStyle.length-(r?1:0);i<a;i++)if(HTMLBlockStyle[i][0].test(n))return i;return-1}function getListIndent(e,t){var r=e.countIndent(t,e.pos,e.indent);var n=e.countIndent(e.skipSpace(t),t,r);return n>=r+5?r+1:n}function addCodeText(e,t,r){var n=e.length-1;if(n>=0&&e[n].to==t&&e[n].type==Type.CodeText)e[n].to=r;else e.push(elt(Type.CodeText,t,r))}var DefaultBlockParsers={LinkReference:undefined,IndentedCode:function(e,t){var r=t.baseIndent+4;if(t.indent<r)return false;var n=t.findColumn(r);var i=e.lineStart+n,a=e.lineStart+t.text.length;var s=[],o=[];addCodeText(s,i,a);while(e.nextLine()&&t.depth>=e.stack.length){if(t.pos==t.text.length){addCodeText(o,e.lineStart-1,e.lineStart);for(var l=0,f=t.markers;l<f.length;l++){var p=f[l];o.push(p)}}else if(t.indent<r){break}else{if(o.length){for(var u=0,h=o;u<h.length;u++){var p=h[u];if(p.type==Type.CodeText)addCodeText(s,p.from,p.to);else s.push(p)}o=[]}addCodeText(s,e.lineStart-1,e.lineStart);for(var c=0,d=t.markers;c<d.length;c++){var p=d[c];s.push(p)}a=e.lineStart+t.text.length;var m=e.lineStart+t.findColumn(t.baseIndent+4);if(m<a)addCodeText(s,m,a)}}if(o.length){o=o.filter((function(e){return e.type!=Type.CodeText}));if(o.length)t.markers=o.concat(t.markers)}e.addNode(e.buffer.writeElements(s,-i).finish(Type.CodeBlock,a-i),i);return true},FencedCode:function(e,t){var r=isFencedCode(t);if(r<0)return false;var n=e.lineStart+t.pos,i=t.next,a=r-t.pos;var s=t.skipSpace(r),o=skipSpaceBack(t.text,t.text.length,s);var l=[elt(Type.CodeMark,n,n+a)];if(s<o)l.push(elt(Type.CodeInfo,e.lineStart+s,e.lineStart+o));for(var f=true;e.nextLine()&&t.depth>=e.stack.length;f=false){var p=t.pos;if(t.indent-t.baseIndent<4)while(p<t.text.length&&t.text.charCodeAt(p)==i)p++;if(p-t.pos>=a&&t.skipSpace(p)==t.text.length){for(var u=0,h=t.markers;u<h.length;u++){var c=h[u];l.push(c)}l.push(elt(Type.CodeMark,e.lineStart+t.pos,e.lineStart+p));e.nextLine();break}else{if(!f)addCodeText(l,e.lineStart-1,e.lineStart);for(var d=0,m=t.markers;d<m.length;d++){var c=m[d];l.push(c)}var g=e.lineStart+t.basePos,v=e.lineStart+t.text.length;if(g<v)addCodeText(l,g,v)}}e.addNode(e.buffer.writeElements(l,-n).finish(Type.FencedCode,e.prevLineEnd()-n),n);return true},Blockquote:function(e,t){var r=isBlockquote(t);if(r<0)return false;e.startContext(Type.Blockquote,t.pos);e.addNode(Type.QuoteMark,e.lineStart+t.pos,e.lineStart+t.pos+1);t.moveBase(t.pos+r);return null},HorizontalRule:function(e,t){if(isHorizontalRule(t,e,false)<0)return false;var r=e.lineStart+t.pos;e.nextLine();e.addNode(Type.HorizontalRule,r);return true},BulletList:function(e,t){var r=isBulletList(t,e,false);if(r<0)return false;if(e.block.type!=Type.BulletList)e.startContext(Type.BulletList,t.basePos,t.next);var n=getListIndent(t,t.pos+1);e.startContext(Type.ListItem,t.basePos,n-t.baseIndent);e.addNode(Type.ListMark,e.lineStart+t.pos,e.lineStart+t.pos+r);t.moveBaseColumn(n);return null},OrderedList:function(e,t){var r=isOrderedList(t,e,false);if(r<0)return false;if(e.block.type!=Type.OrderedList)e.startContext(Type.OrderedList,t.basePos,t.text.charCodeAt(t.pos+r-1));var n=getListIndent(t,t.pos+r);e.startContext(Type.ListItem,t.basePos,n-t.baseIndent);e.addNode(Type.ListMark,e.lineStart+t.pos,e.lineStart+t.pos+r);t.moveBaseColumn(n);return null},ATXHeading:function(e,t){var r=isAtxHeading(t);if(r<0)return false;var n=t.pos,i=e.lineStart+n;var a=skipSpaceBack(t.text,t.text.length,n),s=a;while(s>n&&t.text.charCodeAt(s-1)==t.next)s--;if(s==a||s==n||!space(t.text.charCodeAt(s-1)))s=t.text.length;var o=e.buffer.write(Type.HeaderMark,0,r).writeElements(e.parser.parseInline(t.text.slice(n+r+1,s),i+r+1),-i);if(s<t.text.length)o.write(Type.HeaderMark,s-n,a-n);var l=o.finish(Type.ATXHeading1-1+r,t.text.length-n);e.nextLine();e.addNode(l,i);return true},HTMLBlock:function(e,t){var r=isHTMLBlock(t,e,false);if(r<0)return false;var n=e.lineStart+t.pos,i=HTMLBlockStyle[r][1];var a=[],s=i!=EmptyLine;while(!i.test(t.text)&&e.nextLine()){if(t.depth<e.stack.length){s=false;break}for(var o=0,l=t.markers;o<l.length;o++){var f=l[o];a.push(f)}}if(s)e.nextLine();var p=i==CommentEnd?Type.CommentBlock:i==ProcessingEnd?Type.ProcessingInstructionBlock:Type.HTMLBlock;var u=e.prevLineEnd();e.addNode(e.buffer.writeElements(a,-n).finish(p,u-n),n);return true},SetextHeading:undefined};var LinkReferenceParser=function(){function e(e){this.stage=0;this.elts=[];this.pos=0;this.start=e.start;this.advance(e.content)}e.prototype.nextLine=function(e,t,r){if(this.stage==-1)return false;var n=r.content+"\n"+t.scrub();var i=this.advance(n);if(i>-1&&i<n.length)return this.complete(e,r,i);return false};e.prototype.finish=function(e,t){if((this.stage==2||this.stage==3)&&skipSpace(t.content,this.pos)==t.content.length)return this.complete(e,t,t.content.length);return false};e.prototype.complete=function(e,t,r){e.addLeafElement(t,elt(Type.LinkReference,this.start,this.start+r,this.elts));return true};e.prototype.nextStage=function(e){if(e){this.pos=e.to-this.start;this.elts.push(e);this.stage++;return true}if(e===false)this.stage=-1;return false};e.prototype.advance=function(e){for(;;){if(this.stage==-1){return-1}else if(this.stage==0){if(!this.nextStage(parseLinkLabel(e,this.pos,this.start,true)))return-1;if(e.charCodeAt(this.pos)!=58)return this.stage=-1;this.elts.push(elt(Type.LinkMark,this.pos+this.start,this.pos+this.start+1));this.pos++}else if(this.stage==1){if(!this.nextStage(parseURL(e,skipSpace(e,this.pos),this.start)))return-1}else if(this.stage==2){var t=skipSpace(e,this.pos),r=0;if(t>this.pos){var n=parseLinkTitle(e,t,this.start);if(n){var i=lineEnd(e,n.to-this.start);if(i>0){this.nextStage(n);r=i}}}if(!r)r=lineEnd(e,this.pos);return r>0&&r<e.length?r:-1}else{return lineEnd(e,this.pos)}}};return e}();function lineEnd(e,t){for(;t<e.length;t++){var r=e.charCodeAt(t);if(r==10)break;if(!space(r))return-1}return t}var SetextHeadingParser=function(){function e(){}e.prototype.nextLine=function(e,t,r){var n=t.depth<e.stack.length?-1:isSetextUnderline(t);var i=t.next;if(n<0)return false;var a=elt(Type.HeaderMark,e.lineStart+t.pos,e.lineStart+n);e.nextLine();e.addLeafElement(r,elt(i==61?Type.SetextHeading1:Type.SetextHeading2,r.start,e.prevLineEnd(),__spreadArray(__spreadArray([],e.parser.parseInline(r.content,r.start),true),[a],false)));return true};e.prototype.finish=function(){return false};return e}();var DefaultLeafBlocks={LinkReference:function(e,t){return t.content.charCodeAt(0)==91?new LinkReferenceParser(t):null},SetextHeading:function(){return new SetextHeadingParser}};var DefaultEndLeaf=[function(e,t){return isAtxHeading(t)>=0},function(e,t){return isFencedCode(t)>=0},function(e,t){return isBlockquote(t)>=0},function(e,t){return isBulletList(t,e,true)>=0},function(e,t){return isOrderedList(t,e,true)>=0},function(e,t){return isHorizontalRule(t,e,true)>=0},function(e,t){return isHTMLBlock(t,e,true)>=0}];var scanLineResult={text:"",end:0};var BlockContext=function(){function e(e,t,r,n){this.parser=e;this.input=t;this.ranges=n;this.line=new Line;this.atEnd=false;this.dontInject=new Set;this.stoppedAt=null;this.rangeI=0;this.to=n[n.length-1].to;this.lineStart=this.absoluteLineStart=this.absoluteLineEnd=n[0].from;this.block=CompositeBlock.create(Type.Document,0,this.lineStart,0,0);this.stack=[this.block];this.fragments=r.length?new FragmentCursor(r,t):null;this.readLine()}Object.defineProperty(e.prototype,"parsedPos",{get:function(){return this.absoluteLineStart},enumerable:false,configurable:true});e.prototype.advance=function(){if(this.stoppedAt!=null&&this.absoluteLineStart>this.stoppedAt)return this.finish();var e=this.line;for(;;){while(e.depth<this.stack.length)this.finishContext();for(var t=0,r=e.markers;t<r.length;t++){var n=r[t];this.addNode(n.type,n.from,n.to)}if(e.pos<e.text.length)break;if(!this.nextLine())return this.finish()}if(this.fragments&&this.reuseFragment(e.basePos))return null;e:for(;;){for(var i=0,a=this.parser.blockParsers;i<a.length;i++){var s=a[i];if(s){var o=s(this,e);if(o!=false){if(o==true)return null;e.forward();continue e}}}break}var l=new LeafBlock(this.lineStart+e.pos,e.text.slice(e.pos));for(var f=0,p=this.parser.leafBlockParsers;f<p.length;f++){var u=p[f];if(u){var h=u(this,l);if(h)l.parsers.push(h)}}e:while(this.nextLine()){if(e.pos==e.text.length)break;if(e.indent<e.baseIndent+4){for(var c=0,d=this.parser.endLeafBlock;c<d.length;c++){var m=d[c];if(m(this,e,l))break e}}for(var g=0,v=l.parsers;g<v.length;g++){var k=v[g];if(k.nextLine(this,e,l))return null}l.content+="\n"+e.scrub();for(var y=0,x=e.markers;y<x.length;y++){var L=x[y];l.marks.push(L)}}this.finishLeaf(l);return null};e.prototype.stopAt=function(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e};e.prototype.reuseFragment=function(e){if(!this.fragments.moveTo(this.absoluteLineStart+e,this.absoluteLineStart)||!this.fragments.matches(this.block.hash))return false;var t=this.fragments.takeNodes(this);if(!t)return false;var r=t,n=this.absoluteLineStart+t;for(var i=1;i<this.ranges.length;i++){var a=this.ranges[i-1].to,s=this.ranges[i].from;if(a>=this.lineStart&&s<n)r-=s-a}this.lineStart+=r;this.absoluteLineStart+=t;this.moveRangeI();if(this.absoluteLineStart<this.to){this.lineStart++;this.absoluteLineStart++;this.readLine()}else{this.atEnd=true;this.readLine()}return true};Object.defineProperty(e.prototype,"depth",{get:function(){return this.stack.length},enumerable:false,configurable:true});e.prototype.parentType=function(e){if(e===void 0){e=this.depth-1}return this.parser.nodeSet.types[this.stack[e].type]};e.prototype.nextLine=function(){this.lineStart+=this.line.text.length;if(this.absoluteLineEnd>=this.to){this.absoluteLineStart=this.absoluteLineEnd;this.atEnd=true;this.readLine();return false}else{this.lineStart++;this.absoluteLineStart=this.absoluteLineEnd+1;this.moveRangeI();this.readLine();return true}};e.prototype.moveRangeI=function(){while(this.rangeI<this.ranges.length-1&&this.absoluteLineStart>=this.ranges[this.rangeI].to)this.rangeI++};e.prototype.scanLine=function(e){var t=scanLineResult;t.end=e;if(e>=this.to){t.text=""}else{t.text=this.lineChunkAt(t.end);t.end+=t.text.length;if(this.ranges.length>1){var r=this.absoluteLineStart,n=this.rangeI;while(this.ranges[n].to<t.end){n++;var i=this.ranges[n].from;var a=this.lineChunkAt(i);t.end=i+a.length;t.text=t.text.slice(0,this.ranges[n-1].to-r)+a;r=t.end-t.text.length}}}return t};e.prototype.readLine=function(){var e=this.line,t=this.scanLine(this.absoluteLineStart),r=t.text,n=t.end;this.absoluteLineEnd=n;e.reset(r);for(;e.depth<this.stack.length;e.depth++){var i=this.stack[e.depth],a=this.parser.skipContextMarkup[i.type];if(!a)throw new Error("Unhandled block context "+Type[i.type]);if(!a(i,this,e))break;e.forward()}};e.prototype.lineChunkAt=function(e){var t=this.input.chunk(e),r;if(!this.input.lineChunks){var n=t.indexOf("\n");r=n<0?t:t.slice(0,n)}else{r=t=="\n"?"":t}return e+r.length>this.to?r.slice(0,this.to-e):r};e.prototype.prevLineEnd=function(){return this.atEnd?this.lineStart:this.lineStart-1};e.prototype.startContext=function(e,t,r){if(r===void 0){r=0}this.block=CompositeBlock.create(e,r,this.lineStart+t,this.block.hash,this.lineStart+this.line.text.length);this.stack.push(this.block)};e.prototype.startComposite=function(e,t,r){if(r===void 0){r=0}this.startContext(this.parser.getNodeType(e),t,r)};e.prototype.addNode=function(e,t,r){if(typeof e=="number")e=new Tree(this.parser.nodeSet.types[e],none,none,(r!==null&&r!==void 0?r:this.prevLineEnd())-t);this.block.addChild(e,t-this.block.from)};e.prototype.addElement=function(e){this.block.addChild(e.toTree(this.parser.nodeSet),e.from-this.block.from)};e.prototype.addLeafElement=function(e,t){this.addNode(this.buffer.writeElements(injectMarks(t.children,e.marks),-t.from).finish(t.type,t.to-t.from),t.from)};e.prototype.finishContext=function(){var e=this.stack.pop();var t=this.stack[this.stack.length-1];t.addChild(e.toTree(this.parser.nodeSet),e.from-t.from);this.block=t};e.prototype.finish=function(){while(this.stack.length>1)this.finishContext();return this.addGaps(this.block.toTree(this.parser.nodeSet,this.lineStart))};e.prototype.addGaps=function(e){return this.ranges.length>1?injectGaps(this.ranges,0,e.topNode,this.ranges[0].from,this.dontInject):e};e.prototype.finishLeaf=function(e){for(var t=0,r=e.parsers;t<r.length;t++){var n=r[t];if(n.finish(this,e))return}var i=injectMarks(this.parser.parseInline(e.content,e.start),e.marks);this.addNode(this.buffer.writeElements(i,-e.start).finish(Type.Paragraph,e.content.length),e.start)};e.prototype.elt=function(e,t,r,n){if(typeof e=="string")return elt(this.parser.getNodeType(e),t,r,n);return new TreeElement(e,t)};Object.defineProperty(e.prototype,"buffer",{get:function(){return new Buffer(this.parser.nodeSet)},enumerable:false,configurable:true});return e}();function injectGaps(e,t,r,n,i){if(i.has(r.tree))return r.tree;var a=e[t].to;var s=[],o=[],l=r.from+n;function f(r,i){while(i?r>=a:r>a){var s=e[t+1].from-a;n+=s;r+=s;t++;a=e[t].to}}for(var p=r.firstChild;p;p=p.nextSibling){f(p.from+n,true);var u=p.from+n,h=void 0;if(p.to+n>a){h=injectGaps(e,t,p,n,i);f(p.to+n,false)}else{h=p.toTree()}s.push(h);o.push(u-l)}f(r.to+n,false);return new Tree(r.type,s,o,r.to+n-l,r.tree?r.tree.propValues:undefined)}var MarkdownParser=function(e){__extends(t,e);function t(t,r,n,i,a,s,o,l,f){var p=e.call(this)||this;p.nodeSet=t;p.blockParsers=r;p.leafBlockParsers=n;p.blockNames=i;p.endLeafBlock=a;p.skipContextMarkup=s;p.inlineParsers=o;p.inlineNames=l;p.wrappers=f;p.nodeTypes=Object.create(null);for(var u=0,h=t.types;u<h.length;u++){var c=h[u];p.nodeTypes[c.name]=c.id}return p}t.prototype.createParse=function(e,t,r){var n=new BlockContext(this,e,t,r);for(var i=0,a=this.wrappers;i<a.length;i++){var s=a[i];n=s(n,e,t,r)}return n};t.prototype.configure=function(e){var r=resolveConfig(e);if(!r)return this;var n=this,i=n.nodeSet,a=n.skipContextMarkup;var s=this.blockParsers.slice(),o=this.leafBlockParsers.slice(),l=this.blockNames.slice(),f=this.inlineParsers.slice(),p=this.inlineNames.slice(),u=this.endLeafBlock.slice(),h=this.wrappers;if(nonEmpty(r.defineNodes)){a=Object.assign({},a);var c=i.types.slice();var d=function(e){var t=typeof e=="string"?{name:e}:e,r=t.name,n=t.block,i=t.composite;if(c.some((function(e){return e.name==r})))return"continue";if(i)a[c.length]=function(e,t,r){return i(t,r,e.value)};var s=c.length;var o=i?["Block","BlockContext"]:!n?undefined:s>=Type.ATXHeading1&&s<=Type.SetextHeading2?["Block","LeafBlock","Heading"]:["Block","LeafBlock"];c.push(NodeType.define({id:s,name:r,props:o&&[[NodeProp.group,o]]}))};for(var m=0,g=r.defineNodes;m<g.length;m++){var v=g[m];d(v)}i=new NodeSet(c)}if(nonEmpty(r.props))i=i.extend.apply(i,r.props);if(nonEmpty(r.remove)){for(var k=0,y=r.remove;k<y.length;k++){var x=y[k];var L=this.blockNames.indexOf(x),T=this.inlineNames.indexOf(x);if(L>-1)s[L]=o[L]=undefined;if(T>-1)f[T]=undefined}}if(nonEmpty(r.parseBlock)){for(var b=0,S=r.parseBlock;b<S.length;b++){var C=S[b];var w=l.indexOf(C.name);if(w>-1){s[w]=C.parse;o[w]=C.leaf}else{var E=C.before?findName(l,C.before):C.after?findName(l,C.after)+1:l.length-1;s.splice(E,0,C.parse);o.splice(E,0,C.leaf);l.splice(E,0,C.name)}if(C.endLeaf)u.push(C.endLeaf)}}if(nonEmpty(r.parseInline)){for(var B=0,I=r.parseInline;B<I.length;B++){var A=I[B];var w=p.indexOf(A.name);if(w>-1){f[w]=A.parse}else{var E=A.before?findName(p,A.before):A.after?findName(p,A.after)+1:p.length-1;f.splice(E,0,A.parse);p.splice(E,0,A.name)}}}if(r.wrap)h=h.concat(r.wrap);return new t(i,s,o,l,u,a,f,p,h)};t.prototype.getNodeType=function(e){var t=this.nodeTypes[e];if(t==null)throw new RangeError("Unknown node type '".concat(e,"'"));return t};t.prototype.parseInline=function(e,t){var r=new InlineContext(this,e,t);e:for(var n=t;n<r.end;){var i=r.char(n);for(var a=0,s=this.inlineParsers;a<s.length;a++){var o=s[a];if(o){var l=o(r,i,n);if(l>=0){n=l;continue e}}}n++}return r.resolveMarkers(0)};return t}(Parser);function nonEmpty(e){return e!=null&&e.length>0}function resolveConfig(e){if(!Array.isArray(e))return e;if(e.length==0)return null;var t=resolveConfig(e[0]);if(e.length==1)return t;var r=resolveConfig(e.slice(1));if(!r||!t)return t||r;var n=function(e,t){return(e||none).concat(t||none)};var i=t.wrap,a=r.wrap;return{props:n(t.props,r.props),defineNodes:n(t.defineNodes,r.defineNodes),parseBlock:n(t.parseBlock,r.parseBlock),parseInline:n(t.parseInline,r.parseInline),remove:n(t.remove,r.remove),wrap:!i?a:!a?i:function(e,t,r,n){return i(a(e,t,r,n),t,r,n)}}}function findName(e,t){var r=e.indexOf(t);if(r<0)throw new RangeError("Position specified relative to unknown parser ".concat(t));return r}var nodeTypes=[NodeType.none];for(var i=1,name=void 0;name=Type[i];i++){nodeTypes[i]=NodeType.define({id:i,name:name,props:i>=Type.Escape?[]:[[NodeProp.group,i in DefaultSkipMarkup?["Block","BlockContext"]:["Block","LeafBlock"]]]})}var none=[];var Buffer=function(){function e(e){this.nodeSet=e;this.content=[];this.nodes=[]}e.prototype.write=function(e,t,r,n){if(n===void 0){n=0}this.content.push(e,t,r,4+n*4);return this};e.prototype.writeElements=function(e,t){if(t===void 0){t=0}for(var r=0,n=e;r<n.length;r++){var i=n[r];i.writeTo(this,t)}return this};e.prototype.finish=function(e,t){return Tree.build({buffer:this.content,nodeSet:this.nodeSet,reused:this.nodes,topID:e,length:t})};return e}();var Element=function(){function e(e,t,r,n){if(n===void 0){n=none}this.type=e;this.from=t;this.to=r;this.children=n}e.prototype.writeTo=function(e,t){var r=e.content.length;e.writeElements(this.children,t);e.content.push(this.type,this.from+t,this.to+t,e.content.length+4-r)};e.prototype.toTree=function(e){return new Buffer(e).writeElements(this.children,-this.from).finish(this.type,this.to-this.from)};return e}();var TreeElement=function(){function e(e,t){this.tree=e;this.from=t}Object.defineProperty(e.prototype,"to",{get:function(){return this.from+this.tree.length},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"type",{get:function(){return this.tree.type.id},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"children",{get:function(){return none},enumerable:false,configurable:true});e.prototype.writeTo=function(e,t){e.nodes.push(this.tree);e.content.push(e.nodes.length-1,this.from+t,this.to+t,-1)};e.prototype.toTree=function(){return this.tree};return e}();function elt(e,t,r,n){return new Element(e,t,r,n)}var EmphasisUnderscore={resolve:"Emphasis",mark:"EmphasisMark"};var EmphasisAsterisk={resolve:"Emphasis",mark:"EmphasisMark"};var LinkStart={},ImageStart={};var InlineDelimiter=function(){function e(e,t,r,n){this.type=e;this.from=t;this.to=r;this.side=n}return e}();var Escapable="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";var Punctuation=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\u2010-\u2027]/;try{Punctuation=new RegExp("[\\p{Pc}|\\p{Pd}|\\p{Pe}|\\p{Pf}|\\p{Pi}|\\p{Po}|\\p{Ps}]","u")}catch(_){}var DefaultInline={Escape:function(e,t,r){if(t!=92||r==e.end-1)return-1;var n=e.char(r+1);for(var i=0;i<Escapable.length;i++)if(Escapable.charCodeAt(i)==n)return e.append(elt(Type.Escape,r,r+2));return-1},Entity:function(e,t,r){if(t!=38)return-1;var n=/^(?:#\d+|#x[a-f\d]+|\w+);/i.exec(e.slice(r+1,r+31));return n?e.append(elt(Type.Entity,r,r+1+n[0].length)):-1},InlineCode:function(e,t,r){if(t!=96||r&&e.char(r-1)==96)return-1;var n=r+1;while(n<e.end&&e.char(n)==96)n++;var i=n-r,a=0;for(;n<e.end;n++){if(e.char(n)==96){a++;if(a==i&&e.char(n+1)!=96)return e.append(elt(Type.InlineCode,r,n+1,[elt(Type.CodeMark,r,r+i),elt(Type.CodeMark,n+1-i,n+1)]))}else{a=0}}return-1},HTMLTag:function(e,t,r){if(t!=60||r==e.end-1)return-1;var n=e.slice(r+1,e.end);var i=/^(?:[a-z][-\w+.]+:[^\s>]+|[a-z\d.!#$%&'*+/=?^_`{|}~-]+@[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?(?:\.[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?)*)>/i.exec(n);if(i)return e.append(elt(Type.URL,r,r+1+i[0].length));var a=/^!--[^>](?:-[^-]|[^-])*?-->/i.exec(n);if(a)return e.append(elt(Type.Comment,r,r+1+a[0].length));var s=/^\?[^]*?\?>/.exec(n);if(s)return e.append(elt(Type.ProcessingInstruction,r,r+1+s[0].length));var o=/^(?:![A-Z][^]*?>|!\[CDATA\[[^]*?\]\]>|\/\s*[a-zA-Z][\w-]*\s*>|\s*[a-zA-Z][\w-]*(\s+[a-zA-Z:_][\w-.:]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*(\/\s*)?>)/.exec(n);if(!o)return-1;return e.append(elt(Type.HTMLTag,r,r+1+o[0].length))},Emphasis:function(e,t,r){if(t!=95&&t!=42)return-1;var n=r+1;while(e.char(n)==t)n++;var i=e.slice(r-1,r),a=e.slice(n,n+1);var s=Punctuation.test(i),o=Punctuation.test(a);var l=/\s|^$/.test(i),f=/\s|^$/.test(a);var p=!f&&(!o||l||s);var u=!l&&(!s||f||o);var h=p&&(t==42||!u||s);var c=u&&(t==42||!p||o);return e.append(new InlineDelimiter(t==95?EmphasisUnderscore:EmphasisAsterisk,r,n,(h?1:0)|(c?2:0)))},HardBreak:function(e,t,r){if(t==92&&e.char(r+1)==10)return e.append(elt(Type.HardBreak,r,r+2));if(t==32){var n=r+1;while(e.char(n)==32)n++;if(e.char(n)==10&&n>=r+2)return e.append(elt(Type.HardBreak,r,n+1))}return-1},Link:function(e,t,r){return t==91?e.append(new InlineDelimiter(LinkStart,r,r+1,1)):-1},Image:function(e,t,r){return t==33&&e.char(r+1)==91?e.append(new InlineDelimiter(ImageStart,r,r+2,1)):-1},LinkEnd:function(e,t,r){if(t!=93)return-1;for(var n=e.parts.length-1;n>=0;n--){var i=e.parts[n];if(i instanceof InlineDelimiter&&(i.type==LinkStart||i.type==ImageStart)){if(!i.side||e.skipSpace(i.to)==r&&!/[(\[]/.test(e.slice(r+1,r+2))){e.parts[n]=null;return-1}var a=e.takeContent(n);var s=e.parts[n]=finishLink(e,a,i.type==LinkStart?Type.Link:Type.Image,i.from,r+1);if(i.type==LinkStart)for(var o=0;o<n;o++){var l=e.parts[o];if(l instanceof InlineDelimiter&&l.type==LinkStart)l.side=0}return s.to}}return-1}};function finishLink(e,t,r,n,i){var a=e.text,s=e.char(i),o=i;t.unshift(elt(Type.LinkMark,n,n+(r==Type.Image?2:1)));t.push(elt(Type.LinkMark,i-1,i));if(s==40){var l=e.skipSpace(i+1);var f=parseURL(a,l-e.offset,e.offset),p=void 0;if(f){l=e.skipSpace(f.to);p=parseLinkTitle(a,l-e.offset,e.offset);if(p)l=e.skipSpace(p.to)}if(e.char(l)==41){t.push(elt(Type.LinkMark,i,i+1));o=l+1;if(f)t.push(f);if(p)t.push(p);t.push(elt(Type.LinkMark,l,o))}}else if(s==91){var u=parseLinkLabel(a,i-e.offset,e.offset,false);if(u){t.push(u);o=u.to}}return elt(r,n,o,t)}function parseURL(e,t,r){var n=e.charCodeAt(t);if(n==60){for(var i=t+1;i<e.length;i++){var a=e.charCodeAt(i);if(a==62)return elt(Type.URL,t+r,i+1+r);if(a==60||a==10)return false}return null}else{var s=0,i=t;for(var o=false;i<e.length;i++){var a=e.charCodeAt(i);if(space(a)){break}else if(o){o=false}else if(a==40){s++}else if(a==41){if(!s)break;s--}else if(a==92){o=true}}return i>t?elt(Type.URL,t+r,i+r):i==e.length?null:false}}function parseLinkTitle(e,t,r){var n=e.charCodeAt(t);if(n!=39&&n!=34&&n!=40)return false;var i=n==40?41:n;for(var a=t+1,s=false;a<e.length;a++){var o=e.charCodeAt(a);if(s)s=false;else if(o==i)return elt(Type.LinkTitle,t+r,a+1+r);else if(o==92)s=true}return null}function parseLinkLabel(e,t,r,n){for(var i=false,a=t+1,s=Math.min(e.length,a+999);a<s;a++){var o=e.charCodeAt(a);if(i)i=false;else if(o==93)return n?false:elt(Type.LinkLabel,t+r,a+1+r);else{if(n&&!space(o))n=false;if(o==91)return false;else if(o==92)i=true}}return null}var InlineContext=function(){function e(e,t,r){this.parser=e;this.text=t;this.offset=r;this.parts=[]}e.prototype.char=function(e){return e>=this.end?-1:this.text.charCodeAt(e-this.offset)};Object.defineProperty(e.prototype,"end",{get:function(){return this.offset+this.text.length},enumerable:false,configurable:true});e.prototype.slice=function(e,t){return this.text.slice(e-this.offset,t-this.offset)};e.prototype.append=function(e){this.parts.push(e);return e.to};e.prototype.addDelimiter=function(e,t,r,n,i){return this.append(new InlineDelimiter(e,t,r,(n?1:0)|(i?2:0)))};e.prototype.addElement=function(e){return this.append(e)};e.prototype.resolveMarkers=function(e){for(var t=e;t<this.parts.length;t++){var r=this.parts[t];if(!(r instanceof InlineDelimiter&&r.type.resolve&&r.side&2))continue;var n=r.type==EmphasisUnderscore||r.type==EmphasisAsterisk;var i=r.to-r.from;var a=void 0,s=t-1;for(;s>=e;s--){var o=this.parts[s];if(!(o instanceof InlineDelimiter&&o.side&1&&o.type==r.type)||n&&(r.side&1||o.side&2)&&(o.to-o.from+i)%3==0&&((o.to-o.from)%3||i%3))continue;a=o;break}if(!a)continue;var l=r.type.resolve,f=[];var p=a.from,u=r.to;if(n){var h=Math.min(2,a.to-a.from,i);p=a.to-h;u=r.from+h;l=h==1?"Emphasis":"StrongEmphasis"}if(a.type.mark)f.push(this.elt(a.type.mark,p,a.to));for(var c=s+1;c<t;c++){if(this.parts[c]instanceof Element)f.push(this.parts[c]);this.parts[c]=null}if(r.type.mark)f.push(this.elt(r.type.mark,r.from,u));var d=this.elt(l,p,u,f);this.parts[s]=n&&a.from!=p?new InlineDelimiter(a.type,a.from,p,a.side):null;var m=this.parts[t]=n&&r.to!=u?new InlineDelimiter(r.type,u,r.to,r.side):null;if(m)this.parts.splice(t,0,d);else this.parts[t]=d}var g=[];for(var t=e;t<this.parts.length;t++){var o=this.parts[t];if(o instanceof Element)g.push(o)}return g};e.prototype.findOpeningDelimiter=function(e){for(var t=this.parts.length-1;t>=0;t--){var r=this.parts[t];if(r instanceof InlineDelimiter&&r.type==e)return t}return null};e.prototype.takeContent=function(e){var t=this.resolveMarkers(e);this.parts.length=e;return t};e.prototype.skipSpace=function(e){return skipSpace(this.text,e-this.offset)+this.offset};e.prototype.elt=function(e,t,r,n){if(typeof e=="string")return elt(this.parser.getNodeType(e),t,r,n);return new TreeElement(e,t)};return e}();function injectMarks(e,t){if(!t.length)return e;if(!e.length)return t;var r=e.slice(),n=0;for(var i=0,a=t;i<a.length;i++){var s=a[i];while(n<r.length&&r[n].to<s.to)n++;if(n<r.length&&r[n].from<s.from){var o=r[n];if(o instanceof Element)r[n]=new Element(o.type,o.from,o.to,injectMarks(o.children,[s]))}else{r.splice(n++,0,s)}}return r}var NotLast=[Type.CodeBlock,Type.ListItem,Type.OrderedList,Type.BulletList];var FragmentCursor=function(){function e(e,t){this.fragments=e;this.input=t;this.i=0;this.fragment=null;this.fragmentEnd=-1;this.cursor=null;if(e.length)this.fragment=e[this.i++]}e.prototype.nextFragment=function(){this.fragment=this.i<this.fragments.length?this.fragments[this.i++]:null;this.cursor=null;this.fragmentEnd=-1};e.prototype.moveTo=function(e,t){while(this.fragment&&this.fragment.to<=e)this.nextFragment();if(!this.fragment||this.fragment.from>(e?e-1:0))return false;if(this.fragmentEnd<0){var r=this.fragment.to;while(r>0&&this.input.read(r-1,r)!="\n")r--;this.fragmentEnd=r?r-1:0}var n=this.cursor;if(!n){n=this.cursor=this.fragment.tree.cursor();n.firstChild()}var i=e+this.fragment.offset;while(n.to<=i)if(!n.parent())return false;for(;;){if(n.from>=i)return this.fragment.from<=t;if(!n.childAfter(i))return false}};e.prototype.matches=function(e){var t=this.cursor.tree;return t&&t.prop(NodeProp.contextHash)==e};e.prototype.takeNodes=function(e){var t=this.cursor,r=this.fragment.offset,n=this.fragmentEnd-(this.fragment.openEnd?1:0);var i=e.absoluteLineStart,a=i,s=e.block.children.length;var o=a,l=s;for(;;){if(t.to-r>n){if(t.type.isAnonymous&&t.firstChild())continue;break}e.dontInject.add(t.tree);e.addNode(t.tree,t.from-r);if(t.type.is("Block")){if(NotLast.indexOf(t.type.id)<0){a=t.to-r;s=e.block.children.length}else{a=o;s=l;o=t.to-r;l=e.block.children.length}}if(!t.nextSibling())break}while(e.block.children.length>s){e.block.children.pop();e.block.positions.pop()}return a-i};return e}();var parser=new MarkdownParser(new NodeSet(nodeTypes),Object.keys(DefaultBlockParsers).map((function(e){return DefaultBlockParsers[e]})),Object.keys(DefaultBlockParsers).map((function(e){return DefaultLeafBlocks[e]})),Object.keys(DefaultBlockParsers),DefaultEndLeaf,DefaultSkipMarkup,Object.keys(DefaultInline).map((function(e){return DefaultInline[e]})),Object.keys(DefaultInline),[]);function leftOverSpace(e,t,r){var n=[];for(var i=e.firstChild,a=t;;i=i.nextSibling){var s=i?i.from:r;if(s>a)n.push({from:a,to:s});if(!i)break;a=i.to}return n}function parseCode(e){var t=e.codeParser,r=e.htmlParser;var n=parseMixed((function(e,n){var i=e.type.id;if(t&&(i==Type.CodeBlock||i==Type.FencedCode)){var a="";if(i==Type.FencedCode){var s=e.node.getChild(Type.CodeInfo);if(s)a=n.read(s.from,s.to)}var o=t(a);if(o)return{parser:o,overlay:function(e){return e.type.id==Type.CodeText}}}else if(r&&(i==Type.HTMLBlock||i==Type.HTMLTag)){return{parser:r,overlay:leftOverSpace(e.node,e.from,e.to)}}return null}));return{wrap:n}}var StrikethroughDelim={resolve:"Strikethrough",mark:"StrikethroughMark"};var Strikethrough={defineNodes:["Strikethrough","StrikethroughMark"],parseInline:[{name:"Strikethrough",parse:function(e,t,r){if(t!=126||e.char(r+1)!=126)return-1;return e.addDelimiter(StrikethroughDelim,r,r+2,true,true)},after:"Emphasis"}]};function parseRow(e,t,r,n,i){if(r===void 0){r=0}if(i===void 0){i=0}var a=0,s=true,o=-1,l=-1,f=false;var p=function(){n.push(e.elt("TableCell",i+o,i+l,e.parser.parseInline(t.slice(o,l),i+o)))};for(var u=r;u<t.length;u++){var h=t.charCodeAt(u);if(h==124&&!f){if(!s||o>-1)a++;s=false;if(n){if(o>-1)p();n.push(e.elt("TableDelimiter",u+i,u+i+1))}o=l=-1}else if(f||h!=32&&h!=9){if(o<0)o=u;l=u+1}f=!f&&h==92}if(o>-1){a++;if(n)p()}return a}function hasPipe(e,t){for(var r=t;r<e.length;r++){var n=e.charCodeAt(r);if(n==124)return true;if(n==92)r++}return false}var delimiterLine=/^\|?(\s*:?-+:?\s*\|)+(\s*:?-+:?\s*)?$/;var TableParser=function(){function e(){this.rows=null}e.prototype.nextLine=function(e,t,r){if(this.rows==null){this.rows=false;var n=void 0;if((t.next==45||t.next==58||t.next==124)&&delimiterLine.test(n=t.text.slice(t.pos))){var i=[],a=parseRow(e,r.content,0,i,r.start);if(a==parseRow(e,n,t.pos))this.rows=[e.elt("TableHeader",r.start,r.start+r.content.length,i),e.elt("TableDelimiter",e.lineStart+t.pos,e.lineStart+t.text.length)]}}else if(this.rows){var s=[];parseRow(e,t.text,t.pos,s,e.lineStart);this.rows.push(e.elt("TableRow",e.lineStart+t.pos,e.lineStart+t.text.length,s))}return false};e.prototype.finish=function(e,t){if(!this.rows)return false;e.addLeafElement(t,e.elt("Table",t.start,t.start+t.content.length,this.rows));return true};return e}();var Table={defineNodes:[{name:"Table",block:true},"TableHeader","TableRow","TableCell","TableDelimiter"],parseBlock:[{name:"Table",leaf:function(e,t){return hasPipe(t.content,0)?new TableParser:null},endLeaf:function(e,t,r){if(r.parsers.some((function(e){return e instanceof TableParser}))||!hasPipe(t.text,t.basePos))return false;var n=e.scanLine(e.absoluteLineEnd+1).text;return delimiterLine.test(n)&&parseRow(e,t.text,t.basePos)==parseRow(e,n,t.basePos)},before:"SetextHeading"}]};var TaskParser=function(){function e(){}e.prototype.nextLine=function(){return false};e.prototype.finish=function(e,t){e.addLeafElement(t,e.elt("Task",t.start,t.start+t.content.length,__spreadArray([e.elt("TaskMarker",t.start,t.start+3)],e.parser.parseInline(t.content.slice(3),t.start+3),true)));return true};return e}();var TaskList={defineNodes:[{name:"Task",block:true},"TaskMarker"],parseBlock:[{name:"TaskList",leaf:function(e,t){return/^\[[ xX]\]/.test(t.content)&&e.parentType().name=="ListItem"?new TaskParser:null},after:"SetextHeading"}]};var GFM=[Table,TaskList,Strikethrough];function parseSubSuper(e,t,r){return function(n,i,a){if(i!=e||n.char(a+1)==e)return-1;var s=[n.elt(r,a,a+1)];for(var o=a+1;o<n.end;o++){var l=n.char(o);if(l==e)return n.addElement(n.elt(t,a,o+1,s.concat(n.elt(r,o,o+1))));if(l==92)s.push(n.elt("Escape",o,o+++2));if(space(l))break}return-1}}var Superscript={defineNodes:["Superscript","SuperscriptMark"],parseInline:[{name:"Superscript",parse:parseSubSuper(94,"Superscript","SuperscriptMark")}]};var Subscript={defineNodes:["Subscript","SubscriptMark"],parseInline:[{name:"Subscript",parse:parseSubSuper(126,"Subscript","SubscriptMark")}]};var Emoji={defineNodes:["Emoji"],parseInline:[{name:"Emoji",parse:function(e,t,r){var n;if(t!=58||!(n=/^[a-zA-Z_0-9]+:/.exec(e.slice(r+1,e.end))))return-1;return e.addElement(e.elt("Emoji",r,r+1+n[0].length))}}]};var data=defineLanguageFacet({block:{open:"\x3c!--",close:"--\x3e"}});var commonmark=parser.configure({props:[styleTags({"Blockquote/...":tags.quote,HorizontalRule:tags.contentSeparator,"ATXHeading1/... SetextHeading1/...":tags.heading1,"ATXHeading2/... SetextHeading2/...":tags.heading2,"ATXHeading3/...":tags.heading3,"ATXHeading4/...":tags.heading4,"ATXHeading5/...":tags.heading5,"ATXHeading6/...":tags.heading6,"Comment CommentBlock":tags.comment,Escape:tags.escape,Entity:tags.character,"Emphasis/...":tags.emphasis,"StrongEmphasis/...":tags.strong,"Link/... Image/...":tags.link,"OrderedList/... BulletList/...":tags.list,"BlockQuote/...":tags.quote,"InlineCode CodeText":tags.monospace,URL:tags.url,"HeaderMark HardBreak QuoteMark ListMark LinkMark EmphasisMark CodeMark":tags.processingInstruction,"CodeInfo LinkLabel":tags.labelName,LinkTitle:tags.string,Paragraph:tags.content}),foldNodeProp.add((function(e){if(!e.is("Block")||e.is("Document"))return undefined;return function(e,t){return{from:t.doc.lineAt(e.from).to,to:e.to}}})),indentNodeProp.add({Document:function(){return null}}),languageDataProp.add({Document:data})]});function mkLang(e){return new Language(data,e,e.nodeSet.types.find((function(e){return e.name=="Document"})))}var commonmarkLanguage=mkLang(commonmark);var extended=commonmark.configure([GFM,Subscript,Superscript,Emoji,{props:[styleTags({"TableDelimiter SubscriptMark SuperscriptMark StrikethroughMark":tags.processingInstruction,"TableHeader/...":tags.heading,"Strikethrough/...":tags.strikethrough,TaskMarker:tags.atom,Task:tags.list,Emoji:tags.character,"Subscript Superscript":tags.special(tags.content),TableCell:tags.content})]}]);var markdownLanguage=mkLang(extended);function getCodeParser(e,t){return function(r){var n=r&&LanguageDescription.matchLanguageName(e,r,true);if(!n)return t?t.parser:null;if(n.support)return n.support.language.parser;return ParseContext.getSkippingParser(n.load())}}function nodeStart(e,t){return t.sliceString(e.from,e.from+50)}var Context=function(){function e(e,t,r,n,i,a,s){this.node=e;this.from=t;this.to=r;this.spaceBefore=n;this.spaceAfter=i;this.type=a;this.item=s}e.prototype.blank=function(e){if(e===void 0){e=true}var t=this.spaceBefore;if(this.node.name=="Blockquote")t+=">";else for(var r=this.to-this.from-t.length-this.spaceAfter.length;r>0;r--)t+=" ";return t+(e?this.spaceAfter:"")};e.prototype.marker=function(e,t){var r=this.node.name=="OrderedList"?String(+itemNumber(this.item,e)[2]+t):"";return this.spaceBefore+r+this.type+this.spaceAfter};return e}();function getContext(e,t,r){var n=[];for(var i=e;i&&i.name!="Document";i=i.parent){if(i.name=="ListItem"||i.name=="Blockquote")n.push(i)}var a=[],s=0;for(var o=n.length-1;o>=0;o--){var l=n[o],f=void 0,p=s;if(l.name=="Blockquote"&&(f=/^[ \t]*>( ?)/.exec(t.slice(s)))){s+=f[0].length;a.push(new Context(l,p,s,"",f[1],">",null))}else if(l.name=="ListItem"&&l.parent.name=="OrderedList"&&(f=/^([ \t]*)\d+([.)])([ \t]*)/.exec(nodeStart(l,r)))){var u=f[3],h=f[0].length;if(u.length>=4){u=u.slice(0,u.length-4);h-=4}s+=h;a.push(new Context(l.parent,p,s,f[1],u,f[2],l))}else if(l.name=="ListItem"&&l.parent.name=="BulletList"&&(f=/^([ \t]*)([-+*])([ \t]+)/.exec(nodeStart(l,r)))){var u=f[3],h=f[0].length;if(u.length>4){u=u.slice(0,u.length-4);h-=4}s+=h;a.push(new Context(l.parent,p,s,f[1],u,f[2],l))}}return a}function itemNumber(e,t){return/^(\s*)(\d+)(?=[.)])/.exec(t.sliceString(e.from,e.from+10))}function renumberList(e,t,r,n){if(n===void 0){n=0}for(var i=-1,a=e;;){if(a.name=="ListItem"){var s=itemNumber(a,t);var o=+s[2];if(i>=0){if(o!=i+1)return;r.push({from:a.from+s[1].length,to:a.from+s[0].length,insert:String(i+2+n)})}i=o}var l=a.nextSibling;if(!l)break;a=l}}var insertNewlineContinueMarkup=function(e){var t=e.state,r=e.dispatch;var n=syntaxTree(t),i=t.doc;var a=null,s=t.changeByRange((function(e){if(!e.empty||!markdownLanguage.isActiveAt(t,e.from))return a={range:e};var r=e.from,s=i.lineAt(r);var o=getContext(n.resolveInner(r,-1),s.text,i);while(o.length&&o[o.length-1].from>r-s.from)o.pop();if(!o.length)return a={range:e};var l=o[o.length-1];if(l.to-l.spaceAfter.length>r-s.from)return a={range:e};var f=r>=l.to-l.spaceAfter.length&&!/\S/.test(s.text.slice(l.to));if(l.item&&f){if(l.node.firstChild.to>=r||s.from>0&&!/[^\s>]/.test(i.lineAt(s.from-1).text)){var p=o.length>1?o[o.length-2]:null;var u=void 0,h="";if(p&&p.item){u=s.from+p.from;h=p.marker(i,1)}else{u=s.from+(p?p.to:0)}var c=[{from:u,to:r,insert:h}];if(l.node.name=="OrderedList")renumberList(l.item,i,c,-2);if(p&&p.node.name=="OrderedList")renumberList(p.item,i,c);return{range:EditorSelection.cursor(u+h.length),changes:c}}else{var d="";for(var m=0,g=o.length-2;m<=g;m++)d+=o[m].blank(m<g);d+=t.lineBreak;return{range:EditorSelection.cursor(r+d.length),changes:{from:s.from,insert:d}}}}if(l.node.name=="Blockquote"&&f&&s.from){var v=i.lineAt(s.from-1),k=/>\s*$/.exec(v.text);if(k&&k.index==l.from){var y=t.changes([{from:v.from+k.index,to:v.to},{from:s.from+l.from,to:s.to}]);return{range:e.map(y),changes:y}}}var x=[];if(l.node.name=="OrderedList")renumberList(l.item,i,x);var L=t.lineBreak;var T=l.item&&l.item.from<s.from;if(!T||/^[\s\d.)\-+*>]*/.exec(s.text)[0].length>=l.to){for(var m=0,g=o.length-1;m<=g;m++)L+=m==g&&!T?o[m].marker(i,1):o[m].blank()}var b=r;while(b>s.from&&/\s/.test(s.text.charAt(b-s.from-1)))b--;x.push({from:b,to:r,insert:L});return{range:EditorSelection.cursor(b+L.length),changes:x}}));if(a)return false;r(t.update(s,{scrollIntoView:true,userEvent:"input"}));return true};function isMark(e){return e.name=="QuoteMark"||e.name=="ListMark"}function contextNodeForDelete(e,t){var r=e.resolveInner(t,-1),n=t;if(isMark(r)){n=r.from;r=r.parent}for(var i=void 0;i=r.childBefore(n);){if(isMark(i)){n=i.from}else if(i.name=="OrderedList"||i.name=="BulletList"){r=i.lastChild;n=r.to}else{break}}return r}var deleteMarkupBackward=function(e){var t=e.state,r=e.dispatch;var n=syntaxTree(t);var i=null,a=t.changeByRange((function(e){var r=e.from,a=t.doc;if(e.empty&&markdownLanguage.isActiveAt(t,e.from)){var s=a.lineAt(r);var o=getContext(contextNodeForDelete(n,r),s.text,a);if(o.length){var l=o[o.length-1];var f=l.to-l.spaceAfter.length+(l.spaceAfter?1:0);if(r-s.from>f&&!/\S/.test(s.text.slice(f,r-s.from)))return{range:EditorSelection.cursor(s.from+f),changes:{from:s.from+f,to:r}};if(r-s.from==f){var p=s.from+l.from;if(l.item&&l.node.from<l.item.from&&/\S/.test(s.text.slice(l.from,l.to)))return{range:e,changes:{from:p,to:s.from+l.to,insert:l.blank()}};if(p<r)return{range:EditorSelection.cursor(p),changes:{from:p,to:r}}}}}return i={range:e}}));if(i)return false;r(t.update(a,{scrollIntoView:true,userEvent:"delete"}));return true};var markdownKeymap=[{key:"Enter",run:insertNewlineContinueMarkup},{key:"Backspace",run:deleteMarkupBackward}];var htmlNoMatch=html({matchClosingTags:false});function markdown(e){if(e===void 0){e={}}var t=e.codeLanguages,r=e.defaultCodeLanguage,n=e.addKeymap,i=n===void 0?true:n,a=e.base,s=a===void 0?commonmarkLanguage:a,o=s.parser;if(!(o instanceof MarkdownParser))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");var l=e.extensions?[e.extensions]:[];var f=[htmlNoMatch.support],p;if(r instanceof LanguageSupport){f.push(r.support);p=r.language}else if(r){p=r}var u=t||p?getCodeParser(t||[],p):undefined;l.push(parseCode({codeParser:u,htmlParser:htmlNoMatch.language.parser}));if(i)f.push(Prec.high(keymap.of(markdownKeymap)));return new LanguageSupport(mkLang(o.configure(l)),f)}export{commonmarkLanguage,deleteMarkupBackward,insertNewlineContinueMarkup,markdown,markdownKeymap,markdownLanguage};
//# sourceMappingURL=index-74ae9671.js.map