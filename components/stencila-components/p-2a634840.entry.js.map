{"version":3,"sources":["src/components/menu/menu.css?tag=stencila-menu&mode=default&encapsulation=scoped","src/components/menu/menu.material.css?tag=stencila-menu&mode=material&encapsulation=scoped","src/components/menu/menu.tsx"],"names":["defaultMenuCss","menuMaterialCss","menuIds","Menu","[object Object]","hostRef","this","popperRef","isOpen","autoClose","autoOpen","menuPosition","initMenu","menuEl","createPopper","el","placement","strategy","modifiers","name","computeMenuLocation","update","catch","err","console","error","toggleMenu","e","preventDefault","stopPropagation","openMenu","closeMenu","closeOnBlur","contains","relatedTarget","autoCloseTimeoutRef","window","setTimeout","clearTimeout","menuId","addEventListener","removeEventListener","destroy","h","Host","onClick","aria-controls","aria-expanded","role","aria-hidden","aria-orientation","tabindex","id","ref"],"mappings":"6FAAA,MAAMA,EAAiB,00CCAvB,MAAMC,EAAkB,+1BCGxB,IAAIC,EAAU,QAUDC,EAAI,MARjBC,YAAAC,aAYUC,KAAAC,UAA6B,KAS9BD,KAAAE,OAAS,MAMTF,KAAAG,UAAY,KAMZH,KAAAI,SAAW,MAMXJ,KAAAK,aAA0B,cAEjCL,KAAAM,SAAW,KACT,GAAIN,KAAKO,OAAQ,CACfP,KAAKC,UAAYO,EAAaR,KAAKS,GAAIT,KAAKO,OAAQ,CAClDG,UAAWV,KAAKK,aAChBM,SAAU,QACVC,UAAW,CAAC,CAAEC,KAAM,wBAKlBb,KAAAc,oBAAsB,KAC5Bd,KAAKC,UACDD,KAAKC,UAAUc,SAASC,OAAOC,IAC7BC,QAAQC,MAAM,iCAAkCF,MAElDjB,KAAKM,YAGHN,KAAAoB,WAAcC,IACpBA,EAAEC,iBACF,GAAItB,KAAKG,UAAW,CAClBkB,EAAEE,kBAEJvB,KAAKE,OAAUF,KAAKE,OAAS,MAASF,KAAKwB,YAGrCxB,KAAAwB,SAAW,KACjBxB,KAAKc,sBACLd,KAAKE,OAAS,MAGRF,KAAAyB,UAAY,KAClB,GAAIzB,KAAKG,UAAW,CAClBH,KAAKE,OAAS,QAKVF,KAAA0B,YAAeL,IACrB,GAAIrB,KAAKE,SAAWF,KAAKS,GAAGkB,SAASN,EAAEO,eAAwB,CAC7D5B,KAAK6B,oBAAsBC,OAAOC,WAAW/B,KAAKyB,UAAW,OAIzDzB,KAAAgC,aAAe,KACrBF,OAAOE,aAAahC,KAAK6B,sBAGnB7B,KAAAiC,OAAS,iBAAiBrC,MAElCE,oBACE,GAAIE,KAAKG,UAAW,CAClBH,KAAKS,GAAGyB,iBAAiB,WAAYlC,KAAK0B,aAC1C1B,KAAKS,GAAGyB,iBAAiB,aAAclC,KAAKgC,cAG9C,GAAIhC,KAAKI,SAAU,CACjBJ,KAAKS,GAAGyB,iBAAiB,aAAclC,KAAKwB,UAC5CxB,KAAKS,GAAGyB,iBAAiB,QAASlC,KAAKwB,WAIpC1B,uBACLE,KAAKS,GAAG0B,oBAAoB,WAAYnC,KAAK0B,aAC7C1B,KAAKS,GAAG0B,oBAAoB,aAAcnC,KAAKgC,cAC/ChC,KAAKS,GAAG0B,oBAAoB,aAAcnC,KAAKwB,UAC/CxB,KAAKS,GAAG0B,oBAAoB,QAASnC,KAAKwB,UAE1C,GAAIxB,KAAKC,UAAW,CAClBD,KAAKC,UAAUmC,UACfpC,KAAKC,UAAY,MAIdH,SACL,OACEuC,EAACC,EAAI,KACHD,EAAA,OAAA,CACEE,QAASvC,KAAKoB,WAAUoB,gBACTxC,KAAKiC,OAAMQ,gBACXzC,KAAKE,OAAS,OAAS,SAEtCmC,EAAA,OAAA,CAAMxB,KAAK,YAGbwB,EAAA,KAAA,CACEK,KAAK,OAAMC,eACG3C,KAAKE,OAAM0C,mBACR,WACjBC,SAAS,KACTC,GAAI9C,KAAKiC,OACTM,QAASvC,KAAKyB,UACdsB,IAAMtC,GAAQT,KAAKO,OAASE,GAE5B4B,EAAA,OAAA","sourcesContent":["@import '~@stencila/style-stencila/dist/atoms/menu.css';\n","@import '~@stencila/style-material/dist/atoms/menu.css';\n","import { Component, Element, h, Host, Prop } from '@stencil/core'\nimport { createPopper, Instance, Placement } from '@popperjs/core'\n\nlet menuIds = 0\n\n@Component({\n  tag: 'stencila-menu',\n  styleUrls: {\n    default: 'menu.css',\n    material: 'menu.material.css',\n  },\n  scoped: true,\n})\nexport class Menu {\n  @Element() private el: HTMLStencilaCodeFragmentElement\n\n  private menuEl: HTMLUListElement | undefined\n  private popperRef: Instance | null = null\n\n  /**\n   * Determines whether the Menu is shown or not\n   */\n  @Prop({\n    mutable: true,\n    reflect: true,\n  })\n  public isOpen = false\n\n  /**\n   * Close the menu when losing focus\n   */\n  @Prop()\n  public autoClose = true\n\n  /**\n   * Open the menu on hover or when gaining focus\n   */\n  @Prop()\n  public autoOpen = false\n\n  /**\n   * The position relative to the toggle button where the menu should appear.\n   */\n  @Prop()\n  public menuPosition: Placement = 'right-start'\n\n  initMenu = () => {\n    if (this.menuEl) {\n      this.popperRef = createPopper(this.el, this.menuEl, {\n        placement: this.menuPosition,\n        strategy: 'fixed',\n        modifiers: [{ name: 'preventOverflow' }],\n      })\n    }\n  }\n\n  private computeMenuLocation = () => {\n    this.popperRef\n      ? this.popperRef.update().catch((err) => {\n          console.error('Could not update menu position', err)\n        })\n      : this.initMenu()\n  }\n\n  private toggleMenu = (e: MouseEvent) => {\n    e.preventDefault()\n    if (this.autoClose) {\n      e.stopPropagation()\n    }\n    this.isOpen ? (this.isOpen = false) : this.openMenu()\n  }\n\n  private openMenu = () => {\n    this.computeMenuLocation()\n    this.isOpen = true\n  }\n\n  private closeMenu = () => {\n    if (this.autoClose) {\n      this.isOpen = false\n    }\n  }\n\n  private autoCloseTimeoutRef: number\n  private closeOnBlur = (e: MouseEvent) => {\n    if (this.isOpen && !this.el.contains(e.relatedTarget as Node)) {\n      this.autoCloseTimeoutRef = window.setTimeout(this.closeMenu, 250)\n    }\n  }\n\n  private clearTimeout = () => {\n    window.clearTimeout(this.autoCloseTimeoutRef)\n  }\n\n  private menuId = `stencila-menu-${menuIds++}`\n\n  componentWillLoad() {\n    if (this.autoClose) {\n      this.el.addEventListener('mouseout', this.closeOnBlur)\n      this.el.addEventListener('mouseenter', this.clearTimeout)\n    }\n\n    if (this.autoOpen) {\n      this.el.addEventListener('mouseenter', this.openMenu)\n      this.el.addEventListener('focus', this.openMenu)\n    }\n  }\n\n  public disconnectedCallback(): void {\n    this.el.removeEventListener('mouseout', this.closeOnBlur)\n    this.el.removeEventListener('mouseenter', this.clearTimeout)\n    this.el.removeEventListener('mouseenter', this.openMenu)\n    this.el.removeEventListener('focus', this.openMenu)\n\n    if (this.popperRef) {\n      this.popperRef.destroy()\n      this.popperRef = null\n    }\n  }\n\n  public render() {\n    return (\n      <Host>\n        <span\n          onClick={this.toggleMenu}\n          aria-controls={this.menuId}\n          aria-expanded={this.isOpen ? 'true' : 'false'}\n        >\n          <slot name=\"toggle\" />\n        </span>\n\n        <ul\n          role=\"menu\"\n          aria-hidden={!this.isOpen}\n          aria-orientation=\"vertical\"\n          tabindex=\"-1\"\n          id={this.menuId}\n          onClick={this.closeMenu}\n          ref={(el) => (this.menuEl = el)}\n        >\n          <slot />\n        </ul>\n      </Host>\n    )\n  }\n}\n"]}