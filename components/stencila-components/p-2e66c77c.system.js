var __extends=this&&this.__extends||function(){var t=function(e,r){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r))t[r]=e[r]};return t(e,r)};return function(e,r){if(typeof r!=="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");t(e,r);function n(){this.constructor=e}e.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}();var __awaiter=this&&this.__awaiter||function(t,e,r,n){function i(t){return t instanceof r?t:new r((function(e){e(t)}))}return new(r||(r=Promise))((function(r,o){function a(t){try{f(n.next(t))}catch(e){o(e)}}function s(t){try{f(n["throw"](t))}catch(e){o(e)}}function f(t){t.done?r(t.value):i(t.value).then(a,s)}f((n=n.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var r={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(t){return function(e){return f([t,e])}}function f(a){if(n)throw new TypeError("Generator is already executing.");while(r)try{if(n=1,i&&(o=a[0]&2?i["return"]:a[0]?i["throw"]||((o=i["return"])&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;if(i=0,o)a=[a[0]&2,o.value];switch(a[0]){case 0:case 1:o=a;break;case 4:r.label++;return{value:a[1],done:false};case 5:r.label++;i=a[1];a=[0];continue;case 7:a=r.ops.pop();r.trys.pop();continue;default:if(!(o=r.trys,o=o.length>0&&o[o.length-1])&&(a[0]===6||a[0]===2)){r=0;continue}if(a[0]===3&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(a[0]===6&&r.label<o[1]){r.label=o[1];o=a;break}if(o&&r.label<o[2]){r.label=o[2];r.ops.push(a);break}if(o[2])r.ops.pop();r.trys.pop();continue}a=e.call(t,r)}catch(s){a=[6,s];i=0}finally{n=o=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArray=this&&this.__spreadArray||function(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,o;n<i;n++){if(o||!(n in e)){if(!o)o=Array.prototype.slice.call(e,0,n);o[n]=e[n]}}return t.concat(o||Array.prototype.slice.call(e))};System.register(["./p-6cc918a4.system.js","./p-33366d5a.system.js","./p-5cd8524a.system.js"],(function(t,e){"use strict";var r,n,i,o,a,s,f,u;return{setters:[function(t){r=t.h;n=t.r;i=t.f;o=t.e;a=t.c},function(t){s=t.g},function(t){f=t.a;u=t.f}],execute:function(){t({b:Zh,d:ks,g:Vs,k:ef,n:of,p:fs,q:xu,s:Os,u:Qs,v:hf,w:cf});var l="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map((function(t){return t?parseInt(t,36):1}));for(var c=1;c<l.length;c++)l[c]+=l[c-1];function h(t){for(var e=1;e<l.length;e+=2)if(l[e]>t)return l[e-1]<=t;return false}function p(t){return t>=127462&&t<=127487}var d=8205;function v(t,e,r,n){if(r===void 0){r=true}if(n===void 0){n=true}return(r?g:m)(t,e,n)}function g(t,e,r){if(e==t.length)return e;if(e&&y(t.charCodeAt(e))&&b(t.charCodeAt(e-1)))e--;var n=w(t,e);e+=k(n);while(e<t.length){var i=w(t,e);if(n==d||i==d||r&&h(i)){e+=k(i);n=i}else if(p(i)){var o=0,a=e-2;while(a>=0&&p(w(t,a))){o++;a-=2}if(o%2==0)break;else e+=2}else{break}}return e}function m(t,e,r){while(e>0){var n=g(t,e-2,r);if(n<e)return n;e--}return 0}function y(t){return t>=56320&&t<57344}function b(t){return t>=55296&&t<56320}function w(t,e){var r=t.charCodeAt(e);if(!b(r)||e+1==t.length)return r;var n=t.charCodeAt(e+1);if(!y(n))return r;return(r-55296<<10)+(n-56320)+65536}function x(t){if(t<=65535)return String.fromCharCode(t);t-=65536;return String.fromCharCode((t>>10)+55296,(t&1023)+56320)}function k(t){return t<65536?1:2}function S(t,e,r){if(r===void 0){r=t.length}var n=0;for(var i=0;i<r;){if(t.charCodeAt(i)==9){n+=e-n%e;i++}else{n++;i=v(t,i)}}return n}function C(t,e,r,n){for(var i=0,o=0;;){if(o>=e)return i;if(i==t.length)break;o+=t.charCodeAt(i)==9?r-o%r:1;i=v(t,i)}return n===true?-1:t.length}var A=function(){function t(){}t.prototype.lineAt=function(t){if(t<0||t>this.length)throw new RangeError("Invalid position ".concat(t," in document of length ").concat(this.length));return this.lineInner(t,false,1,0)};t.prototype.line=function(t){if(t<1||t>this.lines)throw new RangeError("Invalid line number ".concat(t," in ").concat(this.lines,"-line document"));return this.lineInner(t,true,1,0)};t.prototype.replace=function(t,e,r){var n=[];this.decompose(0,t,n,2);if(r.length)r.decompose(0,r.length,n,1|2);this.decompose(e,this.length,n,1);return M.from(n,this.length-(e-t)+r.length)};t.prototype.append=function(t){return this.replace(this.length,this.length,t)};t.prototype.slice=function(t,e){if(e===void 0){e=this.length}var r=[];this.decompose(t,e,r,0);return M.from(r,e-t)};t.prototype.eq=function(t){if(t==this)return true;if(t.length!=this.length||t.lines!=this.lines)return false;var e=this.scanIdentical(t,1),r=this.length-this.scanIdentical(t,-1);var n=new E(this),i=new E(t);for(var o=e,a=e;;){n.next(o);i.next(o);o=0;if(n.lineBreak!=i.lineBreak||n.done!=i.done||n.value!=i.value)return false;a+=n.value.length;if(n.done||a>=r)return true}};t.prototype.iter=function(t){if(t===void 0){t=1}return new E(this,t)};t.prototype.iterRange=function(t,e){if(e===void 0){e=this.length}return new R(this,t,e)};t.prototype.iterLines=function(t,e){var r;if(t==null){r=this.iter()}else{if(e==null)e=this.lines+1;var n=this.line(t).from;r=this.iterRange(n,Math.max(n,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new L(r)};t.prototype.toString=function(){return this.sliceString(0)};t.prototype.toJSON=function(){var t=[];this.flatten(t);return t};t.of=function(e){if(e.length==0)throw new RangeError("A document must have at least one line");if(e.length==1&&!e[0])return t.empty;return e.length<=32?new O(e):M.from(O.split(e,[]))};return t}();var O=function(t){__extends(e,t);function e(e,r){if(r===void 0){r=D(e)}var n=t.call(this)||this;n.text=e;n.length=r;return n}Object.defineProperty(e.prototype,"lines",{get:function(){return this.text.length},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"children",{get:function(){return null},enumerable:false,configurable:true});e.prototype.lineInner=function(t,e,r,n){for(var i=0;;i++){var o=this.text[i],a=n+o.length;if((e?r:a)>=t)return new B(n,a,r,o);n=a+1;r++}};e.prototype.decompose=function(t,r,n,i){var o=t<=0&&r>=this.length?this:new e(T(this.text,t,r),Math.min(r,this.length)-Math.max(0,t));if(i&1){var a=n.pop();var s=P(o.text,a.text.slice(),0,o.length);if(s.length<=32){n.push(new e(s,a.length+o.length))}else{var f=s.length>>1;n.push(new e(s.slice(0,f)),new e(s.slice(f)))}}else{n.push(o)}};e.prototype.replace=function(r,n,i){if(!(i instanceof e))return t.prototype.replace.call(this,r,n,i);var o=P(this.text,P(i.text,T(this.text,0,r)),n);var a=this.length+i.length-(n-r);if(o.length<=32)return new e(o,a);return M.from(e.split(o,[]),a)};e.prototype.sliceString=function(t,e,r){if(e===void 0){e=this.length}if(r===void 0){r="\n"}var n="";for(var i=0,o=0;i<=e&&o<this.text.length;o++){var a=this.text[o],s=i+a.length;if(i>t&&o)n+=r;if(t<s&&e>i)n+=a.slice(Math.max(0,t-i),e-i);i=s+1}return n};e.prototype.flatten=function(t){for(var e=0,r=this.text;e<r.length;e++){var n=r[e];t.push(n)}};e.prototype.scanIdentical=function(){return 0};e.split=function(t,r){var n=[],i=-1;for(var o=0,a=t;o<a.length;o++){var s=a[o];n.push(s);i+=s.length+1;if(n.length==32){r.push(new e(n,i));n=[];i=-1}}if(i>-1)r.push(new e(n,i));return r};return e}(A);var M=function(t){__extends(e,t);function e(e,r){var n=t.call(this)||this;n.children=e;n.length=r;n.lines=0;for(var i=0,o=e;i<o.length;i++){var a=o[i];n.lines+=a.lines}return n}e.prototype.lineInner=function(t,e,r,n){for(var i=0;;i++){var o=this.children[i],a=n+o.length,s=r+o.lines-1;if((e?s:a)>=t)return o.lineInner(t,e,r,n);n=a+1;r=s+1}};e.prototype.decompose=function(t,e,r,n){for(var i=0,o=0;o<=e&&i<this.children.length;i++){var a=this.children[i],s=o+a.length;if(t<=s&&e>=o){var f=n&((o<=t?1:0)|(s>=e?2:0));if(o>=t&&s<=e&&!f)r.push(a);else a.decompose(t-o,e-o,r,f)}o=s+1}};e.prototype.replace=function(r,n,i){if(i.lines<this.lines)for(var o=0,a=0;o<this.children.length;o++){var s=this.children[o],f=a+s.length;if(r>=a&&n<=f){var u=s.replace(r-a,n-a,i);var l=this.lines-s.lines+u.lines;if(u.lines<l>>5-1&&u.lines>l>>5+1){var c=this.children.slice();c[o]=u;return new e(c,this.length-(n-r)+i.length)}return t.prototype.replace.call(this,a,f,u)}a=f+1}return t.prototype.replace.call(this,r,n,i)};e.prototype.sliceString=function(t,e,r){if(e===void 0){e=this.length}if(r===void 0){r="\n"}var n="";for(var i=0,o=0;i<this.children.length&&o<=e;i++){var a=this.children[i],s=o+a.length;if(o>t&&i)n+=r;if(t<s&&e>o)n+=a.sliceString(t-o,e-o,r);o=s+1}return n};e.prototype.flatten=function(t){for(var e=0,r=this.children;e<r.length;e++){var n=r[e];n.flatten(t)}};e.prototype.scanIdentical=function(t,r){if(!(t instanceof e))return 0;var n=0;var i=r>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1],o=i[0],a=i[1],s=i[2],f=i[3];for(;;o+=r,a+=r){if(o==s||a==f)return n;var u=this.children[o],l=t.children[a];if(u!=l)return n+u.scanIdentical(l,r);n+=u.length+1}};e.from=function(t,r){if(r===void 0){r=t.reduce((function(t,e){return t+e.length+1}),-1)}var n=0;for(var i=0,o=t;i<o.length;i++){var a=o[i];n+=a.lines}if(n<32){var s=[];for(var f=0,u=t;f<u.length;f++){var a=u[f];a.flatten(s)}return new O(s,r)}var l=Math.max(32,n>>5),c=l<<1,h=l>>1;var p=[],d=0,v=-1,g=[];function m(t){var r;if(t.lines>c&&t instanceof e){for(var n=0,i=t.children;n<i.length;n++){var o=i[n];m(o)}}else if(t.lines>h&&(d>h||!d)){y();p.push(t)}else if(t instanceof O&&d&&(r=g[g.length-1])instanceof O&&t.lines+r.lines<=32){d+=t.lines;v+=t.length+1;g[g.length-1]=new O(r.text.concat(t.text),r.length+1+t.length)}else{if(d+t.lines>l)y();d+=t.lines;v+=t.length+1;g.push(t)}}function y(){if(d==0)return;p.push(g.length==1?g[0]:e.from(g,v));v=-1;d=g.length=0}for(var b=0,w=t;b<w.length;b++){var x=w[b];m(x)}y();return p.length==1?p[0]:new e(p,r)};return e}(A);A.empty=new O([""],0);function D(t){var e=-1;for(var r=0,n=t;r<n.length;r++){var i=n[r];e+=i.length+1}return e}function P(t,e,r,n){if(r===void 0){r=0}if(n===void 0){n=1e9}for(var i=0,o=0,a=true;o<t.length&&i<=n;o++){var s=t[o],f=i+s.length;if(f>=r){if(f>n)s=s.slice(0,n-i);if(i<r)s=s.slice(r-i);if(a){e[e.length-1]+=s;a=false}else e.push(s)}i=f+1}return e}function T(t,e,r){return P(t,[""],e,r)}var E=function(){function t(t,e){if(e===void 0){e=1}this.dir=e;this.done=false;this.lineBreak=false;this.value="";this.nodes=[t];this.offsets=[e>0?1:(t instanceof O?t.text.length:t.children.length)<<1]}t.prototype.nextInner=function(t,e){this.done=this.lineBreak=false;for(;;){var r=this.nodes.length-1;var n=this.nodes[r],i=this.offsets[r],o=i>>1;var a=n instanceof O?n.text.length:n.children.length;if(o==(e>0?a:0)){if(r==0){this.done=true;this.value="";return this}if(e>0)this.offsets[r-1]++;this.nodes.pop();this.offsets.pop()}else if((i&1)==(e>0?0:1)){this.offsets[r]+=e;if(t==0){this.lineBreak=true;this.value="\n";return this}t--}else if(n instanceof O){var s=n.text[o+(e<0?-1:0)];this.offsets[r]+=e;if(s.length>Math.max(0,t)){this.value=t==0?s:e>0?s.slice(t):s.slice(0,s.length-t);return this}t-=s.length}else{var s=n.children[o+(e<0?-1:0)];if(t>s.length){t-=s.length;this.offsets[r]+=e}else{if(e<0)this.offsets[r]--;this.nodes.push(s);this.offsets.push(e>0?1:(s instanceof O?s.text.length:s.children.length)<<1)}}}};t.prototype.next=function(t){if(t===void 0){t=0}if(t<0){this.nextInner(-t,-this.dir);t=this.value.length}return this.nextInner(t,this.dir)};return t}();var R=function(){function t(t,e,r){this.value="";this.done=false;this.cursor=new E(t,e>r?-1:1);this.pos=e>r?t.length:0;this.from=Math.min(e,r);this.to=Math.max(e,r)}t.prototype.nextInner=function(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to){this.value="";this.done=true;return this}t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);var r=e<0?this.pos-this.from:this.to-this.pos;if(t>r)t=r;r-=t;var n=this.cursor.next(t).value;this.pos+=(n.length+t)*e;this.value=n.length<=r?n:e<0?n.slice(n.length-r):n.slice(0,r);this.done=!this.value;return this};t.prototype.next=function(t){if(t===void 0){t=0}if(t<0)t=Math.max(t,this.from-this.pos);else if(t>0)t=Math.min(t,this.to-this.pos);return this.nextInner(t,this.cursor.dir)};Object.defineProperty(t.prototype,"lineBreak",{get:function(){return this.cursor.lineBreak&&this.value!=""},enumerable:false,configurable:true});return t}();var L=function(){function t(t){this.inner=t;this.afterBreak=true;this.value="";this.done=false}t.prototype.next=function(t){if(t===void 0){t=0}var e=this.inner.next(t),r=e.done,n=e.lineBreak,i=e.value;if(r){this.done=true;this.value=""}else if(n){if(this.afterBreak){this.value=""}else{this.afterBreak=true;this.next()}}else{this.value=i;this.afterBreak=false}return this};Object.defineProperty(t.prototype,"lineBreak",{get:function(){return false},enumerable:false,configurable:true});return t}();if(typeof Symbol!="undefined"){A.prototype[Symbol.iterator]=function(){return this.iter()};E.prototype[Symbol.iterator]=R.prototype[Symbol.iterator]=L.prototype[Symbol.iterator]=function(){return this}}var B=function(){function t(t,e,r,n){this.from=t;this.to=e;this.number=r;this.text=n}Object.defineProperty(t.prototype,"length",{get:function(){return this.to-this.from},enumerable:false,configurable:true});return t}();var I=/\r\n?|\n/;var N=function(t){t[t["Simple"]=0]="Simple";t[t["TrackDel"]=1]="TrackDel";t[t["TrackBefore"]=2]="TrackBefore";t[t["TrackAfter"]=3]="TrackAfter";return t}(N||(N={}));var j=function(){function t(t){this.sections=t}Object.defineProperty(t.prototype,"length",{get:function(){var t=0;for(var e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"newLength",{get:function(){var t=0;for(var e=0;e<this.sections.length;e+=2){var r=this.sections[e+1];t+=r<0?this.sections[e]:r}return t},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"empty",{get:function(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0},enumerable:false,configurable:true});t.prototype.iterGaps=function(t){for(var e=0,r=0,n=0;e<this.sections.length;){var i=this.sections[e++],o=this.sections[e++];if(o<0){t(r,n,i);n+=i}else{n+=o}r+=i}};t.prototype.iterChangedRanges=function(t,e){if(e===void 0){e=false}F(this,t,e)};Object.defineProperty(t.prototype,"invertedDesc",{get:function(){var e=[];for(var r=0;r<this.sections.length;){var n=this.sections[r++],i=this.sections[r++];if(i<0)e.push(n,i);else e.push(i,n)}return new t(e)},enumerable:false,configurable:true});t.prototype.composeDesc=function(t){return this.empty?t:t.empty?this:W(this,t)};t.prototype.mapDesc=function(t,e){if(e===void 0){e=false}return t.empty?this:z(this,t,e)};t.prototype.mapPos=function(t,e,r){if(e===void 0){e=-1}if(r===void 0){r=N.Simple}var n=0,i=0;for(var o=0;o<this.sections.length;){var a=this.sections[o++],s=this.sections[o++],f=n+a;if(s<0){if(f>t)return i+(t-n);i+=a}else{if(r!=N.Simple&&f>=t&&(r==N.TrackDel&&n<t&&f>t||r==N.TrackBefore&&n<t||r==N.TrackAfter&&f>t))return null;if(f>t||f==t&&e<0&&!a)return t==n||e<0?i:i+s;i+=s}n=f}if(t>n)throw new RangeError("Position ".concat(t," is out of range for changeset of length ").concat(n));return i};t.prototype.touchesRange=function(t,e){if(e===void 0){e=t}for(var r=0,n=0;r<this.sections.length&&n<=e;){var i=this.sections[r++],o=this.sections[r++],a=n+i;if(o>=0&&n<=e&&a>=t)return n<t&&a>e?"cover":true;n=a}return false};t.prototype.toString=function(){var t="";for(var e=0;e<this.sections.length;){var r=this.sections[e++],n=this.sections[e++];t+=(t?" ":"")+r+(n>=0?":"+n:"")}return t};t.prototype.toJSON=function(){return this.sections};t.fromJSON=function(e){if(!Array.isArray(e)||e.length%2||e.some((function(t){return typeof t!="number"})))throw new RangeError("Invalid JSON representation of ChangeDesc");return new t(e)};return t}();var _=function(t){__extends(e,t);function e(e,r){var n=t.call(this,e)||this;n.inserted=r;return n}e.prototype.apply=function(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");F(this,(function(e,r,n,i,o){return t=t.replace(n,n+(r-e),o)}),false);return t};e.prototype.mapDesc=function(t,e){if(e===void 0){e=false}return z(this,t,e,true)};e.prototype.invert=function(t){var r=this.sections.slice(),n=[];for(var i=0,o=0;i<r.length;i+=2){var a=r[i],s=r[i+1];if(s>=0){r[i]=s;r[i+1]=a;var f=i>>1;while(n.length<f)n.push(A.empty);n.push(a?t.slice(o,o+a):A.empty)}o+=a}return new e(r,n)};e.prototype.compose=function(t){return this.empty?t:t.empty?this:W(this,t,true)};e.prototype.map=function(t,e){if(e===void 0){e=false}return t.empty?this:z(this,t,e,true)};e.prototype.iterChanges=function(t,e){if(e===void 0){e=false}F(this,t,e)};Object.defineProperty(e.prototype,"desc",{get:function(){return new j(this.sections)},enumerable:false,configurable:true});e.prototype.filter=function(t){var r=[],n=[],i=[];var o=new q(this);t:for(var a=0,s=0;;){var f=a==t.length?1e9:t[a++];while(s<f||s==f&&o.len==0){if(o.done)break t;var u=Math.min(o.len,f-s);V(i,u,-1);var l=o.ins==-1?-1:o.off==0?o.ins:0;V(r,u,l);if(l>0)H(n,r,o.text);o.forward(u);s+=u}var c=t[a++];while(s<c){if(o.done)break t;var u=Math.min(o.len,c-s);V(r,u,-1);V(i,u,o.ins==-1?-1:o.off==0?o.ins:0);o.forward(u);s+=u}}return{changes:new e(r,n),filtered:new j(i)}};e.prototype.toJSON=function(){var t=[];for(var e=0;e<this.sections.length;e+=2){var r=this.sections[e],n=this.sections[e+1];if(n<0)t.push(r);else if(n==0)t.push([r]);else t.push([r].concat(this.inserted[e>>1].toJSON()))}return t};e.of=function(t,r,n){var i=[],o=[],a=0;var s=null;function f(t){if(t===void 0){t=false}if(!t&&!i.length)return;if(a<r)V(i,r-a,-1);var n=new e(i,o);s=s?s.compose(n.map(s)):n;i=[];o=[];a=0}function u(t){if(Array.isArray(t)){for(var l=0,c=t;l<c.length;l++){var h=c[l];u(h)}}else if(t instanceof e){if(t.length!=r)throw new RangeError("Mismatched change set length (got ".concat(t.length,", expected ").concat(r,")"));f();s=s?s.compose(t.map(s)):t}else{var p=t.from,d=t.to,v=d===void 0?p:d,g=t.insert;if(p>v||p<0||v>r)throw new RangeError("Invalid change range ".concat(p," to ").concat(v," (in doc of length ").concat(r,")"));var m=!g?A.empty:typeof g=="string"?A.of(g.split(n||I)):g;var y=m.length;if(p==v&&y==0)return;if(p<a)f();if(p>a)V(i,p-a,-1);V(i,v-p,y);H(o,i,m);a=v}}u(t);f(!s);return s};e.empty=function(t){return new e(t?[t,-1]:[],[])};e.fromJSON=function(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");var r=[],n=[];for(var i=0;i<t.length;i++){var o=t[i];if(typeof o=="number"){r.push(o,-1)}else if(!Array.isArray(o)||typeof o[0]!="number"||o.some((function(t,e){return e&&typeof t!="string"}))){throw new RangeError("Invalid JSON representation of ChangeSet")}else if(o.length==1){r.push(o[0],0)}else{while(n.length<i)n.push(A.empty);n[i]=A.of(o.slice(1));r.push(o[0],n[i].length)}}return new e(r,n)};return e}(j);function V(t,e,r,n){if(n===void 0){n=false}if(e==0&&r<=0)return;var i=t.length-2;if(i>=0&&r<=0&&r==t[i+1])t[i]+=e;else if(e==0&&t[i]==0)t[i+1]+=r;else if(n){t[i]+=e;t[i+1]+=r}else t.push(e,r)}function H(t,e,r){if(r.length==0)return;var n=e.length-2>>1;if(n<t.length){t[t.length-1]=t[t.length-1].append(r)}else{while(t.length<n)t.push(A.empty);t.push(r)}}function F(t,e,r){var n=t.inserted;for(var i=0,o=0,a=0;a<t.sections.length;){var s=t.sections[a++],f=t.sections[a++];if(f<0){i+=s;o+=s}else{var u=i,l=o,c=A.empty;for(;;){u+=s;l+=f;if(f&&n)c=c.append(n[a-2>>1]);if(r||a==t.sections.length||t.sections[a+1]<0)break;s=t.sections[a++];f=t.sections[a++]}e(i,u,o,l,c);i=u;o=l}}}function z(t,e,r,n){if(n===void 0){n=false}var i=[],o=n?[]:null;var a=new q(t),s=new q(e);for(var f=0,u=0;;){if(a.ins==-1){f+=a.len;a.next()}else if(s.ins==-1&&u<f){var l=Math.min(s.len,f-u);s.forward(l);V(i,l,-1);u+=l}else if(s.ins>=0&&(a.done||u<f||u==f&&(s.len<a.len||s.len==a.len&&!r))){V(i,s.ins,-1);while(f>u&&!a.done&&f+a.len<u+s.len){f+=a.len;a.next()}u+=s.len;s.next()}else if(a.ins>=0){var c=0,h=f+a.len;for(;;){if(s.ins>=0&&u>f&&u+s.len<h){c+=s.ins;u+=s.len;s.next()}else if(s.ins==-1&&u<h){var l=Math.min(s.len,h-u);c+=l;s.forward(l);u+=l}else{break}}V(i,c,a.ins);if(o)H(o,i,a.text);f=h;a.next()}else if(a.done&&s.done){return o?new _(i,o):new j(i)}else{throw new Error("Mismatched change set lengths")}}}function W(t,e,r){if(r===void 0){r=false}var n=[];var i=r?[]:null;var o=new q(t),a=new q(e);for(var s=false;;){if(o.done&&a.done){return i?new _(n,i):new j(n)}else if(o.ins==0){V(n,o.len,0,s);o.next()}else if(a.len==0&&!a.done){V(n,0,a.ins,s);if(i)H(i,n,a.text);a.next()}else if(o.done||a.done){throw new Error("Mismatched change set lengths")}else{var f=Math.min(o.len2,a.len),u=n.length;if(o.ins==-1){var l=a.ins==-1?-1:a.off?0:a.ins;V(n,f,l,s);if(i&&l)H(i,n,a.text)}else if(a.ins==-1){V(n,o.off?0:o.len,f,s);if(i)H(i,n,o.textBit(f))}else{V(n,o.off?0:o.len,a.off?0:a.ins,s);if(i&&!a.off)H(i,n,a.text)}s=(o.ins>f||a.ins>=0&&a.len>f)&&(s||n.length>u);o.forward2(f);a.forward(f)}}}var q=function(){function t(t){this.set=t;this.i=0;this.next()}t.prototype.next=function(){var t=this.set.sections;if(this.i<t.length){this.len=t[this.i++];this.ins=t[this.i++]}else{this.len=0;this.ins=-2}this.off=0};Object.defineProperty(t.prototype,"done",{get:function(){return this.ins==-2},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"len2",{get:function(){return this.ins<0?this.len:this.ins},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"text",{get:function(){var t=this.set.inserted,e=this.i-2>>1;return e>=t.length?A.empty:t[e]},enumerable:false,configurable:true});t.prototype.textBit=function(t){var e=this.set.inserted,r=this.i-2>>1;return r>=e.length&&!t?A.empty:e[r].slice(this.off,t==null?undefined:this.off+t)};t.prototype.forward=function(t){if(t==this.len)this.next();else{this.len-=t;this.off+=t}};t.prototype.forward2=function(t){if(this.ins==-1)this.forward(t);else if(t==this.ins)this.next();else{this.ins-=t;this.off+=t}};return t}();var U=function(){function t(t,e,r){this.from=t;this.to=e;this.flags=r}Object.defineProperty(t.prototype,"anchor",{get:function(){return this.flags&16?this.to:this.from},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"head",{get:function(){return this.flags&16?this.from:this.to},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"empty",{get:function(){return this.from==this.to},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"assoc",{get:function(){return this.flags&4?-1:this.flags&8?1:0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"bidiLevel",{get:function(){var t=this.flags&3;return t==3?null:t},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"goalColumn",{get:function(){var t=this.flags>>5;return t==33554431?undefined:t},enumerable:false,configurable:true});t.prototype.map=function(e,r){if(r===void 0){r=-1}var n,i;if(this.empty){n=i=e.mapPos(this.from,r)}else{n=e.mapPos(this.from,1);i=e.mapPos(this.to,-1)}return n==this.from&&i==this.to?this:new t(n,i,this.flags)};t.prototype.extend=function(t,e){if(e===void 0){e=t}if(t<=this.anchor&&e>=this.anchor)return G.range(t,e);var r=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return G.range(this.anchor,r)};t.prototype.eq=function(t){return this.anchor==t.anchor&&this.head==t.head};t.prototype.toJSON=function(){return{anchor:this.anchor,head:this.head}};t.fromJSON=function(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return G.range(t.anchor,t.head)};return t}();var G=function(){function t(t,e){if(e===void 0){e=0}this.ranges=t;this.mainIndex=e}t.prototype.map=function(e,r){if(r===void 0){r=-1}if(e.empty)return this;return t.create(this.ranges.map((function(t){return t.map(e,r)})),this.mainIndex)};t.prototype.eq=function(t){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return false;for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].eq(t.ranges[e]))return false;return true};Object.defineProperty(t.prototype,"main",{get:function(){return this.ranges[this.mainIndex]},enumerable:false,configurable:true});t.prototype.asSingle=function(){return this.ranges.length==1?this:new t([this.main])};t.prototype.addRange=function(e,r){if(r===void 0){r=true}return t.create([e].concat(this.ranges),r?0:this.mainIndex+1)};t.prototype.replaceRange=function(e,r){if(r===void 0){r=this.mainIndex}var n=this.ranges.slice();n[r]=e;return t.create(n,this.mainIndex)};t.prototype.toJSON=function(){return{ranges:this.ranges.map((function(t){return t.toJSON()})),main:this.mainIndex}};t.fromJSON=function(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new t(e.ranges.map((function(t){return U.fromJSON(t)})),e.main)};t.single=function(e,r){if(r===void 0){r=e}return new t([t.range(e,r)],0)};t.create=function(e,r){if(r===void 0){r=0}if(e.length==0)throw new RangeError("A selection needs at least one range");for(var n=0,i=0;i<e.length;i++){var o=e[i];if(o.empty?o.from<=n:o.from<n)return K(e.slice(),r);n=o.to}return new t(e,r)};t.cursor=function(t,e,r,n){if(e===void 0){e=0}return new U(t,t,(e==0?0:e<0?4:8)|(r==null?3:Math.min(2,r))|(n!==null&&n!==void 0?n:33554431)<<5)};t.range=function(t,e,r){var n=(r!==null&&r!==void 0?r:33554431)<<5;return e<t?new U(e,t,16|n|8):new U(t,e,n|(e>t?4:0))};return t}();t("o",G);function K(t,e){if(e===void 0){e=0}var r=t[e];t.sort((function(t,e){return t.from-e.from}));e=t.indexOf(r);for(var n=1;n<t.length;n++){var i=t[n],o=t[n-1];if(i.empty?i.from<=o.to:i.from<o.to){var a=o.from,s=Math.max(i.to,o.to);if(n<=e)e--;t.splice(--n,2,i.anchor>i.head?G.range(s,a):G.range(a,s))}}return new G(t,e)}function J(t,e){for(var r=0,n=t.ranges;r<n.length;r++){var i=n[r];if(i.to>e)throw new RangeError("Selection points outside of document")}}var $=0;var Y=function(){function t(t,e,r,n,i){this.combine=t;this.compareInput=e;this.compare=r;this.isStatic=n;this.extensions=i;this.id=$++;this.default=t([])}t.define=function(e){if(e===void 0){e={}}return new t(e.combine||function(t){return t},e.compareInput||function(t,e){return t===e},e.compare||(!e.combine?X:function(t,e){return t===e}),!!e.static,e.enables)};t.prototype.of=function(t){return new Q([],this,0,t)};t.prototype.compute=function(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Q(t,this,1,e)};t.prototype.computeN=function(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new Q(t,this,2,e)};t.prototype.from=function(t,e){if(!e)e=function(t){return t};return this.compute([t],(function(r){return e(r.field(t))}))};return t}();function X(t,e){return t==e||t.length==e.length&&t.every((function(t,r){return t===e[r]}))}var Q=function(){function t(t,e,r,n){this.dependencies=t;this.facet=e;this.type=r;this.value=n;this.id=$++}t.prototype.dynamicSlot=function(t){var e;var r=this.value;var n=this.facet.compareInput;var i=this.id,o=t[i]>>1,a=this.type==2;var s=false,f=false,u=[];for(var l=0,c=this.dependencies;l<c.length;l++){var h=c[l];if(h=="doc")s=true;else if(h=="selection")f=true;else if((((e=t[h.id])!==null&&e!==void 0?e:1)&1)==0)u.push(t[h.id])}return{create:function(t){t.values[o]=r(t);return 1},update:function(t,e){if(s&&e.docChanged||f&&(e.docChanged||e.selection)||u.some((function(e){return(ct(t,e)&1)>0}))){var i=r(t);if(a?!Z(i,t.values[o],n):!n(i,t.values[o])){t.values[o]=i;return 1}}return 0},reconfigure:function(t,e){var s=r(t);var f=e.config.address[i];if(f!=null){var u=ht(e,f);if(a?Z(s,u,n):n(s,u)){t.values[o]=u;return 0}}t.values[o]=s;return 1}}};return t}();function Z(t,e,r){if(t.length!=e.length)return false;for(var n=0;n<t.length;n++)if(!r(t[n],e[n]))return false;return true}function tt(t,e,r){var n=r.map((function(e){return t[e.id]}));var i=r.map((function(t){return t.type}));var o=n.filter((function(t){return!(t&1)}));var a=t[e.id]>>1;function s(t){var r=[];for(var o=0;o<n.length;o++){var a=ht(t,n[o]);if(i[o]==2)for(var s=0,f=a;s<f.length;s++){var u=f[s];r.push(u)}else r.push(a)}return e.combine(r)}return{create:function(t){for(var e=0,r=n;e<r.length;e++){var i=r[e];ct(t,i)}t.values[a]=s(t);return 1},update:function(t,r){if(!o.some((function(e){return ct(t,e)&1})))return 0;var n=s(t);if(e.compare(n,t.values[a]))return 0;t.values[a]=n;return 1},reconfigure:function(t,i){var o=n.some((function(e){return ct(t,e)&1}));var f=i.config.facets[e.id],u=i.facet(e);if(f&&!o&&X(r,f)){t.values[a]=u;return 0}var l=s(t);if(e.compare(l,u)){t.values[a]=u;return 0}t.values[a]=l;return 1}}}var et=Y.define({static:true});var rt=function(){function t(t,e,r,n,i){this.id=t;this.createF=e;this.updateF=r;this.compareF=n;this.spec=i;this.provides=undefined}t.define=function(e){var r=new t($++,e.create,e.update,e.compare||function(t,e){return t===e},e);if(e.provide)r.provides=e.provide(r);return r};t.prototype.create=function(t){var e=this;var r=t.facet(et).find((function(t){return t.field==e}));return((r===null||r===void 0?void 0:r.create)||this.createF)(t)};t.prototype.slot=function(t){var e=this;var r=t[this.id]>>1;return{create:function(t){t.values[r]=e.create(t);return 1},update:function(t,n){var i=t.values[r];var o=e.updateF(i,n);if(e.compareF(i,o))return 0;t.values[r]=o;return 1},reconfigure:function(t,n){if(n.config.address[e.id]!=null){t.values[r]=n.field(e);return 0}t.values[r]=e.create(t);return 1}}};t.prototype.init=function(t){return[this,et.of({field:this,create:t})]};Object.defineProperty(t.prototype,"extension",{get:function(){return this},enumerable:false,configurable:true});return t}();var nt={lowest:4,low:3,default:2,high:1,highest:0};function it(t){return function(e){return new at(e,t)}}var ot=t("x",{lowest:it(nt.lowest),low:it(nt.low),default:it(nt.default),high:it(nt.high),highest:it(nt.highest),fallback:it(nt.lowest),extend:it(nt.high),override:it(nt.highest)});var at=function(){function t(t,e){this.inner=t;this.prec=e}return t}();var st=function(){function t(){}t.prototype.of=function(t){return new ft(this,t)};t.prototype.reconfigure=function(e){return t.reconfigure.of({compartment:this,extension:e})};t.prototype.get=function(t){return t.config.compartments.get(this)};return t}();var ft=function(){function t(t,e){this.compartment=t;this.inner=e}return t}();var ut=function(){function t(t,e,r,n,i,o){this.base=t;this.compartments=e;this.dynamicSlots=r;this.address=n;this.staticValues=i;this.facets=o;this.statusTemplate=[];while(this.statusTemplate.length<r.length)this.statusTemplate.push(0)}t.prototype.staticFacet=function(t){var e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]};t.resolve=function(e,r,n){var i=[];var o=Object.create(null);var a=new Map;for(var s=0,f=lt(e,r,a);s<f.length;s++){var u=f[s];if(u instanceof rt)i.push(u);else(o[u.facet.id]||(o[u.facet.id]=[])).push(u)}var l=Object.create(null);var c=[];var h=[];var p=function(t){l[t.id]=h.length<<1;h.push((function(e){return t.slot(e)}))};for(var d=0,v=i;d<v.length;d++){var g=v[d];p(g)}var m=n===null||n===void 0?void 0:n.config.facets;var y=function(t){var e=o[t],r=e[0].facet;var i=m&&m[t]||[];if(e.every((function(t){return t.type==0}))){l[r.id]=c.length<<1|1;if(X(i,e)){c.push(n.facet(r))}else{var a=r.combine(e.map((function(t){return t.value})));c.push(n&&r.compare(a,n.facet(r))?n.facet(r):a)}}else{var s=function(t){if(t.type==0){l[t.id]=c.length<<1|1;c.push(t.value)}else{l[t.id]=h.length<<1;h.push((function(e){return t.dynamicSlot(e)}))}};for(var f=0,u=e;f<u.length;f++){var p=u[f];s(p)}l[r.id]=h.length<<1;h.push((function(t){return tt(t,r,e)}))}};for(var b in o){y(b)}var w=h.map((function(t){return t(l)}));return new t(e,a,w,l,c,o)};return t}();function lt(t,e,r){var n=[[],[],[],[],[]];var i=new Map;function o(t,a){var s=i.get(t);if(s!=null){if(s>=a)return;var f=n[s].indexOf(t);if(f>-1)n[s].splice(f,1);if(t instanceof ft)r.delete(t.compartment)}i.set(t,a);if(Array.isArray(t)){for(var u=0,l=t;u<l.length;u++){var c=l[u];o(c,a)}}else if(t instanceof ft){if(r.has(t.compartment))throw new RangeError("Duplicate use of compartment in extensions");var h=e.get(t.compartment)||t.inner;r.set(t.compartment,h);o(h,a)}else if(t instanceof at){o(t.inner,t.prec)}else if(t instanceof rt){n[a].push(t);if(t.provides)o(t.provides,a)}else if(t instanceof Q){n[a].push(t);if(t.facet.extensions)o(t.facet.extensions,a)}else{var p=t.extension;if(!p)throw new Error("Unrecognized extension value in extension set (".concat(t,"). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks."));o(p,a)}}o(t,nt.default);return n.reduce((function(t,e){return t.concat(e)}))}function ct(t,e){if(e&1)return 2;var r=e>>1;var n=t.status[r];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;t.status[r]=4;var i=t.computeSlot(t,t.config.dynamicSlots[r]);return t.status[r]=2|i}function ht(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}var pt=Y.define();var dt=Y.define({combine:function(t){return t.some((function(t){return t}))},static:true});var vt=Y.define({combine:function(t){return t.length?t[0]:undefined},static:true});var gt=Y.define();var mt=Y.define();var yt=Y.define();var bt=Y.define({combine:function(t){return t.length?t[0]:false}});var wt=function(){function t(t,e){this.type=t;this.value=e}t.define=function(){return new xt};return t}();var xt=function(){function t(){}t.prototype.of=function(t){return new wt(this,t)};return t}();var kt=function(){function t(t){this.map=t}t.prototype.of=function(t){return new St(this,t)};return t}();var St=function(){function t(t,e){this.type=t;this.value=e}t.prototype.map=function(e){var r=this.type.map(this.value,e);return r===undefined?undefined:r==this.value?this:new t(this.type,r)};t.prototype.is=function(t){return this.type==t};t.define=function(t){if(t===void 0){t={}}return new kt(t.map||function(t){return t})};t.mapEffects=function(t,e){if(!t.length)return t;var r=[];for(var n=0,i=t;n<i.length;n++){var o=i[n];var a=o.map(e);if(a)r.push(a)}return r};return t}();St.reconfigure=St.define();St.appendConfig=St.define();var Ct=function(){function t(e,r,n,i,o,a){this.startState=e;this.changes=r;this.selection=n;this.effects=i;this.annotations=o;this.scrollIntoView=a;this._doc=null;this._state=null;if(n)J(n,r.newLength);if(!o.some((function(e){return e.type==t.time})))this.annotations=o.concat(t.time.of(Date.now()))}Object.defineProperty(t.prototype,"newDoc",{get:function(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"newSelection",{get:function(){return this.selection||this.startState.selection.map(this.changes)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"state",{get:function(){if(!this._state)this.startState.applyTransaction(this);return this._state},enumerable:false,configurable:true});t.prototype.annotation=function(t){for(var e=0,r=this.annotations;e<r.length;e++){var n=r[e];if(n.type==t)return n.value}return undefined};Object.defineProperty(t.prototype,"docChanged",{get:function(){return!this.changes.empty},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"reconfigured",{get:function(){return this.startState.config!=this.state.config},enumerable:false,configurable:true});t.prototype.isUserEvent=function(e){var r=this.annotation(t.userEvent);return!!(r&&(r==e||r.length>e.length&&r.slice(0,e.length)==e&&r[e.length]=="."))};return t}();Ct.time=wt.define();Ct.userEvent=wt.define();Ct.addToHistory=wt.define();Ct.remote=wt.define();function At(t,e){var r=[];for(var n=0,i=0;;){var o=void 0,a=void 0;if(n<t.length&&(i==e.length||e[i]>=t[n])){o=t[n++];a=t[n++]}else if(i<e.length){o=e[i++];a=e[i++]}else return r;if(!r.length||r[r.length-1]<o)r.push(o,a);else if(r[r.length-1]<a)r[r.length-1]=a}}function Ot(t,e,r){var n;var i,o,a;if(r){i=e.changes;o=_.empty(e.changes.length);a=t.changes.compose(e.changes)}else{i=e.changes.map(t.changes);o=t.changes.mapDesc(e.changes,true);a=t.changes.compose(i)}return{changes:a,selection:e.selection?e.selection.map(o):(n=t.selection)===null||n===void 0?void 0:n.map(i),effects:St.mapEffects(t.effects,i).concat(St.mapEffects(e.effects,o)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function Mt(t,e,r){var n=e.selection,i=Rt(e.annotations);if(e.userEvent)i=i.concat(Ct.userEvent.of(e.userEvent));return{changes:e.changes instanceof _?e.changes:_.of(e.changes||[],r,t.facet(vt)),selection:n&&(n instanceof G?n:G.single(n.anchor,n.head)),effects:Rt(e.effects),annotations:i,scrollIntoView:!!e.scrollIntoView}}function Dt(t,e,r){var n=Mt(t,e.length?e[0]:{},t.doc.length);if(e.length&&e[0].filter===false)r=false;for(var i=1;i<e.length;i++){if(e[i].filter===false)r=false;var o=!!e[i].sequential;n=Ot(n,Mt(t,e[i],o?n.changes.newLength:t.doc.length),o)}var a=new Ct(t,n.changes,n.selection,n.effects,n.annotations,n.scrollIntoView);return Tt(r?Pt(a):a)}function Pt(t){var e=t.startState;var r=true;for(var n=0,i=e.facet(gt);n<i.length;n++){var o=i[n];var a=o(t);if(a===false){r=false;break}if(Array.isArray(a))r=r===true?a:At(r,a)}if(r!==true){var s=void 0,f=void 0;if(r===false){f=t.changes.invertedDesc;s=_.empty(e.doc.length)}else{var u=t.changes.filter(r);s=u.changes;f=u.filtered.invertedDesc}t=new Ct(e,s,t.selection&&t.selection.map(f),St.mapEffects(t.effects,f),t.annotations,t.scrollIntoView)}var l=e.facet(mt);for(var c=l.length-1;c>=0;c--){var u=l[c](t);if(u instanceof Ct)t=u;else if(Array.isArray(u)&&u.length==1&&u[0]instanceof Ct)t=u[0];else t=Dt(e,Rt(u),false)}return t}function Tt(t){var e=t.startState,r=e.facet(yt),n=t;for(var i=r.length-1;i>=0;i--){var o=r[i](t);if(o&&Object.keys(o).length)n=Ot(t,Mt(e,o,t.changes.newLength),true)}return n==t?t:new Ct(e,t.changes,t.selection,n.effects,n.annotations,n.scrollIntoView)}var Et=[];function Rt(t){return t==null?Et:Array.isArray(t)?t:[t]}var Lt=function(t){t[t["Word"]=0]="Word";t[t["Space"]=1]="Space";t[t["Other"]=2]="Other";return t}(Lt||(Lt={}));var Bt=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;var It;try{It=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch(bv){}function Nt(t){if(It)return It.test(t);for(var e=0;e<t.length;e++){var r=t[e];if(/\w/.test(r)||r>""&&(r.toUpperCase()!=r.toLowerCase()||Bt.test(r)))return true}return false}function jt(t){return function(e){if(!/\S/.test(e))return Lt.Space;if(Nt(e))return Lt.Word;for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return Lt.Word;return Lt.Other}}var _t=function(){function t(t,e,r,n,i,o){this.config=t;this.doc=e;this.selection=r;this.values=n;this.status=t.statusTemplate.slice();this.computeSlot=i;if(o)o._state=this;for(var a=0;a<this.config.dynamicSlots.length;a++)ct(this,a<<1);this.computeSlot=null}t.prototype.field=function(t,e){if(e===void 0){e=true}var r=this.config.address[t.id];if(r==null){if(e)throw new RangeError("Field is not present in this state");return undefined}ct(this,r);return ht(this,r)};t.prototype.update=function(){var t=[];for(var e=0;e<arguments.length;e++){t[e]=arguments[e]}return Dt(this,t,true)};t.prototype.applyTransaction=function(e){var r=this;var n=this.config,i=n.base,o=n.compartments;for(var a=0,s=e.effects;a<s.length;a++){var f=s[a];if(f.is(st.reconfigure)){if(n){o=new Map;n.compartments.forEach((function(t,e){return o.set(e,t)}));n=null}o.set(f.value.compartment,f.value.extension)}else if(f.is(St.reconfigure)){n=null;i=f.value}else if(f.is(St.appendConfig)){n=null;i=Rt(i).concat(f.value)}}var u;if(!n){n=ut.resolve(i,o,this);var l=new t(n,this.doc,this.selection,n.dynamicSlots.map((function(){return null})),(function(t,e){return e.reconfigure(t,r)}),null);u=l.values}else{u=e.startState.values.slice()}new t(n,e.newDoc,e.newSelection,u,(function(t,r){return r.update(t,e)}),e)};t.prototype.replaceSelection=function(t){if(typeof t=="string")t=this.toText(t);return this.changeByRange((function(e){return{changes:{from:e.from,to:e.to,insert:t},range:G.cursor(e.from+t.length)}}))};t.prototype.changeByRange=function(t){var e=this.selection;var r=t(e.ranges[0]);var n=this.changes(r.changes),i=[r.range];var o=Rt(r.effects);for(var a=1;a<e.ranges.length;a++){var s=t(e.ranges[a]);var f=this.changes(s.changes),u=f.map(n);for(var l=0;l<a;l++)i[l]=i[l].map(u);var c=n.mapDesc(f,true);i.push(s.range.map(c));n=n.compose(u);o=St.mapEffects(o,u).concat(St.mapEffects(Rt(s.effects),c))}return{changes:n,selection:G.create(i,e.mainIndex),effects:o}};t.prototype.changes=function(e){if(e===void 0){e=[]}if(e instanceof _)return e;return _.of(e,this.doc.length,this.facet(t.lineSeparator))};t.prototype.toText=function(e){return A.of(e.split(this.facet(t.lineSeparator)||I))};t.prototype.sliceDoc=function(t,e){if(t===void 0){t=0}if(e===void 0){e=this.doc.length}return this.doc.sliceString(t,e,this.lineBreak)};t.prototype.facet=function(t){var e=this.config.address[t.id];if(e==null)return t.default;ct(this,e);return ht(this,e)};t.prototype.toJSON=function(t){var e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(var r in t){var n=t[r];if(n instanceof rt)e[r]=n.spec.toJSON(this.field(t[r]),this)}return e};t.fromJSON=function(e,r,n){if(r===void 0){r={}}if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");var i=[];if(n){var o=function(t){var r=n[t],o=e[t];i.push(r.init((function(t){return r.spec.fromJSON(o,t)})))};for(var a in n){o(a)}}return t.create({doc:e.doc,selection:G.fromJSON(e.selection),extensions:r.extensions?i.concat([r.extensions]):i})};t.create=function(e){if(e===void 0){e={}}var r=ut.resolve(e.extensions||[],new Map);var n=e.doc instanceof A?e.doc:A.of((e.doc||"").split(r.staticFacet(t.lineSeparator)||I));var i=!e.selection?G.single(0):e.selection instanceof G?e.selection:G.single(e.selection.anchor,e.selection.head);J(i,n.length);if(!r.staticFacet(dt))i=i.asSingle();return new t(r,n,i,r.dynamicSlots.map((function(){return null})),(function(t,e){return e.create(t)}),null)};Object.defineProperty(t.prototype,"tabSize",{get:function(){return this.facet(t.tabSize)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"lineBreak",{get:function(){return this.facet(t.lineSeparator)||"\n"},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"readOnly",{get:function(){return this.facet(bt)},enumerable:false,configurable:true});t.prototype.phrase=function(e){for(var r=0,n=this.facet(t.phrases);r<n.length;r++){var i=n[r];if(Object.prototype.hasOwnProperty.call(i,e))return i[e]}return e};t.prototype.languageDataAt=function(t,e,r){if(r===void 0){r=-1}var n=[];for(var i=0,o=this.facet(pt);i<o.length;i++){var a=o[i];for(var s=0,f=a(this,e,r);s<f.length;s++){var u=f[s];if(Object.prototype.hasOwnProperty.call(u,t))n.push(u[t])}}return n};t.prototype.charCategorizer=function(t){return jt(this.languageDataAt("wordChars",t).join(""))};t.prototype.wordAt=function(t){var e=this.doc.lineAt(t),r=e.text,n=e.from,i=e.length;var o=this.charCategorizer(t);var a=t-n,s=t-n;while(a>0){var f=v(r,a,false);if(o(r.slice(f,a))!=Lt.Word)break;a=f}while(s<i){var u=v(r,s);if(o(r.slice(s,u))!=Lt.Word)break;s=u}return a==s?null:G.range(a+n,s+n)};return t}();_t.allowMultipleSelections=dt;_t.tabSize=Y.define({combine:function(t){return t.length?t[0]:4}});_t.lineSeparator=vt;_t.readOnly=bt;_t.phrases=Y.define();_t.languageData=pt;_t.changeFilter=gt;_t.transactionFilter=mt;_t.transactionExtender=yt;st.reconfigure=St.define();function Vt(t,e,r){if(r===void 0){r={}}var n={};for(var i=0,o=t;i<o.length;i++){var a=o[i];for(var s=0,f=Object.keys(a);s<f.length;s++){var u=f[s];var l=a[u],c=n[u];if(c===undefined)n[u]=l;else if(c===l||l===undefined);else if(Object.hasOwnProperty.call(r,u))n[u]=r[u](c,l);else throw new Error("Config merge conflict for field "+u)}}for(var u in e)if(n[u]===undefined)n[u]=e[u];return n}var Ht="ͼ";var Ft=typeof Symbol=="undefined"?"__"+Ht:Symbol.for(Ht);var zt=typeof Symbol=="undefined"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet");var Wt=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};var qt=function(){function t(t,e){this.rules=[];var r=(e||{}).finish;function n(t){return/^@/.test(t)?[t]:t.split(/,\s*/)}function i(t,e,o,a){var s=[],f=/^@(\w+)\b/.exec(t[0]),u=f&&f[1]=="keyframes";if(f&&e==null)return o.push(t[0]+";");for(var l in e){var c=e[l];if(/&/.test(l)){i(l.split(/,\s*/).map((function(e){return t.map((function(t){return e.replace(/&/,t)}))})).reduce((function(t,e){return t.concat(e)})),c,o)}else if(c&&typeof c=="object"){if(!f)throw new RangeError("The value of a property ("+l+") should be a primitive value.");i(n(l),c,s,u)}else if(c!=null){s.push(l.replace(/_.*/,"").replace(/[A-Z]/g,(function(t){return"-"+t.toLowerCase()}))+": "+c+";")}}if(s.length||u){o.push((r&&!f&&!a?t.map(r):t).join(", ")+" {"+s.join(" ")+"}")}}for(var o in t)i(n(o),t[o],this.rules)}t.prototype.getRules=function(){return this.rules.join("\n")};t.newName=function(){var t=Wt[Ft]||1;Wt[Ft]=t+1;return Ht+t.toString(36)};t.mount=function(t,e){(t[zt]||new Gt(t)).mount(Array.isArray(e)?e:[e])};return t}();var Ut=null;var Gt=function(){function t(t){if(!t.head&&t.adoptedStyleSheets&&typeof CSSStyleSheet!="undefined"){if(Ut){t.adoptedStyleSheets=[Ut.sheet].concat(t.adoptedStyleSheets);return t[zt]=Ut}this.sheet=new CSSStyleSheet;t.adoptedStyleSheets=[this.sheet].concat(t.adoptedStyleSheets);Ut=this}else{this.styleTag=(t.ownerDocument||t).createElement("style");var e=t.head||t;e.insertBefore(this.styleTag,e.firstChild)}this.modules=[];t[zt]=this}t.prototype.mount=function(t){var e=this.sheet;var r=0,n=0;for(var i=0;i<t.length;i++){var o=t[i],a=this.modules.indexOf(o);if(a<n&&a>-1){this.modules.splice(a,1);n--;a=-1}if(a==-1){this.modules.splice(n++,0,o);if(e)for(var s=0;s<o.rules.length;s++)e.insertRule(o.rules[s],r++)}else{while(n<a)r+=this.modules[n++].rules.length;r+=o.rules.length;n++}}if(!e){var f="";for(var u=0;u<this.modules.length;u++)f+=this.modules[u].getRules()+"\n";this.styleTag.textContent=f}};return t}();var Kt=function(){function t(){}t.prototype.eq=function(t){return this==t};t.prototype.range=function(t,e){if(e===void 0){e=t}return new Jt(t,e,this)};return t}();Kt.prototype.startSide=Kt.prototype.endSide=0;Kt.prototype.point=false;Kt.prototype.mapMode=N.TrackDel;var Jt=function(){function t(t,e,r){this.from=t;this.to=e;this.value=r}return t}();function $t(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}var Yt=function(){function t(t,e,r,n){this.from=t;this.to=e;this.value=r;this.maxPoint=n}Object.defineProperty(t.prototype,"length",{get:function(){return this.to[this.to.length-1]},enumerable:false,configurable:true});t.prototype.findIndex=function(t,e,r,n){if(n===void 0){n=0}var i=r?this.to:this.from;for(var o=n,a=i.length;;){if(o==a)return o;var s=o+a>>1;var f=i[s]-t||(r?this.value[s].endSide:this.value[s].startSide)-e;if(s==o)return f>=0?o:a;if(f>=0)a=s;else o=s+1}};t.prototype.between=function(t,e,r,n){for(var i=this.findIndex(e,-1e9,true),o=this.findIndex(r,1e9,false,i);i<o;i++)if(n(this.from[i]+t,this.to[i]+t,this.value[i])===false)return false};t.prototype.map=function(e,r){var n=[],i=[],o=[],a=-1,s=-1;for(var f=0;f<this.value.length;f++){var u=this.value[f],l=this.from[f]+e,c=this.to[f]+e,h=void 0,p=void 0;if(l==c){var d=r.mapPos(l,u.startSide,u.mapMode);if(d==null)continue;h=p=d;if(u.startSide!=u.endSide){p=r.mapPos(l,u.endSide);if(p<h)continue}}else{h=r.mapPos(l,u.startSide);p=r.mapPos(c,u.endSide);if(h>p||h==p&&u.startSide>0&&u.endSide<=0)continue}if((p-h||u.endSide-u.startSide)<0)continue;if(a<0)a=h;if(u.point)s=Math.max(s,p-h);n.push(u);i.push(h-a);o.push(p-a)}return{mapped:n.length?new t(i,o,n,s):null,pos:a}};return t}();var Xt=function(){function t(e,r,n,i){if(n===void 0){n=t.empty}this.chunkPos=e;this.chunk=r;this.nextLayer=n;this.maxPoint=i}Object.defineProperty(t.prototype,"length",{get:function(){var t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){if(this.isEmpty)return 0;var t=this.nextLayer.size;for(var e=0,r=this.chunk;e<r.length;e++){var n=r[e];t+=n.value.length}return t},enumerable:false,configurable:true});t.prototype.chunkEnd=function(t){return this.chunkPos[t]+this.chunk[t].length};t.prototype.update=function(e){var r=e.add,n=r===void 0?[]:r,i=e.sort,o=i===void 0?false:i,a=e.filterFrom,s=a===void 0?0:a,f=e.filterTo,u=f===void 0?this.length:f;var l=e.filter;if(n.length==0&&!l)return this;if(o)n=n.slice().sort($t);if(this.isEmpty)return n.length?t.of(n):this;var c=new ee(this,null,-1).goto(0),h=0,p=[];var d=new Zt;while(c.value||h<n.length){if(h<n.length&&(c.from-n[h].from||c.startSide-n[h].value.startSide)>=0){var v=n[h++];if(!d.addInner(v.from,v.to,v.value))p.push(v)}else if(c.rangeIndex==1&&c.chunkIndex<this.chunk.length&&(h==n.length||this.chunkEnd(c.chunkIndex)<n[h].from)&&(!l||s>this.chunkEnd(c.chunkIndex)||u<this.chunkPos[c.chunkIndex])&&d.addChunk(this.chunkPos[c.chunkIndex],this.chunk[c.chunkIndex])){c.nextChunk()}else{if(!l||s>c.to||u<c.from||l(c.from,c.to,c.value)){if(!d.addInner(c.from,c.to,c.value))p.push(new Jt(c.from,c.to,c.value))}c.next()}}return d.finishInner(this.nextLayer.isEmpty&&!p.length?t.empty:this.nextLayer.update({add:p,filter:l,filterFrom:s,filterTo:u}))};t.prototype.map=function(e){if(e.empty||this.isEmpty)return this;var r=[],n=[],i=-1;for(var o=0;o<this.chunk.length;o++){var a=this.chunkPos[o],s=this.chunk[o];var f=e.touchesRange(a,a+s.length);if(f===false){i=Math.max(i,s.maxPoint);r.push(s);n.push(e.mapPos(a))}else if(f===true){var u=s.map(a,e),l=u.mapped,c=u.pos;if(l){i=Math.max(i,l.maxPoint);r.push(l);n.push(c)}}}var h=this.nextLayer.map(e);return r.length==0?h:new t(n,r,h,i)};t.prototype.between=function(t,e,r){if(this.isEmpty)return;for(var n=0;n<this.chunk.length;n++){var i=this.chunkPos[n],o=this.chunk[n];if(e>=i&&t<=i+o.length&&o.between(i,t-i,e-i,r)===false)return}this.nextLayer.between(t,e,r)};t.prototype.iter=function(t){if(t===void 0){t=0}return re.from([this]).goto(t)};Object.defineProperty(t.prototype,"isEmpty",{get:function(){return this.nextLayer==this},enumerable:false,configurable:true});t.iter=function(t,e){if(e===void 0){e=0}return re.from(t).goto(e)};t.compare=function(t,e,r,n,i){if(i===void 0){i=-1}var o=t.filter((function(t){return t.maxPoint>0||!t.isEmpty&&t.maxPoint>=i}));var a=e.filter((function(t){return t.maxPoint>0||!t.isEmpty&&t.maxPoint>=i}));var s=te(o,a,r);var f=new ie(o,s,i);var u=new ie(a,s,i);r.iterGaps((function(t,e,r){return oe(f,t,u,e,r,n)}));if(r.empty&&r.length==0)oe(f,0,u,0,0,n)};t.eq=function(t,e,r,n){if(r===void 0){r=0}if(n==null)n=1e9;var i=t.filter((function(t){return!t.isEmpty&&e.indexOf(t)<0}));var o=e.filter((function(e){return!e.isEmpty&&t.indexOf(e)<0}));if(i.length!=o.length)return false;if(!i.length)return true;var a=te(i,o);var s=new ie(i,a,0).goto(r),f=new ie(o,a,0).goto(r);for(;;){if(s.to!=f.to||!ae(s.active,f.active)||s.point&&(!f.point||!s.point.eq(f.point)))return false;if(s.to>n)return true;s.next();f.next()}};t.spans=function(t,e,r,n,i){if(i===void 0){i=-1}var o;var a=new ie(t,null,i,(o=n.filterPoint)===null||o===void 0?void 0:o.bind(n)).goto(e),s=e;var f=a.openStart;for(;;){var u=Math.min(a.to,r);if(a.point){n.point(s,u,a.point,a.activeForPoint(a.to),f);f=a.openEnd(u)+(a.to>u?1:0)}else if(u>s){n.span(s,u,a.active,f);f=a.openEnd(u)}if(a.to>r)break;s=a.to;a.next()}return f};t.of=function(t,e){if(e===void 0){e=false}var r=new Zt;for(var n=0,i=t instanceof Jt?[t]:e?Qt(t):t;n<i.length;n++){var o=i[n];r.add(o.from,o.to,o.value)}return r.finish()};return t}();Xt.empty=new Xt([],[],null,-1);function Qt(t){if(t.length>1)for(var e=t[0],r=1;r<t.length;r++){var n=t[r];if($t(e,n)>0)return t.slice().sort($t);e=n}return t}Xt.empty.nextLayer=Xt.empty;var Zt=function(){function t(){this.chunks=[];this.chunkPos=[];this.chunkStart=-1;this.last=null;this.lastFrom=-1e9;this.lastTo=-1e9;this.from=[];this.to=[];this.value=[];this.maxPoint=-1;this.setMaxPoint=-1;this.nextLayer=null}t.prototype.finishChunk=function(t){this.chunks.push(new Yt(this.from,this.to,this.value,this.maxPoint));this.chunkPos.push(this.chunkStart);this.chunkStart=-1;this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint);this.maxPoint=-1;if(t){this.from=[];this.to=[];this.value=[]}};t.prototype.add=function(e,r,n){if(!this.addInner(e,r,n))(this.nextLayer||(this.nextLayer=new t)).add(e,r,n)};t.prototype.addInner=function(t,e,r){var n=t-this.lastTo||r.startSide-this.last.endSide;if(n<=0&&(t-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");if(n<0)return false;if(this.from.length==250)this.finishChunk(true);if(this.chunkStart<0)this.chunkStart=t;this.from.push(t-this.chunkStart);this.to.push(e-this.chunkStart);this.last=r;this.lastFrom=t;this.lastTo=e;this.value.push(r);if(r.point)this.maxPoint=Math.max(this.maxPoint,e-t);return true};t.prototype.addChunk=function(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return false;if(this.from.length)this.finishChunk(true);this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint);this.chunks.push(e);this.chunkPos.push(t);var r=e.value.length-1;this.last=e.value[r];this.lastFrom=e.from[r]+t;this.lastTo=e.to[r]+t;return true};t.prototype.finish=function(){return this.finishInner(Xt.empty)};t.prototype.finishInner=function(t){if(this.from.length)this.finishChunk(false);if(this.chunks.length==0)return t;var e=new Xt(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);this.from=null;return e};return t}();function te(t,e,r){var n=new Map;for(var i=0,o=t;i<o.length;i++){var a=o[i];for(var s=0;s<a.chunk.length;s++)if(a.chunk[s].maxPoint<=0)n.set(a.chunk[s],a.chunkPos[s])}var f=new Set;for(var u=0,l=e;u<l.length;u++){var a=l[u];for(var c=0;c<a.chunk.length;c++){var h=n.get(a.chunk[c]);if(h!=null&&(r?r.mapPos(h):h)==a.chunkPos[c]&&!(r===null||r===void 0?void 0:r.touchesRange(h,h+a.chunk[c].length)))f.add(a.chunk[c])}}return f}var ee=function(){function t(t,e,r,n){if(n===void 0){n=0}this.layer=t;this.skip=e;this.minPoint=r;this.rank=n}Object.defineProperty(t.prototype,"startSide",{get:function(){return this.value?this.value.startSide:0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"endSide",{get:function(){return this.value?this.value.endSide:0},enumerable:false,configurable:true});t.prototype.goto=function(t,e){if(e===void 0){e=-1e9}this.chunkIndex=this.rangeIndex=0;this.gotoInner(t,e,false);return this};t.prototype.gotoInner=function(t,e,r){while(this.chunkIndex<this.layer.chunk.length){var n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<t||n.maxPoint<this.minPoint))break;this.chunkIndex++;r=false}if(this.chunkIndex<this.layer.chunk.length){var i=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,true);if(!r||this.rangeIndex<i)this.setRangeIndex(i)}this.next()};t.prototype.forward=function(t,e){if((this.to-t||this.endSide-e)<0)this.gotoInner(t,e,true)};t.prototype.next=function(){for(;;){if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9;this.value=null;break}else{var t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex];var r=t+e.from[this.rangeIndex];this.from=r;this.to=t+e.to[this.rangeIndex];this.value=e.value[this.rangeIndex];this.setRangeIndex(this.rangeIndex+1);if(this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}};t.prototype.setRangeIndex=function(t){if(t==this.layer.chunk[this.chunkIndex].value.length){this.chunkIndex++;if(this.skip){while(this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]))this.chunkIndex++}this.rangeIndex=0}else{this.rangeIndex=t}};t.prototype.nextChunk=function(){this.chunkIndex++;this.rangeIndex=0;this.next()};t.prototype.compare=function(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide};return t}();var re=function(){function t(t){this.heap=t}t.from=function(e,r,n){if(r===void 0){r=null}if(n===void 0){n=-1}var i=[];for(var o=0;o<e.length;o++){for(var a=e[o];!a.isEmpty;a=a.nextLayer){if(a.maxPoint>=n)i.push(new ee(a,r,n,o))}}return i.length==1?i[0]:new t(i)};Object.defineProperty(t.prototype,"startSide",{get:function(){return this.value?this.value.startSide:0},enumerable:false,configurable:true});t.prototype.goto=function(t,e){if(e===void 0){e=-1e9}for(var r=0,n=this.heap;r<n.length;r++){var i=n[r];i.goto(t,e)}for(var o=this.heap.length>>1;o>=0;o--)ne(this.heap,o);this.next();return this};t.prototype.forward=function(t,e){for(var r=0,n=this.heap;r<n.length;r++){var i=n[r];i.forward(t,e)}for(var o=this.heap.length>>1;o>=0;o--)ne(this.heap,o);if((this.to-t||this.value.endSide-e)<0)this.next()};t.prototype.next=function(){if(this.heap.length==0){this.from=this.to=1e9;this.value=null;this.rank=-1}else{var t=this.heap[0];this.from=t.from;this.to=t.to;this.value=t.value;this.rank=t.rank;if(t.value)t.next();ne(this.heap,0)}};return t}();function ne(t,e){for(var r=t[e];;){var n=(e<<1)+1;if(n>=t.length)break;var i=t[n];if(n+1<t.length&&i.compare(t[n+1])>=0){i=t[n+1];n++}if(r.compare(i)<0)break;t[n]=r;t[e]=i;e=n}}var ie=function(){function t(t,e,r,n){if(n===void 0){n=function(){return true}}this.minPoint=r;this.filterPoint=n;this.active=[];this.activeTo=[];this.activeRank=[];this.minActive=-1;this.point=null;this.pointFrom=0;this.pointRank=0;this.to=-1e9;this.endSide=0;this.openStart=-1;this.cursor=re.from(t,e,r)}t.prototype.goto=function(t,e){if(e===void 0){e=-1e9}this.cursor.goto(t,e);this.active.length=this.activeTo.length=this.activeRank.length=0;this.minActive=-1;this.to=t;this.endSide=e;this.openStart=-1;this.next();return this};t.prototype.forward=function(t,e){while(this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0)this.removeActive(this.minActive);this.cursor.forward(t,e)};t.prototype.removeActive=function(t){se(this.active,t);se(this.activeTo,t);se(this.activeRank,t);this.minActive=ue(this.active,this.activeTo)};t.prototype.addActive=function(t){var e=0,r=this.cursor,n=r.value,i=r.to,o=r.rank;while(e<this.activeRank.length&&this.activeRank[e]<=o)e++;fe(this.active,e,n);fe(this.activeTo,e,i);fe(this.activeRank,e,o);if(t)fe(t,e,this.cursor.from);this.minActive=ue(this.active,this.activeTo)};t.prototype.next=function(){var t=this.to,e=this.point;this.point=null;var r=this.openStart<0?[]:null,n=0;for(;;){var i=this.minActive;if(i>-1&&(this.activeTo[i]-this.cursor.from||this.active[i].endSide-this.cursor.startSide)<0){if(this.activeTo[i]>t){this.to=this.activeTo[i];this.endSide=this.active[i].endSide;break}this.removeActive(i);if(r)se(r,i)}else if(!this.cursor.value){this.to=this.endSide=1e9;break}else if(this.cursor.from>t){this.to=this.cursor.from;this.endSide=this.cursor.startSide;break}else{var o=this.cursor.value;if(!o.point){this.addActive(r);this.cursor.next()}else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to){this.cursor.next()}else if(!this.filterPoint(this.cursor.from,this.cursor.to,this.cursor.value,this.cursor.rank)){this.cursor.next()}else{this.point=o;this.pointFrom=this.cursor.from;this.pointRank=this.cursor.rank;this.to=this.cursor.to;this.endSide=o.endSide;if(this.cursor.from<t)n=1;this.cursor.next();this.forward(this.to,this.endSide);break}}}if(r){var a=0;while(a<r.length&&r[a]<t)a++;this.openStart=a+n}};t.prototype.activeForPoint=function(t){if(!this.active.length)return this.active;var e=[];for(var r=this.active.length-1;r>=0;r--){if(this.activeRank[r]<this.pointRank)break;if(this.activeTo[r]>t||this.activeTo[r]==t&&this.active[r].endSide>=this.point.endSide)e.push(this.active[r])}return e.reverse()};t.prototype.openEnd=function(t){var e=0;for(var r=this.activeTo.length-1;r>=0&&this.activeTo[r]>t;r--)e++;return e};return t}();function oe(t,e,r,n,i,o){t.goto(e);r.goto(n);var a=n+i;var s=n,f=n-e;for(;;){var u=t.to+f-r.to||t.endSide-r.endSide;var l=u<0?t.to+f:r.to,c=Math.min(l,a);if(t.point||r.point){if(!(t.point&&r.point&&(t.point==r.point||t.point.eq(r.point))&&ae(t.activeForPoint(t.to+f),r.activeForPoint(r.to))))o.comparePoint(s,c,t.point,r.point)}else{if(c>s&&!ae(t.active,r.active))o.compareRange(s,c,t.active,r.active)}if(l>a)break;s=l;if(u<=0)t.next();if(u>=0)r.next()}}function ae(t,e){if(t.length!=e.length)return false;for(var r=0;r<t.length;r++)if(t[r]!=e[r]&&!t[r].eq(e[r]))return false;return true}function se(t,e){for(var r=e,n=t.length-1;r<n;r++)t[r]=t[r+1];t.pop()}function fe(t,e,r){for(var n=t.length-1;n>=e;n--)t[n+1]=t[n];t[e]=r}function ue(t,e){var r=-1,n=1e9;for(var i=0;i<e.length;i++)if((e[i]-n||t[i].endSide-t[r].endSide)<0){r=i;n=e[i]}return r}var le={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"};var ce={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"};var he=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent);var pe=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor);var de=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent);var ve=typeof navigator!="undefined"&&/Mac/.test(navigator.platform);var ge=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);var me=he&&(ve||+he[1]<57)||de&&ve;for(var ye=0;ye<10;ye++)le[48+ye]=le[96+ye]=String(ye);for(var ye=1;ye<=24;ye++)le[ye+111]="F"+ye;for(var ye=65;ye<=90;ye++){le[ye]=String.fromCharCode(ye+32);ce[ye]=String.fromCharCode(ye)}for(var be in le)if(!ce.hasOwnProperty(be))ce[be]=le[be];function we(t){var e=me&&(t.ctrlKey||t.altKey||t.metaKey)||(pe||ge)&&t.shiftKey&&t.key&&t.key.length==1;var r=!e&&t.key||(t.shiftKey?ce:le)[t.keyCode]||t.key||"Unidentified";if(r=="Esc")r="Escape";if(r=="Del")r="Delete";if(r=="Left")r="ArrowLeft";if(r=="Up")r="ArrowUp";if(r=="Right")r="ArrowRight";if(r=="Down")r="ArrowDown";return r}function xe(t){var e;if(t.nodeType==11){e=t.getSelection?t:t.ownerDocument}else{e=t}return e.getSelection()}function ke(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):false}function Se(){var t=document.activeElement;while(t&&t.shadowRoot)t=t.shadowRoot.activeElement;return t}function Ce(t,e){if(!e.anchorNode)return false;try{return ke(t,e.anchorNode)}catch(bv){return false}}function Ae(t){if(t.nodeType==3)return _e(t,0,t.nodeValue.length).getClientRects();else if(t.nodeType==1)return t.getClientRects();else return[]}function Oe(t,e,r,n){return r?De(t,e,r,n,-1)||De(t,e,r,n,1):false}function Me(t){for(var e=0;;e++){t=t.previousSibling;if(!t)return e}}function De(t,e,r,n,i){for(;;){if(t==r&&e==n)return true;if(e==(i<0?0:Pe(t))){if(t.nodeName=="DIV")return false;var o=t.parentNode;if(!o||o.nodeType!=1)return false;e=Me(t)+(i<0?0:1);t=o}else if(t.nodeType==1){t=t.childNodes[e+(i<0?-1:0)];if(t.nodeType==1&&t.contentEditable=="false")return false;e=i<0?Pe(t):0}else{return false}}}function Pe(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}var Te={left:0,right:0,top:0,bottom:0};function Ee(t,e){var r=e?t.left:t.right;return{left:r,right:r,top:t.top,bottom:t.bottom}}function Re(t){return{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function Le(t,e,r,n,i,o,a,s){var f=t.ownerDocument,u=f.defaultView;for(var l=t;l;){if(l.nodeType==1){var c=void 0,h=l==f.body;if(h){c=Re(u)}else{if(l.scrollHeight<=l.clientHeight&&l.scrollWidth<=l.clientWidth){l=l.parentNode;continue}var p=l.getBoundingClientRect();c={left:p.left,right:p.left+l.clientWidth,top:p.top,bottom:p.top+l.clientHeight}}var d=0,v=0;if(i=="nearest"){if(e.top<c.top){v=-(c.top-e.top+a);if(r>0&&e.bottom>c.bottom+v)v=e.bottom-c.bottom+v+a}else if(e.bottom>c.bottom){v=e.bottom-c.bottom+a;if(r<0&&e.top-v<c.top)v=-(c.top+v-e.top+a)}}else{var g=e.bottom-e.top,m=c.bottom-c.top;var y=i=="center"&&g<=m?e.top+g/2-m/2:i=="start"||i=="center"&&r<0?e.top-a:e.bottom-m+a;v=y-c.top}if(n=="nearest"){if(e.left<c.left){d=-(c.left-e.left+o);if(r>0&&e.right>c.right+d)d=e.right-c.right+d+o}else if(e.right>c.right){d=e.right-c.right+o;if(r<0&&e.left<c.left+d)d=-(c.left+d-e.left+o)}}else{var b=n=="center"?e.left+(e.right-e.left)/2-(c.right-c.left)/2:n=="start"==s?e.left-o:e.right-(c.right-c.left)+o;d=b-c.left}if(d||v){if(h){u.scrollBy(d,v)}else{if(v){var w=l.scrollTop;l.scrollTop+=v;v=l.scrollTop-w}if(d){var w=l.scrollLeft;l.scrollLeft+=d;d=l.scrollLeft-w}e={left:e.left-d,top:e.top-v,right:e.right-d,bottom:e.bottom-v}}}if(h)break;l=l.assignedSlot||l.parentNode;n=i="nearest"}else if(l.nodeType==11){l=l.host}else{break}}}var Be=function(){function t(){this.anchorNode=null;this.anchorOffset=0;this.focusNode=null;this.focusOffset=0}t.prototype.eq=function(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset};t.prototype.setRange=function(t){this.set(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)};t.prototype.set=function(t,e,r,n){this.anchorNode=t;this.anchorOffset=e;this.focusNode=r;this.focusOffset=n};return t}();var Ie=null;function Ne(t){if(t.setActive)return t.setActive();if(Ie)return t.focus(Ie);var e=[];for(var r=t;r;r=r.parentNode){e.push(r,r.scrollTop,r.scrollLeft);if(r==r.ownerDocument)break}t.focus(Ie==null?{get preventScroll(){Ie={preventScroll:true};return true}}:undefined);if(!Ie){Ie=false;for(var n=0;n<e.length;){var i=e[n++],o=e[n++],a=e[n++];if(i.scrollTop!=o)i.scrollTop=o;if(i.scrollLeft!=a)i.scrollLeft=a}}}var je;function _e(t,e,r){if(r===void 0){r=e}var n=je||(je=document.createRange());n.setEnd(t,r);n.setStart(t,e);return n}function Ve(t,e,r){var n={key:e,code:e,keyCode:r,which:r,cancelable:true};var i=new KeyboardEvent("keydown",n);i.synthetic=true;t.dispatchEvent(i);var o=new KeyboardEvent("keyup",n);o.synthetic=true;t.dispatchEvent(o);return i.defaultPrevented||o.defaultPrevented}function He(t){while(t){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function Fe(t){while(t.attributes.length)t.removeAttributeNode(t.attributes[0])}var ze=function(){function t(t,e,r){if(r===void 0){r=true}this.node=t;this.offset=e;this.precise=r}t.before=function(e,r){return new t(e.parentNode,Me(e),r)};t.after=function(e,r){return new t(e.parentNode,Me(e)+1,r)};return t}();var We=[];var qe=function(){function t(){this.parent=null;this.dom=null;this.dirty=2}Object.defineProperty(t.prototype,"editorView",{get:function(){if(!this.parent)throw new Error("Accessing view in orphan content view");return this.parent.editorView},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"overrideDOMText",{get:function(){return null},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"posAtStart",{get:function(){return this.parent?this.parent.posBefore(this):0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"posAtEnd",{get:function(){return this.posAtStart+this.length},enumerable:false,configurable:true});t.prototype.posBefore=function(t){var e=this.posAtStart;for(var r=0,n=this.children;r<n.length;r++){var i=n[r];if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")};t.prototype.posAfter=function(t){return this.posBefore(t)+t.length};t.prototype.coordsAt=function(t,e){return null};t.prototype.sync=function(e){if(this.dirty&2){var r=this.dom;var n=null,i=void 0;for(var o=0,a=this.children;o<a.length;o++){var s=a[o];if(s.dirty){if(!s.dom&&(i=n?n.nextSibling:r.firstChild)){var f=t.get(i);if(!f||!f.parent&&f.constructor==s.constructor)s.reuseDOM(i)}s.sync(e);s.dirty=0}i=n?n.nextSibling:r.firstChild;if(e&&!e.written&&e.node==r&&i!=s.dom)e.written=true;if(s.dom.parentNode==r){while(i&&i!=s.dom)i=Ue(i)}else{r.insertBefore(s.dom,i)}n=s.dom}i=n?n.nextSibling:r.firstChild;if(i&&e&&e.node==r)e.written=true;while(i)i=Ue(i)}else if(this.dirty&1){for(var u=0,l=this.children;u<l.length;u++){var s=l[u];if(s.dirty){s.sync(e);s.dirty=0}}}};t.prototype.reuseDOM=function(t){};t.prototype.localPosFromDOM=function(e,r){var n;if(e==this.dom){n=this.dom.childNodes[r]}else{var i=Pe(e)==0?0:r==0?-1:1;for(;;){var o=e.parentNode;if(o==this.dom)break;if(i==0&&o.firstChild!=o.lastChild){if(e==o.firstChild)i=-1;else i=1}e=o}if(i<0)n=e;else n=e.nextSibling}if(n==this.dom.firstChild)return 0;while(n&&!t.get(n))n=n.nextSibling;if(!n)return this.length;for(var a=0,s=0;;a++){var f=this.children[a];if(f.dom==n)return s;s+=f.length+f.breakAfter}};t.prototype.domBoundsAround=function(t,e,r){if(r===void 0){r=0}var n=-1,i=-1,o=-1,a=-1;for(var s=0,f=r,u=r;s<this.children.length;s++){var l=this.children[s],c=f+l.length;if(f<t&&c>e)return l.domBoundsAround(t,e,f);if(c>=t&&n==-1){n=s;i=f}if(f>e&&l.dom.parentNode==this.dom){o=s;a=u;break}u=c;f=c+l.breakAfter}return{from:i,to:a<0?r+this.length:a,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}};t.prototype.markDirty=function(t){if(t===void 0){t=false}this.dirty|=2;this.markParentsDirty(t)};t.prototype.markParentsDirty=function(t){for(var e=this.parent;e;e=e.parent){if(t)e.dirty|=2;if(e.dirty&1)return;e.dirty|=1;t=false}};t.prototype.setParent=function(t){if(this.parent!=t){this.parent=t;if(this.dirty)this.markParentsDirty(true)}};t.prototype.setDOM=function(t){if(this.dom)this.dom.cmView=null;this.dom=t;t.cmView=this};Object.defineProperty(t.prototype,"rootView",{get:function(){for(var t=this;;){var e=t.parent;if(!e)return t;t=e}},enumerable:false,configurable:true});t.prototype.replaceChildren=function(t,e,r){var n;if(r===void 0){r=We}this.markDirty();for(var i=t;i<e;i++){var o=this.children[i];if(o.parent==this)o.destroy()}(n=this.children).splice.apply(n,__spreadArray([t,e-t],r,false));for(var a=0;a<r.length;a++)r[a].setParent(this)};t.prototype.ignoreMutation=function(t){return false};t.prototype.ignoreEvent=function(t){return false};t.prototype.childCursor=function(t){if(t===void 0){t=this.length}return new Ge(this.children,t,this.children.length)};t.prototype.childPos=function(t,e){if(e===void 0){e=1}return this.childCursor().findPos(t,e)};t.prototype.toString=function(){var t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")};t.get=function(t){return t.cmView};Object.defineProperty(t.prototype,"isEditable",{get:function(){return true},enumerable:false,configurable:true});t.prototype.merge=function(t,e,r,n,i,o){return false};t.prototype.become=function(t){return false};t.prototype.getSide=function(){return 0};t.prototype.destroy=function(){this.parent=null};return t}();qe.prototype.breakAfter=0;function Ue(t){var e=t.nextSibling;t.parentNode.removeChild(t);return e}var Ge=function(){function t(t,e,r){this.children=t;this.pos=e;this.i=r;this.off=0}t.prototype.findPos=function(t,e){if(e===void 0){e=1}for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter)){this.off=t-this.pos;return this}var r=this.children[--this.i];this.pos-=r.length+r.breakAfter}};return t}();function Ke(t,e,r,n,i,o,a,s,f){var u=t.children;var l=u.length?u[e]:null;var c=o.length?o[o.length-1]:null;var h=c?c.breakAfter:a;if(e==n&&l&&!a&&!h&&o.length<2&&l.merge(r,i,o.length?c:null,r==0,s,f))return;if(n<u.length){var p=u[n];if(p&&i<p.length){if(e==n){p=p.split(i);i=0}if(!h&&c&&p.merge(0,i,c,true,0,f)){o[o.length-1]=p}else{if(i)p.merge(0,i,null,false,0,f);o.push(p)}}else if(p===null||p===void 0?void 0:p.breakAfter){if(c)c.breakAfter=1;else a=1}n++}if(l){l.breakAfter=a;if(r>0){if(!a&&o.length&&l.merge(r,l.length,o[0],false,s,0)){l.breakAfter=o.shift().breakAfter}else if(r<l.length||l.children.length&&l.children[l.children.length-1].length==0){l.merge(r,l.length,null,false,s,0)}e++}}while(e<n&&o.length){if(u[n-1].become(o[o.length-1])){n--;o.pop();f=o.length?0:s}else if(u[e].become(o[0])){e++;o.shift();s=o.length?0:f}else{break}}if(!o.length&&e&&n<u.length&&!u[e-1].breakAfter&&u[n].merge(0,0,u[e-1],false,s,f))e--;if(e<n||o.length)t.replaceChildren(e,n,o)}function Je(t,e,r,n,i,o){var a=t.childCursor();var s=a.findPos(r,1),f=s.i,u=s.off;var l=a.findPos(e,-1),c=l.i,h=l.off;var p=e-r;for(var d=0,v=n;d<v.length;d++){var g=v[d];p+=g.length}t.length+=p;Ke(t,c,h,f,u,n,0,i,o)}var $e=typeof navigator!="undefined"?navigator:{userAgent:"",vendor:"",platform:""};var Ye=typeof document!="undefined"?document:{documentElement:{style:{}}};var Xe=/Edge\/(\d+)/.exec($e.userAgent);var Qe=/MSIE \d/.test($e.userAgent);var Ze=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec($e.userAgent);var tr=!!(Qe||Ze||Xe);var er=!tr&&/gecko\/(\d+)/i.test($e.userAgent);var rr=!tr&&/Chrome\/(\d+)/.exec($e.userAgent);var nr="webkitFontSmoothing"in Ye.documentElement.style;var ir=!tr&&/Apple Computer/.test($e.vendor);var or=ir&&(/Mobile\/\w+/.test($e.userAgent)||$e.maxTouchPoints>2);var ar={mac:or||/Mac/.test($e.platform),windows:/Win/.test($e.platform),linux:/Linux|X11/.test($e.platform),ie:tr,ie_version:Qe?Ye.documentMode||6:Ze?+Ze[1]:Xe?+Xe[1]:0,gecko:er,gecko_version:er?+(/Firefox\/(\d+)/.exec($e.userAgent)||[0,0])[1]:0,chrome:!!rr,chrome_version:rr?+rr[1]:0,ios:or,android:/Android\b/.test($e.userAgent),webkit:nr,safari:ir,webkit_version:nr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:Ye.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};var sr=256;var fr=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.text=e;return r}Object.defineProperty(e.prototype,"length",{get:function(){return this.text.length},enumerable:false,configurable:true});e.prototype.createDOM=function(t){this.setDOM(t||document.createTextNode(this.text))};e.prototype.sync=function(t){if(!this.dom)this.createDOM();if(this.dom.nodeValue!=this.text){if(t&&t.node==this.dom)t.written=true;this.dom.nodeValue=this.text}};e.prototype.reuseDOM=function(t){if(t.nodeType==3)this.createDOM(t)};e.prototype.merge=function(t,r,n){if(n&&(!(n instanceof e)||this.length-(r-t)+n.length>sr))return false;this.text=this.text.slice(0,t)+(n?n.text:"")+this.text.slice(r);this.markDirty();return true};e.prototype.split=function(t){var r=new e(this.text.slice(t));this.text=this.text.slice(0,t);this.markDirty();return r};e.prototype.localPosFromDOM=function(t,e){return t==this.dom?e:e?this.text.length:0};e.prototype.domAtPos=function(t){return new ze(this.dom,t)};e.prototype.domBoundsAround=function(t,e,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}};e.prototype.coordsAt=function(t,e){return lr(this.dom,t,e)};return e}(qe);var ur=function(t){__extends(e,t);function e(e,r,n){if(r===void 0){r=[]}if(n===void 0){n=0}var i=t.call(this)||this;i.mark=e;i.children=r;i.length=n;for(var o=0,a=r;o<a.length;o++){var s=a[o];s.setParent(i)}return i}e.prototype.setAttrs=function(t){Fe(t);if(this.mark.class)t.className=this.mark.class;if(this.mark.attrs)for(var e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t};e.prototype.reuseDOM=function(t){if(t.nodeName==this.mark.tagName.toUpperCase()){this.setDOM(t);this.dirty|=4|2}};e.prototype.sync=function(e){if(!this.dom)this.setDOM(this.setAttrs(document.createElement(this.mark.tagName)));else if(this.dirty&4)this.setAttrs(this.dom);t.prototype.sync.call(this,e)};e.prototype.merge=function(t,r,n,i,o,a){if(n&&(!(n instanceof e&&n.mark.eq(this.mark))||t&&o<=0||r<this.length&&a<=0))return false;Je(this,t,r,n?n.children:[],o-1,a-1);this.markDirty();return true};e.prototype.split=function(t){var r=[],n=0,i=-1,o=0;for(var a=0,s=this.children;a<s.length;a++){var f=s[a];var u=n+f.length;if(u>t)r.push(n<t?f.split(t-n):f);if(i<0&&n>=t)i=o;n=u;o++}var l=this.length-t;this.length=t;if(i>-1){this.children.length=i;this.markDirty()}return new e(this.mark,r,l)};e.prototype.domAtPos=function(t){return mr(this.dom,this.children,t)};e.prototype.coordsAt=function(t,e){return br(this,t,e)};return e}(qe);function lr(t,e,r){var n=t.nodeValue.length;if(e>n)e=n;var i=e,o=e,a=0;if(e==0&&r<0||e==n&&r>=0){if(!(ar.chrome||ar.gecko)){if(e){i--;a=1}else{o++;a=-1}}}else{if(r<0)i--;else o++}var s=_e(t,i,o).getClientRects();if(!s.length)return Te;var f=s[(a?a<0:r>=0)?0:s.length-1];if(ar.safari&&!a&&f.width==0)f=Array.prototype.find.call(s,(function(t){return t.width}))||f;return a?Ee(f,a<0):f||null}var cr=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this)||this;i.widget=e;i.length=r;i.side=n;i.prevWidget=null;return i}e.create=function(t,r,n){return new(t.customView||e)(t,r,n)};e.prototype.split=function(t){var r=e.create(this.widget,this.length-t,this.side);this.length-=t;return r};e.prototype.sync=function(){if(!this.dom||!this.widget.updateDOM(this.dom)){if(this.dom&&this.prevWidget)this.prevWidget.destroy(this.dom);this.prevWidget=null;this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false"}};e.prototype.getSide=function(){return this.side};e.prototype.merge=function(t,r,n,i,o,a){if(n&&(!(n instanceof e)||!this.widget.compare(n.widget)||t>0&&o<=0||r<this.length&&a<=0))return false;this.length=t+(n?n.length:0)+(this.length-r);return true};e.prototype.become=function(t){if(t.length==this.length&&t instanceof e&&t.side==this.side){if(this.widget.constructor==t.widget.constructor){if(!this.widget.eq(t.widget))this.markDirty(true);if(this.dom&&!this.prevWidget)this.prevWidget=this.widget;this.widget=t.widget;return true}}return false};e.prototype.ignoreMutation=function(){return true};e.prototype.ignoreEvent=function(t){return this.widget.ignoreEvent(t)};Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){if(this.length==0)return A.empty;var t=this;while(t.parent)t=t.parent;var e=t.editorView,r=e&&e.state.doc,n=this.posAtStart;return r?r.slice(n,n+this.length):A.empty},enumerable:false,configurable:true});e.prototype.domAtPos=function(t){return t==0?ze.before(this.dom):ze.after(this.dom,t==this.length)};e.prototype.domBoundsAround=function(){return null};e.prototype.coordsAt=function(t,e){var r=this.dom.getClientRects(),n=null;if(!r.length)return Te;for(var i=t>0?r.length-1:0;;i+=t>0?-1:1){n=r[i];if(t>0?i==0:i==r.length-1||n.top<n.bottom)break}return t==0&&e>0||t==this.length&&e<=0?n:Ee(n,t==0)};Object.defineProperty(e.prototype,"isEditable",{get:function(){return false},enumerable:false,configurable:true});e.prototype.destroy=function(){t.prototype.destroy.call(this);if(this.dom)this.widget.destroy(this.dom)};return e}(qe);var hr=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.domAtPos=function(t){var e=this.widget,r=e.topView,n=e.text;if(!r)return new ze(n,Math.min(t,n.nodeValue.length));return pr(t,0,r,n,(function(t,e){return t.domAtPos(e)}),(function(t){return new ze(n,Math.min(t,n.nodeValue.length))}))};e.prototype.sync=function(){this.setDOM(this.widget.toDOM())};e.prototype.localPosFromDOM=function(t,e){var r=this.widget,n=r.topView,i=r.text;if(!n)return Math.min(e,this.length);return dr(t,e,n,i)};e.prototype.ignoreMutation=function(){return false};Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){return null},enumerable:false,configurable:true});e.prototype.coordsAt=function(t,e){var r=this.widget,n=r.topView,i=r.text;if(!n)return lr(i,t,e);return pr(t,e,n,i,(function(t,e,r){return t.coordsAt(e,r)}),(function(t,e){return lr(i,t,e)}))};e.prototype.destroy=function(){var e;t.prototype.destroy.call(this);(e=this.widget.topView)===null||e===void 0?void 0:e.destroy()};Object.defineProperty(e.prototype,"isEditable",{get:function(){return true},enumerable:false,configurable:true});return e}(cr);function pr(t,e,r,n,i,o){if(r instanceof ur){for(var a=0,s=r.children;a<s.length;a++){var f=s[a];var u=ke(f.dom,n);var l=u?n.nodeValue.length:f.length;if(t<l||t==l&&f.getSide()<=0)return u?pr(t,e,f,n,i,o):i(f,t,e);t-=l}return i(r,r.length,-1)}else if(r.dom==n){return o(t,e)}else{return i(r,t,e)}}function dr(t,e,r,n){if(r instanceof ur){for(var i=0,o=r.children;i<o.length;i++){var a=o[i];var s=0,f=ke(a.dom,n);if(ke(a.dom,t))return s+(f?dr(t,e,a,n):a.localPosFromDOM(t,e));s+=f?n.nodeValue.length:a.length}}else if(r.dom==n){return Math.min(e,n.nodeValue.length)}return r.localPosFromDOM(t,e)}var vr=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.side=e;return r}Object.defineProperty(e.prototype,"length",{get:function(){return 0},enumerable:false,configurable:true});e.prototype.merge=function(){return false};e.prototype.become=function(t){return t instanceof e&&t.side==this.side};e.prototype.split=function(){return new e(this.side)};e.prototype.sync=function(){if(!this.dom){var t=document.createElement("img");t.className="cm-widgetBuffer";t.setAttribute("aria-hidden","true");this.setDOM(t)}};e.prototype.getSide=function(){return this.side};e.prototype.domAtPos=function(t){return ze.before(this.dom)};e.prototype.localPosFromDOM=function(){return 0};e.prototype.domBoundsAround=function(){return null};e.prototype.coordsAt=function(t){var e=this.dom.getBoundingClientRect();var r=gr(this,this.side>0?-1:1);return r&&r.top<e.bottom&&r.bottom>e.top?{left:e.left,right:e.right,top:r.top,bottom:r.bottom}:e};Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){return A.empty},enumerable:false,configurable:true});return e}(qe);fr.prototype.children=cr.prototype.children=vr.prototype.children=We;function gr(t,e){var r=t.parent,n=r?r.children.indexOf(t):-1;while(r&&n>=0){if(e<0?n>0:n<r.children.length){var i=r.children[n+e];if(i instanceof fr){var o=i.coordsAt(e<0?i.length:0,e);if(o)return o}n+=e}else if(r instanceof ur&&r.parent){n=r.parent.children.indexOf(r)+(e<0?0:1);r=r.parent}else{var a=r.dom.lastChild;if(a&&a.nodeName=="BR")return a.getClientRects()[0];break}}return undefined}function mr(t,e,r){var n=0;for(var i=0;n<e.length;n++){var o=e[n],a=i+o.length;if(a==i&&o.getSide()<=0)continue;if(r>i&&r<a&&o.dom.parentNode==t)return o.domAtPos(r-i);if(r<=i)break;i=a}for(;n>0;n--){var s=e[n-1].dom;if(s.parentNode==t)return ze.after(s)}return new ze(t,0)}function yr(t,e,r){var n,i=t.children;if(r>0&&e instanceof ur&&i.length&&(n=i[i.length-1])instanceof ur&&n.mark.eq(e.mark)){yr(n,e.children[0],r-1)}else{i.push(e);e.setParent(t)}t.length+=e.length}function br(t,e,r){for(var n=0,i=0;i<t.children.length;i++){var o=t.children[i],a=n+o.length,s=void 0;if((r<=0||a==t.length||o.getSide()>0?a>=e:a>e)&&(e<a||i+1==t.children.length||(s=t.children[i+1]).length||s.getSide()>0)){var f=0;if(a==n){if(o.getSide()<=0)continue;f=r=-o.getSide()}var u=o.coordsAt(Math.max(0,e-n),r);return f&&u?Ee(u,r<0):u}n=a}var l=t.dom.lastChild;if(!l)return t.dom.getBoundingClientRect();var c=Ae(l);return c[c.length-1]||null}function wr(t,e){for(var r in t){if(r=="class"&&e.class)e.class+=" "+t.class;else if(r=="style"&&e.style)e.style+=";"+t.style;else e[r]=t[r]}return e}function xr(t,e){if(t==e)return true;if(!t||!e)return false;var r=Object.keys(t),n=Object.keys(e);if(r.length!=n.length)return false;for(var i=0,o=r;i<o.length;i++){var a=o[i];if(n.indexOf(a)==-1||t[a]!==e[a])return false}return true}function kr(t,e,r){if(e)for(var n in e)if(!(r&&n in r))t.removeAttribute(n);if(r)for(var i in r)if(!(e&&e[i]==r[i]))t.setAttribute(i,r[i])}var Sr=function(){function t(){}t.prototype.eq=function(t){return false};t.prototype.updateDOM=function(t){return false};t.prototype.compare=function(t){return this==t||this.constructor==t.constructor&&this.eq(t)};Object.defineProperty(t.prototype,"estimatedHeight",{get:function(){return-1},enumerable:false,configurable:true});t.prototype.ignoreEvent=function(t){return true};Object.defineProperty(t.prototype,"customView",{get:function(){return null},enumerable:false,configurable:true});t.prototype.destroy=function(t){};return t}();var Cr=function(t){t[t["Text"]=0]="Text";t[t["WidgetBefore"]=1]="WidgetBefore";t[t["WidgetAfter"]=2]="WidgetAfter";t[t["WidgetRange"]=3]="WidgetRange";return t}(Cr||(Cr={}));var Ar=function(t){__extends(e,t);function e(e,r,n,i){var o=t.call(this)||this;o.startSide=e;o.endSide=r;o.widget=n;o.spec=i;return o}Object.defineProperty(e.prototype,"heightRelevant",{get:function(){return false},enumerable:false,configurable:true});e.mark=function(t){return new Or(t)};e.widget=function(t){var e=t.side||0,r=!!t.block;e+=r?e>0?3e8:-4e8:e>0?1e8:-1e8;return new Dr(t,e,e,r,t.widget||null,false)};e.replace=function(t){var e=!!t.block,r,n;if(t.isBlockGap){r=-5e8;n=4e8}else{var i=Pr(t,e),o=i.start,a=i.end;r=(o?e?-3e8:-1:5e8)-1;n=(a?e?2e8:1:-6e8)+1}return new Dr(t,r,n,e,t.widget||null,true)};e.line=function(t){return new Mr(t)};e.set=function(t,e){if(e===void 0){e=false}return Xt.of(t,e)};e.prototype.hasHeight=function(){return this.widget?this.widget.estimatedHeight>-1:false};return e}(Kt);Ar.none=Xt.empty;var Or=function(t){__extends(e,t);function e(e){var r=this;var n=Pr(e),i=n.start,o=n.end;r=t.call(this,i?-1:5e8,o?1:-6e8,null,e)||this;r.tagName=e.tagName||"span";r.class=e.class||"";r.attrs=e.attributes||null;return r}e.prototype.eq=function(t){return this==t||t instanceof e&&this.tagName==t.tagName&&this.class==t.class&&xr(this.attrs,t.attrs)};e.prototype.range=function(e,r){if(r===void 0){r=e}if(e>=r)throw new RangeError("Mark decorations may not be empty");return t.prototype.range.call(this,e,r)};return e}(Ar);Or.prototype.point=false;var Mr=function(t){__extends(e,t);function e(e){return t.call(this,-2e8,-2e8,null,e)||this}e.prototype.eq=function(t){return t instanceof e&&xr(this.spec.attributes,t.spec.attributes)};e.prototype.range=function(e,r){if(r===void 0){r=e}if(r!=e)throw new RangeError("Line decoration ranges must be zero-length");return t.prototype.range.call(this,e,r)};return e}(Ar);Mr.prototype.mapMode=N.TrackBefore;Mr.prototype.point=true;var Dr=function(t){__extends(e,t);function e(e,r,n,i,o,a){var s=t.call(this,r,n,o,e)||this;s.block=i;s.isReplace=a;s.mapMode=!i?N.TrackDel:r<=0?N.TrackBefore:N.TrackAfter;return s}Object.defineProperty(e.prototype,"type",{get:function(){return this.startSide<this.endSide?Cr.WidgetRange:this.startSide<=0?Cr.WidgetBefore:Cr.WidgetAfter},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"heightRelevant",{get:function(){return this.block||!!this.widget&&this.widget.estimatedHeight>=5},enumerable:false,configurable:true});e.prototype.eq=function(t){return t instanceof e&&Tr(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide};e.prototype.range=function(e,r){if(r===void 0){r=e}if(this.isReplace&&(e>r||e==r&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&r!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return t.prototype.range.call(this,e,r)};return e}(Ar);Dr.prototype.point=true;function Pr(t,e){if(e===void 0){e=false}var r=t.inclusiveStart,n=t.inclusiveEnd;if(r==null)r=t.inclusive;if(n==null)n=t.inclusive;return{start:r!==null&&r!==void 0?r:e,end:n!==null&&n!==void 0?n:e}}function Tr(t,e){return t==e||!!(t&&e&&t.compare(e))}function Er(t,e,r,n){if(n===void 0){n=0}var i=r.length-1;if(i>=0&&r[i]+n>=t)r[i]=Math.max(r[i],e);else r.push(t,e)}var Rr=function(t){__extends(e,t);function e(){var e=t.apply(this,arguments)||this;e.children=[];e.length=0;e.prevAttrs=undefined;e.attrs=null;e.breakAfter=0;return e}e.prototype.merge=function(t,r,n,i,o,a){if(n){if(!(n instanceof e))return false;if(!this.dom)n.transferDOM(this)}if(i)this.setDeco(n?n.attrs:null);Je(this,t,r,n?n.children:[],o,a);return true};e.prototype.split=function(t){var r=new e;r.breakAfter=this.breakAfter;if(this.length==0)return r;var n=this.childPos(t),i=n.i,o=n.off;if(o){r.append(this.children[i].split(o),0);this.children[i].merge(o,this.children[i].length,null,false,0,0);i++}for(var a=i;a<this.children.length;a++)r.append(this.children[a],0);while(i>0&&this.children[i-1].length==0)this.children[--i].destroy();this.children.length=i;this.markDirty();this.length=t;return r};e.prototype.transferDOM=function(t){if(!this.dom)return;t.setDOM(this.dom);t.prevAttrs=this.prevAttrs===undefined?this.attrs:this.prevAttrs;this.prevAttrs=undefined;this.dom=null};e.prototype.setDeco=function(t){if(!xr(this.attrs,t)){if(this.dom){this.prevAttrs=this.attrs;this.markDirty()}this.attrs=t}};e.prototype.append=function(t,e){yr(this,t,e)};e.prototype.addLineDeco=function(t){var e=t.spec.attributes,r=t.spec.class;if(e)this.attrs=wr(e,this.attrs||{});if(r)this.attrs=wr({class:r},this.attrs||{})};e.prototype.domAtPos=function(t){return mr(this.dom,this.children,t)};e.prototype.reuseDOM=function(t){if(t.nodeName=="DIV"){this.setDOM(t);this.dirty|=4|2}};e.prototype.sync=function(e){var r;if(!this.dom){this.setDOM(document.createElement("div"));this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}else if(this.dirty&4){Fe(this.dom);this.dom.className="cm-line";this.prevAttrs=this.attrs?null:undefined}if(this.prevAttrs!==undefined){kr(this.dom,this.prevAttrs,this.attrs);this.dom.classList.add("cm-line");this.prevAttrs=undefined}t.prototype.sync.call(this,e);var n=this.dom.lastChild;while(n&&qe.get(n)instanceof ur)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((r=qe.get(n))===null||r===void 0?void 0:r.isEditable)==false&&(!ar.ios||!this.children.some((function(t){return t instanceof fr})))){var i=document.createElement("BR");i.cmIgnore=true;this.dom.appendChild(i)}};e.prototype.measureTextSize=function(){if(this.children.length==0||this.length>20)return null;var t=0;for(var e=0,r=this.children;e<r.length;e++){var n=r[e];if(!(n instanceof fr))return null;var i=Ae(n.dom);if(i.length!=1)return null;t+=i[0].width}return{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length}};e.prototype.coordsAt=function(t,e){return br(this,t,e)};e.prototype.become=function(t){return false};Object.defineProperty(e.prototype,"type",{get:function(){return Cr.Text},enumerable:false,configurable:true});e.find=function(t,r){for(var n=0,i=0;n<t.children.length;n++){var o=t.children[n],a=i+o.length;if(a>=r){if(o instanceof e)return o;if(a>r)break}i=a+o.breakAfter}return null};return e}(qe);var Lr=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this)||this;i.widget=e;i.length=r;i.type=n;i.breakAfter=0;i.prevWidget=null;return i}e.prototype.merge=function(t,r,n,i,o,a){if(n&&(!(n instanceof e)||!this.widget.compare(n.widget)||t>0&&o<=0||r<this.length&&a<=0))return false;this.length=t+(n?n.length:0)+(this.length-r);return true};e.prototype.domAtPos=function(t){return t==0?ze.before(this.dom):ze.after(this.dom,t==this.length)};e.prototype.split=function(t){var r=this.length-t;this.length=t;var n=new e(this.widget,r,this.type);n.breakAfter=this.breakAfter;return n};Object.defineProperty(e.prototype,"children",{get:function(){return We},enumerable:false,configurable:true});e.prototype.sync=function(){if(!this.dom||!this.widget.updateDOM(this.dom)){if(this.dom&&this.prevWidget)this.prevWidget.destroy(this.dom);this.prevWidget=null;this.setDOM(this.widget.toDOM(this.editorView));this.dom.contentEditable="false"}};Object.defineProperty(e.prototype,"overrideDOMText",{get:function(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):A.empty},enumerable:false,configurable:true});e.prototype.domBoundsAround=function(){return null};e.prototype.become=function(t){if(t instanceof e&&t.type==this.type&&t.widget.constructor==this.widget.constructor){if(!t.widget.eq(this.widget))this.markDirty(true);if(this.dom&&!this.prevWidget)this.prevWidget=this.widget;this.widget=t.widget;this.length=t.length;this.breakAfter=t.breakAfter;return true}return false};e.prototype.ignoreMutation=function(){return true};e.prototype.ignoreEvent=function(t){return this.widget.ignoreEvent(t)};e.prototype.destroy=function(){t.prototype.destroy.call(this);if(this.dom)this.widget.destroy(this.dom)};return e}(qe);var Br=function(){function t(t,e,r,n){this.doc=t;this.pos=e;this.end=r;this.disallowBlockEffectsBelow=n;this.content=[];this.curLine=null;this.breakAtStart=0;this.pendingBuffer=0;this.atCursorPos=true;this.openStart=-1;this.openEnd=-1;this.text="";this.textOff=0;this.cursor=t.iter();this.skip=e}t.prototype.posCovered=function(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;var t=this.content[this.content.length-1];return!t.breakAfter&&!(t instanceof Lr&&t.type==Cr.WidgetBefore)};t.prototype.getLine=function(){if(!this.curLine){this.content.push(this.curLine=new Rr);this.atCursorPos=true}return this.curLine};t.prototype.flushBuffer=function(t){if(this.pendingBuffer){this.curLine.append(Ir(new vr(-1),t),t.length);this.pendingBuffer=0}};t.prototype.addBlockWidget=function(t){this.flushBuffer([]);this.curLine=null;this.content.push(t)};t.prototype.finish=function(t){if(!t)this.flushBuffer([]);else this.pendingBuffer=0;if(!this.posCovered())this.getLine()};t.prototype.buildText=function(t,e,r){while(t>0){if(this.textOff==this.text.length){var n=this.cursor.next(this.skip),i=n.value,o=n.lineBreak,a=n.done;this.skip=0;if(a)throw new Error("Ran out of text content when drawing inline views");if(o){if(!this.posCovered())this.getLine();if(this.content.length)this.content[this.content.length-1].breakAfter=1;else this.breakAtStart=1;this.flushBuffer([]);this.curLine=null;t--;continue}else{this.text=i;this.textOff=0}}var s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(0,r));this.getLine().append(Ir(new fr(this.text.slice(this.textOff,this.textOff+s)),e),r);this.atCursorPos=true;this.textOff+=s;t-=s;r=0}};t.prototype.span=function(t,e,r,n){this.buildText(e-t,r,n);this.pos=e;if(this.openStart<0)this.openStart=n};t.prototype.point=function(t,e,r,n,i){var o=e-t;if(r instanceof Dr){if(r.block){var a=r.type;if(a==Cr.WidgetAfter&&!this.posCovered())this.getLine();this.addBlockWidget(new Lr(r.widget||new Nr("div"),o,a))}else{var s=cr.create(r.widget||new Nr("span"),o,r.startSide);var f=this.atCursorPos&&!s.isEditable&&i<=n.length&&(t<e||r.startSide>0);var u=!s.isEditable&&(t<e||r.startSide<=0);var l=this.getLine();if(this.pendingBuffer==2&&!f)this.pendingBuffer=0;this.flushBuffer(n);if(f){l.append(Ir(new vr(1),n),i);i=n.length+Math.max(0,i-n.length)}l.append(Ir(s,n),i);this.atCursorPos=u;this.pendingBuffer=!u?0:t<e?1:2}}else if(this.doc.lineAt(this.pos).from==this.pos){this.getLine().addLineDeco(r)}if(o){if(this.textOff+o<=this.text.length){this.textOff+=o}else{this.skip+=o-(this.text.length-this.textOff);this.text="";this.textOff=0}this.pos=e}if(this.openStart<0)this.openStart=i};t.prototype.filterPoint=function(t,e,r,n){if(n<this.disallowBlockEffectsBelow&&r instanceof Dr){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}return true};t.build=function(e,r,n,i,o){var a=new t(e,r,n,o);a.openEnd=Xt.spans(i,r,n,a);if(a.openStart<0)a.openStart=a.openEnd;a.finish(a.openEnd);return a};return t}();function Ir(t,e){for(var r=0,n=e;r<n.length;r++){var i=n[r];t=new ur(i,[t],t.length)}return t}var Nr=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.tag=e;return r}e.prototype.eq=function(t){return t.tag==this.tag};e.prototype.toDOM=function(){return document.createElement(this.tag)};e.prototype.updateDOM=function(t){return t.nodeName.toLowerCase()==this.tag};return e}(Sr);var jr=[];var _r=Y.define();var Vr=Y.define();var Hr=Y.define();var Fr=Y.define();var zr=Y.define();var Wr=Y.define();var qr=St.define({map:function(t,e){return t.map(e)}});var Ur=St.define({map:function(t,e){return t.map(e)}});var Gr=function(){function t(t,e,r,n,i){if(e===void 0){e="nearest"}if(r===void 0){r="nearest"}if(n===void 0){n=5}if(i===void 0){i=5}this.range=t;this.y=e;this.x=r;this.yMargin=n;this.xMargin=i}t.prototype.map=function(e){return e.empty?this:new t(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin)};return t}();var Kr=St.define({map:function(t,e){return t.map(e)}});function Jr(t,e,r){var n=t.facet(Fr);if(n.length)n[0](e);else if(window.onerror)window.onerror(String(e),r,undefined,undefined,e);else if(r)console.error(r+":",e);else console.error(e)}var $r=Y.define({combine:function(t){return t.length?t[0]:true}});var Yr=function(){function t(t,e){this.field=t;this.get=e}return t}();var Xr=function(){function t(){}t.prototype.from=function(t){return new Yr(this,t)};t.define=function(){return new t};return t}();Xr.decorations=Xr.define();Xr.atomicRanges=Xr.define();Xr.scrollMargins=Xr.define();var Qr=0;var Zr=Y.define();var tn=function(){function t(t,e,r){this.id=t;this.create=e;this.fields=r;this.extension=Zr.of(this)}t.define=function(e,r){var n=r||{},i=n.eventHandlers,o=n.provide,a=n.decorations;var s=[];if(o)for(var f=0,u=Array.isArray(o)?o:[o];f<u.length;f++){var l=u[f];s.push(l)}if(i)s.push(en.from((function(t){return{plugin:t,handlers:i}})));if(a)s.push(Xr.decorations.from(a));return new t(Qr++,e,s)};t.fromClass=function(e,r){return t.define((function(t){return new e(t)}),r)};return t}();var en=Xr.define();var rn=function(){function t(t){this.spec=t;this.mustUpdate=null;this.value=null}t.prototype.takeField=function(t,e){if(this.spec)for(var r=0,n=this.spec.fields;r<n.length;r++){var i=n[r],o=i.field,a=i.get;if(o==t)e.push(a(this.value))}};t.prototype.update=function(t){if(!this.value){if(this.spec){try{this.value=this.spec.create(t)}catch(r){Jr(t.state,r,"CodeMirror plugin crashed");this.deactivate()}}}else if(this.mustUpdate){var e=this.mustUpdate;this.mustUpdate=null;if(this.value.update){try{this.value.update(e)}catch(r){Jr(e.state,r,"CodeMirror plugin crashed");if(this.value.destroy)try{this.value.destroy()}catch(bv){}this.deactivate()}}}return this};t.prototype.destroy=function(t){var e;if((e=this.value)===null||e===void 0?void 0:e.destroy){try{this.value.destroy()}catch(r){Jr(t.state,r,"CodeMirror plugin crashed")}}};t.prototype.deactivate=function(){this.spec=this.value=null};return t}();var nn=Y.define();var on=Y.define();var an=Y.define();var sn=Y.define();var fn=function(){function t(t,e,r,n){this.fromA=t;this.toA=e;this.fromB=r;this.toB=n}t.prototype.join=function(e){return new t(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))};t.prototype.addToSet=function(t){var e=t.length,r=this;for(;e>0;e--){var n=t[e-1];if(n.fromA>r.toA)continue;if(n.toA<r.fromA)break;r=r.join(n);t.splice(e-1,1)}t.splice(e,0,r);return t};t.extendWithRanges=function(e,r){if(r.length==0)return e;var n=[];for(var i=0,o=0,a=0,s=0;;i++){var f=i==e.length?null:e[i],u=a-s;var l=f?f.fromB:1e9;while(o<r.length&&r[o]<l){var c=r[o],h=r[o+1];var p=Math.max(s,c),d=Math.min(l,h);if(p<=d)new t(p+u,d+u,p,d).addToSet(n);if(h>l)break;else o+=2}if(!f)return n;new t(f.fromA,f.toA,f.fromB,f.toB).addToSet(n);a=f.toA;s=f.toB}};return t}();var un=function(){function t(t,e,r){if(r===void 0){r=jr}this.view=t;this.state=e;this.transactions=r;this.flags=0;this.startState=t.state;this.changes=_.empty(this.startState.doc.length);for(var n=0,i=r;n<i.length;n++){var o=i[n];this.changes=this.changes.compose(o.changes)}var a=[];this.changes.iterChangedRanges((function(t,e,r,n){return a.push(new fn(t,e,r,n))}));this.changedRanges=a;var s=t.hasFocus;if(s!=t.inputState.notifiedFocused){t.inputState.notifiedFocused=s;this.flags|=1}}Object.defineProperty(t.prototype,"viewportChanged",{get:function(){return(this.flags&4)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"heightChanged",{get:function(){return(this.flags&2)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"geometryChanged",{get:function(){return this.docChanged||(this.flags&(8|2))>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"focusChanged",{get:function(){return(this.flags&1)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"docChanged",{get:function(){return!this.changes.empty},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"selectionSet",{get:function(){return this.transactions.some((function(t){return t.selection}))},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"empty",{get:function(){return this.flags==0&&this.transactions.length==0},enumerable:false,configurable:true});return t}();var ln=function(t){t[t["LTR"]=0]="LTR";t[t["RTL"]=1]="RTL";return t}(ln||(ln={}));var cn=ln.LTR,hn=ln.RTL;function pn(t){var e=[];for(var r=0;r<t.length;r++)e.push(1<<+t[r]);return e}var dn=pn("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008");var vn=pn("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333");var gn=Object.create(null),mn=[];for(var yn=0,bn=["()","[]","{}"];yn<bn.length;yn++){var wn=bn[yn];var xn=wn.charCodeAt(0),kn=wn.charCodeAt(1);gn[xn]=kn;gn[kn]=-xn}function Sn(t){return t<=247?dn[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?vn[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8203?256:t==8204?256:1}var Cn=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var An=function(){function t(t,e,r){this.from=t;this.to=e;this.level=r}Object.defineProperty(t.prototype,"dir",{get:function(){return this.level%2?hn:cn},enumerable:false,configurable:true});t.prototype.side=function(t,e){return this.dir==e==t?this.to:this.from};t.find=function(t,e,r,n){var i=-1;for(var o=0;o<t.length;o++){var a=t[o];if(a.from<=e&&a.to>=e){if(a.level==r)return o;if(i<0||(n!=0?n<0?a.from<e:a.to>e:t[i].level>a.level))i=o}}if(i<0)throw new RangeError("Index out of range");return i};return t}();var On=[];function Mn(t,e){var r=t.length,n=e==cn?1:2,i=e==cn?2:1;if(!t||n==1&&!Cn.test(t))return Dn(r);for(var o=0,a=n,s=n;o<r;o++){var f=Sn(t.charCodeAt(o));if(f==512)f=a;else if(f==8&&s==4)f=16;On[o]=f==4?2:f;if(f&7)s=f;a=f}for(var u=0,a=n,s=n;u<r;u++){var f=On[u];if(f==128){if(u<r-1&&a==On[u+1]&&a&24)f=On[u]=a;else On[u]=256}else if(f==64){var l=u+1;while(l<r&&On[l]==64)l++;var c=u&&a==8||l<r&&On[l]==8?s==1?1:8:256;for(var h=u;h<l;h++)On[h]=c;u=l-1}else if(f==8&&s==1){On[u]=1}a=f;if(f&7)s=f}for(var p=0,d=0,v=0,g=void 0,m=void 0,f=void 0;p<r;p++){if(m=gn[g=t.charCodeAt(p)]){if(m<0){for(var y=d-3;y>=0;y-=3){if(mn[y+1]==-m){var b=mn[y+2];var w=b&2?n:!(b&4)?0:b&1?i:n;if(w)On[p]=On[mn[y]]=w;d=y;break}}}else if(mn.length==189){break}else{mn[d++]=p;mn[d++]=g;mn[d++]=v}}else if((f=On[p])==2||f==1){var x=f==n;v=x?0:1;for(var y=d-3;y>=0;y-=3){var k=mn[y+2];if(k&2)break;if(x){mn[y+2]|=2}else{if(k&4)break;mn[y+2]|=4}}}}for(var S=0;S<r;S++){if(On[S]==256){var l=S+1;while(l<r&&On[l]==256)l++;var C=(S?On[S-1]:n)==1;var A=(l<r?On[l]:n)==1;var c=C==A?C?1:2:n;for(var h=S;h<l;h++)On[h]=c;S=l-1}}var O=[];if(n==1){for(var M=0;M<r;){var D=M,P=On[M++]!=1;while(M<r&&P==(On[M]!=1))M++;if(P){for(var h=M;h>D;){var l=h,T=On[--h]!=2;while(h>D&&T==(On[h-1]!=2))h--;O.push(new An(h,l,T?2:1))}}else{O.push(new An(D,M,0))}}}else{for(var E=0;E<r;){var D=E,P=On[E++]==2;while(E<r&&P==(On[E]==2))E++;O.push(new An(D,E,P?1:2))}}return O}function Dn(t){return[new An(0,t,0)]}var Pn="";function Tn(t,e,r,n,i){var o;var a=n.head-t.from,s=-1;if(a==0){if(!i||!t.length)return null;if(e[0].level!=r){a=e[0].side(false,r);s=0}}else if(a==t.length){if(i)return null;var f=e[e.length-1];if(f.level!=r){a=f.side(true,r);s=e.length-1}}if(s<0)s=An.find(e,a,(o=n.bidiLevel)!==null&&o!==void 0?o:-1,n.assoc);var u=e[s];if(a==u.side(i,r)){u=e[s+=i?1:-1];a=u.side(!i,r)}var l=i==(u.dir==r);var c=v(t.text,a,l);Pn=t.text.slice(Math.min(a,c),Math.max(a,c));if(c!=u.side(i,r))return G.cursor(c+t.from,l?-1:1,u.level);var h=s==(i?e.length-1:0)?null:e[s+(i?1:-1)];if(!h&&u.level!=r)return G.cursor(i?t.to:t.from,i?-1:1,r);if(h&&h.level<u.level)return G.cursor(h.side(!i,r)+t.from,i?1:-1,h.level);return G.cursor(c+t.from,i?-1:1,u.level)}var En="￿";var Rn=function(){function t(t,e){this.points=t;this.text="";this.lineSeparator=e.facet(_t.lineSeparator)}t.prototype.append=function(t){this.text+=t};t.prototype.lineBreak=function(){this.text+=En};t.prototype.readRange=function(t,e){if(!t)return this;var r=t.parentNode;for(var n=t;;){this.findPointBefore(r,n);this.readNode(n);var i=n.nextSibling;if(i==e)break;var o=qe.get(n),a=qe.get(i);if(o&&a?o.breakAfter:(o?o.breakAfter:Ln(n))||Ln(i)&&(n.nodeName!="BR"||n.cmIgnore))this.lineBreak();n=i}this.findPointBefore(r,e);return this};t.prototype.readTextNode=function(t){var e=t.nodeValue;for(var r=0,n=this.points;r<n.length;r++){var i=n[r];if(i.node==t)i.pos=this.text.length+Math.min(i.offset,e.length)}for(var o=0,a=this.lineSeparator?null:/\r\n?|\n/g;;){var s=-1,f=1,u=void 0;if(this.lineSeparator){s=e.indexOf(this.lineSeparator,o);f=this.lineSeparator.length}else if(u=a.exec(e)){s=u.index;f=u[0].length}this.append(e.slice(o,s<0?e.length:s));if(s<0)break;this.lineBreak();if(f>1)for(var l=0,c=this.points;l<c.length;l++){var i=c[l];if(i.node==t&&i.pos>this.text.length)i.pos-=f-1}o=s+f}};t.prototype.readNode=function(t){if(t.cmIgnore)return;var e=qe.get(t);var r=e&&e.overrideDOMText;if(r!=null){this.findPointInside(t,r.length);for(var n=r.iter();!n.next().done;){if(n.lineBreak)this.lineBreak();else this.append(n.value)}}else if(t.nodeType==3){this.readTextNode(t)}else if(t.nodeName=="BR"){if(t.nextSibling)this.lineBreak()}else if(t.nodeType==1){this.readRange(t.firstChild,null)}};t.prototype.findPointBefore=function(t,e){for(var r=0,n=this.points;r<n.length;r++){var i=n[r];if(i.node==t&&t.childNodes[i.offset]==e)i.pos=this.text.length}};t.prototype.findPointInside=function(t,e){for(var r=0,n=this.points;r<n.length;r++){var i=n[r];if(t.nodeType==3?i.node==t:t.contains(i.node))i.pos=this.text.length+Math.min(e,i.offset)}};return t}();function Ln(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}var Bn=function(){function t(t,e){this.node=t;this.offset=e;this.pos=-1}return t}();var In=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.view=e;r.compositionDeco=Ar.none;r.decorations=[];r.pluginDecorationLength=0;r.minWidth=0;r.minWidthFrom=0;r.minWidthTo=0;r.impreciseAnchor=null;r.impreciseHead=null;r.forceSelection=false;r.lastUpdate=Date.now();r.setDOM(e.contentDOM);r.children=[new Rr];r.children[0].setParent(r);r.updateDeco();r.updateInner([new fn(0,0,0,e.state.doc.length)],0);return r}Object.defineProperty(e.prototype,"root",{get:function(){return this.view.root},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"editorView",{get:function(){return this.view},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"length",{get:function(){return this.view.state.doc.length},enumerable:false,configurable:true});e.prototype.update=function(t){var e=this;var r=t.changedRanges;if(this.minWidth>0&&r.length){if(!r.every((function(t){var r=t.fromA,n=t.toA;return n<e.minWidthFrom||r>e.minWidthTo}))){this.minWidth=this.minWidthFrom=this.minWidthTo=0}else{this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1);this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)}}if(this.view.inputState.composing<0)this.compositionDeco=Ar.none;else if(t.transactions.length||this.dirty)this.compositionDeco=Vn(this.view,t.changes);if((ar.ie||ar.chrome)&&!this.compositionDeco.size&&t&&t.state.doc.lines!=t.startState.doc.lines)this.forceSelection=true;var n=this.decorations,i=this.updateDeco();var o=qn(n,i,t.changes);r=fn.extendWithRanges(r,o);if(this.dirty==0&&r.length==0){return false}else{this.updateInner(r,t.startState.doc.length);if(t.transactions.length)this.lastUpdate=Date.now();return true}};e.prototype.updateInner=function(t,e){var r=this;this.view.viewState.mustMeasureContent=true;this.updateChildren(t,e);var n=this.view.observer;n.ignore((function(){r.dom.style.height=r.view.viewState.contentHeight+"px";r.dom.style.minWidth=r.minWidth?r.minWidth+"px":"";var t=ar.chrome||ar.ios?{node:n.selectionRange.focusNode,written:false}:undefined;r.sync(t);r.dirty=0;if(t&&(t.written||n.selectionRange.focusNode!=t.node))r.forceSelection=true;r.dom.style.height=""}));var i=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(var o=0,a=this.children;o<a.length;o++){var s=a[o];if(s instanceof Lr&&s.widget instanceof jn)i.push(s.dom)}n.updateGaps(i)};e.prototype.updateChildren=function(t,e){var r=this.childCursor(e);for(var n=t.length-1;;n--){var i=n>=0?t[n]:null;if(!i)break;var o=i.fromA,a=i.toA,s=i.fromB,f=i.toB;var u=Br.build(this.view.state.doc,s,f,this.decorations,this.pluginDecorationLength),l=u.content,c=u.breakAtStart,h=u.openStart,p=u.openEnd;var d=r.findPos(a,1),v=d.i,g=d.off;var m=r.findPos(o,-1),y=m.i,b=m.off;Ke(this,y,b,v,g,l,c,h,p)}};e.prototype.updateSelection=function(t,e){var r=this;if(t===void 0){t=false}if(e===void 0){e=false}if(t)this.view.observer.readSelectionRange();if(!(e||this.mayControlSelection())||ar.ios&&this.view.inputState.rapidCompositionStart)return;var n=this.forceSelection;this.forceSelection=false;var i=this.view.state.selection.main;var o=this.domAtPos(i.anchor);var a=i.empty?o:this.domAtPos(i.head);if(ar.gecko&&i.empty&&Nn(o)){var s=document.createTextNode("");this.view.observer.ignore((function(){return o.node.insertBefore(s,o.node.childNodes[o.offset]||null)}));o=a=new ze(s,0);n=true}var f=this.view.observer.selectionRange;if(n||!f.focusNode||!Oe(o.node,o.offset,f.anchorNode,f.anchorOffset)||!Oe(a.node,a.offset,f.focusNode,f.focusOffset)){this.view.observer.ignore((function(){var t;if(ar.android&&ar.chrome&&r.dom.contains(f.focusNode)&&Un(f.focusNode,r.dom)){r.dom.blur();r.dom.focus({preventScroll:true})}var e=xe(r.root);if(i.empty){if(ar.gecko){var n=zn(o.node,o.offset);if(n&&n!=(1|2)){var s=Fn(o.node,o.offset,n==1?1:-1);if(s)o=new ze(s,n==1?0:s.nodeValue.length)}}e.collapse(o.node,o.offset);if(i.bidiLevel!=null&&f.cursorBidiLevel!=null)f.cursorBidiLevel=i.bidiLevel}else if(e.extend){e.collapse(o.node,o.offset);e.extend(a.node,a.offset)}else{var u=document.createRange();if(i.anchor>i.head)t=[a,o],o=t[0],a=t[1];u.setEnd(a.node,a.offset);u.setStart(o.node,o.offset);e.removeAllRanges();e.addRange(u)}}));this.view.observer.setSelectionRange(o,a)}this.impreciseAnchor=o.precise?null:new ze(f.anchorNode,f.anchorOffset);this.impreciseHead=a.precise?null:new ze(f.focusNode,f.focusOffset)};e.prototype.enforceCursorAssoc=function(){if(this.compositionDeco.size)return;var t=this.view.state.selection.main;var e=xe(this.root);if(!t.empty||!t.assoc||!e.modify)return;var r=Rr.find(this,t.head);if(!r)return;var n=r.posAtStart;if(t.head==n||t.head==n+r.length)return;var i=this.coordsAt(t.head,-1),o=this.coordsAt(t.head,1);if(!i||!o||i.bottom>o.top)return;var a=this.domAtPos(t.head+t.assoc);e.collapse(a.node,a.offset);e.modify("move",t.assoc<0?"forward":"backward","lineboundary")};e.prototype.mayControlSelection=function(){return this.view.state.facet($r)?this.root.activeElement==this.dom:Ce(this.dom,this.view.observer.selectionRange)};e.prototype.nearest=function(t){for(var e=t;e;){var r=qe.get(e);if(r&&r.rootView==this)return r;e=e.parentNode}return null};e.prototype.posFromDOM=function(t,e){var r=this.nearest(t);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(t,e)+r.posAtStart};e.prototype.domAtPos=function(t){var e=this.childCursor().findPos(t,-1),r=e.i,n=e.off;for(;r<this.children.length-1;){var i=this.children[r];if(n<i.length||i instanceof Rr)break;r++;n=0}return this.children[r].domAtPos(n)};e.prototype.coordsAt=function(t,e){for(var r=this.length,n=this.children.length-1;;n--){var i=this.children[n],o=r-i.breakAfter-i.length;if(t>o||t==o&&i.type!=Cr.WidgetBefore&&i.type!=Cr.WidgetAfter&&(!n||e==2||this.children[n-1].breakAfter||this.children[n-1].type==Cr.WidgetBefore&&e>-2))return i.coordsAt(t-o,e);r=o}};e.prototype.measureVisibleLineHeights=function(){var t=[],e=this.view.viewState.viewport,r=e.from,n=e.to;var i=this.view.contentDOM.clientWidth;var o=i>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1;var a=-1;for(var s=0,f=0;f<this.children.length;f++){var u=this.children[f],l=s+u.length;if(l>n)break;if(s>=r){var c=u.dom.getBoundingClientRect();t.push(c.height);if(o){var h=u.dom.lastChild;var p=h?Ae(h):[];if(p.length){var d=p[p.length-1];var v=this.view.textDirection==ln.LTR?d.right-c.left:c.right-d.left;if(v>a){a=v;this.minWidth=i;this.minWidthFrom=s;this.minWidthTo=l}}}}s=l+u.breakAfter}return t};e.prototype.measureTextSize=function(){var t=this;for(var e=0,r=this.children;e<r.length;e++){var n=r[e];if(n instanceof Rr){var i=n.measureTextSize();if(i)return i}}var o=document.createElement("div"),a,s;o.className="cm-line";o.textContent="abc def ghi jkl mno pqr stu";this.view.observer.ignore((function(){t.dom.appendChild(o);var e=Ae(o.firstChild)[0];a=o.getBoundingClientRect().height;s=e?e.width/27:7;o.remove()}));return{lineHeight:a,charWidth:s}};e.prototype.childCursor=function(t){if(t===void 0){t=this.length}var e=this.children.length;if(e)t-=this.children[--e].length;return new Ge(this.children,t,e)};e.prototype.computeBlockGapDeco=function(){var t=[],e=this.view.viewState;for(var r=0,n=0;;n++){var i=n==e.viewports.length?null:e.viewports[n];var o=i?i.from-1:this.length;if(o>r){var a=e.lineBlockAt(o).bottom-e.lineBlockAt(r).top;t.push(Ar.replace({widget:new jn(a),block:true,inclusive:true,isBlockGap:true}).range(r,o))}if(!i)break;r=i.to+1}return Ar.set(t)};e.prototype.updateDeco=function(){var t=this.view.pluginField(Xr.decorations);this.pluginDecorationLength=t.length;return this.decorations=__spreadArray(__spreadArray(__spreadArray([],t,true),this.view.state.facet(an),true),[this.compositionDeco,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco],false)};e.prototype.scrollIntoView=function(t){var e=t.range;var r=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),n;if(!r)return;if(!e.empty&&(n=this.coordsAt(e.anchor,e.anchor>e.head?-1:1)))r={left:Math.min(r.left,n.left),top:Math.min(r.top,n.top),right:Math.max(r.right,n.right),bottom:Math.max(r.bottom,n.bottom)};var i=0,o=0,a=0,s=0;for(var f=0,u=this.view.pluginField(Xr.scrollMargins);f<u.length;f++){var l=u[f];if(l){var c=l.left,h=l.right,p=l.top,d=l.bottom;if(c!=null)i=Math.max(i,c);if(h!=null)o=Math.max(o,h);if(p!=null)a=Math.max(a,p);if(d!=null)s=Math.max(s,d)}}var v={left:r.left-i,top:r.top-a,right:r.right+o,bottom:r.bottom+s};Le(this.view.scrollDOM,v,e.head<e.anchor?-1:1,t.x,t.y,t.xMargin,t.yMargin,this.view.textDirection==ln.LTR)};return e}(qe);function Nn(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}var jn=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.height=e;return r}e.prototype.toDOM=function(){var t=document.createElement("div");this.updateDOM(t);return t};e.prototype.eq=function(t){return t.height==this.height};e.prototype.updateDOM=function(t){t.style.height=this.height+"px";return true};Object.defineProperty(e.prototype,"estimatedHeight",{get:function(){return this.height},enumerable:false,configurable:true});return e}(Sr);function _n(t){var e=t.observer.selectionRange;var r=e.focusNode&&Fn(e.focusNode,e.focusOffset,0);if(!r)return null;var n=t.docView.nearest(r);if(!n)return null;if(n instanceof Rr){var i=r;while(i.parentNode!=n.dom)i=i.parentNode;var o=i.previousSibling;while(o&&!qe.get(o))o=o.previousSibling;var a=o?qe.get(o).posAtEnd:n.posAtStart;return{from:a,to:a,node:i,text:r}}else{for(;;){var s=n.parent;if(!s)return null;if(s instanceof Rr)break;n=s}var f=n.posAtStart;return{from:f,to:f+n.length,node:n.dom,text:r}}}function Vn(t,e){var r=_n(t);if(!r)return Ar.none;var n=r.from,i=r.to,o=r.node,a=r.text;var s=e.mapPos(n,1),f=Math.max(s,e.mapPos(i,-1));var u=t.state,l=o.nodeType==3?o.nodeValue:new Rn([],u).readRange(o.firstChild,null).text;if(f-s<l.length){if(u.doc.sliceString(s,Math.min(u.doc.length,s+l.length),En)==l)f=s+l.length;else if(u.doc.sliceString(Math.max(0,f-l.length),f,En)==l)s=f-l.length;else return Ar.none}else if(u.doc.sliceString(s,f,En)!=l){return Ar.none}var c=qe.get(o);if(c instanceof hr)c=c.widget.topView;else if(c)c.parent=null;return Ar.set(Ar.replace({widget:new Hn(o,a,c)}).range(s,f))}var Hn=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this)||this;i.top=e;i.text=r;i.topView=n;return i}e.prototype.eq=function(t){return this.top==t.top&&this.text==t.text};e.prototype.toDOM=function(){return this.top};e.prototype.ignoreEvent=function(){return false};Object.defineProperty(e.prototype,"customView",{get:function(){return hr},enumerable:false,configurable:true});return e}(Sr);function Fn(t,e,r){for(;;){if(t.nodeType==3)return t;if(t.nodeType==1&&e>0&&r<=0){t=t.childNodes[e-1];e=Pe(t)}else if(t.nodeType==1&&e<t.childNodes.length&&r>=0){t=t.childNodes[e];e=0}else{return null}}}function zn(t,e){if(t.nodeType!=1)return 0;return(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}var Wn=function(){function t(){this.changes=[]}t.prototype.compareRange=function(t,e){Er(t,e,this.changes)};t.prototype.comparePoint=function(t,e){Er(t,e,this.changes)};return t}();function qn(t,e,r){var n=new Wn;Xt.compare(t,e,r,n);return n.changes}function Un(t,e){for(var r=t;r&&r!=e;r=r.assignedSlot||r.parentNode){if(r.nodeType==1&&r.contentEditable=="false"){return true}}return false}function Gn(t,e,r){if(r===void 0){r=1}var n=t.charCategorizer(e);var i=t.doc.lineAt(e),o=e-i.from;if(i.length==0)return G.cursor(e);if(o==0)r=1;else if(o==i.length)r=-1;var a=o,s=o;if(r<0)a=v(i.text,o,false);else s=v(i.text,o);var f=n(i.text.slice(a,s));while(a>0){var u=v(i.text,a,false);if(n(i.text.slice(u,a))!=f)break;a=u}while(s<i.length){var l=v(i.text,s);if(n(i.text.slice(s,l))!=f)break;s=l}return G.range(a+i.from,s+i.from)}function Kn(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function Jn(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function $n(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Yn(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Xn(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function Qn(t,e,r){var n,i,o,a;var s,f,u,l;for(var c=t.firstChild;c;c=c.nextSibling){var h=Ae(c);for(var p=0;p<h.length;p++){var d=h[p];if(i&&$n(i,d))d=Yn(Xn(d,i.bottom),i.top);var v=Kn(e,d),g=Jn(r,d);if(v==0&&g==0)return c.nodeType==3?Zn(c,e,r):Qn(c,e,r);if(!n||a>g||a==g&&o>v){n=c;i=d;o=v;a=g}if(v==0){if(r>d.bottom&&(!u||u.bottom<d.bottom)){s=c;u=d}else if(r<d.top&&(!l||l.top>d.top)){f=c;l=d}}else if(u&&$n(u,d)){u=Xn(u,d.bottom)}else if(l&&$n(l,d)){l=Yn(l,d.top)}}}if(u&&u.bottom>=r){n=s;i=u}else if(l&&l.top<=r){n=f;i=l}if(!n)return{node:t,offset:0};var m=Math.max(i.left,Math.min(i.right,e));if(n.nodeType==3)return Zn(n,m,r);if(!o&&n.contentEditable=="true")return Qn(n,m,r);var y=Array.prototype.indexOf.call(t.childNodes,n)+(e>=(i.left+i.right)/2?1:0);return{node:t,offset:y}}function Zn(t,e,r){var n=t.nodeValue.length;var i=-1,o=1e9,a=0;for(var s=0;s<n;s++){var f=_e(t,s,s+1).getClientRects();for(var u=0;u<f.length;u++){var l=f[u];if(l.top==l.bottom)continue;if(!a)a=e-l.left;var c=(l.top>r?l.top-r:r-l.bottom)-1;if(l.left-1<=e&&l.right+1>=e&&c<o){var h=e>=(l.left+l.right)/2,p=h;if(ar.chrome||ar.gecko){var d=_e(t,s).getBoundingClientRect();if(d.left==l.right)p=!h}if(c<=0)return{node:t,offset:s+(p?1:0)};i=s+(p?1:0);o=c}}}return{node:t,offset:i>-1?i:a>0?t.nodeValue.length:0}}function ti(t,e,r,n){var i;var o=e.x,a=e.y;if(n===void 0){n=-1}var s;var f=t.contentDOM.getBoundingClientRect(),u=f.top+t.viewState.paddingTop;var l,c=t.viewState.docHeight;var h=a-u;if(h<0)return 0;if(h>c)return t.state.doc.length;for(var p=t.defaultLineHeight/2,d=false;;){l=t.elementAtHeight(h);if(l.type==Cr.Text)break;for(;;){h=n>0?l.bottom+p:l.top-p;if(h>=0&&h<=c)break;if(d)return r?null:0;d=true;n=-n}}a=u+h;var v=l.from;if(v<t.viewport.from)return t.viewport.from==0?0:r?null:ei(t,f,l,o,a);if(v>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:r?null:ei(t,f,l,o,a);var g=t.dom.ownerDocument;var m=t.root.elementFromPoint?t.root:g;var y=m.elementFromPoint(o,a);if(y&&!t.contentDOM.contains(y))y=null;if(!y){o=Math.max(f.left+1,Math.min(f.right-1,o));y=m.elementFromPoint(o,a);if(y&&!t.contentDOM.contains(y))y=null}var b,w=-1;if(y&&((s=t.docView.nearest(y))===null||s===void 0?void 0:s.isEditable)!=false){if(g.caretPositionFromPoint){var x=g.caretPositionFromPoint(o,a);if(x)b=x.offsetNode,w=x.offset}else if(g.caretRangeFromPoint){var k=g.caretRangeFromPoint(o,a);if(k){b=k.startContainer,w=k.startOffset;if(ar.safari&&ri(b,w,o))b=undefined}}}if(!b||!t.docView.dom.contains(b)){var S=Rr.find(t.docView,v);if(!S)return h>l.top+l.height/2?l.to:l.from;i=Qn(S.dom,o,a),b=i.node,w=i.offset}return t.docView.posFromDOM(b,w)}function ei(t,e,r,n,i){var o=Math.round((n-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&r.height>t.defaultLineHeight*1.5){var a=Math.floor((i-r.top)/t.defaultLineHeight);o+=a*t.viewState.heightOracle.lineLength}var s=t.state.sliceDoc(r.from,r.to);return r.from+C(s,o,t.state.tabSize)}function ri(t,e,r){var n;if(t.nodeType!=3||e!=(n=t.nodeValue.length))return false;for(var i=t.nextSibling;i;i=i.nextSibling)if(i.nodeType!=1||i.nodeName!="BR")return false;return _e(t,n-1,n).getBoundingClientRect().left>r}function ni(t,e,r,n){var i=t.state.doc.lineAt(e.head);var o=!n||!t.lineWrapping?null:t.coordsAtPos(e.assoc<0&&e.head>i.from?e.head-1:e.head);if(o){var a=t.dom.getBoundingClientRect();var s=t.posAtCoords({x:r==(t.textDirection==ln.LTR)?a.right-1:a.left+1,y:(o.top+o.bottom)/2});if(s!=null)return G.cursor(s,r?-1:1)}var f=Rr.find(t.docView,e.head);var u=f?r?f.posAtEnd:f.posAtStart:r?i.to:i.from;return G.cursor(u,r?-1:1)}function ii(t,e,r,n){var i=t.state.doc.lineAt(e.head),o=t.bidiSpans(i);for(var a=e,s=null;;){var f=Tn(i,o,t.textDirection,a,r),u=Pn;if(!f){if(i.number==(r?t.state.doc.lines:1))return a;u="\n";i=t.state.doc.line(i.number+(r?1:-1));o=t.bidiSpans(i);f=G.cursor(r?i.from:i.to)}if(!s){if(!n)return f;s=n(u)}else if(!s(u)){return a}a=f}}function oi(t,e,r){var n=t.state.charCategorizer(e);var i=n(r);return function(t){var e=n(t);if(i==Lt.Space)i=e;return i==e}}function ai(t,e,r,n){var i=e.head,o=r?1:-1;if(i==(r?t.state.doc.length:0))return G.cursor(i,e.assoc);var a=e.goalColumn,s;var f=t.contentDOM.getBoundingClientRect();var u=t.coordsAtPos(i),l=t.documentTop;if(u){if(a==null)a=u.left-f.left;s=o<0?u.top:u.bottom}else{var c=t.viewState.lineBlockAt(i-l);if(a==null)a=Math.min(f.right-f.left,t.defaultCharacterWidth*(i-c.from));s=(o<0?c.top:c.bottom)+l}var h=f.left+a;var p=n!==null&&n!==void 0?n:t.defaultLineHeight>>1;for(var d=0;;d+=10){var v=s+(p+d)*o;var g=ti(t,{x:h,y:v},false,o);if(v<f.top||v>f.bottom||(o<0?g<i:g>i))return G.cursor(g,e.assoc,undefined,a)}}function si(t,e,r){var n=t.pluginField(Xr.atomicRanges);var i=function(){var t=false;for(var i=0,o=n;i<o.length;i++){var a=o[i];a.between(r.from-1,r.from+1,(function(n,i,o){if(r.from>n&&r.from<i){r=e.from>r.from?G.cursor(n,1):G.cursor(i,-1);t=true}}))}if(!t)return{value:r}};for(;;){var o=i();if(typeof o==="object")return o.value}}var fi=function(){function t(t){var e=this;this.lastKeyCode=0;this.lastKeyTime=0;this.pendingIOSKey=undefined;this.lastSelectionOrigin=null;this.lastSelectionTime=0;this.lastEscPress=0;this.lastContextMenu=0;this.scrollHandlers=[];this.registeredEvents=[];this.customHandlers=[];this.composing=-1;this.compositionFirstChange=null;this.compositionEndedAt=0;this.rapidCompositionStart=false;this.mouseSelection=null;var r=function(r){var i=gi[r];t.contentDOM.addEventListener(r,(function(n){if(!vi(t,n)||e.ignoreDuringComposition(n))return;if(r=="keydown"&&e.keydown(t,n))return;if(e.mustFlushObserver(n))t.observer.forceFlush();if(e.runCustomHandlers(r,t,n))n.preventDefault();else i(t,n)}));n.registeredEvents.push(r)};var n=this;for(var i in gi){r(i)}this.notifiedFocused=t.hasFocus;this.ensureHandlers(t);if(ar.safari)t.contentDOM.addEventListener("input",(function(){return null}))}t.prototype.setSelectionOrigin=function(t){this.lastSelectionOrigin=t;this.lastSelectionTime=Date.now()};t.prototype.ensureHandlers=function(t){var e=this;var r=this.customHandlers=t.pluginField(en);for(var n=0,i=r;n<i.length;n++){var o=i[n];var a=function(r){if(s.registeredEvents.indexOf(r)<0&&r!="scroll"){s.registeredEvents.push(r);t.contentDOM.addEventListener(r,(function(n){if(!vi(t,n))return;if(e.runCustomHandlers(r,t,n))n.preventDefault()}))}};var s=this;for(var f in o.handlers){a(f)}}};t.prototype.runCustomHandlers=function(t,e,r){for(var n=0,i=this.customHandlers;n<i.length;n++){var o=i[n];var a=o.handlers[t];if(a){try{if(a.call(o.plugin,r,e)||r.defaultPrevented)return true}catch(s){Jr(e.state,s)}}}return false};t.prototype.runScrollHandlers=function(t,e){for(var r=0,n=this.customHandlers;r<n.length;r++){var i=n[r];var o=i.handlers.scroll;if(o){try{o.call(i.plugin,e,t)}catch(a){Jr(t.state,a)}}}};t.prototype.keydown=function(t,e){var r=this;this.lastKeyCode=e.keyCode;this.lastKeyTime=Date.now();if(e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return true;if(ar.android&&ar.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8)){t.observer.delayAndroidKey(e.key,e.keyCode);return true}var n;if(ar.ios&&(n=ui.find((function(t){return t.keyCode==e.keyCode})))&&!(e.ctrlKey||e.altKey||e.metaKey)&&!e.synthetic){this.pendingIOSKey=n;setTimeout((function(){return r.flushIOSKey(t)}),250);return true}return false};t.prototype.flushIOSKey=function(t){var e=this.pendingIOSKey;if(!e)return false;this.pendingIOSKey=undefined;return Ve(t.contentDOM,e.key,e.keyCode)};t.prototype.ignoreDuringComposition=function(t){if(!/^key/.test(t.type))return false;if(this.composing>0)return true;if(ar.safari&&Date.now()-this.compositionEndedAt<500){this.compositionEndedAt=0;return true}return false};t.prototype.mustFlushObserver=function(t){return t.type=="keydown"&&t.keyCode!=229||t.type=="compositionend"&&!ar.ios};t.prototype.startMouseSelection=function(t){if(this.mouseSelection)this.mouseSelection.destroy();this.mouseSelection=t};t.prototype.update=function(t){if(this.mouseSelection)this.mouseSelection.update(t);if(t.transactions.length)this.lastKeyCode=this.lastSelectionTime=0};t.prototype.destroy=function(){if(this.mouseSelection)this.mouseSelection.destroy()};return t}();var ui=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}];var li=[16,17,18,20,91,92,224,225];var ci=function(){function t(t,e,r,n){this.view=t;this.style=r;this.mustSelect=n;this.lastEvent=e;var i=t.contentDOM.ownerDocument;i.addEventListener("mousemove",this.move=this.move.bind(this));i.addEventListener("mouseup",this.up=this.up.bind(this));this.extend=e.shiftKey;this.multiple=t.state.facet(_t.allowMultipleSelections)&&hi(t,e);this.dragMove=pi(t,e);this.dragging=di(t,e)&&Ti(e)==1?null:false;if(this.dragging===false){e.preventDefault();this.select(e)}}t.prototype.move=function(t){if(t.buttons==0)return this.destroy();if(this.dragging!==false)return;this.select(this.lastEvent=t)};t.prototype.up=function(t){if(this.dragging==null)this.select(this.lastEvent);if(!this.dragging)t.preventDefault();this.destroy()};t.prototype.destroy=function(){var t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move);t.removeEventListener("mouseup",this.up);this.view.inputState.mouseSelection=null};t.prototype.select=function(t){var e=this.style.get(t,this.extend,this.multiple);if(this.mustSelect||!e.eq(this.view.state.selection)||e.main.assoc!=this.view.state.selection.main.assoc)this.view.dispatch({selection:e,userEvent:"select.pointer",scrollIntoView:true});this.mustSelect=false};t.prototype.update=function(t){var e=this;if(t.docChanged&&this.dragging)this.dragging=this.dragging.map(t.changes);if(this.style.update(t))setTimeout((function(){return e.select(e.lastEvent)}),20)};return t}();function hi(t,e){var r=t.state.facet(_r);return r.length?r[0](e):ar.mac?e.metaKey:e.ctrlKey}function pi(t,e){var r=t.state.facet(Vr);return r.length?r[0](e):ar.mac?!e.altKey:!e.ctrlKey}function di(t,e){var r=t.state.selection.main;if(r.empty)return false;var n=xe(t.root);if(n.rangeCount==0)return true;var i=n.getRangeAt(0).getClientRects();for(var o=0;o<i.length;o++){var a=i[o];if(a.left<=e.clientX&&a.right>=e.clientX&&a.top<=e.clientY&&a.bottom>=e.clientY)return true}return false}function vi(t,e){if(!e.bubbles)return true;if(e.defaultPrevented)return false;for(var r=e.target,n=void 0;r!=t.contentDOM;r=r.parentNode)if(!r||r.nodeType==11||(n=qe.get(r))&&n.ignoreEvent(e))return false;return true}var gi=Object.create(null);var mi=ar.ie&&ar.ie_version<15||ar.ios&&ar.webkit_version<604;function yi(t){var e=t.dom.parentNode;if(!e)return;var r=e.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px";r.focus();setTimeout((function(){t.focus();r.remove();bi(t,r.value)}),50)}function bi(t,e){var r=t.state,n,i=1,o=r.toText(e);var a=o.lines==r.selection.ranges.length;var s=Ii!=null&&r.selection.ranges.every((function(t){return t.empty}))&&Ii==o.toString();if(s){var f=-1;n=r.changeByRange((function(t){var n=r.doc.lineAt(t.from);if(n.from==f)return{range:t};f=n.from;var s=r.toText((a?o.line(i++).text:e)+r.lineBreak);return{changes:{from:n.from,insert:s},range:G.cursor(t.from+s.length)}}))}else if(a){n=r.changeByRange((function(t){var e=o.line(i++);return{changes:{from:t.from,to:t.to,insert:e.text},range:G.cursor(t.from+e.length)}}))}else{n=r.replaceSelection(o)}t.dispatch(n,{userEvent:"input.paste",scrollIntoView:true})}gi.keydown=function(t,e){t.inputState.setSelectionOrigin("select");if(e.keyCode==27)t.inputState.lastEscPress=Date.now();else if(li.indexOf(e.keyCode)<0)t.inputState.lastEscPress=0};var wi=0;gi.touchstart=function(t,e){wi=Date.now();t.inputState.setSelectionOrigin("select.pointer")};gi.touchmove=function(t){t.inputState.setSelectionOrigin("select.pointer")};gi.mousedown=function(t,e){t.observer.flush();if(wi>Date.now()-2e3&&Ti(e)==1)return;var r=null;for(var n=0,i=t.state.facet(Hr);n<i.length;n++){var o=i[n];r=o(t,e);if(r)break}if(!r&&e.button==0)r=Ei(t,e);if(r){var a=t.root.activeElement!=t.contentDOM;if(a)t.observer.ignore((function(){return Ne(t.contentDOM)}));t.inputState.startMouseSelection(new ci(t,e,r,a))}};function xi(t,e,r,n){if(n==1){return G.cursor(e,r)}else if(n==2){return Gn(t.state,e,r)}else{var i=Rr.find(t.docView,e),o=t.state.doc.lineAt(i?i.posAtEnd:e);var a=i?i.posAtStart:o.from,s=i?i.posAtEnd:o.to;if(s<t.state.doc.length&&s==o.to)s++;return G.range(a,s)}}var ki=function(t,e){return t>=e.top&&t<=e.bottom};var Si=function(t,e,r){return ki(e,r)&&t>=r.left&&t<=r.right};function Ci(t,e,r,n){var i=Rr.find(t.docView,e);if(!i)return 1;var o=e-i.posAtStart;if(o==0)return 1;if(o==i.length)return-1;var a=i.coordsAt(o,-1);if(a&&Si(r,n,a))return-1;var s=i.coordsAt(o,1);if(s&&Si(r,n,s))return 1;return a&&ki(n,a)?-1:1}function Ai(t,e){var r=t.posAtCoords({x:e.clientX,y:e.clientY},false);return{pos:r,bias:Ci(t,r,e.clientX,e.clientY)}}var Oi=ar.ie&&ar.ie_version<=11;var Mi=null,Di=0,Pi=0;function Ti(t){if(!Oi)return t.detail;var e=Mi,r=Pi;Mi=t;Pi=Date.now();return Di=!e||r>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Di+1)%3:1}function Ei(t,e){var r=Ai(t,e),n=Ti(e);var i=t.state.selection;var o=r,a=e;return{update:function(t){if(t.docChanged){if(r)r.pos=t.changes.mapPos(r.pos);i=i.map(t.changes);a=null}},get:function(e,s,f){var u;if(a&&e.clientX==a.clientX&&e.clientY==a.clientY)u=o;else{u=o=Ai(t,e);a=e}if(!u||!r)return i;var l=xi(t,u.pos,u.bias,n);if(r.pos!=u.pos&&!s){var c=xi(t,r.pos,r.bias,n);var h=Math.min(c.from,l.from),p=Math.max(c.to,l.to);l=h<l.from?G.range(h,p):G.range(p,h)}if(s)return i.replaceRange(i.main.extend(l.from,l.to));else if(f)return i.addRange(l);else return G.create([l])}}}gi.dragstart=function(t,e){var r=t.state.selection.main;var n=t.inputState.mouseSelection;if(n)n.dragging=r;if(e.dataTransfer){e.dataTransfer.setData("Text",t.state.sliceDoc(r.from,r.to));e.dataTransfer.effectAllowed="copyMove"}};function Ri(t,e,r,n){if(!r)return;var i=t.posAtCoords({x:e.clientX,y:e.clientY},false);e.preventDefault();var o=t.inputState.mouseSelection;var a=n&&o&&o.dragging&&o.dragMove?{from:o.dragging.from,to:o.dragging.to}:null;var s={from:i,insert:r};var f=t.state.changes(a?[a,s]:s);t.focus();t.dispatch({changes:f,selection:{anchor:f.mapPos(i,-1),head:f.mapPos(i,1)},userEvent:a?"move.drop":"input.drop"})}gi.drop=function(t,e){if(!e.dataTransfer)return;if(t.state.readOnly)return e.preventDefault();var r=e.dataTransfer.files;if(r&&r.length){e.preventDefault();var n=Array(r.length),i=0;var o=function(){if(++i==r.length)Ri(t,e,n.filter((function(t){return t!=null})).join(t.state.lineBreak),false)};var a=function(t){var e=new FileReader;e.onerror=o;e.onload=function(){if(!/[\x00-\x08\x0e-\x1f]{2}/.test(e.result))n[t]=e.result;o()};e.readAsText(r[t])};for(var s=0;s<r.length;s++){a(s)}}else{Ri(t,e,e.dataTransfer.getData("Text"),true)}};gi.paste=function(t,e){if(t.state.readOnly)return e.preventDefault();t.observer.flush();var r=mi?null:e.clipboardData;if(r){bi(t,r.getData("text/plain"));e.preventDefault()}else{yi(t)}};function Li(t,e){var r=t.dom.parentNode;if(!r)return;var n=r.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px";n.value=e;n.focus();n.selectionEnd=e.length;n.selectionStart=0;setTimeout((function(){n.remove();t.focus()}),50)}function Bi(t){var e=[],r=[],n=false;for(var i=0,o=t.selection.ranges;i<o.length;i++){var a=o[i];if(!a.empty){e.push(t.sliceDoc(a.from,a.to));r.push(a)}}if(!e.length){var s=-1;for(var f=0,u=t.selection.ranges;f<u.length;f++){var l=u[f].from;var c=t.doc.lineAt(l);if(c.number>s){e.push(c.text);r.push({from:c.from,to:Math.min(t.doc.length,c.to+1)})}s=c.number}n=true}return{text:e.join(t.lineBreak),ranges:r,linewise:n}}var Ii=null;gi.copy=gi.cut=function(t,e){var r=Bi(t.state),n=r.text,i=r.ranges,o=r.linewise;if(!n&&!o)return;Ii=o?n:null;var a=mi?null:e.clipboardData;if(a){e.preventDefault();a.clearData();a.setData("text/plain",n)}else{Li(t,n)}if(e.type=="cut"&&!t.state.readOnly)t.dispatch({changes:i,scrollIntoView:true,userEvent:"delete.cut"})};gi.focus=gi.blur=function(t){setTimeout((function(){if(t.hasFocus!=t.inputState.notifiedFocused)t.update([])}),10)};function Ni(t,e){if(t.docView.compositionDeco.size){t.inputState.rapidCompositionStart=e;try{t.update([])}finally{t.inputState.rapidCompositionStart=false}}}gi.compositionstart=gi.compositionupdate=function(t){if(t.inputState.compositionFirstChange==null)t.inputState.compositionFirstChange=true;if(t.inputState.composing<0){t.inputState.composing=0;if(t.docView.compositionDeco.size){t.observer.flush();Ni(t,true)}}};gi.compositionend=function(t){t.inputState.composing=-1;t.inputState.compositionEndedAt=Date.now();t.inputState.compositionFirstChange=null;setTimeout((function(){if(t.inputState.composing<0)Ni(t,false)}),50)};gi.contextmenu=function(t){t.inputState.lastContextMenu=Date.now()};gi.beforeinput=function(t,e){var r;var n;if(ar.chrome&&ar.android&&(n=ui.find((function(t){return t.inputType==e.inputType})))){t.observer.delayAndroidKey(n.key,n.keyCode);if(n.key=="Backspace"||n.key=="Delete"){var i=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout((function(){var e;if((((e=window.visualViewport)===null||e===void 0?void 0:e.height)||0)>i+10&&t.hasFocus){t.contentDOM.blur();t.focus()}}),100)}}};var ji=["pre-wrap","normal","pre-line","break-spaces"];var _i=function(){function t(){this.doc=A.empty;this.lineWrapping=false;this.direction=ln.LTR;this.heightSamples={};this.lineHeight=14;this.charWidth=7;this.lineLength=30;this.heightChanged=false}t.prototype.heightForGap=function(t,e){var r=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;if(this.lineWrapping)r+=Math.ceil((e-t-r*this.lineLength*.5)/this.lineLength);return this.lineHeight*r};t.prototype.heightForLine=function(t){if(!this.lineWrapping)return this.lineHeight;var e=1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5)));return e*this.lineHeight};t.prototype.setDoc=function(t){this.doc=t;return this};t.prototype.mustRefreshForStyle=function(t,e){return ji.indexOf(t)>-1!=this.lineWrapping||this.direction!=e};t.prototype.mustRefreshForHeights=function(t){var e=false;for(var r=0;r<t.length;r++){var n=t[r];if(n<0){r++}else if(!this.heightSamples[Math.floor(n*10)]){e=true;this.heightSamples[Math.floor(n*10)]=true}}return e};t.prototype.refresh=function(t,e,r,n,i,o){var a=ji.indexOf(t)>-1;var s=Math.round(r)!=Math.round(this.lineHeight)||this.lineWrapping!=a||this.direction!=e;this.lineWrapping=a;this.direction=e;this.lineHeight=r;this.charWidth=n;this.lineLength=i;if(s){this.heightSamples={};for(var f=0;f<o.length;f++){var u=o[f];if(u<0)f++;else this.heightSamples[Math.floor(u*10)]=true}}return s};return t}();var Vi=function(){function t(t,e){this.from=t;this.heights=e;this.index=0}Object.defineProperty(t.prototype,"more",{get:function(){return this.index<this.heights.length},enumerable:false,configurable:true});return t}();var Hi=function(){function t(t,e,r,n,i){this.from=t;this.length=e;this.top=r;this.height=n;this.type=i}Object.defineProperty(t.prototype,"to",{get:function(){return this.from+this.length},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"bottom",{get:function(){return this.top+this.height},enumerable:false,configurable:true});t.prototype.join=function(e){var r=(Array.isArray(this.type)?this.type:[this]).concat(Array.isArray(e.type)?e.type:[e]);return new t(this.from,this.length+e.length,this.top,this.height+e.height,r)};t.prototype.moveY=function(e){return!e?this:new t(this.from,this.length,this.top+e,this.height,Array.isArray(this.type)?this.type.map((function(t){return t.moveY(e)})):this.type)};return t}();var Fi=function(t){t[t["ByPos"]=0]="ByPos";t[t["ByHeight"]=1]="ByHeight";t[t["ByPosNoHeight"]=2]="ByPosNoHeight";return t}(Fi||(Fi={}));var zi=.001;var Wi=function(){function t(t,e,r){if(r===void 0){r=2}this.length=t;this.height=e;this.flags=r}Object.defineProperty(t.prototype,"outdated",{get:function(){return(this.flags&2)>0},set:function(t){this.flags=(t?2:0)|this.flags&~2},enumerable:false,configurable:true});t.prototype.setHeight=function(t,e){if(this.height!=e){if(Math.abs(this.height-e)>zi)t.heightChanged=true;this.height=e}};t.prototype.replace=function(e,r,n){return t.of(n)};t.prototype.decomposeLeft=function(t,e){e.push(this)};t.prototype.decomposeRight=function(t,e){e.push(this)};t.prototype.applyChanges=function(t,e,r,n){var i=this;for(var o=n.length-1;o>=0;o--){var a=n[o],s=a.fromA,f=a.toA,u=a.fromB,l=a.toB;var c=i.lineAt(s,Fi.ByPosNoHeight,e,0,0);var h=c.to>=f?c:i.lineAt(f,Fi.ByPosNoHeight,e,0,0);l+=h.to-f;f=h.to;while(o>0&&c.from<=n[o-1].toA){s=n[o-1].fromA;u=n[o-1].fromB;o--;if(s<c.from)c=i.lineAt(s,Fi.ByPosNoHeight,e,0,0)}u+=c.from-s;s=c.from;var p=Yi.build(r,t,u,l);i=i.replace(s,f,p)}return i.updateHeight(r,0)};t.empty=function(){return new Ui(0,0)};t.of=function(e){if(e.length==1)return e[0];var r=0,n=e.length,i=0,o=0;for(;;){if(r==n){if(i>o*2){var a=e[r-1];if(a.break)e.splice(--r,1,a.left,null,a.right);else e.splice(--r,1,a.left,a.right);n+=1+a.break;i-=a.size}else if(o>i*2){var a=e[n];if(a.break)e.splice(n,1,a.left,null,a.right);else e.splice(n,1,a.left,a.right);n+=2+a.break;o-=a.size}else{break}}else if(i<o){var s=e[r++];if(s)i+=s.size}else{var s=e[--n];if(s)o+=s.size}}var f=0;if(e[r-1]==null){f=1;r--}else if(e[r]==null){f=1;n++}return new Ki(t.of(e.slice(0,r)),f,t.of(e.slice(n)))};return t}();Wi.prototype.size=1;var qi=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this,e,r)||this;i.type=n;return i}e.prototype.blockAt=function(t,e,r,n){return new Hi(n,this.length,r,this.height,this.type)};e.prototype.lineAt=function(t,e,r,n,i){return this.blockAt(0,r,n,i)};e.prototype.forEachLine=function(t,e,r,n,i,o){o(this.blockAt(0,r,n,i))};e.prototype.updateHeight=function(t,e,r,n){if(e===void 0){e=0}if(r===void 0){r=false}if(n&&n.from<=e&&n.more)this.setHeight(t,n.heights[n.index++]);this.outdated=false;return this};e.prototype.toString=function(){return"block(".concat(this.length,")")};return e}(Wi);var Ui=function(t){__extends(e,t);function e(e,r){var n=t.call(this,e,r,Cr.Text)||this;n.collapsed=0;n.widgetHeight=0;return n}e.prototype.replace=function(t,r,n){var i=n[0];if(n.length==1&&(i instanceof e||i instanceof Gi&&i.flags&4)&&Math.abs(this.length-i.length)<10){if(i instanceof Gi)i=new e(i.length,this.height);else i.height=this.height;if(!this.outdated)i.outdated=false;return i}else{return Wi.of(n)}};e.prototype.updateHeight=function(t,e,r,n){if(e===void 0){e=0}if(r===void 0){r=false}if(n&&n.from<=e&&n.more)this.setHeight(t,n.heights[n.index++]);else if(r||this.outdated)this.setHeight(t,Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed)));this.outdated=false;return this};e.prototype.toString=function(){return"line(".concat(this.length).concat(this.collapsed?-this.collapsed:"").concat(this.widgetHeight?":"+this.widgetHeight:"",")")};return e}(qi);var Gi=function(t){__extends(e,t);function e(e){return t.call(this,e,0)||this}e.prototype.lines=function(t,e){var r=t.lineAt(e).number,n=t.lineAt(e+this.length).number;return{firstLine:r,lastLine:n,lineHeight:this.height/(n-r+1)}};e.prototype.blockAt=function(t,e,r,n){var i=this.lines(e,n),o=i.firstLine,a=i.lastLine,s=i.lineHeight;var f=Math.max(0,Math.min(a-o,Math.floor((t-r)/s)));var u=e.line(o+f),l=u.from,c=u.length;return new Hi(l,c,r+s*f,s,Cr.Text)};e.prototype.lineAt=function(t,e,r,n,i){if(e==Fi.ByHeight)return this.blockAt(t,r,n,i);if(e==Fi.ByPosNoHeight){var o=r.lineAt(t),a=o.from,s=o.to;return new Hi(a,s-a,0,0,Cr.Text)}var f=this.lines(r,i),u=f.firstLine,l=f.lineHeight;var c=r.lineAt(t),h=c.from,p=c.length,d=c.number;return new Hi(h,p,n+l*(d-u),l,Cr.Text)};e.prototype.forEachLine=function(t,e,r,n,i,o){var a=this.lines(r,i),s=a.firstLine,f=a.lineHeight;for(var u=Math.max(t,i),l=Math.min(i+this.length,e);u<=l;){var c=r.lineAt(u);if(u==t)n+=f*(c.number-s);o(new Hi(c.from,c.length,n,f,Cr.Text));n+=f;u=c.to+1}};e.prototype.replace=function(t,r,n){var i=this.length-r;if(i>0){var o=n[n.length-1];if(o instanceof e)n[n.length-1]=new e(o.length+i);else n.push(null,new e(i-1))}if(t>0){var a=n[0];if(a instanceof e)n[0]=new e(t+a.length);else n.unshift(new e(t-1),null)}return Wi.of(n)};e.prototype.decomposeLeft=function(t,r){r.push(new e(t-1),null)};e.prototype.decomposeRight=function(t,r){r.push(null,new e(this.length-t-1))};e.prototype.updateHeight=function(t,r,n,i){if(r===void 0){r=0}if(n===void 0){n=false}var o=r+this.length;if(i&&i.from<=r+this.length&&i.more){var a=[],s=Math.max(r,i.from),f=-1;var u=t.heightChanged;if(i.from>r)a.push(new e(i.from-r-1).updateHeight(t,r));while(s<=o&&i.more){var l=t.doc.lineAt(s).length;if(a.length)a.push(null);var c=i.heights[i.index++];if(f==-1)f=c;else if(Math.abs(c-f)>=zi)f=-2;var h=new Ui(l,c);h.outdated=false;a.push(h);s+=l+1}if(s<=o)a.push(null,new e(o-s).updateHeight(t,s));var p=Wi.of(a);t.heightChanged=u||f<0||Math.abs(p.height-this.height)>=zi||Math.abs(f-this.lines(t.doc,r).lineHeight)>=zi;return p}else if(n||this.outdated){this.setHeight(t,t.heightForGap(r,r+this.length));this.outdated=false}return this};e.prototype.toString=function(){return"gap(".concat(this.length,")")};return e}(Wi);var Ki=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this,e.length+r+n.length,e.height+n.height,r|(e.outdated||n.outdated?2:0))||this;i.left=e;i.right=n;i.size=e.size+n.size;return i}Object.defineProperty(e.prototype,"break",{get:function(){return this.flags&1},enumerable:false,configurable:true});e.prototype.blockAt=function(t,e,r,n){var i=r+this.left.height;return t<i?this.left.blockAt(t,e,r,n):this.right.blockAt(t,e,i,n+this.left.length+this.break)};e.prototype.lineAt=function(t,e,r,n,i){var o=n+this.left.height,a=i+this.left.length+this.break;var s=e==Fi.ByHeight?t<o:t<a;var f=s?this.left.lineAt(t,e,r,n,i):this.right.lineAt(t,e,r,o,a);if(this.break||(s?f.to<a:f.from>a))return f;var u=e==Fi.ByPosNoHeight?Fi.ByPosNoHeight:Fi.ByPos;if(s)return f.join(this.right.lineAt(a,u,r,o,a));else return this.left.lineAt(a,u,r,n,i).join(f)};e.prototype.forEachLine=function(t,e,r,n,i,o){var a=n+this.left.height,s=i+this.left.length+this.break;if(this.break){if(t<s)this.left.forEachLine(t,e,r,n,i,o);if(e>=s)this.right.forEachLine(t,e,r,a,s,o)}else{var f=this.lineAt(s,Fi.ByPos,r,n,i);if(t<f.from)this.left.forEachLine(t,f.from-1,r,n,i,o);if(f.to>=t&&f.from<=e)o(f);if(e>f.to)this.right.forEachLine(f.to+1,e,r,a,s,o)}};e.prototype.replace=function(t,e,r){var n=this.left.length+this.break;if(e<n)return this.balanced(this.left.replace(t,e,r),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-n,e-n,r));var i=[];if(t>0)this.decomposeLeft(t,i);var o=i.length;for(var a=0,s=r;a<s.length;a++){var f=s[a];i.push(f)}if(t>0)Ji(i,o-1);if(e<this.length){var u=i.length;this.decomposeRight(e,i);Ji(i,u)}return Wi.of(i)};e.prototype.decomposeLeft=function(t,e){var r=this.left.length;if(t<=r)return this.left.decomposeLeft(t,e);e.push(this.left);if(this.break){r++;if(t>=r)e.push(null)}if(t>r)this.right.decomposeLeft(t-r,e)};e.prototype.decomposeRight=function(t,e){var r=this.left.length,n=r+this.break;if(t>=n)return this.right.decomposeRight(t-n,e);if(t<r)this.left.decomposeRight(t,e);if(this.break&&t<n)e.push(null);e.push(this.right)};e.prototype.balanced=function(t,e){if(t.size>2*e.size||e.size>2*t.size)return Wi.of(this.break?[t,null,e]:[t,e]);this.left=t;this.right=e;this.height=t.height+e.height;this.outdated=t.outdated||e.outdated;this.size=t.size+e.size;this.length=t.length+this.break+e.length;return this};e.prototype.updateHeight=function(t,e,r,n){if(e===void 0){e=0}if(r===void 0){r=false}var i=this,o=i.left,a=i.right,s=e+o.length+this.break,f=null;if(n&&n.from<=e+o.length&&n.more)f=o=o.updateHeight(t,e,r,n);else o.updateHeight(t,e,r);if(n&&n.from<=s+a.length&&n.more)f=a=a.updateHeight(t,s,r,n);else a.updateHeight(t,s,r);if(f)return this.balanced(o,a);this.height=this.left.height+this.right.height;this.outdated=false;return this};e.prototype.toString=function(){return this.left+(this.break?" ":"-")+this.right};return e}(Wi);function Ji(t,e){var r,n;if(t[e]==null&&(r=t[e-1])instanceof Gi&&(n=t[e+1])instanceof Gi)t.splice(e-1,3,new Gi(r.length+1+n.length))}var $i=5;var Yi=function(){function t(t,e){this.pos=t;this.oracle=e;this.nodes=[];this.lineStart=-1;this.lineEnd=-1;this.covering=null;this.writtenTo=t}Object.defineProperty(t.prototype,"isCovered",{get:function(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering},enumerable:false,configurable:true});t.prototype.span=function(t,e){if(this.lineStart>-1){var r=Math.min(e,this.lineEnd),n=this.nodes[this.nodes.length-1];if(n instanceof Ui)n.length+=r-this.pos;else if(r>this.pos||!this.isCovered)this.nodes.push(new Ui(r-this.pos,-1));this.writtenTo=r;if(e>r){this.nodes.push(null);this.writtenTo++;this.lineStart=-1}}this.pos=e};t.prototype.point=function(t,e,r){if(t<e||r.heightRelevant){var n=r.widget?r.widget.estimatedHeight:0;if(n<0)n=this.oracle.lineHeight;var i=e-t;if(r.block){this.addBlock(new qi(i,n,r.type))}else if(i||n>=$i){this.addLineDeco(n,i)}}else if(e>t){this.span(t,e)}if(this.lineEnd>-1&&this.lineEnd<this.pos)this.lineEnd=this.oracle.doc.lineAt(this.pos).to};t.prototype.enterLine=function(){if(this.lineStart>-1)return;var t=this.oracle.doc.lineAt(this.pos),e=t.from,r=t.to;this.lineStart=e;this.lineEnd=r;if(this.writtenTo<e){if(this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)this.nodes.push(this.blankContent(this.writtenTo,e-1));this.nodes.push(null)}if(this.pos>e)this.nodes.push(new Ui(this.pos-e,-1));this.writtenTo=this.pos};t.prototype.blankContent=function(t,e){var r=new Gi(e-t);if(this.oracle.doc.lineAt(t).to==e)r.flags|=4;return r};t.prototype.ensureLine=function(){this.enterLine();var t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Ui)return t;var e=new Ui(0,-1);this.nodes.push(e);return e};t.prototype.addBlock=function(t){this.enterLine();if(t.type==Cr.WidgetAfter&&!this.isCovered)this.ensureLine();this.nodes.push(t);this.writtenTo=this.pos=this.pos+t.length;if(t.type!=Cr.WidgetBefore)this.covering=t};t.prototype.addLineDeco=function(t,e){var r=this.ensureLine();r.length+=e;r.collapsed+=e;r.widgetHeight=Math.max(r.widgetHeight,t);this.writtenTo=this.pos=this.pos+e};t.prototype.finish=function(t){var e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];if(this.lineStart>-1&&!(e instanceof Ui)&&!this.isCovered)this.nodes.push(new Ui(0,-1));else if(this.writtenTo<this.pos||e==null)this.nodes.push(this.blankContent(this.writtenTo,this.pos));var r=t;for(var n=0,i=this.nodes;n<i.length;n++){var o=i[n];if(o instanceof Ui)o.updateHeight(this.oracle,r);r+=o?o.length:1}return this.nodes};t.build=function(e,r,n,i){var o=new t(n,e);Xt.spans(r,n,i,o,0);return o.finish(n)};return t}();function Xi(t,e,r){var n=new Qi;Xt.compare(t,e,r,n,0);return n.changes}var Qi=function(){function t(){this.changes=[]}t.prototype.compareRange=function(){};t.prototype.comparePoint=function(t,e,r,n){if(t<e||r&&r.heightRelevant||n&&n.heightRelevant)Er(t,e,this.changes,5)};return t}();function Zi(t,e){var r=t.getBoundingClientRect();var n=Math.max(0,r.left),i=Math.min(innerWidth,r.right);var o=Math.max(0,r.top),a=Math.min(innerHeight,r.bottom);var s=t.ownerDocument.body;for(var f=t.parentNode;f&&f!=s;){if(f.nodeType==1){var u=f;var l=window.getComputedStyle(u);if((u.scrollHeight>u.clientHeight||u.scrollWidth>u.clientWidth)&&l.overflow!="visible"){var c=u.getBoundingClientRect();n=Math.max(n,c.left);i=Math.min(i,c.right);o=Math.max(o,c.top);a=Math.min(a,c.bottom)}f=l.position=="absolute"||l.position=="fixed"?u.offsetParent:u.parentNode}else if(f.nodeType==11){f=f.host}else{break}}return{left:n-r.left,right:Math.max(n,i)-r.left,top:o-(r.top+e),bottom:Math.max(o,a)-(r.top+e)}}function to(t,e){var r=t.getBoundingClientRect();return{left:0,right:r.right-r.left,top:e,bottom:r.bottom-(r.top+e)}}var eo=function(){function t(t,e,r){this.from=t;this.to=e;this.size=r}t.same=function(t,e){if(t.length!=e.length)return false;for(var r=0;r<t.length;r++){var n=t[r],i=e[r];if(n.from!=i.from||n.to!=i.to||n.size!=i.size)return false}return true};t.prototype.draw=function(t){return Ar.replace({widget:new ro(this.size,t)}).range(this.from,this.to)};return t}();var ro=function(t){__extends(e,t);function e(e,r){var n=t.call(this)||this;n.size=e;n.vertical=r;return n}e.prototype.eq=function(t){return t.size==this.size&&t.vertical==this.vertical};e.prototype.toDOM=function(){var t=document.createElement("div");if(this.vertical){t.style.height=this.size+"px"}else{t.style.width=this.size+"px";t.style.height="2px";t.style.display="inline-block"}return t};Object.defineProperty(e.prototype,"estimatedHeight",{get:function(){return this.vertical?this.size:-1},enumerable:false,configurable:true});return e}(Sr);var no=function(){function t(t){this.state=t;this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0};this.inView=true;this.paddingTop=0;this.paddingBottom=0;this.contentDOMWidth=0;this.contentDOMHeight=0;this.editorHeight=0;this.editorWidth=0;this.heightOracle=new _i;this.scaler=lo;this.scrollTarget=null;this.printing=false;this.mustMeasureContent=true;this.visibleRanges=[];this.mustEnforceCursorAssoc=false;this.heightMap=Wi.empty().applyChanges(t.facet(an),A.empty,this.heightOracle.setDoc(t.doc),[new fn(0,0,0,t.doc.length)]);this.viewport=this.getViewport(0,null);this.updateViewportLines();this.updateForViewport();this.lineGaps=this.ensureLineGaps([]);this.lineGapDeco=Ar.set(this.lineGaps.map((function(t){return t.draw(false)})));this.computeVisibleRanges()}t.prototype.updateForViewport=function(){var t=[this.viewport],e=this.state.selection.main;var r=function(r){var i=r?e.head:e.anchor;if(!t.some((function(t){var e=t.from,r=t.to;return i>=e&&i<=r}))){var o=n.lineBlockAt(i),a=o.from,s=o.to;t.push(new io(a,s))}};var n=this;for(var i=0;i<=1;i++){r(i)}this.viewports=t.sort((function(t,e){return t.from-e.from}));this.scaler=this.heightMap.height<=7e6?lo:new co(this.heightOracle.doc,this.heightMap,this.viewports)};t.prototype.updateViewportLines=function(){var t=this;this.viewportLines=[];this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.state.doc,0,0,(function(e){t.viewportLines.push(t.scaler.scale==1?e:ho(e,t.scaler))}))};t.prototype.update=function(t,e){if(e===void 0){e=null}var r=this.state;this.state=t.state;var n=this.state.facet(an);var i=t.changedRanges;var o=fn.extendWithRanges(i,Xi(t.startState.facet(an),n,t?t.changes:_.empty(this.state.doc.length)));var a=this.heightMap.height;this.heightMap=this.heightMap.applyChanges(n,r.doc,this.heightOracle.setDoc(this.state.doc),o);if(this.heightMap.height!=a)t.flags|=2;var s=o.length?this.mapViewport(this.viewport,t.changes):this.viewport;if(e&&(e.range.head<s.from||e.range.head>s.to)||!this.viewportIsAppropriate(s))s=this.getViewport(0,e);var f=!t.changes.empty||t.flags&2||s.from!=this.viewport.from||s.to!=this.viewport.to;this.viewport=s;this.updateForViewport();if(f)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes)));t.flags|=this.computeVisibleRanges();if(e)this.scrollTarget=e;if(!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc)this.mustEnforceCursorAssoc=true};t.prototype.measure=function(t){var e=t.contentDOM,r=window.getComputedStyle(e);var n=this.heightOracle;var i=r.whiteSpace,o=r.direction=="rtl"?ln.RTL:ln.LTR;var a=this.heightOracle.mustRefreshForStyle(i,o);var s=a||this.mustMeasureContent||this.contentDOMHeight!=e.clientHeight;var f=0,u=0;if(this.editorWidth!=t.scrollDOM.clientWidth){if(n.lineWrapping)s=true;this.editorWidth=t.scrollDOM.clientWidth;f|=8}if(s){this.mustMeasureContent=false;this.contentDOMHeight=e.clientHeight;var l=parseInt(r.paddingTop)||0,c=parseInt(r.paddingBottom)||0;if(this.paddingTop!=l||this.paddingBottom!=c){f|=8;this.paddingTop=l;this.paddingBottom=c}}var h=(this.printing?to:Zi)(e,this.paddingTop);var p=h.top-this.pixelViewport.top,d=h.bottom-this.pixelViewport.bottom;this.pixelViewport=h;var v=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(v!=this.inView){this.inView=v;if(v)s=true}if(!this.inView)return 0;var g=e.clientWidth;if(this.contentDOMWidth!=g||this.editorHeight!=t.scrollDOM.clientHeight){this.contentDOMWidth=g;this.editorHeight=t.scrollDOM.clientHeight;f|=8}if(s){var m=t.docView.measureVisibleLineHeights();if(n.mustRefreshForHeights(m))a=true;if(a||n.lineWrapping&&Math.abs(g-this.contentDOMWidth)>n.charWidth){var y=t.docView.measureTextSize(),b=y.lineHeight,w=y.charWidth;a=n.refresh(i,o,b,w,g/w,m);if(a){t.docView.minWidth=0;f|=8}}if(p>0&&d>0)u=Math.max(p,d);else if(p<0&&d<0)u=Math.min(p,d);n.heightChanged=false;this.heightMap=this.heightMap.updateHeight(n,0,a,new Vi(this.viewport.from,m));if(n.heightChanged)f|=2}var x=!this.viewportIsAppropriate(this.viewport,u)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);if(x)this.viewport=this.getViewport(u,this.scrollTarget);this.updateForViewport();if(f&2||x)this.updateViewportLines();if(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)this.updateLineGaps(this.ensureLineGaps(a?[]:this.lineGaps));f|=this.computeVisibleRanges();if(this.mustEnforceCursorAssoc){this.mustEnforceCursorAssoc=false;t.docView.enforceCursorAssoc()}return f};Object.defineProperty(t.prototype,"visibleTop",{get:function(){return this.scaler.fromDOM(this.pixelViewport.top)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"visibleBottom",{get:function(){return this.scaler.fromDOM(this.pixelViewport.bottom)},enumerable:false,configurable:true});t.prototype.getViewport=function(t,e){var r=.5-Math.max(-.5,Math.min(.5,t/1e3/2));var n=this.heightMap,i=this.state.doc,o=this,a=o.visibleTop,s=o.visibleBottom;var f=new io(n.lineAt(a-r*1e3,Fi.ByHeight,i,0,0).from,n.lineAt(s+(1-r)*1e3,Fi.ByHeight,i,0,0).to);if(e){var u=e.range.head;if(u<f.from||u>f.to){var l=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top);var c=n.lineAt(u,Fi.ByPos,i,0,0),h=void 0;if(e.y=="center")h=(c.top+c.bottom)/2-l/2;else if(e.y=="start"||e.y=="nearest"&&u<f.from)h=c.top;else h=c.bottom-l;f=new io(n.lineAt(h-1e3/2,Fi.ByHeight,i,0,0).from,n.lineAt(h+l+1e3/2,Fi.ByHeight,i,0,0).to)}}return f};t.prototype.mapViewport=function(t,e){var r=e.mapPos(t.from,-1),n=e.mapPos(t.to,1);return new io(this.heightMap.lineAt(r,Fi.ByPos,this.state.doc,0,0).from,this.heightMap.lineAt(n,Fi.ByPos,this.state.doc,0,0).to)};t.prototype.viewportIsAppropriate=function(t,e){var r=t.from,n=t.to;if(e===void 0){e=0}if(!this.inView)return true;var i=this.heightMap.lineAt(r,Fi.ByPos,this.state.doc,0,0).top;var o=this.heightMap.lineAt(n,Fi.ByPos,this.state.doc,0,0).bottom;var a=this,s=a.visibleTop,f=a.visibleBottom;return(r==0||i<=s-Math.max(10,Math.min(-e,250)))&&(n==this.state.doc.length||o>=f+Math.max(10,Math.min(e,250)))&&(i>s-2*1e3&&o<f+2*1e3)};t.prototype.mapLineGaps=function(t,e){if(!t.length||e.empty)return t;var r=[];for(var n=0,i=t;n<i.length;n++){var o=i[n];if(!e.touchesRange(o.from,o.to))r.push(new eo(e.mapPos(o.from),e.mapPos(o.to),o.size))}return r};t.prototype.ensureLineGaps=function(t){var e=[];if(this.heightOracle.direction!=ln.LTR)return e;var r=function(r){if(r.length<4e3)return"continue";var i=oo(r.from,r.to,n.state);if(i.total<4e3)return"continue";var o=void 0,a=void 0;if(n.heightOracle.lineWrapping){var s=2e3/n.heightOracle.lineLength*n.heightOracle.lineHeight;o=ao(i,(n.visibleTop-r.top-s)/r.height);a=ao(i,(n.visibleBottom-r.top+s)/r.height)}else{var f=i.total*n.heightOracle.charWidth;var u=2e3*n.heightOracle.charWidth;o=ao(i,(n.pixelViewport.left-u)/f);a=ao(i,(n.pixelViewport.right+u)/f)}var l=[];if(o>r.from)l.push({from:r.from,to:o});if(a<r.to)l.push({from:a,to:r.to});var c=n.state.selection.main;if(c.from>=r.from&&c.from<=r.to)fo(l,c.from-10,c.from+10);if(!c.empty&&c.to>=r.from&&c.to<=r.to)fo(l,c.to-10,c.to+10);var h=function(o,a){if(a-o>1e3){e.push(uo(t,(function(t){return t.from>=r.from&&t.to<=r.to&&Math.abs(t.from-o)<1e3&&Math.abs(t.to-a)<1e3}))||new eo(o,a,n.gapSize(r,o,a,i)))}};for(var p=0,d=l;p<d.length;p++){var v=d[p],g=v.from,m=v.to;h(g,m)}};var n=this;for(var i=0,o=this.viewportLines;i<o.length;i++){var a=o[i];r(a)}return e};t.prototype.gapSize=function(t,e,r,n){var i=so(n,r)-so(n,e);if(this.heightOracle.lineWrapping){return t.height*i}else{return n.total*this.heightOracle.charWidth*i}};t.prototype.updateLineGaps=function(t){var e=this;if(!eo.same(t,this.lineGaps)){this.lineGaps=t;this.lineGapDeco=Ar.set(t.map((function(t){return t.draw(e.heightOracle.lineWrapping)})))}};t.prototype.computeVisibleRanges=function(){var t=this.state.facet(an);if(this.lineGaps.length)t=t.concat(this.lineGapDeco);var e=[];Xt.spans(t,this.viewport.from,this.viewport.to,{span:function(t,r){e.push({from:t,to:r})},point:function(){}},20);var r=e.length!=this.visibleRanges.length||this.visibleRanges.some((function(t,r){return t.from!=e[r].from||t.to!=e[r].to}));this.visibleRanges=e;return r?4:0};t.prototype.lineBlockAt=function(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find((function(e){return e.from<=t&&e.to>=t}))||ho(this.heightMap.lineAt(t,Fi.ByPos,this.state.doc,0,0),this.scaler)};t.prototype.lineBlockAtHeight=function(t){return ho(this.heightMap.lineAt(this.scaler.fromDOM(t),Fi.ByHeight,this.state.doc,0,0),this.scaler)};t.prototype.elementAtHeight=function(t){return ho(this.heightMap.blockAt(this.scaler.fromDOM(t),this.state.doc,0,0),this.scaler)};Object.defineProperty(t.prototype,"docHeight",{get:function(){return this.scaler.toDOM(this.heightMap.height)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this.docHeight+this.paddingTop+this.paddingBottom},enumerable:false,configurable:true});return t}();var io=function(){function t(t,e){this.from=t;this.to=e}return t}();function oo(t,e,r){var n=[],i=t,o=0;Xt.spans(r.facet(an),t,e,{span:function(){},point:function(t,e){if(t>i){n.push({from:i,to:t});o+=t-i}i=e}},20);if(i<e){n.push({from:i,to:e});o+=e-i}return{total:o,ranges:n}}function ao(t,e){var r=t.total,n=t.ranges;if(e<=0)return n[0].from;if(e>=1)return n[n.length-1].to;var i=Math.floor(r*e);for(var o=0;;o++){var a=n[o],s=a.from,f=a.to,u=f-s;if(i<=u)return s+i;i-=u}}function so(t,e){var r=0;for(var n=0,i=t.ranges;n<i.length;n++){var o=i[n],a=o.from,s=o.to;if(e<=s){r+=e-a;break}r+=s-a}return r/t.total}function fo(t,e,r){for(var n=0;n<t.length;n++){var i=t[n];if(i.from<r&&i.to>e){var o=[];if(i.from<e)o.push({from:i.from,to:e});if(i.to>r)o.push({from:r,to:i.to});t.splice.apply(t,__spreadArray([n,1],o,false));n+=o.length-1}}}function uo(t,e){for(var r=0,n=t;r<n.length;r++){var i=n[r];if(e(i))return i}return undefined}var lo={toDOM:function(t){return t},fromDOM:function(t){return t},scale:1};var co=function(){function t(t,e,r){var n=0,i=0,o=0;this.viewports=r.map((function(r){var i=r.from,o=r.to;var a=e.lineAt(i,Fi.ByPos,t,0,0).top;var s=e.lineAt(o,Fi.ByPos,t,0,0).bottom;n+=s-a;return{from:i,to:o,top:a,bottom:s,domTop:0,domBottom:0}}));this.scale=(7e6-n)/(e.height-n);for(var a=0,s=this.viewports;a<s.length;a++){var f=s[a];f.domTop=o+(f.top-i)*this.scale;o=f.domBottom=f.domTop+(f.bottom-f.top);i=f.bottom}}t.prototype.toDOM=function(t){for(var e=0,r=0,n=0;;e++){var i=e<this.viewports.length?this.viewports[e]:null;if(!i||t<i.top)return n+(t-r)*this.scale;if(t<=i.bottom)return i.domTop+(t-i.top);r=i.bottom;n=i.domBottom}};t.prototype.fromDOM=function(t){for(var e=0,r=0,n=0;;e++){var i=e<this.viewports.length?this.viewports[e]:null;if(!i||t<i.domTop)return r+(t-n)/this.scale;if(t<=i.domBottom)return i.top+(t-i.domTop);r=i.bottom;n=i.domBottom}};return t}();function ho(t,e){if(e.scale==1)return t;var r=e.toDOM(t.top),n=e.toDOM(t.bottom);return new Hi(t.from,t.length,r,n-r,Array.isArray(t.type)?t.type.map((function(t){return ho(t,e)})):t.type)}var po=Y.define({combine:function(t){return t.join(" ")}});var vo=Y.define({combine:function(t){return t.indexOf(true)>-1}});var go=qt.newName(),mo=qt.newName(),yo=qt.newName();var bo={"&light":"."+mo,"&dark":"."+yo};function wo(t,e,r){return new qt(e,{finish:function(e){return/&/.test(e)?e.replace(/&\w*/,(function(e){if(e=="&")return t;if(!r||!r[e])throw new RangeError("Unsupported selector: ".concat(e));return r[e]})):t+" "+e}})}var xo=wo("."+go,{"&.cm-editor":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,minHeight:"100%",display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere"},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 4px"},".cm-selectionLayer":{zIndex:-1,contain:"size style"},".cm-selectionBackground":{position:"absolute"},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{zIndex:100,contain:"size style",pointerEvents:"none"},"&.cm-focused .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{visibility:"hidden"},"100%":{}},".cm-cursor, .cm-dropCursor":{position:"absolute",borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},"&.cm-focused .cm-cursor":{display:"block"},"&light .cm-activeLine":{backgroundColor:"#f3f9ff"},"&dark .cm-activeLine":{backgroundColor:"#223039"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},bo);var ko={childList:true,characterData:true,subtree:true,attributes:true,characterDataOldValue:true};var So=ar.ie&&ar.ie_version<=11;var Co=function(){function t(t,e,r){var n=this;this.view=t;this.onChange=e;this.onScrollChanged=r;this.active=false;this.selectionRange=new Be;this.selectionChanged=false;this.delayedFlush=-1;this.resizeTimeout=-1;this.queue=[];this.delayedAndroidKey=null;this.scrollTargets=[];this.intersection=null;this.resize=null;this.intersecting=false;this.gapIntersection=null;this.gaps=[];this.parentCheck=-1;this.dom=t.contentDOM;this.observer=new MutationObserver((function(e){for(var r=0,i=e;r<i.length;r++){var o=i[r];n.queue.push(o)}if((ar.ie&&ar.ie_version<=11||ar.ios&&t.composing)&&e.some((function(t){return t.type=="childList"&&t.removedNodes.length||t.type=="characterData"&&t.oldValue.length>t.target.nodeValue.length})))n.flushSoon();else n.flush()}));if(So)this.onCharData=function(t){n.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue});n.flushSoon()};this.onSelectionChange=this.onSelectionChange.bind(this);window.addEventListener("resize",this.onResize=this.onResize.bind(this));if(typeof ResizeObserver=="function"){this.resize=new ResizeObserver((function(){if(n.view.docView.lastUpdate<Date.now()-75)n.onResize()}));this.resize.observe(t.scrollDOM)}window.addEventListener("beforeprint",this.onPrint=this.onPrint.bind(this));this.start();window.addEventListener("scroll",this.onScroll=this.onScroll.bind(this));if(typeof IntersectionObserver=="function"){this.intersection=new IntersectionObserver((function(t){if(n.parentCheck<0)n.parentCheck=setTimeout(n.listenForScroll.bind(n),1e3);if(t.length>0&&t[t.length-1].intersectionRatio>0!=n.intersecting){n.intersecting=!n.intersecting;if(n.intersecting!=n.view.inView)n.onScrollChanged(document.createEvent("Event"))}}),{});this.intersection.observe(this.dom);this.gapIntersection=new IntersectionObserver((function(t){if(t.length>0&&t[t.length-1].intersectionRatio>0)n.onScrollChanged(document.createEvent("Event"))}),{})}this.listenForScroll();this.readSelectionRange();this.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}t.prototype.onScroll=function(t){if(this.intersecting)this.flush(false);this.onScrollChanged(t)};t.prototype.onResize=function(){var t=this;if(this.resizeTimeout<0)this.resizeTimeout=setTimeout((function(){t.resizeTimeout=-1;t.view.requestMeasure()}),50)};t.prototype.onPrint=function(){var t=this;this.view.viewState.printing=true;this.view.measure();setTimeout((function(){t.view.viewState.printing=false;t.view.requestMeasure()}),500)};t.prototype.updateGaps=function(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((function(e,r){return e!=t[r]})))){this.gapIntersection.disconnect();for(var e=0,r=t;e<r.length;e++){var n=r[e];this.gapIntersection.observe(n)}this.gaps=t}};t.prototype.onSelectionChange=function(t){if(!this.readSelectionRange()||this.delayedAndroidKey)return;var e=this.view,r=this.selectionRange;if(e.state.facet($r)?e.root.activeElement!=this.dom:!Ce(e.dom,r))return;var n=r.anchorNode&&e.docView.nearest(r.anchorNode);if(n&&n.ignoreEvent(t))return;if((ar.ie&&ar.ie_version<=11||ar.android&&ar.chrome)&&!e.state.selection.main.empty&&r.focusNode&&Oe(r.focusNode,r.focusOffset,r.anchorNode,r.anchorOffset))this.flushSoon();else this.flush(false)};t.prototype.readSelectionRange=function(){var t=this.view.root,e=xe(t);var r=ar.safari&&t.nodeType==11&&Se()==this.view.contentDOM&&Oo(this.view)||e;if(this.selectionRange.eq(r))return false;this.selectionRange.setRange(r);return this.selectionChanged=true};t.prototype.setSelectionRange=function(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset);this.selectionChanged=false};t.prototype.listenForScroll=function(){this.parentCheck=-1;var t=0,e=null;for(var r=this.dom;r;){if(r.nodeType==1){if(!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==r)t++;else if(!e)e=this.scrollTargets.slice(0,t);if(e)e.push(r);r=r.assignedSlot||r.parentNode}else if(r.nodeType==11){r=r.host}else{break}}if(t<this.scrollTargets.length&&!e)e=this.scrollTargets.slice(0,t);if(e){for(var n=0,i=this.scrollTargets;n<i.length;n++){var r=i[n];r.removeEventListener("scroll",this.onScroll)}for(var o=0,a=this.scrollTargets=e;o<a.length;o++){var r=a[o];r.addEventListener("scroll",this.onScroll)}}};t.prototype.ignore=function(t){if(!this.active)return t();try{this.stop();return t()}finally{this.start();this.clear()}};t.prototype.start=function(){if(this.active)return;this.observer.observe(this.dom,ko);if(So)this.dom.addEventListener("DOMCharacterDataModified",this.onCharData);this.active=true};t.prototype.stop=function(){if(!this.active)return;this.active=false;this.observer.disconnect();if(So)this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData)};t.prototype.clear=function(){this.processRecords();this.queue.length=0;this.selectionChanged=false};t.prototype.delayAndroidKey=function(t,e){var r=this;if(!this.delayedAndroidKey)requestAnimationFrame((function(){var t=r.delayedAndroidKey;r.delayedAndroidKey=null;var e=r.view.state;if(Ve(r.view.contentDOM,t.key,t.keyCode))r.processRecords();else r.flush();if(r.view.state==e)r.view.update([])}));if(!this.delayedAndroidKey||t=="Enter")this.delayedAndroidKey={key:t,keyCode:e}};t.prototype.flushSoon=function(){var t=this;if(this.delayedFlush<0)this.delayedFlush=window.setTimeout((function(){t.delayedFlush=-1;t.flush()}),20)};t.prototype.forceFlush=function(){if(this.delayedFlush>=0){window.clearTimeout(this.delayedFlush);this.delayedFlush=-1;this.flush()}};t.prototype.processRecords=function(){var t=this.queue;for(var e=0,r=this.observer.takeRecords();e<r.length;e++){var n=r[e];t.push(n)}if(t.length)this.queue=[];var i=-1,o=-1,a=false;for(var s=0,f=t;s<f.length;s++){var u=f[s];var l=this.readMutation(u);if(!l)continue;if(l.typeOver)a=true;if(i==-1){i=l.from,o=l.to}else{i=Math.min(l.from,i);o=Math.max(l.to,o)}}return{from:i,to:o,typeOver:a}};t.prototype.flush=function(t){if(t===void 0){t=true}if(this.delayedFlush>=0||this.delayedAndroidKey)return;if(t)this.readSelectionRange();var e=this.processRecords(),r=e.from,n=e.to,i=e.typeOver;var o=this.selectionChanged&&Ce(this.dom,this.selectionRange);if(r<0&&!o)return;this.selectionChanged=false;var a=this.view.state;this.onChange(r,n,i);if(this.view.state==a)this.view.update([])};t.prototype.readMutation=function(t){var e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;e.markDirty(t.type=="attributes");if(t.type=="attributes")e.dirty|=4;if(t.type=="childList"){var r=Ao(e,t.previousSibling||t.target.previousSibling,-1);var n=Ao(e,t.nextSibling||t.target.nextSibling,1);return{from:r?e.posAfter(r):e.posAtStart,to:n?e.posBefore(n):e.posAtEnd,typeOver:false}}else if(t.type=="characterData"){return{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}}else{return null}};t.prototype.destroy=function(){var t,e,r;this.stop();(t=this.intersection)===null||t===void 0?void 0:t.disconnect();(e=this.gapIntersection)===null||e===void 0?void 0:e.disconnect();(r=this.resize)===null||r===void 0?void 0:r.disconnect();for(var n=0,i=this.scrollTargets;n<i.length;n++){var o=i[n];o.removeEventListener("scroll",this.onScroll)}window.removeEventListener("scroll",this.onScroll);window.removeEventListener("resize",this.onResize);window.removeEventListener("beforeprint",this.onPrint);this.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange);clearTimeout(this.parentCheck);clearTimeout(this.resizeTimeout)};return t}();function Ao(t,e,r){while(e){var n=qe.get(e);if(n&&n.parent==t)return n;var i=e.parentNode;e=i!=t.dom?i:r>0?e.nextSibling:e.previousSibling}return null}function Oo(t){var e;var r=null;function n(t){t.preventDefault();t.stopImmediatePropagation();r=t.getTargetRanges()[0]}t.contentDOM.addEventListener("beforeinput",n,true);document.execCommand("indent");t.contentDOM.removeEventListener("beforeinput",n,true);if(!r)return null;var i=r.startContainer,o=r.startOffset;var a=r.endContainer,s=r.endOffset;var f=t.docView.domAtPos(t.state.selection.main.anchor);if(Oe(f.node,f.offset,a,s))e=[a,s,i,o],i=e[0],o=e[1],a=e[2],s=e[3];return{anchorNode:i,anchorOffset:o,focusNode:a,focusOffset:s}}function Mo(t,e,r,n){var i,o;var a=t.state.selection.main;if(e>-1){var s=t.docView.domBoundsAround(e,r,0);if(!s||t.state.readOnly)return;var f=s.from,u=s.to;var l=t.docView.impreciseHead||t.docView.impreciseAnchor?[]:Po(t);var c=new Rn(l,t.state);c.readRange(s.startDOM,s.endDOM);var h=a.from,p=null;if(t.inputState.lastKeyCode===8&&t.inputState.lastKeyTime>Date.now()-100||ar.android&&c.text.length<u-f){h=a.to;p="end"}var d=Do(t.state.doc.sliceString(f,u,En),c.text,h-f,p);if(d){if(ar.chrome&&t.inputState.lastKeyCode==13&&d.toB==d.from+2&&c.text.slice(d.from,d.toB)==En+En)d.toB--;i={from:f+d.from,to:f+d.toA,insert:A.of(c.text.slice(d.from,d.toB).split(En))}}o=To(l,f)}else if(t.hasFocus||!t.state.facet($r)){var v=t.observer.selectionRange;var g=t.docView,m=g.impreciseHead,y=g.impreciseAnchor;var b=m&&m.node==v.focusNode&&m.offset==v.focusOffset||!ke(t.contentDOM,v.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(v.focusNode,v.focusOffset);var w=y&&y.node==v.anchorNode&&y.offset==v.anchorOffset||!ke(t.contentDOM,v.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(v.anchorNode,v.anchorOffset);if(b!=a.head||w!=a.anchor)o=G.single(w,b)}if(!i&&!o)return;if(!i&&n&&!a.empty&&o&&o.main.empty)i={from:a.from,to:a.to,insert:t.state.doc.slice(a.from,a.to)};else if(i&&i.from>=a.from&&i.to<=a.to&&(i.from!=a.from||i.to!=a.to)&&a.to-a.from-(i.to-i.from)<=4)i={from:a.from,to:a.to,insert:t.state.doc.slice(a.from,i.from).append(i.insert).append(t.state.doc.slice(i.to,a.to))};if(i){var x=t.state;if(ar.ios&&t.inputState.flushIOSKey(t))return;if(ar.android&&(i.from==a.from&&i.to==a.to&&i.insert.length==1&&i.insert.lines==2&&Ve(t.contentDOM,"Enter",13)||i.from==a.from-1&&i.to==a.to&&i.insert.length==0&&Ve(t.contentDOM,"Backspace",8)||i.from==a.from&&i.to==a.to+1&&i.insert.length==0&&Ve(t.contentDOM,"Delete",46)))return;var k=i.insert.toString();if(t.state.facet(Wr).some((function(e){return e(t,i.from,i.to,k)})))return;if(t.inputState.composing>=0)t.inputState.composing++;var S=void 0;if(i.from>=a.from&&i.to<=a.to&&i.to-i.from>=(a.to-a.from)/3&&(!o||o.main.empty&&o.main.from==i.from+i.insert.length)&&t.inputState.composing<0){var C=a.from<i.from?x.sliceDoc(a.from,i.from):"";var O=a.to>i.to?x.sliceDoc(i.to,a.to):"";S=x.replaceSelection(t.state.toText(C+i.insert.sliceString(0,undefined,t.state.lineBreak)+O))}else{var M=x.changes(i);var D=o&&!x.selection.main.eq(o.main)&&o.main.to<=M.newLength?o.main:undefined;if(x.selection.ranges.length>1&&t.inputState.composing>=0&&i.to<=a.to&&i.to>=a.to-10){var P=t.state.sliceDoc(i.from,i.to);var T=_n(t)||t.state.doc.lineAt(a.head);var E=a.to-i.to,R=a.to-a.from;S=x.changeByRange((function(e){if(e.from==a.from&&e.to==a.to)return{changes:M,range:D||e.map(M)};var r=e.to-E,n=r-P.length;if(e.to-e.from!=R||t.state.sliceDoc(n,r)!=P||T&&e.to>=T.from&&e.from<=T.to)return{range:e};var o=x.changes({from:n,to:r,insert:i.insert}),s=e.to-a.to;return{changes:o,range:!D?e.map(o):G.range(Math.max(0,D.anchor+s),Math.max(0,D.head+s))}}))}else{S={changes:M,selection:D&&x.selection.replaceRange(D)}}}var L="input.type";if(t.composing){L+=".compose";if(t.inputState.compositionFirstChange){L+=".start";t.inputState.compositionFirstChange=false}}t.dispatch(S,{scrollIntoView:true,userEvent:L})}else if(o&&!o.main.eq(a)){var B=false,L="select";if(t.inputState.lastSelectionTime>Date.now()-50){if(t.inputState.lastSelectionOrigin=="select")B=true;L=t.inputState.lastSelectionOrigin}t.dispatch({selection:o,scrollIntoView:B,userEvent:L})}}function Do(t,e,r,n){var i=Math.min(t.length,e.length);var o=0;while(o<i&&t.charCodeAt(o)==e.charCodeAt(o))o++;if(o==i&&t.length==e.length)return null;var a=t.length,s=e.length;while(a>0&&s>0&&t.charCodeAt(a-1)==e.charCodeAt(s-1)){a--;s--}if(n=="end"){var f=Math.max(0,o-Math.min(a,s));r-=a+f-o}if(a<o&&t.length<e.length){var u=r<=o&&r>=a?o-r:0;o-=u;s=o+(s-a);a=o}else if(s<o){var u=r<=o&&r>=s?o-r:0;o-=u;a=o+(a-s);s=o}return{from:o,toA:a,toB:s}}function Po(t){var e=[];if(t.root.activeElement!=t.contentDOM)return e;var r=t.observer.selectionRange,n=r.anchorNode,i=r.anchorOffset,o=r.focusNode,a=r.focusOffset;if(n){e.push(new Bn(n,i));if(o!=n||a!=i)e.push(new Bn(o,a))}return e}function To(t,e){if(t.length==0)return null;var r=t[0].pos,n=t.length==2?t[1].pos:r;return r>-1&&n>-1?G.single(r+e,n+e):null}var Eo=function(){function t(t){var e=this;if(t===void 0){t={}}this.plugins=[];this.pluginMap=new Map;this.editorAttrs={};this.contentAttrs={};this.bidiCache=[];this.destroyed=false;this.updateState=2;this.measureScheduled=-1;this.measureRequests=[];this.contentDOM=document.createElement("div");this.scrollDOM=document.createElement("div");this.scrollDOM.tabIndex=-1;this.scrollDOM.className="cm-scroller";this.scrollDOM.appendChild(this.contentDOM);this.announceDOM=document.createElement("div");this.announceDOM.style.cssText="position: absolute; top: -10000px";this.announceDOM.setAttribute("aria-live","polite");this.dom=document.createElement("div");this.dom.appendChild(this.announceDOM);this.dom.appendChild(this.scrollDOM);this._dispatch=t.dispatch||function(t){return e.update([t])};this.dispatch=this.dispatch.bind(this);this.root=t.root||He(t.parent)||document;this.viewState=new no(t.state||_t.create());this.plugins=this.state.facet(Zr).map((function(t){return new rn(t)}));for(var r=0,n=this.plugins;r<n.length;r++){var i=n[r];i.update(this)}this.observer=new Co(this,(function(t,r,n){Mo(e,t,r,n)}),(function(t){e.inputState.runScrollHandlers(e,t);if(e.observer.intersecting)e.measure()}));this.inputState=new fi(this);this.docView=new In(this);this.mountStyles();this.updateAttrs();this.updateState=0;this.requestMeasure();if(t.parent)t.parent.appendChild(this.dom)}Object.defineProperty(t.prototype,"state",{get:function(){return this.viewState.state},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"viewport",{get:function(){return this.viewState.viewport},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"visibleRanges",{get:function(){return this.viewState.visibleRanges},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"inView",{get:function(){return this.viewState.inView},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"composing",{get:function(){return this.inputState.composing>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"compositionStarted",{get:function(){return this.inputState.composing>=0},enumerable:false,configurable:true});t.prototype.dispatch=function(){var t;var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}this._dispatch(e.length==1&&e[0]instanceof Ct?e[0]:(t=this.state).update.apply(t,e))};t.prototype.update=function(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");var e=false,r;var n=this.state;for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=a.state}if(this.destroyed){this.viewState.state=n;return}if(n.facet(_t.phrases)!=this.state.facet(_t.phrases))return this.setState(n);r=new un(this,n,t);var s=this.viewState.scrollTarget;try{this.updateState=2;for(var f=0,u=t;f<u.length;f++){var a=u[f];if(s)s=s.map(a.changes);if(a.scrollIntoView){var l=a.state.selection.main;s=new Gr(l.empty?l:G.cursor(l.head,l.head>l.anchor?-1:1))}for(var c=0,h=a.effects;c<h.length;c++){var p=h[c];if(p.is(qr))s=new Gr(p.value);else if(p.is(Ur))s=new Gr(p.value,"center");else if(p.is(Kr))s=p.value}}this.viewState.update(r,s);this.bidiCache=Io.update(this.bidiCache,r.changes);if(!r.empty){this.updatePlugins(r);this.inputState.update(r)}e=this.docView.update(r);if(this.state.facet(sn)!=this.styleModules)this.mountStyles();this.updateAttrs();this.showAnnouncements(t);this.docView.updateSelection(e,t.some((function(t){return t.isUserEvent("select.pointer")})))}finally{this.updateState=0}if(r.startState.facet(po)!=r.state.facet(po))this.viewState.mustMeasureContent=true;if(e||s||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)this.requestMeasure();if(!r.empty)for(var d=0,v=this.state.facet(zr);d<v.length;d++){var g=v[d];g(r)}};t.prototype.setState=function(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;var e=this.hasFocus;try{for(var r=0,n=this.plugins;r<n.length;r++){var i=n[r];i.destroy(this)}this.viewState=new no(t);this.plugins=t.facet(Zr).map((function(t){return new rn(t)}));this.pluginMap.clear();for(var o=0,a=this.plugins;o<a.length;o++){var i=a[o];i.update(this)}this.docView=new In(this);this.inputState.ensureHandlers(this);this.mountStyles();this.updateAttrs();this.bidiCache=[]}finally{this.updateState=0}if(e)this.focus();this.requestMeasure()};t.prototype.updatePlugins=function(t){var e=t.startState.facet(Zr),r=t.state.facet(Zr);if(e!=r){var n=[];for(var i=0,o=r;i<o.length;i++){var a=o[i];var s=e.indexOf(a);if(s<0){n.push(new rn(a))}else{var f=this.plugins[s];f.mustUpdate=t;n.push(f)}}for(var u=0,l=this.plugins;u<l.length;u++){var f=l[u];if(f.mustUpdate!=t)f.destroy(this)}this.plugins=n;this.pluginMap.clear();this.inputState.ensureHandlers(this)}else{for(var c=0,h=this.plugins;c<h.length;c++){var p=h[c];p.mustUpdate=t}}for(var d=0;d<this.plugins.length;d++)this.plugins[d].update(this)};t.prototype.measure=function(t){var e;var r=this;if(t===void 0){t=true}if(this.destroyed)return;if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.measureScheduled=0;if(t)this.observer.flush();var n=null;try{for(var i=0;;i++){this.updateState=1;var o=this.viewport;var a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(i>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}var s=[];if(!(a&4))e=[s,this.measureRequests],this.measureRequests=e[0],s=e[1];var f=s.map((function(t){try{return t.read(r)}catch(e){Jr(r.state,e);return Bo}}));var u=new un(this,this.state),l=false,c=false;u.flags|=a;if(!n)n=u;else n.flags|=a;this.updateState=2;if(!u.empty){this.updatePlugins(u);this.inputState.update(u);this.updateAttrs();l=this.docView.update(u)}for(var h=0;h<s.length;h++)if(f[h]!=Bo){try{var p=s[h];if(p.write)p.write(f[h],this)}catch(m){Jr(this.state,m)}}if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget);this.viewState.scrollTarget=null;c=true}if(l)this.docView.updateSelection(true);if(this.viewport.from==o.from&&this.viewport.to==o.to&&!c&&this.measureRequests.length==0)break}}finally{this.updateState=0;this.measureScheduled=-1}if(n&&!n.empty)for(var d=0,v=this.state.facet(zr);d<v.length;d++){var g=v[d];g(n)}};Object.defineProperty(t.prototype,"themeClasses",{get:function(){return go+" "+(this.state.facet(vo)?yo:mo)+" "+this.state.facet(po)},enumerable:false,configurable:true});t.prototype.updateAttrs=function(){var t=this;var e=No(this,nn,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses});var r={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:!this.state.facet($r)?"false":"true",class:"cm-content",style:"".concat(ar.tabSize,": ").concat(this.state.tabSize),role:"textbox","aria-multiline":"true"};if(this.state.readOnly)r["aria-readonly"]="true";No(this,on,r);this.observer.ignore((function(){kr(t.contentDOM,t.contentAttrs,r);kr(t.dom,t.editorAttrs,e)}));this.editorAttrs=e;this.contentAttrs=r};t.prototype.showAnnouncements=function(e){var r=true;for(var n=0,i=e;n<i.length;n++){var o=i[n];for(var a=0,s=o.effects;a<s.length;a++){var f=s[a];if(f.is(t.announce)){if(r)this.announceDOM.textContent="";r=false;var u=this.announceDOM.appendChild(document.createElement("div"));u.textContent=f.value}}}};t.prototype.mountStyles=function(){this.styleModules=this.state.facet(sn);qt.mount(this.root,this.styleModules.concat(xo).reverse())};t.prototype.readMeasured=function(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");if(this.updateState==0&&this.measureScheduled>-1)this.measure(false)};t.prototype.requestMeasure=function(t){var e=this;if(this.measureScheduled<0)this.measureScheduled=requestAnimationFrame((function(){return e.measure()}));if(t){if(t.key!=null)for(var r=0;r<this.measureRequests.length;r++){if(this.measureRequests[r].key===t.key){this.measureRequests[r]=t;return}}this.measureRequests.push(t)}};t.prototype.pluginField=function(t){var e=[];for(var r=0,n=this.plugins;r<n.length;r++){var i=n[r];i.update(this).takeField(t,e)}return e};t.prototype.plugin=function(t){var e=this.pluginMap.get(t);if(e===undefined||e&&e.spec!=t)this.pluginMap.set(t,e=this.plugins.find((function(e){return e.spec==t}))||null);return e&&e.update(this).value};Object.defineProperty(t.prototype,"documentTop",{get:function(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"documentPadding",{get:function(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}},enumerable:false,configurable:true});t.prototype.blockAtHeight=function(t,e){var r=Lo(e,this);return this.elementAtHeight(t-r).moveY(r)};t.prototype.elementAtHeight=function(t){this.readMeasured();return this.viewState.elementAtHeight(t)};t.prototype.visualLineAtHeight=function(t,e){var r=Lo(e,this);return this.lineBlockAtHeight(t-r).moveY(r)};t.prototype.lineBlockAtHeight=function(t){this.readMeasured();return this.viewState.lineBlockAtHeight(t)};t.prototype.viewportLines=function(t,e){var r=Lo(e,this);for(var n=0,i=this.viewportLineBlocks;n<i.length;n++){var o=i[n];t(o.moveY(r))}};Object.defineProperty(t.prototype,"viewportLineBlocks",{get:function(){return this.viewState.viewportLines},enumerable:false,configurable:true});t.prototype.visualLineAt=function(t,e){if(e===void 0){e=0}return this.lineBlockAt(t).moveY(e+this.viewState.paddingTop)};t.prototype.lineBlockAt=function(t){return this.viewState.lineBlockAt(t)};Object.defineProperty(t.prototype,"contentHeight",{get:function(){return this.viewState.contentHeight},enumerable:false,configurable:true});t.prototype.moveByChar=function(t,e,r){return si(this,t,ii(this,t,e,r))};t.prototype.moveByGroup=function(t,e){var r=this;return si(this,t,ii(this,t,e,(function(e){return oi(r,t.head,e)})))};t.prototype.moveToLineBoundary=function(t,e,r){if(r===void 0){r=true}return ni(this,t,e,r)};t.prototype.moveVertically=function(t,e,r){return si(this,t,ai(this,t,e,r))};t.prototype.scrollPosIntoView=function(t){this.dispatch({effects:qr.of(G.cursor(t))})};t.prototype.domAtPos=function(t){return this.docView.domAtPos(t)};t.prototype.posAtDOM=function(t,e){if(e===void 0){e=0}return this.docView.posFromDOM(t,e)};t.prototype.posAtCoords=function(t,e){if(e===void 0){e=true}this.readMeasured();return ti(this,t,e)};t.prototype.coordsAtPos=function(t,e){if(e===void 0){e=1}this.readMeasured();var r=this.docView.coordsAt(t,e);if(!r||r.left==r.right)return r;var n=this.state.doc.lineAt(t),i=this.bidiSpans(n);var o=i[An.find(i,t-n.from,-1,e)];return Ee(r,o.dir==ln.LTR==e>0)};Object.defineProperty(t.prototype,"defaultCharacterWidth",{get:function(){return this.viewState.heightOracle.charWidth},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"defaultLineHeight",{get:function(){return this.viewState.heightOracle.lineHeight},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"textDirection",{get:function(){return this.viewState.heightOracle.direction},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"lineWrapping",{get:function(){return this.viewState.heightOracle.lineWrapping},enumerable:false,configurable:true});t.prototype.bidiSpans=function(t){if(t.length>Ro)return Dn(t.length);var e=this.textDirection;for(var r=0,n=this.bidiCache;r<n.length;r++){var i=n[r];if(i.from==t.from&&i.dir==e)return i.order}var o=Mn(t.text,this.textDirection);this.bidiCache.push(new Io(t.from,t.to,e,o));return o};Object.defineProperty(t.prototype,"hasFocus",{get:function(){var t;return(document.hasFocus()||ar.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM},enumerable:false,configurable:true});t.prototype.focus=function(){var t=this;this.observer.ignore((function(){Ne(t.contentDOM);t.docView.updateSelection()}))};t.prototype.destroy=function(){for(var t=0,e=this.plugins;t<e.length;t++){var r=e[t];r.destroy(this)}this.plugins=[];this.inputState.destroy();this.dom.remove();this.observer.destroy();if(this.measureScheduled>-1)cancelAnimationFrame(this.measureScheduled);this.destroyed=true};t.scrollIntoView=function(t,e){if(e===void 0){e={}}return Kr.of(new Gr(typeof t=="number"?G.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))};t.domEventHandlers=function(t){return tn.define((function(){return{}}),{eventHandlers:t})};t.theme=function(t,e){var r=qt.newName();var n=[po.of(r),sn.of(wo(".".concat(r),t))];if(e&&e.dark)n.push(vo.of(true));return n};t.baseTheme=function(t){return ot.lowest(sn.of(wo("."+go,t,bo)))};return t}();t("E",Eo);Eo.scrollTo=qr;Eo.centerOn=Ur;Eo.styleModule=sn;Eo.inputHandler=Wr;Eo.exceptionSink=Fr;Eo.updateListener=zr;Eo.editable=$r;Eo.mouseSelectionStyle=Hr;Eo.dragMovesSelection=Vr;Eo.clickAddsSelectionRange=_r;Eo.decorations=an;Eo.darkTheme=vo;Eo.contentAttributes=on;Eo.editorAttributes=nn;Eo.lineWrapping=Eo.contentAttributes.of({class:"cm-lineWrapping"});Eo.announce=St.define();var Ro=4096;function Lo(t,e){return(t==null?e.contentDOM.getBoundingClientRect().top:t)+e.viewState.paddingTop}var Bo={};var Io=function(){function t(t,e,r,n){this.from=t;this.to=e;this.dir=r;this.order=n}t.update=function(e,r){if(r.empty)return e;var n=[],i=e.length?e[e.length-1].dir:ln.LTR;for(var o=Math.max(0,e.length-10);o<e.length;o++){var a=e[o];if(a.dir==i&&!r.touchesRange(a.from,a.to))n.push(new t(r.mapPos(a.from,1),r.mapPos(a.to,-1),a.dir,a.order))}return n};return t}();function No(t,e,r){for(var n=t.state.facet(e),i=n.length-1;i>=0;i--){var o=n[i],a=typeof o=="function"?o(t):o;if(a)wr(a,r)}return r}var jo=ar.mac?"mac":ar.windows?"win":ar.linux?"linux":"key";function _o(t,e){var r=t.split(/-(?!$)/);var n=r[r.length-1];if(n=="Space")n=" ";var i,o,a,s;for(var f=0;f<r.length-1;++f){var u=r[f];if(/^(cmd|meta|m)$/i.test(u))s=true;else if(/^a(lt)?$/i.test(u))i=true;else if(/^(c|ctrl|control)$/i.test(u))o=true;else if(/^s(hift)?$/i.test(u))a=true;else if(/^mod$/i.test(u)){if(e=="mac")s=true;else o=true}else throw new Error("Unrecognized modifier name: "+u)}if(i)n="Alt-"+n;if(o)n="Ctrl-"+n;if(s)n="Meta-"+n;if(a)n="Shift-"+n;return n}function Vo(t,e,r){if(e.altKey)t="Alt-"+t;if(e.ctrlKey)t="Ctrl-"+t;if(e.metaKey)t="Meta-"+t;if(r!==false&&e.shiftKey)t="Shift-"+t;return t}var Ho=Eo.domEventHandlers({keydown:function(t,e){return Jo(Wo(e.state),t,e,"editor")}});var Fo=t("y",Y.define({enables:Ho}));var zo=new WeakMap;function Wo(t){var e=t.facet(Fo);var r=zo.get(e);if(!r)zo.set(e,r=Ko(e.reduce((function(t,e){return t.concat(e)}),[])));return r}function qo(t,e,r){return Jo(Wo(t.state),e,t,r)}var Uo=null;var Go=4e3;function Ko(t,e){if(e===void 0){e=jo}var r=Object.create(null);var n=Object.create(null);var i=function(t,e){var r=n[t];if(r==null)n[t]=e;else if(r!=e)throw new Error("Key binding "+t+" is used both as a regular binding and as a multi-stroke prefix")};var o=function(t,n,o,a){var s=r[t]||(r[t]=Object.create(null));var f=n.split(/ (?!$)/).map((function(t){return _o(t,e)}));var u=function(e){var r=f.slice(0,e).join(" ");i(r,true);if(!s[r])s[r]={preventDefault:true,commands:[function(e){var n=Uo={view:e,prefix:r,scope:t};setTimeout((function(){if(Uo==n)Uo=null}),Go);return true}]}};for(var l=1;l<f.length;l++){u(l)}var c=f.join(" ");i(c,false);var h=s[c]||(s[c]={preventDefault:false,commands:[]});h.commands.push(o);if(a)h.preventDefault=true};for(var a=0,s=t;a<s.length;a++){var f=s[a];var u=f[e]||f.key;if(!u)continue;for(var l=0,c=f.scope?f.scope.split(" "):["editor"];l<c.length;l++){var h=c[l];o(h,u,f.run,f.preventDefault);if(f.shift)o(h,"Shift-"+u,f.shift,f.preventDefault)}}return r}function Jo(t,e,r,n){var i=we(e),o=i.length==1&&i!=" ";var a="",s=false;if(Uo&&Uo.view==r&&Uo.scope==n){a=Uo.prefix+" ";if(s=li.indexOf(e.keyCode)<0)Uo=null}var f=function(t){if(t){for(var e=0,n=t.commands;e<n.length;e++){var i=n[e];if(i(r))return true}if(t.preventDefault)s=true}return false};var u=t[n],l;if(u){if(f(u[a+Vo(i,e,!o)]))return true;if(o&&(e.shiftKey||e.altKey||e.metaKey)&&(l=le[e.keyCode])&&l!=i){if(f(u[a+Vo(l,e,true)]))return true}else if(o&&e.shiftKey){if(f(u[a+Vo(i,e,true)]))return true}}return s}var $o=!ar.ios;var Yo=Y.define({combine:function(t){return Vt(t,{cursorBlinkRate:1200,drawRangeCursor:true},{cursorBlinkRate:function(t,e){return Math.min(t,e)},drawRangeCursor:function(t,e){return t||e}})}});function Xo(t){if(t===void 0){t={}}return[Yo.of(t),Zo,ea]}var Qo=function(){function t(t,e,r,n,i){this.left=t;this.top=e;this.width=r;this.height=n;this.className=i}t.prototype.draw=function(){var t=document.createElement("div");t.className=this.className;this.adjust(t);return t};t.prototype.adjust=function(t){t.style.left=this.left+"px";t.style.top=this.top+"px";if(this.width>=0)t.style.width=this.width+"px";t.style.height=this.height+"px"};t.prototype.eq=function(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height&&this.className==t.className};return t}();var Zo=tn.fromClass(function(){function t(t){this.view=t;this.rangePieces=[];this.cursors=[];this.measureReq={read:this.readPos.bind(this),write:this.drawSel.bind(this)};this.selectionLayer=t.scrollDOM.appendChild(document.createElement("div"));this.selectionLayer.className="cm-selectionLayer";this.selectionLayer.setAttribute("aria-hidden","true");this.cursorLayer=t.scrollDOM.appendChild(document.createElement("div"));this.cursorLayer.className="cm-cursorLayer";this.cursorLayer.setAttribute("aria-hidden","true");t.requestMeasure(this.measureReq);this.setBlinkRate()}t.prototype.setBlinkRate=function(){this.cursorLayer.style.animationDuration=this.view.state.facet(Yo).cursorBlinkRate+"ms"};t.prototype.update=function(t){var e=t.startState.facet(Yo)!=t.state.facet(Yo);if(e||t.selectionSet||t.geometryChanged||t.viewportChanged)this.view.requestMeasure(this.measureReq);if(t.transactions.some((function(t){return t.scrollIntoView})))this.cursorLayer.style.animationName=this.cursorLayer.style.animationName=="cm-blink"?"cm-blink2":"cm-blink";if(e)this.setBlinkRate()};t.prototype.readPos=function(){var t=this;var e=this.view.state,r=e.facet(Yo);var n=e.selection.ranges.map((function(e){return e.empty?[]:oa(t.view,e)})).reduce((function(t,e){return t.concat(e)}));var i=[];for(var o=0,a=e.selection.ranges;o<a.length;o++){var s=a[o];var f=s==e.selection.main;if(s.empty?!f||$o:r.drawRangeCursor){var u=aa(this.view,s,f);if(u)i.push(u)}}return{rangePieces:n,cursors:i}};t.prototype.drawSel=function(t){var e=this;var r=t.rangePieces,n=t.cursors;if(r.length!=this.rangePieces.length||r.some((function(t,r){return!t.eq(e.rangePieces[r])}))){this.selectionLayer.textContent="";for(var i=0,o=r;i<o.length;i++){var a=o[i];this.selectionLayer.appendChild(a.draw())}this.rangePieces=r}if(n.length!=this.cursors.length||n.some((function(t,r){return!t.eq(e.cursors[r])}))){var s=this.cursorLayer.children;if(s.length!==n.length){this.cursorLayer.textContent="";for(var f=0,u=n;f<u.length;f++){var l=u[f];this.cursorLayer.appendChild(l.draw())}}else{n.forEach((function(t,e){return t.adjust(s[e])}))}this.cursors=n}};t.prototype.destroy=function(){this.selectionLayer.remove();this.cursorLayer.remove()};return t}());var ta={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};if($o)ta[".cm-line"].caretColor="transparent !important";var ea=ot.highest(Eo.theme(ta));function ra(t){var e=t.scrollDOM.getBoundingClientRect();var r=t.textDirection==ln.LTR?e.left:e.right-t.scrollDOM.clientWidth;return{left:r-t.scrollDOM.scrollLeft,top:e.top-t.scrollDOM.scrollTop}}function na(t,e,r){var n=G.cursor(e);return{from:Math.max(r.from,t.moveToLineBoundary(n,false,true).from),to:Math.min(r.to,t.moveToLineBoundary(n,true,true).from),type:Cr.Text}}function ia(t,e){var r=t.lineBlockAt(e);if(Array.isArray(r.type))for(var n=0,i=r.type;n<i.length;n++){var o=i[n];if(o.to>e||o.to==e&&(o.to==r.to||o.type==Cr.Text))return o}return r}function oa(t,e){if(e.to<=t.viewport.from||e.from>=t.viewport.to)return[];var r=Math.max(e.from,t.viewport.from),n=Math.min(e.to,t.viewport.to);var i=t.textDirection==ln.LTR;var o=t.contentDOM,a=o.getBoundingClientRect(),s=ra(t);var f=window.getComputedStyle(o.firstChild);var u=a.left+parseInt(f.paddingLeft)+Math.min(0,parseInt(f.textIndent));var l=a.right-parseInt(f.paddingRight);var c=ia(t,r),h=ia(t,n);var p=c.type==Cr.Text?c:null;var d=h.type==Cr.Text?h:null;if(t.lineWrapping){if(p)p=na(t,r,p);if(d)d=na(t,n,d)}if(p&&d&&p.from==d.from){return b(w(e.from,e.to,p))}else{var v=p?w(e.from,null,p):x(c,false);var g=d?w(null,e.to,d):x(h,true);var m=[];if((p||c).to<(d||h).from-1)m.push(y(u,v.bottom,l,g.top));else if(v.bottom<g.top&&t.elementAtHeight((v.bottom+g.top)/2).type==Cr.Text)v.bottom=g.top=(v.bottom+g.top)/2;return b(v).concat(m).concat(b(g))}function y(t,e,r,n){return new Qo(t-s.left,e-s.top-.01,r-t,n-e+.01,"cm-selectionBackground")}function b(t){var e=t.top,r=t.bottom,n=t.horizontal;var i=[];for(var o=0;o<n.length;o+=2)i.push(y(n[o],e,n[o+1],r));return i}function w(e,r,n){var o=1e9,a=-1e9,s=[];function f(e,r,f,c,h){var p=t.coordsAtPos(e,e==n.to?-2:2);var d=t.coordsAtPos(f,f==n.from?2:-2);o=Math.min(p.top,d.top,o);a=Math.max(p.bottom,d.bottom,a);if(h==ln.LTR)s.push(i&&r?u:p.left,i&&c?l:d.right);else s.push(!i&&c?u:d.left,!i&&r?l:p.right)}var c=e!==null&&e!==void 0?e:n.from,h=r!==null&&r!==void 0?r:n.to;for(var p=0,d=t.visibleRanges;p<d.length;p++){var v=d[p];if(v.to>c&&v.from<h){for(var g=Math.max(v.from,c),m=Math.min(v.to,h);;){var y=t.state.doc.lineAt(g);for(var b=0,w=t.bidiSpans(y);b<w.length;b++){var x=w[b];var k=x.from+y.from,S=x.to+y.from;if(k>=m)break;if(S>g)f(Math.max(k,g),e==null&&k<=c,Math.min(S,m),r==null&&S>=h,x.dir)}g=y.to+1;if(g>=m)break}}}if(s.length==0)f(c,e==null,h,r==null,t.textDirection);return{top:o,bottom:a,horizontal:s}}function x(t,e){var r=a.top+(e?t.top:t.bottom);return{top:r,bottom:r,horizontal:[]}}}function aa(t,e,r){var n=t.coordsAtPos(e.head,e.assoc||1);if(!n)return null;var i=ra(t);return new Qo(n.left-i.left,n.top-i.top,-1,n.bottom-n.top,r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary")}function sa(t,e,r,n,i){e.lastIndex=0;for(var o=t.iterRange(r,n),a=r,s=void 0;!o.next().done;a+=o.value.length){if(!o.lineBreak)while(s=e.exec(o.value))i(a+s.index,a+s.index+s[0].length,s)}}function fa(t,e){var r=t.visibleRanges;if(r.length==1&&r[0].from==t.viewport.from&&r[0].to==t.viewport.to)return r;var n=[];for(var i=0,o=r;i<o.length;i++){var a=o[i],s=a.from,f=a.to;s=Math.max(t.state.doc.lineAt(s).from,s-e);f=Math.min(t.state.doc.lineAt(f).to,f+e);if(n.length&&n[n.length-1].to>=s)n[n.length-1].to=f;else n.push({from:s,to:f})}return n}var ua=function(){function t(t){var e=t.regexp,r=t.decoration,n=t.boundary,i=t.maxLength,o=i===void 0?1e3:i;if(!e.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");this.regexp=e;this.getDeco=typeof r=="function"?r:function(){return r};this.boundary=n;this.maxLength=o}t.prototype.createDeco=function(t){var e=this;var r=new Zt;for(var n=0,i=fa(t,this.maxLength);n<i.length;n++){var o=i[n],a=o.from,s=o.to;sa(t.state.doc,this.regexp,a,s,(function(n,i,o){return r.add(n,i,e.getDeco(o,t,n))}))}return r.finish()};t.prototype.updateDeco=function(t,e){var r=1e9,n=-1;if(t.docChanged)t.changes.iterChanges((function(e,i,o,a){if(a>t.view.viewport.from&&o<t.view.viewport.to){r=Math.min(o,r);n=Math.max(a,n)}}));if(t.viewportChanged||n-r>1e3)return this.createDeco(t.view);if(n>-1)return this.updateRange(t.view,e.map(t.changes),r,n);return e};t.prototype.updateRange=function(t,e,r,n){var i=this;var o=function(o){var s=Math.max(o.from,r),f=Math.min(o.to,n);if(f>s){var u=t.state.doc.lineAt(s),l=u.to<f?t.state.doc.lineAt(f):u;var c=Math.max(o.from,u.from),h=Math.min(o.to,l.to);if(a.boundary){for(;s>u.from;s--)if(a.boundary.test(u.text[s-1-u.from])){c=s;break}for(;f<l.to;f++)if(a.boundary.test(l.text[f-l.from])){h=f;break}}var p=[],d=void 0;if(u==l){a.regexp.lastIndex=c-u.from;while((d=a.regexp.exec(u.text))&&d.index<h-u.from){var v=d.index+u.from;p.push(a.getDeco(d,t,v).range(v,v+d[0].length))}}else{sa(t.state.doc,a.regexp,c,h,(function(e,r,n){return p.push(i.getDeco(n,t,e).range(e,r))}))}e=e.update({filterFrom:c,filterTo:h,filter:function(t,e){return t<c||e>h},add:p})}};var a=this;for(var s=0,f=t.visibleRanges;s<f.length;s++){var u=f[s];o(u)}return e};return t}();var la=/x/.unicode!=null?"gu":"g";var ca=new RegExp("[\0-\b\n--­؜​‎‏\u2028\u2029‭‮\ufeff￹-￼]",la);var ha={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};var pa=null;function da(){var t;if(pa==null&&typeof document!="undefined"&&document.body){var e=document.body.style;pa=((t=e.tabSize)!==null&&t!==void 0?t:e.MozTabSize)!=null}return pa||false}var va=Y.define({combine:function(t){var e=Vt(t,{render:null,specialChars:ca,addSpecialChars:null});if(e.replaceTabs=!da())e.specialChars=new RegExp("\t|"+e.specialChars.source,la);if(e.addSpecialChars)e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,la);return e}});function ga(t){if(t===void 0){t={}}return[va.of(t),ya()]}var ma=null;function ya(){return ma||(ma=tn.fromClass(function(){function t(t){this.view=t;this.decorations=Ar.none;this.decorationCache=Object.create(null);this.decorator=this.makeDecorator(t.state.facet(va));this.decorations=this.decorator.createDeco(t)}t.prototype.makeDecorator=function(t){var e=this;return new ua({regexp:t.specialChars,decoration:function(r,n,i){var o=n.state.doc;var a=w(r[0],0);if(a==9){var s=o.lineAt(i);var f=n.state.tabSize,u=S(s.text,f,i-s.from);return Ar.replace({widget:new ka((f-u%f)*e.view.defaultCharacterWidth)})}return e.decorationCache[a]||(e.decorationCache[a]=Ar.replace({widget:new xa(t,a)}))},boundary:t.replaceTabs?undefined:/[^]/})};t.prototype.update=function(t){var e=t.state.facet(va);if(t.startState.facet(va)!=e){this.decorator=this.makeDecorator(e);this.decorations=this.decorator.createDeco(t.view)}else{this.decorations=this.decorator.updateDeco(t,this.decorations)}};return t}(),{decorations:function(t){return t.decorations}}))}var ba="•";function wa(t){if(t>=32)return ba;if(t==10)return"␤";return String.fromCharCode(9216+t)}var xa=function(t){__extends(e,t);function e(e,r){var n=t.call(this)||this;n.options=e;n.code=r;return n}e.prototype.eq=function(t){return t.code==this.code};e.prototype.toDOM=function(t){var e=wa(this.code);var r=t.state.phrase("Control character")+" "+(ha[this.code]||"0x"+this.code.toString(16));var n=this.options.render&&this.options.render(this.code,r,e);if(n)return n;var i=document.createElement("span");i.textContent=e;i.title=r;i.setAttribute("aria-label",r);i.className="cm-specialChar";return i};e.prototype.ignoreEvent=function(){return false};return e}(Sr);var ka=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.width=e;return r}e.prototype.eq=function(t){return t.width==this.width};e.prototype.toDOM=function(){var t=document.createElement("span");t.textContent="\t";t.className="cm-tab";t.style.width=this.width+"px";return t};e.prototype.ignoreEvent=function(){return false};return e}(Sr);var Sa=typeof navigator!="undefined"&&!/Edge\/(\d+)/.exec(navigator.userAgent)&&/Apple Computer/.test(navigator.vendor)&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2);var Ca="-10000px";var Aa=function(){function t(t,e,r){this.facet=e;this.createTooltipView=r;this.input=t.state.facet(e);this.tooltips=this.input.filter((function(t){return t}));this.tooltipViews=this.tooltips.map(r)}t.prototype.update=function(t){var e=t.state.facet(this.facet);var r=e.filter((function(t){return t}));if(e===this.input){for(var n=0,i=this.tooltipViews;n<i.length;n++){var o=i[n];if(o.update)o.update(t)}return false}var a=[];for(var s=0;s<r.length;s++){var f=r[s],u=-1;if(!f)continue;for(var l=0;l<this.tooltips.length;l++){var c=this.tooltips[l];if(c&&c.create==f.create)u=l}if(u<0){a[s]=this.createTooltipView(f)}else{var h=a[s]=this.tooltipViews[u];if(h.update)h.update(t)}}for(var p=0,d=this.tooltipViews;p<d.length;p++){var v=d[p];if(a.indexOf(v)<0)v.dom.remove()}this.input=e;this.tooltips=r;this.tooltipViews=a;return true};return t}();function Oa(){return{top:0,left:0,bottom:innerHeight,right:innerWidth}}var Ma=Y.define({combine:function(t){var e,r,n;return{position:Sa?"absolute":((e=t.find((function(t){return t.position})))===null||e===void 0?void 0:e.position)||"fixed",parent:((r=t.find((function(t){return t.parent})))===null||r===void 0?void 0:r.parent)||null,tooltipSpace:((n=t.find((function(t){return t.tooltipSpace})))===null||n===void 0?void 0:n.tooltipSpace)||Oa}}});var Da=tn.fromClass(function(){function t(t){var e=this;var r;this.view=t;this.inView=true;this.lastTransaction=0;this.measureTimeout=-1;var n=t.state.facet(Ma);this.position=n.position;this.parent=n.parent;this.classes=t.themeClasses;this.createContainer();this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this};this.manager=new Aa(t,Ea,(function(t){return e.createTooltip(t)}));this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver((function(t){if(Date.now()>e.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1)e.measureSoon()}),{threshold:[1]}):null;this.observeIntersection();(r=t.dom.ownerDocument.defaultView)===null||r===void 0?void 0:r.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this));this.maybeMeasure()}t.prototype.createContainer=function(){if(this.parent){this.container=document.createElement("div");this.container.style.position="relative";this.container.className=this.view.themeClasses;this.parent.appendChild(this.container)}else{this.container=this.view.dom}};t.prototype.observeIntersection=function(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(var t=0,e=this.manager.tooltipViews;t<e.length;t++){var r=e[t];this.intersectionObserver.observe(r.dom)}}};t.prototype.measureSoon=function(){var t=this;if(this.measureTimeout<0)this.measureTimeout=setTimeout((function(){t.measureTimeout=-1;t.maybeMeasure()}),50)};t.prototype.update=function(t){if(t.transactions.length)this.lastTransaction=Date.now();var e=this.manager.update(t);if(e)this.observeIntersection();var r=e||t.geometryChanged;var n=t.state.facet(Ma);if(n.position!=this.position){this.position=n.position;for(var i=0,o=this.manager.tooltipViews;i<o.length;i++){var a=o[i];a.dom.style.position=this.position}r=true}if(n.parent!=this.parent){if(this.parent)this.container.remove();this.parent=n.parent;this.createContainer();for(var s=0,f=this.manager.tooltipViews;s<f.length;s++){var u=f[s];this.container.appendChild(u.dom)}r=true}else if(this.parent&&this.view.themeClasses!=this.classes){this.classes=this.container.className=this.view.themeClasses}if(r)this.maybeMeasure()};t.prototype.createTooltip=function(t){var e=t.create(this.view);e.dom.classList.add("cm-tooltip");if(t.arrow&&!e.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){var r=document.createElement("div");r.className="cm-tooltip-arrow";e.dom.appendChild(r)}e.dom.style.position=this.position;e.dom.style.top=Ca;this.container.appendChild(e.dom);if(e.mount)e.mount(this.view);return e};t.prototype.destroy=function(){var t,e;(t=this.view.dom.ownerDocument.defaultView)===null||t===void 0?void 0:t.removeEventListener("resize",this.measureSoon);for(var r=0,n=this.manager.tooltipViews;r<n.length;r++){var i=n[r].dom;i.remove()}(e=this.intersectionObserver)===null||e===void 0?void 0:e.disconnect();clearTimeout(this.measureTimeout)};t.prototype.readMeasure=function(){var t=this;var e=this.view.dom.getBoundingClientRect();return{editor:e,parent:this.parent?this.container.getBoundingClientRect():e,pos:this.manager.tooltips.map((function(e,r){var n=t.manager.tooltipViews[r];return n.getCoords?n.getCoords(e.pos):t.view.coordsAtPos(e.pos)})),size:this.manager.tooltipViews.map((function(t){var e=t.dom;return e.getBoundingClientRect()})),space:this.view.state.facet(Ma).tooltipSpace(this.view)}};t.prototype.writeMeasure=function(t){var e=t.editor,r=t.space;var n=[];for(var i=0;i<this.manager.tooltips.length;i++){var o=this.manager.tooltips[i],a=this.manager.tooltipViews[i],s=a.dom;var f=t.pos[i],u=t.size[i];if(!f||f.bottom<=Math.max(e.top,r.top)||f.top>=Math.min(e.bottom,r.bottom)||f.right<Math.max(e.left,r.left)-.1||f.left>Math.min(e.right,r.right)+.1){s.style.top=Ca;continue}var l=o.arrow?a.dom.querySelector(".cm-tooltip-arrow"):null;var c=l?7:0;var h=u.right-u.left,p=u.bottom-u.top;var d=a.offset||Ta,v=this.view.textDirection==ln.LTR;var g=u.width>r.right-r.left?v?r.left:r.right-u.width:v?Math.min(f.left-(l?14:0)+d.x,r.right-h):Math.max(r.left,f.left-h+(l?14:0)-d.x);var m=!!o.above;if(!o.strictSide&&(m?f.top-(u.bottom-u.top)-d.y<r.top:f.bottom+(u.bottom-u.top)+d.y>r.bottom)&&m==r.bottom-f.bottom>f.top-r.top)m=!m;var y=m?f.top-p-c-d.y:f.bottom+c+d.y;var b=g+h;if(a.overlap!==true)for(var w=0,x=n;w<x.length;w++){var k=x[w];if(k.left<b&&k.right>g&&k.top<y+p&&k.bottom>y)y=m?k.top-p-2-c:k.bottom+c+2}if(this.position=="absolute"){s.style.top=y-t.parent.top+"px";s.style.left=g-t.parent.left+"px"}else{s.style.top=y+"px";s.style.left=g+"px"}if(l)l.style.left="".concat(f.left+(v?d.x:-d.x)-(g+14-7),"px");if(a.overlap!==true)n.push({left:g,top:y,right:b,bottom:y+p});s.classList.toggle("cm-tooltip-above",m);s.classList.toggle("cm-tooltip-below",!m);if(a.positioned)a.positioned()}};t.prototype.maybeMeasure=function(){if(this.manager.tooltips.length){if(this.view.inView)this.view.requestMeasure(this.measureReq);if(this.inView!=this.view.inView){this.inView=this.view.inView;if(!this.inView)for(var t=0,e=this.manager.tooltipViews;t<e.length;t++){var r=e[t];r.dom.style.top=Ca}}}};return t}(),{eventHandlers:{scroll:function(){this.maybeMeasure()}}});var Pa=Eo.baseTheme({".cm-tooltip":{zIndex:100},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"".concat(7,"px"),width:"".concat(7*2,"px"),position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"".concat(7,"px solid transparent"),borderRight:"".concat(7,"px solid transparent")},".cm-tooltip-above &":{bottom:"-".concat(7,"px"),"&:before":{borderTop:"".concat(7,"px solid #bbb")},"&:after":{borderTop:"".concat(7,"px solid #f5f5f5"),bottom:"1px"}},".cm-tooltip-below &":{top:"-".concat(7,"px"),"&:before":{borderBottom:"".concat(7,"px solid #bbb")},"&:after":{borderBottom:"".concat(7,"px solid #f5f5f5"),top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}});var Ta={x:0,y:0};var Ea=Y.define({enables:[Da,Pa]});function Ra(t,e){var r=t.plugin(Da);if(!r)return null;var n=r.manager.tooltips.indexOf(e);return n<0?null:r.manager.tooltipViews[n]}var La=t("D",1024);var Ba=0;var Ia=function(){function t(t,e){this.from=t;this.to=e}return t}();var Na=function(){function t(t){if(t===void 0){t={}}this.id=Ba++;this.perNode=!!t.perNode;this.deserialize=t.deserialize||function(){throw new Error("This node type doesn't define a deserialize function")}}t.prototype.add=function(t){var e=this;if(this.perNode)throw new RangeError("Can't add per-node props to node types");if(typeof t!="function")t=Va.match(t);return function(r){var n=t(r);return n===undefined?null:[e,n]}};return t}();t("N",Na);Na.closedBy=new Na({deserialize:function(t){return t.split(" ")}});Na.openedBy=new Na({deserialize:function(t){return t.split(" ")}});Na.group=new Na({deserialize:function(t){return t.split(" ")}});Na.contextHash=new Na({perNode:true});Na.lookAhead=new Na({perNode:true});Na.mounted=new Na({perNode:true});var ja=function(){function t(t,e,r){this.tree=t;this.overlay=e;this.parser=r}return t}();var _a=Object.create(null);var Va=function(){function t(t,e,r,n){if(n===void 0){n=0}this.name=t;this.props=e;this.id=r;this.flags=n}t.define=function(e){var r=e.props&&e.props.length?Object.create(null):_a;var n=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0);var i=new t(e.name||"",r,e.id,n);if(e.props)for(var o=0,a=e.props;o<a.length;o++){var s=a[o];if(!Array.isArray(s))s=s(i);if(s){if(s[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");r[s[0].id]=s[1]}}return i};t.prototype.prop=function(t){return this.props[t.id]};Object.defineProperty(t.prototype,"isTop",{get:function(){return(this.flags&1)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"isSkipped",{get:function(){return(this.flags&2)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"isError",{get:function(){return(this.flags&4)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"isAnonymous",{get:function(){return(this.flags&8)>0},enumerable:false,configurable:true});t.prototype.is=function(t){if(typeof t=="string"){if(this.name==t)return true;var e=this.prop(Na.group);return e?e.indexOf(t)>-1:false}return this.id==t};t.match=function(t){var e=Object.create(null);for(var r in t)for(var n=0,i=r.split(" ");n<i.length;n++){var o=i[n];e[o]=t[r]}return function(t){for(var r=t.prop(Na.group),n=-1;n<(r?r.length:0);n++){var i=e[n<0?t.name:r[n]];if(i)return i}}};return t}();t("a",Va);Va.none=new Va("",Object.create(null),0,8);var Ha=function(){function t(t){this.types=t;for(var e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}t.prototype.extend=function(){var e=[];for(var r=0;r<arguments.length;r++){e[r]=arguments[r]}var n=[];for(var i=0,o=this.types;i<o.length;i++){var a=o[i];var s=null;for(var f=0,u=e;f<u.length;f++){var l=u[f];var c=l(a);if(c){if(!s)s=Object.assign({},a.props);s[c[0].id]=c[1]}}n.push(s?new Va(a.name,s,a.id,a.flags):a)}return new t(n)};return t}();t("e",Ha);var Fa=new WeakMap,za=new WeakMap;var Wa=function(){function t(t,e,r,n,i){this.type=t;this.children=e;this.positions=r;this.length=n;this.props=null;if(i&&i.length){this.props=Object.create(null);for(var o=0,a=i;o<a.length;o++){var s=a[o],f=s[0],u=s[1];this.props[typeof f=="number"?f:f.id]=u}}}t.prototype.toString=function(){var t=this.prop(Na.mounted);if(t&&!t.overlay)return t.tree.toString();var e="";for(var r=0,n=this.children;r<n.length;r++){var i=n[r];var o=i.toString();if(o){if(e)e+=",";e+=o}}return!this.type.name?e:(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":"")};t.prototype.cursor=function(t,e){if(e===void 0){e=0}var r=t!=null&&Fa.get(this)||this.topNode;var n=new Za(r);if(t!=null){n.moveTo(t,e);Fa.set(this,n._tree)}return n};t.prototype.fullCursor=function(){return new Za(this.topNode,1)};Object.defineProperty(t.prototype,"topNode",{get:function(){return new $a(this,0,0,null)},enumerable:false,configurable:true});t.prototype.resolve=function(t,e){if(e===void 0){e=0}var r=Ja(Fa.get(this)||this.topNode,t,e,false);Fa.set(this,r);return r};t.prototype.resolveInner=function(t,e){if(e===void 0){e=0}var r=Ja(za.get(this)||this.topNode,t,e,true);za.set(this,r);return r};t.prototype.iterate=function(t){var e=t.enter,r=t.leave,n=t.from,i=n===void 0?0:n,o=t.to,a=o===void 0?this.length:o;var s=function(){var t=f.cursor(),e=function(){return t.node};u=t};var f=this,u,l;s();for(var c=u,h=l;;){var p=false;if(c.from<=a&&c.to>=i&&(c.type.isAnonymous||e(c.type,c.from,c.to,h)!==false)){if(c.firstChild())continue;if(!c.type.isAnonymous)p=true}for(;;){if(p&&r)r(c.type,c.from,c.to,h);p=c.type.isAnonymous;if(c.nextSibling())break;if(!c.parent())return;p=true}}};t.prototype.prop=function(t){return!t.perNode?this.type.prop(t):this.props?this.props[t.id]:undefined};Object.defineProperty(t.prototype,"propValues",{get:function(){var t=[];if(this.props)for(var e in this.props)t.push([+e,this.props[e]]);return t},enumerable:false,configurable:true});t.prototype.balance=function(e){var r=this;if(e===void 0){e={}}return this.children.length<=8?this:is(Va.none,this.children,this.positions,0,this.children.length,0,this.length,(function(e,n,i){return new t(r.type,e,n,i,r.propValues)}),e.makeTree||function(e,r,n){return new t(Va.none,e,r,n)})};t.build=function(t){return es(t)};return t}();t("T",Wa);Wa.empty=new Wa(Va.none,[],[],0);var qa=function(){function t(t,e){this.buffer=t;this.index=e}Object.defineProperty(t.prototype,"id",{get:function(){return this.buffer[this.index-4]},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"start",{get:function(){return this.buffer[this.index-3]},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"end",{get:function(){return this.buffer[this.index-2]},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"size",{get:function(){return this.buffer[this.index-1]},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"pos",{get:function(){return this.index},enumerable:false,configurable:true});t.prototype.next=function(){this.index-=4};t.prototype.fork=function(){return new t(this.buffer,this.index)};return t}();var Ua=function(){function t(t,e,r){this.buffer=t;this.length=e;this.set=r}Object.defineProperty(t.prototype,"type",{get:function(){return Va.none},enumerable:false,configurable:true});t.prototype.toString=function(){var t=[];for(var e=0;e<this.buffer.length;){t.push(this.childString(e));e=this.buffer[e+3]}return t.join(",")};t.prototype.childString=function(t){var e=this.buffer[t],r=this.buffer[t+3];var n=this.set.types[e],i=n.name;if(/\W/.test(i)&&!n.isError)i=JSON.stringify(i);t+=4;if(r==t)return i;var o=[];while(t<r){o.push(this.childString(t));t=this.buffer[t+3]}return i+"("+o.join(",")+")"};t.prototype.findChild=function(t,e,r,n,i){var o=this.buffer,a=-1;for(var s=t;s!=e;s=o[s+3]){if(Ga(i,n,o[s+1],o[s+2])){a=s;if(r>0)break}}return a};t.prototype.slice=function(e,r,n,i){var o=this.buffer;var a=new Uint16Array(r-e);for(var s=e,f=0;s<r;){a[f++]=o[s++];a[f++]=o[s++]-n;a[f++]=o[s++]-n;a[f++]=o[s++]-e}return new t(a,i-n,this.set)};return t}();function Ga(t,e,r,n){switch(t){case-2:return r<e;case-1:return n>=e&&r<e;case 0:return r<e&&n>e;case 1:return r<=e&&n>e;case 2:return n>e;case 4:return true}}function Ka(t,e){var r=t.childBefore(e);while(r){var n=r.lastChild;if(!n||n.to!=r.to)break;if(n.type.isError&&n.from==n.to){t=r;r=n.prevSibling}else{r=n}}return t}function Ja(t,e,r,n){var i;while(t.from==t.to||(r<1?t.from>=e:t.from>e)||(r>-1?t.to<=e:t.to<e)){var o=!n&&t instanceof $a&&t.index<0?null:t.parent;if(!o)return t;t=o}if(n)for(var a=t,o=a.parent;o;a=o,o=a.parent){if(a instanceof $a&&a.index<0&&((i=o.enter(e,r,true))===null||i===void 0?void 0:i.from)!=a.from)t=o}for(;;){var s=t.enter(e,r,n);if(!s)return t;t=s}}var $a=function(){function t(t,e,r,n){this.node=t;this._from=e;this.index=r;this._parent=n}Object.defineProperty(t.prototype,"type",{get:function(){return this.node.type},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"name",{get:function(){return this.node.type.name},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"from",{get:function(){return this._from},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"to",{get:function(){return this._from+this.node.length},enumerable:false,configurable:true});t.prototype.nextChild=function(e,r,n,i,o){if(o===void 0){o=0}for(var a=this;;){for(var s=a.node,f=s.children,u=s.positions,l=r>0?f.length:-1;e!=l;e+=r){var c=f[e],h=u[e]+a._from;if(!Ga(i,n,h,h+c.length))continue;if(c instanceof Ua){if(o&2)continue;var p=c.findChild(0,c.buffer.length,r,n-h,i);if(p>-1)return new Qa(new Xa(a,c,e,h),null,p)}else if(o&1||(!c.type.isAnonymous||ts(c))){var d=void 0;if(!(o&1)&&c.props&&(d=c.prop(Na.mounted))&&!d.overlay)return new t(d.tree,h,e,a);var v=new t(c,h,e,a);return o&1||!v.type.isAnonymous?v:v.nextChild(r<0?c.children.length-1:0,r,n,i)}}if(o&1||!a.type.isAnonymous)return null;if(a.index>=0)e=a.index+r;else e=r<0?-1:a._parent.node.children.length;a=a._parent;if(!a)return null}};Object.defineProperty(t.prototype,"firstChild",{get:function(){return this.nextChild(0,1,0,4)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.nextChild(this.node.children.length-1,-1,0,4)},enumerable:false,configurable:true});t.prototype.childAfter=function(t){return this.nextChild(0,1,t,2)};t.prototype.childBefore=function(t){return this.nextChild(this.node.children.length-1,-1,t,-2)};t.prototype.enter=function(e,r,n,i){if(n===void 0){n=true}if(i===void 0){i=true}var o;if(n&&(o=this.node.prop(Na.mounted))&&o.overlay){var a=e-this.from;for(var s=0,f=o.overlay;s<f.length;s++){var u=f[s],l=u.from,c=u.to;if((r>0?l<=a:l<a)&&(r<0?c>=a:c>a))return new t(o.tree,o.overlay[0].from+this.from,-1,this)}}return this.nextChild(0,1,e,r,i?0:2)};t.prototype.nextSignificantParent=function(){var t=this;while(t.type.isAnonymous&&t._parent)t=t._parent;return t};Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent?this._parent.nextSignificantParent():null},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"nextSibling",{get:function(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"prevSibling",{get:function(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"cursor",{get:function(){return new Za(this)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"tree",{get:function(){return this.node},enumerable:false,configurable:true});t.prototype.toTree=function(){return this.node};t.prototype.resolve=function(t,e){if(e===void 0){e=0}return Ja(this,t,e,false)};t.prototype.resolveInner=function(t,e){if(e===void 0){e=0}return Ja(this,t,e,true)};t.prototype.enterUnfinishedNodesBefore=function(t){return Ka(this,t)};t.prototype.getChild=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=null}var n=Ya(this,t,e,r);return n.length?n[0]:null};t.prototype.getChildren=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=null}return Ya(this,t,e,r)};t.prototype.toString=function(){return this.node.toString()};return t}();function Ya(t,e,r,n){var i=t.cursor,o=[];if(!i.firstChild())return o;if(r!=null)while(!i.type.is(r))if(!i.nextSibling())return o;for(;;){if(n!=null&&i.type.is(n))return o;if(i.type.is(e))o.push(i.node);if(!i.nextSibling())return n==null?o:[]}}var Xa=function(){function t(t,e,r,n){this.parent=t;this.buffer=e;this.index=r;this.start=n}return t}();var Qa=function(){function t(t,e,r){this.context=t;this._parent=e;this.index=r;this.type=t.buffer.set.types[t.buffer.buffer[r]]}Object.defineProperty(t.prototype,"name",{get:function(){return this.type.name},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"from",{get:function(){return this.context.start+this.context.buffer.buffer[this.index+1]},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"to",{get:function(){return this.context.start+this.context.buffer.buffer[this.index+2]},enumerable:false,configurable:true});t.prototype.child=function(e,r,n){var i=this.context.buffer;var o=i.findChild(this.index+4,i.buffer[this.index+3],e,r-this.context.start,n);return o<0?null:new t(this.context,this,o)};Object.defineProperty(t.prototype,"firstChild",{get:function(){return this.child(1,0,4)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"lastChild",{get:function(){return this.child(-1,0,4)},enumerable:false,configurable:true});t.prototype.childAfter=function(t){return this.child(1,t,2)};t.prototype.childBefore=function(t){return this.child(-1,t,-2)};t.prototype.enter=function(e,r,n,i){if(i===void 0){i=true}if(!i)return null;var o=this.context.buffer;var a=o.findChild(this.index+4,o.buffer[this.index+3],r>0?1:-1,e-this.context.start,r);return a<0?null:new t(this.context,this,a)};Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent||this.context.parent.nextSignificantParent()},enumerable:false,configurable:true});t.prototype.externalSibling=function(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)};Object.defineProperty(t.prototype,"nextSibling",{get:function(){var e=this.context.buffer;var r=e.buffer[this.index+3];if(r<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length))return new t(this.context,this._parent,r);return this.externalSibling(1)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"prevSibling",{get:function(){var e=this.context.buffer;var r=this._parent?this._parent.index+4:0;if(this.index==r)return this.externalSibling(-1);return new t(this.context,this._parent,e.findChild(r,this.index,-1,0,4))},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"cursor",{get:function(){return new Za(this)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"tree",{get:function(){return null},enumerable:false,configurable:true});t.prototype.toTree=function(){var t=[],e=[];var r=this.context.buffer;var n=this.index+4,i=r.buffer[this.index+3];if(i>n){var o=r.buffer[this.index+1],a=r.buffer[this.index+2];t.push(r.slice(n,i,o,a));e.push(0)}return new Wa(this.type,t,e,this.to-this.from)};t.prototype.resolve=function(t,e){if(e===void 0){e=0}return Ja(this,t,e,false)};t.prototype.resolveInner=function(t,e){if(e===void 0){e=0}return Ja(this,t,e,true)};t.prototype.enterUnfinishedNodesBefore=function(t){return Ka(this,t)};t.prototype.toString=function(){return this.context.buffer.childString(this.index)};t.prototype.getChild=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=null}var n=Ya(this,t,e,r);return n.length?n[0]:null};t.prototype.getChildren=function(t,e,r){if(e===void 0){e=null}if(r===void 0){r=null}return Ya(this,t,e,r)};return t}();var Za=function(){function t(t,e){if(e===void 0){e=0}this.mode=e;this.buffer=null;this.stack=[];this.index=0;this.bufferNode=null;if(t instanceof $a){this.yieldNode(t)}else{this._tree=t.context.parent;this.buffer=t.context;for(var r=t._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=t;this.yieldBuf(t.index)}}Object.defineProperty(t.prototype,"name",{get:function(){return this.type.name},enumerable:false,configurable:true});t.prototype.yieldNode=function(t){if(!t)return false;this._tree=t;this.type=t.type;this.from=t.from;this.to=t.to;return true};t.prototype.yieldBuf=function(t,e){this.index=t;var r=this.buffer,n=r.start,i=r.buffer;this.type=e||i.set.types[i.buffer[t]];this.from=n+i.buffer[t+1];this.to=n+i.buffer[t+2];return true};t.prototype.yield=function(t){if(!t)return false;if(t instanceof $a){this.buffer=null;return this.yieldNode(t)}this.buffer=t.context;return this.yieldBuf(t.index,t.type)};t.prototype.toString=function(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()};t.prototype.enterChild=function(t,e,r){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree.node.children.length-1:0,t,e,r,this.mode));var n=this.buffer.buffer;var i=n.findChild(this.index+4,n.buffer[this.index+3],t,e-this.buffer.start,r);if(i<0)return false;this.stack.push(this.index);return this.yieldBuf(i)};t.prototype.firstChild=function(){return this.enterChild(1,0,4)};t.prototype.lastChild=function(){return this.enterChild(-1,0,4)};t.prototype.childAfter=function(t){return this.enterChild(1,t,2)};t.prototype.childBefore=function(t){return this.enterChild(-1,t,-2)};t.prototype.enter=function(t,e,r,n){if(r===void 0){r=true}if(n===void 0){n=true}if(!this.buffer)return this.yield(this._tree.enter(t,e,r&&!(this.mode&1),n));return n?this.enterChild(1,t,e):false};t.prototype.parent=function(){if(!this.buffer)return this.yieldNode(this.mode&1?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());var t=this.mode&1?this.buffer.parent:this.buffer.parent.nextSignificantParent();this.buffer=null;return this.yieldNode(t)};t.prototype.sibling=function(t){if(!this.buffer)return!this._tree._parent?false:this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode));var e=this.buffer.buffer,r=this.stack.length-1;if(t<0){var n=r<0?0:this.stack[r]+4;if(this.index!=n)return this.yieldBuf(e.findChild(n,this.index,-1,0,4))}else{var i=e.buffer[this.index+3];if(i<(r<0?e.buffer.length:e.buffer[this.stack[r]+3]))return this.yieldBuf(i)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):false};t.prototype.nextSibling=function(){return this.sibling(1)};t.prototype.prevSibling=function(){return this.sibling(-1)};t.prototype.atLastNode=function(t){var e,r;var n,i,o=this.buffer;if(o){if(t>0){if(this.index<o.buffer.buffer.length)return false}else{for(var a=0;a<this.index;a++)if(o.buffer.buffer[a+3]<this.index)return false}n=o.index,i=o.parent}else{e=this._tree,n=e.index,i=e._parent}for(;i;r=i,n=r.index,i=r._parent){if(n>-1)for(var s=n+t,f=t<0?-1:i.node.children.length;s!=f;s+=t){var u=i.node.children[s];if(this.mode&1||u instanceof Ua||!u.type.isAnonymous||ts(u))return false}}return true};t.prototype.move=function(t,e){if(e&&this.enterChild(t,0,4))return true;for(;;){if(this.sibling(t))return true;if(this.atLastNode(t)||!this.parent())return false}};t.prototype.next=function(t){if(t===void 0){t=true}return this.move(1,t)};t.prototype.prev=function(t){if(t===void 0){t=true}return this.move(-1,t)};t.prototype.moveTo=function(t,e){if(e===void 0){e=0}while(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))if(!this.parent())break;while(this.enterChild(1,t,e)){}return this};Object.defineProperty(t.prototype,"node",{get:function(){if(!this.buffer)return this._tree;var t=this.bufferNode,e=null,r=0;if(t&&t.context==this.buffer){t:for(var n=this.index,i=this.stack.length;i>=0;){for(var o=t;o;o=o._parent)if(o.index==n){if(n==this.index)return o;e=o;r=i+1;break t}n=this.stack[--i]}}for(var a=r;a<this.stack.length;a++)e=new Qa(this.buffer,e,this.stack[a]);return this.bufferNode=new Qa(this.buffer,e,this.index)},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"tree",{get:function(){return this.buffer?null:this._tree.node},enumerable:false,configurable:true});return t}();function ts(t){return t.children.some((function(t){return t instanceof Ua||!t.type.isAnonymous||ts(t)}))}function es(t){var e;var r=t.buffer,n=t.nodeSet,i=t.maxBufferLength,o=i===void 0?La:i,a=t.reused,s=a===void 0?[]:a,f=t.minRepeatType,u=f===void 0?n.types.length:f;var l=Array.isArray(r)?new qa(r,r.length):r;var c=n.types;var h=0,p=0;function d(t,e,r,i,a){var f=l.id,w=l.start,x=l.end,k=l.size;var S=p;while(k<0){l.next();if(k==-1){var C=s[f];r.push(C);i.push(w-t);return}else if(k==-3){h=f;return}else if(k==-4){p=f;return}else{throw new RangeError("Unrecognized record size: ".concat(k))}}var A=c[f],O,M;var D=w-t;if(x-w<=o&&(M=y(l.pos-e,a))){var P=new Uint16Array(M.size-M.skip);var T=l.pos-M.size,E=P.length;while(l.pos>T)E=b(M.start,P,E);O=new Ua(P,x-M.start,n);D=M.start-t}else{var T=l.pos-k;l.next();var R=[],L=[];var B=f>=u?f:-1;var I=0,N=x;while(l.pos>T){if(B>=0&&l.id==B&&l.size>=0){if(l.end<=N-o){g(R,L,w,I,l.end,N,B,S);I=R.length;N=l.end}l.next()}else{d(w,T,R,L,B)}}if(B>=0&&I>0&&I<R.length)g(R,L,w,I,w,N,B,S);R.reverse();L.reverse();if(B>-1&&I>0){var j=v(A);O=is(A,R,L,0,R.length,0,x-w,j,j)}else{O=m(A,R,L,x-w,S-x)}}r.push(O);i.push(D)}function v(t){return function(e,r,n){var i=0,o=e.length-1,a,s;if(o>=0&&(a=e[o])instanceof Wa){if(!o&&a.type==t&&a.length==n)return a;if(s=a.prop(Na.lookAhead))i=r[o]+a.length+s}return m(t,e,r,n,i)}}function g(t,e,r,i,o,a,s,f){var u=[],l=[];while(t.length>i){u.push(t.pop());l.push(e.pop()+r-o)}t.push(m(n.types[s],u,l,a-o,f-a));e.push(o-r)}function m(t,e,r,n,i,o){if(i===void 0){i=0}if(h){var a=[Na.contextHash,h];o=o?[a].concat(o):[a]}if(i>25){var a=[Na.lookAhead,i];o=o?[a].concat(o):[a]}return new Wa(t,e,r,n,o)}function y(t,e){var r=l.fork();var n=0,i=0,a=0,s=r.end-o;var f={size:0,start:0,skip:0};t:for(var c=r.pos-t;r.pos>c;){var h=r.size;if(r.id==e&&h>=0){f.size=n;f.start=i;f.skip=a;a+=4;n+=4;r.next();continue}var p=r.pos-h;if(h<0||p<c||r.start<s)break;var d=r.id>=u?4:0;var v=r.start;r.next();while(r.pos>p){if(r.size<0){if(r.size==-3)d+=4;else break t}else if(r.id>=u){d+=4}r.next()}i=v;n+=h;a+=d}if(e<0||n==t){f.size=n;f.start=i;f.skip=a}return f.size>4?f:undefined}function b(t,e,r){var n=l.id,i=l.start,o=l.end,a=l.size;l.next();if(a>=0&&n<u){var s=r;if(a>4){var f=l.pos-(a-4);while(l.pos>f)r=b(t,e,r)}e[--r]=s;e[--r]=o-t;e[--r]=i-t;e[--r]=n}else if(a==-3){h=n}else if(a==-4){p=n}return r}var w=[],x=[];while(l.pos>0)d(t.start||0,t.bufferStart||0,w,x,-1);var k=(e=t.length)!==null&&e!==void 0?e:w.length?x[0]+w[0].length:0;return new Wa(c[t.topID],w.reverse(),x.reverse(),k)}var rs=new WeakMap;function ns(t,e){if(!t.isAnonymous||e instanceof Ua||e.type!=t)return 1;var r=rs.get(e);if(r==null){r=1;for(var n=0,i=e.children;n<i.length;n++){var o=i[n];if(o.type!=t||!(o instanceof Wa)){r=1;break}r+=ns(t,o)}rs.set(e,r)}return r}function is(t,e,r,n,i,o,a,s,f){var u=0;for(var l=n;l<i;l++)u+=ns(t,e[l]);var c=Math.ceil(u*1.5/8);var h=[],p=[];function d(e,r,n,i,a){for(var s=n;s<i;){var u=s,l=r[s],v=ns(t,e[s]);s++;for(;s<i;s++){var g=ns(t,e[s]);if(v+g>=c)break;v+=g}if(s==u+1){if(v>c){var m=e[u];d(m.children,m.positions,0,m.children.length,r[u]+a);continue}h.push(e[u])}else{var y=r[s-1]+e[s-1].length-l;h.push(is(t,e,r,u,s,l,y,null,f))}p.push(l+a-o)}}d(e,r,n,i,0);return(s||f)(h,p,a)}var os=function(){function t(t,e,r,n,i,o){if(i===void 0){i=false}if(o===void 0){o=false}this.from=t;this.to=e;this.tree=r;this.offset=n;this.open=(i?1:0)|(o?2:0)}Object.defineProperty(t.prototype,"openStart",{get:function(){return(this.open&1)>0},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"openEnd",{get:function(){return(this.open&2)>0},enumerable:false,configurable:true});t.addTree=function(e,r,n){if(r===void 0){r=[]}if(n===void 0){n=false}var i=[new t(0,e.length,e,0,false,n)];for(var o=0,a=r;o<a.length;o++){var s=a[o];if(s.to>e.length)i.push(s)}return i};t.applyChanges=function(e,r,n){if(n===void 0){n=128}if(!r.length)return e;var i=[];var o=1,a=e.length?e[0]:null;for(var s=0,f=0,u=0;;s++){var l=s<r.length?r[s]:null;var c=l?l.fromA:1e9;if(c-f>=n)while(a&&a.from<c){var h=a;if(f>=h.from||c<=h.to||u){var p=Math.max(h.from,f)-u,d=Math.min(h.to,c)-u;h=p>=d?null:new t(p,d,h.tree,h.offset+u,s>0,!!l)}if(h)i.push(h);if(a.to>c)break;a=o<e.length?e[o++]:null}if(!l)break;f=l.toA;u=l.toA-l.toB}return i};return t}();var as=function(){function t(){}t.prototype.startParse=function(t,e,r){if(typeof t=="string")t=new ss(t);r=!r?[new Ia(0,t.length)]:r.length?r.map((function(t){return new Ia(t.from,t.to)})):[new Ia(0,0)];return this.createParse(t,e||[],r)};t.prototype.parse=function(t,e,r){var n=this.startParse(t,e,r);for(;;){var i=n.advance();if(i)return i}};return t}();t("P",as);var ss=function(){function t(t){this.string=t}Object.defineProperty(t.prototype,"length",{get:function(){return this.string.length},enumerable:false,configurable:true});t.prototype.chunk=function(t){return this.string.slice(t)};Object.defineProperty(t.prototype,"lineChunks",{get:function(){return false},enumerable:false,configurable:true});t.prototype.read=function(t,e){return this.string.slice(t,e)};return t}();function fs(t){return function(e,r,n,i){return new hs(e,t,r,n,i)}}var us=function(){function t(t,e,r,n,i){this.parser=t;this.parse=e;this.overlay=r;this.target=n;this.ranges=i}return t}();var ls=function(){function t(t,e,r,n,i,o,a){this.parser=t;this.predicate=e;this.mounts=r;this.index=n;this.start=i;this.target=o;this.prev=a;this.depth=0;this.ranges=[]}return t}();var cs=new Na({perNode:true});var hs=function(){function t(t,e,r,n,i){this.nest=e;this.input=r;this.fragments=n;this.ranges=i;this.inner=[];this.innerDone=0;this.baseTree=null;this.stoppedAt=null;this.baseParse=t}t.prototype.advance=function(){if(this.baseParse){var t=this.baseParse.advance();if(!t)return null;this.baseParse=null;this.baseTree=t;this.startInner();if(this.stoppedAt!=null)for(var e=0,r=this.inner;e<r.length;e++){var n=r[e];n.parse.stopAt(this.stoppedAt)}}if(this.innerDone==this.inner.length){var i=this.baseTree;if(this.stoppedAt!=null)i=new Wa(i.type,i.children,i.positions,i.length,i.propValues.concat([[cs,this.stoppedAt]]));return i}var o=this.inner[this.innerDone],a=o.parse.advance();if(a){this.innerDone++;var s=Object.assign(Object.create(null),o.target.props);s[Na.mounted.id]=new ja(a,o.overlay,o.parser);o.target.props=s}return null};Object.defineProperty(t.prototype,"parsedPos",{get:function(){if(this.baseParse)return 0;var t=this.input.length;for(var e=this.innerDone;e<this.inner.length;e++){if(this.inner[e].ranges[0].from<t)t=Math.min(t,this.inner[e].parse.parsedPos)}return t},enumerable:false,configurable:true});t.prototype.stopAt=function(t){this.stoppedAt=t;if(this.baseParse)this.baseParse.stopAt(t);else for(var e=this.innerDone;e<this.inner.length;e++)this.inner[e].parse.stopAt(t)};t.prototype.startInner=function(){var t=new ms(this.fragments);var e=null;var r=null;var n=new Za(new $a(this.baseTree,this.ranges[0].from,0,null),1);t:for(var i=void 0,o=void 0;this.stoppedAt==null||n.from<this.stoppedAt;){var a=true,s=void 0;if(t.hasNode(n)){if(e){var f=e.mounts.find((function(t){return t.frag.from<=n.from&&t.frag.to>=n.to&&t.mount.overlay}));if(f){var u=function(t){var r=t.from+f.pos,i=t.to+f.pos;if(r>=n.from&&i<=n.to&&!e.ranges.some((function(t){return t.from<i&&t.to>r})))e.ranges.push({from:r,to:i})};for(var l=0,c=f.mount.overlay;l<c.length;l++){var h=c[l];u(h)}}}a=false}else if(r&&(o=ps(r.ranges,n.from,n.to))){a=o!=2}else if(!n.type.isAnonymous&&n.from<n.to&&(i=this.nest(n,this.input))){if(!n.tree)vs(n);var p=t.findMounts(n.from,i.parser);if(typeof i.overlay=="function"){e=new ls(i.parser,i.overlay,p,this.inner.length,n.from,n.tree,e)}else{var d=ys(this.ranges,i.overlay||[new Ia(n.from,n.to)]);if(d.length)this.inner.push(new us(i.parser,i.parser.startParse(this.input,ws(p,d),d),i.overlay?i.overlay.map((function(t){return new Ia(t.from-n.from,t.to-n.from)})):null,n.tree,d));if(!i.overlay)a=false;else if(d.length)r={ranges:d,depth:0,prev:r}}}else if(e&&(s=e.predicate(n))){if(s===true)s=new Ia(n.from,n.to);if(s.from<s.to)e.ranges.push(s)}if(a&&n.firstChild()){if(e)e.depth++;if(r)r.depth++}else{for(;;){if(n.nextSibling())break;if(!n.parent())break t;if(e&&!--e.depth){var d=ys(this.ranges,e.ranges);if(d.length)this.inner.splice(e.index,0,new us(e.parser,e.parser.startParse(this.input,ws(e.mounts,d),d),e.ranges.map((function(t){return new Ia(t.from-e.start,t.to-e.start)})),e.target,d));e=e.prev}if(r&&!--r.depth)r=r.prev}}}};return t}();function ps(t,e,r){for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.from>=r)break;if(o.to>e)return o.from<=e&&o.to>=r?2:1}return 0}function ds(t,e,r,n,i,o){if(e<r){var a=t.buffer[e+1],s=t.buffer[r-2];n.push(t.slice(e,r,a,s));i.push(a-o)}}function vs(t){var e=t.node,r=0;do{t.parent();r++}while(!t.tree);var n=0,i=t.tree,o=0;for(;;n++){o=i.positions[n]+t.from;if(o<=e.from&&o+i.children[n].length>=e.to)break}var a=i.children[n],s=a.buffer;function f(t,r,n,i,u){var l=t;while(s[l+2]+o<=e.from)l=s[l+3];var c=[],h=[];ds(a,t,l,c,h,i);var p=s[l+1],d=s[l+2];var v=p+o==e.from&&d+o==e.to&&s[l]==e.type.id;c.push(v?e.toTree():f(l+4,s[l+3],a.set.types[s[l]],p,d-p));h.push(p-i);ds(a,s[l+3],r,c,h,i);return new Wa(n,c,h,u)}i.children[n]=f(0,s.length,Va.none,0,a.length);for(var u=0;u<=r;u++)t.childAfter(e.from)}var gs=function(){function t(t,e){this.offset=e;this.done=false;this.cursor=t.fullCursor()}t.prototype.moveTo=function(t){var e=this.cursor,r=t-this.offset;while(!this.done&&e.from<r){if(e.to>=t&&e.enter(r,1,false,false));else if(!e.next(false))this.done=true}};t.prototype.hasNode=function(t){this.moveTo(t.from);if(!this.done&&this.cursor.from+this.offset==t.from&&this.cursor.tree){for(var e=this.cursor.tree;;){if(e==t.tree)return true;if(e.children.length&&e.positions[0]==0&&e.children[0]instanceof Wa)e=e.children[0];else break}}return false};return t}();var ms=function(){function t(t){var e;this.fragments=t;this.curTo=0;this.fragI=0;if(t.length){var r=this.curFrag=t[0];this.curTo=(e=r.tree.prop(cs))!==null&&e!==void 0?e:r.to;this.inner=new gs(r.tree,-r.offset)}else{this.curFrag=this.inner=null}}t.prototype.hasNode=function(t){while(this.curFrag&&t.from>=this.curTo)this.nextFrag();return this.curFrag&&this.curFrag.from<=t.from&&this.curTo>=t.to&&this.inner.hasNode(t)};t.prototype.nextFrag=function(){var t;this.fragI++;if(this.fragI==this.fragments.length){this.curFrag=this.inner=null}else{var e=this.curFrag=this.fragments[this.fragI];this.curTo=(t=e.tree.prop(cs))!==null&&t!==void 0?t:e.to;this.inner=new gs(e.tree,-e.offset)}};t.prototype.findMounts=function(t,e){var r;var n=[];if(this.inner){this.inner.cursor.moveTo(t,1);for(var i=this.inner.cursor.node;i;i=i.parent){var o=(r=i.tree)===null||r===void 0?void 0:r.prop(Na.mounted);if(o&&o.parser==e){for(var a=this.fragI;a<this.fragments.length;a++){var s=this.fragments[a];if(s.from>=i.to)break;if(s.tree==this.curFrag.tree)n.push({frag:s,pos:i.from-s.offset,mount:o})}}}}return n};return t}();function ys(t,e){var r=null,n=e;for(var i=1,o=0;i<t.length;i++){var a=t[i-1].to,s=t[i].from;for(;o<n.length;o++){var f=n[o];if(f.from>=s)break;if(f.to<=a)continue;if(!r)n=r=e.slice();if(f.from<a){r[o]=new Ia(f.from,a);if(f.to>s)r.splice(o+1,0,new Ia(s,f.to))}else if(f.to>s){r[o--]=new Ia(s,f.to)}else{r.splice(o--,1)}}}return n}function bs(t,e,r,n){var i=0,o=0,a=false,s=false,f=-1e9;var u=[];for(;;){var l=i==t.length?1e9:a?t[i].to:t[i].from;var c=o==e.length?1e9:s?e[o].to:e[o].from;if(a!=s){var h=Math.max(f,r),p=Math.min(l,c,n);if(h<p)u.push(new Ia(h,p))}f=Math.min(l,c);if(f==1e9)break;if(l==f){if(!a)a=true;else{a=false;i++}}if(c==f){if(!s)s=true;else{s=false;o++}}}return u}function ws(t,e){var r=[];var n=function(t,n,i){var o=t+(n.overlay?n.overlay[0].from:0),a=o+n.tree.length;var s=Math.max(i.from,o),f=Math.min(i.to,a);if(n.overlay){var u=n.overlay.map((function(e){return new Ia(e.from+t,e.to+t)}));var l=bs(e,u,s,f);for(var c=0,h=s;;c++){var p=c==l.length,d=p?f:l[c].from;if(d>h)r.push(new os(h,d,n.tree,-o,i.from>=h,i.to<=d));if(p)break;h=l[c].to}}else{r.push(new os(s,f,n.tree,-o,i.from>=o,i.to<=a))}};for(var i=0,o=t;i<o.length;i++){var a=o[i],s=a.pos,f=a.mount,u=a.frag;n(s,f,u)}return r}var xs=t("l",new Na);function ks(t){return Y.define({combine:t?function(e){return e.concat(t)}:undefined})}var Ss=function(){function t(t,e,r,n){if(n===void 0){n=[]}this.data=t;this.topNode=r;if(!_t.prototype.hasOwnProperty("tree"))Object.defineProperty(_t.prototype,"tree",{get:function(){return Os(this)}});this.parser=e;this.extension=[Bs.of(this),_t.languageData.of((function(t,e,r){return t.facet(Cs(t,e,r))}))].concat(n)}t.prototype.isActiveAt=function(t,e,r){if(r===void 0){r=-1}return Cs(t,e,r)==this.data};t.prototype.findRegions=function(t){var e=this;var r=t.facet(Bs);if((r===null||r===void 0?void 0:r.data)==this.data)return[{from:0,to:t.doc.length}];if(!r||!r.allowsNesting)return[];var n=[];var i=function(t,r){if(t.prop(xs)==e.data){n.push({from:r,to:r+t.length});return}var o=t.prop(Na.mounted);if(o){if(o.tree.prop(xs)==e.data){if(o.overlay)for(var a=0,s=o.overlay;a<s.length;a++){var f=s[a];n.push({from:f.from+r,to:f.to+r})}else n.push({from:r,to:r+t.length});return}else if(o.overlay){var u=n.length;i(o.tree,o.overlay[0].from+r);if(n.length>u)return}}for(var l=0;l<t.children.length;l++){var c=t.children[l];if(c instanceof Wa)i(c,t.positions[l]+r)}};i(Os(t),0);return n};Object.defineProperty(t.prototype,"allowsNesting",{get:function(){return true},enumerable:false,configurable:true});return t}();t("L",Ss);Ss.setState=St.define();function Cs(t,e,r){var n=t.facet(Bs);if(!n)return null;var i=n.data;if(n.allowsNesting){for(var o=Os(t).topNode;o;o=o.enter(e,r,true,false))i=o.type.prop(xs)||i}return i}var As=function(t){__extends(e,t);function e(e,r){var n=t.call(this,e,r,r.topNode)||this;n.parser=r;return n}e.define=function(t){var r=ks(t.languageData);return new e(r,t.parser.configure({props:[xs.add((function(t){return t.isTop?r:undefined}))]}))};e.prototype.configure=function(t){return new e(this.data,this.parser.configure(t))};Object.defineProperty(e.prototype,"allowsNesting",{get:function(){return this.parser.wrappers.length>0},enumerable:false,configurable:true});return e}(Ss);t("h",As);function Os(t){var e=t.field(Ss.state,false);return e?e.tree:Wa.empty}var Ms=function(){function t(t,e){if(e===void 0){e=t.length}this.doc=t;this.length=e;this.cursorPos=0;this.string="";this.cursor=t.iter()}t.prototype.syncTo=function(t){this.string=this.cursor.next(t-this.cursorPos).value;this.cursorPos=t+this.string.length;return this.cursorPos-this.string.length};t.prototype.chunk=function(t){this.syncTo(t);return this.string};Object.defineProperty(t.prototype,"lineChunks",{get:function(){return true},enumerable:false,configurable:true});t.prototype.read=function(t,e){var r=this.cursorPos-this.string.length;if(t<r||e>=this.cursorPos)return this.doc.sliceString(t,e);else return this.string.slice(t-r,e-r)};return t}();var Ds=null;var Ps=function(){function t(t,e,r,n,i,o,a,s){if(r===void 0){r=[]}this.parser=t;this.state=e;this.fragments=r;this.tree=n;this.treeLen=i;this.viewport=o;this.skipped=a;this.scheduleOn=s;this.parse=null;this.tempSkipped=[]}t.prototype.startParse=function(){return this.parser.startParse(new Ms(this.state.doc),this.fragments)};t.prototype.work=function(t,e){var r=this;if(e!=null&&e>=this.state.doc.length)e=undefined;if(this.tree!=Wa.empty&&this.isDone(e!==null&&e!==void 0?e:this.state.doc.length)){this.takeTree();return true}return this.withContext((function(){var n;var i=Date.now()+t;if(!r.parse)r.parse=r.startParse();if(e!=null&&(r.parse.stoppedAt==null||r.parse.stoppedAt>e)&&e<r.state.doc.length)r.parse.stopAt(e);for(;;){var o=r.parse.advance();if(o){r.fragments=r.withoutTempSkipped(os.addTree(o,r.fragments,r.parse.stoppedAt!=null));r.treeLen=(n=r.parse.stoppedAt)!==null&&n!==void 0?n:r.state.doc.length;r.tree=o;r.parse=null;if(r.treeLen<(e!==null&&e!==void 0?e:r.state.doc.length))r.parse=r.startParse();else return true}if(Date.now()>i)return false}}))};t.prototype.takeTree=function(){var t=this;var e,r;if(this.parse&&(e=this.parse.parsedPos)>=this.treeLen){if(this.parse.stoppedAt==null||this.parse.stoppedAt>e)this.parse.stopAt(e);this.withContext((function(){while(!(r=t.parse.advance())){}}));this.treeLen=e;this.tree=r;this.fragments=this.withoutTempSkipped(os.addTree(this.tree,this.fragments,true));this.parse=null}};t.prototype.withContext=function(t){var e=Ds;Ds=this;try{return t()}finally{Ds=e}};t.prototype.withoutTempSkipped=function(t){for(var e=void 0;e=this.tempSkipped.pop();)t=Ts(t,e.from,e.to);return t};t.prototype.changes=function(e,r){var n=this,i=n.fragments,o=n.tree,a=n.treeLen,s=n.viewport,f=n.skipped;this.takeTree();if(!e.empty){var u=[];e.iterChangedRanges((function(t,e,r,n){return u.push({fromA:t,toA:e,fromB:r,toB:n})}));i=os.applyChanges(i,u);o=Wa.empty;a=0;s={from:e.mapPos(s.from,-1),to:e.mapPos(s.to,1)};if(this.skipped.length){f=[];for(var l=0,c=this.skipped;l<c.length;l++){var h=c[l];var p=e.mapPos(h.from,1),d=e.mapPos(h.to,-1);if(p<d)f.push({from:p,to:d})}}}return new t(this.parser,r,i,o,a,s,f,this.scheduleOn)};t.prototype.updateViewport=function(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return false;this.viewport=t;var e=this.skipped.length;for(var r=0;r<this.skipped.length;r++){var n=this.skipped[r],i=n.from,o=n.to;if(i<t.to&&o>t.from){this.fragments=Ts(this.fragments,i,o);this.skipped.splice(r--,1)}}if(this.skipped.length>=e)return false;this.reset();return true};t.prototype.reset=function(){if(this.parse){this.takeTree();this.parse=null}};t.prototype.skipUntilInView=function(t,e){this.skipped.push({from:t,to:e})};t.getSkippingParser=function(t){return new(function(e){__extends(r,e);function r(){return e!==null&&e.apply(this,arguments)||this}r.prototype.createParse=function(e,r,n){var i=n[0].from,o=n[n.length-1].to;var a={parsedPos:i,advance:function(){var e=Ds;if(e){for(var r=0,a=n;r<a.length;r++){var s=a[r];e.tempSkipped.push(s)}if(t)e.scheduleOn=e.scheduleOn?Promise.all([e.scheduleOn,t]):t}this.parsedPos=o;return new Wa(Va.none,[],[],o-i)},stoppedAt:null,stopAt:function(){}};return a};return r}(as))};t.prototype.isDone=function(t){t=Math.min(t,this.state.doc.length);var e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t};t.get=function(){return Ds};return t}();t("c",Ps);function Ts(t,e,r){return os.applyChanges(t,[{fromA:e,toA:r,fromB:e,toB:r}])}var Es=function(){function t(t){this.context=t;this.tree=t.tree}t.prototype.apply=function(e){if(!e.docChanged)return this;var r=this.context.changes(e.changes,e.state);var n=this.context.treeLen==e.startState.doc.length?undefined:Math.max(e.changes.mapPos(this.context.treeLen),r.viewport.to);if(!r.work(20,n))r.takeTree();return new t(r)};t.init=function(e){var r=Math.min(3e3,e.doc.length);var n=new Ps(e.facet(Bs).parser,e,[],Wa.empty,0,{from:0,to:r},[],null);if(!n.work(20,r))n.takeTree();return new t(n)};return t}();Ss.state=rt.define({create:Es.init,update:function(t,e){for(var r=0,n=e.effects;r<n.length;r++){var i=n[r];if(i.is(Ss.setState))return i.value}if(e.startState.facet(Bs)!=e.state.facet(Bs))return Es.init(e.state);return t.apply(e)}});var Rs=function(t){var e=setTimeout((function(){return t()}),500);return function(){return clearTimeout(e)}};if(typeof requestIdleCallback!="undefined")Rs=function(t){var e=-1,r=setTimeout((function(){e=requestIdleCallback(t,{timeout:500-100})}),100);return function(){return e<0?clearTimeout(r):cancelIdleCallback(e)}};var Ls=tn.fromClass(function(){function t(t){this.view=t;this.working=null;this.workScheduled=0;this.chunkEnd=-1;this.chunkBudget=-1;this.work=this.work.bind(this);this.scheduleWork()}t.prototype.update=function(t){var e=this.view.state.field(Ss.state).context;if(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)this.scheduleWork();if(t.docChanged){if(this.view.hasFocus)this.chunkBudget+=50;this.scheduleWork()}this.checkAsyncSchedule(e)};t.prototype.scheduleWork=function(){if(this.working)return;var t=this.view.state,e=t.field(Ss.state);if(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))this.working=Rs(this.work)};t.prototype.work=function(t){this.working=null;var e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)){this.chunkEnd=e+3e4;this.chunkBudget=3e3}if(this.chunkBudget<=0)return;var r=this.view,n=r.state,i=r.viewport.to,o=n.field(Ss.state);if(o.tree==o.context.tree&&o.context.isDone(i+1e5))return;var a=Math.min(this.chunkBudget,100,t?Math.max(25,t.timeRemaining()-5):1e9);var s=o.context.treeLen<i&&n.doc.length>i+1e3;var f=o.context.work(a,i+(s?0:1e5));this.chunkBudget-=Date.now()-e;if(f||this.chunkBudget<=0){o.context.takeTree();this.view.dispatch({effects:Ss.setState.of(new Es(o.context))})}if(this.chunkBudget>0&&!(f&&!s))this.scheduleWork();this.checkAsyncSchedule(o.context)};t.prototype.checkAsyncSchedule=function(t){var e=this;if(t.scheduleOn){this.workScheduled++;t.scheduleOn.then((function(){return e.scheduleWork()})).catch((function(t){return Jr(e.view.state,t)})).then((function(){return e.workScheduled--}));t.scheduleOn=null}};t.prototype.destroy=function(){if(this.working)this.working()};t.prototype.isWorking=function(){return this.working||this.workScheduled>0};return t}(),{eventHandlers:{focus:function(){this.scheduleWork()}}});var Bs=Y.define({combine:function(t){return t.length?t[0]:null},enables:[Ss.state,Ls]});var Is=function(){function t(t,e){if(e===void 0){e=[]}this.language=t;this.support=e;this.extension=[t,e]}return t}();t("f",Is);var Ns=function(){function t(t,e,r,n,i,o){if(o===void 0){o=undefined}this.name=t;this.alias=e;this.extensions=r;this.filename=n;this.loadFunc=i;this.support=o;this.loading=null}t.prototype.load=function(){var t=this;return this.loading||(this.loading=this.loadFunc().then((function(e){return t.support=e}),(function(e){t.loading=null;throw e})))};t.of=function(e){var r=e.load,n=e.support;if(!r){if(!n)throw new RangeError("Must pass either 'load' or 'support' to LanguageDescription.of");r=function(){return Promise.resolve(n)}}return new t(e.name,(e.alias||[]).concat(e.name).map((function(t){return t.toLowerCase()})),e.extensions||[],e.filename,r,n)};t.matchFilename=function(t,e){for(var r=0,n=t;r<n.length;r++){var i=n[r];if(i.filename&&i.filename.test(e))return i}var o=/\.([^.]+)$/.exec(e);if(o)for(var a=0,s=t;a<s.length;a++){var i=s[a];if(i.extensions.indexOf(o[1])>-1)return i}return null};t.matchLanguageName=function(t,e,r){if(r===void 0){r=true}e=e.toLowerCase();for(var n=0,i=t;n<i.length;n++){var o=i[n];if(o.alias.some((function(t){return t==e})))return o}if(r)for(var a=0,s=t;a<s.length;a++){var o=s[a];for(var f=0,u=o.alias;f<u.length;f++){var l=u[f];var c=e.indexOf(l);if(c>-1&&(l.length>2||!/\w/.test(e[c-1])&&!/\w/.test(e[c+l.length])))return o}}return null};return t}();t("z",Ns);var js=t("i",Y.define());var _s=Y.define({combine:function(t){if(!t.length)return"  ";if(!/^(?: +|\t+)$/.test(t[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return t[0]}});function Vs(t){var e=t.facet(_s);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function Hs(t,e){var r="",n=t.tabSize;if(t.facet(_s).charCodeAt(0)==9)while(e>=n){r+="\t";e-=n}for(var i=0;i<e;i++)r+=" ";return r}function Fs(t,e){if(t instanceof _t)t=new zs(t);for(var r=0,n=t.state.facet(js);r<n.length;r++){var i=n[r];var o=i(t,e);if(o!=null)return o}var a=Os(t.state);return a?qs(t,a,e):null}var zs=function(){function t(t,e){if(e===void 0){e={}}this.state=t;this.options=e;this.unit=Vs(t)}t.prototype.lineAt=function(t,e){if(e===void 0){e=1}var r=this.state.doc.lineAt(t);var n=this.options,i=n.simulateBreak,o=n.simulateDoubleBreak;if(i!=null&&i>=r.from&&i<=r.to){if(o&&i==t)return{text:"",from:t};else if(e<0?i<t:i<=t)return{text:r.text.slice(i-r.from),from:i};else return{text:r.text.slice(0,i-r.from),from:r.from}}return r};t.prototype.textAfterPos=function(t,e){if(e===void 0){e=1}if(this.options.simulateDoubleBreak&&t==this.options.simulateBreak)return"";var r=this.lineAt(t,e),n=r.text,i=r.from;return n.slice(t-i,Math.min(n.length,t+100-i))};t.prototype.column=function(t,e){if(e===void 0){e=1}var r=this.lineAt(t,e),n=r.text,i=r.from;var o=this.countColumn(n,t-i);var a=this.options.overrideIndentation?this.options.overrideIndentation(i):-1;if(a>-1)o+=a-this.countColumn(n,n.search(/\S|$/));return o};t.prototype.countColumn=function(t,e){if(e===void 0){e=t.length}return S(t,this.state.tabSize,e)};t.prototype.lineIndent=function(t,e){if(e===void 0){e=1}var r=this.lineAt(t,e),n=r.text,i=r.from;var o=this.options.overrideIndentation;if(o){var a=o(i);if(a>-1)return a}return this.countColumn(n,n.search(/\S|$/))};Object.defineProperty(t.prototype,"simulatedBreak",{get:function(){return this.options.simulateBreak||null},enumerable:false,configurable:true});return t}();var Ws=t("j",new Na);function qs(t,e,r){return Ks(e.resolveInner(r).enterUnfinishedNodesBefore(r),r,t)}function Us(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function Gs(t){var e=t.type.prop(Ws);if(e)return e;var r=t.firstChild,n;if(r&&(n=r.type.prop(Na.closedBy))){var i=t.lastChild,o=i&&n.indexOf(i.name)>-1;return function(t){return Zs(t,true,1,undefined,o&&!Us(t)?i.from:undefined)}}return t.parent==null?Js:null}function Ks(t,e,r){for(;t;t=t.parent){var n=Gs(t);if(n)return n(new $s(r,e,t))}return null}function Js(){return 0}var $s=function(t){__extends(e,t);function e(e,r,n){var i=t.call(this,e.state,e.options)||this;i.base=e;i.pos=r;i.node=n;return i}Object.defineProperty(e.prototype,"textAfter",{get:function(){return this.textAfterPos(this.pos)},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"baseIndent",{get:function(){var t=this.state.doc.lineAt(this.node.from);for(;;){var e=this.node.resolve(t.from);while(e.parent&&e.parent.from==e.from)e=e.parent;if(Ys(e,this.node))break;t=this.state.doc.lineAt(e.from)}return this.lineIndent(t.from)},enumerable:false,configurable:true});e.prototype.continue=function(){var t=this.node.parent;return t?Ks(t,this.pos,this.base):0};return e}(zs);function Ys(t,e){for(var r=e;r;r=r.parent)if(t==r)return true;return false}function Xs(t){var e=t.node;var r=e.childAfter(e.from),n=e.lastChild;if(!r)return null;var i=t.options.simulateBreak;var o=t.state.doc.lineAt(r.from);var a=i==null||i<=o.from?o.to:Math.min(o.to,i);for(var s=r.to;;){var f=e.childAfter(s);if(!f||f==n)return null;if(!f.type.isSkipped)return f.from<a?r:null;s=f.to}}function Qs(t){var e=t.closing,r=t.align,n=r===void 0?true:r,i=t.units,o=i===void 0?1:i;return function(t){return Zs(t,n,o,e)}}function Zs(t,e,r,n,i){var o=t.textAfter,a=o.match(/^\s*/)[0].length;var s=n&&o.slice(a,a+n.length)==n||i==t.pos+a;var f=e?Xs(t):null;if(f)return s?t.column(f.from):t.column(f.to);return t.baseIndent+(s?0:t.unit*r)}var tf=t("r",(function(t){return t.baseIndent}));function ef(t){var e=t===void 0?{}:t,r=e.except,n=e.units,i=n===void 0?1:n;return function(t){var e=r&&r.test(t.textAfter);return t.baseIndent+(e?0:i*t.unit)}}var rf=Y.define();var nf=t("m",new Na);function of(t){var e=t.firstChild,r=t.lastChild;return e&&e.to<r.from?{from:e.to,to:r.type.isError?t.to:r.from}:null}function af(t,e,r){var n=Os(t);if(n.length==0)return null;var i=n.resolveInner(r);var o=null;for(var a=i;a;a=a.parent){if(a.to<=r||a.from>r)continue;if(o&&a.from<e)break;var s=a.type.prop(nf);if(s){var f=s(a,t);if(f&&f.from<=r&&f.from>=e&&f.to>r)o=f}}return o}function sf(t,e,r){for(var n=0,i=t.facet(rf);n<i.length;n++){var o=i[n];var a=o(t,e,r);if(a)return a}return af(t,e,r)}var ff=function(){function t(t,e,r){this.state=t;this.pos=e;this.explicit=r;this.abortListeners=[]}t.prototype.tokenBefore=function(t){var e=Os(this.state).resolveInner(this.pos,-1);while(e&&t.indexOf(e.name)<0)e=e.parent;return e?{from:e.from,to:this.pos,text:this.state.sliceDoc(e.from,this.pos),type:e.type}:null};t.prototype.matchBefore=function(t){var e=this.state.doc.lineAt(this.pos);var r=Math.max(e.from,this.pos-250);var n=e.text.slice(r-e.from,this.pos-e.from);var i=n.search(vf(t,false));return i<0?null:{from:r+i,to:this.pos,text:n.slice(i)}};Object.defineProperty(t.prototype,"aborted",{get:function(){return this.abortListeners==null},enumerable:false,configurable:true});t.prototype.addEventListener=function(t,e){if(t=="abort"&&this.abortListeners)this.abortListeners.push(e)};return t}();function uf(t){var e=Object.keys(t).join("");var r=/\w/.test(e);if(r)e=e.replace(/\w/g,"");return"[".concat(r?"\\w":"").concat(e.replace(/[^\w\s]/g,"\\$&"),"]")}function lf(t){var e=Object.create(null),r=Object.create(null);for(var n=0,i=t;n<i.length;n++){var o=i[n].label;e[o[0]]=true;for(var a=1;a<o.length;a++)r[o[a]]=true}var s=uf(e)+uf(r)+"*$";return[new RegExp("^"+s),new RegExp(s)]}function cf(t){var e=t.map((function(t){return typeof t=="string"?{label:t}:t}));var r=e.every((function(t){return/^\w+$/.test(t.label)}))?[/\w*$/,/\w+$/]:lf(e),n=r[0],i=r[1];return function(t){var r=t.matchBefore(i);return r||t.explicit?{from:r?r.from:t.pos,options:e,span:n}:null}}function hf(t,e){return function(r){for(var n=Os(r.state).resolveInner(r.pos,-1);n;n=n.parent)if(t.indexOf(n.name)>-1)return null;return e(r)}}var pf=function(){function t(t,e,r){this.completion=t;this.source=e;this.match=r}return t}();function df(t){return t.selection.main.head}function vf(t,e){var r;var n=t.source;var i=e&&n[0]!="^",o=n[n.length-1]!="$";if(!i&&!o)return t;return new RegExp("".concat(i?"^":"","(?:").concat(n,")").concat(o?"$":""),(r=t.flags)!==null&&r!==void 0?r:t.ignoreCase?"i":"")}var gf=wt.define();function mf(t,e){var r=e.completion.apply||e.completion.label;var n=e.source;if(typeof r=="string"){t.dispatch({changes:{from:n.from,to:n.to,insert:r},selection:{anchor:n.from+r.length},userEvent:"input.complete",annotations:gf.of(e.completion)})}else{r(t,e.completion,n.from,n.to)}}var yf=new WeakMap;function bf(t){if(!Array.isArray(t))return t;var e=yf.get(t);if(!e)yf.set(t,e=cf(t));return e}var wf=function(){function t(t){this.pattern=t;this.chars=[];this.folded=[];this.any=[];this.precise=[];this.byWord=[];for(var e=0;e<t.length;){var r=w(t,e),n=k(r);this.chars.push(r);var i=t.slice(e,e+n),o=i.toUpperCase();this.folded.push(w(o==i?i.toLowerCase():o,0));e+=n}this.astral=t.length!=this.chars.length}t.prototype.match=function(t){if(this.pattern.length==0)return[0];if(t.length<this.pattern.length)return null;var e=this,r=e.chars,n=e.folded,i=e.any,o=e.precise,a=e.byWord;if(r.length==1){var s=w(t,0);return s==r[0]?[0,0,k(s)]:s==n[0]?[-200,0,k(s)]:null}var f=t.indexOf(this.pattern);if(f==0)return[0,0,this.pattern.length];var u=r.length,l=0;if(f<0){for(var c=0,h=Math.min(t.length,200);c<h&&l<u;){var p=w(t,c);if(p==r[l]||p==n[l])i[l++]=c;c+=k(p)}if(l<u)return null}var d=0;var v=0,g=false;var m=0,y=-1,b=-1;var S=/[a-z]/.test(t),C=true;for(var A=0,h=Math.min(t.length,200),O=0;A<h&&v<u;){var p=w(t,A);if(f<0){if(d<u&&p==r[d])o[d++]=A;if(m<u){if(p==r[m]||p==n[m]){if(m==0)y=A;b=A+1;m++}else{m=0}}}var M=void 0,D=p<255?p>=48&&p<=57||p>=97&&p<=122?2:p>=65&&p<=90?1:0:(M=x(p))!=M.toLowerCase()?1:M!=M.toUpperCase()?2:0;if(!A||D==1&&S||O==0&&D!=0){if(r[v]==p||n[v]==p&&(g=true))a[v++]=A;else if(a.length)C=false}O=D;A+=k(p)}if(v==u&&a[0]==0&&C)return this.result(-100+(g?-200:0),a,t);if(m==u&&y==0)return[-200-t.length,0,b];if(f>-1)return[-700-t.length,f,f+this.pattern.length];if(m==u)return[-200+-700-t.length,y,b];if(v==u)return this.result(-100+(g?-200:0)+-700+(C?0:-1100),a,t);return r.length==2?null:this.result((i[0]?-700:0)+-200+-1100,i,t)};t.prototype.result=function(t,e,r){var n=[t-r.length],i=1;for(var o=0,a=e;o<a.length;o++){var s=a[o];var f=s+(this.astral?k(w(r,s)):1);if(i>1&&n[i-1]==s)n[i-1]=f;else{n[i++]=s;n[i++]=f}}return n};return t}();var xf=Y.define({combine:function(t){return Vt(t,{activateOnTyping:true,override:null,maxRenderedOptions:100,defaultKeymap:true,optionClass:function(){return""},aboveCursor:false,icons:true,addToOptions:[]},{defaultKeymap:function(t,e){return t&&e},icons:function(t,e){return t&&e},optionClass:function(t,e){return function(r){return kf(t(r),e(r))}},addToOptions:function(t,e){return t.concat(e)}})}});function kf(t,e){return t?e?t+" "+e:t:e}function Sf(t){var e=t.addToOptions.slice();if(t.icons)e.push({render:function(t){var e;var r=document.createElement("div");r.classList.add("cm-completionIcon");if(t.type)(e=r.classList).add.apply(e,t.type.split(/\s+/g).map((function(t){return"cm-completionIcon-"+t})));r.setAttribute("aria-hidden","true");return r},position:20});e.push({render:function(t,e,r){var n=document.createElement("span");n.className="cm-completionLabel";var i=t.label,o=0;for(var a=1;a<r.length;){var s=r[a++],f=r[a++];if(s>o)n.appendChild(document.createTextNode(i.slice(o,s)));var u=n.appendChild(document.createElement("span"));u.appendChild(document.createTextNode(i.slice(s,f)));u.className="cm-completionMatchedText";o=f}if(o<i.length)n.appendChild(document.createTextNode(i.slice(o)));return n},position:50},{render:function(t){if(!t.detail)return null;var e=document.createElement("span");e.className="cm-completionDetail";e.textContent=t.detail;return e},position:80});return e.sort((function(t,e){return t.position-e.position})).map((function(t){return t.render}))}function Cf(t,e,r){if(t<=r)return{from:0,to:t};if(e<=t>>1){var n=Math.floor(e/r);return{from:n*r,to:(n+1)*r}}var i=Math.floor((t-e)/r);return{from:t-(i+1)*r,to:t-i*r}}var Af=function(){function t(t,e){var r=this;this.view=t;this.stateField=e;this.info=null;this.placeInfo={read:function(){return r.measureInfo()},write:function(t){return r.positionInfo(t)},key:this};var n=t.state.field(e);var i=n.open,o=i.options,a=i.selected;var s=t.state.facet(xf);this.optionContent=Sf(s);this.optionClass=s.optionClass;this.range=Cf(o.length,a,s.maxRenderedOptions);this.dom=document.createElement("div");this.dom.className="cm-tooltip-autocomplete";this.dom.addEventListener("mousedown",(function(e){for(var n=e.target,i=void 0;n&&n!=r.dom;n=n.parentNode){if(n.nodeName=="LI"&&(i=/-(\d+)$/.exec(n.id))&&+i[1]<o.length){mf(t,o[+i[1]]);e.preventDefault();return}}}));this.list=this.dom.appendChild(this.createListBox(o,n.id,this.range));this.list.addEventListener("scroll",(function(){if(r.info)r.view.requestMeasure(r.placeInfo)}))}t.prototype.mount=function(){this.updateSel()};t.prototype.update=function(t){if(t.state.field(this.stateField)!=t.startState.field(this.stateField))this.updateSel()};t.prototype.positioned=function(){if(this.info)this.view.requestMeasure(this.placeInfo)};t.prototype.updateSel=function(){var t=this;var e=this.view.state.field(this.stateField),r=e.open;if(r.selected<this.range.from||r.selected>=this.range.to){this.range=Cf(r.options.length,r.selected,this.view.state.facet(xf).maxRenderedOptions);this.list.remove();this.list=this.dom.appendChild(this.createListBox(r.options,e.id,this.range));this.list.addEventListener("scroll",(function(){if(t.info)t.view.requestMeasure(t.placeInfo)}))}if(this.updateSelectedOption(r.selected)){if(this.info){this.info.remove();this.info=null}var n=r.options[r.selected].completion;var i=n.info;if(!i)return;var o=typeof i==="string"?document.createTextNode(i):i(n);if(!o)return;if("then"in o){o.then((function(r){if(r&&t.view.state.field(t.stateField,false)==e)t.addInfoPane(r)})).catch((function(e){return Jr(t.view.state,e,"completion info")}))}else{this.addInfoPane(o)}}};t.prototype.addInfoPane=function(t){var e=this.info=document.createElement("div");e.className="cm-tooltip cm-completionInfo";e.appendChild(t);this.dom.appendChild(e);this.view.requestMeasure(this.placeInfo)};t.prototype.updateSelectedOption=function(t){var e=null;for(var r=this.list.firstChild,n=this.range.from;r;r=r.nextSibling,n++){if(n==t){if(!r.hasAttribute("aria-selected")){r.setAttribute("aria-selected","true");e=r}}else{if(r.hasAttribute("aria-selected"))r.removeAttribute("aria-selected")}}if(e)Mf(this.list,e);return e};t.prototype.measureInfo=function(){var t=this.dom.querySelector("[aria-selected]");if(!t||!this.info)return null;var e=this.dom.getBoundingClientRect();var r=this.info.getBoundingClientRect();var n=t.getBoundingClientRect();if(n.top>Math.min(innerHeight,e.bottom)-10||n.bottom<Math.max(0,e.top)+10)return null;var i=Math.max(0,Math.min(n.top,innerHeight-r.height))-e.top;var o=this.view.textDirection==ln.RTL;var a=e.left,s=innerWidth-e.right;if(o&&a<Math.min(r.width,s))o=false;else if(!o&&s<Math.min(r.width,a))o=true;return{top:i,left:o}};t.prototype.positionInfo=function(t){if(this.info){this.info.style.top=(t?t.top:-1e6)+"px";if(t){this.info.classList.toggle("cm-completionInfo-left",t.left);this.info.classList.toggle("cm-completionInfo-right",!t.left)}}};t.prototype.createListBox=function(t,e,r){var n=document.createElement("ul");n.id=e;n.setAttribute("role","listbox");n.setAttribute("aria-expanded","true");for(var i=r.from;i<r.to;i++){var o=t[i],a=o.completion,s=o.match;var f=n.appendChild(document.createElement("li"));f.id=e+"-"+i;f.setAttribute("role","option");var u=this.optionClass(a);if(u)f.className=u;for(var l=0,c=this.optionContent;l<c.length;l++){var h=c[l];var p=h(a,this.view.state,s);if(p)f.appendChild(p)}}if(r.from)n.classList.add("cm-completionListIncompleteTop");if(r.to<t.length)n.classList.add("cm-completionListIncompleteBottom");return n};return t}();function Of(t){return function(e){return new Af(e,t)}}function Mf(t,e){var r=t.getBoundingClientRect();var n=e.getBoundingClientRect();if(n.top<r.top)t.scrollTop-=r.top-n.top;else if(n.bottom>r.bottom)t.scrollTop+=n.bottom-r.bottom}var Df=300;function Pf(t){return(t.boost||0)*100+(t.apply?10:0)+(t.info?5:0)+(t.type?1:0)}function Tf(t,e){var r=[],n=0;for(var i=0,o=t;i<o.length;i++){var a=o[i];if(a.hasResult()){if(a.result.filter===false){for(var s=0,f=a.result.options;s<f.length;s++){var u=f[s];r.push(new pf(u,a,[1e9-n++]))}}else{var l=new wf(e.sliceDoc(a.from,a.to)),c=void 0;for(var h=0,p=a.result.options;h<p.length;h++){var u=p[h];if(c=l.match(u.label)){if(u.boost!=null)c[0]+=u.boost;r.push(new pf(u,a,c))}}}}}var d=[],v=null;for(var g=0,m=r.sort(jf);g<m.length;g++){var y=m[g];if(d.length==Df)break;if(!v||v.label!=y.completion.label||v.detail!=y.completion.detail||v.type!=y.completion.type||v.apply!=y.completion.apply)d.push(y);else if(Pf(y.completion)>Pf(v))d[d.length-1]=y;v=y.completion}return d}var Ef=function(){function t(t,e,r,n,i){this.options=t;this.attrs=e;this.tooltip=r;this.timestamp=n;this.selected=i}t.prototype.setSelected=function(e,r){return e==this.selected||e>=this.options.length?this:new t(this.options,If(r,e),this.tooltip,this.timestamp,e)};t.build=function(e,r,n,i,o){var a=Tf(e,r);if(!a.length)return null;var s=0;if(i&&i.selected){var f=i.options[i.selected].completion;for(var u=0;u<a.length;u++)if(a[u].completion==f){s=u;break}}return new t(a,If(n,s),{pos:e.reduce((function(t,e){return e.hasResult()?Math.min(t,e.from):t}),1e8),create:Of(Uf),above:o.aboveCursor},i?i.timestamp:Date.now(),s)};t.prototype.map=function(e){return new t(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected)};return t}();var Rf=function(){function t(t,e,r){this.active=t;this.id=e;this.open=r}t.start=function(){return new t(Nf,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)};t.prototype.update=function(e){var r=this;var n=e.state,i=n.facet(xf);var o=i.override||n.languageDataAt("autocomplete",df(n)).map(bf);var a=o.map((function(t){var n=r.active.find((function(e){return e.source==t}))||new Vf(t,r.active.some((function(t){return t.state!=0}))?1:0);return n.update(e,i)}));if(a.length==this.active.length&&a.every((function(t,e){return t==r.active[e]})))a=this.active;var s=e.selection||a.some((function(t){return t.hasResult()&&e.changes.touchesRange(t.from,t.to)}))||!Lf(a,this.active)?Ef.build(a,n,this.id,this.open,i):this.open&&e.docChanged?this.open.map(e.changes):this.open;if(!s&&a.every((function(t){return t.state!=1}))&&a.some((function(t){return t.hasResult()})))a=a.map((function(t){return t.hasResult()?new Vf(t.source,0):t}));for(var f=0,u=e.effects;f<u.length;f++){var l=u[f];if(l.is(qf))s=s&&s.setSelected(l.value,this.id)}return a==this.active&&s==this.open?this:new t(a,this.id,s)};Object.defineProperty(t.prototype,"tooltip",{get:function(){return this.open?this.open.tooltip:null},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"attrs",{get:function(){return this.open?this.open.attrs:Bf},enumerable:false,configurable:true});return t}();function Lf(t,e){if(t==e)return true;for(var r=0,n=0;;){while(r<t.length&&!t[r].hasResult)r++;while(n<e.length&&!e[n].hasResult)n++;var i=r==t.length,o=n==e.length;if(i||o)return i==o;if(t[r++].result!=e[n++].result)return false}}var Bf={"aria-autocomplete":"list"};function If(t,e){return{"aria-autocomplete":"list","aria-haspopup":"listbox","aria-activedescendant":t+"-"+e,"aria-controls":t}}var Nf=[];function jf(t,e){var r=e.match[0]-t.match[0];if(r)return r;return t.completion.label.localeCompare(e.completion.label)}function _f(t){return t.isUserEvent("input.type")?"input":t.isUserEvent("delete.backward")?"delete":null}var Vf=function(){function t(t,e,r){if(r===void 0){r=-1}this.source=t;this.state=e;this.explicitPos=r}t.prototype.hasResult=function(){return false};t.prototype.update=function(e,r){var n=_f(e),i=this;if(n)i=i.handleUserEvent(e,n,r);else if(e.docChanged)i=i.handleChange(e);else if(e.selection&&i.state!=0)i=new t(i.source,0);for(var o=0,a=e.effects;o<a.length;o++){var s=a[o];if(s.is(Ff))i=new t(i.source,1,s.value?df(e.state):-1);else if(s.is(zf))i=new t(i.source,0);else if(s.is(Wf))for(var f=0,u=s.value;f<u.length;f++){var l=u[f];if(l.source==i.source)i=l}}return i};t.prototype.handleUserEvent=function(e,r,n){return r=="delete"||!n.activateOnTyping?this.map(e.changes):new t(this.source,1)};t.prototype.handleChange=function(e){return e.changes.touchesRange(df(e.startState))?new t(this.source,0):this.map(e.changes)};t.prototype.map=function(e){return e.empty||this.explicitPos<0?this:new t(this.source,this.state,e.mapPos(this.explicitPos))};return t}();var Hf=function(t){__extends(e,t);function e(e,r,n,i,o,a){var s=t.call(this,e,2,r)||this;s.result=n;s.from=i;s.to=o;s.span=a;return s}e.prototype.hasResult=function(){return true};e.prototype.handleUserEvent=function(t,r,n){var i=t.changes.mapPos(this.from),o=t.changes.mapPos(this.to,1);var a=df(t.state);if((this.explicitPos<0?a<=i:a<this.from)||a>o||r=="delete"&&df(t.startState)==this.from)return new Vf(this.source,r=="input"&&n.activateOnTyping?1:0);var s=this.explicitPos<0?-1:t.changes.mapPos(this.explicitPos);if(this.span&&(i==o||this.span.test(t.state.sliceDoc(i,o))))return new e(this.source,s,this.result,i,o,this.span);return new Vf(this.source,1,s)};e.prototype.handleChange=function(t){return t.changes.touchesRange(this.from,this.to)?new Vf(this.source,0):this.map(t.changes)};e.prototype.map=function(t){return t.empty?this:new e(this.source,this.explicitPos<0?-1:t.mapPos(this.explicitPos),this.result,t.mapPos(this.from),t.mapPos(this.to,1),this.span)};return e}(Vf);var Ff=St.define();var zf=St.define();var Wf=St.define({map:function(t,e){return t.map((function(t){return t.map(e)}))}});var qf=St.define();var Uf=rt.define({create:function(){return Rf.start()},update:function(t,e){return t.update(e)},provide:function(t){return[Ea.from(t,(function(t){return t.tooltip})),Eo.contentAttributes.from(t,(function(t){return t.attrs}))]}});var Gf=75;function Kf(t,e){if(e===void 0){e="option"}return function(r){var n=r.state.field(Uf,false);if(!n||!n.open||Date.now()-n.open.timestamp<Gf)return false;var i=1,o;if(e=="page"&&(o=Ra(r,n.open.tooltip)))i=Math.max(2,Math.floor(o.dom.offsetHeight/o.dom.querySelector("li").offsetHeight)-1);var a=n.open.selected+i*(t?1:-1),s=n.open.options.length;if(a<0)a=e=="page"?0:s-1;else if(a>=s)a=e=="page"?s-1:0;r.dispatch({effects:qf.of(a)});return true}}var Jf=function(t){var e=t.state.field(Uf,false);if(t.state.readOnly||!e||!e.open||Date.now()-e.open.timestamp<Gf)return false;mf(t,e.open.options[e.open.selected]);return true};var $f=function(t){var e=t.state.field(Uf,false);if(!e)return false;t.dispatch({effects:Ff.of(true)});return true};var Yf=function(t){var e=t.state.field(Uf,false);if(!e||!e.active.some((function(t){return t.state!=0})))return false;t.dispatch({effects:zf.of(null)});return true};var Xf=function(){function t(t,e){this.active=t;this.context=e;this.time=Date.now();this.updates=[];this.done=undefined}return t}();var Qf=50,Zf=50,tu=1e3;var eu=tn.fromClass(function(){function t(t){this.view=t;this.debounceUpdate=-1;this.running=[];this.debounceAccept=-1;this.composing=0;for(var e=0,r=t.state.field(Uf).active;e<r.length;e++){var n=r[e];if(n.state==1)this.startQuery(n)}}t.prototype.update=function(t){var e;var r=this;var n=t.state.field(Uf);if(!t.selectionSet&&!t.docChanged&&t.startState.field(Uf)==n)return;var i=t.transactions.some((function(t){return(t.selection||t.docChanged)&&!_f(t)}));for(var o=0;o<this.running.length;o++){var a=this.running[o];if(i||a.updates.length+t.transactions.length>Zf&&Date.now()-a.time>tu){for(var s=0,f=a.context.abortListeners;s<f.length;s++){var u=f[s];try{u()}catch(p){Jr(this.view.state,p)}}a.context.abortListeners=null;this.running.splice(o--,1)}else{(e=a.updates).push.apply(e,t.transactions)}}if(this.debounceUpdate>-1)clearTimeout(this.debounceUpdate);this.debounceUpdate=n.active.some((function(t){return t.state==1&&!r.running.some((function(e){return e.active.source==t.source}))}))?setTimeout((function(){return r.startUpdate()}),Qf):-1;if(this.composing!=0)for(var l=0,c=t.transactions;l<c.length;l++){var h=c[l];if(_f(h)=="input")this.composing=2;else if(this.composing==2&&h.selection)this.composing=3}};t.prototype.startUpdate=function(){this.debounceUpdate=-1;var t=this.view.state,e=t.field(Uf);var r=function(t){if(t.state==1&&!n.running.some((function(e){return e.active.source==t.source})))n.startQuery(t)};var n=this;for(var i=0,o=e.active;i<o.length;i++){var a=o[i];r(a)}};t.prototype.startQuery=function(t){var e=this;var r=this.view.state,n=df(r);var i=new ff(r,n,t.explicitPos==n);var o=new Xf(t,i);this.running.push(o);Promise.resolve(t.source(i)).then((function(t){if(!o.context.aborted){o.done=t||null;e.scheduleAccept()}}),(function(t){e.view.dispatch({effects:zf.of(null)});Jr(e.view.state,t)}))};t.prototype.scheduleAccept=function(){var t=this;if(this.running.every((function(t){return t.done!==undefined})))this.accept();else if(this.debounceAccept<0)this.debounceAccept=setTimeout((function(){return t.accept()}),Qf)};t.prototype.accept=function(){var t;if(this.debounceAccept>-1)clearTimeout(this.debounceAccept);this.debounceAccept=-1;var e=[];var r=this.view.state.facet(xf);var n=function(n){var a=i.running[n];if(a.done===undefined)return o=n,"continue";i.running.splice(n--,1);if(a.done){var s=new Hf(a.active.source,a.active.explicitPos,a.done,a.done.from,(t=a.done.to)!==null&&t!==void 0?t:df(a.updates.length?a.updates[0].startState:i.view.state),a.done.span&&a.done.filter!==false?vf(a.done.span,true):null);for(var f=0,u=a.updates;f<u.length;f++){var l=u[f];s=s.update(l,r)}if(s.hasResult()){e.push(s);return o=n,"continue"}}var c=i.view.state.field(Uf).active.find((function(t){return t.source==a.active.source}));if(c&&c.state==1){if(a.done==null){var s=new Vf(a.active.source,0);for(var h=0,p=a.updates;h<p.length;h++){var l=p[h];s=s.update(l,r)}if(s.state!=1)e.push(s)}else{i.startQuery(c)}}o=n};var i=this,o;for(var a=0;a<this.running.length;a++){n(a);a=o}if(e.length)this.view.dispatch({effects:Wf.of(e)})};return t}(),{eventHandlers:{compositionstart:function(){this.composing=1},compositionend:function(){var t=this;if(this.composing==3){setTimeout((function(){return t.view.dispatch({effects:Ff.of(false)})}),20)}this.composing=0}}});var ru=Eo.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",listStyle:"none",margin:0,padding:0,"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer",padding:"1px 3px",lineHeight:1.2}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"300px"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}});var nu=function(){function t(t,e,r,n){this.field=t;this.line=e;this.from=r;this.to=n}return t}();var iu=function(){function t(t,e,r){this.field=t;this.from=e;this.to=r}t.prototype.map=function(e){var r=e.mapPos(this.from,-1,N.TrackDel);var n=e.mapPos(this.to,1,N.TrackDel);return r==null||n==null?null:new t(this.field,r,n)};return t}();var ou=function(){function t(t,e){this.lines=t;this.fieldPositions=e}t.prototype.instantiate=function(t,e){var r=[],n=[e];var i=t.doc.lineAt(e),o=/^\s*/.exec(i.text)[0];for(var a=0,s=this.lines;a<s.length;a++){var f=s[a];if(r.length){var u=o,l=/^\t*/.exec(f)[0].length;for(var c=0;c<l;c++)u+=t.facet(_s);n.push(e+u.length-l);f=u+f.slice(l)}r.push(f);e+=f.length+1}var h=this.fieldPositions.map((function(t){return new iu(t.field,n[t.line]+t.from,n[t.line]+t.to)}));return{text:r,ranges:h}};t.parse=function(e){var r=[];var n=[],i=[],o;for(var a=0,s=e.split(/\r\n?|\n/);a<s.length;a++){var f=s[a];while(o=/[#$]\{(?:(\d+)(?::([^}]*))?|([^}]*))\}/.exec(f)){var u=o[1]?+o[1]:null,l=o[2]||o[3]||"",c=-1;for(var h=0;h<r.length;h++){if(u!=null?r[h].seq==u:l?r[h].name==l:false)c=h}if(c<0){var p=0;while(p<r.length&&(u==null||r[p].seq!=null&&r[p].seq<u))p++;r.splice(p,0,{seq:u,name:l});c=p;for(var d=0,v=i;d<v.length;d++){var g=v[d];if(g.field>=c)g.field++}}i.push(new nu(c,n.length,o.index,o.index+l.length));f=f.slice(0,o.index)+l+f.slice(o.index+o[0].length)}n.push(f)}return new t(n,i)};return t}();var au=Ar.widget({widget:new(function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.toDOM=function(){var t=document.createElement("span");t.className="cm-snippetFieldPosition";return t};e.prototype.ignoreEvent=function(){return false};return e}(Sr))});var su=Ar.mark({class:"cm-snippetField"});var fu=function(){function t(t,e){this.ranges=t;this.active=e;this.deco=Ar.set(t.map((function(t){return(t.from==t.to?au:su).range(t.from,t.to)})))}t.prototype.map=function(e){var r=[];for(var n=0,i=this.ranges;n<i.length;n++){var o=i[n];var a=o.map(e);if(!a)return null;r.push(a)}return new t(r,this.active)};t.prototype.selectionInsideField=function(t){var e=this;return t.ranges.every((function(t){return e.ranges.some((function(r){return r.field==e.active&&r.from<=t.from&&r.to>=t.to}))}))};return t}();var uu=St.define({map:function(t,e){return t&&t.map(e)}});var lu=St.define();var cu=rt.define({create:function(){return null},update:function(t,e){for(var r=0,n=e.effects;r<n.length;r++){var i=n[r];if(i.is(uu))return i.value;if(i.is(lu)&&t)return new fu(t.ranges,i.value)}if(t&&e.docChanged)t=t.map(e.changes);if(t&&e.selection&&!t.selectionInsideField(e.selection))t=null;return t},provide:function(t){return Eo.decorations.from(t,(function(t){return t?t.deco:Ar.none}))}});function hu(t,e){return G.create(t.filter((function(t){return t.field==e})).map((function(t){return G.range(t.from,t.to)})))}function pu(t){var e=ou.parse(t);return function(t,r,n,i){var o=e.instantiate(t.state,n),a=o.text,s=o.ranges;var f={changes:{from:n,to:i,insert:A.of(a)}};if(s.length)f.selection=hu(s,0);if(s.length>1){var u=new fu(s,0);var l=f.effects=[uu.of(u)];if(t.state.field(cu,false)===undefined)l.push(St.appendConfig.of([cu,wu,ku,ru]))}t.dispatch(t.state.update(f))}}function du(t){return function(e){var r=e.state,n=e.dispatch;var i=r.field(cu,false);if(!i||t<0&&i.active==0)return false;var o=i.active+t,a=t>0&&!i.ranges.some((function(e){return e.field==o+t}));n(r.update({selection:hu(i.ranges,o),effects:uu.of(a?null:new fu(i.ranges,o))}));return true}}var vu=function(t){var e=t.state,r=t.dispatch;var n=e.field(cu,false);if(!n)return false;r(e.update({effects:uu.of(null)}));return true};var gu=du(1);var mu=du(-1);var yu=[{key:"Tab",run:gu,shift:mu},{key:"Escape",run:vu}];var bu=Y.define({combine:function(t){return t.length?t[0]:yu}});var wu=ot.highest(Fo.compute([bu],(function(t){return t.facet(bu)})));function xu(t,e){return Object.assign(Object.assign({},e),{apply:pu(t)})}var ku=Eo.domEventHandlers({mousedown:function(t,e){var r=e.state.field(cu,false),n;if(!r||(n=e.posAtCoords({x:t.clientX,y:t.clientY}))==null)return false;var i=r.ranges.find((function(t){return t.from<=n&&t.to>=n}));if(!i||i.field==r.active)return false;e.dispatch({selection:hu(r.ranges,i.field),effects:uu.of(r.ranges.some((function(t){return t.field>i.field}))?new fu(r.ranges,i.field):null)});return true}});function Su(t){var e=t.replace(/[\\[.+*?(){|^$]/g,"\\$&");try{return new RegExp("[\\p{Alphabetic}\\p{Number}_".concat(e,"]+"),"ug")}catch(r){return new RegExp("[w".concat(e,"]"),"g")}}function Cu(t,e){return new RegExp(e(t.source),t.unicode?"u":"")}var Au=Object.create(null);function Ou(t){return Au[t]||(Au[t]=new WeakMap)}function Mu(t,e,r,n,i){for(var o=t.iterLines(),a=0;!o.next().done;){var s=o.value,f=void 0;e.lastIndex=0;while(f=e.exec(s)){if(!n[f[0]]&&a+f.index!=i){r.push({type:"text",label:f[0]});n[f[0]]=true;if(r.length>=2e3)return}}a+=s.length+1}}function Du(t,e,r,n,i){var o=t.length>=1e3;var a=o&&e.get(t);if(a)return a;var s=[],f=Object.create(null);if(t.children){var u=0;for(var l=0,c=t.children;l<c.length;l++){var h=c[l];if(h.length>=1e3){for(var p=0,d=Du(h,e,r,n-u,i-u);p<d.length;p++){var v=d[p];if(!f[v.label]){f[v.label]=true;s.push(v)}}}else{Mu(h,r,s,f,i-u)}u+=h.length+1}}else{Mu(t,r,s,f,i)}if(o&&s.length<2e3)e.set(t,s);return s}var Pu=function(t){var e=t.state.languageDataAt("wordChars",t.pos).join("");var r=Su(e);var n=t.matchBefore(Cu(r,(function(t){return t+"$"})));if(!n&&!t.explicit)return null;var i=n?n.from:t.pos;var o=Du(t.state.doc,Ou(e),r,5e4,i);return{from:i,options:o,span:Cu(r,(function(t){return"^"+t}))}};function Tu(t){if(t===void 0){t={}}return[Uf,xf.of(t),eu,Ru,ru]}var Eu=[{key:"Ctrl-Space",run:$f},{key:"Escape",run:Yf},{key:"ArrowDown",run:Kf(true)},{key:"ArrowUp",run:Kf(false)},{key:"PageDown",run:Kf(true,"page")},{key:"PageUp",run:Kf(false,"page")},{key:"Enter",run:Jf}];var Ru=ot.highest(Fo.computeN([xf],(function(t){return t.facet(xf).defaultKeymap?[Eu]:[]})));var Lu={brackets:["(","[","{","'",'"'],before:")]}'\":;>"};var Bu=St.define({map:function(t,e){var r=e.mapPos(t,-1,N.TrackAfter);return r==null?undefined:r}});var Iu=St.define({map:function(t,e){return e.mapPos(t)}});var Nu=new(function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}return e}(Kt));Nu.startSide=1;Nu.endSide=-1;var ju=rt.define({create:function(){return Xt.empty},update:function(t,e){if(e.selection){var r=e.state.doc.lineAt(e.selection.main.head).from;var n=e.startState.doc.lineAt(e.startState.selection.main.head).from;if(r!=e.changes.mapPos(n,-1))t=Xt.empty}t=t.map(e.changes);var i=function(e){if(e.is(Bu))t=t.update({add:[Nu.range(e.value,e.value+1)]});else if(e.is(Iu))t=t.update({filter:function(t){return t!=e.value}})};for(var o=0,a=e.effects;o<a.length;o++){var s=a[o];i(s)}return t}});function _u(){return[Wu,ju]}var Vu="()[]{}<>";function Hu(t){for(var e=0;e<Vu.length;e+=2)if(Vu.charCodeAt(e)==t)return Vu.charAt(e+1);return x(t<128?t:t+1)}function Fu(t,e){return t.languageDataAt("closeBrackets",e)[0]||Lu}var zu=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent);var Wu=Eo.inputHandler.of((function(t,e,r,n){if((zu?t.composing:t.compositionStarted)||t.state.readOnly)return false;var i=t.state.selection.main;if(n.length>2||n.length==2&&k(w(n,0))==1||e!=i.from||r!=i.to)return false;var o=Gu(t.state,n);if(!o)return false;t.dispatch(o);return true}));var qu=function(t){var e=t.state,r=t.dispatch;if(e.readOnly)return false;var n=Fu(e,e.selection.main.head);var i=n.brackets||Lu.brackets;var o=null,a=e.changeByRange((function(t){if(t.empty){var r=$u(e.doc,t.head);for(var n=0,a=i;n<a.length;n++){var s=a[n];if(s==r&&Ju(e.doc,t.head)==Hu(w(s,0)))return{changes:{from:t.head-s.length,to:t.head+s.length},range:G.cursor(t.head-s.length),userEvent:"delete.backward"}}}return{range:o=t}}));if(!o)r(e.update(a,{scrollIntoView:true}));return!o};var Uu=[{key:"Backspace",run:qu}];function Gu(t,e){var r=Fu(t,t.selection.main.head);var n=r.brackets||Lu.brackets;for(var i=0,o=n;i<o.length;i++){var a=o[i];var s=Hu(w(a,0));if(e==a)return s==a?Qu(t,a,n.indexOf(a+a+a)>-1):Yu(t,a,s,r.before||Lu.before);if(e==s&&Ku(t,t.selection.main.from))return Xu(t,a,s)}return null}function Ku(t,e){var r=false;t.field(ju).between(0,t.doc.length,(function(t){if(t==e)r=true}));return r}function Ju(t,e){var r=t.sliceString(e,e+2);return r.slice(0,k(w(r,0)))}function $u(t,e){var r=t.sliceString(e-2,e);return k(w(r,0))==r.length?r:r.slice(1)}function Yu(t,e,r,n){var i=null,o=t.changeByRange((function(o){if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:r,from:o.to}],effects:Bu.of(o.to+e.length),range:G.range(o.anchor+e.length,o.head+e.length)};var a=Ju(t.doc,o.head);if(!a||/\s/.test(a)||n.indexOf(a)>-1)return{changes:{insert:e+r,from:o.head},effects:Bu.of(o.head+e.length),range:G.cursor(o.head+e.length)};return{range:i=o}}));return i?null:t.update(o,{scrollIntoView:true,userEvent:"input.type"})}function Xu(t,e,r){var n=null,i=t.selection.ranges.map((function(e){if(e.empty&&Ju(t.doc,e.head)==r)return G.cursor(e.head+r.length);return n=e}));return n?null:t.update({selection:G.create(i,t.selection.mainIndex),scrollIntoView:true,effects:t.selection.ranges.map((function(t){var e=t.from;return Iu.of(e)}))})}function Qu(t,e,r){var n=null,i=t.changeByRange((function(i){if(!i.empty)return{changes:[{insert:e,from:i.from},{insert:e,from:i.to}],effects:Bu.of(i.to+e.length),range:G.range(i.anchor+e.length,i.head+e.length)};var o=i.head,a=Ju(t.doc,o);if(a==e){if(Zu(t,o)){return{changes:{insert:e+e,from:o},effects:Bu.of(o+e.length),range:G.cursor(o+e.length)}}else if(Ku(t,o)){var s=r&&t.sliceDoc(o,o+e.length*3)==e+e+e;return{range:G.cursor(o+e.length*(s?3:1)),effects:Iu.of(o)}}}else if(r&&t.sliceDoc(o-2*e.length,o)==e+e&&Zu(t,o-2*e.length)){return{changes:{insert:e+e+e+e,from:o},effects:Bu.of(o+e.length),range:G.cursor(o+e.length)}}else if(t.charCategorizer(o)(a)!=Lt.Word){var f=t.sliceDoc(o-1,o);if(f!=e&&t.charCategorizer(o)(f)!=Lt.Word&&!tl(t,o,e))return{changes:{insert:e+e,from:o},effects:Bu.of(o+e.length),range:G.cursor(o+e.length)}}return{range:n=i}}));return n?null:t.update(i,{scrollIntoView:true,userEvent:"input.type"})}function Zu(t,e){var r=Os(t).resolveInner(e+1);return r.parent&&r.from==e}function tl(t,e,r){var n=Os(t).resolveInner(e,-1);for(var i=0;i<5;i++){if(t.sliceDoc(n.from,n.from+r.length)==r)return true;var o=n.to==e&&n.parent;if(!o)break;n=o}return false}var el=Eo.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}});var rl=1e4,nl="()[]{}";var il=Y.define({combine:function(t){return Vt(t,{afterCursor:true,brackets:nl,maxScanDistance:rl})}});var ol=Ar.mark({class:"cm-matchingBracket"}),al=Ar.mark({class:"cm-nonmatchingBracket"});var sl=rt.define({create:function(){return Ar.none},update:function(t,e){if(!e.docChanged&&!e.selection)return t;var r=[];var n=e.state.facet(il);for(var i=0,o=e.state.selection.ranges;i<o.length;i++){var a=o[i];if(!a.empty)continue;var s=cl(e.state,a.head,-1,n)||a.head>0&&cl(e.state,a.head-1,1,n)||n.afterCursor&&(cl(e.state,a.head,1,n)||a.head<e.state.doc.length&&cl(e.state,a.head+1,-1,n));if(!s)continue;var f=s.matched?ol:al;r.push(f.range(s.start.from,s.start.to));if(s.end)r.push(f.range(s.end.from,s.end.to))}return Ar.set(r,true)},provide:function(t){return Eo.decorations.from(t)}});var fl=[sl,el];function ul(t){if(t===void 0){t={}}return[il.of(t),fl]}function ll(t,e,r){var n=t.prop(e<0?Na.openedBy:Na.closedBy);if(n)return n;if(t.name.length==1){var i=r.indexOf(t.name);if(i>-1&&i%2==(e<0?1:0))return[r[i+e]]}return null}function cl(t,e,r,n){if(n===void 0){n={}}var i=n.maxScanDistance||rl,o=n.brackets||nl;var a=Os(t),s=a.resolveInner(e,r);for(var f=s;f;f=f.parent){var u=ll(f.type,r,o);if(u&&f.from<f.to)return hl(t,e,r,f,u,o)}return pl(t,e,r,a,s.type,i,o)}function hl(t,e,r,n,i,o){var a=n.parent,s={from:n.from,to:n.to};var f=0,u=a===null||a===void 0?void 0:a.cursor;if(u&&(r<0?u.childBefore(n.from):u.childAfter(n.to)))do{if(r<0?u.to<=n.from:u.from>=n.to){if(f==0&&i.indexOf(u.type.name)>-1&&u.from<u.to){return{start:s,end:{from:u.from,to:u.to},matched:true}}else if(ll(u.type,r,o)){f++}else if(ll(u.type,-r,o)){f--;if(f==0)return{start:s,end:u.from==u.to?undefined:{from:u.from,to:u.to},matched:false}}}}while(r<0?u.prevSibling():u.nextSibling());return{start:s,matched:false}}function pl(t,e,r,n,i,o,a){var s=r<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1);var f=a.indexOf(s);if(f<0||f%2==0!=r>0)return null;var u={from:r<0?e-1:e,to:r>0?e+1:e};var l=t.doc.iterRange(e,r>0?t.doc.length:0),c=0;for(var h=0;!l.next().done&&h<=o;){var p=l.value;if(r<0)h+=p.length;var d=e+h*r;for(var v=r>0?0:p.length-1,g=r>0?p.length:-1;v!=g;v+=r){var m=a.indexOf(p[v]);if(m<0||n.resolve(d+v,1).type!=i)continue;if(m%2==0==r>0){c++}else if(c==1){return{start:u,end:{from:d+v,to:d+v+1},matched:m>>1==f>>1}}else{c--}}if(r>0)h+=p.length}return l.done?{start:u,matched:false}:null}function dl(t,e){return G.create(t.ranges.map(e),t.mainIndex)}function vl(t,e){return t.update({selection:e,scrollIntoView:true,userEvent:"select"})}function gl(t,e){var r=t.state,n=t.dispatch;var i=dl(r.selection,e);if(i.eq(r.selection))return false;n(vl(r,i));return true}function ml(t,e){return G.cursor(e?t.to:t.from)}function yl(t,e){return gl(t,(function(r){return r.empty?t.moveByChar(r,e):ml(r,e)}))}var bl=function(t){return yl(t,t.textDirection!=ln.LTR)};var wl=function(t){return yl(t,t.textDirection==ln.LTR)};function xl(t,e){return gl(t,(function(r){return r.empty?t.moveByGroup(r,e):ml(r,e)}))}var kl=function(t){return xl(t,t.textDirection!=ln.LTR)};var Sl=function(t){return xl(t,t.textDirection==ln.LTR)};function Cl(t,e,r){if(e.type.prop(r))return true;var n=e.to-e.from;return n&&(n>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function Al(t,e,r){var n=Os(t).resolveInner(e.head);var i=r?Na.closedBy:Na.openedBy;for(var o=e.head;;){var a=r?n.childAfter(o):n.childBefore(o);if(!a)break;if(Cl(t,a,i))n=a;else o=r?a.to:a.from}var s=n.type.prop(i),f,u;if(s&&(f=r?cl(t,n.from,1):cl(t,n.to,-1))&&f.matched)u=r?f.end.to:f.end.from;else u=r?n.to:n.from;return G.cursor(u,r?-1:1)}var Ol=function(t){return gl(t,(function(e){return Al(t.state,e,t.textDirection!=ln.LTR)}))};var Ml=function(t){return gl(t,(function(e){return Al(t.state,e,t.textDirection==ln.LTR)}))};function Dl(t,e){return gl(t,(function(r){if(!r.empty)return ml(r,e);var n=t.moveVertically(r,e);return n.head!=r.head?n:t.moveToLineBoundary(r,e)}))}var Pl=function(t){return Dl(t,false)};var Tl=function(t){return Dl(t,true)};function El(t,e){var r=t.state,n=dl(r.selection,(function(r){return r.empty?t.moveVertically(r,e,t.dom.clientHeight):ml(r,e)}));if(n.eq(r.selection))return false;var i=t.coordsAtPos(r.selection.main.head);var o=t.scrollDOM.getBoundingClientRect();t.dispatch(vl(r,n),{effects:i&&i.top>o.top&&i.bottom<o.bottom?Eo.scrollIntoView(n.main.head,{y:"start",yMargin:i.top-o.top}):undefined});return true}var Rl=function(t){return El(t,false)};var Ll=function(t){return El(t,true)};function Bl(t,e,r){var n=t.lineBlockAt(e.head),i=t.moveToLineBoundary(e,r);if(i.head==e.head&&i.head!=(r?n.to:n.from))i=t.moveToLineBoundary(e,r,false);if(!r&&i.head==n.from&&n.length){var o=/^\s*/.exec(t.state.sliceDoc(n.from,Math.min(n.from+100,n.to)))[0].length;if(o&&e.head!=n.from+o)i=G.cursor(n.from+o)}return i}var Il=function(t){return gl(t,(function(e){return Bl(t,e,true)}))};var Nl=function(t){return gl(t,(function(e){return Bl(t,e,false)}))};var jl=function(t){return gl(t,(function(e){return G.cursor(t.lineBlockAt(e.head).from,1)}))};var _l=function(t){return gl(t,(function(e){return G.cursor(t.lineBlockAt(e.head).to,-1)}))};function Vl(t,e,r){var n=false,i=dl(t.selection,(function(e){var i=cl(t,e.head,-1)||cl(t,e.head,1)||e.head>0&&cl(t,e.head-1,1)||e.head<t.doc.length&&cl(t,e.head+1,-1);if(!i||!i.end)return e;n=true;var o=i.start.from==e.head?i.end.to:i.end.from;return r?G.range(e.anchor,o):G.cursor(o)}));if(!n)return false;e(vl(t,i));return true}var Hl=function(t){var e=t.state,r=t.dispatch;return Vl(e,r,false)};function Fl(t,e){var r=dl(t.state.selection,(function(t){var r=e(t);return G.range(t.anchor,r.head,r.goalColumn)}));if(r.eq(t.state.selection))return false;t.dispatch(vl(t.state,r));return true}function zl(t,e){return Fl(t,(function(r){return t.moveByChar(r,e)}))}var Wl=function(t){return zl(t,t.textDirection!=ln.LTR)};var ql=function(t){return zl(t,t.textDirection==ln.LTR)};function Ul(t,e){return Fl(t,(function(r){return t.moveByGroup(r,e)}))}var Gl=function(t){return Ul(t,t.textDirection!=ln.LTR)};var Kl=function(t){return Ul(t,t.textDirection==ln.LTR)};var Jl=function(t){return Fl(t,(function(e){return Al(t.state,e,t.textDirection!=ln.LTR)}))};var $l=function(t){return Fl(t,(function(e){return Al(t.state,e,t.textDirection==ln.LTR)}))};function Yl(t,e){return Fl(t,(function(r){return t.moveVertically(r,e)}))}var Xl=function(t){return Yl(t,false)};var Ql=function(t){return Yl(t,true)};function Zl(t,e){return Fl(t,(function(r){return t.moveVertically(r,e,t.dom.clientHeight)}))}var tc=function(t){return Zl(t,false)};var ec=function(t){return Zl(t,true)};var rc=function(t){return Fl(t,(function(e){return Bl(t,e,true)}))};var nc=function(t){return Fl(t,(function(e){return Bl(t,e,false)}))};var ic=function(t){return Fl(t,(function(e){return G.cursor(t.lineBlockAt(e.head).from)}))};var oc=function(t){return Fl(t,(function(e){return G.cursor(t.lineBlockAt(e.head).to)}))};var ac=function(t){var e=t.state,r=t.dispatch;r(vl(e,{anchor:0}));return true};var sc=function(t){var e=t.state,r=t.dispatch;r(vl(e,{anchor:e.doc.length}));return true};var fc=function(t){var e=t.state,r=t.dispatch;r(vl(e,{anchor:e.selection.main.anchor,head:0}));return true};var uc=function(t){var e=t.state,r=t.dispatch;r(vl(e,{anchor:e.selection.main.anchor,head:e.doc.length}));return true};var lc=function(t){var e=t.state,r=t.dispatch;r(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"}));return true};var cc=function(t){var e=t.state,r=t.dispatch;var n=Oc(e).map((function(t){var r=t.from,n=t.to;return G.range(r,Math.min(n+1,e.doc.length))}));r(e.update({selection:G.create(n),userEvent:"select"}));return true};var hc=function(t){var e=t.state,r=t.dispatch;var n=dl(e.selection,(function(t){var r;var n=Os(e).resolveInner(t.head,1);while(!(n.from<t.from&&n.to>=t.to||n.to>t.to&&n.from<=t.from||!((r=n.parent)===null||r===void 0?void 0:r.parent)))n=n.parent;return G.range(n.to,n.from)}));r(vl(e,n));return true};var pc=function(t){var e=t.state,r=t.dispatch;var n=e.selection,i=null;if(n.ranges.length>1)i=G.create([n.main]);else if(!n.main.empty)i=G.create([G.cursor(n.main.head)]);if(!i)return false;r(vl(e,i));return true};function dc(t,e){var r=t.state,n=t.dispatch;if(r.readOnly)return false;var i="delete.selection";var o=r.changeByRange((function(t){var r=t.from,n=t.to;if(r==n){var o=e(r);if(o<r)i="delete.backward";else if(o>r)i="delete.forward";r=Math.min(r,o);n=Math.max(n,o)}return r==n?{range:t}:{changes:{from:r,to:n},range:G.cursor(r)}}));if(o.changes.empty)return false;n(r.update(o,{scrollIntoView:true,userEvent:i}));return true}function vc(t,e,r){if(t instanceof Eo)for(var n=0,i=t.pluginField(Xr.atomicRanges);n<i.length;n++){var o=i[n];o.between(e,e,(function(t,n){if(t<e&&n>e)e=r?n:t}))}return e}var gc=function(t,e){return dc(t,(function(r){var n=t.state,i=n.doc.lineAt(r),o,a;if(!e&&r>i.from&&r<i.from+200&&!/[^ \t]/.test(o=i.text.slice(0,r-i.from))){if(o[o.length-1]=="\t")return r-1;var s=S(o,n.tabSize),f=s%Vs(n)||Vs(n);for(var u=0;u<f&&o[o.length-1-u]==" ";u++)r--;a=r}else{a=v(i.text,r-i.from,e,e)+i.from;if(a==r&&i.number!=(e?n.doc.lines:1))a+=e?1:-1}return vc(t,a,e)}))};var mc=function(t){return gc(t,false)};var yc=function(t){return gc(t,true)};var bc=function(t,e){return dc(t,(function(r){var n=r,i=t.state,o=i.doc.lineAt(n);var a=i.charCategorizer(n);for(var s=null;;){if(n==(e?o.to:o.from)){if(n==r&&o.number!=(e?i.doc.lines:1))n+=e?1:-1;break}var f=v(o.text,n-o.from,e)+o.from;var u=o.text.slice(Math.min(n,f)-o.from,Math.max(n,f)-o.from);var l=a(u);if(s!=null&&l!=s)break;if(u!=" "||n!=r)s=l;n=f}return vc(t,n,e)}))};var wc=function(t){return bc(t,false)};var xc=function(t){return bc(t,true)};var kc=function(t){return dc(t,(function(e){var r=t.lineBlockAt(e).to;return vc(t,e<r?r:Math.min(t.state.doc.length,e+1),true)}))};var Sc=function(t){return dc(t,(function(e){var r=t.lineBlockAt(e).from;return vc(t,e>r?r:Math.max(0,e-1),false)}))};var Cc=function(t){var e=t.state,r=t.dispatch;if(e.readOnly)return false;var n=e.changeByRange((function(t){return{changes:{from:t.from,to:t.to,insert:A.of(["",""])},range:G.cursor(t.from)}}));r(e.update(n,{scrollIntoView:true,userEvent:"input"}));return true};var Ac=function(t){var e=t.state,r=t.dispatch;if(e.readOnly)return false;var n=e.changeByRange((function(t){if(!t.empty||t.from==0||t.from==e.doc.length)return{range:t};var r=t.from,n=e.doc.lineAt(r);var i=r==n.from?r-1:v(n.text,r-n.from,false)+n.from;var o=r==n.to?r+1:v(n.text,r-n.from,true)+n.from;return{changes:{from:i,to:o,insert:e.doc.slice(r,o).append(e.doc.slice(i,r))},range:G.cursor(o)}}));if(n.changes.empty)return false;r(e.update(n,{scrollIntoView:true,userEvent:"move.character"}));return true};function Oc(t){var e=[],r=-1;for(var n=0,i=t.selection.ranges;n<i.length;n++){var o=i[n];var a=t.doc.lineAt(o.from),s=t.doc.lineAt(o.to);if(!o.empty&&o.to==s.from)s=t.doc.lineAt(o.to-1);if(r>=a.number){var f=e[e.length-1];f.to=s.to;f.ranges.push(o)}else{e.push({from:a.from,to:s.to,ranges:[o]})}r=s.number+1}return e}function Mc(t,e,r){if(t.readOnly)return false;var n=[],i=[];for(var o=0,a=Oc(t);o<a.length;o++){var s=a[o];if(r?s.to==t.doc.length:s.from==0)continue;var f=t.doc.lineAt(r?s.to+1:s.from-1);var u=f.length+1;if(r){n.push({from:s.to,to:f.to},{from:s.from,insert:f.text+t.lineBreak});for(var l=0,c=s.ranges;l<c.length;l++){var h=c[l];i.push(G.range(Math.min(t.doc.length,h.anchor+u),Math.min(t.doc.length,h.head+u)))}}else{n.push({from:f.from,to:s.from},{from:s.to,insert:t.lineBreak+f.text});for(var p=0,d=s.ranges;p<d.length;p++){var h=d[p];i.push(G.range(h.anchor-u,h.head-u))}}}if(!n.length)return false;e(t.update({changes:n,scrollIntoView:true,selection:G.create(i,t.selection.mainIndex),userEvent:"move.line"}));return true}var Dc=function(t){var e=t.state,r=t.dispatch;return Mc(e,r,false)};var Pc=function(t){var e=t.state,r=t.dispatch;return Mc(e,r,true)};function Tc(t,e,r){if(t.readOnly)return false;var n=[];for(var i=0,o=Oc(t);i<o.length;i++){var a=o[i];if(r)n.push({from:a.from,insert:t.doc.slice(a.from,a.to)+t.lineBreak});else n.push({from:a.to,insert:t.lineBreak+t.doc.slice(a.from,a.to)})}e(t.update({changes:n,scrollIntoView:true,userEvent:"input.copyline"}));return true}var Ec=function(t){var e=t.state,r=t.dispatch;return Tc(e,r,false)};var Rc=function(t){var e=t.state,r=t.dispatch;return Tc(e,r,true)};var Lc=function(t){if(t.state.readOnly)return false;var e=t.state,r=e.changes(Oc(e).map((function(t){var r=t.from,n=t.to;if(r>0)r--;else if(n<e.doc.length)n++;return{from:r,to:n}})));var n=dl(e.selection,(function(e){return t.moveVertically(e,true)})).map(r);t.dispatch({changes:r,selection:n,scrollIntoView:true,userEvent:"delete.line"});return true};function Bc(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};var r=Os(t).resolveInner(e);var n=r.childBefore(e),i=r.childAfter(e),o;if(n&&i&&n.to<=e&&i.from>=e&&(o=n.type.prop(Na.closedBy))&&o.indexOf(i.name)>-1&&t.doc.lineAt(n.to).from==t.doc.lineAt(i.from).from)return{from:n.to,to:i.from};return null}var Ic=jc(false);var Nc=jc(true);function jc(t){return function(e){var r=e.state,n=e.dispatch;if(r.readOnly)return false;var i=r.changeByRange((function(e){var n=e.from,i=e.to,o=r.doc.lineAt(n);var a=!t&&n==i&&Bc(r,n);if(t)n=i=(i<=o.to?o:r.doc.lineAt(i)).to;var s=new zs(r,{simulateBreak:n,simulateDoubleBreak:!!a});var f=Fs(s,n);if(f==null)f=/^\s*/.exec(r.doc.lineAt(n).text)[0].length;while(i<o.to&&/\s/.test(o.text[i-o.from]))i++;if(a)n=a.from,i=a.to;else if(n>o.from&&n<o.from+100&&!/\S/.test(o.text.slice(0,n)))n=o.from;var u=["",Hs(r,f)];if(a)u.push(Hs(r,s.lineIndent(o.from,-1)));return{changes:{from:n,to:i,insert:A.of(u)},range:G.cursor(n+1+u[1].length)}}));n(r.update(i,{scrollIntoView:true,userEvent:"input"}));return true}}function _c(t,e){var r=-1;return t.changeByRange((function(n){var i=[];for(var o=n.from;o<=n.to;){var a=t.doc.lineAt(o);if(a.number>r&&(n.empty||n.to>a.from)){e(a,i,n);r=a.number}o=a.to+1}var s=t.changes(i);return{changes:i,range:G.range(s.mapPos(n.anchor,1),s.mapPos(n.head,1))}}))}var Vc=function(t){var e=t.state,r=t.dispatch;if(e.readOnly)return false;var n=Object.create(null);var i=new zs(e,{overrideIndentation:function(t){var e=n[t];return e==null?-1:e}});var o=_c(e,(function(t,r,o){var a=Fs(i,t.from);if(a==null)return;if(!/\S/.test(t.text))a=0;var s=/^\s*/.exec(t.text)[0];var f=Hs(e,a);if(s!=f||o.from<t.from+s.length){n[t.from]=a;r.push({from:t.from,to:t.from+s.length,insert:f})}}));if(!o.changes.empty)r(e.update(o,{userEvent:"indent"}));return true};var Hc=function(t){var e=t.state,r=t.dispatch;if(e.readOnly)return false;r(e.update(_c(e,(function(t,r){r.push({from:t.from,insert:e.facet(_s)})})),{userEvent:"input.indent"}));return true};var Fc=function(t){var e=t.state,r=t.dispatch;if(e.readOnly)return false;r(e.update(_c(e,(function(t,r){var n=/^\s*/.exec(t.text)[0];if(!n)return;var i=S(n,e.tabSize),o=0;var a=Hs(e,Math.max(0,i-Vs(e)));while(o<n.length&&o<a.length&&n.charCodeAt(o)==a.charCodeAt(o))o++;r.push({from:t.from+o,to:t.from+n.length,insert:a.slice(o)})})),{userEvent:"delete.dedent"}));return true};var zc=[{key:"Ctrl-b",run:bl,shift:Wl,preventDefault:true},{key:"Ctrl-f",run:wl,shift:ql},{key:"Ctrl-p",run:Pl,shift:Xl},{key:"Ctrl-n",run:Tl,shift:Ql},{key:"Ctrl-a",run:jl,shift:ic},{key:"Ctrl-e",run:_l,shift:oc},{key:"Ctrl-d",run:yc},{key:"Ctrl-h",run:mc},{key:"Ctrl-k",run:kc},{key:"Ctrl-Alt-h",run:wc},{key:"Ctrl-o",run:Cc},{key:"Ctrl-t",run:Ac},{key:"Ctrl-v",run:Ll}];var Wc=[{key:"ArrowLeft",run:bl,shift:Wl,preventDefault:true},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:kl,shift:Gl},{mac:"Cmd-ArrowLeft",run:Nl,shift:nc},{key:"ArrowRight",run:wl,shift:ql,preventDefault:true},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Sl,shift:Kl},{mac:"Cmd-ArrowRight",run:Il,shift:rc},{key:"ArrowUp",run:Pl,shift:Xl,preventDefault:true},{mac:"Cmd-ArrowUp",run:ac,shift:fc},{mac:"Ctrl-ArrowUp",run:Rl,shift:tc},{key:"ArrowDown",run:Tl,shift:Ql,preventDefault:true},{mac:"Cmd-ArrowDown",run:sc,shift:uc},{mac:"Ctrl-ArrowDown",run:Ll,shift:ec},{key:"PageUp",run:Rl,shift:tc},{key:"PageDown",run:Ll,shift:ec},{key:"Home",run:Nl,shift:nc},{key:"Mod-Home",run:ac,shift:fc},{key:"End",run:Il,shift:rc},{key:"Mod-End",run:sc,shift:uc},{key:"Enter",run:Ic},{key:"Mod-a",run:lc},{key:"Backspace",run:mc,shift:mc},{key:"Delete",run:yc},{key:"Mod-Backspace",mac:"Alt-Backspace",run:wc},{key:"Mod-Delete",mac:"Alt-Delete",run:xc},{mac:"Mod-Backspace",run:Sc},{mac:"Mod-Delete",run:kc}].concat(zc.map((function(t){return{mac:t.key,run:t.run,shift:t.shift}})));var qc=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:Ol,shift:Jl},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:Ml,shift:$l},{key:"Alt-ArrowUp",run:Dc},{key:"Shift-Alt-ArrowUp",run:Ec},{key:"Alt-ArrowDown",run:Pc},{key:"Shift-Alt-ArrowDown",run:Rc},{key:"Escape",run:pc},{key:"Mod-Enter",run:Nc},{key:"Alt-l",mac:"Ctrl-l",run:cc},{key:"Mod-i",run:hc,preventDefault:true},{key:"Mod-[",run:Fc},{key:"Mod-]",run:Hc},{key:"Mod-Alt-\\",run:Vc},{key:"Shift-Mod-k",run:Lc},{key:"Shift-Mod-\\",run:Hl}].concat(Wc);var Uc=function(t){var e=Xc(t.state);return e.line?Kc(t):e.block?$c(t):false};function Gc(t,e){return function(r){var n=r.state,i=r.dispatch;if(n.readOnly)return false;var o=t(e,n);if(!o)return false;i(n.update(o));return true}}var Kc=Gc(rh,0);var Jc=Gc(eh,0);var $c=Gc((function(t,e){return eh(t,e,th(e))}),0);var Yc=[{key:"Mod-/",run:Uc},{key:"Alt-A",run:Jc}];function Xc(t,e){if(e===void 0){e=t.selection.main.head}var r=t.languageDataAt("commentTokens",e);return r.length?r[0]:{}}var Qc=50;function Zc(t,e,r,n){var i=e.open,o=e.close;var a=t.sliceDoc(r-Qc,r);var s=t.sliceDoc(n,n+Qc);var f=/\s*$/.exec(a)[0].length,u=/^\s*/.exec(s)[0].length;var l=a.length-f;if(a.slice(l-i.length,l)==i&&s.slice(u,u+o.length)==o){return{open:{pos:r-f,margin:f&&1},close:{pos:n+u,margin:u&&1}}}var c,h;if(n-r<=2*Qc){c=h=t.sliceDoc(r,n)}else{c=t.sliceDoc(r,r+Qc);h=t.sliceDoc(n-Qc,n)}var p=/^\s*/.exec(c)[0].length,d=/\s*$/.exec(h)[0].length;var v=h.length-d-o.length;if(c.slice(p,p+i.length)==i&&h.slice(v,v+o.length)==o){return{open:{pos:r+p+i.length,margin:/\s/.test(c.charAt(p+i.length))?1:0},close:{pos:n-d-o.length,margin:/\s/.test(h.charAt(v-1))?1:0}}}return null}function th(t){var e=[];for(var r=0,n=t.selection.ranges;r<n.length;r++){var i=n[r];var o=t.doc.lineAt(i.from);var a=i.to<=o.to?o:t.doc.lineAt(i.to);var s=e.length-1;if(s>=0&&e[s].to>o.from)e[s].to=a.to;else e.push({from:o.from,to:a.to})}return e}function eh(t,e,r){if(r===void 0){r=e.selection.ranges}var n=r.map((function(t){return Xc(e,t.from).block}));if(!n.every((function(t){return t})))return null;var i=r.map((function(t,r){return Zc(e,n[r],t.from,t.to)}));if(t!=2&&!i.every((function(t){return t}))){return{changes:e.changes(r.map((function(t,e){if(i[e])return[];return[{from:t.from,insert:n[e].open+" "},{from:t.to,insert:" "+n[e].close}]})))}}else if(t!=1&&i.some((function(t){return t}))){var o=[];for(var a=0,s;a<i.length;a++)if(s=i[a]){var f=n[a],u=s.open,l=s.close;o.push({from:u.pos-f.open.length,to:u.pos+u.margin},{from:l.pos-l.margin,to:l.pos+f.close.length})}return{changes:o}}return null}function rh(t,e,r){if(r===void 0){r=e.selection.ranges}var n=[];var i=-1;for(var o=0,a=r;o<a.length;o++){var s=a[o],f=s.from,u=s.to;var l=n.length,c=1e9;for(var h=f;h<=u;){var p=e.doc.lineAt(h);if(p.from>i&&(f==u||u>p.from)){i=p.from;var d=Xc(e,h).line;if(!d)continue;var v=/^\s*/.exec(p.text)[0].length;var g=v==p.length;var m=p.text.slice(v,v+d.length)==d?v:-1;if(v<p.text.length&&v<c)c=v;n.push({line:p,comment:m,token:d,indent:v,empty:g,single:false})}h=p.to+1}if(c<1e9)for(var y=l;y<n.length;y++)if(n[y].indent<n[y].line.text.length)n[y].indent=c;if(n.length==l+1)n[l].single=true}if(t!=2&&n.some((function(t){return t.comment<0&&(!t.empty||t.single)}))){var b=[];for(var w=0,x=n;w<x.length;w++){var k=x[w],p=k.line,d=k.token,v=k.indent,S=k.empty,C=k.single;if(C||!S)b.push({from:p.from+v,insert:d+" "})}var A=e.changes(b);return{changes:A,selection:e.selection.map(A,1)}}else if(t!=1&&n.some((function(t){return t.comment>=0}))){var b=[];for(var O=0,M=n;O<M.length;O++){var D=M[O],p=D.line,P=D.comment,d=D.token;if(P>=0){var f=p.from+P,u=f+d.length;if(p.text[u-p.from]==" ")u++;b.push({from:f,to:u})}}return{changes:b}}return null}var nh=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.compare=function(t){return this==t||this.constructor==t.constructor&&this.eq(t)};e.prototype.eq=function(t){return false};e.prototype.destroy=function(t){};return e}(Kt);nh.prototype.elementClass="";nh.prototype.toDOM=undefined;nh.prototype.mapMode=N.TrackBefore;nh.prototype.startSide=nh.prototype.endSide=-1;nh.prototype.point=true;var ih=Y.define();var oh={class:"",renderEmptyElements:false,elementStyle:"",markers:function(){return Xt.empty},lineMarker:function(){return null},lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}};var ah=Y.define();function sh(t){return[lh(),ah.of(Object.assign(Object.assign({},oh),t))]}var fh=Eo.baseTheme({".cm-gutters":{display:"flex",height:"100%",boxSizing:"border-box",left:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#999",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"}});var uh=Y.define({combine:function(t){return t.some((function(t){return t}))}});function lh(t){var e=[ch,fh];if(t&&t.fixed===false)e.push(uh.of(true));return e}var ch=tn.fromClass(function(){function t(t){this.view=t;this.prevViewport=t.viewport;this.dom=document.createElement("div");this.dom.className="cm-gutters";this.dom.setAttribute("aria-hidden","true");this.dom.style.minHeight=this.view.contentHeight+"px";this.gutters=t.state.facet(ah).map((function(e){return new vh(t,e)}));for(var e=0,r=this.gutters;e<r.length;e++){var n=r[e];this.dom.appendChild(n.dom)}this.fixed=!t.state.facet(uh);if(this.fixed){this.dom.style.position="sticky"}this.syncGutters(false);t.scrollDOM.insertBefore(this.dom,t.contentDOM)}t.prototype.update=function(t){if(this.updateGutters(t)){var e=this.prevViewport,r=t.view.viewport;var n=Math.min(e.to,r.to)-Math.max(e.from,r.from);this.syncGutters(n<(r.to-r.from)*.8)}if(t.geometryChanged)this.dom.style.minHeight=this.view.contentHeight+"px";if(this.view.state.facet(uh)!=!this.fixed){this.fixed=!this.fixed;this.dom.style.position=this.fixed?"sticky":""}this.prevViewport=t.view.viewport};t.prototype.syncGutters=function(t){var e=this;var r=this.dom.nextSibling;if(t)this.dom.remove();var n=Xt.iter(this.view.state.facet(ih),this.view.viewport.from);var i=[];var o=this.gutters.map((function(t){return new dh(t,e.view.viewport,-e.view.documentPadding.top)}));for(var a=0,s=this.view.viewportLineBlocks;a<s.length;a++){var f=s[a];var u=void 0;if(Array.isArray(f.type)){for(var l=0,c=f.type;l<c.length;l++){var h=c[l];if(h.type==Cr.Text){u=h;break}}}else{u=f.type==Cr.Text?f:undefined}if(!u)continue;if(i.length)i=[];ph(n,i,f.from);for(var p=0,d=o;p<d.length;p++){var v=d[p];v.line(this.view,u,i)}}for(var g=0,m=o;g<m.length;g++){var v=m[g];v.finish()}if(t)this.view.scrollDOM.insertBefore(this.dom,r)};t.prototype.updateGutters=function(t){var e=t.startState.facet(ah),r=t.state.facet(ah);var n=t.docChanged||t.heightChanged||t.viewportChanged||!Xt.eq(t.startState.facet(ih),t.state.facet(ih),t.view.viewport.from,t.view.viewport.to);if(e==r){for(var i=0,o=this.gutters;i<o.length;i++){var a=o[i];if(a.update(t))n=true}}else{n=true;var s=[];for(var f=0,u=r;f<u.length;f++){var l=u[f];var c=e.indexOf(l);if(c<0){s.push(new vh(this.view,l))}else{this.gutters[c].update(t);s.push(this.gutters[c])}}for(var h=0,p=this.gutters;h<p.length;h++){var d=p[h];d.dom.remove();if(s.indexOf(d)<0)d.destroy()}for(var v=0,g=s;v<g.length;v++){var d=g[v];this.dom.appendChild(d.dom)}this.gutters=s}return n};t.prototype.destroy=function(){for(var t=0,e=this.gutters;t<e.length;t++){var r=e[t];r.destroy()}this.dom.remove()};return t}(),{provide:Xr.scrollMargins.from((function(t){if(t.gutters.length==0||!t.fixed)return null;return t.view.textDirection==ln.LTR?{left:t.dom.offsetWidth}:{right:t.dom.offsetWidth}}))});function hh(t){return Array.isArray(t)?t:[t]}function ph(t,e,r){while(t.value&&t.from<=r){if(t.from==r)e.push(t.value);t.next()}}var dh=function(){function t(t,e,r){this.gutter=t;this.height=r;this.localMarkers=[];this.i=0;this.cursor=Xt.iter(t.markers,e.from)}t.prototype.line=function(t,e,r){if(this.localMarkers.length)this.localMarkers=[];ph(this.cursor,this.localMarkers,e.from);var n=r.length?this.localMarkers.concat(r):this.localMarkers;var i=this.gutter.config.lineMarker(t,e,n);if(i)n.unshift(i);var o=this.gutter;if(n.length==0&&!o.config.renderEmptyElements)return;var a=e.top-this.height;if(this.i==o.elements.length){var s=new gh(t,e.height,a,n);o.elements.push(s);o.dom.appendChild(s.dom)}else{o.elements[this.i].update(t,e.height,a,n)}this.height=e.bottom;this.i++};t.prototype.finish=function(){var t=this.gutter;while(t.elements.length>this.i){var e=t.elements.pop();t.dom.removeChild(e.dom);e.destroy()}};return t}();var vh=function(){function t(t,e){this.view=t;this.config=e;this.elements=[];this.spacer=null;this.dom=document.createElement("div");this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");var r=function(r){n.dom.addEventListener(r,(function(n){var i=t.lineBlockAtHeight(n.clientY-t.documentTop);if(e.domEventHandlers[r](t,i,n))n.preventDefault()}))};var n=this;for(var i in e.domEventHandlers){r(i)}this.markers=hh(e.markers(t));if(e.initialSpacer){this.spacer=new gh(t,0,0,[e.initialSpacer(t)]);this.dom.appendChild(this.spacer.dom);this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none"}}t.prototype.update=function(t){var e=this.markers;this.markers=hh(this.config.markers(t.view));if(this.spacer&&this.config.updateSpacer){var r=this.config.updateSpacer(this.spacer.markers[0],t);if(r!=this.spacer.markers[0])this.spacer.update(t.view,0,0,[r])}var n=t.view.viewport;return!Xt.eq(this.markers,e,n.from,n.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(t):false)};t.prototype.destroy=function(){for(var t=0,e=this.elements;t<e.length;t++){var r=e[t];r.destroy()}};return t}();var gh=function(){function t(t,e,r,n){this.height=-1;this.above=0;this.markers=[];this.dom=document.createElement("div");this.update(t,e,r,n)}t.prototype.update=function(t,e,r,n){if(this.height!=e)this.dom.style.height=(this.height=e)+"px";if(this.above!=r)this.dom.style.marginTop=(this.above=r)?r+"px":"";if(!mh(this.markers,n))this.setMarkers(t,n)};t.prototype.setMarkers=function(t,e){var r="cm-gutterElement",n=this.dom.firstChild;for(var i=0,o=0;;){var a=o,s=i<e.length?e[i++]:null,f=false;if(s){var u=s.elementClass;if(u)r+=" "+u;for(var l=o;l<this.markers.length;l++)if(this.markers[l].compare(s)){a=l;f=true;break}}else{a=this.markers.length}while(o<a){var c=this.markers[o++];if(c.toDOM){c.destroy(n);var h=n.nextSibling;n.remove();n=h}}if(!s)break;if(s.toDOM){if(f)n=n.nextSibling;else this.dom.insertBefore(s.toDOM(t),n)}if(f)o++}this.dom.className=r;this.markers=e};t.prototype.destroy=function(){this.setMarkers(null,[])};return t}();function mh(t,e){if(t.length!=e.length)return false;for(var r=0;r<t.length;r++)if(!t[r].compare(e[r]))return false;return true}var yh=Y.define();var bh=Y.define({combine:function(t){return Vt(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers:function(t,e){var r=Object.assign({},t);var n=function(t){var n=r[t],i=e[t];r[t]=n?function(t,e,r){return n(t,e,r)||i(t,e,r)}:i};for(var i in e){n(i)}return r}})}});var wh=function(t){__extends(e,t);function e(e){var r=t.call(this)||this;r.number=e;return r}e.prototype.eq=function(t){return this.number==t.number};e.prototype.toDOM=function(){return document.createTextNode(this.number)};return e}(nh);function xh(t,e){return t.state.facet(bh).formatNumber(e,t.state)}var kh=ah.compute([bh],(function(t){return{class:"cm-lineNumbers",renderEmptyElements:false,markers:function(t){return t.state.facet(yh)},lineMarker:function(t,e,r){if(r.some((function(t){return t.toDOM})))return null;return new wh(xh(t,t.state.doc.lineAt(e.from).number))},lineMarkerChange:function(t){return t.startState.facet(bh)!=t.state.facet(bh)},initialSpacer:function(t){return new wh(xh(t,Ch(t.state.doc.lines)))},updateSpacer:function(t,e){var r=xh(e.view,Ch(e.view.state.doc.lines));return r==t.number?t:new wh(r)},domEventHandlers:t.facet(bh).domEventHandlers}}));function Sh(t){if(t===void 0){t={}}return[bh.of(t),lh(),kh]}function Ch(t){var e=9;while(e<t)e=e*10+9;return e}function Ah(t,e){var r=e.mapPos(t.from,1),n=e.mapPos(t.to,-1);return r>=n?undefined:{from:r,to:n}}var Oh=St.define({map:Ah});var Mh=St.define({map:Ah});function Dh(t){var e=[];var r=function(r){if(e.some((function(t){return t.from<=r&&t.to>=r})))return"continue";e.push(t.lineBlockAt(r))};for(var n=0,i=t.state.selection.ranges;n<i.length;n++){var o=i[n].head;r(o)}return e}var Ph=rt.define({create:function(){return Ar.none},update:function(t,e){t=t.map(e.changes);var r=function(e){if(e.is(Oh)&&!Eh(t,e.value.from,e.value.to))t=t.update({add:[zh.range(e.value.from,e.value.to)]});else if(e.is(Mh))t=t.update({filter:function(t,r){return e.value.from!=t||e.value.to!=r},filterFrom:e.value.from,filterTo:e.value.to})};for(var n=0,i=e.effects;n<i.length;n++){var o=i[n];r(o)}if(e.selection){var a=false,s=e.selection.main.head;t.between(s,s,(function(t,e){if(t<s&&e>s)a=true}));if(a)t=t.update({filterFrom:s,filterTo:s,filter:function(t,e){return e<=s||t>=s}})}return t},provide:function(t){return Eo.decorations.from(t)}});function Th(t,e,r){var n;var i=null;(n=t.field(Ph,false))===null||n===void 0?void 0:n.between(e,r,(function(t,e){if(!i||i.from>t)i={from:t,to:e}}));return i}function Eh(t,e,r){var n=false;t.between(e,e,(function(t,i){if(t==e&&i==r)n=true}));return n}function Rh(t,e){return t.field(Ph,false)?e:e.concat(St.appendConfig.of(Fh()))}var Lh=function(t){for(var e=0,r=Dh(t);e<r.length;e++){var n=r[e];var i=sf(t.state,n.from,n.to);if(i){t.dispatch({effects:Rh(t.state,[Oh.of(i),Ih(t,i)])});return true}}return false};var Bh=function(t){if(!t.state.field(Ph,false))return false;var e=[];for(var r=0,n=Dh(t);r<n.length;r++){var i=n[r];var o=Th(t.state,i.from,i.to);if(o)e.push(Mh.of(o),Ih(t,o,false))}if(e.length)t.dispatch({effects:e});return e.length>0};function Ih(t,e,r){if(r===void 0){r=true}var n=t.state.doc.lineAt(e.from).number,i=t.state.doc.lineAt(e.to).number;return Eo.announce.of("".concat(t.state.phrase(r?"Folded lines":"Unfolded lines")," ").concat(n," ").concat(t.state.phrase("to")," ").concat(i,"."))}var Nh=function(t){var e=t.state,r=[];for(var n=0;n<e.doc.length;){var i=t.lineBlockAt(n),o=sf(e,i.from,i.to);if(o)r.push(Oh.of(o));n=(o?t.lineBlockAt(o.to):i).to+1}if(r.length)t.dispatch({effects:Rh(t.state,r)});return!!r.length};var jh=function(t){var e=t.state.field(Ph,false);if(!e||!e.size)return false;var r=[];e.between(0,t.state.doc.length,(function(t,e){r.push(Mh.of({from:t,to:e}))}));t.dispatch({effects:r});return true};var _h=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:Lh},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:Bh},{key:"Ctrl-Alt-[",run:Nh},{key:"Ctrl-Alt-]",run:jh}];var Vh={placeholderDOM:null,placeholderText:"…"};var Hh=Y.define({combine:function(t){return Vt(t,Vh)}});function Fh(t){var e=[Ph,Gh];if(t)e.push(Hh.of(t));return e}var zh=Ar.replace({widget:new(function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.toDOM=function(t){var e=t.state,r=e.facet(Hh);var n=function(e){var r=t.lineBlockAt(t.posAtDOM(e.target));var n=Th(t.state,r.from,r.to);if(n)t.dispatch({effects:Mh.of(n)});e.preventDefault()};if(r.placeholderDOM)return r.placeholderDOM(t,n);var i=document.createElement("span");i.textContent=r.placeholderText;i.setAttribute("aria-label",e.phrase("folded code"));i.title=e.phrase("unfold");i.className="cm-foldPlaceholder";i.onclick=n;return i};return e}(Sr))});var Wh={openText:"⌄",closedText:"›",markerDOM:null,domEventHandlers:{}};var qh=function(t){__extends(e,t);function e(e,r){var n=t.call(this)||this;n.config=e;n.open=r;return n}e.prototype.eq=function(t){return this.config==t.config&&this.open==t.open};e.prototype.toDOM=function(t){if(this.config.markerDOM)return this.config.markerDOM(this.open);var e=document.createElement("span");e.textContent=this.open?this.config.openText:this.config.closedText;e.title=t.state.phrase(this.open?"Fold line":"Unfold line");return e};return e}(nh);function Uh(t){if(t===void 0){t={}}var e=Object.assign(Object.assign({},Wh),t);var r=new qh(e,true),n=new qh(e,false);var i=tn.fromClass(function(){function t(t){this.from=t.viewport.from;this.markers=this.buildMarkers(t)}t.prototype.update=function(t){if(t.docChanged||t.viewportChanged||t.startState.facet(Bs)!=t.state.facet(Bs)||t.startState.field(Ph,false)!=t.state.field(Ph,false))this.markers=this.buildMarkers(t.view)};t.prototype.buildMarkers=function(t){var e=new Zt;for(var i=0,o=t.viewportLineBlocks;i<o.length;i++){var a=o[i];var s=Th(t.state,a.from,a.to)?n:sf(t.state,a.from,a.to)?r:null;if(s)e.add(a.from,a.from,s)}return e.finish()};return t}());var o=e.domEventHandlers;return[i,sh({class:"cm-foldGutter",markers:function(t){var e;return((e=t.plugin(i))===null||e===void 0?void 0:e.markers)||Xt.empty},initialSpacer:function(){return new qh(e,false)},domEventHandlers:Object.assign(Object.assign({},o),{click:function(t,e,r){if(o.click&&o.click(t,e,r))return true;var n=Th(t.state,e.from,e.to);if(n){t.dispatch({effects:Mh.of(n)});return true}var i=sf(t.state,e.from,e.to);if(i){t.dispatch({effects:Oh.of(i)});return true}return false}})}),Fh()]}var Gh=Eo.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});var Kh=0;var Jh=function(){function t(t,e,r){this.set=t;this.base=e;this.modified=r;this.id=Kh++}t.define=function(e){if(e===null||e===void 0?void 0:e.base)throw new Error("Can not derive from a modified tag");var r=new t([],null,[]);r.set.push(r);if(e)for(var n=0,i=e.set;n<i.length;n++){var o=i[n];r.set.push(o)}return r};t.defineModifier=function(){var t=new Yh;return function(e){if(e.modified.indexOf(t)>-1)return e;return Yh.get(e.base||e,e.modified.concat(t).sort((function(t,e){return t.id-e.id})))}};return t}();var $h=0;var Yh=function(){function t(){this.instances=[];this.id=$h++}t.get=function(e,r){if(!r.length)return e;var n=r[0].instances.find((function(t){return t.base==e&&Xh(r,t.modified)}));if(n)return n;var i=[],o=new Jh(i,e,r);for(var a=0,s=r;a<s.length;a++){var f=s[a];f.instances.push(o)}var u=Qh(r);for(var l=0,c=e.set;l<c.length;l++){var h=c[l];for(var p=0,d=u;p<d.length;p++){var v=d[p];i.push(t.get(h,v))}}return o};return t}();function Xh(t,e){return t.length==e.length&&t.every((function(t,r){return t==e[r]}))}function Qh(t){var e=[t];for(var r=0;r<t.length;r++){for(var n=0,i=Qh(t.slice(0,r).concat(t.slice(r+1)));n<i.length;n++){var o=i[n];e.push(o)}}return e}function Zh(t){var e=Object.create(null);for(var r in t){var n=t[r];if(!Array.isArray(n))n=[n];for(var i=0,o=r.split(" ");i<o.length;i++){var a=o[i];if(a){var s=[],f=2,u=a;for(var l=0;;){if(u=="..."&&l>0&&l+3==a.length){f=1;break}var c=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(u);if(!c)throw new RangeError("Invalid path: "+a);s.push(c[0]=="*"?null:c[0][0]=='"'?JSON.parse(c[0]):c[0]);l+=c[0].length;if(l==a.length)break;var h=a[l++];if(l==a.length&&h=="!"){f=0;break}if(h!="/")throw new RangeError("Invalid path: "+a);u=a.slice(l)}var p=s.length-1,d=s[p];if(!d)throw new RangeError("Invalid path: "+a);var v=new ip(n,f,p>0?s.slice(0,p):null);e[d]=v.sort(e[d])}}}return tp.add(e)}var tp=new Na;var ep=Y.define({combine:function(t){return t.length?op.combinedMatch(t):null}});var rp=Y.define({combine:function(t){return t.length?t[0].match:null}});function np(t){return t.facet(ep)||t.facet(rp)}var ip=function(){function t(t,e,r,n){this.tags=t;this.mode=e;this.context=r;this.next=n}t.prototype.sort=function(t){if(!t||t.depth<this.depth){this.next=t;return this}t.next=this.sort(t.next);return t};Object.defineProperty(t.prototype,"depth",{get:function(){return this.context?this.context.length:0},enumerable:false,configurable:true});return t}();var op=function(){function t(t,e){this.map=Object.create(null);var r;function n(t){var e=qt.newName();(r||(r=Object.create(null)))["."+e]=t;return e}this.all=typeof e.all=="string"?e.all:e.all?n(e.all):null;for(var i=0,o=t;i<o.length;i++){var a=o[i];var s=(a.class||n(Object.assign({},a,{tag:null})))+(this.all?" "+this.all:"");var f=a.tag;if(!Array.isArray(f))this.map[f.id]=s;else for(var u=0,l=f;u<l.length;u++){var c=l[u];this.map[c.id]=s}}this.module=r?new qt(r):null;this.scope=e.scope||null;this.match=this.match.bind(this);var h=[sp];if(this.module)h.push(Eo.styleModule.of(this.module));this.extension=h.concat(ep.of(this));this.fallback=h.concat(rp.of(this))}t.prototype.match=function(t,e){if(this.scope&&e!=this.scope)return null;for(var r=0,n=t.set;r<n.length;r++){var i=n[r];var o=this.map[i.id];if(o!==undefined){if(i!=t)this.map[t.id]=o;return o}}return this.map[t.id]=this.all};t.combinedMatch=function(t){if(t.length==1)return t[0].match;var e=t.some((function(t){return t.scope}))?undefined:Object.create(null);return function(r,n){var i=e&&e[r.id];if(i!==undefined)return i;var o=null;for(var a=0,s=t;a<s.length;a++){var f=s[a];var u=f.match(r,n);if(u)o=o?o+" "+u:u}if(e)e[r.id]=o;return o}};t.define=function(e,r){return new t(e,r||{})};t.get=function(t,e,r){var n=np(t);return n&&n(e,r||Va.none)};return t}();var ap=function(){function t(t){this.markCache=Object.create(null);this.tree=Os(t.state);this.decorations=this.buildDeco(t,np(t.state))}t.prototype.update=function(t){var e=Os(t.state),r=np(t.state);var n=r!=t.startState.facet(ep);if(e.length<t.view.viewport.to&&!n&&e.type==this.tree.type){this.decorations=this.decorations.map(t.changes)}else if(e!=this.tree||t.viewportChanged||n){this.tree=e;this.decorations=this.buildDeco(t.view,r)}};t.prototype.buildDeco=function(t,e){var r=this;if(!e||!this.tree.length)return Ar.none;var n=new Zt;for(var i=0,o=t.visibleRanges;i<o.length;i++){var a=o[i],s=a.from,f=a.to;lp(this.tree,s,f,e,(function(t,e,i){n.add(t,e,r.markCache[i]||(r.markCache[i]=Ar.mark({class:i})))}))}return n.finish()};return t}();var sp=ot.high(tn.fromClass(ap,{decorations:function(t){return t.decorations}}));var fp=[""];var up=function(){function t(t,e,r){this.at=t;this.style=e;this.span=r;this.class=""}t.prototype.startSpan=function(t,e){if(e!=this.class){this.flush(t);if(t>this.at)this.at=t;this.class=e}};t.prototype.flush=function(t){if(t>this.at&&this.class)this.span(this.at,t,this.class)};t.prototype.highlightRange=function(t,e,r,n,i,o){var a=t.type,s=t.from,f=t.to;if(s>=r||f<=e)return;fp[i]=a.name;if(a.isTop)o=a;var u=n;var l=a.prop(tp),c=false;while(l){if(!l.context||cp(l.context,fp,i)){for(var h=0,p=l.tags;h<p.length;h++){var d=p[h];var v=this.style(d,o);if(v){if(u)u+=" ";u+=v;if(l.mode==1)n+=(n?" ":"")+v;else if(l.mode==0)c=true}}break}l=l.next}this.startSpan(t.from,u);if(c)return;var g=t.tree&&t.tree.prop(Na.mounted);if(g&&g.overlay){var m=t.node.enter(g.overlay[0].from+s,1);var y=t.firstChild();for(var b=0,w=s;;b++){var x=b<g.overlay.length?g.overlay[b]:null;var k=x?x.from+s:f;var S=Math.max(e,w),C=Math.min(r,k);if(S<C&&y){while(t.from<C){this.highlightRange(t,S,C,n,i+1,o);this.startSpan(Math.min(r,t.to),u);if(t.to>=k||!t.nextSibling())break}}if(!x||k>r)break;w=x.to+s;if(w>e){this.highlightRange(m.cursor,Math.max(e,x.from+s),Math.min(r,w),n,i,g.tree.type);this.startSpan(w,u)}}if(y)t.parent()}else if(t.firstChild()){do{if(t.to<=e)continue;if(t.from>=r)break;this.highlightRange(t,e,r,n,i+1,o);this.startSpan(Math.min(r,t.to),u)}while(t.nextSibling());t.parent()}};return t}();function lp(t,e,r,n,i){var o=new up(e,n,i);o.highlightRange(t.cursor(),e,r,"",0,t.type);o.flush(r)}function cp(t,e,r){if(t.length>r-1)return false;for(var n=r-1,i=t.length-1;i>=0;i--,n--){var o=t[i];if(o&&o!=e[n])return false}return true}var hp=Jh.define;var pp=hp(),dp=hp(),vp=hp(dp),gp=hp(dp),mp=hp(),yp=hp(mp),bp=hp(mp),wp=hp(),xp=hp(wp),kp=hp(),Sp=hp(),Cp=hp(),Ap=hp(Cp),Op=hp();var Mp=t("t",{comment:pp,lineComment:hp(pp),blockComment:hp(pp),docComment:hp(pp),name:dp,variableName:hp(dp),typeName:vp,tagName:hp(vp),propertyName:gp,attributeName:hp(gp),className:hp(dp),labelName:hp(dp),namespace:hp(dp),macroName:hp(dp),literal:mp,string:yp,docString:hp(yp),character:hp(yp),attributeValue:hp(yp),number:bp,integer:hp(bp),float:hp(bp),bool:hp(mp),regexp:hp(mp),escape:hp(mp),color:hp(mp),url:hp(mp),keyword:kp,self:hp(kp),null:hp(kp),atom:hp(kp),unit:hp(kp),modifier:hp(kp),operatorKeyword:hp(kp),controlKeyword:hp(kp),definitionKeyword:hp(kp),moduleKeyword:hp(kp),operator:Sp,derefOperator:hp(Sp),arithmeticOperator:hp(Sp),logicOperator:hp(Sp),bitwiseOperator:hp(Sp),compareOperator:hp(Sp),updateOperator:hp(Sp),definitionOperator:hp(Sp),typeOperator:hp(Sp),controlOperator:hp(Sp),punctuation:Cp,separator:hp(Cp),bracket:Ap,angleBracket:hp(Ap),squareBracket:hp(Ap),paren:hp(Ap),brace:hp(Ap),content:wp,heading:xp,heading1:hp(xp),heading2:hp(xp),heading3:hp(xp),heading4:hp(xp),heading5:hp(xp),heading6:hp(xp),contentSeparator:hp(wp),list:hp(wp),quote:hp(wp),emphasis:hp(wp),strong:hp(wp),link:hp(wp),monospace:hp(wp),strikethrough:hp(wp),inserted:hp(),deleted:hp(),changed:hp(),invalid:hp(),meta:Op,documentMeta:hp(Op),annotation:hp(Op),processingInstruction:hp(Op),definition:Jh.defineModifier(),constant:Jh.defineModifier(),function:Jh.defineModifier(),standard:Jh.defineModifier(),local:Jh.defineModifier(),special:Jh.defineModifier()});var Dp=op.define([{tag:Mp.link,textDecoration:"underline"},{tag:Mp.heading,textDecoration:"underline",fontWeight:"bold"},{tag:Mp.emphasis,fontStyle:"italic"},{tag:Mp.strong,fontWeight:"bold"},{tag:Mp.strikethrough,textDecoration:"line-through"},{tag:Mp.keyword,color:"#708"},{tag:[Mp.atom,Mp.bool,Mp.url,Mp.contentSeparator,Mp.labelName],color:"#219"},{tag:[Mp.literal,Mp.inserted],color:"#164"},{tag:[Mp.string,Mp.deleted],color:"#a11"},{tag:[Mp.regexp,Mp.escape,Mp.special(Mp.string)],color:"#e40"},{tag:Mp.definition(Mp.variableName),color:"#00f"},{tag:Mp.local(Mp.variableName),color:"#30a"},{tag:[Mp.typeName,Mp.namespace],color:"#085"},{tag:Mp.className,color:"#167"},{tag:[Mp.special(Mp.variableName),Mp.macroName],color:"#256"},{tag:Mp.definition(Mp.propertyName),color:"#00c"},{tag:Mp.comment,color:"#940"},{tag:Mp.meta,color:"#7a757a"},{tag:Mp.invalid,color:"#f00"}]);var Pp=wt.define();var Tp=wt.define();var Ep=Y.define();var Rp=Y.define({combine:function(t){return Vt(t,{minDepth:100,newGroupDelay:500},{minDepth:Math.max,newGroupDelay:Math.min})}});function Lp(t){var e=0;t.iterChangedRanges((function(t,r){return e=r}));return e}var Bp=rt.define({create:function(){return td.empty},update:function(t,e){var r=e.state.facet(Rp);var n=e.annotation(Pp);if(n){var i=e.docChanged?G.single(Lp(e.changes)):undefined;var o=zp.fromTransaction(e,i),a=n.side;var s=a==0?t.undone:t.done;if(o)s=Wp(s,s.length,r.minDepth,o);else s=$p(s,e.startState.selection);return new td(a==0?n.rest:s,a==0?s:n.rest)}var f=e.annotation(Tp);if(f=="full"||f=="before")t=t.isolate();if(e.annotation(Ct.addToHistory)===false)return!e.changes.empty?t.addMapping(e.changes.desc):t;var u=zp.fromTransaction(e);var l=e.annotation(Ct.time),c=e.annotation(Ct.userEvent);if(u)t=t.addChanges(u,l,c,r.newGroupDelay,r.minDepth);else if(e.selection)t=t.addSelection(e.startState.selection,l,c,r.newGroupDelay);if(f=="full"||f=="after")t=t.isolate();return t},toJSON:function(t){return{done:t.done.map((function(t){return t.toJSON()})),undone:t.undone.map((function(t){return t.toJSON()}))}},fromJSON:function(t){return new td(t.done.map(zp.fromJSON),t.undone.map(zp.fromJSON))}});function Ip(t){if(t===void 0){t={}}return[Bp,Rp.of(t),Eo.domEventHandlers({beforeinput:function(t,e){var r=t.inputType=="historyUndo"?_p:t.inputType=="historyRedo"?Vp:null;if(!r)return false;t.preventDefault();return r(e)}})]}var Np=Bp;function jp(t,e){return function(r){var n=r.state,i=r.dispatch;if(!e&&n.readOnly)return false;var o=n.field(Bp,false);if(!o)return false;var a=o.pop(t,n,e);if(!a)return false;i(a);return true}}var _p=jp(0,false);var Vp=jp(1,false);var Hp=jp(0,true);var Fp=jp(1,true);var zp=function(){function t(t,e,r,n,i){this.changes=t;this.effects=e;this.mapped=r;this.startSelection=n;this.selectionsAfter=i}t.prototype.setSelAfter=function(e){return new t(this.changes,this.effects,this.mapped,this.startSelection,e)};t.prototype.toJSON=function(){var t,e,r;return{changes:(t=this.changes)===null||t===void 0?void 0:t.toJSON(),mapped:(e=this.mapped)===null||e===void 0?void 0:e.toJSON(),startSelection:(r=this.startSelection)===null||r===void 0?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map((function(t){return t.toJSON()}))}};t.fromJSON=function(e){return new t(e.changes&&_.fromJSON(e.changes),[],e.mapped&&j.fromJSON(e.mapped),e.startSelection&&G.fromJSON(e.startSelection),e.selectionsAfter.map(G.fromJSON))};t.fromTransaction=function(e,r){var n=Kp;for(var i=0,o=e.startState.facet(Ep);i<o.length;i++){var a=o[i];var s=a(e);if(s.length)n=n.concat(s)}if(!n.length&&e.changes.empty)return null;return new t(e.changes.invert(e.startState.doc),n,undefined,r||e.startState.selection,Kp)};t.selection=function(e){return new t(undefined,Kp,undefined,undefined,e)};return t}();function Wp(t,e,r,n){var i=e+1>r+20?e-r-1:0;var o=t.slice(i,e);o.push(n);return o}function qp(t,e){var r=[],n=false;t.iterChangedRanges((function(t,e){return r.push(t,e)}));e.iterChangedRanges((function(t,e,i,o){for(var a=0;a<r.length;){var s=r[a++],f=r[a++];if(o>=s&&i<=f)n=true}}));return n}function Up(t,e){return t.ranges.length==e.ranges.length&&t.ranges.filter((function(t,r){return t.empty!=e.ranges[r].empty})).length===0}function Gp(t,e){return!t.length?e:!e.length?t:t.concat(e)}var Kp=[];var Jp=200;function $p(t,e){if(!t.length){return[zp.selection([e])]}else{var r=t[t.length-1];var n=r.selectionsAfter.slice(Math.max(0,r.selectionsAfter.length-Jp));if(n.length&&n[n.length-1].eq(e))return t;n.push(e);return Wp(t,t.length-1,1e9,r.setSelAfter(n))}}function Yp(t){var e=t[t.length-1];var r=t.slice();r[t.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1));return r}function Xp(t,e){if(!t.length)return t;var r=t.length,n=Kp;while(r){var i=Qp(t[r-1],e,n);if(i.changes&&!i.changes.empty||i.effects.length){var o=t.slice(0,r);o[r-1]=i;return o}else{e=i.mapped;r--;n=i.selectionsAfter}}return n.length?[zp.selection(n)]:Kp}function Qp(t,e,r){var n=Gp(t.selectionsAfter.length?t.selectionsAfter.map((function(t){return t.map(e)})):Kp,r);if(!t.changes)return zp.selection(n);var i=t.changes.map(e),o=e.mapDesc(t.changes,true);var a=t.mapped?t.mapped.composeDesc(o):o;return new zp(i,St.mapEffects(t.effects,e),a,t.startSelection.map(o),n)}var Zp=/^(input\.type|delete)($|\.)/;var td=function(){function t(t,e,r,n){if(r===void 0){r=0}if(n===void 0){n=undefined}this.done=t;this.undone=e;this.prevTime=r;this.prevUserEvent=n}t.prototype.isolate=function(){return this.prevTime?new t(this.done,this.undone):this};t.prototype.addChanges=function(e,r,n,i,o){var a=this.done,s=a[a.length-1];if(s&&s.changes&&!s.changes.empty&&e.changes&&(!n||Zp.test(n))&&(!s.selectionsAfter.length&&r-this.prevTime<i&&qp(s.changes,e.changes)||n=="input.type.compose")){a=Wp(a,a.length-1,o,new zp(e.changes.compose(s.changes),Gp(e.effects,s.effects),s.mapped,s.startSelection,Kp))}else{a=Wp(a,a.length,o,e)}return new t(a,Kp,r,n)};t.prototype.addSelection=function(e,r,n,i){var o=this.done.length?this.done[this.done.length-1].selectionsAfter:Kp;if(o.length>0&&r-this.prevTime<i&&n==this.prevUserEvent&&n&&/^select($|\.)/.test(n)&&Up(o[o.length-1],e))return this;return new t($p(this.done,e),this.undone,r,n)};t.prototype.addMapping=function(e){return new t(Xp(this.done,e),Xp(this.undone,e),this.prevTime,this.prevUserEvent)};t.prototype.pop=function(t,e,r){var n=t==0?this.done:this.undone;if(n.length==0)return null;var i=n[n.length-1];if(r&&i.selectionsAfter.length){return e.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:Pp.of({side:t,rest:Yp(n)}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:true})}else if(!i.changes){return null}else{var o=n.length==1?Kp:n.slice(0,n.length-1);if(i.mapped)o=Xp(o,i.mapped);return e.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:Pp.of({side:t,rest:o}),filter:false,userEvent:t==0?"undo":"redo",scrollIntoView:true})}};return t}();td.empty=new td(Kp,Kp);var ed=[{key:"Mod-z",run:_p,preventDefault:true},{key:"Mod-y",mac:"Mod-Shift-z",run:Vp,preventDefault:true},{key:"Mod-u",run:Hp,preventDefault:true},{key:"Alt-u",mac:"Mod-Shift-u",run:Fp,preventDefault:true}];var rd=Y.define({combine:function(t){var e,r;for(var n=0,i=t;n<i.length;n++){var o=i[n];e=e||o.topContainer;r=r||o.bottomContainer}return{topContainer:e,bottomContainer:r}}});function nd(t,e){var r=t.plugin(id);var n=r?r.specs.indexOf(e):-1;return n>-1?r.panels[n]:null}var id=tn.fromClass(function(){function t(t){this.input=t.state.facet(fd);this.specs=this.input.filter((function(t){return t}));this.panels=this.specs.map((function(e){return e(t)}));var e=t.state.facet(rd);this.top=new od(t,true,e.topContainer);this.bottom=new od(t,false,e.bottomContainer);this.top.sync(this.panels.filter((function(t){return t.top})));this.bottom.sync(this.panels.filter((function(t){return!t.top})));for(var r=0,n=this.panels;r<n.length;r++){var i=n[r];i.dom.classList.add("cm-panel");if(i.mount)i.mount()}}t.prototype.update=function(t){var e=t.state.facet(rd);if(this.top.container!=e.topContainer){this.top.sync([]);this.top=new od(t.view,true,e.topContainer)}if(this.bottom.container!=e.bottomContainer){this.bottom.sync([]);this.bottom=new od(t.view,false,e.bottomContainer)}this.top.syncClasses();this.bottom.syncClasses();var r=t.state.facet(fd);if(r!=this.input){var n=r.filter((function(t){return t}));var i=[],o=[],a=[],s=[];for(var f=0,u=n;f<u.length;f++){var l=u[f];var c=this.specs.indexOf(l),h=void 0;if(c<0){h=l(t.view);s.push(h)}else{h=this.panels[c];if(h.update)h.update(t)}i.push(h);(h.top?o:a).push(h)}this.specs=n;this.panels=i;this.top.sync(o);this.bottom.sync(a);for(var p=0,d=s;p<d.length;p++){var v=d[p];v.dom.classList.add("cm-panel");if(v.mount)v.mount()}}else{for(var g=0,m=this.panels;g<m.length;g++){var v=m[g];if(v.update)v.update(t)}}};t.prototype.destroy=function(){this.top.sync([]);this.bottom.sync([])};return t}(),{provide:Xr.scrollMargins.from((function(t){return{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}}))});var od=function(){function t(t,e,r){this.view=t;this.top=e;this.container=r;this.dom=undefined;this.classes="";this.panels=[];this.syncClasses()}t.prototype.sync=function(t){for(var e=0,r=this.panels;e<r.length;e++){var n=r[e];if(n.destroy&&t.indexOf(n)<0)n.destroy()}this.panels=t;this.syncDOM()};t.prototype.syncDOM=function(){if(this.panels.length==0){if(this.dom){this.dom.remove();this.dom=undefined}return}if(!this.dom){this.dom=document.createElement("div");this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom";this.dom.style[this.top?"top":"bottom"]="0";var t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}var e=this.dom.firstChild;for(var r=0,n=this.panels;r<n.length;r++){var i=n[r];if(i.dom.parentNode==this.dom){while(e!=i.dom)e=ad(e);e=e.nextSibling}else{this.dom.insertBefore(i.dom,e)}}while(e)e=ad(e)};t.prototype.scrollMargin=function(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)};t.prototype.syncClasses=function(){if(!this.container||this.classes==this.view.themeClasses)return;for(var t=0,e=this.classes.split(" ");t<e.length;t++){var r=e[t];if(r)this.container.classList.remove(r)}for(var n=0,i=(this.classes=this.view.themeClasses).split(" ");n<i.length;n++){var r=i[n];if(r)this.container.classList.add(r)}};return t}();function ad(t){var e=t.nextSibling;t.remove();return e}var sd=Eo.baseTheme({".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"}});var fd=Y.define({enables:[id,sd]});function ud(){var t=arguments[0];if(typeof t=="string")t=document.createElement(t);var e=1,r=arguments[1];if(r&&typeof r=="object"&&r.nodeType==null&&!Array.isArray(r)){for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){var i=r[n];if(typeof i=="string")t.setAttribute(n,i);else if(i!=null)t[n]=i}e++}for(;e<arguments.length;e++)ld(t,arguments[e]);return t}function ld(t,e){if(typeof e=="string"){t.appendChild(document.createTextNode(e))}else if(e==null);else if(e.nodeType!=null){t.appendChild(e)}else if(Array.isArray(e)){for(var r=0;r<e.length;r++)ld(t,e[r])}else{throw new RangeError("Unsupported child node: "+e)}}var cd=typeof String.prototype.normalize=="function"?function(t){return t.normalize("NFKD")}:function(t){return t};var hd=function(){function t(t,e,r,n,i){if(r===void 0){r=0}if(n===void 0){n=t.length}this.value={from:0,to:0};this.done=false;this.matches=[];this.buffer="";this.bufferPos=0;this.iter=t.iterRange(r,n);this.bufferStart=r;this.normalize=i?function(t){return i(cd(t))}:cd;this.query=this.normalize(e)}t.prototype.peek=function(){if(this.bufferPos==this.buffer.length){this.bufferStart+=this.buffer.length;this.iter.next();if(this.iter.done)return-1;this.bufferPos=0;this.buffer=this.iter.value}return w(this.buffer,this.bufferPos)};t.prototype.next=function(){while(this.matches.length)this.matches.pop();return this.nextOverlapping()};t.prototype.nextOverlapping=function(){for(;;){var t=this.peek();if(t<0){this.done=true;return this}var e=x(t),r=this.bufferStart+this.bufferPos;this.bufferPos+=k(t);var n=this.normalize(e);for(var i=0,o=r;;i++){var a=n.charCodeAt(i);var s=this.match(a,o);if(s){this.value=s;return this}if(i==n.length-1)break;if(o==r&&i<e.length&&e.charCodeAt(i)==a)o++}}};t.prototype.match=function(t,e){var r=null;for(var n=0;n<this.matches.length;n+=2){var i=this.matches[n],o=false;if(this.query.charCodeAt(i)==t){if(i==this.query.length-1){r={from:this.matches[n+1],to:e+1}}else{this.matches[n]++;o=true}}if(!o){this.matches.splice(n,2);n-=2}}if(this.query.charCodeAt(0)==t){if(this.query.length==1)r={from:e,to:e+1};else this.matches.push(1,e)}return r};return t}();if(typeof Symbol!="undefined")hd.prototype[Symbol.iterator]=function(){return this};var pd={from:-1,to:-1,match:/.*/.exec("")};var dd="gm"+(/x/.unicode==null?"":"u");var vd=function(){function t(t,e,r,n,i){if(n===void 0){n=0}if(i===void 0){i=t.length}this.to=i;this.curLine="";this.done=false;this.value=pd;if(/\\[sWDnr]|\n|\r|\[\^/.test(e))return new yd(t,e,r,n,i);this.re=new RegExp(e,dd+((r===null||r===void 0?void 0:r.ignoreCase)?"i":""));this.iter=t.iter();var o=t.lineAt(n);this.curLineStart=o.from;this.matchPos=n;this.getLine(this.curLineStart)}t.prototype.getLine=function(t){this.iter.next(t);if(this.iter.lineBreak){this.curLine=""}else{this.curLine=this.iter.value;if(this.curLineStart+this.curLine.length>this.to)this.curLine=this.curLine.slice(0,this.to-this.curLineStart);this.iter.next()}};t.prototype.nextLine=function(){this.curLineStart=this.curLineStart+this.curLine.length+1;if(this.curLineStart>this.to)this.curLine="";else this.getLine(0)};t.prototype.next=function(){for(var t=this.matchPos-this.curLineStart;;){this.re.lastIndex=t;var e=this.matchPos<=this.to&&this.re.exec(this.curLine);if(e){var r=this.curLineStart+e.index,n=r+e[0].length;this.matchPos=n+(r==n?1:0);if(r==this.curLine.length)this.nextLine();if(r<n||r>this.value.to){this.value={from:r,to:n,match:e};return this}t=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to){this.nextLine();t=0}else{this.done=true;return this}}};return t}();var gd=new WeakMap;var md=function(){function t(t,e){this.from=t;this.text=e}Object.defineProperty(t.prototype,"to",{get:function(){return this.from+this.text.length},enumerable:false,configurable:true});t.get=function(e,r,n){var i=gd.get(e);if(!i||i.from>=n||i.to<=r){var o=new t(r,e.sliceString(r,n));gd.set(e,o);return o}if(i.from==r&&i.to==n)return i;var a=i.text,s=i.from;if(s>r){a=e.sliceString(r,s)+a;s=r}if(i.to<n)a+=e.sliceString(i.to,n);gd.set(e,new t(s,a));return new t(r,a.slice(r-s,n-s))};return t}();var yd=function(){function t(t,e,r,n,i){this.text=t;this.to=i;this.done=false;this.value=pd;this.matchPos=n;this.re=new RegExp(e,dd+((r===null||r===void 0?void 0:r.ignoreCase)?"i":""));this.flat=md.get(t,n,this.chunkEnd(n+5e3))}t.prototype.chunkEnd=function(t){return t>=this.to?this.to:this.text.lineAt(t).to};t.prototype.next=function(){for(;;){var t=this.re.lastIndex=this.matchPos-this.flat.from;var e=this.re.exec(this.flat.text);if(e&&!e[0]&&e.index==t){this.re.lastIndex=t+1;e=this.re.exec(this.flat.text)}if(e&&this.flat.to<this.to&&e.index+e[0].length>this.flat.text.length-10)e=null;if(e){var r=this.flat.from+e.index,n=r+e[0].length;this.value={from:r,to:n,match:e};this.matchPos=n+(r==n?1:0);return this}else{if(this.flat.to==this.to){this.done=true;return this}this.flat=md.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};return t}();if(typeof Symbol!="undefined"){vd.prototype[Symbol.iterator]=yd.prototype[Symbol.iterator]=function(){return this}}function bd(t){try{return true}catch(e){return false}}function wd(t){var e=ud("input",{class:"cm-textfield",name:"line"});var r=ud("form",{class:"cm-gotoLine",onkeydown:function(e){if(e.keyCode==27){e.preventDefault();t.dispatch({effects:xd.of(false)});t.focus()}else if(e.keyCode==13){e.preventDefault();n()}},onsubmit:function(t){t.preventDefault();n()}},ud("label",t.state.phrase("Go to line"),": ",e)," ",ud("button",{class:"cm-button",type:"submit"},t.state.phrase("go")));function n(){var r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(e.value);if(!r)return;var n=t.state,i=n.doc.lineAt(n.selection.main.head);var o=r[1],a=r[2],s=r[3],f=r[4];var u=s?+s.slice(1):0;var l=a?+a:i.number;if(a&&f){var c=l/100;if(o)c=c*(o=="-"?-1:1)+i.number/n.doc.lines;l=Math.round(n.doc.lines*c)}else if(a&&o){l=l*(o=="-"?-1:1)+i.number}var h=n.doc.line(Math.max(1,Math.min(n.doc.lines,l)));t.dispatch({effects:xd.of(false),selection:G.cursor(h.from+Math.max(0,Math.min(u,h.length))),scrollIntoView:true});t.focus()}return{dom:r,pos:-10}}var xd=St.define();var kd=rt.define({create:function(){return true},update:function(t,e){for(var r=0,n=e.effects;r<n.length;r++){var i=n[r];if(i.is(xd))t=i.value}return t},provide:function(t){return fd.from(t,(function(t){return t?wd:null}))}});var Sd=function(t){var e=nd(t,wd);if(!e){var r=[xd.of(true)];if(t.state.field(kd,false)==null)r.push(St.appendConfig.of([kd,Cd]));t.dispatch({effects:r});e=nd(t,wd)}if(e)e.dom.querySelector("input").focus();return true};var Cd=Eo.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}});var Ad=function(t){var e=t.state,r=t.dispatch;var n=e.selection;var i=G.create(n.ranges.map((function(t){return e.wordAt(t.head)||G.cursor(t.head)})),n.mainIndex);if(i.eq(n))return false;r(e.update({selection:i}));return true};function Od(t,e){var r=t.selection,n=r.main,i=r.ranges;var o=t.wordAt(n.head),a=o&&o.from==n.from&&o.to==n.to;var s=function(r,n){n.next();if(n.done){if(r)return{value:null};n=new hd(t.doc,e,0,Math.max(0,i[i.length-1].from-1));r=true}else{if(r&&i.some((function(t){return t.from==n.value.from})))return f=r,u=n,"continue";if(a){var o=t.wordAt(n.value.from);if(!o||o.from!=n.value.from||o.to!=n.value.to)return f=r,u=n,"continue"}return{value:n.value}}f=r;u=n};var f,u;for(var l=false,c=new hd(t.doc,e,i[i.length-1].to);;){var h=s(l,c);l=f;c=u;if(typeof h==="object")return h.value}}var Md=function(t){var e=t.state,r=t.dispatch;var n=e.selection.ranges;if(n.some((function(t){return t.from===t.to})))return Ad({state:e,dispatch:r});var i=e.sliceDoc(n[0].from,n[0].to);if(e.selection.ranges.some((function(t){return e.sliceDoc(t.from,t.to)!=i})))return false;var o=Od(e,i);if(!o)return false;r(e.update({selection:e.selection.addRange(G.range(o.from,o.to),false),effects:Eo.scrollIntoView(o.to)}));return true};var Dd=Y.define({combine:function(t){var e;return{top:t.reduce((function(t,e){return t!==null&&t!==void 0?t:e.top}),undefined)||false,caseSensitive:t.reduce((function(t,e){return t!==null&&t!==void 0?t:e.caseSensitive||e.matchCase}),undefined)||false,createPanel:((e=t.find((function(t){return t.createPanel})))===null||e===void 0?void 0:e.createPanel)||function(t){return new ev(t)}}}});function Pd(t){return t?[Dd.of(t),sv]:sv}var Td=function(){function t(t){this.search=t.search;this.caseSensitive=!!t.caseSensitive;this.regexp=!!t.regexp;this.replace=t.replace||"";this.valid=!!this.search&&(!this.regexp||bd());this.unquoted=this.search.replace(/\\([nrt\\])/g,(function(t,e){return e=="n"?"\n":e=="r"?"\r":e=="t"?"\t":"\\"}))}t.prototype.eq=function(t){return this.search==t.search&&this.replace==t.replace&&this.caseSensitive==t.caseSensitive&&this.regexp==t.regexp};t.prototype.create=function(){return this.regexp?new Id(this):new Ld(this)};t.prototype.getCursor=function(t,e,r){if(e===void 0){e=0}if(r===void 0){r=t.length}return this.regexp?Bd(this,t,e,r):Rd(this,t,e,r)};return t}();var Ed=function(){function t(t){this.spec=t}return t}();function Rd(t,e,r,n){return new hd(e,t.unquoted,r,n,t.caseSensitive?undefined:function(t){return t.toLowerCase()})}var Ld=function(t){__extends(e,t);function e(e){return t.call(this,e)||this}e.prototype.nextMatch=function(t,e,r){var n=Rd(this.spec,t,r,t.length).nextOverlapping();if(n.done)n=Rd(this.spec,t,0,e).nextOverlapping();return n.done?null:n.value};e.prototype.prevMatchInRange=function(t,e,r){for(var n=r;;){var i=Math.max(e,n-1e4-this.spec.unquoted.length);var o=Rd(this.spec,t,i,n),a=null;while(!o.nextOverlapping().done)a=o.value;if(a)return a;if(i==e)return null;n-=1e4}};e.prototype.prevMatch=function(t,e,r){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,r,t.length)};e.prototype.getReplacement=function(t){return this.spec.replace};e.prototype.matchAll=function(t,e){var r=Rd(this.spec,t,0,t.length),n=[];while(!r.next().done){if(n.length>=e)return null;n.push(r.value)}return n};e.prototype.highlight=function(t,e,r,n){var i=Rd(this.spec,t,Math.max(0,e-this.spec.unquoted.length),Math.min(r+this.spec.unquoted.length,t.length));while(!i.next().done)n(i.value.from,i.value.to)};return e}(Ed);function Bd(t,e,r,n){return new vd(e,t.search,t.caseSensitive?undefined:{ignoreCase:true},r,n)}var Id=function(t){__extends(e,t);function e(){return t!==null&&t.apply(this,arguments)||this}e.prototype.nextMatch=function(t,e,r){var n=Bd(this.spec,t,r,t.length).next();if(n.done)n=Bd(this.spec,t,0,e).next();return n.done?null:n.value};e.prototype.prevMatchInRange=function(t,e,r){for(var n=1;;n++){var i=Math.max(e,r-n*1e4);var o=Bd(this.spec,t,i,r),a=null;while(!o.next().done)a=o.value;if(a&&(i==e||a.from>i+10))return a;if(i==e)return null}};e.prototype.prevMatch=function(t,e,r){return this.prevMatchInRange(t,0,e)||this.prevMatchInRange(t,r,t.length)};e.prototype.getReplacement=function(t){return this.spec.replace.replace(/\$([$&\d+])/g,(function(e,r){return r=="$"?"$":r=="&"?t.match[0]:r!="0"&&+r<t.match.length?t.match[r]:e}))};e.prototype.matchAll=function(t,e){var r=Bd(this.spec,t,0,t.length),n=[];while(!r.next().done){if(n.length>=e)return null;n.push(r.value)}return n};e.prototype.highlight=function(t,e,r,n){var i=Bd(this.spec,t,Math.max(0,e-250),Math.min(r+250,t.length));while(!i.next().done)n(i.value.from,i.value.to)};return e}(Ed);var Nd=St.define();var jd=St.define();var _d=rt.define({create:function(t){return new Vd(Xd(t).create(),null)},update:function(t,e){for(var r=0,n=e.effects;r<n.length;r++){var i=n[r];if(i.is(Nd))t=new Vd(i.value.create(),t.panel);else if(i.is(jd))t=new Vd(t.query,i.value?Yd:null)}return t},provide:function(t){return fd.from(t,(function(t){return t.panel}))}});var Vd=function(){function t(t,e){this.query=t;this.panel=e}return t}();var Hd=Ar.mark({class:"cm-searchMatch"}),Fd=Ar.mark({class:"cm-searchMatch cm-searchMatch-selected"});var zd=tn.fromClass(function(){function t(t){this.view=t;this.decorations=this.highlight(t.state.field(_d))}t.prototype.update=function(t){var e=t.state.field(_d);if(e!=t.startState.field(_d)||t.docChanged||t.selectionSet||t.viewportChanged)this.decorations=this.highlight(e)};t.prototype.highlight=function(t){var e=t.query,r=t.panel;if(!r||!e.spec.valid)return Ar.none;var n=this.view;var i=new Zt;for(var o=0,a=n.visibleRanges,s=a.length;o<s;o++){var f=a[o],u=f.from,l=f.to;while(o<s-1&&l>a[o+1].from-2*250)l=a[++o].to;e.highlight(n.state.doc,u,l,(function(t,e){var r=n.state.selection.ranges.some((function(r){return r.from==t&&r.to==e}));i.add(t,e,r?Fd:Hd)}))}return i.finish()};return t}(),{decorations:function(t){return t.decorations}});function Wd(t){return function(e){var r=e.state.field(_d,false);return r&&r.query.spec.valid?t(e,r):Qd(e)}}var qd=Wd((function(t,e){var r=e.query;var n=t.state.selection.main,i=n.from,o=n.to;var a=r.nextMatch(t.state.doc,i,o);if(!a||a.from==i&&a.to==o)return false;t.dispatch({selection:{anchor:a.from,head:a.to},scrollIntoView:true,effects:ov(t,a),userEvent:"select.search"});return true}));var Ud=Wd((function(t,e){var r=e.query;var n=t.state,i=n.selection.main,o=i.from,a=i.to;var s=r.prevMatch(n.doc,o,a);if(!s)return false;t.dispatch({selection:{anchor:s.from,head:s.to},scrollIntoView:true,effects:ov(t,s),userEvent:"select.search"});return true}));var Gd=Wd((function(t,e){var r=e.query;var n=r.matchAll(t.state.doc,1e3);if(!n||!n.length)return false;t.dispatch({selection:G.create(n.map((function(t){return G.range(t.from,t.to)}))),userEvent:"select.search.matches"});return true}));var Kd=function(t){var e=t.state,r=t.dispatch;var n=e.selection;if(n.ranges.length>1||n.main.empty)return false;var i=n.main,o=i.from,a=i.to;var s=[],f=0;for(var u=new hd(e.doc,e.sliceDoc(o,a));!u.next().done;){if(s.length>1e3)return false;if(u.value.from==o)f=s.length;s.push(G.range(u.value.from,u.value.to))}r(e.update({selection:G.create(s,f),userEvent:"select.search.matches"}));return true};var Jd=Wd((function(t,e){var r=e.query;var n=t.state,i=n.selection.main,o=i.from,a=i.to;if(n.readOnly)return false;var s=r.nextMatch(n.doc,o,o);if(!s)return false;var f=[],u,l;if(s.from==o&&s.to==a){l=n.toText(r.getReplacement(s));f.push({from:s.from,to:s.to,insert:l});s=r.nextMatch(n.doc,s.from,s.to)}if(s){var c=f.length==0||f[0].from>=s.to?0:s.to-s.from-l.length;u={anchor:s.from-c,head:s.to-c}}t.dispatch({changes:f,selection:u,scrollIntoView:!!u,effects:s?ov(t,s):undefined,userEvent:"input.replace"});return true}));var $d=Wd((function(t,e){var r=e.query;if(t.state.readOnly)return false;var n=r.matchAll(t.state.doc,1e9).map((function(t){var e=t.from,n=t.to;return{from:e,to:n,insert:r.getReplacement(t)}}));if(!n.length)return false;t.dispatch({changes:n,userEvent:"input.replace.all"});return true}));function Yd(t){return t.state.facet(Dd).createPanel(t)}function Xd(t,e){var r;var n=t.selection.main;var i=n.empty||n.to>n.from+100?"":t.sliceDoc(n.from,n.to);var o=(r=e===null||e===void 0?void 0:e.caseSensitive)!==null&&r!==void 0?r:t.facet(Dd).caseSensitive;return e&&!i?e:new Td({search:i.replace(/\n/g,"\\n"),caseSensitive:o})}var Qd=function(t){var e=t.state.field(_d,false);if(e&&e.panel){var r=nd(t,Yd);if(!r)return false;var n=r.dom.querySelector("[name=search]");if(n!=t.root.activeElement){var i=Xd(t.state,e.query.spec);if(i.valid)t.dispatch({effects:Nd.of(i)});n.focus();n.select()}}else{t.dispatch({effects:[jd.of(true),e?Nd.of(Xd(t.state,e.query.spec)):St.appendConfig.of(sv)]})}return true};var Zd=function(t){var e=t.state.field(_d,false);if(!e||!e.panel)return false;var r=nd(t,Yd);if(r&&r.dom.contains(t.root.activeElement))t.focus();t.dispatch({effects:jd.of(false)});return true};var tv=[{key:"Mod-f",run:Qd,scope:"editor search-panel"},{key:"F3",run:qd,shift:Ud,scope:"editor search-panel",preventDefault:true},{key:"Mod-g",run:qd,shift:Ud,scope:"editor search-panel",preventDefault:true},{key:"Escape",run:Zd,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Kd},{key:"Alt-g",run:Sd},{key:"Mod-d",run:Md,preventDefault:true}];var ev=function(){function t(t){var e=this;this.view=t;var r=this.query=t.state.field(_d).query.spec;this.commit=this.commit.bind(this);this.searchField=ud("input",{value:r.search,placeholder:rv(t,"Find"),"aria-label":rv(t,"Find"),class:"cm-textfield",name:"search",onchange:this.commit,onkeyup:this.commit});this.replaceField=ud("input",{value:r.replace,placeholder:rv(t,"Replace"),"aria-label":rv(t,"Replace"),class:"cm-textfield",name:"replace",onchange:this.commit,onkeyup:this.commit});this.caseField=ud("input",{type:"checkbox",name:"case",checked:r.caseSensitive,onchange:this.commit});this.reField=ud("input",{type:"checkbox",name:"re",checked:r.regexp,onchange:this.commit});function n(t,e,r){return ud("button",{class:"cm-button",name:t,onclick:e,type:"button"},r)}this.dom=ud("div",{onkeydown:function(t){return e.keydown(t)},class:"cm-search"},__spreadArray([this.searchField,n("next",(function(){return qd(t)}),[rv(t,"next")]),n("prev",(function(){return Ud(t)}),[rv(t,"previous")]),n("select",(function(){return Gd(t)}),[rv(t,"all")]),ud("label",null,[this.caseField,rv(t,"match case")]),ud("label",null,[this.reField,rv(t,"regexp")])],t.state.readOnly?[]:[ud("br"),this.replaceField,n("replace",(function(){return Jd(t)}),[rv(t,"replace")]),n("replaceAll",(function(){return $d(t)}),[rv(t,"replace all")]),ud("button",{name:"close",onclick:function(){return Zd(t)},"aria-label":rv(t,"close"),type:"button"},["×"])],true))}t.prototype.commit=function(){var t=new Td({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,replace:this.replaceField.value});if(!t.eq(this.query)){this.query=t;this.view.dispatch({effects:Nd.of(t)})}};t.prototype.keydown=function(t){if(qo(this.view,t,"search-panel")){t.preventDefault()}else if(t.keyCode==13&&t.target==this.searchField){t.preventDefault();(t.shiftKey?Ud:qd)(this.view)}else if(t.keyCode==13&&t.target==this.replaceField){t.preventDefault();Jd(this.view)}};t.prototype.update=function(t){for(var e=0,r=t.transactions;e<r.length;e++){var n=r[e];for(var i=0,o=n.effects;i<o.length;i++){var a=o[i];if(a.is(Nd)&&!a.value.eq(this.query))this.setQuery(a.value)}}};t.prototype.setQuery=function(t){this.query=t;this.searchField.value=t.search;this.replaceField.value=t.replace;this.caseField.checked=t.caseSensitive;this.reField.checked=t.regexp};t.prototype.mount=function(){this.searchField.select()};Object.defineProperty(t.prototype,"pos",{get:function(){return 80},enumerable:false,configurable:true});Object.defineProperty(t.prototype,"top",{get:function(){return this.view.state.facet(Dd).top},enumerable:false,configurable:true});return t}();function rv(t,e){return t.state.phrase(e)}var nv=30;var iv=/[\s\.,:;?!]/;function ov(t,e){var r=e.from,n=e.to;var i=t.state.doc.lineAt(r).from,o=t.state.doc.lineAt(n).to;var a=Math.max(i,r-nv),s=Math.min(o,n+nv);var f=t.state.sliceDoc(a,s);if(a!=i){for(var u=0;u<nv;u++)if(!iv.test(f[u+1])&&iv.test(f[u])){f=f.slice(u);break}}if(s!=o){for(var l=f.length-1;l>f.length-nv;l--)if(!iv.test(f[l-1])&&iv.test(f[l])){f=f.slice(0,l);break}}return Eo.announce.of("".concat(t.state.phrase("current match"),". ").concat(f," ").concat(t.state.phrase("on line")," ").concat(t.state.doc.lineAt(r).number))}var av=Eo.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}});var sv=[_d,ot.lowest(zd),av];var fv=function(t){var e=f(t.activeLanguage);var n=Object.keys(t.executableLanguages).length>0;var i=n?Object.entries(t.languageCapabilities).reduce((function(e,r){var n;var i=r[0],o=r[1];return Object.keys(t.executableLanguages).includes(i)?e:Object.assign(Object.assign({},e),(n={},n[i]=o,n))}),{}):t.languageCapabilities;return r("label",{"aria-label":"Programming Language"},r("stencila-icon",{icon:"terminal"}),r("select",{onChange:t.onSetLanguage,ref:t.setRef,disabled:t.disabled},n&&Object.values(t.executableLanguages).map((function(t){return r("option",{value:t.name,selected:t.name===e.name},t.name)})),r("option",{disabled:true},"Not executable"),Object.values(i).map((function(t){return r("option",{value:t.name,selected:t.name===e.name},t.name)}))))};var uv=St.define();var lv=function(){var t=document.createElement("div");var e=false;var r=function(r){if(r){t.appendChild(r);e=true}};return{dom:t,update:function(t){for(var n=0,i=t.transactions;n<i.length;n++){var o=i[n];for(var a=0,s=o.effects;a<s.length;a++){var f=s[a];if(f.is(uv)){if(!e&&f.value.slotRef){r(f.value.slotRef)}}}}}}};var cv=function(){return fd.of(lv)};var hv=function(t){return Eo.updateListener.of((function(e){if(e.docChanged){t(e)}}))};var pv="*.sc-stencila-editor-default,.sc-stencila-editor-default:after,.sc-stencila-editor-default:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-editor-default{font-size:16px}.hidden.sc-stencila-editor-default{display:none}.sc-stencila-editor-default-h,stencila-editor.sc-stencila-editor-default{--gutter-background:var(\n    --color-background,var(--color-neutral-50,#e9eaf1)\n  );--gutter-color:var(--color-neutral-500,#6e7591);--border-width:1px;--background-color:transparent;all:initial;display:-ms-flexbox;display:flex;max-width:100%}.sc-stencila-editor-default-h .editorContainer.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default .editorContainer.sc-stencila-editor-default{background-color:var(--background-color);border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;border-width:1px;border-width:var(--border-width);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;max-width:100%}.sc-stencila-editor-default-h .editorContainer.sc-stencila-editor-default:focus-within,stencila-editor.sc-stencila-editor-default .editorContainer.sc-stencila-editor-default:focus-within{-webkit-box-shadow:inset 0 0 0 2px var(--color-neutral-200);box-shadow:inset 0 0 0 2px var(--color-neutral-200)}.sc-stencila-editor-default-h .editor.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default .editor.sc-stencila-editor-default{cursor:text;-ms-flex-positive:1;flex-grow:1;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;max-width:100%;overflow:auto}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-editor,.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-editor *,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-editor *{font-family:monospace;font-family:var(--font-family-mono,monospace)}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-editor{line-height:1.5}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .codemirror-focused,stencila-editor.sc-stencila-editor-default-s>.editorContainer .codemirror-focused{outline:2px solid transparent;outline-offset:2px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .codemirror-scroller,stencila-editor.sc-stencila-editor-default-s>.editorContainer .codemirror-scroller{overflow:auto}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-gutters,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-gutters{background-color:var(--gutter-background);color:var(--gutter-color)}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li{font-size:90%;padding-bottom:2px;padding-top:2px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer .cm-completionIcon,stencila-editor.sc-stencila-editor-default-s>.editorContainer .cm-completionIcon{min-width:1.375em;min-width:2ch}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer stencila-code-error,stencila-editor.sc-stencila-editor-default-s>.editorContainer stencila-code-error{border-bottom-style:solid;border-radius:0;border-width:0 0 1px}.sc-stencila-editor-default-h.sc-stencila-editor-default-s>.editorContainer stencila-code-error:last-of-type,stencila-editor.sc-stencila-editor-default-s>.editorContainer stencila-code-error:last-of-type{border-bottom-width:0}.sc-stencila-editor-default-h menu.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default{border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-top-width:1px;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin:0;padding:1px 0}.sc-stencila-editor-default-h menu.sc-stencila-editor-default stencila-icon.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default stencila-icon.sc-stencila-editor-default{--height:1em;--width:1em;margin-right:.25rem}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-style:none;color:#444a5e;color:var(--color-neutral-700,#444a5e);font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.75rem;line-height:1rem;margin-right:.5rem;text-align:left}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default option.sc-stencila-editor-default,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default option.sc-stencila-editor-default{font-family:sans-serif;font-family:var(--font-family-body,sans-serif);text-align:right}.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:active,.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:focus,.sc-stencila-editor-default-h menu.sc-stencila-editor-default select.sc-stencila-editor-default:hover,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:active,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:focus,stencila-editor.sc-stencila-editor-default menu.sc-stencila-editor-default select.sc-stencila-editor-default:hover{color:#1f212a;color:var(--color-neutral-900,#1f212a)}";var dv="*.sc-stencila-editor-material,.sc-stencila-editor-material:after,.sc-stencila-editor-material:before{border:0 solid;-webkit-box-sizing:border-box;box-sizing:border-box}html.sc-stencila-editor-material{font-size:16px}.hidden.sc-stencila-editor-material{display:none}.sc-stencila-editor-material-h,stencila-editor.sc-stencila-editor-material{--gutter-background:var(\n    --color-background,var(--color-neutral-50,#e9eaf1)\n  );--gutter-color:var(--color-neutral-500,#6e7591);--border-width:1px;--background-color:transparent;all:initial;display:-ms-flexbox;display:flex;max-width:100%}.sc-stencila-editor-material-h .editorContainer.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material .editorContainer.sc-stencila-editor-material{background-color:var(--background-color);border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-radius:.25rem;border-width:1px;border-width:var(--border-width);display:-ms-flexbox;display:flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-positive:1;flex-grow:1;max-width:100%}.sc-stencila-editor-material-h .editorContainer.sc-stencila-editor-material:focus-within,stencila-editor.sc-stencila-editor-material .editorContainer.sc-stencila-editor-material:focus-within{-webkit-box-shadow:inset 0 0 0 2px var(--color-neutral-200);box-shadow:inset 0 0 0 2px var(--color-neutral-200)}.sc-stencila-editor-material-h .editor.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material .editor.sc-stencila-editor-material{cursor:text;-ms-flex-positive:1;flex-grow:1;font-family:monospace;font-family:var(--font-family-mono,monospace);font-size:.875rem;line-height:1.25rem;max-width:100%;overflow:auto}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-editor,.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-editor *,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-editor *{font-family:monospace;font-family:var(--font-family-mono,monospace)}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-editor,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-editor{line-height:1.5}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .codemirror-focused,stencila-editor.sc-stencila-editor-material-s>.editorContainer .codemirror-focused{outline:2px solid transparent;outline-offset:2px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .codemirror-scroller,stencila-editor.sc-stencila-editor-material-s>.editorContainer .codemirror-scroller{overflow:auto}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-gutters,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-gutters{background-color:var(--gutter-background);color:var(--gutter-color)}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-tooltip.cm-tooltip-autocomplete>ul>li{font-size:90%;padding-bottom:2px;padding-top:2px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer .cm-completionIcon,stencila-editor.sc-stencila-editor-material-s>.editorContainer .cm-completionIcon{min-width:1.375em;min-width:2ch}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer stencila-code-error,stencila-editor.sc-stencila-editor-material-s>.editorContainer stencila-code-error{border-bottom-style:solid;border-radius:0;border-width:0 0 1px}.sc-stencila-editor-material-h.sc-stencila-editor-material-s>.editorContainer stencila-code-error:last-of-type,stencila-editor.sc-stencila-editor-material-s>.editorContainer stencila-code-error:last-of-type{border-bottom-width:0}.sc-stencila-editor-material-h menu.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material{border-color:#cfd2e1;border-color:var(--color-neutral-100,#cfd2e1);border-top-width:1px;display:-ms-flexbox;display:flex;-ms-flex-pack:end;justify-content:flex-end;margin:0;padding:1px 0}.sc-stencila-editor-material-h menu.sc-stencila-editor-material stencila-icon.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material stencila-icon.sc-stencila-editor-material{--height:1em;--width:1em;margin-right:.25rem}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-style:none;color:#444a5e;color:var(--color-neutral-700,#444a5e);font-family:sans-serif;font-family:var(--font-family-body,sans-serif);font-size:.75rem;line-height:1rem;margin-right:.5rem;text-align:left}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material option.sc-stencila-editor-material,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material option.sc-stencila-editor-material{font-family:sans-serif;font-family:var(--font-family-body,sans-serif);text-align:right}.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:active,.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:focus,.sc-stencila-editor-material-h menu.sc-stencila-editor-material select.sc-stencila-editor-material:hover,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:active,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:focus,stencila-editor.sc-stencila-editor-material menu.sc-stencila-editor-material select.sc-stencila-editor-material:hover{color:#1f212a;color:var(--color-neutral-900,#1f212a)}";var vv={text:"text",errors:"errors"};var gv={container:"editorContainer",editor:"editor"};var mv={editorTarget:"editorTarget"};var yv=t("A",function(){function t(t){var r=this;n(this,t);this.languageChange=i(this,"stencila-language-change",7);this.contentChange=i(this,"stencila-content-change",7);var o,a,l,c;this.isReady=false;this.isUpdatingContent=false;this.languageCapabilities=u;this.executableLanguages=(a=(o=window.stencilaWebClient)===null||o===void 0?void 0:o.executableLanguages)!==null&&a!==void 0?a:{};this.readOnly=false;this.readOnlyConf=new st;this.activeLanguage=(c=(l=this.languageCapabilities.R)===null||l===void 0?void 0:l.name)!==null&&c!==void 0?c:"";this.dispatchEffect=function(t){var e,n,i;var o=(e=r.editorRef)===null||e===void 0?void 0:e.state;var a=(n=o===null||o===void 0?void 0:o.update({effects:[t]}))!==null&&n!==void 0?n:{};(i=r.editorRef)===null||i===void 0?void 0:i.dispatch(a)};this.getLang=function(t){return __awaiter(r,void 0,void 0,(function(){var r,n,i,n,o,n,a,n,s,n,u,l,c,c,h,p,d,n,v,g,n,v,g,m;return __generator(this,(function(y){switch(y.label){case 0:r=f(t).name.toLowerCase();switch(r){case"bash":return[3,1];case"zsh":return[3,1];case"latex":return[3,4];case"toml":return[3,7];case"yaml":return[3,10];case"dockerfile":return[3,13];case"html":return[3,16];case"javascript":return[3,18];case"typescript":return[3,20];case"json":return[3,22];case"xml":return[3,24];case"calc":return[3,26];case"python":return[3,26];case"r":return[3,28];case"rmd":return[3,31];case"md":return[3,35];case"markdown":return[3,35];case"sql":return[3,37]}return[3,35];case 1:return[4,e.import("./p-70c2ffc3.system.js")];case 2:n=y.sent().StreamLanguage;return[4,e.import("./p-0be539b4.system.js")];case 3:i=y.sent().shell;return[2,n.define(i)];case 4:return[4,e.import("./p-70c2ffc3.system.js")];case 5:n=y.sent().StreamLanguage;return[4,e.import("./p-ac5f05e4.system.js")];case 6:o=y.sent().stexMath;return[2,n.define(o)];case 7:return[4,e.import("./p-70c2ffc3.system.js")];case 8:n=y.sent().StreamLanguage;return[4,e.import("./p-422e937f.system.js")];case 9:a=y.sent().toml;return[2,n.define(a)];case 10:return[4,e.import("./p-70c2ffc3.system.js")];case 11:n=y.sent().StreamLanguage;return[4,e.import("./p-0e30c4c3.system.js")];case 12:s=y.sent().yaml;return[2,n.define(s)];case 13:return[4,e.import("./p-70c2ffc3.system.js")];case 14:n=y.sent().StreamLanguage;return[4,e.import("./p-4f3ec02d.system.js")];case 15:u=y.sent().dockerFile;return[2,n.define(u)];case 16:return[4,e.import("./p-3805cf1f.system.js")];case 17:l=y.sent().html;return[2,l()];case 18:return[4,e.import("./p-450f0050.system.js")];case 19:c=y.sent().javascript;return[2,c()];case 20:return[4,e.import("./p-450f0050.system.js")];case 21:c=y.sent().javascript;return[2,c({typescript:true})];case 22:return[4,e.import("./p-665b8722.system.js")];case 23:h=y.sent().json;return[2,h()];case 24:return[4,e.import("./p-f2626432.system.js")];case 25:p=y.sent().xml;return[2,p()];case 26:return[4,e.import("./p-59b89f1f.system.js")];case 27:d=y.sent().python;return[2,d()];case 28:return[4,e.import("./p-70c2ffc3.system.js")];case 29:n=y.sent().StreamLanguage;return[4,e.import("./p-7b82c96c.system.js")];case 30:v=y.sent().r;return[2,n.define(v)];case 31:return[4,e.import("./p-e841e0da.system.js")];case 32:g=y.sent().markdown;return[4,e.import("./p-70c2ffc3.system.js")];case 33:n=y.sent().StreamLanguage;return[4,e.import("./p-7b82c96c.system.js")];case 34:v=y.sent().r;return[2,g({defaultCodeLanguage:n.define(v)})];case 35:return[4,e.import("./p-e841e0da.system.js")];case 36:g=y.sent().markdown;return[2,g()];case 37:return[4,e.import("./p-0a5b5af9.system.js")];case 38:m=y.sent().sql;return[2,m()]}}))}))};this.languageConf=new st;this.setEditorSyntax=function(t){return __awaiter(r,void 0,void 0,(function(){var e;return __generator(this,(function(r){switch(r.label){case 0:return[4,this.getLang(t)];case 1:e=r.sent();this.dispatchEffect(this.languageConf.reconfigure(e));return[2]}}))}))};this.setLanguagePickerRef=function(t){return r.languagePickerRef=t};this.onSelectLanguage=function(t){return __awaiter(r,void 0,void 0,(function(){var e,r;return __generator(this,(function(n){e=t.currentTarget;r=f(e.value);this.languageChange.emit(r);return[2,this.setEditorSyntax(r.name)]}))}))};this.execute=function(){r.getContents().then((function(t){return r.executeHandler?r.executeHandler(t):t})).catch((function(t){console.error(t);return false}));return true};this.autofocus=false;this.lineNumbersConf=new st;this.lineNumbers=true;this.lineWrappingConf=new st;this.lineWrapping=false;this.foldGutterConf=new st;this.foldGutter=true;this.keymap=[];this.setErrors=function(){var t;(t=r.editorRef)===null||t===void 0?void 0:t.dispatch({effects:uv.of({slotRef:r.errorsSlot})})};this.getCodeMirrorConfig=function(t){if(t===void 0){t={}}return __awaiter(r,void 0,void 0,(function(){var e,r,n,i,o,a,s;var f=this;return __generator(this,(function(u){switch(u.label){case 0:e=Object.assign({language:this.activeLanguage,foldGutterEnabled:this.foldGutter,lineNumbersEnabled:this.lineNumbers,lineWrappingEnabled:this.lineWrapping},t),r=e.language,n=e.foldGutterEnabled,i=e.lineNumbersEnabled,o=e.lineWrappingEnabled;return[4,this.getLang(r)];case 1:a=u.sent();s=[Ip(),Tu(),_t.languageData.of((function(){return[{autocomplete:Pu}]})),ul(),_u(),ot.fallback(Dp),this.languageConf.of(a),this.lineWrappingConf.of(o?Eo.lineWrapping:[]),this.lineNumbersConf.of(i?Sh():[]),this.foldGutterConf.of(n?Uh():[]),Xo(),_t.allowMultipleSelections.of(true),Pd({top:true}),ga(),Fo.of(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray(__spreadArray([],this.keymap,true),Yc,true),Uu,true),ed,true),_h,true),tv,true),[{key:"Ctrl-Space",run:$f},{key:"Ctrl-Enter",run:this.execute}],false),qc,true)),this.readOnlyConf.of(Eo.editable.of(!this.readOnly)),cv(),hv((function(t){var e;(e=f.contentChangeHandler)===null||e===void 0?void 0:e.call(f,t);if(!f.isUpdatingContent){f.contentChange.emit(t)}}))];return[2,s]}}))}))};this.initCodeMirror=function(){return __awaiter(r,void 0,void 0,(function(){var t,e,r,n,i,o,a,f,u;var l,c;return __generator(this,(function(h){switch(h.label){case 0:r=this.el;n=s(r)(vv.text)[0];i=(e=(t=this.contents)!==null&&t!==void 0?t:n===null||n===void 0?void 0:n.textContent)!==null&&e!==void 0?e:"";o=this;a=Eo.bind;l={};u=(f=_t).create;c={doc:i};return[4,this.getCodeMirrorConfig()];case 1:o.editorRef=new(a.apply(Eo,[void 0,(l.state=u.apply(f,[(c.extensions=h.sent(),c)]),l)]));this.isReady=true;return[2]}}))}))};this.attachEditorToDom=function(){var t,e,n;var i=(t=r.editorRef)===null||t===void 0?void 0:t.dom;if(i){(n=(e=r.el)===null||e===void 0?void 0:e.querySelector("#".concat(mv.editorTarget)))===null||n===void 0?void 0:n.replaceWith(i)}};this.setContentsHandler=function(t){var e,n,i,o;r.isUpdatingContent=true;var a=(e=r.editorRef)===null||e===void 0?void 0:e.state;var s=(i=a===null||a===void 0?void 0:a.update({changes:{from:0,to:a.doc.length,insert:t},selection:(n=r.editorRef)===null||n===void 0?void 0:n.state.selection}))!==null&&i!==void 0?i:{};(o=r.editorRef)===null||o===void 0?void 0:o.dispatch(s);r.isUpdatingContent=false};this.textSlotObserver=new MutationObserver((function(){var t,e;var n=(e=(t=r.textSlot)===null||t===void 0?void 0:t.textContent)!==null&&e!==void 0?e:"";r.setContentsHandler(n)}));this.stopEventPropagation=function(t){t.stopPropagation()};this.focus=function(){var t;(t=r.editorRef)===null||t===void 0?void 0:t.focus()}}t.prototype.contentsChanged=function(t,e){if(t!==e){this.setContentsHandler(t)}};t.prototype.onDiscoverExecutableLanguages=function(t){var e=t.detail;this.executableLanguages=e.languages};t.prototype.readOnlyChanged=function(t,e){if(t!==e){this.dispatchEffect(this.readOnlyConf.reconfigure(Eo.editable.of(!this.readOnly)))}};t.prototype.activeLanguageChanged=function(t,e){if(t!==e){this.setEditorSyntax(t).catch((function(t){console.log(t)}))}};t.prototype.onSetLineNumbers=function(t,e){if(t!==e){this.dispatchEffect(this.lineNumbersConf.reconfigure(t?Sh():[]))}};t.prototype.onSetLineWrapping=function(t,e){if(t!==e){this.dispatchEffect(this.lineWrappingConf.reconfigure(t?Eo.lineWrapping:[]))}};t.prototype.onSetfoldGutter=function(t,e){if(t!==e){this.dispatchEffect(this.foldGutterConf.reconfigure(t?Uh():[]))}};t.prototype.getContents=function(){var t,e,r,n;return Promise.resolve({text:(e=(t=this.editorRef)===null||t===void 0?void 0:t.state.doc.toString())!==null&&e!==void 0?e:"",language:f((n=(r=this.languagePickerRef)===null||r===void 0?void 0:r.value)!==null&&n!==void 0?n:this.activeLanguage).name.toLowerCase()})};t.prototype.setContents=function(t){this.setContentsHandler(t);return Promise.resolve(t)};t.prototype.getState=function(){var t;return Promise.resolve((t=this.editorRef)===null||t===void 0?void 0:t.state.toJSON({history:Np}))};t.prototype.setState=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r,n,i,o,a,s;var f;return __generator(this,(function(u){switch(u.label){case 0:if(!((e=this.editorRef)===null||e===void 0))return[3,1];r=void 0;return[3,3];case 1:i=(n=e).setState;a=(o=_t).fromJSON;s=[t];f={};return[4,this.getCodeMirrorConfig()];case 2:r=i.apply(n,[a.apply(o,s.concat([(f.extensions=u.sent(),f),{history:Np}]))]);u.label=3;case 3:r;return[2]}}))}))};t.prototype.setStateFromString=function(t){return __awaiter(this,void 0,void 0,(function(){var e,r,n,i,o,a;var s;return __generator(this,(function(f){switch(f.label){case 0:if(!((e=this.editorRef)===null||e===void 0))return[3,1];r=void 0;return[3,3];case 1:i=(n=e).setState;a=(o=_t).create;s={doc:t};return[4,this.getCodeMirrorConfig()];case 2:r=i.apply(n,[a.apply(o,[(s.extensions=f.sent(),s)])]);f.label=3;case 3:r;return[2]}}))}))};t.prototype.getRef=function(){return __awaiter(this,void 0,void 0,(function(){var t=this;return __generator(this,(function(e){if(this.editorRef){return[2,this.editorRef]}return[2,new Promise((function(e,r){var n=true;var i=3e3;var o=setTimeout((function(){n=false}),i);var a=function(){setInterval((function(){if(t.editorRef&&t.isReady){clearTimeout(o);e(t.editorRef)}else if(!n){r(new Error("Editor wasn’t instantiated in time (".concat(i,"ms), please try again.")))}else{a()}}),100)};a()}))]}))}))};t.prototype.componentWillLoad=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){try{return[2,this.initCodeMirror()]}catch(e){console.log("Encountered error while initializing code editor\n",e)}return[2]}))}))};t.prototype.componentDidLoad=function(){this.attachEditorToDom();if(this.autofocus){this.focus()}if(this.textSlot){this.textSlotObserver.observe(this.textSlot,{childList:true,characterData:true,subtree:true})}if(this.errorsSlot){this.setErrors()}};t.prototype.disconnectedCallback=function(){var t;this.textSlotObserver.disconnect();(t=this.editorRef)===null||t===void 0?void 0:t.destroy()};t.prototype.render=function(){var t=this;return r(o,null,r("div",{class:gv.container},r("div",{class:gv.editor,onKeyDown:this.stopEventPropagation,onClick:this.focus},r("div",{class:"hidden",ref:function(e){return t.textSlot=e}},r("slot",{name:vv.text})),r("div",{ref:function(e){return t.errorsSlot=e}},r("slot",{name:vv.errors})),r("div",{id:mv.editorTarget})),r("menu",null,r(fv,{activeLanguage:this.activeLanguage,disabled:this.readOnly,onSetLanguage:this.onSelectLanguage,languageCapabilities:this.languageCapabilities,executableLanguages:this.executableLanguages,setRef:this.setLanguagePickerRef}))))};Object.defineProperty(t.prototype,"el",{get:function(){return a(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{contents:["contentsChanged"],readOnly:["readOnlyChanged"],activeLanguage:["activeLanguageChanged"],lineNumbers:["onSetLineNumbers"],lineWrapping:["onSetLineWrapping"],foldGutter:["onSetfoldGutter"]}},enumerable:false,configurable:true});return t}());yv.style={default:pv,material:dv}}}}));
//# sourceMappingURL=p-2e66c77c.system.js.map