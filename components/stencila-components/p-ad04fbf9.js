import{P as t,e as i,a as s,D as h,N as e,T as r}from"./p-39bf90d7.js";class l{constructor(t,i,s,h,e,r,l,n,f,u=0,o){this.p=t;this.stack=i;this.state=s;this.reducePos=h;this.pos=e;this.score=r;this.buffer=l;this.bufferBase=n;this.curContext=f;this.lookAhead=u;this.parent=o}toString(){return`[${this.stack.filter(((t,i)=>i%3==0)).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,i,s=0){let h=t.parser.context;return new l(t,[],i,s,s,0,[],0,h?new n(h,h.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,i){this.stack.push(this.state,i,this.bufferBase+this.buffer.length);this.state=t}reduce(t){let i=t>>19,s=t&65535;let{parser:h}=this.p;let e=h.dynamicPrecedence(s);if(e)this.score+=e;if(i==0){this.pushState(h.getGoto(this.state,s,true),this.reducePos);if(s<h.minRepeatTerm)this.storeNode(s,this.reducePos,this.reducePos,4,true);this.reduceContext(s,this.reducePos);return}let r=this.stack.length-(i-1)*3-(t&262144?6:0);let l=this.stack[r-2];let n=this.stack[r-1],f=this.bufferBase+this.buffer.length-n;if(s<h.minRepeatTerm||t&131072){let t=h.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(s,l,t,f+4,true)}if(t&262144){this.state=this.stack[r]}else{let t=this.stack[r-3];this.state=h.getGoto(t,s,true)}while(this.stack.length>r)this.stack.pop();this.reduceContext(s,l)}storeNode(t,i,s,h=4,e=false){if(t==0){let t=this,h=this.buffer.length;if(h==0&&t.parent){h=t.bufferBase-t.parent.bufferBase;t=t.parent}if(h>0&&t.buffer[h-4]==0&&t.buffer[h-1]>-1){if(i==s)return;if(t.buffer[h-2]>=i){t.buffer[h-2]=s;return}}}if(!e||this.pos==s){this.buffer.push(t,i,s,h)}else{let e=this.buffer.length;if(e>0&&this.buffer[e-4]!=0)while(e>0&&this.buffer[e-2]>s){this.buffer[e]=this.buffer[e-4];this.buffer[e+1]=this.buffer[e-3];this.buffer[e+2]=this.buffer[e-2];this.buffer[e+3]=this.buffer[e-1];e-=4;if(h>4)h-=4}this.buffer[e]=t;this.buffer[e+1]=i;this.buffer[e+2]=s;this.buffer[e+3]=h}}shift(t,i,s){let h=this.pos;if(t&131072){this.pushState(t&65535,this.pos)}else if((t&262144)==0){let e=t,{parser:r}=this.p;if(s>this.pos||i<=r.maxNode){this.pos=s;if(!r.stateFlag(e,1))this.reducePos=s}this.pushState(e,h);this.shiftContext(i,h);if(i<=r.maxNode)this.buffer.push(i,h,s,4)}else{this.pos=s;this.shiftContext(i,h);if(i<=this.p.parser.maxNode)this.buffer.push(i,h,s,4)}}apply(t,i,s){if(t&65536)this.reduce(t);else this.shift(t,i,s)}useNode(t,i){let s=this.p.reused.length-1;if(s<0||this.p.reused[s]!=t){this.p.reused.push(t);s++}let h=this.pos;this.reducePos=this.pos=h+t.length;this.pushState(i,h);this.buffer.push(s,h,this.reducePos,-1);if(this.curContext)this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this;let i=t.buffer.length;while(i>0&&t.buffer[i-2]>t.reducePos)i-=4;let s=t.buffer.slice(i),h=t.bufferBase+i;while(t&&h==t.bufferBase)t=t.parent;return new l(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,s,h,this.curContext,this.lookAhead,t)}recoverByDelete(t,i){let s=t<=this.p.parser.maxNode;if(s)this.storeNode(t,this.pos,i,4);this.storeNode(0,this.pos,i,s?8:4);this.pos=this.reducePos=i;this.score-=190}canShift(t){for(let i=new u(this);;){let s=this.p.parser.stateSlot(i.state,4)||this.p.parser.hasAction(i.state,t);if((s&65536)==0)return true;if(s==0)return false;i.reduce(s)}}recoverByInsert(t){if(this.stack.length>=300)return[];let i=this.p.parser.nextStates(this.state);if(i.length>4<<1||this.stack.length>=120){let s=[];for(let h=0,e;h<i.length;h+=2){if((e=i[h+1])!=this.state&&this.p.parser.hasAction(e,t))s.push(i[h],e)}if(this.stack.length<120)for(let t=0;s.length<4<<1&&t<i.length;t+=2){let h=i[t+1];if(!s.some(((t,i)=>i&1&&t==h)))s.push(i[t],h)}i=s}let s=[];for(let h=0;h<i.length&&s.length<4;h+=2){let t=i[h+1];if(t==this.state)continue;let e=this.split();e.storeNode(0,e.pos,e.pos,4,true);e.pushState(t,this.pos);e.shiftContext(i[h],this.pos);e.score-=200;s.push(e)}return s}forceReduce(){let t=this.p.parser.stateSlot(this.state,5);if((t&65536)==0)return false;let{parser:i}=this.p;if(!i.validAction(this.state,t)){let s=t>>19,h=t&65535;let e=this.stack.length-s*3;if(e<0||i.getGoto(this.stack[e],h,false)<0)return false;this.storeNode(0,this.reducePos,this.reducePos,4,true);this.score-=100}this.reduce(t);return true}forceAll(){while(!this.p.parser.stateFlag(this.state,2)){if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,true);break}}return this}get deadEnd(){if(this.stack.length!=3)return false;let{parser:t}=this.p;return t.data[t.stateSlot(this.state,1)]==65535&&!t.stateSlot(this.state,4)}restart(){this.state=this.stack[0];this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return false;for(let i=0;i<this.stack.length;i+=3)if(this.stack[i]!=t.stack[i])return false;return true}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,i){if(this.curContext)this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(i)))}reduceContext(t,i){if(this.curContext)this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(i)))}emitContext(){let t=this.buffer.length-1;if(t<0||this.buffer[t]!=-3)this.buffer.push(this.curContext.hash,this.reducePos,this.reducePos,-3)}emitLookAhead(){let t=this.buffer.length-1;if(t<0||this.buffer[t]!=-4)this.buffer.push(this.lookAhead,this.reducePos,this.reducePos,-4)}updateContext(t){if(t!=this.curContext.context){let i=new n(this.curContext.tracker,t);if(i.hash!=this.curContext.hash)this.emitContext();this.curContext=i}}setLookAhead(t){if(t>this.lookAhead){this.emitLookAhead();this.lookAhead=t}}close(){if(this.curContext&&this.curContext.tracker.strict)this.emitContext();if(this.lookAhead>0)this.emitLookAhead()}}class n{constructor(t,i){this.tracker=t;this.context=i;this.hash=t.strict?t.hash(i):0}}var f;(function(t){t[t["Insert"]=200]="Insert";t[t["Delete"]=190]="Delete";t[t["Reduce"]=100]="Reduce";t[t["MaxNext"]=4]="MaxNext";t[t["MaxInsertStackDepth"]=300]="MaxInsertStackDepth";t[t["DampenInsertStackDepth"]=120]="DampenInsertStackDepth"})(f||(f={}));class u{constructor(t){this.start=t;this.state=t.state;this.stack=t.stack;this.base=this.stack.length}reduce(t){let i=t&65535,s=t>>19;if(s==0){if(this.stack==this.start.stack)this.stack=this.stack.slice();this.stack.push(this.state,0,0);this.base+=3}else{this.base-=(s-1)*3}let h=this.start.p.parser.getGoto(this.stack[this.base-3],i,true);this.state=h}}class o{constructor(t,i,s){this.stack=t;this.pos=i;this.index=s;this.buffer=t.buffer;if(this.index==0)this.maybeNext()}static create(t,i=t.bufferBase+t.buffer.length){return new o(t,i,i-t.bufferBase)}maybeNext(){let t=this.stack.parent;if(t!=null){this.index=this.stack.bufferBase-t.bufferBase;this.stack=t;this.buffer=t.buffer}}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4;this.pos-=4;if(this.index==0)this.maybeNext()}fork(){return new o(this.stack,this.pos,this.index)}}class a{constructor(){this.start=-1;this.value=-1;this.end=-1;this.extended=-1;this.lookAhead=0;this.mask=0;this.context=0}}const c=new a;class d{constructor(t,i){this.input=t;this.ranges=i;this.chunk="";this.chunkOff=0;this.chunk2="";this.chunk2Pos=0;this.next=-1;this.token=c;this.rangeIndex=0;this.pos=this.chunkPos=i[0].from;this.range=i[0];this.end=i[i.length-1].to;this.readNext()}resolveOffset(t,i){let s=this.range,h=this.rangeIndex;let e=this.pos+t;while(e<s.from){if(!h)return null;let t=this.ranges[--h];e-=s.from-t.to;s=t}while(i<0?e>s.to:e>=s.to){if(h==this.ranges.length-1)return null;let t=this.ranges[++h];e+=t.from-s.to;s=t}return e}peek(t){let i=this.chunkOff+t,s,h;if(i>=0&&i<this.chunk.length){s=this.pos+t;h=this.chunk.charCodeAt(i)}else{let i=this.resolveOffset(t,1);if(i==null)return-1;s=i;if(s>=this.chunk2Pos&&s<this.chunk2Pos+this.chunk2.length){h=this.chunk2.charCodeAt(s-this.chunk2Pos)}else{let t=this.rangeIndex,i=this.range;while(i.to<=s)i=this.ranges[++t];this.chunk2=this.input.chunk(this.chunk2Pos=s);if(s+this.chunk2.length>i.to)this.chunk2=this.chunk2.slice(0,i.to-s);h=this.chunk2.charCodeAt(0)}}if(s>=this.token.lookAhead)this.token.lookAhead=s+1;return h}acceptToken(t,i=0){let s=i?this.resolveOffset(i,-1):this.pos;if(s==null||s<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t;this.token.end=s}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:i}=this;this.chunk=this.chunk2;this.chunkPos=this.chunk2Pos;this.chunk2=t;this.chunk2Pos=i;this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk;this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos);let i=this.pos+t.length;this.chunk=i>this.range.to?t.slice(0,this.range.to-this.pos):t;this.chunkPos=this.pos;this.chunkOff=0}}readNext(){if(this.chunkOff>=this.chunk.length){this.getChunk();if(this.chunkOff==this.chunk.length)return this.next=-1}return this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){this.chunkOff+=t;while(this.pos+t>=this.range.to){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos;this.range=this.ranges[++this.rangeIndex];this.pos=this.range.from}this.pos+=t;if(this.pos>=this.token.lookAhead)this.token.lookAhead=this.pos+1;return this.readNext()}setDone(){this.pos=this.chunkPos=this.end;this.range=this.ranges[this.rangeIndex=this.ranges.length-1];this.chunk="";return this.next=-1}reset(t,i){if(i){this.token=i;i.start=t;i.lookAhead=t+1;i.value=i.extended=-1}else{this.token=c}if(this.pos!=t){this.pos=t;if(t==this.end){this.setDone();return this}while(t<this.range.from)this.range=this.ranges[--this.rangeIndex];while(t>=this.range.to)this.range=this.ranges[++this.rangeIndex];if(t>=this.chunkPos&&t<this.chunkPos+this.chunk.length){this.chunkOff=t-this.chunkPos}else{this.chunk="";this.chunkOff=0}this.readNext()}return this}read(t,i){if(t>=this.chunkPos&&i<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,i-this.chunkPos);if(t>=this.chunk2Pos&&i<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,i-this.chunk2Pos);if(t>=this.range.from&&i<=this.range.to)return this.input.read(t,i);let s="";for(let h of this.ranges){if(h.from>=i)break;if(h.to>t)s+=this.input.read(Math.max(h.from,t),Math.min(h.to,i))}return s}}class p{constructor(t,i){this.data=t;this.id=i}token(t,i){k(this.data,t,i,this.id)}}p.prototype.contextual=p.prototype.fallback=p.prototype.extend=false;class w{constructor(t,i={}){this.token=t;this.contextual=!!i.contextual;this.fallback=!!i.fallback;this.extend=!!i.extend}}function k(t,i,s,h){let e=0,r=1<<h,{parser:l}=s.p,{dialect:n}=l;t:for(;;){if((r&t[e])==0)break;let s=t[e+1];for(let h=e+3;h<s;h+=2)if((t[h+1]&r)>0){let s=t[h];if(n.allows(s)&&(i.token.value==-1||i.token.value==s||l.overrides(s,i.token.value))){i.acceptToken(s);break}}for(let h=i.next,r=0,l=t[e+2];r<l;){let n=r+l>>1;let f=s+n+(n<<1);let u=t[f],o=t[f+1];if(h<u)l=n;else if(h>=o)r=n+1;else{e=t[f+2];i.advance();continue t}}break}}function g(t,i=Uint16Array){if(typeof t!="string")return t;let s=null;for(let h=0,e=0;h<t.length;){let r=0;for(;;){let i=t.charCodeAt(h++),s=false;if(i==126){r=65535;break}if(i>=92)i--;if(i>=34)i--;let e=i-32;if(e>=46){e-=46;s=true}r+=e;if(s)break;r*=46}if(s)s[e++]=r;else s=new i(r)}return s}const b=typeof process!="undefined"&&/\bparse\b/.test(process.env.LOG);let v=null;var m;(function(t){t[t["Margin"]=25]="Margin"})(m||(m={}));function x(t,i,s){let h=t.fullCursor();h.moveTo(i);for(;;){if(!(s<0?h.childBefore(i):h.childAfter(i)))for(;;){if((s<0?h.to<i:h.from>i)&&!h.type.isError)return s<0?Math.max(0,Math.min(h.to-1,i-25)):Math.min(t.length,Math.max(h.from+1,i+25));if(s<0?h.prevSibling():h.nextSibling())break;if(!h.parent())return s<0?0:t.length}}}class y{constructor(t,i){this.fragments=t;this.nodeSet=i;this.i=0;this.fragment=null;this.safeFrom=-1;this.safeTo=-1;this.trees=[];this.start=[];this.index=[];this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){this.safeFrom=t.openStart?x(t.tree,t.from+t.offset,1)-t.offset:t.from;this.safeTo=t.openEnd?x(t.tree,t.to+t.offset,-1)-t.offset:t.to;while(this.trees.length){this.trees.pop();this.start.pop();this.index.pop()}this.trees.push(t.tree);this.start.push(-t.offset);this.index.push(0);this.nextStart=this.safeFrom}else{this.nextStart=1e9}}nodeAt(t){if(t<this.nextStart)return null;while(this.fragment&&this.safeTo<=t)this.nextFragment();if(!this.fragment)return null;for(;;){let i=this.trees.length-1;if(i<0){this.nextFragment();return null}let s=this.trees[i],h=this.index[i];if(h==s.children.length){this.trees.pop();this.start.pop();this.index.pop();continue}let l=s.children[h];let n=this.start[i]+s.positions[h];if(n>t){this.nextStart=n;return null}if(l instanceof r){if(n==t){if(n<this.safeFrom)return null;let t=n+l.length;if(t<=this.safeTo){let i=l.prop(e.lookAhead);if(!i||t+i<this.fragment.to)return l}}this.index[i]++;if(n+l.length>=Math.max(this.safeFrom,t)){this.trees.push(l);this.start.push(n);this.index.push(0)}}else{this.index[i]++;this.nextStart=n+l.length}}}}class M{constructor(t,i){this.stream=i;this.tokens=[];this.mainToken=null;this.actions=[];this.tokens=t.tokenizers.map((t=>new a))}getActions(t){let i=0;let s=null;let{parser:h}=t.p,{tokenizers:e}=h;let r=h.stateSlot(t.state,3);let l=t.curContext?t.curContext.hash:0;let n=0;for(let f=0;f<e.length;f++){if((1<<f&r)==0)continue;let h=e[f],u=this.tokens[f];if(s&&!h.fallback)continue;if(h.contextual||u.start!=t.pos||u.mask!=r||u.context!=l){this.updateCachedToken(u,h,t);u.mask=r;u.context=l}if(u.lookAhead>u.end+25)n=Math.max(u.lookAhead,n);if(u.value!=0){let e=i;if(u.extended>-1)i=this.addActions(t,u.extended,u.end,i);i=this.addActions(t,u.value,u.end,i);if(!h.extend){s=u;if(i>e)break}}}while(this.actions.length>i)this.actions.pop();if(n)t.setLookAhead(n);if(!s&&t.pos==this.stream.end){s=new a;s.value=t.p.parser.eofTerm;s.start=s.end=t.pos;i=this.addActions(t,s.value,s.end,i)}this.mainToken=s;return this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let i=new a,{pos:s,p:h}=t;i.start=s;i.end=Math.min(s+1,h.stream.end);i.value=s==h.stream.end?h.parser.eofTerm:0;return i}updateCachedToken(t,i,s){i.token(this.stream.reset(s.pos,t),s);if(t.value>-1){let{parser:i}=s.p;for(let h=0;h<i.specialized.length;h++)if(i.specialized[h]==t.value){let e=i.specializers[h](this.stream.read(t.start,t.end),s);if(e>=0&&s.p.parser.dialect.allows(e>>1)){if((e&1)==0)t.value=e>>1;else t.extended=e>>1;break}}}else{t.value=0;t.end=Math.min(s.p.stream.end,s.pos+1)}}putAction(t,i,s,h){for(let e=0;e<h;e+=3)if(this.actions[e]==t)return h;this.actions[h++]=t;this.actions[h++]=i;this.actions[h++]=s;return h}addActions(t,i,s,h){let{state:e}=t,{parser:r}=t.p,{data:l}=r;for(let n=0;n<2;n++){for(let t=r.stateSlot(e,n?2:1);;t+=3){if(l[t]==65535){if(l[t+1]==1){t=N(l,t+2)}else{if(h==0&&l[t+1]==2)h=this.putAction(N(l,t+2),i,s,h);break}}if(l[t]==i)h=this.putAction(N(l,t+1),i,s,h)}}return h}}var S;(function(t){t[t["Distance"]=5]="Distance";t[t["MaxRemainingPerStep"]=3]="MaxRemainingPerStep";t[t["MinBufferLengthPrune"]=500]="MinBufferLengthPrune";t[t["ForceReduceLimit"]=10]="ForceReduceLimit";t[t["CutDepth"]=15e3]="CutDepth";t[t["CutTo"]=9e3]="CutTo"})(S||(S={}));class A{constructor(t,i,s,h){this.parser=t;this.input=i;this.ranges=h;this.recovering=0;this.nextStackID=9812;this.minStackPos=0;this.reused=[];this.stoppedAt=null;this.stream=new d(i,h);this.tokens=new M(t,this.stream);this.topTerm=t.top[1];let{from:e}=h[0];this.stacks=[l.start(this,t.top[0],e)];this.fragments=s.length&&this.stream.end-e>t.bufferLength*4?new y(s,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t=this.stacks,i=this.minStackPos;let s=this.stacks=[];let h,e;for(let r=0;r<t.length;r++){let l=t[r];for(;;){this.tokens.mainToken=null;if(l.pos>i){s.push(l)}else if(this.advanceStack(l,s,t)){continue}else{if(!h){h=[];e=[]}h.push(l);let t=this.tokens.getMainToken(l);e.push(t.value,t.end)}break}}if(!s.length){let t=h&&P(h);if(t)return this.stackToTree(t);if(this.parser.strict){if(b&&h)console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none"));throw new SyntaxError("No parse at "+i)}if(!this.recovering)this.recovering=5}if(this.recovering&&h){let t=this.stoppedAt!=null&&h[0].pos>this.stoppedAt?h[0]:this.runRecovery(h,e,s);if(t)return this.stackToTree(t.forceAll())}if(this.recovering){let t=this.recovering==1?1:this.recovering*3;if(s.length>t){s.sort(((t,i)=>i.score-t.score));while(s.length>t)s.pop()}if(s.some((t=>t.reducePos>i)))this.recovering--}else if(s.length>1){t:for(let t=0;t<s.length-1;t++){let i=s[t];for(let h=t+1;h<s.length;h++){let e=s[h];if(i.sameState(e)||i.buffer.length>500&&e.buffer.length>500){if((i.score-e.score||i.buffer.length-e.buffer.length)>0){s.splice(h--,1)}else{s.splice(t--,1);continue t}}}}}this.minStackPos=s[0].pos;for(let r=1;r<s.length;r++)if(s[r].pos<this.minStackPos)this.minStackPos=s[r].pos;return null}stopAt(t){if(this.stoppedAt!=null&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,i,s){let h=t.pos,{parser:l}=this;let n=b?this.stackID(t)+" -> ":"";if(this.stoppedAt!=null&&h>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let i=t.curContext&&t.curContext.tracker.strict,s=i?t.curContext.hash:0;for(let f=this.fragments.nodeAt(h);f;){let h=this.parser.nodeSet.types[f.type.id]==f.type?l.getGoto(t.state,f.type.id):-1;if(h>-1&&f.length&&(!i||(f.prop(e.contextHash)||0)==s)){t.useNode(f,h);if(b)console.log(n+this.stackID(t)+` (via reuse of ${l.getName(f.type.id)})`);return true}if(!(f instanceof r)||f.children.length==0||f.positions[0]>0)break;let u=f.children[0];if(u instanceof r&&f.positions[0]==0)f=u;else break}}let f=l.stateSlot(t.state,4);if(f>0){t.reduce(f);if(b)console.log(n+this.stackID(t)+` (via always-reduce ${l.getName(f&65535)})`);return true}if(t.stack.length>=15e3){while(t.stack.length>9e3&&t.forceReduce()){}}let u=this.tokens.getActions(t);for(let e=0;e<u.length;){let r=u[e++],f=u[e++],o=u[e++];let a=e==u.length||!s;let c=a?t:t.split();c.apply(r,f,o);if(b)console.log(n+this.stackID(c)+` (via ${(r&65536)==0?"shift":`reduce of ${l.getName(r&65535)}`} for ${l.getName(f)} @ ${h}${c==t?"":", split"})`);if(a)return true;else if(c.pos>h)i.push(c);else s.push(c)}return false}advanceFully(t,i){let s=t.pos;for(;;){if(!this.advanceStack(t,null,null))return false;if(t.pos>s){$(t,i);return true}}}runRecovery(t,i,s){let h=null,e=false;for(let r=0;r<t.length;r++){let l=t[r],n=i[r<<1],f=i[(r<<1)+1];let u=b?this.stackID(l)+" -> ":"";if(l.deadEnd){if(e)continue;e=true;l.restart();if(b)console.log(u+this.stackID(l)+" (restarted)");let t=this.advanceFully(l,s);if(t)continue}let o=l.split(),a=u;for(let t=0;o.forceReduce()&&t<10;t++){if(b)console.log(a+this.stackID(o)+" (via force-reduce)");let t=this.advanceFully(o,s);if(t)break;if(b)a=this.stackID(o)+" -> "}for(let t of l.recoverByInsert(n)){if(b)console.log(u+this.stackID(t)+" (via recover-insert)");this.advanceFully(t,s)}if(this.stream.end>l.pos){if(f==l.pos){f++;n=0}l.recoverByDelete(n,f);if(b)console.log(u+this.stackID(l)+` (via recover-delete ${this.parser.getName(n)})`);$(l,s)}else if(!h||h.score<l.score){h=l}}return h}stackToTree(t){t.close();return r.build({buffer:o.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let i=(v||(v=new WeakMap)).get(t);if(!i)v.set(t,i=String.fromCodePoint(this.nextStackID++));return i+t}}function $(t,i){for(let s=0;s<i.length;s++){let h=i[s];if(h.pos==t.pos&&h.sameState(t)){if(i[s].score<t.score)i[s]=t;return}}i.push(t)}class D{constructor(t,i,s){this.source=t;this.flags=i;this.disabled=s}allows(t){return!this.disabled||this.disabled[t]==0}}const C=t=>t;class R{constructor(t){this.start=t.start;this.shift=t.shift||C;this.reduce=t.reduce||C;this.reuse=t.reuse||C;this.hash=t.hash||(()=>0);this.strict=t.strict!==false}}class T extends t{constructor(t){super();this.wrappers=[];if(t.version!=13)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (${13})`);let e=t.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let i=0;i<t.repeatNodeCount;i++)e.push("");let r=Object.keys(t.topRules).map((i=>t.topRules[i][1]));let l=[];for(let i=0;i<e.length;i++)l.push([]);function n(t,i,s){l[t].push([i,i.deserialize(String(s))])}if(t.nodeProps)for(let i of t.nodeProps){let t=i[0];for(let s=1;s<i.length;){let h=i[s++];if(h>=0){n(h,t,i[s++])}else{let e=i[s+-h];for(let r=-h;r>0;r--)n(i[s++],t,e);s++}}}this.nodeSet=new i(e.map(((i,h)=>s.define({name:h>=this.minRepeatTerm?undefined:i,id:h,props:l[h],top:r.indexOf(h)>-1,error:h==0,skipped:t.skippedNodes&&t.skippedNodes.indexOf(h)>-1}))));this.strict=false;this.bufferLength=h;let f=g(t.tokenData);this.context=t.context;this.specialized=new Uint16Array(t.specialized?t.specialized.length:0);this.specializers=[];if(t.specialized)for(let i=0;i<t.specialized.length;i++){this.specialized[i]=t.specialized[i].term;this.specializers[i]=t.specialized[i].get}this.states=g(t.states,Uint32Array);this.data=g(t.stateData);this.goto=g(t.goto);this.maxTerm=t.maxTerm;this.tokenizers=t.tokenizers.map((t=>typeof t=="number"?new p(f,t):t));this.topRules=t.topRules;this.dialects=t.dialects||{};this.dynamicPrecedences=t.dynamicPrecedences||null;this.tokenPrecTable=t.tokenPrec;this.termNames=t.termNames||null;this.maxNode=this.nodeSet.types.length-1;this.dialect=this.parseDialect();this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,i,s){let h=new A(this,t,i,s);for(let e of this.wrappers)h=e(h,t,i,s);return h}getGoto(t,i,s=false){let h=this.goto;if(i>=h[0])return-1;for(let e=h[i+1];;){let i=h[e++],r=i&1;let l=h[e++];if(r&&s)return l;for(let s=e+(i>>1);e<s;e++)if(h[e]==t)return l;if(r)return-1}}hasAction(t,i){let s=this.data;for(let h=0;h<2;h++){for(let e=this.stateSlot(t,h?2:1),r;;e+=3){if((r=s[e])==65535){if(s[e+1]==1)r=s[e=N(s,e+2)];else if(s[e+1]==2)return N(s,e+2);else break}if(r==i||r==0)return N(s,e+1)}}return 0}stateSlot(t,i){return this.states[t*6+i]}stateFlag(t,i){return(this.stateSlot(t,0)&i)>0}validAction(t,i){if(i==this.stateSlot(t,4))return true;for(let s=this.stateSlot(t,1);;s+=3){if(this.data[s]==65535){if(this.data[s+1]==1)s=N(this.data,s+2);else return false}if(i==N(this.data,s+1))return true}}nextStates(t){let i=[];for(let s=this.stateSlot(t,1);;s+=3){if(this.data[s]==65535){if(this.data[s+1]==1)s=N(this.data,s+2);else break}if((this.data[s+2]&65536>>16)==0){let t=this.data[s+1];if(!i.some(((i,s)=>s&1&&i==t)))i.push(this.data[s],t)}}return i}overrides(t,i){let s=E(this.data,this.tokenPrecTable,i);return s<0||E(this.data,this.tokenPrecTable,t)<s}configure(t){let i=Object.assign(Object.create(T.prototype),this);if(t.props)i.nodeSet=this.nodeSet.extend(...t.props);if(t.top){let s=this.topRules[t.top];if(!s)throw new RangeError(`Invalid top rule name ${t.top}`);i.top=s}if(t.tokenizers)i.tokenizers=this.tokenizers.map((i=>{let s=t.tokenizers.find((t=>t.from==i));return s?s.to:i}));if(t.contextTracker)i.context=t.contextTracker;if(t.dialect)i.dialect=this.parseDialect(t.dialect);if(t.strict!=null)i.strict=t.strict;if(t.wrap)i.wrappers=i.wrappers.concat(t.wrap);if(t.bufferLength!=null)i.bufferLength=t.bufferLength;return i}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let i=this.dynamicPrecedences;return i==null?0:i[t]||0}parseDialect(t){let i=Object.keys(this.dialects),s=i.map((()=>false));if(t)for(let e of t.split(" ")){let t=i.indexOf(e);if(t>=0)s[t]=true}let h=null;for(let e=0;e<i.length;e++)if(!s[e]){for(let t=this.dialects[i[e]],s;(s=this.data[t++])!=65535;)(h||(h=new Uint8Array(this.maxTerm+1)))[s]=1}return new D(t,s,h)}static deserialize(t){return new T(t)}}function N(t,i){return t[i]|t[i+1]<<16}function E(t,i,s){for(let h=i,e;(e=t[h])!=65535;h++)if(e==s)return h-i;return-1}function P(t){let i=null;for(let s of t){let t=s.p.stoppedAt;if((s.pos==s.p.stream.end||t!=null&&s.pos>t)&&s.p.parser.stateFlag(s.state,2)&&(!i||i.score<s.score))i=s}return i}export{R as C,w as E,T as L};
//# sourceMappingURL=p-ad04fbf9.js.map