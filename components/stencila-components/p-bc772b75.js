import{a as t,N as e,e as i,P as r,T as s,p as n,L as l,s as f,o as h,x as u,y as o,f as a,d as c,b as d,t as p,m as k,j as m,l as w,z as g,c as b}from"./p-39bf90d7.js";import{html as L}from"./p-a249cc8e.js";import"./p-42c7aa22.js";import"./p-725b0d42.js";import"./p-f10a134c.js";import"./p-ad04fbf9.js";import"./p-c57f4542.js";class T{constructor(t,i,r,s,n,l,f){this.type=t;this.value=i;this.from=r;this.hash=s;this.end=n;this.children=l;this.positions=f;this.hashProp=[[e.contextHash,s]]}static create(t,e,i,r,s){let n=r+(r<<8)+t+(e<<4)|0;return new T(t,e,i,n,s,[],[])}addChild(t,i){if(t.prop(e.contextHash)!=this.hash)t=new s(t.type,t.children,t.positions,t.length,this.hashProp);this.children.push(t);this.positions.push(i)}toTree(e,i=this.end){let r=this.children.length-1;if(r>=0)i=Math.max(i,this.positions[r]+this.children[r].length+this.from);let n=new s(e.types[this.type],this.children,this.positions,i-this.from).balance({makeTree:(e,i,r)=>new s(t.none,e,i,r,this.hashProp)});return n}}var S;(function(t){t[t["Document"]=1]="Document";t[t["CodeBlock"]=2]="CodeBlock";t[t["FencedCode"]=3]="FencedCode";t[t["Blockquote"]=4]="Blockquote";t[t["HorizontalRule"]=5]="HorizontalRule";t[t["BulletList"]=6]="BulletList";t[t["OrderedList"]=7]="OrderedList";t[t["ListItem"]=8]="ListItem";t[t["ATXHeading1"]=9]="ATXHeading1";t[t["ATXHeading2"]=10]="ATXHeading2";t[t["ATXHeading3"]=11]="ATXHeading3";t[t["ATXHeading4"]=12]="ATXHeading4";t[t["ATXHeading5"]=13]="ATXHeading5";t[t["ATXHeading6"]=14]="ATXHeading6";t[t["SetextHeading1"]=15]="SetextHeading1";t[t["SetextHeading2"]=16]="SetextHeading2";t[t["HTMLBlock"]=17]="HTMLBlock";t[t["LinkReference"]=18]="LinkReference";t[t["Paragraph"]=19]="Paragraph";t[t["CommentBlock"]=20]="CommentBlock";t[t["ProcessingInstructionBlock"]=21]="ProcessingInstructionBlock";t[t["Escape"]=22]="Escape";t[t["Entity"]=23]="Entity";t[t["HardBreak"]=24]="HardBreak";t[t["Emphasis"]=25]="Emphasis";t[t["StrongEmphasis"]=26]="StrongEmphasis";t[t["Link"]=27]="Link";t[t["Image"]=28]="Image";t[t["InlineCode"]=29]="InlineCode";t[t["HTMLTag"]=30]="HTMLTag";t[t["Comment"]=31]="Comment";t[t["ProcessingInstruction"]=32]="ProcessingInstruction";t[t["URL"]=33]="URL";t[t["HeaderMark"]=34]="HeaderMark";t[t["QuoteMark"]=35]="QuoteMark";t[t["ListMark"]=36]="ListMark";t[t["LinkMark"]=37]="LinkMark";t[t["EmphasisMark"]=38]="EmphasisMark";t[t["CodeMark"]=39]="CodeMark";t[t["CodeText"]=40]="CodeText";t[t["CodeInfo"]=41]="CodeInfo";t[t["LinkTitle"]=42]="LinkTitle";t[t["LinkLabel"]=43]="LinkLabel"})(S||(S={}));class B{constructor(t,e){this.start=t;this.content=e;this.marks=[];this.parsers=[]}}class E{constructor(){this.text="";this.baseIndent=0;this.basePos=0;this.depth=0;this.markers=[];this.pos=0;this.indent=0;this.next=-1}forward(){if(this.basePos>this.pos)this.forwardInner()}forwardInner(){let t=this.skipSpace(this.basePos);this.indent=this.countIndent(t,this.pos,this.indent);this.pos=t;this.next=t==this.text.length?-1:this.text.charCodeAt(t)}skipSpace(t){return x(this.text,t)}reset(t){this.text=t;this.baseIndent=this.basePos=this.pos=this.indent=0;this.forwardInner();this.depth=1;while(this.markers.length)this.markers.pop()}moveBase(t){this.basePos=t;this.baseIndent=this.countIndent(t,this.pos,this.indent)}moveBaseColumn(t){this.baseIndent=t;this.basePos=this.findColumn(t)}addMarker(t){this.markers.push(t)}countIndent(t,e=0,i=0){for(let r=e;r<t;r++)i+=this.text.charCodeAt(r)==9?4-i%4:1;return i}findColumn(t){let e=0;for(let i=0;e<this.text.length&&i<t;e++)i+=this.text.charCodeAt(e)==9?4-i%4:1;return e}scrub(){if(!this.baseIndent)return this.text;let t="";for(let e=0;e<this.basePos;e++)t+=" ";return t+this.text.slice(this.basePos)}}function M(t,e,i){if(i.pos==i.text.length||t!=e.block&&i.indent>=e.stack[i.depth+1].value+i.baseIndent)return true;if(i.indent>=i.baseIndent+4)return false;let r=(t.type==S.OrderedList?P:z)(i,e,false);return r>0&&(t.type!=S.BulletList||v(i,e,false)<0)&&i.text.charCodeAt(i.pos+r-1)==t.value}const H={[S.Blockquote](t,e,i){if(i.next!=62)return false;i.markers.push(ut(S.QuoteMark,e.lineStart+i.pos,e.lineStart+i.pos+1));i.moveBase(i.pos+(C(i.text.charCodeAt(i.pos+1))?2:1));t.end=e.lineStart+i.text.length;return true},[S.ListItem](t,e,i){if(i.indent<i.baseIndent+t.value&&i.next>-1)return false;i.moveBaseColumn(i.baseIndent+t.value);return true},[S.OrderedList]:M,[S.BulletList]:M,[S.Document](){return true}};function C(t){return t==32||t==9||t==10||t==13}function x(t,e=0){while(e<t.length&&C(t.charCodeAt(e)))e++;return e}function I(t,e,i){while(e>i&&C(t.charCodeAt(e-1)))e--;return e}function A(t){if(t.next!=96&&t.next!=126)return-1;let e=t.pos+1;while(e<t.text.length&&t.text.charCodeAt(e)==t.next)e++;if(e<t.pos+3)return-1;if(t.next==96)for(let i=e;i<t.text.length;i++)if(t.text.charCodeAt(i)==96)return-1;return e}function y(t){return t.next!=62?-1:t.text.charCodeAt(t.pos+1)==32?2:1}function v(t,e,i){if(t.next!=42&&t.next!=45&&t.next!=95)return-1;let r=1;for(let s=t.pos+1;s<t.text.length;s++){let e=t.text.charCodeAt(s);if(e==t.next)r++;else if(!C(e))return-1}if(i&&t.next==45&&R(t)>-1&&t.depth==e.stack.length)return-1;return r<3?-1:1}function j(t,e){for(let i=t.stack.length-1;i>=0;i--)if(t.stack[i].type==e)return true;return false}function z(t,e,i){return(t.next==45||t.next==43||t.next==42)&&(t.pos==t.text.length-1||C(t.text.charCodeAt(t.pos+1)))&&(!i||j(e,S.BulletList)||t.skipSpace(t.pos+2)<t.text.length)?1:-1}function P(t,e,i){let r=t.pos,s=t.next;for(;;){if(s>=48&&s<=57)r++;else break;if(r==t.text.length)return-1;s=t.text.charCodeAt(r)}if(r==t.pos||r>t.pos+9||s!=46&&s!=41||r<t.text.length-1&&!C(t.text.charCodeAt(r+1))||i&&!j(e,S.OrderedList)&&(t.skipSpace(r+1)==t.text.length||r>t.pos+1||t.next!=49))return-1;return r+1-t.pos}function O(t){if(t.next!=35)return-1;let e=t.pos+1;while(e<t.text.length&&t.text.charCodeAt(e)==35)e++;if(e<t.text.length&&t.text.charCodeAt(e)!=32)return-1;let i=e-t.pos;return i>6?-1:i}function R(t){if(t.next!=45&&t.next!=61||t.indent>=t.baseIndent+4)return-1;let e=t.pos+1;while(e<t.text.length&&t.text.charCodeAt(e)==t.next)e++;let i=e;while(e<t.text.length&&C(t.text.charCodeAt(e)))e++;return e==t.text.length?i:-1}const D=/^[ \t]*$/,X=/-->/,$=/\?>/;const N=[[/^<(?:script|pre|style)(?:\s|>|$)/i,/<\/(?:script|pre|style)>/i],[/^\s*<!--/,X],[/^\s*<\?/,$],[/^\s*<![A-Z]/,/>/],[/^\s*<!\[CDATA\[/,/\]\]>/],[/^\s*<\/?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|h2|h3|h4|h5|h6|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|\/?>|$)/i,D],[/^\s*(?:<\/[a-z][\w-]*\s*>|<[a-z][\w-]*(\s+[a-z:_][\w-.]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*>)\s*$/i,D]];function q(t,e,i){if(t.next!=60)return-1;let r=t.text.slice(t.pos);for(let s=0,n=N.length-(i?1:0);s<n;s++)if(N[s][0].test(r))return s;return-1}function Z(t,e){let i=t.countIndent(e,t.pos,t.indent);let r=t.countIndent(t.skipSpace(e),e,i);return r>=i+5?i+1:r}function _(t,e,i){let r=t.length-1;if(r>=0&&t[r].to==e&&t[r].type==S.CodeText)t[r].to=i;else t.push(ut(S.CodeText,e,i))}const F={LinkReference:undefined,IndentedCode(t,e){let i=e.baseIndent+4;if(e.indent<i)return false;let r=e.findColumn(i);let s=t.lineStart+r,n=t.lineStart+e.text.length;let l=[],f=[];_(l,s,n);while(t.nextLine()&&e.depth>=t.stack.length){if(e.pos==e.text.length){_(f,t.lineStart-1,t.lineStart);for(let t of e.markers)f.push(t)}else if(e.indent<i){break}else{if(f.length){for(let t of f){if(t.type==S.CodeText)_(l,t.from,t.to);else l.push(t)}f=[]}_(l,t.lineStart-1,t.lineStart);for(let t of e.markers)l.push(t);n=t.lineStart+e.text.length;let i=t.lineStart+e.findColumn(e.baseIndent+4);if(i<n)_(l,i,n)}}if(f.length){f=f.filter((t=>t.type!=S.CodeText));if(f.length)e.markers=f.concat(e.markers)}t.addNode(t.buffer.writeElements(l,-s).finish(S.CodeBlock,n-s),s);return true},FencedCode(t,e){let i=A(e);if(i<0)return false;let r=t.lineStart+e.pos,s=e.next,n=i-e.pos;let l=e.skipSpace(i),f=I(e.text,e.text.length,l);let h=[ut(S.CodeMark,r,r+n)];if(l<f)h.push(ut(S.CodeInfo,t.lineStart+l,t.lineStart+f));for(let u=true;t.nextLine()&&e.depth>=t.stack.length;u=false){let i=e.pos;if(e.indent-e.baseIndent<4)while(i<e.text.length&&e.text.charCodeAt(i)==s)i++;if(i-e.pos>=n&&e.skipSpace(i)==e.text.length){for(let t of e.markers)h.push(t);h.push(ut(S.CodeMark,t.lineStart+e.pos,t.lineStart+i));t.nextLine();break}else{if(!u)_(h,t.lineStart-1,t.lineStart);for(let t of e.markers)h.push(t);let i=t.lineStart+e.basePos,r=t.lineStart+e.text.length;if(i<r)_(h,i,r)}}t.addNode(t.buffer.writeElements(h,-r).finish(S.FencedCode,t.prevLineEnd()-r),r);return true},Blockquote(t,e){let i=y(e);if(i<0)return false;t.startContext(S.Blockquote,e.pos);t.addNode(S.QuoteMark,t.lineStart+e.pos,t.lineStart+e.pos+1);e.moveBase(e.pos+i);return null},HorizontalRule(t,e){if(v(e,t,false)<0)return false;let i=t.lineStart+e.pos;t.nextLine();t.addNode(S.HorizontalRule,i);return true},BulletList(t,e){let i=z(e,t,false);if(i<0)return false;if(t.block.type!=S.BulletList)t.startContext(S.BulletList,e.basePos,e.next);let r=Z(e,e.pos+1);t.startContext(S.ListItem,e.basePos,r-e.baseIndent);t.addNode(S.ListMark,t.lineStart+e.pos,t.lineStart+e.pos+i);e.moveBaseColumn(r);return null},OrderedList(t,e){let i=P(e,t,false);if(i<0)return false;if(t.block.type!=S.OrderedList)t.startContext(S.OrderedList,e.basePos,e.text.charCodeAt(e.pos+i-1));let r=Z(e,e.pos+i);t.startContext(S.ListItem,e.basePos,r-e.baseIndent);t.addNode(S.ListMark,t.lineStart+e.pos,t.lineStart+e.pos+i);e.moveBaseColumn(r);return null},ATXHeading(t,e){let i=O(e);if(i<0)return false;let r=e.pos,s=t.lineStart+r;let n=I(e.text,e.text.length,r),l=n;while(l>r&&e.text.charCodeAt(l-1)==e.next)l--;if(l==n||l==r||!C(e.text.charCodeAt(l-1)))l=e.text.length;let f=t.buffer.write(S.HeaderMark,0,i).writeElements(t.parser.parseInline(e.text.slice(r+i+1,l),s+i+1),-s);if(l<e.text.length)f.write(S.HeaderMark,l-r,n-r);let h=f.finish(S.ATXHeading1-1+i,e.text.length-r);t.nextLine();t.addNode(h,s);return true},HTMLBlock(t,e){let i=q(e,t,false);if(i<0)return false;let r=t.lineStart+e.pos,s=N[i][1];let n=[],l=s!=D;while(!s.test(e.text)&&t.nextLine()){if(e.depth<t.stack.length){l=false;break}for(let t of e.markers)n.push(t)}if(l)t.nextLine();let f=s==X?S.CommentBlock:s==$?S.ProcessingInstructionBlock:S.HTMLBlock;let h=t.prevLineEnd();t.addNode(t.buffer.writeElements(n,-r).finish(f,h-r),r);return true},SetextHeading:undefined};class Q{constructor(t){this.stage=0;this.elts=[];this.pos=0;this.start=t.start;this.advance(t.content)}nextLine(t,e,i){if(this.stage==-1)return false;let r=i.content+"\n"+e.scrub();let s=this.advance(r);if(s>-1&&s<r.length)return this.complete(t,i,s);return false}finish(t,e){if((this.stage==2||this.stage==3)&&x(e.content,this.pos)==e.content.length)return this.complete(t,e,e.content.length);return false}complete(t,e,i){t.addLeafElement(e,ut(S.LinkReference,this.start,this.start+i,this.elts));return true}nextStage(t){if(t){this.pos=t.to-this.start;this.elts.push(t);this.stage++;return true}if(t===false)this.stage=-1;return false}advance(t){for(;;){if(this.stage==-1){return-1}else if(this.stage==0){if(!this.nextStage(Tt(t,this.pos,this.start,true)))return-1;if(t.charCodeAt(this.pos)!=58)return this.stage=-1;this.elts.push(ut(S.LinkMark,this.pos+this.start,this.pos+this.start+1));this.pos++}else if(this.stage==1){if(!this.nextStage(bt(t,x(t,this.pos),this.start)))return-1}else if(this.stage==2){let e=x(t,this.pos),i=0;if(e>this.pos){let r=Lt(t,e,this.start);if(r){let e=U(t,r.to-this.start);if(e>0){this.nextStage(r);i=e}}}if(!i)i=U(t,this.pos);return i>0&&i<t.length?i:-1}else{return U(t,this.pos)}}}}function U(t,e){for(;e<t.length;e++){let i=t.charCodeAt(e);if(i==10)break;if(!C(i))return-1}return e}class V{nextLine(t,e,i){let r=e.depth<t.stack.length?-1:R(e);let s=e.next;if(r<0)return false;let n=ut(S.HeaderMark,t.lineStart+e.pos,t.lineStart+r);t.nextLine();t.addLeafElement(i,ut(s==61?S.SetextHeading1:S.SetextHeading2,i.start,t.prevLineEnd(),[...t.parser.parseInline(i.content,i.start),n]));return true}finish(){return false}}const G={LinkReference(t,e){return e.content.charCodeAt(0)==91?new Q(e):null},SetextHeading(){return new V}};const K=[(t,e)=>O(e)>=0,(t,e)=>A(e)>=0,(t,e)=>y(e)>=0,(t,e)=>z(e,t,true)>=0,(t,e)=>P(e,t,true)>=0,(t,e)=>v(e,t,true)>=0,(t,e)=>q(e,t,true)>=0];const J={text:"",end:0};class W{constructor(t,e,i,r){this.parser=t;this.input=e;this.ranges=r;this.line=new E;this.atEnd=false;this.dontInject=new Set;this.stoppedAt=null;this.rangeI=0;this.to=r[r.length-1].to;this.lineStart=this.absoluteLineStart=this.absoluteLineEnd=r[0].from;this.block=T.create(S.Document,0,this.lineStart,0,0);this.stack=[this.block];this.fragments=i.length?new Mt(i,e):null;this.readLine()}get parsedPos(){return this.absoluteLineStart}advance(){if(this.stoppedAt!=null&&this.absoluteLineStart>this.stoppedAt)return this.finish();let{line:t}=this;for(;;){while(t.depth<this.stack.length)this.finishContext();for(let e of t.markers)this.addNode(e.type,e.from,e.to);if(t.pos<t.text.length)break;if(!this.nextLine())return this.finish()}if(this.fragments&&this.reuseFragment(t.basePos))return null;t:for(;;){for(let e of this.parser.blockParsers)if(e){let i=e(this,t);if(i!=false){if(i==true)return null;t.forward();continue t}}break}let e=new B(this.lineStart+t.pos,t.text.slice(t.pos));for(let i of this.parser.leafBlockParsers)if(i){let t=i(this,e);if(t)e.parsers.push(t)}t:while(this.nextLine()){if(t.pos==t.text.length)break;if(t.indent<t.baseIndent+4){for(let i of this.parser.endLeafBlock)if(i(this,t,e))break t}for(let i of e.parsers)if(i.nextLine(this,t,e))return null;e.content+="\n"+t.scrub();for(let i of t.markers)e.marks.push(i)}this.finishLeaf(e);return null}stopAt(t){if(this.stoppedAt!=null&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}reuseFragment(t){if(!this.fragments.moveTo(this.absoluteLineStart+t,this.absoluteLineStart)||!this.fragments.matches(this.block.hash))return false;let e=this.fragments.takeNodes(this);if(!e)return false;let i=e,r=this.absoluteLineStart+e;for(let s=1;s<this.ranges.length;s++){let t=this.ranges[s-1].to,e=this.ranges[s].from;if(t>=this.lineStart&&e<r)i-=e-t}this.lineStart+=i;this.absoluteLineStart+=e;this.moveRangeI();if(this.absoluteLineStart<this.to){this.lineStart++;this.absoluteLineStart++;this.readLine()}else{this.atEnd=true;this.readLine()}return true}get depth(){return this.stack.length}parentType(t=this.depth-1){return this.parser.nodeSet.types[this.stack[t].type]}nextLine(){this.lineStart+=this.line.text.length;if(this.absoluteLineEnd>=this.to){this.absoluteLineStart=this.absoluteLineEnd;this.atEnd=true;this.readLine();return false}else{this.lineStart++;this.absoluteLineStart=this.absoluteLineEnd+1;this.moveRangeI();this.readLine();return true}}moveRangeI(){while(this.rangeI<this.ranges.length-1&&this.absoluteLineStart>=this.ranges[this.rangeI].to)this.rangeI++}scanLine(t){let e=J;e.end=t;if(t>=this.to){e.text=""}else{e.text=this.lineChunkAt(e.end);e.end+=e.text.length;if(this.ranges.length>1){let t=this.absoluteLineStart,i=this.rangeI;while(this.ranges[i].to<e.end){i++;let r=this.ranges[i].from;let s=this.lineChunkAt(r);e.end=r+s.length;e.text=e.text.slice(0,this.ranges[i-1].to-t)+s;t=e.end-e.text.length}}}return e}readLine(){let{line:t}=this,{text:e,end:i}=this.scanLine(this.absoluteLineStart);this.absoluteLineEnd=i;t.reset(e);for(;t.depth<this.stack.length;t.depth++){let e=this.stack[t.depth],i=this.parser.skipContextMarkup[e.type];if(!i)throw new Error("Unhandled block context "+S[e.type]);if(!i(e,this,t))break;t.forward()}}lineChunkAt(t){let e=this.input.chunk(t),i;if(!this.input.lineChunks){let t=e.indexOf("\n");i=t<0?e:e.slice(0,t)}else{i=e=="\n"?"":e}return t+i.length>this.to?i.slice(0,this.to-t):i}prevLineEnd(){return this.atEnd?this.lineStart:this.lineStart-1}startContext(t,e,i=0){this.block=T.create(t,i,this.lineStart+e,this.block.hash,this.lineStart+this.line.text.length);this.stack.push(this.block)}startComposite(t,e,i=0){this.startContext(this.parser.getNodeType(t),e,i)}addNode(t,e,i){if(typeof t=="number")t=new s(this.parser.nodeSet.types[t],nt,nt,(i!==null&&i!==void 0?i:this.prevLineEnd())-e);this.block.addChild(t,e-this.block.from)}addElement(t){this.block.addChild(t.toTree(this.parser.nodeSet),t.from-this.block.from)}addLeafElement(t,e){this.addNode(this.buffer.writeElements(Bt(e.children,t.marks),-e.from).finish(e.type,e.to-e.from),e.from)}finishContext(){let t=this.stack.pop();let e=this.stack[this.stack.length-1];e.addChild(t.toTree(this.parser.nodeSet),t.from-e.from);this.block=e}finish(){while(this.stack.length>1)this.finishContext();return this.addGaps(this.block.toTree(this.parser.nodeSet,this.lineStart))}addGaps(t){return this.ranges.length>1?Y(this.ranges,0,t.topNode,this.ranges[0].from,this.dontInject):t}finishLeaf(t){for(let i of t.parsers)if(i.finish(this,t))return;let e=Bt(this.parser.parseInline(t.content,t.start),t.marks);this.addNode(this.buffer.writeElements(e,-t.start).finish(S.Paragraph,t.content.length),t.start)}elt(t,e,i,r){if(typeof t=="string")return ut(this.parser.getNodeType(t),e,i,r);return new ht(t,e)}get buffer(){return new lt(this.parser.nodeSet)}}function Y(t,e,i,r,n){if(n.has(i.tree))return i.tree;let l=t[e].to;let f=[],h=[],u=i.from+r;function o(i,s){while(s?i>=l:i>l){let s=t[e+1].from-l;r+=s;i+=s;e++;l=t[e].to}}for(let s=i.firstChild;s;s=s.nextSibling){o(s.from+r,true);let i=s.from+r,a;if(s.to+r>l){a=Y(t,e,s,r,n);o(s.to+r,false)}else{a=s.toTree()}f.push(a);h.push(i-u)}o(i.to+r,false);return new s(i.type,f,h,i.to+r-u,i.tree?i.tree.propValues:undefined)}class tt extends r{constructor(t,e,i,r,s,n,l,f,h){super();this.nodeSet=t;this.blockParsers=e;this.leafBlockParsers=i;this.blockNames=r;this.endLeafBlock=s;this.skipContextMarkup=n;this.inlineParsers=l;this.inlineNames=f;this.wrappers=h;this.nodeTypes=Object.create(null);for(let u of t.types)this.nodeTypes[u.name]=u.id}createParse(t,e,i){let r=new W(this,t,e,i);for(let s of this.wrappers)r=s(r,t,e,i);return r}configure(r){let s=it(r);if(!s)return this;let{nodeSet:n,skipContextMarkup:l}=this;let f=this.blockParsers.slice(),h=this.leafBlockParsers.slice(),u=this.blockNames.slice(),o=this.inlineParsers.slice(),a=this.inlineNames.slice(),c=this.endLeafBlock.slice(),d=this.wrappers;if(et(s.defineNodes)){l=Object.assign({},l);let r=n.types.slice();for(let i of s.defineNodes){let{name:s,block:n,composite:f}=typeof i=="string"?{name:i}:i;if(r.some((t=>t.name==s)))continue;if(f)l[r.length]=(t,e,i)=>f(e,i,t.value);let h=r.length;let u=f?["Block","BlockContext"]:!n?undefined:h>=S.ATXHeading1&&h<=S.SetextHeading2?["Block","LeafBlock","Heading"]:["Block","LeafBlock"];r.push(t.define({id:h,name:s,props:u&&[[e.group,u]]}))}n=new i(r)}if(et(s.props))n=n.extend(...s.props);if(et(s.remove)){for(let t of s.remove){let e=this.blockNames.indexOf(t),i=this.inlineNames.indexOf(t);if(e>-1)f[e]=h[e]=undefined;if(i>-1)o[i]=undefined}}if(et(s.parseBlock)){for(let t of s.parseBlock){let e=u.indexOf(t.name);if(e>-1){f[e]=t.parse;h[e]=t.leaf}else{let e=t.before?rt(u,t.before):t.after?rt(u,t.after)+1:u.length-1;f.splice(e,0,t.parse);h.splice(e,0,t.leaf);u.splice(e,0,t.name)}if(t.endLeaf)c.push(t.endLeaf)}}if(et(s.parseInline)){for(let t of s.parseInline){let e=a.indexOf(t.name);if(e>-1){o[e]=t.parse}else{let e=t.before?rt(a,t.before):t.after?rt(a,t.after)+1:a.length-1;o.splice(e,0,t.parse);a.splice(e,0,t.name)}}}if(s.wrap)d=d.concat(s.wrap);return new tt(n,f,h,u,c,l,o,a,d)}getNodeType(t){let e=this.nodeTypes[t];if(e==null)throw new RangeError(`Unknown node type '${t}'`);return e}parseInline(t,e){let i=new St(this,t,e);t:for(let r=e;r<i.end;){let t=i.char(r);for(let e of this.inlineParsers)if(e){let s=e(i,t,r);if(s>=0){r=s;continue t}}r++}return i.resolveMarkers(0)}}function et(t){return t!=null&&t.length>0}function it(t){if(!Array.isArray(t))return t;if(t.length==0)return null;let e=it(t[0]);if(t.length==1)return e;let i=it(t.slice(1));if(!i||!e)return e||i;let r=(t,e)=>(t||nt).concat(e||nt);let s=e.wrap,n=i.wrap;return{props:r(e.props,i.props),defineNodes:r(e.defineNodes,i.defineNodes),parseBlock:r(e.parseBlock,i.parseBlock),parseInline:r(e.parseInline,i.parseInline),remove:r(e.remove,i.remove),wrap:!s?n:!n?s:(t,e,i,r)=>s(n(t,e,i,r),e,i,r)}}function rt(t,e){let i=t.indexOf(e);if(i<0)throw new RangeError(`Position specified relative to unknown parser ${e}`);return i}let st=[t.none];for(let ue=1,oe;oe=S[ue];ue++){st[ue]=t.define({id:ue,name:oe,props:ue>=S.Escape?[]:[[e.group,ue in H?["Block","BlockContext"]:["Block","LeafBlock"]]]})}const nt=[];class lt{constructor(t){this.nodeSet=t;this.content=[];this.nodes=[]}write(t,e,i,r=0){this.content.push(t,e,i,4+r*4);return this}writeElements(t,e=0){for(let i of t)i.writeTo(this,e);return this}finish(t,e){return s.build({buffer:this.content,nodeSet:this.nodeSet,reused:this.nodes,topID:t,length:e})}}class ft{constructor(t,e,i,r=nt){this.type=t;this.from=e;this.to=i;this.children=r}writeTo(t,e){let i=t.content.length;t.writeElements(this.children,e);t.content.push(this.type,this.from+e,this.to+e,t.content.length+4-i)}toTree(t){return new lt(t).writeElements(this.children,-this.from).finish(this.type,this.to-this.from)}}class ht{constructor(t,e){this.tree=t;this.from=e}get to(){return this.from+this.tree.length}get type(){return this.tree.type.id}get children(){return nt}writeTo(t,e){t.nodes.push(this.tree);t.content.push(t.nodes.length-1,this.from+e,this.to+e,-1)}toTree(){return this.tree}}function ut(t,e,i,r){return new ft(t,e,i,r)}const ot={resolve:"Emphasis",mark:"EmphasisMark"};const at={resolve:"Emphasis",mark:"EmphasisMark"};const ct={},dt={};class pt{constructor(t,e,i,r){this.type=t;this.from=e;this.to=i;this.side=r}}const kt="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~";let mt=/[!"#$%&'()*+,\-.\/:;<=>?@\[\\\]^_`{|}~\xA1\u2010-\u2027]/;try{mt=new RegExp("[\\p{Pc}|\\p{Pd}|\\p{Pe}|\\p{Pf}|\\p{Pi}|\\p{Po}|\\p{Ps}]","u")}catch(he){}const wt={Escape(t,e,i){if(e!=92||i==t.end-1)return-1;let r=t.char(i+1);for(let s=0;s<kt.length;s++)if(kt.charCodeAt(s)==r)return t.append(ut(S.Escape,i,i+2));return-1},Entity(t,e,i){if(e!=38)return-1;let r=/^(?:#\d+|#x[a-f\d]+|\w+);/i.exec(t.slice(i+1,i+31));return r?t.append(ut(S.Entity,i,i+1+r[0].length)):-1},InlineCode(t,e,i){if(e!=96||i&&t.char(i-1)==96)return-1;let r=i+1;while(r<t.end&&t.char(r)==96)r++;let s=r-i,n=0;for(;r<t.end;r++){if(t.char(r)==96){n++;if(n==s&&t.char(r+1)!=96)return t.append(ut(S.InlineCode,i,r+1,[ut(S.CodeMark,i,i+s),ut(S.CodeMark,r+1-s,r+1)]))}else{n=0}}return-1},HTMLTag(t,e,i){if(e!=60||i==t.end-1)return-1;let r=t.slice(i+1,t.end);let s=/^(?:[a-z][-\w+.]+:[^\s>]+|[a-z\d.!#$%&'*+/=?^_`{|}~-]+@[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?(?:\.[a-z\d](?:[a-z\d-]{0,61}[a-z\d])?)*)>/i.exec(r);if(s)return t.append(ut(S.URL,i,i+1+s[0].length));let n=/^!--[^>](?:-[^-]|[^-])*?-->/i.exec(r);if(n)return t.append(ut(S.Comment,i,i+1+n[0].length));let l=/^\?[^]*?\?>/.exec(r);if(l)return t.append(ut(S.ProcessingInstruction,i,i+1+l[0].length));let f=/^(?:![A-Z][^]*?>|!\[CDATA\[[^]*?\]\]>|\/\s*[a-zA-Z][\w-]*\s*>|\s*[a-zA-Z][\w-]*(\s+[a-zA-Z:_][\w-.:]*(?:\s*=\s*(?:[^\s"'=<>`]+|'[^']*'|"[^"]*"))?)*\s*(\/\s*)?>)/.exec(r);if(!f)return-1;return t.append(ut(S.HTMLTag,i,i+1+f[0].length))},Emphasis(t,e,i){if(e!=95&&e!=42)return-1;let r=i+1;while(t.char(r)==e)r++;let s=t.slice(i-1,i),n=t.slice(r,r+1);let l=mt.test(s),f=mt.test(n);let h=/\s|^$/.test(s),u=/\s|^$/.test(n);let o=!u&&(!f||h||l);let a=!h&&(!l||u||f);let c=o&&(e==42||!a||l);let d=a&&(e==42||!o||f);return t.append(new pt(e==95?ot:at,i,r,(c?1:0)|(d?2:0)))},HardBreak(t,e,i){if(e==92&&t.char(i+1)==10)return t.append(ut(S.HardBreak,i,i+2));if(e==32){let e=i+1;while(t.char(e)==32)e++;if(t.char(e)==10&&e>=i+2)return t.append(ut(S.HardBreak,i,e+1))}return-1},Link(t,e,i){return e==91?t.append(new pt(ct,i,i+1,1)):-1},Image(t,e,i){return e==33&&t.char(i+1)==91?t.append(new pt(dt,i,i+2,1)):-1},LinkEnd(t,e,i){if(e!=93)return-1;for(let r=t.parts.length-1;r>=0;r--){let e=t.parts[r];if(e instanceof pt&&(e.type==ct||e.type==dt)){if(!e.side||t.skipSpace(e.to)==i&&!/[(\[]/.test(t.slice(i+1,i+2))){t.parts[r]=null;return-1}let s=t.takeContent(r);let n=t.parts[r]=gt(t,s,e.type==ct?S.Link:S.Image,e.from,i+1);if(e.type==ct)for(let e=0;e<r;e++){let i=t.parts[e];if(i instanceof pt&&i.type==ct)i.side=0}return n.to}}return-1}};function gt(t,e,i,r,s){let{text:n}=t,l=t.char(s),f=s;e.unshift(ut(S.LinkMark,r,r+(i==S.Image?2:1)));e.push(ut(S.LinkMark,s-1,s));if(l==40){let i=t.skipSpace(s+1);let r=bt(n,i-t.offset,t.offset),l;if(r){i=t.skipSpace(r.to);l=Lt(n,i-t.offset,t.offset);if(l)i=t.skipSpace(l.to)}if(t.char(i)==41){e.push(ut(S.LinkMark,s,s+1));f=i+1;if(r)e.push(r);if(l)e.push(l);e.push(ut(S.LinkMark,i,f))}}else if(l==91){let i=Tt(n,s-t.offset,t.offset,false);if(i){e.push(i);f=i.to}}return ut(i,r,f,e)}function bt(t,e,i){let r=t.charCodeAt(e);if(r==60){for(let r=e+1;r<t.length;r++){let s=t.charCodeAt(r);if(s==62)return ut(S.URL,e+i,r+1+i);if(s==60||s==10)return false}return null}else{let r=0,s=e;for(let e=false;s<t.length;s++){let i=t.charCodeAt(s);if(C(i)){break}else if(e){e=false}else if(i==40){r++}else if(i==41){if(!r)break;r--}else if(i==92){e=true}}return s>e?ut(S.URL,e+i,s+i):s==t.length?null:false}}function Lt(t,e,i){let r=t.charCodeAt(e);if(r!=39&&r!=34&&r!=40)return false;let s=r==40?41:r;for(let n=e+1,l=false;n<t.length;n++){let r=t.charCodeAt(n);if(l)l=false;else if(r==s)return ut(S.LinkTitle,e+i,n+1+i);else if(r==92)l=true}return null}function Tt(t,e,i,r){for(let s=false,n=e+1,l=Math.min(t.length,n+999);n<l;n++){let l=t.charCodeAt(n);if(s)s=false;else if(l==93)return r?false:ut(S.LinkLabel,e+i,n+1+i);else{if(r&&!C(l))r=false;if(l==91)return false;else if(l==92)s=true}}return null}class St{constructor(t,e,i){this.parser=t;this.text=e;this.offset=i;this.parts=[]}char(t){return t>=this.end?-1:this.text.charCodeAt(t-this.offset)}get end(){return this.offset+this.text.length}slice(t,e){return this.text.slice(t-this.offset,e-this.offset)}append(t){this.parts.push(t);return t.to}addDelimiter(t,e,i,r,s){return this.append(new pt(t,e,i,(r?1:0)|(s?2:0)))}addElement(t){return this.append(t)}resolveMarkers(t){for(let i=t;i<this.parts.length;i++){let e=this.parts[i];if(!(e instanceof pt&&e.type.resolve&&e.side&2))continue;let r=e.type==ot||e.type==at;let s=e.to-e.from;let n,l=i-1;for(;l>=t;l--){let t=this.parts[l];if(!(t instanceof pt&&t.side&1&&t.type==e.type)||r&&(e.side&1||t.side&2)&&(t.to-t.from+s)%3==0&&((t.to-t.from)%3||s%3))continue;n=t;break}if(!n)continue;let f=e.type.resolve,h=[];let u=n.from,o=e.to;if(r){let t=Math.min(2,n.to-n.from,s);u=n.to-t;o=e.from+t;f=t==1?"Emphasis":"StrongEmphasis"}if(n.type.mark)h.push(this.elt(n.type.mark,u,n.to));for(let t=l+1;t<i;t++){if(this.parts[t]instanceof ft)h.push(this.parts[t]);this.parts[t]=null}if(e.type.mark)h.push(this.elt(e.type.mark,e.from,o));let a=this.elt(f,u,o,h);this.parts[l]=r&&n.from!=u?new pt(n.type,n.from,u,n.side):null;let c=this.parts[i]=r&&e.to!=o?new pt(e.type,o,e.to,e.side):null;if(c)this.parts.splice(i,0,a);else this.parts[i]=a}let e=[];for(let i=t;i<this.parts.length;i++){let t=this.parts[i];if(t instanceof ft)e.push(t)}return e}findOpeningDelimiter(t){for(let e=this.parts.length-1;e>=0;e--){let i=this.parts[e];if(i instanceof pt&&i.type==t)return e}return null}takeContent(t){let e=this.resolveMarkers(t);this.parts.length=t;return e}skipSpace(t){return x(this.text,t-this.offset)+this.offset}elt(t,e,i,r){if(typeof t=="string")return ut(this.parser.getNodeType(t),e,i,r);return new ht(t,e)}}function Bt(t,e){if(!e.length)return t;if(!t.length)return e;let i=t.slice(),r=0;for(let s of e){while(r<i.length&&i[r].to<s.to)r++;if(r<i.length&&i[r].from<s.from){let t=i[r];if(t instanceof ft)i[r]=new ft(t.type,t.from,t.to,Bt(t.children,[s]))}else{i.splice(r++,0,s)}}return i}const Et=[S.CodeBlock,S.ListItem,S.OrderedList,S.BulletList];class Mt{constructor(t,e){this.fragments=t;this.input=e;this.i=0;this.fragment=null;this.fragmentEnd=-1;this.cursor=null;if(t.length)this.fragment=t[this.i++]}nextFragment(){this.fragment=this.i<this.fragments.length?this.fragments[this.i++]:null;this.cursor=null;this.fragmentEnd=-1}moveTo(t,e){while(this.fragment&&this.fragment.to<=t)this.nextFragment();if(!this.fragment||this.fragment.from>(t?t-1:0))return false;if(this.fragmentEnd<0){let t=this.fragment.to;while(t>0&&this.input.read(t-1,t)!="\n")t--;this.fragmentEnd=t?t-1:0}let i=this.cursor;if(!i){i=this.cursor=this.fragment.tree.cursor();i.firstChild()}let r=t+this.fragment.offset;while(i.to<=r)if(!i.parent())return false;for(;;){if(i.from>=r)return this.fragment.from<=e;if(!i.childAfter(r))return false}}matches(t){let i=this.cursor.tree;return i&&i.prop(e.contextHash)==t}takeNodes(t){let e=this.cursor,i=this.fragment.offset,r=this.fragmentEnd-(this.fragment.openEnd?1:0);let s=t.absoluteLineStart,n=s,l=t.block.children.length;let f=n,h=l;for(;;){if(e.to-i>r){if(e.type.isAnonymous&&e.firstChild())continue;break}t.dontInject.add(e.tree);t.addNode(e.tree,e.from-i);if(e.type.is("Block")){if(Et.indexOf(e.type.id)<0){n=e.to-i;l=t.block.children.length}else{n=f;l=h;f=e.to-i;h=t.block.children.length}}if(!e.nextSibling())break}while(t.block.children.length>l){t.block.children.pop();t.block.positions.pop()}return n-s}}const Ht=new tt(new i(st),Object.keys(F).map((t=>F[t])),Object.keys(F).map((t=>G[t])),Object.keys(F),K,H,Object.keys(wt).map((t=>wt[t])),Object.keys(wt),[]);function Ct(t,e,i){let r=[];for(let s=t.firstChild,n=e;;s=s.nextSibling){let t=s?s.from:i;if(t>n)r.push({from:n,to:t});if(!s)break;n=s.to}return r}function xt(t){let{codeParser:e,htmlParser:i}=t;let r=n(((t,r)=>{let s=t.type.id;if(e&&(s==S.CodeBlock||s==S.FencedCode)){let i="";if(s==S.FencedCode){let e=t.node.getChild(S.CodeInfo);if(e)i=r.read(e.from,e.to)}let n=e(i);if(n)return{parser:n,overlay:t=>t.type.id==S.CodeText}}else if(i&&(s==S.HTMLBlock||s==S.HTMLTag)){return{parser:i,overlay:Ct(t.node,t.from,t.to)}}return null}));return{wrap:r}}const It={resolve:"Strikethrough",mark:"StrikethroughMark"};const At={defineNodes:["Strikethrough","StrikethroughMark"],parseInline:[{name:"Strikethrough",parse(t,e,i){if(e!=126||t.char(i+1)!=126)return-1;return t.addDelimiter(It,i,i+2,true,true)},after:"Emphasis"}]};function yt(t,e,i=0,r,s=0){let n=0,l=true,f=-1,h=-1,u=false;let o=()=>{r.push(t.elt("TableCell",s+f,s+h,t.parser.parseInline(e.slice(f,h),s+f)))};for(let a=i;a<e.length;a++){let i=e.charCodeAt(a);if(i==124&&!u){if(!l||f>-1)n++;l=false;if(r){if(f>-1)o();r.push(t.elt("TableDelimiter",a+s,a+s+1))}f=h=-1}else if(u||i!=32&&i!=9){if(f<0)f=a;h=a+1}u=!u&&i==92}if(f>-1){n++;if(r)o()}return n}function vt(t,e){for(let i=e;i<t.length;i++){let e=t.charCodeAt(i);if(e==124)return true;if(e==92)i++}return false}const jt=/^\|?(\s*:?-+:?\s*\|)+(\s*:?-+:?\s*)?$/;class zt{constructor(){this.rows=null}nextLine(t,e,i){if(this.rows==null){this.rows=false;let r;if((e.next==45||e.next==58||e.next==124)&&jt.test(r=e.text.slice(e.pos))){let s=[],n=yt(t,i.content,0,s,i.start);if(n==yt(t,r,e.pos))this.rows=[t.elt("TableHeader",i.start,i.start+i.content.length,s),t.elt("TableDelimiter",t.lineStart+e.pos,t.lineStart+e.text.length)]}}else if(this.rows){let i=[];yt(t,e.text,e.pos,i,t.lineStart);this.rows.push(t.elt("TableRow",t.lineStart+e.pos,t.lineStart+e.text.length,i))}return false}finish(t,e){if(!this.rows)return false;t.addLeafElement(e,t.elt("Table",e.start,e.start+e.content.length,this.rows));return true}}const Pt={defineNodes:[{name:"Table",block:true},"TableHeader","TableRow","TableCell","TableDelimiter"],parseBlock:[{name:"Table",leaf(t,e){return vt(e.content,0)?new zt:null},endLeaf(t,e,i){if(i.parsers.some((t=>t instanceof zt))||!vt(e.text,e.basePos))return false;let r=t.scanLine(t.absoluteLineEnd+1).text;return jt.test(r)&&yt(t,e.text,e.basePos)==yt(t,r,e.basePos)},before:"SetextHeading"}]};class Ot{nextLine(){return false}finish(t,e){t.addLeafElement(e,t.elt("Task",e.start,e.start+e.content.length,[t.elt("TaskMarker",e.start,e.start+3),...t.parser.parseInline(e.content.slice(3),e.start+3)]));return true}}const Rt={defineNodes:[{name:"Task",block:true},"TaskMarker"],parseBlock:[{name:"TaskList",leaf(t,e){return/^\[[ xX]\]/.test(e.content)&&t.parentType().name=="ListItem"?new Ot:null},after:"SetextHeading"}]};const Dt=[Pt,Rt,At];function Xt(t,e,i){return(r,s,n)=>{if(s!=t||r.char(n+1)==t)return-1;let l=[r.elt(i,n,n+1)];for(let f=n+1;f<r.end;f++){let s=r.char(f);if(s==t)return r.addElement(r.elt(e,n,f+1,l.concat(r.elt(i,f,f+1))));if(s==92)l.push(r.elt("Escape",f,f+++2));if(C(s))break}return-1}}const $t={defineNodes:["Superscript","SuperscriptMark"],parseInline:[{name:"Superscript",parse:Xt(94,"Superscript","SuperscriptMark")}]};const Nt={defineNodes:["Subscript","SubscriptMark"],parseInline:[{name:"Subscript",parse:Xt(126,"Subscript","SubscriptMark")}]};const qt={defineNodes:["Emoji"],parseInline:[{name:"Emoji",parse(t,e,i){let r;if(e!=58||!(r=/^[a-zA-Z_0-9]+:/.exec(t.slice(i+1,t.end))))return-1;return t.addElement(t.elt("Emoji",i,i+1+r[0].length))}}]};const Zt=c({block:{open:"\x3c!--",close:"--\x3e"}});const _t=Ht.configure({props:[d({"Blockquote/...":p.quote,HorizontalRule:p.contentSeparator,"ATXHeading1/... SetextHeading1/...":p.heading1,"ATXHeading2/... SetextHeading2/...":p.heading2,"ATXHeading3/...":p.heading3,"ATXHeading4/...":p.heading4,"ATXHeading5/...":p.heading5,"ATXHeading6/...":p.heading6,"Comment CommentBlock":p.comment,Escape:p.escape,Entity:p.character,"Emphasis/...":p.emphasis,"StrongEmphasis/...":p.strong,"Link/... Image/...":p.link,"OrderedList/... BulletList/...":p.list,"BlockQuote/...":p.quote,"InlineCode CodeText":p.monospace,URL:p.url,"HeaderMark HardBreak QuoteMark ListMark LinkMark EmphasisMark CodeMark":p.processingInstruction,"CodeInfo LinkLabel":p.labelName,LinkTitle:p.string,Paragraph:p.content}),k.add((t=>{if(!t.is("Block")||t.is("Document"))return undefined;return(t,e)=>({from:e.doc.lineAt(t.from).to,to:t.to})})),m.add({Document:()=>null}),w.add({Document:Zt})]});function Ft(t){return new l(Zt,t,t.nodeSet.types.find((t=>t.name=="Document")))}const Qt=Ft(_t);const Ut=_t.configure([Dt,Nt,$t,qt,{props:[d({"TableDelimiter SubscriptMark SuperscriptMark StrikethroughMark":p.processingInstruction,"TableHeader/...":p.heading,"Strikethrough/...":p.strikethrough,TaskMarker:p.atom,Task:p.list,Emoji:p.character,"Subscript Superscript":p.special(p.content),TableCell:p.content})]}]);const Vt=Ft(Ut);function Gt(t,e){return i=>{let r=i&&g.matchLanguageName(t,i,true);if(!r)return e?e.parser:null;if(r.support)return r.support.language.parser;return b.getSkippingParser(r.load())}}function Kt(t,e){return e.sliceString(t.from,t.from+50)}class Jt{constructor(t,e,i,r,s,n,l){this.node=t;this.from=e;this.to=i;this.spaceBefore=r;this.spaceAfter=s;this.type=n;this.item=l}blank(t=true){let e=this.spaceBefore;if(this.node.name=="Blockquote")e+=">";else for(let i=this.to-this.from-e.length-this.spaceAfter.length;i>0;i--)e+=" ";return e+(t?this.spaceAfter:"")}marker(t,e){let i=this.node.name=="OrderedList"?String(+Yt(this.item,t)[2]+e):"";return this.spaceBefore+i+this.type+this.spaceAfter}}function Wt(t,e,i){let r=[];for(let l=t;l&&l.name!="Document";l=l.parent){if(l.name=="ListItem"||l.name=="Blockquote")r.push(l)}let s=[],n=0;for(let l=r.length-1;l>=0;l--){let t=r[l],f,h=n;if(t.name=="Blockquote"&&(f=/^[ \t]*>( ?)/.exec(e.slice(n)))){n+=f[0].length;s.push(new Jt(t,h,n,"",f[1],">",null))}else if(t.name=="ListItem"&&t.parent.name=="OrderedList"&&(f=/^([ \t]*)\d+([.)])([ \t]*)/.exec(Kt(t,i)))){let e=f[3],i=f[0].length;if(e.length>=4){e=e.slice(0,e.length-4);i-=4}n+=i;s.push(new Jt(t.parent,h,n,f[1],e,f[2],t))}else if(t.name=="ListItem"&&t.parent.name=="BulletList"&&(f=/^([ \t]*)([-+*])([ \t]+)/.exec(Kt(t,i)))){let e=f[3],i=f[0].length;if(e.length>4){e=e.slice(0,e.length-4);i-=4}n+=i;s.push(new Jt(t.parent,h,n,f[1],e,f[2],t))}}return s}function Yt(t,e){return/^(\s*)(\d+)(?=[.)])/.exec(e.sliceString(t.from,t.from+10))}function te(t,e,i,r=0){for(let s=-1,n=t;;){if(n.name=="ListItem"){let t=Yt(n,e);let l=+t[2];if(s>=0){if(l!=s+1)return;i.push({from:n.from+t[1].length,to:n.from+t[0].length,insert:String(s+2+r)})}s=l}let t=n.nextSibling;if(!t)break;n=t}}const ee=({state:t,dispatch:e})=>{let i=f(t),{doc:r}=t;let s=null,n=t.changeByRange((e=>{if(!e.empty||!Vt.isActiveAt(t,e.from))return s={range:e};let n=e.from,l=r.lineAt(n);let f=Wt(i.resolveInner(n,-1),l.text,r);while(f.length&&f[f.length-1].from>n-l.from)f.pop();if(!f.length)return s={range:e};let u=f[f.length-1];if(u.to-u.spaceAfter.length>n-l.from)return s={range:e};let o=n>=u.to-u.spaceAfter.length&&!/\S/.test(l.text.slice(u.to));if(u.item&&o){if(u.node.firstChild.to>=n||l.from>0&&!/[^\s>]/.test(r.lineAt(l.from-1).text)){let t=f.length>1?f[f.length-2]:null;let e,i="";if(t&&t.item){e=l.from+t.from;i=t.marker(r,1)}else{e=l.from+(t?t.to:0)}let s=[{from:e,to:n,insert:i}];if(u.node.name=="OrderedList")te(u.item,r,s,-2);if(t&&t.node.name=="OrderedList")te(t.item,r,s);return{range:h.cursor(e+i.length),changes:s}}else{let e="";for(let t=0,i=f.length-2;t<=i;t++)e+=f[t].blank(t<i);e+=t.lineBreak;return{range:h.cursor(n+e.length),changes:{from:l.from,insert:e}}}}if(u.node.name=="Blockquote"&&o&&l.from){let i=r.lineAt(l.from-1),s=/>\s*$/.exec(i.text);if(s&&s.index==u.from){let r=t.changes([{from:i.from+s.index,to:i.to},{from:l.from+u.from,to:l.to}]);return{range:e.map(r),changes:r}}}let a=[];if(u.node.name=="OrderedList")te(u.item,r,a);let c=t.lineBreak;let d=u.item&&u.item.from<l.from;if(!d||/^[\s\d.)\-+*>]*/.exec(l.text)[0].length>=u.to){for(let t=0,e=f.length-1;t<=e;t++)c+=t==e&&!d?f[t].marker(r,1):f[t].blank()}let p=n;while(p>l.from&&/\s/.test(l.text.charAt(p-l.from-1)))p--;a.push({from:p,to:n,insert:c});return{range:h.cursor(p+c.length),changes:a}}));if(s)return false;e(t.update(n,{scrollIntoView:true,userEvent:"input"}));return true};function ie(t){return t.name=="QuoteMark"||t.name=="ListMark"}function re(t,e){let i=t.resolveInner(e,-1),r=e;if(ie(i)){r=i.from;i=i.parent}for(let s;s=i.childBefore(r);){if(ie(s)){r=s.from}else if(s.name=="OrderedList"||s.name=="BulletList"){i=s.lastChild;r=i.to}else{break}}return i}const se=({state:t,dispatch:e})=>{let i=f(t);let r=null,s=t.changeByRange((e=>{let s=e.from,{doc:n}=t;if(e.empty&&Vt.isActiveAt(t,e.from)){let t=n.lineAt(s);let r=Wt(re(i,s),t.text,n);if(r.length){let i=r[r.length-1];let n=i.to-i.spaceAfter.length+(i.spaceAfter?1:0);if(s-t.from>n&&!/\S/.test(t.text.slice(n,s-t.from)))return{range:h.cursor(t.from+n),changes:{from:t.from+n,to:s}};if(s-t.from==n){let r=t.from+i.from;if(i.item&&i.node.from<i.item.from&&/\S/.test(t.text.slice(i.from,i.to)))return{range:e,changes:{from:r,to:t.from+i.to,insert:i.blank()}};if(r<s)return{range:h.cursor(r),changes:{from:r,to:s}}}}}return r={range:e}}));if(r)return false;e(t.update(s,{scrollIntoView:true,userEvent:"delete"}));return true};const ne=[{key:"Enter",run:ee},{key:"Backspace",run:se}];const le=L({matchClosingTags:false});function fe(t={}){let{codeLanguages:e,defaultCodeLanguage:i,addKeymap:r=true,base:{parser:s}=Qt}=t;if(!(s instanceof tt))throw new RangeError("Base parser provided to `markdown` should be a Markdown parser");let n=t.extensions?[t.extensions]:[];let l=[le.support],f;if(i instanceof a){l.push(i.support);f=i.language}else if(i){f=i}let h=e||f?Gt(e||[],f):undefined;n.push(xt({codeParser:h,htmlParser:le.language.parser}));if(r)l.push(u.high(o.of(ne)));return new a(Ft(s.configure(n)),l)}export{Qt as commonmarkLanguage,se as deleteMarkupBackward,ee as insertNewlineContinueMarkup,fe as markdown,ne as markdownKeymap,Vt as markdownLanguage};
//# sourceMappingURL=p-bc772b75.js.map