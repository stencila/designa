import{r as t,f as e,h as n,c as i,e as r}from"./p-42c7aa22.js";import{w as u,h as o,e as s,t as a,c as f,s as c,m as l,a as d,b as h,p,d as m,f as g,g as b,i as v,j as y,k as w,l as A,n as x,x as O,y as F,o as D,B as k,q as E,R as $,r as j,u as C,v as M,C as B,z as S,A as _,D as N,E as z,F as T,G as P,H as L,I,J as R,K as q,L as U,M as W,N as G,O as H,P as V,Q as Y,S as X,T as J,U as Q,V as Z,W as K,X as tt,Y as et,Z as nt,_ as it,$ as rt,a0 as ut,a1 as ot,a2 as st,a3 as at,a4 as ft}from"./p-a62c3f64.js";import{c as ct}from"./p-112455b1.js";import{c as lt,i as dt}from"./p-bfd527b9.js";import"./p-4f726865.js";
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var ht=undefined&&undefined.__extends||function(){var t=function(e,n){t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)if(e.hasOwnProperty(n))t[n]=e[n]};return t(e,n)};return function(e,n){t(e,n);function i(){this.constructor=e}e.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}();var pt=Object.prototype.hasOwnProperty;function mt(t,e){return pt.call(t,e)}function gt(t){if(Array.isArray(t)){var e=new Array(t.length);for(var n=0;n<e.length;n++){e[n]=""+n}return e}if(Object.keys){return Object.keys(t)}var e=[];for(var i in t){if(mt(t,i)){e.push(i)}}return e}function bt(t){switch(typeof t){case"object":return JSON.parse(JSON.stringify(t));case"undefined":return null;default:return t}}function vt(t){var e=0;var n=t.length;var i;while(e<n){i=t.charCodeAt(e);if(i>=48&&i<=57){e++;continue}return false}return true}function yt(t){if(t.indexOf("/")===-1&&t.indexOf("~")===-1)return t;return t.replace(/~/g,"~0").replace(/\//g,"~1")}function wt(t){return t.replace(/~1/g,"/").replace(/~0/g,"~")}function At(t){if(t===undefined){return true}if(t){if(Array.isArray(t)){for(var e=0,n=t.length;e<n;e++){if(At(t[e])){return true}}}else if(typeof t==="object"){var i=gt(t);var r=i.length;for(var e=0;e<r;e++){if(At(t[i[e]])){return true}}}}return false}function xt(t,e){var n=[t];for(var i in e){var r=typeof e[i]==="object"?JSON.stringify(e[i],null,2):e[i];if(typeof r!=="undefined"){n.push(i+": "+r)}}return n.join("\n")}var Ot=function(t){ht(e,t);function e(e,n,i,r,u){var o=this.constructor;var s=t.call(this,xt(e,{name:n,index:i,operation:r,tree:u}))||this;s.name=n;s.index=i;s.operation=r;s.tree=u;Object.setPrototypeOf(s,o.prototype);s.message=xt(e,{name:n,index:i,operation:r,tree:u});return s}return e}(Error);var Ft=Ot;var Dt=bt;var kt={add:function(t,e,n){t[e]=this.value;return{newDocument:n}},remove:function(t,e,n){var i=t[e];delete t[e];return{newDocument:n,removed:i}},replace:function(t,e,n){var i=t[e];t[e]=this.value;return{newDocument:n,removed:i}},move:function(t,e,n){var i=$t(n,this.path);if(i){i=bt(i)}var r=jt(n,{op:"remove",path:this.from}).removed;jt(n,{op:"add",path:this.path,value:r});return{newDocument:n,removed:i}},copy:function(t,e,n){var i=$t(n,this.from);jt(n,{op:"add",path:this.path,value:bt(i)});return{newDocument:n}},test:function(t,e,n){return{newDocument:n,test:_t(t[e],this.value)}},_get:function(t,e,n){this.value=t[e];return{newDocument:n}}};var Et={add:function(t,e,n){if(vt(e)){t.splice(e,0,this.value)}else{t[e]=this.value}return{newDocument:n,index:e}},remove:function(t,e,n){var i=t.splice(e,1);return{newDocument:n,removed:i[0]}},replace:function(t,e,n){var i=t[e];t[e]=this.value;return{newDocument:n,removed:i}},move:kt.move,copy:kt.copy,test:kt.test,_get:kt._get};function $t(t,e){if(e==""){return t}var n={op:"_get",path:e};jt(t,n);return n.value}function jt(t,e,n,i,r,u){if(n===void 0){n=false}if(i===void 0){i=true}if(r===void 0){r=true}if(u===void 0){u=0}if(n){if(typeof n=="function"){n(e,0,t,e.path)}else{Bt(e,0)}}if(e.path===""){var o={newDocument:t};if(e.op==="add"){o.newDocument=e.value;return o}else if(e.op==="replace"){o.newDocument=e.value;o.removed=t;return o}else if(e.op==="move"||e.op==="copy"){o.newDocument=$t(t,e.from);if(e.op==="move"){o.removed=t}return o}else if(e.op==="test"){o.test=_t(t,e.value);if(o.test===false){throw new Ft("Test operation failed","TEST_OPERATION_FAILED",u,e,t)}o.newDocument=t;return o}else if(e.op==="remove"){o.removed=t;o.newDocument=null;return o}else if(e.op==="_get"){e.value=t;return o}else{if(n){throw new Ft("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",u,e,t)}else{return o}}}else{if(!i){t=bt(t)}var s=e.path||"";var a=s.split("/");var f=t;var c=1;var l=a.length;var d=undefined;var h=void 0;var p=void 0;if(typeof n=="function"){p=n}else{p=Bt}while(true){h=a[c];if(h&&h.indexOf("~")!=-1){h=wt(h)}if(r&&h=="__proto__"){throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README")}if(n){if(d===undefined){if(f[h]===undefined){d=a.slice(0,c).join("/")}else if(c==l-1){d=e.path}if(d!==undefined){p(e,0,t,d)}}}c++;if(Array.isArray(f)){if(h==="-"){h=f.length}else{if(n&&!vt(h)){throw new Ft("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",u,e,t)}else if(vt(h)){h=~~h}}if(c>=l){if(n&&e.op==="add"&&h>f.length){throw new Ft("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",u,e,t)}var o=Et[e.op].call(e,f,h,t);if(o.test===false){throw new Ft("Test operation failed","TEST_OPERATION_FAILED",u,e,t)}return o}}else{if(c>=l){var o=kt[e.op].call(e,f,h,t);if(o.test===false){throw new Ft("Test operation failed","TEST_OPERATION_FAILED",u,e,t)}return o}}f=f[h];if(n&&c<l&&(!f||typeof f!=="object")){throw new Ft("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",u,e,t)}}}}function Ct(t,e,n,i,r){if(i===void 0){i=true}if(r===void 0){r=true}if(n){if(!Array.isArray(e)){throw new Ft("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}}if(!i){t=bt(t)}var u=new Array(e.length);for(var o=0,s=e.length;o<s;o++){u[o]=jt(t,e[o],n,true,r,o);t=u[o].newDocument}u.newDocument=t;return u}function Mt(t,e,n){var i=jt(t,e);if(i.test===false){throw new Ft("Test operation failed","TEST_OPERATION_FAILED",n,e,t)}return i.newDocument}function Bt(t,e,n,i){if(typeof t!=="object"||t===null||Array.isArray(t)){throw new Ft("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,t,n)}else if(!kt[t.op]){throw new Ft("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,t,n)}else if(typeof t.path!=="string"){throw new Ft("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,t,n)}else if(t.path.indexOf("/")!==0&&t.path.length>0){throw new Ft('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,t,n)}else if((t.op==="move"||t.op==="copy")&&typeof t.from!=="string"){throw new Ft("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,t,n)}else if((t.op==="add"||t.op==="replace"||t.op==="test")&&t.value===undefined){throw new Ft("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,t,n)}else if((t.op==="add"||t.op==="replace"||t.op==="test")&&At(t.value)){throw new Ft("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,t,n)}else if(n){if(t.op=="add"){var r=t.path.split("/").length;var u=i.split("/").length;if(r!==u+1&&r!==u){throw new Ft("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,t,n)}}else if(t.op==="replace"||t.op==="remove"||t.op==="_get"){if(t.path!==i){throw new Ft("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,t,n)}}else if(t.op==="move"||t.op==="copy"){var o={op:"_get",path:t.from,value:undefined};var s=St([o],n);if(s&&s.name==="OPERATION_PATH_UNRESOLVABLE"){throw new Ft("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,t,n)}}}}function St(t,e,n){try{if(!Array.isArray(t)){throw new Ft("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY")}if(e){Ct(bt(e),bt(t),n||true)}else{n=n||Bt;for(var i=0;i<t.length;i++){n(t[i],i,e,undefined)}}}catch(mat){if(mat instanceof Ft){return mat}else{throw mat}}}function _t(t,e){if(t===e)return true;if(t&&e&&typeof t=="object"&&typeof e=="object"){var n=Array.isArray(t),i=Array.isArray(e),r,u,o;if(n&&i){u=t.length;if(u!=e.length)return false;for(r=u;r--!==0;)if(!_t(t[r],e[r]))return false;return true}if(n!=i)return false;var s=Object.keys(t);u=s.length;if(u!==Object.keys(e).length)return false;for(r=u;r--!==0;)if(!e.hasOwnProperty(s[r]))return false;for(r=u;r--!==0;){o=s[r];if(!_t(t[o],e[o]))return false}return true}return t!==t&&e!==e}const Nt=Object.freeze({__proto__:null,JsonPatchError:Ft,deepClone:Dt,getValueByPointer:$t,applyOperation:jt,applyPatch:Ct,applyReducer:Mt,validator:Bt,validate:St,_areEquals:_t});
/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017 Joachim Wester
 * MIT license
 */var zt=new WeakMap;var Tt=function(){function t(t){this.observers=new Map;this.obj=t}return t}();var Pt=function(){function t(t,e){this.callback=t;this.observer=e}return t}();function Lt(t){return zt.get(t)}function It(t,e){return t.observers.get(e)}function Rt(t,e){t.observers.delete(e.callback)}function qt(t,e){e.unobserve()}function Ut(t,e){var n=[];var i;var r=Lt(t);if(!r){r=new Tt(t);zt.set(t,r)}else{var u=It(r,e);i=u&&u.observer}if(i){return i}i={};r.value=bt(t);if(e){i.callback=e;i.next=null;var o=function(){Wt(i)};var s=function(){clearTimeout(i.next);i.next=setTimeout(o)};if(typeof window!=="undefined"){window.addEventListener("mouseup",s);window.addEventListener("keyup",s);window.addEventListener("mousedown",s);window.addEventListener("keydown",s);window.addEventListener("change",s)}}i.patches=n;i.object=t;i.unobserve=function(){Wt(i);clearTimeout(i.next);Rt(r,i);if(typeof window!=="undefined"){window.removeEventListener("mouseup",s);window.removeEventListener("keyup",s);window.removeEventListener("mousedown",s);window.removeEventListener("keydown",s);window.removeEventListener("change",s)}};r.observers.set(e,new Pt(e,i));return i}function Wt(t,e){if(e===void 0){e=false}var n=zt.get(t.object);Gt(n.value,t.object,t.patches,"",e);if(t.patches.length){Ct(n.value,t.patches)}var i=t.patches;if(i.length>0){t.patches=[];if(t.callback){t.callback(i)}}return i}function Gt(t,e,n,i,r){if(e===t){return}if(typeof e.toJSON==="function"){e=e.toJSON()}var u=gt(e);var o=gt(t);var s=false;for(var a=o.length-1;a>=0;a--){var f=o[a];var c=t[f];if(mt(e,f)&&!(e[f]===undefined&&c!==undefined&&Array.isArray(e)===false)){var l=e[f];if(typeof c=="object"&&c!=null&&typeof l=="object"&&l!=null&&Array.isArray(c)===Array.isArray(l)){Gt(c,l,n,i+"/"+yt(f),r)}else{if(c!==l){if(r){n.push({op:"test",path:i+"/"+yt(f),value:bt(c)})}n.push({op:"replace",path:i+"/"+yt(f),value:bt(l)})}}}else if(Array.isArray(t)===Array.isArray(e)){if(r){n.push({op:"test",path:i+"/"+yt(f),value:bt(c)})}n.push({op:"remove",path:i+"/"+yt(f)});s=true}else{if(r){n.push({op:"test",path:i,value:t})}n.push({op:"replace",path:i,value:e})}}if(!s&&u.length==o.length){return}for(var a=0;a<u.length;a++){var f=u[a];if(!mt(t,f)&&e[f]!==undefined){n.push({op:"add",path:i+"/"+yt(f),value:bt(e[f])})}}}function Ht(t,e,n){if(n===void 0){n=false}var i=[];Gt(t,e,i,"",n);return i}const Vt=Object.freeze({__proto__:null,unobserve:qt,observe:Ut,generate:Wt,compare:Ht});Object.assign({},Nt,Vt,{JsonPatchError:Ot,deepClone:bt,escapePathComponent:yt,unescapePathComponent:wt});var Yt=/("(?:[^\\"]|\\.)*")|[:,]/g;var Xt=function t(e,n){var i,r,u;n=n||{};i=JSON.stringify([1],undefined,n.indent===undefined?2:n.indent).slice(2,-3);r=i===""?Infinity:n.maxLength===undefined?80:n.maxLength;u=n.replacer;return function t(e,n,o){var s,a,f,c,l,d,h,p,m,g,b,v;if(e&&typeof e.toJSON==="function"){e=e.toJSON()}b=JSON.stringify(e,u);if(b===undefined){return b}h=r-n.length-o;if(b.length<=h){m=b.replace(Yt,(function(t,e){return e||t+" "}));if(m.length<=h){return m}}if(u!=null){e=JSON.parse(b);u=undefined}if(typeof e==="object"&&e!==null){p=n+i;f=[];a=0;if(Array.isArray(e)){g="[";s="]";h=e.length;for(;a<h;a++){f.push(t(e[a],p,a===h-1?0:1)||"null")}}else{g="{";s="}";d=Object.keys(e);h=d.length;for(;a<h;a++){c=d[a];l=JSON.stringify(c)+": ";v=t(e[c],p,l.length+(a===h-1?0:1));if(v!==undefined){f.push(l+v)}}}if(f.length>0){return[g,i+f.join(",\n"+p),s].join("\n"+n)}}return b}(e,"",0)};function Jt(t,e,n){t.fields=e||[];t.fname=n;return t}function Qt(t){return t==null?null:t.fname}function Zt(t){return t==null?null:t.fields}function Kt(t){return t.length===1?te(t[0]):ee(t)}const te=t=>function(e){return e[t]};const ee=t=>{const e=t.length;return function(n){for(let i=0;i<e;++i){n=n[t[i]]}return n}};function ne(t){throw Error(t)}function ie(t){const e=[],n=t.length;let i=null,r=0,u="",o,s,a;t=t+"";function f(){e.push(u+t.substring(o,s));u="";o=s+1}for(o=s=0;s<n;++s){a=t[s];if(a==="\\"){u+=t.substring(o,s++);o=s}else if(a===i){f();i=null;r=-1}else if(i){continue}else if(o===r&&a==='"'){o=s+1;i=a}else if(o===r&&a==="'"){o=s+1;i=a}else if(a==="."&&!r){if(s>o){f()}else{o=s+1}}else if(a==="["){if(s>o)f();r=o=s+1}else if(a==="]"){if(!r)ne("Access path missing open bracket: "+t);if(r>0)f();r=0;o=s+1}}if(r)ne("Access path missing closing bracket: "+t);if(i)ne("Access path missing closing quote: "+t);if(s>o){s++;f()}return e}function re(t,e,n){const i=ie(t);t=i.length===1?i[0]:t;return Jt((n&&n.get||Kt)(i),[t],e||t)}const ue=re("id");const oe=Jt((t=>t),[],"identity");const se=Jt((()=>0),[],"zero");const ae=Jt((()=>1),[],"one");const fe=Jt((()=>true),[],"true");const ce=Jt((()=>false),[],"false");function le(t,e,n){const i=[e].concat([].slice.call(n));console[t].apply(console,i)}const de=0;const he=1;const pe=2;const me=3;const ge=4;function be(t,e){let n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:le;let i=t||de;return{level(t){if(arguments.length){i=+t;return this}else{return i}},error(){if(i>=he)n(e||"error","ERROR",arguments);return this},warn(){if(i>=pe)n(e||"warn","WARN",arguments);return this},info(){if(i>=me)n(e||"log","INFO",arguments);return this},debug(){if(i>=ge)n(e||"log","DEBUG",arguments);return this}}}var ve=Array.isArray;function ye(t){return t===Object(t)}const we=t=>t!=="__proto__";function Ae(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++){e[n]=arguments[n]}return e.reduce(((t,e)=>{for(const n in e){if(n==="signals"){t.signals=Oe(t.signals,e.signals)}else{const i=n==="legend"?{layout:1}:n==="style"?true:null;xe(t,n,e[n],i)}}return t}),{})}function xe(t,e,n,i){if(!we(e))return;let r,u;if(ye(n)&&!ve(n)){u=ye(t[e])?t[e]:t[e]={};for(r in n){if(i&&(i===true||i[r])){xe(u,r,n[r])}else if(we(r)){u[r]=n[r]}}}else{t[e]=n}}function Oe(t,e){if(t==null)return e;const n={},i=[];function r(t){if(!n[t.name]){n[t.name]=1;i.push(t)}}e.forEach(r);t.forEach(r);return i}function Fe(t){return t[t.length-1]}function De(t){return t==null||t===""?null:+t}const ke=t=>e=>t*Math.exp(e);const Ee=t=>e=>Math.log(t*e);const $e=t=>e=>Math.sign(e)*Math.log1p(Math.abs(e/t));const je=t=>e=>Math.sign(e)*Math.expm1(Math.abs(e))*t;const Ce=t=>e=>e<0?-Math.pow(-e,t):Math.pow(e,t);function Me(t,e,n,i){const r=n(t[0]),u=n(Fe(t)),o=(u-r)*e;return[i(r-o),i(u-o)]}function Be(t,e){return Me(t,e,De,oe)}function Se(t,e){var n=Math.sign(t[0]);return Me(t,e,Ee(n),ke(n))}function _e(t,e,n){return Me(t,e,Ce(n),Ce(1/n))}function Ne(t,e,n){return Me(t,e,$e(n),je(n))}function ze(t,e,n,i,r){const u=i(t[0]),o=i(Fe(t)),s=e!=null?i(e):(u+o)/2;return[r(s+(u-s)*n),r(s+(o-s)*n)]}function Te(t,e,n){return ze(t,e,n,De,oe)}function Pe(t,e,n){const i=Math.sign(t[0]);return ze(t,e,n,Ee(i),ke(i))}function Le(t,e,n,i){return ze(t,e,n,Ce(i),Ce(1/i))}function Ie(t,e,n,i){return ze(t,e,n,$e(i),je(i))}function Re(t){return 1+~~(new Date(t).getMonth()/3)}function qe(t){return 1+~~(new Date(t).getUTCMonth()/3)}function Ue(t){return t!=null?ve(t)?t:[t]:[]}function We(t,e,n){let i=t[0],r=t[1],u;if(r<i){u=r;r=i;i=u}u=r-i;return u>=n-e?[e,n]:[i=Math.min(Math.max(i,e),n-u),i+u]}function Ge(t){return typeof t==="function"}const He="descending";function Ve(t,e,n){n=n||{};e=Ue(e)||[];const i=[],r=[],u={},o=n.comparator||Xe;Ue(t).forEach(((t,o)=>{if(t==null)return;i.push(e[o]===He?-1:1);r.push(t=Ge(t)?t:re(t,null,n));(Zt(t)||[]).forEach((t=>u[t]=1))}));return r.length===0?null:Jt(o(r,i),Object.keys(u))}const Ye=(t,e)=>(t<e||t==null)&&e!=null?-1:(t>e||e==null)&&t!=null?1:(e=e instanceof Date?+e:e,t=t instanceof Date?+t:t)!==t&&e===e?-1:e!==e&&t===t?1:0;const Xe=(t,e)=>t.length===1?Je(t[0],e[0]):Qe(t,e,t.length);const Je=(t,e)=>function(n,i){return Ye(t(n),t(i))*e};const Qe=(t,e,n)=>{e.push(0);return function(i,r){let u,o=0,s=-1;while(o===0&&++s<n){u=t[s];o=Ye(u(i),u(r))}return o*e[s]}};function Ze(t){return Ge(t)?t:()=>t}function Ke(t,e){let n;return i=>{if(n)clearTimeout(n);n=setTimeout((()=>(e(i),n=null)),t)}}function tn(t){for(let e,n,i=1,r=arguments.length;i<r;++i){e=arguments[i];for(n in e){t[n]=e[n]}}return t}function en(t,e){let n=0,i,r,u,o;if(t&&(i=t.length)){if(e==null){for(r=t[n];n<i&&(r==null||r!==r);r=t[++n]);u=o=r;for(;n<i;++n){r=t[n];if(r!=null){if(r<u)u=r;if(r>o)o=r}}}else{for(r=e(t[n]);n<i&&(r==null||r!==r);r=e(t[++n]));u=o=r;for(;n<i;++n){r=e(t[n]);if(r!=null){if(r<u)u=r;if(r>o)o=r}}}}return[u,o]}function nn(t,e){const n=t.length;let i=-1,r,u,o,s,a;if(e==null){while(++i<n){u=t[i];if(u!=null&&u>=u){r=o=u;break}}if(i===n)return[-1,-1];s=a=i;while(++i<n){u=t[i];if(u!=null){if(r>u){r=u;s=i}if(o<u){o=u;a=i}}}}else{while(++i<n){u=e(t[i],i,t);if(u!=null&&u>=u){r=o=u;break}}if(i===n)return[-1,-1];s=a=i;while(++i<n){u=e(t[i],i,t);if(u!=null){if(r>u){r=u;s=i}if(o<u){o=u;a=i}}}}return[s,a]}const rn=Object.prototype.hasOwnProperty;function un(t,e){return rn.call(t,e)}const on={};function sn(t){let e={},n;function i(t){return un(e,t)&&e[t]!==on}const r={size:0,empty:0,object:e,has:i,get(t){return i(t)?e[t]:undefined},set(t,n){if(!i(t)){++r.size;if(e[t]===on)--r.empty}e[t]=n;return this},delete(t){if(i(t)){--r.size;++r.empty;e[t]=on}return this},clear(){r.size=r.empty=0;r.object=e={}},test(t){if(arguments.length){n=t;return r}else{return n}},clean(){const t={};let i=0;for(const r in e){const u=e[r];if(u!==on&&(!n||!n(u))){t[r]=u;++i}}r.size=i;r.empty=0;r.object=e=t}};if(t)Object.keys(t).forEach((e=>{r.set(e,t[e])}));return r}function an(t,e,n,i,r,u){if(!n&&n!==0)return u;const o=+n;let s=t[0],a=Fe(t),f;if(a<s){f=s;s=a;a=f}f=Math.abs(e-s);const c=Math.abs(a-e);return f<c&&f<=o?i:c<=o?r:u}function fn(t,e,n){const i=t.prototype=Object.create(e.prototype);Object.defineProperty(i,"constructor",{value:t,writable:true,enumerable:true,configurable:true});return tn(i,n)}function cn(t,e,n,i){let r=e[0],u=e[e.length-1],o;if(r>u){o=r;r=u;u=o}n=n===undefined||n;i=i===undefined||i;return(n?r<=t:r<t)&&(i?t<=u:t<u)}function ln(t){return typeof t==="boolean"}function dn(t){return Object.prototype.toString.call(t)==="[object Date]"}function hn(t){return t&&Ge(t[Symbol.iterator])}function pn(t){return typeof t==="number"}function mn(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function gn(t){return typeof t==="string"}function bn(t,e,n){if(t){t=e?Ue(t).map((t=>t.replace(/\\(.)/g,"$1"))):Ue(t)}const i=t&&t.length,r=n&&n.get||Kt,u=t=>r(e?[t]:ie(t));let o;if(!i){o=function(){return""}}else if(i===1){const e=u(t[0]);o=function(t){return""+e(t)}}else{const e=t.map(u);o=function(t){let n=""+e[0](t),r=0;while(++r<i)n+="|"+e[r](t);return n}}return Jt(o,t,"key")}function vn(t,e){const n=t[0],i=Fe(t),r=+e;return!r?n:r===1?i:n+r*(i-n)}const yn=1e4;function wn(t){t=+t||yn;let e,n,i;const r=()=>{e={};n={};i=0};const u=(r,u)=>{if(++i>t){n=e;e={};i=1}return e[r]=u};r();return{clear:r,has:t=>un(e,t)||un(n,t),get:t=>un(e,t)?e[t]:un(n,t)?u(t,n[t]):undefined,set:(t,n)=>un(e,t)?e[t]=n:u(t,n)}}function An(t,e,n,i){const r=e.length,u=n.length;if(!u)return e;if(!r)return n;const o=i||new e.constructor(r+u);let s=0,a=0,f=0;for(;s<r&&a<u;++f){o[f]=t(e[s],n[a])>0?n[a++]:e[s++]}for(;s<r;++s,++f){o[f]=e[s]}for(;a<u;++a,++f){o[f]=n[a]}return o}function xn(t,e){let n="";while(--e>=0)n+=t;return n}function On(t,e,n,i){const r=n||" ",u=t+"",o=e-u.length;return o<=0?u:i==="left"?xn(r,o)+u:i==="center"?xn(r,~~(o/2))+u+xn(r,Math.ceil(o/2)):u+xn(r,o)}function Fn(t){return t&&Fe(t)-t[0]||0}function Dn(t){return ve(t)?"["+t.map(Dn)+"]":ye(t)||gn(t)?JSON.stringify(t).replace("\u2028","\\u2028").replace("\u2029","\\u2029"):t}function kn(t){return t==null||t===""?null:!t||t==="false"||t==="0"?false:!!t}const En=t=>pn(t)?t:dn(t)?t:Date.parse(t);function $n(t,e){e=e||En;return t==null||t===""?null:e(t)}function jn(t){return t==null||t===""?null:t+""}function Cn(t){const e={},n=t.length;for(let i=0;i<n;++i)e[t[i]]=true;return e}function Mn(t,e,n,i){const r=i!=null?i:"…",u=t+"",o=u.length,s=Math.max(0,e-r.length);return o<=e?u:n==="left"?r+u.slice(o-s):n==="center"?u.slice(0,Math.ceil(s/2))+r+u.slice(o-~~(s/2)):u.slice(0,s)+r}function Bn(t,e,n){if(t){if(e){const i=t.length;for(let r=0;r<i;++r){const i=e(t[r]);if(i)n(i,r,t)}}else{t.forEach(n)}}}var Sn={},_n={},Nn=34,zn=10,Tn=13;function Pn(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function Ln(t,e){var n=Pn(t);return function(i,r){return e(n(i),r,t)}}function In(t){var e=Object.create(null),n=[];t.forEach((function(t){for(var i in t){if(!(i in e)){n.push(e[i]=i)}}}));return n}function Rn(t,e){var n=t+"",i=n.length;return i<e?new Array(e-i+1).join(0)+n:n}function qn(t){return t<0?"-"+Rn(-t,6):t>9999?"+"+Rn(t,6):Rn(t,4)}function Un(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),i=t.getUTCSeconds(),r=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":qn(t.getUTCFullYear())+"-"+Rn(t.getUTCMonth()+1,2)+"-"+Rn(t.getUTCDate(),2)+(r?"T"+Rn(e,2)+":"+Rn(n,2)+":"+Rn(i,2)+"."+Rn(r,3)+"Z":i?"T"+Rn(e,2)+":"+Rn(n,2)+":"+Rn(i,2)+"Z":n||e?"T"+Rn(e,2)+":"+Rn(n,2)+"Z":"")}function Wn(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function i(t,e){var n,i,u=r(t,(function(t,r){if(n)return n(t,r-1);i=t,n=e?Ln(t,e):Pn(t)}));u.columns=i||[];return u}function r(t,e){var i=[],r=t.length,u=0,o=0,s,a=r<=0,f=false;if(t.charCodeAt(r-1)===zn)--r;if(t.charCodeAt(r-1)===Tn)--r;function c(){if(a)return _n;if(f)return f=false,Sn;var e,i=u,o;if(t.charCodeAt(i)===Nn){while(u++<r&&t.charCodeAt(u)!==Nn||t.charCodeAt(++u)===Nn);if((e=u)>=r)a=true;else if((o=t.charCodeAt(u++))===zn)f=true;else if(o===Tn){f=true;if(t.charCodeAt(u)===zn)++u}return t.slice(i+1,e-1).replace(/""/g,'"')}while(u<r){if((o=t.charCodeAt(e=u++))===zn)f=true;else if(o===Tn){f=true;if(t.charCodeAt(u)===zn)++u}else if(o!==n)continue;return t.slice(i,e)}return a=true,t.slice(i,r)}while((s=c())!==_n){var l=[];while(s!==Sn&&s!==_n)l.push(s),s=c();if(e&&(l=e(l,o++))==null)continue;i.push(l)}return i}function u(e,n){return e.map((function(e){return n.map((function(t){return c(e[t])})).join(t)}))}function o(e,n){if(n==null)n=In(e);return[n.map(c).join(t)].concat(u(e,n)).join("\n")}function s(t,e){if(e==null)e=In(t);return u(t,e).join("\n")}function a(t){return t.map(f).join("\n")}function f(e){return e.map(c).join(t)}function c(t){return t==null?"":t instanceof Date?Un(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:i,parseRows:r,format:o,formatBody:s,formatRows:a,formatRow:f,formatValue:c}}function Gn(t){return t}function Hn(t){if(t==null)return Gn;var e,n,i=t.scale[0],r=t.scale[1],u=t.translate[0],o=t.translate[1];return function(t,s){if(!s)e=n=0;var a=2,f=t.length,c=new Array(f);c[0]=(e+=t[0])*i+u;c[1]=(n+=t[1])*r+o;while(a<f)c[a]=t[a],++a;return c}}function Vn(t,e){var n,i=t.length,r=i-e;while(r<--i)n=t[r],t[r++]=t[i],t[i]=n}function Yn(t,e){if(typeof e==="string")e=t.objects[e];return e.type==="GeometryCollection"?{type:"FeatureCollection",features:e.geometries.map((function(e){return Xn(t,e)}))}:Xn(t,e)}function Xn(t,e){var n=e.id,i=e.bbox,r=e.properties==null?{}:e.properties,u=Jn(t,e);return n==null&&i==null?{type:"Feature",properties:r,geometry:u}:i==null?{type:"Feature",id:n,properties:r,geometry:u}:{type:"Feature",id:n,bbox:i,properties:r,geometry:u}}function Jn(t,e){var n=Hn(t.transform),i=t.arcs;function r(t,e){if(e.length)e.pop();for(var r=i[t<0?~t:t],u=0,o=r.length;u<o;++u){e.push(n(r[u],u))}if(t<0)Vn(e,o)}function u(t){return n(t)}function o(t){var e=[];for(var n=0,i=t.length;n<i;++n)r(t[n],e);if(e.length<2)e.push(e[0]);return e}function s(t){var e=o(t);while(e.length<4)e.push(e[0]);return e}function a(t){return t.map(s)}function f(t){var e=t.type,n;switch(e){case"GeometryCollection":return{type:e,geometries:t.geometries.map(f)};case"Point":n=u(t.coordinates);break;case"MultiPoint":n=t.coordinates.map(u);break;case"LineString":n=o(t.arcs);break;case"MultiLineString":n=t.arcs.map(o);break;case"Polygon":n=a(t.arcs);break;case"MultiPolygon":n=t.arcs.map(a);break;default:return null}return{type:e,coordinates:n}}return f(e)}function Qn(t,e){var n={},i={},r={},u=[],o=-1;e.forEach((function(n,i){var r=t.arcs[n<0?~n:n],u;if(r.length<3&&!r[1][0]&&!r[1][1]){u=e[++o],e[o]=n,e[i]=u}}));e.forEach((function(t){var e=s(t),n=e[0],u=e[1],o,a;if(o=r[n]){delete r[o.end];o.push(t);o.end=u;if(a=i[u]){delete i[a.start];var f=a===o?o:o.concat(a);i[f.start=o.start]=r[f.end=a.end]=f}else{i[o.start]=r[o.end]=o}}else if(o=i[u]){delete i[o.start];o.unshift(t);o.start=n;if(a=r[n]){delete r[a.end];var c=a===o?o:a.concat(o);i[c.start=a.start]=r[c.end=o.end]=c}else{i[o.start]=r[o.end]=o}}else{o=[t];i[o.start=n]=r[o.end=u]=o}}));function s(e){var n=t.arcs[e<0?~e:e],i=n[0],r;if(t.transform)r=[0,0],n.forEach((function(t){r[0]+=t[0],r[1]+=t[1]}));else r=n[n.length-1];return e<0?[r,i]:[i,r]}function a(t,e){for(var i in t){var r=t[i];delete e[r.start];delete r.start;delete r.end;r.forEach((function(t){n[t<0?~t:t]=1}));u.push(r)}}a(r,i);a(i,r);e.forEach((function(t){if(!n[t<0?~t:t])u.push([t])}));return u}function Zn(t){return Jn(t,Kn.apply(this,arguments))}function Kn(t,e,n){var i,r,u;if(arguments.length>1)i=ti(t,e,n);else for(r=0,i=new Array(u=t.arcs.length);r<u;++r)i[r]=r;return{type:"MultiLineString",arcs:Qn(t,i)}}function ti(t,e,n){var i=[],r=[],u;function o(t){var e=t<0?~t:t;(r[e]||(r[e]=[])).push({i:t,g:u})}function s(t){t.forEach(o)}function a(t){t.forEach(s)}function f(t){t.forEach(a)}function c(t){switch(u=t,t.type){case"GeometryCollection":t.geometries.forEach(c);break;case"LineString":s(t.arcs);break;case"MultiLineString":case"Polygon":a(t.arcs);break;case"MultiPolygon":f(t.arcs);break}}c(e);r.forEach(n==null?function(t){i.push(t[0].i)}:function(t){if(n(t[0].g,t[t.length-1].g))i.push(t[0].i)});return i}function ei(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function ni(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function ii(t){let e,n,i;if(t.length!==2){e=ei;n=(e,n)=>ei(t(e),n);i=(e,n)=>t(e)-n}else{e=t===ei||t===ni?t:ri;n=t;i=t}function r(t,i,r=0,u=t.length){if(r<u){if(e(i,i)!==0)return u;do{const e=r+u>>>1;if(n(t[e],i)<0)r=e+1;else u=e}while(r<u)}return r}function u(t,i,r=0,u=t.length){if(r<u){if(e(i,i)!==0)return u;do{const e=r+u>>>1;if(n(t[e],i)<=0)r=e+1;else u=e}while(r<u)}return r}function o(t,e,n=0,u=t.length){const o=r(t,e,n,u-1);return o>n&&i(t[o-1],e)>-i(t[o],e)?o-1:o}return{left:r,center:o,right:u}}function ri(){return 0}function ui(t){return t===null?NaN:+t}function*oi(t,e){if(e===undefined){for(let e of t){if(e!=null&&(e=+e)>=e){yield e}}}else{let n=-1;for(let i of t){if((i=e(i,++n,t))!=null&&(i=+i)>=i){yield i}}}}const si=ii(ei);const ai=si.right;const fi=si.left;ii(ui).center;function ci(t,e){let n=0;let i;let r=0;let u=0;if(e===undefined){for(let e of t){if(e!=null&&(e=+e)>=e){i=e-r;r+=i/++n;u+=i*(e-r)}}}else{let o=-1;for(let s of t){if((s=e(s,++o,t))!=null&&(s=+s)>=s){i=s-r;r+=i/++n;u+=i*(s-r)}}}if(n>1)return u/(n-1)}function li(t,e){const n=ci(t,e);return n?Math.sqrt(n):n}class di{constructor(){this._partials=new Float64Array(32);this._n=0}add(t){const e=this._partials;let n=0;for(let i=0;i<this._n&&i<32;i++){const r=e[i],u=t+r,o=Math.abs(t)<Math.abs(r)?t-(u-r):r-(u-t);if(o)e[n++]=o;t=u}e[n]=t;this._n=n+1;return this}valueOf(){const t=this._partials;let e=this._n,n,i,r,u=0;if(e>0){u=t[--e];while(e>0){n=u;i=t[--e];u=n+i;r=i-(u-n);if(r)break}if(e>0&&(r<0&&t[e-1]<0||r>0&&t[e-1]>0)){i=r*2;n=u+i;if(i==n-u)u=n}}return u}}class hi extends Map{constructor(t,e=vi){super();Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}});if(t!=null)for(const[n,i]of t)this.set(n,i)}get(t){return super.get(mi(this,t))}has(t){return super.has(mi(this,t))}set(t,e){return super.set(gi(this,t),e)}delete(t){return super.delete(bi(this,t))}}class pi extends Set{constructor(t,e=vi){super();Object.defineProperties(this,{_intern:{value:new Map},_key:{value:e}});if(t!=null)for(const n of t)this.add(n)}has(t){return super.has(mi(this,t))}add(t){return super.add(gi(this,t))}delete(t){return super.delete(bi(this,t))}}function mi({_intern:t,_key:e},n){const i=e(n);return t.has(i)?t.get(i):n}function gi({_intern:t,_key:e},n){const i=e(n);if(t.has(i))return t.get(i);t.set(i,n);return n}function bi({_intern:t,_key:e},n){const i=e(n);if(t.has(i)){n=t.get(i);t.delete(i)}return n}function vi(t){return t!==null&&typeof t==="object"?t.valueOf():t}function yi(t,e){return Array.from(e,(e=>t[e]))}function wi(t=ei){if(t===ei)return Ai;if(typeof t!=="function")throw new TypeError("compare is not a function");return(e,n)=>{const i=t(e,n);if(i||i===0)return i;return(t(n,n)===0)-(t(e,e)===0)}}function Ai(t,e){return(t==null||!(t>=t))-(e==null||!(e>=e))||(t<e?-1:t>e?1:0)}const xi=Math.sqrt(50),Oi=Math.sqrt(10),Fi=Math.sqrt(2);function Di(t,e,n){const i=(e-t)/Math.max(0,n),r=Math.floor(Math.log10(i)),u=i/Math.pow(10,r),o=u>=xi?10:u>=Oi?5:u>=Fi?2:1;let s,a,f;if(r<0){f=Math.pow(10,-r)/o;s=Math.round(t*f);a=Math.round(e*f);if(s/f<t)++s;if(a/f>e)--a;f=-f}else{f=Math.pow(10,r)*o;s=Math.round(t/f);a=Math.round(e/f);if(s*f<t)++s;if(a*f>e)--a}if(a<s&&.5<=n&&n<2)return Di(t,e,n*2);return[s,a,f]}function ki(t,e,n){e=+e,t=+t,n=+n;if(!(n>0))return[];if(t===e)return[t];const i=e<t,[r,u,o]=i?Di(e,t,n):Di(t,e,n);if(!(u>=r))return[];const s=u-r+1,a=new Array(s);if(i){if(o<0)for(let t=0;t<s;++t)a[t]=(u-t)/-o;else for(let t=0;t<s;++t)a[t]=(u-t)*o}else{if(o<0)for(let t=0;t<s;++t)a[t]=(r+t)/-o;else for(let t=0;t<s;++t)a[t]=(r+t)*o}return a}function Ei(t,e,n){e=+e,t=+t,n=+n;return Di(t,e,n)[2]}function $i(t,e,n){e=+e,t=+t,n=+n;const i=e<t,r=i?Ei(e,t,n):Ei(t,e,n);return(i?-1:1)*(r<0?1/-r:r)}function ji(t,e){let n;if(e===undefined){for(const e of t){if(e!=null&&(n<e||n===undefined&&e>=e)){n=e}}}else{let i=-1;for(let r of t){if((r=e(r,++i,t))!=null&&(n<r||n===undefined&&r>=r)){n=r}}}return n}function Ci(t,e){let n;if(e===undefined){for(const e of t){if(e!=null&&(n>e||n===undefined&&e>=e)){n=e}}}else{let i=-1;for(let r of t){if((r=e(r,++i,t))!=null&&(n>r||n===undefined&&r>=r)){n=r}}}return n}function Mi(t,e,n=0,i=Infinity,r){e=Math.floor(e);n=Math.floor(Math.max(0,n));i=Math.floor(Math.min(t.length-1,i));if(!(n<=e&&e<=i))return t;r=r===undefined?Ai:wi(r);while(i>n){if(i-n>600){const u=i-n+1;const o=e-n+1;const s=Math.log(u);const a=.5*Math.exp(2*s/3);const f=.5*Math.sqrt(s*a*(u-a)/u)*(o-u/2<0?-1:1);const c=Math.max(n,Math.floor(e-o*a/u+f));const l=Math.min(i,Math.floor(e+(u-o)*a/u+f));Mi(t,e,c,l,r)}const u=t[e];let o=n;let s=i;Bi(t,n,e);if(r(t[i],u)>0)Bi(t,n,i);while(o<s){Bi(t,o,s),++o,--s;while(r(t[o],u)<0)++o;while(r(t[s],u)>0)--s}if(r(t[n],u)===0)Bi(t,n,s);else++s,Bi(t,s,i);if(s<=e)n=s+1;if(e<=s)i=s-1}return t}function Bi(t,e,n){const i=t[e];t[e]=t[n];t[n]=i}function Si(t,e,n){t=Float64Array.from(oi(t,n));if(!(i=t.length)||isNaN(e=+e))return;if(e<=0||i<2)return Ci(t);if(e>=1)return ji(t);var i,r=(i-1)*e,u=Math.floor(r),o=ji(Mi(t,u).subarray(0,u+1)),s=Ci(t.subarray(u+1));return o+(s-o)*(r-u)}function _i(t,e,n=ui){if(!(i=t.length)||isNaN(e=+e))return;if(e<=0||i<2)return+n(t[0],0,t);if(e>=1)return+n(t[i-1],i-1,t);var i,r=(i-1)*e,u=Math.floor(r),o=+n(t[u],u,t),s=+n(t[u+1],u+1,t);return o+(s-o)*(r-u)}function Ni(t,e){let n=0;let i=0;if(e===undefined){for(let e of t){if(e!=null&&(e=+e)>=e){++n,i+=e}}}else{let r=-1;for(let u of t){if((u=e(u,++r,t))!=null&&(u=+u)>=u){++n,i+=u}}}if(n)return i/n}function zi(t,e){return Si(t,.5,e)}function*Ti(t){for(const e of t){yield*e}}function Pi(t){return Array.from(Ti(t))}function Li(t,e,n){t=+t,e=+e,n=(r=arguments.length)<2?(e=t,t=0,1):r<3?1:+n;var i=-1,r=Math.max(0,Math.ceil((e-t)/n))|0,u=new Array(r);while(++i<r){u[i]=t+i*n}return u}function Ii(t,e){let n=0;if(e===undefined){for(let e of t){if(e=+e){n+=e}}}else{let i=-1;for(let r of t){if(r=+e(r,++i,t)){n+=r}}}return n}function Ri(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function qi(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,i=t.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+t.slice(n+1)]}function Ui(t){return t=qi(Math.abs(t)),t?t[1]:NaN}function Wi(t,e){return function(n,i){var r=n.length,u=[],o=0,s=t[0],a=0;while(r>0&&s>0){if(a+s+1>i)s=Math.max(1,i-a);u.push(n.substring(r-=s,r+s));if((a+=s+1)>i)break;s=t[o=(o+1)%t.length]}return u.reverse().join(e)}}function Gi(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}var Hi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Vi(t){if(!(e=Hi.exec(t)))throw new Error("invalid format: "+t);var e;return new Yi({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Vi.prototype=Yi.prototype;function Yi(t){this.fill=t.fill===undefined?" ":t.fill+"";this.align=t.align===undefined?">":t.align+"";this.sign=t.sign===undefined?"-":t.sign+"";this.symbol=t.symbol===undefined?"":t.symbol+"";this.zero=!!t.zero;this.width=t.width===undefined?undefined:+t.width;this.comma=!!t.comma;this.precision=t.precision===undefined?undefined:+t.precision;this.trim=!!t.trim;this.type=t.type===undefined?"":t.type+""}Yi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===undefined?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===undefined?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Xi(t){t:for(var e=t.length,n=1,i=-1,r;n<e;++n){switch(t[n]){case".":i=r=n;break;case"0":if(i===0)i=n;r=n;break;default:if(!+t[n])break t;if(i>0)i=0;break}}return i>0?t.slice(0,i)+t.slice(r+1):t}var Ji;function Qi(t,e){var n=qi(t,e);if(!n)return t+"";var i=n[0],r=n[1],u=r-(Ji=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return u===o?i:u>o?i+new Array(u-o+1).join("0"):u>0?i.slice(0,u)+"."+i.slice(u):"0."+new Array(1-u).join("0")+qi(t,Math.max(0,e+u-1))[0]}function Zi(t,e){var n=qi(t,e);if(!n)return t+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Ki={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:Ri,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Zi(t*100,e),r:Zi,s:Qi,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function tr(t){return t}var er=Array.prototype.map,nr=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ir(t){var e=t.grouping===undefined||t.thousands===undefined?tr:Wi(er.call(t.grouping,Number),t.thousands+""),n=t.currency===undefined?"":t.currency[0]+"",i=t.currency===undefined?"":t.currency[1]+"",r=t.decimal===undefined?".":t.decimal+"",u=t.numerals===undefined?tr:Gi(er.call(t.numerals,String)),o=t.percent===undefined?"%":t.percent+"",s=t.minus===undefined?"−":t.minus+"",a=t.nan===undefined?"NaN":t.nan+"";function f(t){t=Vi(t);var f=t.fill,c=t.align,l=t.sign,d=t.symbol,h=t.zero,p=t.width,m=t.comma,g=t.precision,b=t.trim,v=t.type;if(v==="n")m=true,v="g";else if(!Ki[v])g===undefined&&(g=12),b=true,v="g";if(h||f==="0"&&c==="=")h=true,f="0",c="=";var y=d==="$"?n:d==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():"",w=d==="$"?i:/[%p]/.test(v)?o:"";var A=Ki[v],x=/[defgprs%]/.test(v);g=g===undefined?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g));function O(t){var n=y,i=w,o,d,O;if(v==="c"){i=A(t)+i;t=""}else{t=+t;var F=t<0||1/t<0;t=isNaN(t)?a:A(Math.abs(t),g);if(b)t=Xi(t);if(F&&+t===0&&l!=="+")F=false;n=(F?l==="("?l:s:l==="-"||l==="("?"":l)+n;i=(v==="s"?nr[8+Ji/3]:"")+i+(F&&l==="("?")":"");if(x){o=-1,d=t.length;while(++o<d){if(O=t.charCodeAt(o),48>O||O>57){i=(O===46?r+t.slice(o+1):t.slice(o))+i;t=t.slice(0,o);break}}}}if(m&&!h)t=e(t,Infinity);var D=n.length+t.length+i.length,k=D<p?new Array(p-D+1).join(f):"";if(m&&h)t=e(k+t,k.length?p-i.length:Infinity),k="";switch(c){case"<":t=n+t+i+k;break;case"=":t=n+k+t+i;break;case"^":t=k.slice(0,D=k.length>>1)+n+t+i+k.slice(D);break;default:t=k+n+t+i;break}return u(t)}O.toString=function(){return t+""};return O}function c(t,e){var n=f((t=Vi(t),t.type="f",t)),i=Math.max(-8,Math.min(8,Math.floor(Ui(e)/3)))*3,r=Math.pow(10,-i),u=nr[8+i/3];return function(t){return n(r*t)+u}}return{format:f,formatPrefix:c}}var rr;var ur;var or;sr({thousands:",",grouping:[3],currency:["$",""]});function sr(t){rr=ir(t);ur=rr.format;or=rr.formatPrefix;return rr}function ar(t){return Math.max(0,-Ui(Math.abs(t)))}function fr(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ui(e)/3)))*3-Ui(Math.abs(t)))}function cr(t,e){t=Math.abs(t),e=Math.abs(e)-t;return Math.max(0,Ui(e)-Ui(t))+1}const lr=new Date,dr=new Date;function hr(t,e,n,i){function r(e){return t(e=arguments.length===0?new Date:new Date(+e)),e}r.floor=e=>(t(e=new Date(+e)),e);r.ceil=n=>(t(n=new Date(n-1)),e(n,1),t(n),n);r.round=t=>{const e=r(t),n=r.ceil(t);return t-e<n-t?e:n};r.offset=(t,n)=>(e(t=new Date(+t),n==null?1:Math.floor(n)),t);r.range=(n,i,u)=>{const o=[];n=r.ceil(n);u=u==null?1:Math.floor(u);if(!(n<i)||!(u>0))return o;let s;do{o.push(s=new Date(+n)),e(n,u),t(n)}while(s<n&&n<i);return o};r.filter=n=>hr((e=>{if(e>=e)while(t(e),!n(e))e.setTime(e-1)}),((t,i)=>{if(t>=t){if(i<0)while(++i<=0){while(e(t,-1),!n(t)){}}else while(--i>=0){while(e(t,+1),!n(t)){}}}}));if(n){r.count=(e,i)=>{lr.setTime(+e),dr.setTime(+i);t(lr),t(dr);return Math.floor(n(lr,dr))};r.every=t=>{t=Math.floor(t);return!isFinite(t)||!(t>0)?null:!(t>1)?r:r.filter(i?e=>i(e)%t===0:e=>r.count(0,e)%t===0)}}return r}const pr=hr((()=>{}),((t,e)=>{t.setTime(+t+e)}),((t,e)=>e-t));pr.every=t=>{t=Math.floor(t);if(!isFinite(t)||!(t>0))return null;if(!(t>1))return pr;return hr((e=>{e.setTime(Math.floor(e/t)*t)}),((e,n)=>{e.setTime(+e+n*t)}),((e,n)=>(n-e)/t))};const mr=1e3;const gr=mr*60;const br=gr*60;const vr=br*24;const yr=vr*7;const wr=vr*30;const Ar=vr*365;const xr=hr((t=>{t.setTime(t-t.getMilliseconds())}),((t,e)=>{t.setTime(+t+e*mr)}),((t,e)=>(e-t)/mr),(t=>t.getUTCSeconds()));const Or=hr((t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*mr)}),((t,e)=>{t.setTime(+t+e*gr)}),((t,e)=>(e-t)/gr),(t=>t.getMinutes()));const Fr=hr((t=>{t.setUTCSeconds(0,0)}),((t,e)=>{t.setTime(+t+e*gr)}),((t,e)=>(e-t)/gr),(t=>t.getUTCMinutes()));const Dr=hr((t=>{t.setTime(t-t.getMilliseconds()-t.getSeconds()*mr-t.getMinutes()*gr)}),((t,e)=>{t.setTime(+t+e*br)}),((t,e)=>(e-t)/br),(t=>t.getHours()));const kr=hr((t=>{t.setUTCMinutes(0,0,0)}),((t,e)=>{t.setTime(+t+e*br)}),((t,e)=>(e-t)/br),(t=>t.getUTCHours()));const Er=hr((t=>t.setHours(0,0,0,0)),((t,e)=>t.setDate(t.getDate()+e)),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*gr)/vr),(t=>t.getDate()-1));const $r=hr((t=>{t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e)}),((t,e)=>(e-t)/vr),(t=>t.getUTCDate()-1));const jr=hr((t=>{t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e)}),((t,e)=>(e-t)/vr),(t=>Math.floor(t/vr)));function Cr(t){return hr((e=>{e.setDate(e.getDate()-(e.getDay()+7-t)%7);e.setHours(0,0,0,0)}),((t,e)=>{t.setDate(t.getDate()+e*7)}),((t,e)=>(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*gr)/yr))}const Mr=Cr(0);const Br=Cr(1);Cr(2);Cr(3);const Sr=Cr(4);Cr(5);Cr(6);function _r(t){return hr((e=>{e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7);e.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCDate(t.getUTCDate()+e*7)}),((t,e)=>(e-t)/yr))}const Nr=_r(0);const zr=_r(1);_r(2);_r(3);const Tr=_r(4);_r(5);_r(6);const Pr=hr((t=>{t.setDate(1);t.setHours(0,0,0,0)}),((t,e)=>{t.setMonth(t.getMonth()+e)}),((t,e)=>e.getMonth()-t.getMonth()+(e.getFullYear()-t.getFullYear())*12),(t=>t.getMonth()));const Lr=hr((t=>{t.setUTCDate(1);t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCMonth(t.getUTCMonth()+e)}),((t,e)=>e.getUTCMonth()-t.getUTCMonth()+(e.getUTCFullYear()-t.getUTCFullYear())*12),(t=>t.getUTCMonth()));const Ir=hr((t=>{t.setMonth(0,1);t.setHours(0,0,0,0)}),((t,e)=>{t.setFullYear(t.getFullYear()+e)}),((t,e)=>e.getFullYear()-t.getFullYear()),(t=>t.getFullYear()));Ir.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:hr((e=>{e.setFullYear(Math.floor(e.getFullYear()/t)*t);e.setMonth(0,1);e.setHours(0,0,0,0)}),((e,n)=>{e.setFullYear(e.getFullYear()+n*t)}));const Rr=hr((t=>{t.setUTCMonth(0,1);t.setUTCHours(0,0,0,0)}),((t,e)=>{t.setUTCFullYear(t.getUTCFullYear()+e)}),((t,e)=>e.getUTCFullYear()-t.getUTCFullYear()),(t=>t.getUTCFullYear()));Rr.every=t=>!isFinite(t=Math.floor(t))||!(t>0)?null:hr((e=>{e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t);e.setUTCMonth(0,1);e.setUTCHours(0,0,0,0)}),((e,n)=>{e.setUTCFullYear(e.getUTCFullYear()+n*t)}));function qr(t,e,n,i,r,u){const o=[[xr,1,mr],[xr,5,5*mr],[xr,15,15*mr],[xr,30,30*mr],[u,1,gr],[u,5,5*gr],[u,15,15*gr],[u,30,30*gr],[r,1,br],[r,3,3*br],[r,6,6*br],[r,12,12*br],[i,1,vr],[i,2,2*vr],[n,1,yr],[e,1,wr],[e,3,3*wr],[t,1,Ar]];function s(t,e,n){const i=e<t;if(i)[t,e]=[e,t];const r=n&&typeof n.range==="function"?n:a(t,e,n);const u=r?r.range(t,+e+1):[];return i?u.reverse():u}function a(e,n,i){const r=Math.abs(n-e)/i;const u=ii((([,,t])=>t)).right(o,r);if(u===o.length)return t.every($i(e/Ar,n/Ar,i));if(u===0)return pr.every(Math.max($i(e,n,i),1));const[s,a]=o[r/o[u-1][2]<o[u][2]/r?u-1:u];return s.every(a)}return[s,a]}const[Ur,Wr]=qr(Rr,Lr,Nr,jr,kr,Fr);const[Gr,Hr]=qr(Ir,Pr,Mr,Er,Dr,Or);const Vr="year";const Yr="quarter";const Xr="month";const Jr="week";const Qr="date";const Zr="day";const Kr="dayofyear";const tu="hours";const eu="minutes";const nu="seconds";const iu="milliseconds";const ru=[Vr,Yr,Xr,Jr,Qr,Zr,Kr,tu,eu,nu,iu];const uu=ru.reduce(((t,e,n)=>(t[e]=1+n,t)),{});function ou(t){const e=Ue(t).slice(),n={};if(!e.length)ne("Missing time unit.");e.forEach((t=>{if(un(uu,t)){n[t]=1}else{ne(`Invalid time unit: ${t}.`)}}));const i=(n[Jr]||n[Zr]?1:0)+(n[Yr]||n[Xr]||n[Qr]?1:0)+(n[Kr]?1:0);if(i>1){ne(`Incompatible time units: ${t}`)}e.sort(((t,e)=>uu[t]-uu[e]));return e}const su={[Vr]:"%Y ",[Yr]:"Q%q ",[Xr]:"%b ",[Qr]:"%d ",[Jr]:"W%U ",[Zr]:"%a ",[Kr]:"%j ",[tu]:"%H:00",[eu]:"00:%M",[nu]:":%S",[iu]:".%L",[`${Vr}-${Xr}`]:"%Y-%m ",[`${Vr}-${Xr}-${Qr}`]:"%Y-%m-%d ",[`${tu}-${eu}`]:"%H:%M"};function au(t,e){const n=tn({},su,e),i=ou(t),r=i.length;let u="",o=0,s,a;for(o=0;o<r;){for(s=i.length;s>o;--s){a=i.slice(o,s).join("-");if(n[a]!=null){u+=n[a];o=s;break}}}return u.trim()}const fu=new Date;function cu(t){fu.setFullYear(t);fu.setMonth(0);fu.setDate(1);fu.setHours(0,0,0,0);return fu}function lu(t){return hu(new Date(t))}function du(t){return pu(new Date(t))}function hu(t){return Er.count(cu(t.getFullYear())-1,t)}function pu(t){return Mr.count(cu(t.getFullYear())-1,t)}function mu(t){return cu(t).getDay()}function gu(t,e,n,i,r,u,o){if(0<=t&&t<100){const s=new Date(-1,e,n,i,r,u,o);s.setFullYear(t);return s}return new Date(t,e,n,i,r,u,o)}function bu(t){return yu(new Date(t))}function vu(t){return wu(new Date(t))}function yu(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return $r.count(e-1,t)}function wu(t){const e=Date.UTC(t.getUTCFullYear(),0,1);return Nr.count(e-1,t)}function Au(t){fu.setTime(Date.UTC(t,0,1));return fu.getUTCDay()}function xu(t,e,n,i,r,u,o){if(0<=t&&t<100){const t=new Date(Date.UTC(-1,e,n,i,r,u,o));t.setUTCFullYear(n.y);return t}return new Date(Date.UTC(t,e,n,i,r,u,o))}function Ou(t,e,n,i,r){const u=e||1,o=Fe(t),s=(t,e,r)=>{r=r||t;return Fu(n[r],i[r],t===o&&u,e)};const a=new Date,f=Cn(t),c=f[Vr]?s(Vr):Ze(2012),l=f[Xr]?s(Xr):f[Yr]?s(Yr):se,d=f[Jr]&&f[Zr]?s(Zr,1,Jr+Zr):f[Jr]?s(Jr,1):f[Zr]?s(Zr,1):f[Qr]?s(Qr,1):f[Kr]?s(Kr,1):ae,h=f[tu]?s(tu):se,p=f[eu]?s(eu):se,m=f[nu]?s(nu):se,g=f[iu]?s(iu):se;return function(t){a.setTime(+t);const e=c(a);return r(e,l(a),d(a,e),h(a),p(a),m(a),g(a))}}function Fu(t,e,n,i){const r=n<=1?t:i?(e,r)=>i+n*Math.floor((t(e,r)-i)/n):(e,i)=>n*Math.floor(t(e,i)/n);return e?(t,n)=>e(r(t,n),n):r}function Du(t,e,n){return e+t*7-(n+6)%7}const ku={[Vr]:t=>t.getFullYear(),[Yr]:t=>Math.floor(t.getMonth()/3),[Xr]:t=>t.getMonth(),[Qr]:t=>t.getDate(),[tu]:t=>t.getHours(),[eu]:t=>t.getMinutes(),[nu]:t=>t.getSeconds(),[iu]:t=>t.getMilliseconds(),[Kr]:t=>hu(t),[Jr]:t=>pu(t),[Jr+Zr]:(t,e)=>Du(pu(t),t.getDay(),mu(e)),[Zr]:(t,e)=>Du(1,t.getDay(),mu(e))};const Eu={[Yr]:t=>3*t,[Jr]:(t,e)=>Du(t,0,mu(e))};function $u(t,e){return Ou(t,e||1,ku,Eu,gu)}const ju={[Vr]:t=>t.getUTCFullYear(),[Yr]:t=>Math.floor(t.getUTCMonth()/3),[Xr]:t=>t.getUTCMonth(),[Qr]:t=>t.getUTCDate(),[tu]:t=>t.getUTCHours(),[eu]:t=>t.getUTCMinutes(),[nu]:t=>t.getUTCSeconds(),[iu]:t=>t.getUTCMilliseconds(),[Kr]:t=>yu(t),[Jr]:t=>wu(t),[Zr]:(t,e)=>Du(1,t.getUTCDay(),Au(e)),[Jr+Zr]:(t,e)=>Du(wu(t),t.getUTCDay(),Au(e))};const Cu={[Yr]:t=>3*t,[Jr]:(t,e)=>Du(t,0,Au(e))};function Mu(t,e){return Ou(t,e||1,ju,Cu,xu)}const Bu={[Vr]:Ir,[Yr]:Pr.every(3),[Xr]:Pr,[Jr]:Mr,[Qr]:Er,[Zr]:Er,[Kr]:Er,[tu]:Dr,[eu]:Or,[nu]:xr,[iu]:pr};const Su={[Vr]:Rr,[Yr]:Lr.every(3),[Xr]:Lr,[Jr]:Nr,[Qr]:$r,[Zr]:$r,[Kr]:$r,[tu]:kr,[eu]:Fr,[nu]:xr,[iu]:pr};function _u(t){return Bu[t]}function Nu(t){return Su[t]}function zu(t,e,n){return t?t.offset(e,n):undefined}function Tu(t,e,n){return zu(_u(t),e,n)}function Pu(t,e,n){return zu(Nu(t),e,n)}function Lu(t,e,n,i){return t?t.range(e,n,i):undefined}function Iu(t,e,n,i){return Lu(_u(t),e,n,i)}function Ru(t,e,n,i){return Lu(Nu(t),e,n,i)}const qu=1e3,Uu=qu*60,Wu=Uu*60,Gu=Wu*24,Hu=Gu*7,Vu=Gu*30,Yu=Gu*365;const Xu=[Vr,Xr,Qr,tu,eu,nu,iu],Ju=Xu.slice(0,-1),Qu=Ju.slice(0,-1),Zu=Qu.slice(0,-1),Ku=Zu.slice(0,-1),to=[Vr,Jr],eo=[Vr,Xr],no=[Vr];const io=[[Ju,1,qu],[Ju,5,5*qu],[Ju,15,15*qu],[Ju,30,30*qu],[Qu,1,Uu],[Qu,5,5*Uu],[Qu,15,15*Uu],[Qu,30,30*Uu],[Zu,1,Wu],[Zu,3,3*Wu],[Zu,6,6*Wu],[Zu,12,12*Wu],[Ku,1,Gu],[to,1,Hu],[eo,1,Vu],[eo,3,3*Vu],[no,1,Yu]];function ro(t){const e=t.extent,n=t.maxbins||40,i=Math.abs(Fn(e))/n;let r=ii((t=>t[2])).right(io,i),u,o;if(r===io.length){u=no,o=$i(e[0]/Yu,e[1]/Yu,n)}else if(r){r=io[i/io[r-1][2]<io[r][2]/i?r-1:r];u=r[0];o=r[1]}else{u=Xu;o=Math.max($i(e[0],e[1],n),1)}return{units:u,step:o}}function uo(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);e.setFullYear(t.y);return e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function oo(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));e.setUTCFullYear(t.y);return e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function so(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function ao(t){var e=t.dateTime,n=t.date,i=t.time,r=t.periods,u=t.days,o=t.shortDays,s=t.months,a=t.shortMonths;var f=go(r),c=bo(r),l=go(u),d=bo(u),h=go(o),p=bo(o),m=go(s),g=bo(s),b=go(a),v=bo(a);var y={a:S,A:_,b:N,B:z,c:null,d:Po,e:Po,f:Uo,g:ts,G:ns,H:Lo,I:Io,j:Ro,L:qo,m:Wo,M:Go,p:T,q:P,Q:Ds,s:ks,S:Ho,u:Vo,U:Yo,V:Jo,w:Qo,W:Zo,x:null,X:null,y:Ko,Y:es,Z:is,"%":Fs};var w={a:L,A:I,b:R,B:q,c:null,d:rs,e:rs,f:fs,g:ws,G:xs,H:us,I:os,j:ss,L:as,m:cs,M:ls,p:U,q:W,Q:Ds,s:ks,S:ds,u:hs,U:ps,V:gs,w:bs,W:vs,x:null,X:null,y:ys,Y:As,Z:Os,"%":Fs};var A={a:k,A:E,b:$,B:j,c:C,d:$o,e:$o,f:_o,g:Fo,G:Oo,H:Co,I:Co,j:jo,L:So,m:Eo,M:Mo,p:D,q:ko,Q:zo,s:To,S:Bo,u:yo,U:wo,V:Ao,w:vo,W:xo,x:M,X:B,y:Fo,Y:Oo,Z:Do,"%":No};y.x=x(n,y);y.X=x(i,y);y.c=x(e,y);w.x=x(n,w);w.X=x(i,w);w.c=x(e,w);function x(t,e){return function(n){var i=[],r=-1,u=0,o=t.length,s,a,f;if(!(n instanceof Date))n=new Date(+n);while(++r<o){if(t.charCodeAt(r)===37){i.push(t.slice(u,r));if((a=fo[s=t.charAt(++r)])!=null)s=t.charAt(++r);else a=s==="e"?" ":"0";if(f=e[s])s=f(n,a);i.push(s);u=r+1}}i.push(t.slice(u,r));return i.join("")}}function O(t,e){return function(n){var i=so(1900,undefined,1),r=F(i,t,n+="",0),u,o;if(r!=n.length)return null;if("Q"in i)return new Date(i.Q);if("s"in i)return new Date(i.s*1e3+("L"in i?i.L:0));if(e&&!("Z"in i))i.Z=0;if("p"in i)i.H=i.H%12+i.p*12;if(i.m===undefined)i.m="q"in i?i.q:0;if("V"in i){if(i.V<1||i.V>53)return null;if(!("w"in i))i.w=1;if("Z"in i){u=oo(so(i.y,0,1)),o=u.getUTCDay();u=o>4||o===0?zr.ceil(u):zr(u);u=$r.offset(u,(i.V-1)*7);i.y=u.getUTCFullYear();i.m=u.getUTCMonth();i.d=u.getUTCDate()+(i.w+6)%7}else{u=uo(so(i.y,0,1)),o=u.getDay();u=o>4||o===0?Br.ceil(u):Br(u);u=Er.offset(u,(i.V-1)*7);i.y=u.getFullYear();i.m=u.getMonth();i.d=u.getDate()+(i.w+6)%7}}else if("W"in i||"U"in i){if(!("w"in i))i.w="u"in i?i.u%7:"W"in i?1:0;o="Z"in i?oo(so(i.y,0,1)).getUTCDay():uo(so(i.y,0,1)).getDay();i.m=0;i.d="W"in i?(i.w+6)%7+i.W*7-(o+5)%7:i.w+i.U*7-(o+6)%7}if("Z"in i){i.H+=i.Z/100|0;i.M+=i.Z%100;return oo(i)}return uo(i)}}function F(t,e,n,i){var r=0,u=e.length,o=n.length,s,a;while(r<u){if(i>=o)return-1;s=e.charCodeAt(r++);if(s===37){s=e.charAt(r++);a=A[s in fo?e.charAt(r++):s];if(!a||(i=a(t,n,i))<0)return-1}else if(s!=n.charCodeAt(i++)){return-1}}return i}function D(t,e,n){var i=f.exec(e.slice(n));return i?(t.p=c.get(i[0].toLowerCase()),n+i[0].length):-1}function k(t,e,n){var i=h.exec(e.slice(n));return i?(t.w=p.get(i[0].toLowerCase()),n+i[0].length):-1}function E(t,e,n){var i=l.exec(e.slice(n));return i?(t.w=d.get(i[0].toLowerCase()),n+i[0].length):-1}function $(t,e,n){var i=b.exec(e.slice(n));return i?(t.m=v.get(i[0].toLowerCase()),n+i[0].length):-1}function j(t,e,n){var i=m.exec(e.slice(n));return i?(t.m=g.get(i[0].toLowerCase()),n+i[0].length):-1}function C(t,n,i){return F(t,e,n,i)}function M(t,e,i){return F(t,n,e,i)}function B(t,e,n){return F(t,i,e,n)}function S(t){return o[t.getDay()]}function _(t){return u[t.getDay()]}function N(t){return a[t.getMonth()]}function z(t){return s[t.getMonth()]}function T(t){return r[+(t.getHours()>=12)]}function P(t){return 1+~~(t.getMonth()/3)}function L(t){return o[t.getUTCDay()]}function I(t){return u[t.getUTCDay()]}function R(t){return a[t.getUTCMonth()]}function q(t){return s[t.getUTCMonth()]}function U(t){return r[+(t.getUTCHours()>=12)]}function W(t){return 1+~~(t.getUTCMonth()/3)}return{format:function(t){var e=x(t+="",y);e.toString=function(){return t};return e},parse:function(t){var e=O(t+="",false);e.toString=function(){return t};return e},utcFormat:function(t){var e=x(t+="",w);e.toString=function(){return t};return e},utcParse:function(t){var e=O(t+="",true);e.toString=function(){return t};return e}}}var fo={"-":"",_:" ",0:"0"},co=/^\s*\d+/,lo=/^%/,ho=/[\\^$*+?|[\]().{}]/g;function po(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",u=r.length;return i+(u<n?new Array(n-u+1).join(e)+r:r)}function mo(t){return t.replace(ho,"\\$&")}function go(t){return new RegExp("^(?:"+t.map(mo).join("|")+")","i")}function bo(t){return new Map(t.map(((t,e)=>[t.toLowerCase(),e])))}function vo(t,e,n){var i=co.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function yo(t,e,n){var i=co.exec(e.slice(n,n+1));return i?(t.u=+i[0],n+i[0].length):-1}function wo(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.U=+i[0],n+i[0].length):-1}function Ao(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.V=+i[0],n+i[0].length):-1}function xo(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.W=+i[0],n+i[0].length):-1}function Oo(t,e,n){var i=co.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function Fo(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.y=+i[0]+(+i[0]>68?1900:2e3),n+i[0].length):-1}function Do(t,e,n){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return i?(t.Z=i[1]?0:-(i[2]+(i[3]||"00")),n+i[0].length):-1}function ko(t,e,n){var i=co.exec(e.slice(n,n+1));return i?(t.q=i[0]*3-3,n+i[0].length):-1}function Eo(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function $o(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function jo(t,e,n){var i=co.exec(e.slice(n,n+3));return i?(t.m=0,t.d=+i[0],n+i[0].length):-1}function Co(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function Mo(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function Bo(t,e,n){var i=co.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function So(t,e,n){var i=co.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function _o(t,e,n){var i=co.exec(e.slice(n,n+6));return i?(t.L=Math.floor(i[0]/1e3),n+i[0].length):-1}function No(t,e,n){var i=lo.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function zo(t,e,n){var i=co.exec(e.slice(n));return i?(t.Q=+i[0],n+i[0].length):-1}function To(t,e,n){var i=co.exec(e.slice(n));return i?(t.s=+i[0],n+i[0].length):-1}function Po(t,e){return po(t.getDate(),e,2)}function Lo(t,e){return po(t.getHours(),e,2)}function Io(t,e){return po(t.getHours()%12||12,e,2)}function Ro(t,e){return po(1+Er.count(Ir(t),t),e,3)}function qo(t,e){return po(t.getMilliseconds(),e,3)}function Uo(t,e){return qo(t,e)+"000"}function Wo(t,e){return po(t.getMonth()+1,e,2)}function Go(t,e){return po(t.getMinutes(),e,2)}function Ho(t,e){return po(t.getSeconds(),e,2)}function Vo(t){var e=t.getDay();return e===0?7:e}function Yo(t,e){return po(Mr.count(Ir(t)-1,t),e,2)}function Xo(t){var e=t.getDay();return e>=4||e===0?Sr(t):Sr.ceil(t)}function Jo(t,e){t=Xo(t);return po(Sr.count(Ir(t),t)+(Ir(t).getDay()===4),e,2)}function Qo(t){return t.getDay()}function Zo(t,e){return po(Br.count(Ir(t)-1,t),e,2)}function Ko(t,e){return po(t.getFullYear()%100,e,2)}function ts(t,e){t=Xo(t);return po(t.getFullYear()%100,e,2)}function es(t,e){return po(t.getFullYear()%1e4,e,4)}function ns(t,e){var n=t.getDay();t=n>=4||n===0?Sr(t):Sr.ceil(t);return po(t.getFullYear()%1e4,e,4)}function is(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+po(e/60|0,"0",2)+po(e%60,"0",2)}function rs(t,e){return po(t.getUTCDate(),e,2)}function us(t,e){return po(t.getUTCHours(),e,2)}function os(t,e){return po(t.getUTCHours()%12||12,e,2)}function ss(t,e){return po(1+$r.count(Rr(t),t),e,3)}function as(t,e){return po(t.getUTCMilliseconds(),e,3)}function fs(t,e){return as(t,e)+"000"}function cs(t,e){return po(t.getUTCMonth()+1,e,2)}function ls(t,e){return po(t.getUTCMinutes(),e,2)}function ds(t,e){return po(t.getUTCSeconds(),e,2)}function hs(t){var e=t.getUTCDay();return e===0?7:e}function ps(t,e){return po(Nr.count(Rr(t)-1,t),e,2)}function ms(t){var e=t.getUTCDay();return e>=4||e===0?Tr(t):Tr.ceil(t)}function gs(t,e){t=ms(t);return po(Tr.count(Rr(t),t)+(Rr(t).getUTCDay()===4),e,2)}function bs(t){return t.getUTCDay()}function vs(t,e){return po(zr.count(Rr(t)-1,t),e,2)}function ys(t,e){return po(t.getUTCFullYear()%100,e,2)}function ws(t,e){t=ms(t);return po(t.getUTCFullYear()%100,e,2)}function As(t,e){return po(t.getUTCFullYear()%1e4,e,4)}function xs(t,e){var n=t.getUTCDay();t=n>=4||n===0?Tr(t):Tr.ceil(t);return po(t.getUTCFullYear()%1e4,e,4)}function Os(){return"+0000"}function Fs(){return"%"}function Ds(t){return+t}function ks(t){return Math.floor(+t/1e3)}var Es;var $s;var js;var Cs;var Ms;Bs({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Bs(t){Es=ao(t);$s=Es.format;js=Es.parse;Cs=Es.utcFormat;Ms=Es.utcParse;return Es}function Ss(t){const e={};return n=>e[n]||(e[n]=t(n))}function _s(t,e){return n=>{const i=t(n),r=i.indexOf(e);if(r<0)return i;let u=Ns(i,r);const o=u<i.length?i.slice(u):"";while(--u>r)if(i[u]!=="0"){++u;break}return i.slice(0,u)+o}}function Ns(t,e){let n=t.lastIndexOf("e"),i;if(n>0)return n;for(n=t.length;--n>e;){i=t.charCodeAt(n);if(i>=48&&i<=57)return n+1}}function zs(t){const e=Ss(t.format),n=t.formatPrefix;return{format:e,formatPrefix:n,formatFloat(t){const n=Vi(t||",");if(n.precision==null){n.precision=12;switch(n.type){case"%":n.precision-=2;break;case"e":n.precision-=1;break}return _s(e(n),e(".1f")(1)[1])}else{return e(n)}},formatSpan(t,i,r,u){u=Vi(u==null?",f":u);const o=$i(t,i,r),s=Math.max(Math.abs(t),Math.abs(i));let a;if(u.precision==null){switch(u.type){case"s":{if(!isNaN(a=fr(o,s))){u.precision=a}return n(u,s)}case"":case"e":case"g":case"p":case"r":{if(!isNaN(a=cr(o,s))){u.precision=a-(u.type==="e")}break}case"f":case"%":{if(!isNaN(a=ar(o))){u.precision=a-(u.type==="%")*2}break}}}return e(u)}}}let Ts;Ps();function Ps(){return Ts=zs({format:ur,formatPrefix:or})}function Ls(t){return zs(ir(t))}function Is(t){return arguments.length?Ts=Ls(t):Ts}function Rs(t,e,n){n=n||{};if(!ye(n)){ne(`Invalid time multi-format specifier: ${n}`)}const i=e(nu),r=e(eu),u=e(tu),o=e(Qr),s=e(Jr),a=e(Xr),f=e(Yr),c=e(Vr),l=t(n[iu]||".%L"),d=t(n[nu]||":%S"),h=t(n[eu]||"%I:%M"),p=t(n[tu]||"%I %p"),m=t(n[Qr]||n[Zr]||"%a %d"),g=t(n[Jr]||"%b %d"),b=t(n[Xr]||"%B"),v=t(n[Yr]||"%B"),y=t(n[Vr]||"%Y");return t=>(i(t)<t?l:r(t)<t?d:u(t)<t?h:o(t)<t?p:a(t)<t?s(t)<t?m:g:c(t)<t?f(t)<t?b:v:y)(t)}function qs(t){const e=Ss(t.format),n=Ss(t.utcFormat);return{timeFormat:t=>gn(t)?e(t):Rs(e,_u,t),utcFormat:t=>gn(t)?n(t):Rs(n,Nu,t),timeParse:Ss(t.parse),utcParse:Ss(t.utcParse)}}let Us;Ws();function Ws(){return Us=qs({format:$s,parse:js,utcFormat:Cs,utcParse:Ms})}function Gs(t){return qs(ao(t))}function Hs(t){return arguments.length?Us=Gs(t):Us}const Vs=(t,e)=>tn({},t,e);function Ys(t,e){const n=t?Ls(t):Is();const i=e?Gs(e):Hs();return Vs(n,i)}function Xs(t,e){const n=arguments.length;if(n&&n!==2){ne("defaultLocale expects either zero or two arguments.")}return n?Vs(Is(t),Hs(e)):Vs(Is(),Hs())}function Js(){Ps();Ws();return Xs()}const Qs=/^(data:|([A-Za-z]+:)?\/\/)/;const Zs=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp|file|data):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i;const Ks=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;const ta="file://";function ea(t,e){return n=>({options:n||{},sanitize:ia,load:na,fileAccess:!!e,file:ra(e),http:oa(t)})}async function na(t,e){const n=await this.sanitize(t,e),i=n.href;return n.localFile?this.file(i):this.http(i,e)}async function ia(t,e){e=tn({},this.options,e);const n=this.fileAccess,i={href:null};let r,u,o;const s=Zs.test(t.replace(Ks,""));if(t==null||typeof t!=="string"||!s){ne("Sanitize failure, invalid URI: "+Dn(t))}const a=Qs.test(t);if((o=e.baseURL)&&!a){if(!t.startsWith("/")&&!o.endsWith("/")){t="/"+t}t=o+t}u=(r=t.startsWith(ta))||e.mode==="file"||e.mode!=="http"&&!a&&n;if(r){t=t.slice(ta.length)}else if(t.startsWith("//")){if(e.defaultProtocol==="file"){t=t.slice(2);u=true}else{t=(e.defaultProtocol||"http")+":"+t}}Object.defineProperty(i,"localFile",{value:!!u});i.href=t;if(e.target){i.target=e.target+""}if(e.rel){i.rel=e.rel+""}if(e.context==="image"&&e.crossOrigin){i.crossOrigin=e.crossOrigin+""}return i}function ra(t){return t?e=>new Promise(((n,i)=>{t.readFile(e,((t,e)=>{if(t)i(t);else n(e)}))})):ua}async function ua(){ne("No file system access.")}function oa(t){return t?async function(e,n){const i=tn({},this.options.http,n),r=n&&n.response,u=await t(e,i);return!u.ok?ne(u.status+""+u.statusText):Ge(u[r])?u[r]():u.text()}:sa}async function sa(){ne("No HTTP fetch method available.")}const aa=t=>t!=null&&t===t;const fa=t=>t==="true"||t==="false"||t===true||t===false;const ca=t=>!Number.isNaN(Date.parse(t));const la=t=>!Number.isNaN(+t)&&!(t instanceof Date);const da=t=>la(t)&&Number.isInteger(+t);const ha={boolean:kn,integer:De,number:De,date:$n,string:jn,unknown:oe};const pa=[fa,da,la,ca];const ma=["boolean","integer","number","date"];function ga(t,e){if(!t||!t.length)return"unknown";const n=t.length,i=pa.length,r=pa.map(((t,e)=>e+1));for(let u=0,o=0,s,a;u<n;++u){a=e?t[u][e]:t[u];for(s=0;s<i;++s){if(r[s]&&aa(a)&&!pa[s](a)){r[s]=0;++o;if(o===pa.length)return"string"}}}return ma[r.reduce(((t,e)=>t===0?e:t),0)-1]}function ba(t,e){return e.reduce(((e,n)=>{e[n]=ga(t,n);return e}),{})}function va(t){const e=function(e,n){const i={delimiter:t};return ya(e,n?tn(n,i):i)};e.responseType="text";return e}function ya(t,e){if(e.header){t=e.header.map(Dn).join(e.delimiter)+"\n"+t}return Wn(e.delimiter).parse(t+"")}ya.responseType="text";function wa(t){return typeof Buffer==="function"&&Ge(Buffer.isBuffer)?Buffer.isBuffer(t):false}function Aa(t,e){const n=e&&e.property?re(e.property):oe;return ye(t)&&!wa(t)?xa(n(t),e):n(JSON.parse(t))}Aa.responseType="json";function xa(t,e){if(!ve(t)&&hn(t)){t=[...t]}return e&&e.copy?JSON.parse(JSON.stringify(t)):t}const Oa={interior:(t,e)=>t!==e,exterior:(t,e)=>t===e};function Fa(t,e){let n,i,r,u;t=Aa(t,e);if(e&&e.feature){n=Yn;r=e.feature}else if(e&&e.mesh){n=Zn;r=e.mesh;u=Oa[e.filter]}else{ne("Missing TopoJSON feature or mesh parameter.")}i=(i=t.objects[r])?n(t,i,u):ne("Invalid TopoJSON object: "+r);return i&&i.features||[i]}Fa.responseType="json";const Da={dsv:ya,csv:va(","),tsv:va("\t"),json:Aa,topojson:Fa};function ka(t,e){if(arguments.length>1){Da[t]=e;return this}else{return un(Da,t)?Da[t]:null}}function Ea(t){const e=ka(t);return e&&e.responseType||"text"}function $a(t,e,n,i){e=e||{};const r=ka(e.type||"json");if(!r)ne("Unknown data format type: "+e.type);t=r(t,e);if(e.parse)ja(t,e.parse,n,i);if(un(t,"columns"))delete t.columns;return t}function ja(t,e,n,i){if(!t.length)return;const r=Hs();n=n||r.timeParse;i=i||r.utcParse;let u=t.columns||Object.keys(t[0]),o,s,a,f,c,l;if(e==="auto")e=ba(t,u);u=Object.keys(e);const d=u.map((t=>{const r=e[t];let u,o;if(r&&(r.startsWith("date:")||r.startsWith("utc:"))){u=r.split(/:(.+)?/,2);o=u[1];if(o[0]==="'"&&o[o.length-1]==="'"||o[0]==='"'&&o[o.length-1]==='"'){o=o.slice(1,-1)}const t=u[0]==="utc"?i:n;return t(o)}if(!ha[r]){throw Error("Illegal format pattern: "+t+":"+r)}return ha[r]}));for(a=0,c=t.length,l=u.length;a<c;++a){o=t[a];for(f=0;f<l;++f){s=u[f];o[s]=d[f](o[s])}}}const Ca=ea(typeof fetch!=="undefined"&&fetch,null);function Ma(t){const e=t||oe,n=[],i={};n.add=t=>{const r=e(t);if(!i[r]){i[r]=1;n.push(t)}return n};n.remove=t=>{const r=e(t);if(i[r]){i[r]=0;const e=n.indexOf(t);if(e>=0)n.splice(e,1)}return n};return n}async function Ba(t,e){try{await e(t)}catch(n){t.error(n)}}const Sa=Symbol("vega_id");let _a=1;function Na(t){return!!(t&&za(t))}function za(t){return t[Sa]}function Ta(t,e){t[Sa]=e;return t}function Pa(t){const e=t===Object(t)?t:{data:t};return za(e)?e:Ta(e,_a++)}function La(t){return Ia(t,Pa({}))}function Ia(t,e){for(const n in t)e[n]=t[n];return e}function Ra(t,e){return Ta(e,za(t))}function qa(t,e){return!t?null:e?(n,i)=>t(n,i)||za(e(n))-za(e(i)):(e,n)=>t(e,n)||za(e)-za(n)}function Ua(t){return t&&t.constructor===Wa}function Wa(){const t=[],e=[],n=[],i=[],r=[];let u=null,o=false;return{constructor:Wa,insert(e){const n=Ue(e),i=n.length;for(let r=0;r<i;++r)t.push(n[r]);return this},remove(t){const n=Ge(t)?i:e,r=Ue(t),u=r.length;for(let e=0;e<u;++e)n.push(r[e]);return this},modify(t,e,i){const u={field:e,value:Ze(i)};if(Ge(t)){u.filter=t;r.push(u)}else{u.tuple=t;n.push(u)}return this},encode(t,e){if(Ge(t))r.push({filter:t,field:e});else n.push({tuple:t,field:e});return this},clean(t){u=t;return this},reflow(){o=true;return this},pulse(s,a){const f={},c={};let l,d,h,p,m,g;for(l=0,d=a.length;l<d;++l){f[za(a[l])]=1}for(l=0,d=e.length;l<d;++l){m=e[l];f[za(m)]=-1}for(l=0,d=i.length;l<d;++l){p=i[l];a.forEach((t=>{if(p(t))f[za(t)]=-1}))}for(l=0,d=t.length;l<d;++l){m=t[l];g=za(m);if(f[g]){f[g]=1}else{s.add.push(Pa(t[l]))}}for(l=0,d=a.length;l<d;++l){m=a[l];if(f[za(m)]<0)s.rem.push(m)}function b(t,e,n){if(n){t[e]=n(t)}else{s.encode=e}if(!o)c[za(t)]=t}for(l=0,d=n.length;l<d;++l){h=n[l];m=h.tuple;p=h.field;g=f[za(m)];if(g>0){b(m,p,h.value);s.modifies(p)}}for(l=0,d=r.length;l<d;++l){h=r[l];p=h.filter;a.forEach((t=>{if(p(t)&&f[za(t)]>0){b(t,h.field,h.value)}}));s.modifies(h.field)}if(o){s.mod=e.length||i.length?a.filter((t=>f[za(t)]>0)):a.slice()}else{for(g in c)s.mod.push(c[g])}if(u||u==null&&(e.length||i.length)){s.clean(true)}return s}}}const Ga="_:mod:_";function Ha(){Object.defineProperty(this,Ga,{writable:true,value:{}})}Ha.prototype={set(t,e,n,i){const r=this,u=r[t],o=r[Ga];if(e!=null&&e>=0){if(u[e]!==n||i){u[e]=n;o[e+":"+t]=-1;o[t]=-1}}else if(u!==n||i){r[t]=n;o[t]=ve(n)?1+n.length:-1}return r},modified(t,e){const n=this[Ga];if(!arguments.length){for(const t in n){if(n[t])return true}return false}else if(ve(t)){for(let e=0;e<t.length;++e){if(n[t[e]])return true}return false}return e!=null&&e>=0?e+1<n[t]||!!n[e+":"+t]:!!n[t]},clear(){this[Ga]={};return this}};let Va=0;const Ya="pulse",Xa=new Ha;const Ja=1,Qa=2;function Za(t,e,n,i){this.id=++Va;this.value=t;this.stamp=-1;this.rank=-1;this.qrank=-1;this.flags=0;if(e){this._update=e}if(n)this.parameters(n,i)}function Ka(t){return function(e){const n=this.flags;if(arguments.length===0)return!!(n&t);this.flags=e?n|t:n&~t;return this}}Za.prototype={targets(){return this._targets||(this._targets=Ma(ue))},set(t){if(this.value!==t){this.value=t;return 1}else{return 0}},skip:Ka(Ja),modified:Ka(Qa),parameters(t,e,n){e=e!==false;const i=this._argval=this._argval||new Ha,r=this._argops=this._argops||[],u=[];let o,s,a,f;const c=(t,n,o)=>{if(o instanceof Za){if(o!==this){if(e)o.targets().add(this);u.push(o)}r.push({op:o,name:t,index:n})}else{i.set(t,n,o)}};for(o in t){s=t[o];if(o===Ya){Ue(s).forEach((t=>{if(!(t instanceof Za)){ne("Pulse parameters must be operator instances.")}else if(t!==this){t.targets().add(this);u.push(t)}}));this.source=s}else if(ve(s)){i.set(o,-1,Array(a=s.length));for(f=0;f<a;++f)c(o,f,s[f])}else{c(o,-1,s)}}this.marshall().clear();if(n)r.initonly=true;return u},marshall(t){const e=this._argval||Xa,n=this._argops;let i,r,u,o;if(n){const s=n.length;for(r=0;r<s;++r){i=n[r];u=i.op;o=u.modified()&&u.stamp===t;e.set(i.name,i.index,u.value,o)}if(n.initonly){for(r=0;r<s;++r){i=n[r];i.op.targets().remove(this)}this._argops=null;this._update=null}}return e},detach(){const t=this._argops;let e,n,i,r;if(t){for(e=0,n=t.length;e<n;++e){i=t[e];r=i.op;if(r._targets){r._targets.remove(this)}}}this.pulse=null;this.source=null},evaluate(t){const e=this._update;if(e){const n=this.marshall(t.stamp),i=e.call(this,n,t);n.clear();if(i!==this.value){this.value=i}else if(!this.modified()){return t.StopPropagation}}},run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;if(this.skip()){this.skip(false);e=0}else{e=this.evaluate(t)}return this.pulse=e||t}};function tf(t,e,n,i){let r=1,u;if(t instanceof Za){u=t}else if(t&&t.prototype instanceof Za){u=new t}else if(Ge(t)){u=new Za(null,t)}else{r=0;u=new Za(t,e)}this.rank(u);if(r){i=n;n=e}if(n)this.connect(u,u.parameters(n,i));this.touch(u);return u}function ef(t,e){const n=t.rank,i=e.length;for(let r=0;r<i;++r){if(n<e[r].rank){this.rerank(t);return}}}let nf=0;function rf(t,e,n){this.id=++nf;this.value=null;if(n)this.receive=n;if(t)this._filter=t;if(e)this._apply=e}function uf(t,e,n){return new rf(t,e,n)}rf.prototype={_filter:fe,_apply:oe,targets(){return this._targets||(this._targets=Ma(ue))},consume(t){if(!arguments.length)return!!this._consume;this._consume=!!t;return this},receive(t){if(this._filter(t)){const e=this.value=this._apply(t),n=this._targets,i=n?n.length:0;for(let t=0;t<i;++t)n[t].receive(e);if(this._consume){t.preventDefault();t.stopPropagation()}}},filter(t){const e=uf(t);this.targets().add(e);return e},apply(t){const e=uf(null,t);this.targets().add(e);return e},merge(){const t=uf();this.targets().add(t);for(let e=0,n=arguments.length;e<n;++e){arguments[e].targets().add(t)}return t},throttle(t){let e=-1;return this.filter((()=>{const n=Date.now();if(n-e>t){e=n;return 1}else{return 0}}))},debounce(t){const e=uf();this.targets().add(uf(null,null,Ke(t,(t=>{const n=t.dataflow;e.receive(t);if(n&&n.run)n.run()}))));return e},between(t,e){let n=false;t.targets().add(uf(null,null,(()=>n=true)));e.targets().add(uf(null,null,(()=>n=false)));return this.filter((()=>n))},detach(){this._filter=fe;this._targets=null}};function of(t,e,n,i){const r=this,u=uf(n,i),o=function(t){t.dataflow=r;try{u.receive(t)}catch(ne){r.error(ne)}finally{r.run()}};let s;if(typeof t==="string"&&typeof document!=="undefined"){s=document.querySelectorAll(t)}else{s=Ue(t)}const a=s.length;for(let f=0;f<a;++f){s[f].addEventListener(e,o)}return u}function sf(t,e){const n=this.locale();return $a(t,e,n.timeParse,n.utcParse)}function af(t,e,n){e=this.parse(e,n);return this.pulse(t,this.changeset().insert(e))}async function ff(t,e){const n=this;let i=0,r;try{r=await n.loader().load(t,{context:"dataflow",response:Ea(e&&e.type)});try{r=n.parse(r,e)}catch(u){i=-2;n.warn("Data ingestion failed",t,u)}}catch(u){i=-1;n.warn("Loading failed",t,u)}return{data:r,status:i}}async function cf(t,e,n){const i=this,r=i._pending||lf(i);r.requests+=1;const u=await i.request(e,n);i.pulse(t,i.changeset().remove(fe).insert(u.data||[]));r.done();return u}function lf(t){let e;const n=new Promise((t=>e=t));n.requests=0;n.done=()=>{if(--n.requests===0){t._pending=null;e(t)}};return t._pending=n}const df={skip:true};function hf(t,e,n,i,r){const u=t instanceof Za?mf:pf;u(this,t,e,n,i,r);return this}function pf(t,e,n,i,r,u){const o=tn({},u,df);let s,a;if(!Ge(n))n=Ze(n);if(i===undefined){s=e=>t.touch(n(e))}else if(Ge(i)){a=new Za(null,i,r,false);s=e=>{a.evaluate(e);const i=n(e),r=a.value;Ua(r)?t.pulse(i,r,u):t.update(i,r,o)}}else{s=e=>t.update(n(e),i,o)}e.apply(s)}function mf(t,e,n,i,r,u){if(i===undefined){e.targets().add(n)}else{const o=u||{},s=new Za(null,gf(n,i),r,false);s.modified(o.force);s.rank=e.rank;e.targets().add(s);if(n){s.skip(true);s.value=n.value;s.targets().add(n);t.connect(n,[s])}}}function gf(t,e){e=Ge(e)?e:Ze(e);return t?function(n,i){const r=e(n,i);if(!t.skip()){t.skip(r!==this.value).value=r}return r}:e}function bf(t){t.rank=++this._rank}function vf(t){const e=[t];let n,i,r;while(e.length){this.rank(n=e.pop());if(i=n._targets){for(r=i.length;--r>=0;){e.push(n=i[r]);if(n===t)ne("Cycle detected in dataflow graph.")}}}}const yf={};const wf=1<<0,Af=1<<1,xf=1<<2,Of=wf|Af,Ff=wf|xf,Df=wf|Af|xf,kf=1<<3,Ef=1<<4,$f=1<<5,jf=1<<6;function Cf(t,e,n){this.dataflow=t;this.stamp=e==null?-1:e;this.add=[];this.rem=[];this.mod=[];this.fields=null;this.encode=n||null}function Mf(t,e){const n=[];Bn(t,e,(t=>n.push(t)));return n}function Bf(t,e){const n={};t.visit(e,(t=>{n[za(t)]=1}));return t=>n[za(t)]?null:t}function Sf(t,e){return t?(n,i)=>t(n,i)&&e(n,i):e}Cf.prototype={StopPropagation:yf,ADD:wf,REM:Af,MOD:xf,ADD_REM:Of,ADD_MOD:Ff,ALL:Df,REFLOW:kf,SOURCE:Ef,NO_SOURCE:$f,NO_FIELDS:jf,fork(t){return new Cf(this.dataflow).init(this,t)},clone(){const t=this.fork(Df);t.add=t.add.slice();t.rem=t.rem.slice();t.mod=t.mod.slice();if(t.source)t.source=t.source.slice();return t.materialize(Df|Ef)},addAll(){let t=this;const e=!t.source||t.add===t.rem||!t.rem.length&&t.source.length===t.add.length;if(e){return t}else{t=new Cf(this.dataflow).init(this);t.add=t.source;t.rem=[];return t}},init(t,e){const n=this;n.stamp=t.stamp;n.encode=t.encode;if(t.fields&&!(e&jf)){n.fields=t.fields}if(e&wf){n.addF=t.addF;n.add=t.add}else{n.addF=null;n.add=[]}if(e&Af){n.remF=t.remF;n.rem=t.rem}else{n.remF=null;n.rem=[]}if(e&xf){n.modF=t.modF;n.mod=t.mod}else{n.modF=null;n.mod=[]}if(e&$f){n.srcF=null;n.source=null}else{n.srcF=t.srcF;n.source=t.source;if(t.cleans)n.cleans=t.cleans}return n},runAfter(t){this.dataflow.runAfter(t)},changed(t){const e=t||Df;return e&wf&&this.add.length||e&Af&&this.rem.length||e&xf&&this.mod.length},reflow(t){if(t)return this.fork(Df).reflow();const e=this.add.length,n=this.source&&this.source.length;if(n&&n!==e){this.mod=this.source;if(e)this.filter(xf,Bf(this,wf))}return this},clean(t){if(arguments.length){this.cleans=!!t;return this}else{return this.cleans}},modifies(t){const e=this.fields||(this.fields={});if(ve(t)){t.forEach((t=>e[t]=true))}else{e[t]=true}return this},modified(t,e){const n=this.fields;return!((e||this.mod.length)&&n)?false:!arguments.length?!!n:ve(t)?t.some((t=>n[t])):n[t]},filter(t,e){const n=this;if(t&wf)n.addF=Sf(n.addF,e);if(t&Af)n.remF=Sf(n.remF,e);if(t&xf)n.modF=Sf(n.modF,e);if(t&Ef)n.srcF=Sf(n.srcF,e);return n},materialize(t){t=t||Df;const e=this;if(t&wf&&e.addF){e.add=Mf(e.add,e.addF);e.addF=null}if(t&Af&&e.remF){e.rem=Mf(e.rem,e.remF);e.remF=null}if(t&xf&&e.modF){e.mod=Mf(e.mod,e.modF);e.modF=null}if(t&Ef&&e.srcF){e.source=e.source.filter(e.srcF);e.srcF=null}return e},visit(t,e){const n=this,i=e;if(t&Ef){Bn(n.source,n.srcF,i);return n}if(t&wf)Bn(n.add,n.addF,i);if(t&Af)Bn(n.rem,n.remF,i);if(t&xf)Bn(n.mod,n.modF,i);const r=n.source;if(t&kf&&r){const t=n.add.length+n.mod.length;if(t===r.length);else if(t){Bn(r,Bf(n,Ff),i)}else{Bn(r,n.srcF,i)}}return n}};function _f(t,e,n,i){const r=this;let u=0;this.dataflow=t;this.stamp=e;this.fields=null;this.encode=i||null;this.pulses=n;for(const o of n){if(o.stamp!==e)continue;if(o.fields){const t=r.fields||(r.fields={});for(const e in o.fields){t[e]=1}}if(o.changed(r.ADD))u|=r.ADD;if(o.changed(r.REM))u|=r.REM;if(o.changed(r.MOD))u|=r.MOD}this.changes=u}fn(_f,Cf,{fork(t){const e=new Cf(this.dataflow).init(this,t&this.NO_FIELDS);if(t!==undefined){if(t&e.ADD)this.visit(e.ADD,(t=>e.add.push(t)));if(t&e.REM)this.visit(e.REM,(t=>e.rem.push(t)));if(t&e.MOD)this.visit(e.MOD,(t=>e.mod.push(t)))}return e},changed(t){return this.changes&t},modified(t){const e=this,n=e.fields;return!(n&&e.changes&e.MOD)?0:ve(t)?t.some((t=>n[t])):n[t]},filter(){ne("MultiPulse does not support filtering.")},materialize(){ne("MultiPulse does not support materialization.")},visit(t,e){const n=this,i=n.pulses,r=i.length;let u=0;if(t&n.SOURCE){for(;u<r;++u){i[u].visit(t,e)}}else{for(;u<r;++u){if(i[u].stamp===n.stamp){i[u].visit(t,e)}}}return n}});async function Nf(t,e,n){const i=this,r=[];if(i._pulse)return Lf(i);if(i._pending)await i._pending;if(e)await Ba(i,e);if(!i._touched.length){i.debug("Dataflow invoked, but nothing to do.");return i}const u=++i._clock;i._pulse=new Cf(i,u,t);i._touched.forEach((t=>i._enqueue(t,true)));i._touched=Ma(ue);let o=0,s,a,f;try{while(i._heap.size()>0){s=i._heap.pop();if(s.rank!==s.qrank){i._enqueue(s,true);continue}a=s.run(i._getPulse(s,t));if(a.then){a=await a}else if(a.async){r.push(a.async);a=yf}if(a!==yf){if(s._targets)s._targets.forEach((t=>i._enqueue(t)))}++o}}catch(c){i._heap.clear();f=c}i._input={};i._pulse=null;i.debug(`Pulse ${u}: ${o} operators`);if(f){i._postrun=[];i.error(f)}if(i._postrun.length){const t=i._postrun.sort(((t,e)=>e.priority-t.priority));i._postrun=[];for(let e=0;e<t.length;++e){await Ba(i,t[e].callback)}}if(n)await Ba(i,n);if(r.length){Promise.all(r).then((t=>i.runAsync(null,(()=>{t.forEach((t=>{try{t(i)}catch(c){i.error(c)}}))}))))}return i}async function zf(t,e,n){while(this._running)await this._running;const i=()=>this._running=null;(this._running=this.evaluate(t,e,n)).then(i,i);return this._running}function Tf(t,e,n){return this._pulse?Lf(this):(this.evaluate(t,e,n),this)}function Pf(t,e,n){if(this._pulse||e){this._postrun.push({priority:n||0,callback:t})}else{try{t(this)}catch(i){this.error(i)}}}function Lf(t){t.error("Dataflow already running. Use runAsync() to chain invocations.");return t}function If(t,e){const n=t.stamp<this._clock;if(n)t.stamp=this._clock;if(n||e){t.qrank=t.rank;this._heap.push(t)}}function Rf(t,e){const n=t.source,i=this._clock;return n&&ve(n)?new _f(this,i,n.map((t=>t.pulse)),e):this._input[t.id]||qf(this._pulse,n&&n.pulse)}function qf(t,e){if(e&&e.stamp===t.stamp){return e}t=t.fork();if(e&&e!==yf){t.source=e.source}return t}const Uf={skip:false,force:false};function Wf(t,e){const n=e||Uf;if(this._pulse){this._enqueue(t)}else{this._touched.add(t)}if(n.skip)t.skip(true);return this}function Gf(t,e,n){const i=n||Uf;if(t.set(e)||i.force){this.touch(t,i)}return this}function Hf(t,e,n){this.touch(t,n||Uf);const i=new Cf(this,this._clock+(this._pulse?0:1)),r=t.pulse&&t.pulse.source||[];i.target=t;this._input[t.id]=e.pulse(i,r);return this}function Vf(t){let e=[];return{clear:()=>e=[],size:()=>e.length,peek:()=>e[0],push:n=>{e.push(n);return Yf(e,0,e.length-1,t)},pop:()=>{const n=e.pop();let i;if(e.length){i=e[0];e[0]=n;Xf(e,0,t)}else{i=n}return i}}}function Yf(t,e,n,i){let r,u;const o=t[n];while(n>e){u=n-1>>1;r=t[u];if(i(o,r)<0){t[n]=r;n=u;continue}break}return t[n]=o}function Xf(t,e,n){const i=e,r=t.length,u=t[e];let o=(e<<1)+1,s;while(o<r){s=o+1;if(s<r&&n(t[o],t[s])>=0){o=s}t[e]=t[o];e=o;o=(e<<1)+1}t[e]=u;return Yf(t,i,e,n)}function Jf(){this.logger(be());this.logLevel(he);this._clock=0;this._rank=0;this._locale=Xs();try{this._loader=Ca()}catch(mat){}this._touched=Ma(ue);this._input={};this._pulse=null;this._heap=Vf(((t,e)=>t.qrank-e.qrank));this._postrun=[]}function Qf(t){return function(){return this._log[t].apply(this,arguments)}}Jf.prototype={stamp(){return this._clock},loader(t){if(arguments.length){this._loader=t;return this}else{return this._loader}},locale(t){if(arguments.length){this._locale=t;return this}else{return this._locale}},logger(t){if(arguments.length){this._log=t;return this}else{return this._log}},error:Qf("error"),warn:Qf("warn"),info:Qf("info"),debug:Qf("debug"),logLevel:Qf("level"),cleanThreshold:1e4,add:tf,connect:ef,rank:bf,rerank:vf,pulse:Hf,touch:Wf,update:Gf,changeset:Wa,ingest:af,parse:sf,preload:cf,request:ff,events:of,on:hf,evaluate:Nf,run:Tf,runAsync:zf,runAfter:Pf,_enqueue:If,_getPulse:Rf};function Zf(t,e){Za.call(this,t,null,e)}fn(Zf,Za,{run(t){if(t.stamp<this.stamp)return t.StopPropagation;let e;if(this.skip()){this.skip(false)}else{e=this.evaluate(t)}e=e||t;if(e.then){e=e.then((t=>this.pulse=t))}else if(e!==t.StopPropagation){this.pulse=e}return e},evaluate(t){const e=this.marshall(t.stamp),n=this.transform(e,t);e.clear();return n},transform(){}});const Kf={};function tc(t){const e=ec(t);return e&&e.Definition||null}function ec(t){t=t&&t.toLowerCase();return un(Kf,t)?Kf[t]:null}function*nc(t,e){if(e==null){for(let e of t){if(e!=null&&e!==""&&(e=+e)>=e){yield e}}}else{let n=-1;for(let i of t){i=e(i,++n,t);if(i!=null&&i!==""&&(i=+i)>=i){yield i}}}}function ic(t,e,n){const i=Float64Array.from(nc(t,n));i.sort(ei);return e.map((t=>_i(i,t)))}function rc(t,e){return ic(t,[.25,.5,.75],e)}function uc(t,e){const n=t.length,i=li(t,e),r=rc(t,e),u=(r[2]-r[0])/1.34,o=Math.min(i,u)||i||Math.abs(r[0])||1;return 1.06*o*Math.pow(n,-.2)}function oc(t){const e=t.maxbins||20,n=t.base||10,i=Math.log(n),r=t.divide||[5,2];let u=t.extent[0],o=t.extent[1],s,a,f,c,l,d;const h=t.span||o-u||Math.abs(u)||1;if(t.step){s=t.step}else if(t.steps){c=h/e;for(l=0,d=t.steps.length;l<d&&t.steps[l]<c;++l);s=t.steps[Math.max(0,l-1)]}else{a=Math.ceil(Math.log(e)/i);f=t.minstep||0;s=Math.max(f,Math.pow(n,Math.round(Math.log(h)/i)-a));while(Math.ceil(h/s)>e){s*=n}for(l=0,d=r.length;l<d;++l){c=s/r[l];if(c>=f&&h/c<=e)s=c}}c=Math.log(s);const p=c>=0?0:~~(-c/i)+1,m=Math.pow(n,-p-1);if(t.nice||t.nice===undefined){c=Math.floor(u/s+m)*s;u=u<c?c-s:c;o=Math.ceil(o/s)*s}return{start:u,stop:o===u?u+s:o,step:s}}var sc=Math.random;function ac(t){sc=t}function fc(t,e,n,i){if(!t.length)return[undefined,undefined];const r=Float64Array.from(nc(t,i)),u=r.length,o=e;let s,a,f,c;for(f=0,c=Array(o);f<o;++f){for(s=0,a=0;a<u;++a){s+=r[~~(sc()*u)]}c[f]=s/u}c.sort(ei);return[Si(c,n/2),Si(c,1-n/2)]}function cc(t,e,n,i){i=i||(t=>t);const r=t.length,u=new Float64Array(r);let o=0,s=1,a=i(t[0]),f=a,c=a+e,l;for(;s<r;++s){l=i(t[s]);if(l>=c){f=(a+f)/2;for(;o<s;++o)u[o]=f;c=l+e;a=l}f=l}f=(a+f)/2;for(;o<s;++o)u[o]=f;return n?lc(u,e+e/4):u}function lc(t,e){const n=t.length;let i=0,r=1,u,o;while(t[i]===t[r])++r;while(r<n){u=r+1;while(t[r]===t[u])++u;if(t[r]-t[r-1]<e){o=r+(i+u-r-r>>1);while(o<r)t[o++]=t[r];while(o>r)t[o--]=t[i]}i=r;r=u}return t}function dc(t){return function(){t=(1103515245*t+12345)%2147483647;return t/2147483647}}function hc(t,e){if(e==null){e=t;t=0}let n,i,r;const u={min(t){if(arguments.length){n=t||0;r=i-n;return u}else{return n}},max(t){if(arguments.length){i=t||0;r=i-n;return u}else{return i}},sample(){return n+Math.floor(r*sc())},pdf(t){return t===Math.floor(t)&&t>=n&&t<i?1/r:0},cdf(t){const e=Math.floor(t);return e<n?0:e>=i?1:(e-n+1)/r},icdf(t){return t>=0&&t<=1?n-1+Math.floor(t*r):NaN}};return u.min(t).max(e)}const pc=Math.sqrt(2*Math.PI);const mc=Math.SQRT2;let gc=NaN;function bc(t,e){t=t||0;e=e==null?1:e;let n=0,i=0,r,u;if(gc===gc){n=gc;gc=NaN}else{do{n=sc()*2-1;i=sc()*2-1;r=n*n+i*i}while(r===0||r>1);u=Math.sqrt(-2*Math.log(r)/r);n*=u;gc=i*u}return t+n*e}function vc(t,e,n){n=n==null?1:n;const i=(t-(e||0))/n;return Math.exp(-.5*i*i)/(n*pc)}function yc(t,e,n){e=e||0;n=n==null?1:n;const i=(t-e)/n,r=Math.abs(i);let u;if(r>37){u=0}else{const t=Math.exp(-r*r/2);let e;if(r<7.07106781186547){e=.0352624965998911*r+.700383064443688;e=e*r+6.37396220353165;e=e*r+33.912866078383;e=e*r+112.079291497871;e=e*r+221.213596169931;e=e*r+220.206867912376;u=t*e;e=.0883883476483184*r+1.75566716318264;e=e*r+16.064177579207;e=e*r+86.7807322029461;e=e*r+296.564248779674;e=e*r+637.333633378831;e=e*r+793.826512519948;e=e*r+440.413735824752;u=u/e}else{e=r+.65;e=r+4/e;e=r+3/e;e=r+2/e;e=r+1/e;u=t/e/2.506628274631}}return i>0?1-u:u}function wc(t,e,n){if(t<0||t>1)return NaN;return(e||0)+(n==null?1:n)*mc*Ac(2*t-1)}function Ac(t){let e=-Math.log((1-t)*(1+t)),n;if(e<6.25){e-=3.125;n=-364441206401782e-35;n=-16850591381820166e-35+n*e;n=128584807152564e-32+n*e;n=11157877678025181e-33+n*e;n=-1333171662854621e-31+n*e;n=20972767875968562e-33+n*e;n=6637638134358324e-30+n*e;n=-4054566272975207e-29+n*e;n=-8151934197605472e-29+n*e;n=26335093153082323e-28+n*e;n=-12975133253453532e-27+n*e;n=-5415412054294628e-26+n*e;n=1.0512122733215323e-9+n*e;n=-4.112633980346984e-9+n*e;n=-2.9070369957882005e-8+n*e;n=4.2347877827932404e-7+n*e;n=-13654692000834679e-22+n*e;n=-13882523362786469e-21+n*e;n=.00018673420803405714+n*e;n=-.000740702534166267+n*e;n=-.006033670871430149+n*e;n=.24015818242558962+n*e;n=1.6536545626831027+n*e}else if(e<16){e=Math.sqrt(e)-3.25;n=2.2137376921775787e-9;n=9.075656193888539e-8+n*e;n=-2.7517406297064545e-7+n*e;n=1.8239629214389228e-8+n*e;n=15027403968909828e-22+n*e;n=-4013867526981546e-21+n*e;n=29234449089955446e-22+n*e;n=12475304481671779e-21+n*e;n=-47318229009055734e-21+n*e;n=6828485145957318e-20+n*e;n=24031110387097894e-21+n*e;n=-.0003550375203628475+n*e;n=.0009532893797373805+n*e;n=-.0016882755560235047+n*e;n=.002491442096107851+n*e;n=-.003751208507569241+n*e;n=.005370914553590064+n*e;n=1.0052589676941592+n*e;n=3.0838856104922208+n*e}else if(Number.isFinite(e)){e=Math.sqrt(e)-5;n=-27109920616438573e-27;n=-2.555641816996525e-10+n*e;n=1.5076572693500548e-9+n*e;n=-3.789465440126737e-9+n*e;n=7.61570120807834e-9+n*e;n=-1.496002662714924e-8+n*e;n=2.914795345090108e-8+n*e;n=-6.771199775845234e-8+n*e;n=2.2900482228026655e-7+n*e;n=-9.9298272942317e-7+n*e;n=4526062597223154e-21+n*e;n=-1968177810553167e-20+n*e;n=7599527703001776e-20+n*e;n=-.00021503011930044477+n*e;n=-.00013871931833623122+n*e;n=1.0103004648645344+n*e;n=4.849906401408584+n*e}else{n=Infinity}return n*t}function xc(t,e){let n,i;const r={mean(t){if(arguments.length){n=t||0;return r}else{return n}},stdev(t){if(arguments.length){i=t==null?1:t;return r}else{return i}},sample:()=>bc(n,i),pdf:t=>vc(t,n,i),cdf:t=>yc(t,n,i),icdf:t=>wc(t,n,i)};return r.mean(t).stdev(e)}function Oc(t,e){const n=xc();let i=0;const r={data(n){if(arguments.length){t=n;i=n?n.length:0;return r.bandwidth(e)}else{return t}},bandwidth(n){if(!arguments.length)return e;e=n;if(!e&&t)e=uc(t);return r},sample(){return t[~~(sc()*i)]+e*n.sample()},pdf(r){let u=0,o=0;for(;o<i;++o){u+=n.pdf((r-t[o])/e)}return u/e/i},cdf(r){let u=0,o=0;for(;o<i;++o){u+=n.cdf((r-t[o])/e)}return u/i},icdf(){throw Error("KDE icdf not supported.")}};return r.data(t)}function Fc(t,e){t=t||0;e=e==null?1:e;return Math.exp(t+bc()*e)}function Dc(t,e,n){if(t<=0)return 0;e=e||0;n=n==null?1:n;const i=(Math.log(t)-e)/n;return Math.exp(-.5*i*i)/(n*pc*t)}function kc(t,e,n){return yc(Math.log(t),e,n)}function Ec(t,e,n){return Math.exp(wc(t,e,n))}function $c(t,e){let n,i;const r={mean(t){if(arguments.length){n=t||0;return r}else{return n}},stdev(t){if(arguments.length){i=t==null?1:t;return r}else{return i}},sample:()=>Fc(n,i),pdf:t=>Dc(t,n,i),cdf:t=>kc(t,n,i),icdf:t=>Ec(t,n,i)};return r.mean(t).stdev(e)}function jc(t,e){let n=0,i;function r(t){const e=[];let i=0,r;for(r=0;r<n;++r){i+=e[r]=t[r]==null?1:+t[r]}for(r=0;r<n;++r){e[r]/=i}return e}const u={weights(t){if(arguments.length){i=r(e=t||[]);return u}return e},distributions(i){if(arguments.length){if(i){n=i.length;t=i}else{n=0;t=[]}return u.weights(e)}return t},sample(){const e=sc();let r=t[n-1],u=i[0],o=0;for(;o<n-1;u+=i[++o]){if(e<u){r=t[o];break}}return r.sample()},pdf(e){let r=0,u=0;for(;u<n;++u){r+=i[u]*t[u].pdf(e)}return r},cdf(e){let r=0,u=0;for(;u<n;++u){r+=i[u]*t[u].cdf(e)}return r},icdf(){throw Error("Mixture icdf not supported.")}};return u.distributions(t).weights(e)}function Cc(t,e){if(e==null){e=t==null?1:t;t=0}return t+(e-t)*sc()}function Mc(t,e,n){if(n==null){n=e==null?1:e;e=0}return t>=e&&t<=n?1/(n-e):0}function Bc(t,e,n){if(n==null){n=e==null?1:e;e=0}return t<e?0:t>n?1:(t-e)/(n-e)}function Sc(t,e,n){if(n==null){n=e==null?1:e;e=0}return t>=0&&t<=1?e+t*(n-e):NaN}function _c(t,e){let n,i;const r={min(t){if(arguments.length){n=t||0;return r}else{return n}},max(t){if(arguments.length){i=t==null?1:t;return r}else{return i}},sample:()=>Cc(n,i),pdf:t=>Mc(t,n,i),cdf:t=>Bc(t,n,i),icdf:t=>Sc(t,n,i)};if(e==null){e=t==null?1:t;t=0}return r.min(t).max(e)}function Nc(t,e,n,i){const r=i-t*t,u=Math.abs(r)<1e-24?0:(n-t*e)/r,o=e-u*t;return[o,u]}function zc(t,e,n,i){t=t.filter((t=>{let i=e(t),r=n(t);return i!=null&&(i=+i)>=i&&r!=null&&(r=+r)>=r}));if(i){t.sort(((t,n)=>e(t)-e(n)))}const r=t.length,u=new Float64Array(r),o=new Float64Array(r);let s=0,a=0,f=0,c,l,d;for(d of t){u[s]=c=+e(d);o[s]=l=+n(d);++s;a+=(c-a)/s;f+=(l-f)/s}for(s=0;s<r;++s){u[s]-=a;o[s]-=f}return[u,o,a,f]}function Tc(t,e,n,i){let r=-1,u,o;for(const s of t){u=e(s);o=n(s);if(u!=null&&(u=+u)>=u&&o!=null&&(o=+o)>=o){i(u,o,++r)}}}function Pc(t,e,n,i,r){let u=0,o=0;Tc(t,e,n,((t,e)=>{const n=e-r(t),s=e-i;u+=n*n;o+=s*s}));return 1-u/o}function Lc(t,e,n){let i=0,r=0,u=0,o=0,s=0;Tc(t,e,n,((t,e)=>{++s;i+=(t-i)/s;r+=(e-r)/s;u+=(t*e-u)/s;o+=(t*t-o)/s}));const a=Nc(i,r,u,o),f=t=>a[0]+a[1]*t;return{coef:a,predict:f,rSquared:Pc(t,e,n,r,f)}}function Ic(t,e,n){let i=0,r=0,u=0,o=0,s=0;Tc(t,e,n,((t,e)=>{++s;t=Math.log(t);i+=(t-i)/s;r+=(e-r)/s;u+=(t*e-u)/s;o+=(t*t-o)/s}));const a=Nc(i,r,u,o),f=t=>a[0]+a[1]*Math.log(t);return{coef:a,predict:f,rSquared:Pc(t,e,n,r,f)}}function Rc(t,e,n){const[i,r,u,o]=zc(t,e,n);let s=0,a=0,f=0,c=0,l=0,d,h,p;Tc(t,e,n,((t,e)=>{d=i[l++];h=Math.log(e);p=d*e;s+=(e*h-s)/l;a+=(p-a)/l;f+=(p*h-f)/l;c+=(d*p-c)/l}));const[m,g]=Nc(a/o,s/o,f/o,c/o),b=t=>Math.exp(m+g*(t-u));return{coef:[Math.exp(m-g*u),g],predict:b,rSquared:Pc(t,e,n,o,b)}}function qc(t,e,n){let i=0,r=0,u=0,o=0,s=0,a=0;Tc(t,e,n,((t,e)=>{const n=Math.log(t),f=Math.log(e);++a;i+=(n-i)/a;r+=(f-r)/a;u+=(n*f-u)/a;o+=(n*n-o)/a;s+=(e-s)/a}));const f=Nc(i,r,u,o),c=t=>f[0]*Math.pow(t,f[1]);f[0]=Math.exp(f[0]);return{coef:f,predict:c,rSquared:Pc(t,e,n,s,c)}}function Uc(t,e,n){const[i,r,u,o]=zc(t,e,n),s=i.length;let a=0,f=0,c=0,l=0,d=0,h,p,m,g;for(h=0;h<s;){p=i[h];m=r[h++];g=p*p;a+=(g-a)/h;f+=(g*p-f)/h;c+=(g*g-c)/h;l+=(p*m-l)/h;d+=(g*m-d)/h}const b=c-a*a,v=a*b-f*f,y=(d*a-l*f)/v,w=(l*b-d*f)/v,A=-y*a,x=t=>{t=t-u;return y*t*t+w*t+A+o};return{coef:[A-w*u+y*u*u+o,w-2*y*u,y],predict:x,rSquared:Pc(t,e,n,o,x)}}function Wc(t,e,n,i){if(i===1)return Lc(t,e,n);if(i===2)return Uc(t,e,n);const[r,u,o,s]=zc(t,e,n),a=r.length,f=[],c=[],l=i+1;let d,h,p,m,g;for(d=0;d<l;++d){for(p=0,m=0;p<a;++p){m+=Math.pow(r[p],d)*u[p]}f.push(m);g=new Float64Array(l);for(h=0;h<l;++h){for(p=0,m=0;p<a;++p){m+=Math.pow(r[p],d+h)}g[h]=m}c.push(g)}c.push(f);const b=Hc(c),v=t=>{t-=o;let e=s+b[0]+b[1]*t+b[2]*t*t;for(d=3;d<l;++d)e+=b[d]*Math.pow(t,d);return e};return{coef:Gc(l,b,-o,s),predict:v,rSquared:Pc(t,e,n,s,v)}}function Gc(t,e,n,i){const r=Array(t);let u,o,s,a;for(u=0;u<t;++u)r[u]=0;for(u=t-1;u>=0;--u){s=e[u];a=1;r[u]+=s;for(o=1;o<=u;++o){a*=(u+1-o)/o;r[u-o]+=s*Math.pow(n,o)*a}}r[0]+=i;return r}function Hc(t){const e=t.length-1,n=[];let i,r,u,o,s;for(i=0;i<e;++i){o=i;for(r=i+1;r<e;++r){if(Math.abs(t[i][r])>Math.abs(t[i][o])){o=r}}for(u=i;u<e+1;++u){s=t[u][i];t[u][i]=t[u][o];t[u][o]=s}for(r=i+1;r<e;++r){for(u=e;u>=i;u--){t[u][r]-=t[u][i]*t[i][r]/t[i][i]}}}for(r=e-1;r>=0;--r){s=0;for(u=r+1;u<e;++u){s+=t[u][r]*n[u]}n[r]=(t[e][r]-s)/t[r][r]}return n}const Vc=2,Yc=1e-12;function Xc(t,e,n,i){const[r,u,o,s]=zc(t,e,n,true),a=r.length,f=Math.max(2,~~(i*a)),c=new Float64Array(a),l=new Float64Array(a),d=new Float64Array(a).fill(1);for(let h=-1;++h<=Vc;){const t=[0,f-1];for(let n=0;n<a;++n){const e=r[n],i=t[0],o=t[1],s=e-r[i]>r[o]-e?i:o;let a=0,f=0,h=0,p=0,m=0;const g=1/Math.abs(r[s]-e||1);for(let t=i;t<=o;++t){const n=r[t],i=u[t],o=Jc(Math.abs(e-n)*g)*d[t],s=n*o;a+=o;f+=s;h+=i*o;p+=i*s;m+=n*s}const[b,v]=Nc(f/a,h/a,p/a,m/a);c[n]=b+v*e;l[n]=Math.abs(u[n]-c[n]);Qc(r,n+1,t)}if(h===Vc){break}const e=zi(l);if(Math.abs(e)<Yc)break;for(let n=0,i,r;n<a;++n){i=l[n]/(6*e);d[n]=i>=1?Yc:(r=1-i*i)*r}}return Zc(r,c,o,s)}function Jc(t){return(t=1-t*t*t)*t*t}function Qc(t,e,n){const i=t[e];let r=n[0],u=n[1]+1;if(u>=t.length)return;while(e>r&&t[u]-i<=i-t[r]){n[0]=++r;n[1]=u;++u}}function Zc(t,e,n,i){const r=t.length,u=[];let o=0,s=0,a=[],f;for(;o<r;++o){f=t[o]+n;if(a[0]===f){a[1]+=(e[o]-a[1])/++s}else{s=0;a[1]+=i;a=[f,e[o]];u.push(a)}}a[1]+=i;return u}const Kc=.5*Math.PI/180;function tl(t,e,n,i){n=n||25;i=Math.max(n,i||200);const r=e=>[e,t(e)],u=e[0],o=e[1],s=o-u,a=s/i,f=[r(u)],c=[];if(n===i){for(let t=1;t<i;++t){f.push(r(u+t/n*s))}f.push(r(o));return f}else{c.push(r(o));for(let t=n;--t>0;){c.push(r(u+t/n*s))}}let l=f[0];let d=c[c.length-1];const h=1/s;const p=el(l[1],c);while(d){const t=r((l[0]+d[0])/2);const e=t[0]-l[0]>=a;if(e&&nl(l,t,d,h,p)>Kc){c.push(t)}else{l=d;f.push(d);c.pop()}d=c[c.length-1]}return f}function el(t,e){let n=t;let i=t;const r=e.length;for(let u=0;u<r;++u){const t=e[u][1];if(t<n)n=t;if(t>i)i=t}return 1/(i-n)}function nl(t,e,n,i,r){const u=Math.atan2(r*(n[1]-t[1]),i*(n[0]-t[0])),o=Math.atan2(r*(e[1]-t[1]),i*(e[0]-t[0]));return Math.abs(u-o)}function il(t){return e=>{const n=t.length;let i=1,r=String(t[0](e));for(;i<n;++i){r+="|"+t[i](e)}return r}}function rl(t){return!t||!t.length?function(){return""}:t.length===1?t[0]:il(t)}function ul(t,e,n){return n||t+(!e?"":"_"+e)}const ol=()=>{};const sl={init:ol,add:ol,rem:ol,idx:0};const al={values:{init:t=>t.cell.store=true,value:t=>t.cell.data.values(),idx:-1},count:{value:t=>t.cell.num},__count__:{value:t=>t.missing+t.valid},missing:{value:t=>t.missing},valid:{value:t=>t.valid},sum:{init:t=>t.sum=0,value:t=>t.sum,add:(t,e)=>t.sum+=+e,rem:(t,e)=>t.sum-=e},product:{init:t=>t.product=1,value:t=>t.valid?t.product:undefined,add:(t,e)=>t.product*=e,rem:(t,e)=>t.product/=e},mean:{init:t=>t.mean=0,value:t=>t.valid?t.mean:undefined,add:(t,e)=>(t.mean_d=e-t.mean,t.mean+=t.mean_d/t.valid),rem:(t,e)=>(t.mean_d=e-t.mean,t.mean-=t.valid?t.mean_d/t.valid:t.mean)},average:{value:t=>t.valid?t.mean:undefined,req:["mean"],idx:1},variance:{init:t=>t.dev=0,value:t=>t.valid>1?t.dev/(t.valid-1):undefined,add:(t,e)=>t.dev+=t.mean_d*(e-t.mean),rem:(t,e)=>t.dev-=t.mean_d*(e-t.mean),req:["mean"],idx:1},variancep:{value:t=>t.valid>1?t.dev/t.valid:undefined,req:["variance"],idx:2},stdev:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid-1)):undefined,req:["variance"],idx:2},stdevp:{value:t=>t.valid>1?Math.sqrt(t.dev/t.valid):undefined,req:["variance"],idx:2},stderr:{value:t=>t.valid>1?Math.sqrt(t.dev/(t.valid*(t.valid-1))):undefined,req:["variance"],idx:2},distinct:{value:t=>t.cell.data.distinct(t.get),req:["values"],idx:3},ci0:{value:t=>t.cell.data.ci0(t.get),req:["values"],idx:3},ci1:{value:t=>t.cell.data.ci1(t.get),req:["values"],idx:3},median:{value:t=>t.cell.data.q2(t.get),req:["values"],idx:3},q1:{value:t=>t.cell.data.q1(t.get),req:["values"],idx:3},q3:{value:t=>t.cell.data.q3(t.get),req:["values"],idx:3},min:{init:t=>t.min=undefined,value:t=>t.min=Number.isNaN(t.min)?t.cell.data.min(t.get):t.min,add:(t,e)=>{if(e<t.min||t.min===undefined)t.min=e},rem:(t,e)=>{if(e<=t.min)t.min=NaN},req:["values"],idx:4},max:{init:t=>t.max=undefined,value:t=>t.max=Number.isNaN(t.max)?t.cell.data.max(t.get):t.max,add:(t,e)=>{if(e>t.max||t.max===undefined)t.max=e},rem:(t,e)=>{if(e>=t.max)t.max=NaN},req:["values"],idx:4},argmin:{init:t=>t.argmin=undefined,value:t=>t.argmin||t.cell.data.argmin(t.get),add:(t,e,n)=>{if(e<t.min)t.argmin=n},rem:(t,e)=>{if(e<=t.min)t.argmin=undefined},req:["min","values"],idx:3},argmax:{init:t=>t.argmax=undefined,value:t=>t.argmax||t.cell.data.argmax(t.get),add:(t,e,n)=>{if(e>t.max)t.argmax=n},rem:(t,e)=>{if(e>=t.max)t.argmax=undefined},req:["max","values"],idx:3}};const fl=Object.keys(al).filter((t=>t!=="__count__"));function cl(t,e){return n=>tn({name:t,out:n||t},sl,e)}[...fl,"__count__"].forEach((t=>{al[t]=cl(t,al[t])}));function ll(t,e){return al[t](e)}function dl(t,e){return t.idx-e.idx}function hl(t){const e={};t.forEach((t=>e[t.name]=t));const n=t=>{if(!t.req)return;t.req.forEach((t=>{if(!e[t])n(e[t]=al[t]())}))};t.forEach(n);return Object.values(e).sort(dl)}function pl(){this.valid=0;this.missing=0;this._ops.forEach((t=>t.init(this)))}function ml(t,e){if(t==null||t===""){++this.missing;return}if(t!==t)return;++this.valid;this._ops.forEach((n=>n.add(this,t,e)))}function gl(t,e){if(t==null||t===""){--this.missing;return}if(t!==t)return;--this.valid;this._ops.forEach((n=>n.rem(this,t,e)))}function bl(t){this._out.forEach((e=>t[e.out]=e.value(this)));return t}function vl(t,e){const n=e||oe,i=hl(t),r=t.slice().sort(dl);function u(t){this._ops=i;this._out=r;this.cell=t;this.init()}u.prototype.init=pl;u.prototype.add=ml;u.prototype.rem=gl;u.prototype.set=bl;u.prototype.get=n;u.fields=t.map((t=>t.out));return u}function yl(t){this._key=t?re(t):za;this.reset()}const wl=yl.prototype;wl.reset=function(){this._add=[];this._rem=[];this._ext=null;this._get=null;this._q=null};wl.add=function(t){this._add.push(t)};wl.rem=function(t){this._rem.push(t)};wl.values=function(){this._get=null;if(this._rem.length===0)return this._add;const t=this._add,e=this._rem,n=this._key,i=t.length,r=e.length,u=Array(i-r),o={};let s,a,f;for(s=0;s<r;++s){o[n(e[s])]=1}for(s=0,a=0;s<i;++s){if(o[n(f=t[s])]){o[n(f)]=0}else{u[a++]=f}}this._rem=[];return this._add=u};wl.distinct=function(t){const e=this.values(),n={};let i=e.length,r=0,u;while(--i>=0){u=t(e[i])+"";if(!un(n,u)){n[u]=1;++r}}return r};wl.extent=function(t){if(this._get!==t||!this._ext){const e=this.values(),n=nn(e,t);this._ext=[e[n[0]],e[n[1]]];this._get=t}return this._ext};wl.argmin=function(t){return this.extent(t)[0]||{}};wl.argmax=function(t){return this.extent(t)[1]||{}};wl.min=function(t){const e=this.extent(t)[0];return e!=null?t(e):undefined};wl.max=function(t){const e=this.extent(t)[1];return e!=null?t(e):undefined};wl.quartile=function(t){if(this._get!==t||!this._q){this._q=rc(this.values(),t);this._get=t}return this._q};wl.q1=function(t){return this.quartile(t)[0]};wl.q2=function(t){return this.quartile(t)[1]};wl.q3=function(t){return this.quartile(t)[2]};wl.ci=function(t){if(this._get!==t||!this._ci){this._ci=fc(this.values(),1e3,.05,t);this._get=t}return this._ci};wl.ci0=function(t){return this.ci(t)[0]};wl.ci1=function(t){return this.ci(t)[1]};function Al(t){Zf.call(this,null,t);this._adds=[];this._mods=[];this._alen=0;this._mlen=0;this._drop=true;this._cross=false;this._dims=[];this._dnames=[];this._measures=[];this._countOnly=false;this._counts=null;this._prev=null;this._inputs=null;this._outputs=null}Al.Definition={type:"Aggregate",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:fl},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"drop",type:"boolean",default:true},{name:"cross",type:"boolean",default:false},{name:"key",type:"field"}]};fn(Al,Zf,{transform(t,e){const n=this,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.modified();n.stamp=i.stamp;if(n.value&&(r||e.modified(n._inputs,true))){n._prev=n.value;n.value=r?n.init(t):Object.create(null);e.visit(e.SOURCE,(t=>n.add(t)))}else{n.value=n.value||n.init(t);e.visit(e.REM,(t=>n.rem(t)));e.visit(e.ADD,(t=>n.add(t)))}i.modifies(n._outputs);n._drop=t.drop!==false;if(t.cross&&n._dims.length>1){n._drop=false;n.cross()}if(e.clean()&&n._drop){i.clean(true).runAfter((()=>this.clean()))}return n.changes(i)},cross(){const t=this,e=t.value,n=t._dnames,i=n.map((()=>({}))),r=n.length;function u(t){let e,u,o,s;for(e in t){o=t[e].tuple;for(u=0;u<r;++u){i[u][s=o[n[u]]]=s}}}u(t._prev);u(e);function o(u,s,a){const f=n[a],c=i[a++];for(const n in c){const i=u?u+"|"+n:n;s[f]=c[n];if(a<r)o(i,s,a);else if(!e[i])t.cell(i,s)}}o("",{},0)},init(t){const e=this._inputs=[],n=this._outputs=[],i={};function r(t){const n=Ue(Zt(t)),r=n.length;let u=0,o;for(;u<r;++u){if(!i[o=n[u]]){i[o]=1;e.push(o)}}}this._dims=Ue(t.groupby);this._dnames=this._dims.map((t=>{const e=Qt(t);r(t);n.push(e);return e}));this.cellkey=t.key?t.key:rl(this._dims);this._countOnly=true;this._counts=[];this._measures=[];const u=t.fields||[null],o=t.ops||["count"],s=t.as||[],a=u.length,f={};let c,l,d,h,p,m;if(a!==o.length){ne("Unmatched number of fields and aggregate ops.")}for(m=0;m<a;++m){c=u[m];l=o[m];if(c==null&&l!=="count"){ne("Null aggregate field specified.")}h=Qt(c);p=ul(l,h,s[m]);n.push(p);if(l==="count"){this._counts.push(p);continue}d=f[h];if(!d){r(c);d=f[h]=[];d.field=c;this._measures.push(d)}if(l!=="count")this._countOnly=false;d.push(ll(l,p))}this._measures=this._measures.map((t=>vl(t,t.field)));return Object.create(null)},cellkey:rl(),cell(t,e){let n=this.value[t];if(!n){n=this.value[t]=this.newcell(t,e);this._adds[this._alen++]=n}else if(n.num===0&&this._drop&&n.stamp<this.stamp){n.stamp=this.stamp;this._adds[this._alen++]=n}else if(n.stamp<this.stamp){n.stamp=this.stamp;this._mods[this._mlen++]=n}return n},newcell(t,e){const n={key:t,num:0,agg:null,tuple:this.newtuple(e,this._prev&&this._prev[t]),stamp:this.stamp,store:false};if(!this._countOnly){const t=this._measures,e=t.length;n.agg=Array(e);for(let i=0;i<e;++i){n.agg[i]=new t[i](n)}}if(n.store){n.data=new yl}return n},newtuple(t,e){const n=this._dnames,i=this._dims,r=i.length,u={};for(let o=0;o<r;++o){u[n[o]]=i[o](t)}return e?Ra(e.tuple,u):Pa(u)},clean(){const t=this.value;for(const e in t){if(t[e].num===0){delete t[e]}}},add(t){const e=this.cellkey(t),n=this.cell(e,t);n.num+=1;if(this._countOnly)return;if(n.store)n.data.add(t);const i=n.agg;for(let r=0,u=i.length;r<u;++r){i[r].add(i[r].get(t),t)}},rem(t){const e=this.cellkey(t),n=this.cell(e,t);n.num-=1;if(this._countOnly)return;if(n.store)n.data.rem(t);const i=n.agg;for(let r=0,u=i.length;r<u;++r){i[r].rem(i[r].get(t),t)}},celltuple(t){const e=t.tuple,n=this._counts;if(t.store){t.data.values()}for(let i=0,r=n.length;i<r;++i){e[n[i]]=t.num}if(!this._countOnly){const n=t.agg;for(let t=0,i=n.length;t<i;++t){n[t].set(e)}}return e},changes(t){const e=this._adds,n=this._mods,i=this._prev,r=this._drop,u=t.add,o=t.rem,s=t.mod;let a,f,c,l;if(i)for(f in i){a=i[f];if(!r||a.num)o.push(a.tuple)}for(c=0,l=this._alen;c<l;++c){u.push(this.celltuple(e[c]));e[c]=null}for(c=0,l=this._mlen;c<l;++c){a=n[c];(a.num===0&&r?o:s).push(this.celltuple(a));n[c]=null}this._alen=this._mlen=0;this._prev=null;return t}});const xl=1e-14;function Ol(t){Zf.call(this,null,t)}Ol.Definition={type:"Bin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"interval",type:"boolean",default:true},{name:"anchor",type:"number"},{name:"maxbins",type:"number",default:20},{name:"base",type:"number",default:10},{name:"divide",type:"number",array:true,default:[5,2]},{name:"extent",type:"number",array:true,length:2,required:true},{name:"span",type:"number"},{name:"step",type:"number"},{name:"steps",type:"number",array:true},{name:"minstep",type:"number",default:0},{name:"nice",type:"boolean",default:true},{name:"name",type:"string"},{name:"as",type:"string",array:true,length:2,default:["bin0","bin1"]}]};fn(Ol,Zf,{transform(t,e){const n=t.interval!==false,i=this._bins(t),r=i.start,u=i.step,o=t.as||["bin0","bin1"],s=o[0],a=o[1];let f;if(t.modified()){e=e.reflow(true);f=e.SOURCE}else{f=e.modified(Zt(t.field))?e.ADD_MOD:e.ADD}e.visit(f,n?t=>{const e=i(t);t[s]=e;t[a]=e==null?null:r+u*(1+(e-r)/u)}:t=>t[s]=i(t));return e.modifies(n?o:s)},_bins(t){if(this.value&&!t.modified()){return this.value}const e=t.field,n=oc(t),i=n.step;let r=n.start,u=r+Math.ceil((n.stop-r)/i)*i,o,s;if((o=t.anchor)!=null){s=o-(r+i*Math.floor((o-r)/i));r+=s;u+=s}const a=function(t){let n=De(e(t));return n==null?null:n<r?-Infinity:n>u?+Infinity:(n=Math.max(r,Math.min(n,u-i)),r+i*Math.floor(xl+(n-r)/i))};a.start=r;a.stop=n.stop;a.step=i;return this.value=Jt(a,Zt(e),t.name||"bin_"+Qt(e))}});function Fl(t,e,n){const i=t;let r=e||[],u=n||[],o={},s=0;return{add:t=>u.push(t),remove:t=>o[i(t)]=++s,size:()=>r.length,data:(t,e)=>{if(s){r=r.filter((t=>!o[i(t)]));o={};s=0}if(e&&t){r.sort(t)}if(u.length){r=t?An(t,r,u.sort(t)):r.concat(u);u=[]}return r}}}function Dl(t){Zf.call(this,[],t)}Dl.Definition={type:"Collect",metadata:{source:true},params:[{name:"sort",type:"compare"}]};fn(Dl,Zf,{transform(t,e){const n=e.fork(e.ALL),i=Fl(za,this.value,n.materialize(n.ADD).add),r=t.sort,u=e.changed()||r&&(t.modified("sort")||e.modified(r.fields));n.visit(n.REM,i.remove);this.modified(u);this.value=n.source=i.data(qa(r),u);if(e.source&&e.source.root){this.value.root=e.source.root}return n}});function kl(t){Za.call(this,null,El,t)}fn(kl,Za);function El(t){return this.value&&!t.modified()?this.value:Ve(t.fields,t.orders)}function $l(t){Zf.call(this,null,t)}$l.Definition={type:"CountPattern",metadata:{generates:true,changes:true},params:[{name:"field",type:"field",required:true},{name:"case",type:"enum",values:["upper","lower","mixed"],default:"mixed"},{name:"pattern",type:"string",default:'[\\w"]+'},{name:"stopwords",type:"string",default:""},{name:"as",type:"string",array:true,length:2,default:["text","count"]}]};function jl(t,e,n){switch(e){case"upper":t=t.toUpperCase();break;case"lower":t=t.toLowerCase();break}return t.match(n)}fn($l,Zf,{transform(t,e){const n=e=>n=>{var i=jl(s(n),t.case,u)||[],r;for(var a=0,f=i.length;a<f;++a){if(!o.test(r=i[a]))e(r)}};const i=this._parameterCheck(t,e),r=this._counts,u=this._match,o=this._stop,s=t.field,a=t.as||["text","count"],f=n((t=>r[t]=1+(r[t]||0))),c=n((t=>r[t]-=1));if(i){e.visit(e.SOURCE,f)}else{e.visit(e.ADD,f);e.visit(e.REM,c)}return this._finish(e,a)},_parameterCheck(t,e){let n=false;if(t.modified("stopwords")||!this._stop){this._stop=new RegExp("^"+(t.stopwords||"")+"$","i");n=true}if(t.modified("pattern")||!this._match){this._match=new RegExp(t.pattern||"[\\w']+","g");n=true}if(t.modified("field")||e.modified(t.field.fields)){n=true}if(n)this._counts={};return n},_finish(t,e){const n=this._counts,i=this._tuples||(this._tuples={}),r=e[0],u=e[1],o=t.fork(t.NO_SOURCE|t.NO_FIELDS);let s,a,f;for(s in n){a=i[s];f=n[s]||0;if(!a&&f){i[s]=a=Pa({});a[r]=s;a[u]=f;o.add.push(a)}else if(f===0){if(a)o.rem.push(a);n[s]=null;i[s]=null}else if(a[u]!==f){a[u]=f;o.mod.push(a)}}return o.modifies(e)}});function Cl(t){Zf.call(this,null,t)}Cl.Definition={type:"Cross",metadata:{generates:true},params:[{name:"filter",type:"expr"},{name:"as",type:"string",array:true,length:2,default:["a","b"]}]};fn(Cl,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.as||["a","b"],r=i[0],u=i[1],o=!this.value||e.changed(e.ADD_REM)||t.modified("as")||t.modified("filter");let s=this.value;if(o){if(s)n.rem=s;s=e.materialize(e.SOURCE).source;n.add=this.value=Ml(s,r,u,t.filter||fe)}else{n.mod=s}n.source=this.value;return n.modifies(i)}});function Ml(t,e,n,i){var r=[],u={},o=t.length,s=0,a,f;for(;s<o;++s){u[e]=f=t[s];for(a=0;a<o;++a){u[n]=t[a];if(i(u)){r.push(Pa(u));u={};u[e]=f}}}return r}const Bl={kde:Oc,mixture:jc,normal:xc,lognormal:$c,uniform:_c};const Sl="distributions",_l="function",Nl="field";function zl(t,e){const n=t[_l];if(!un(Bl,n)){ne("Unknown distribution function: "+n)}const i=Bl[n]();for(const r in t){if(r===Nl){i.data((t.from||e()).map(t[r]))}else if(r===Sl){i[r](t[r].map((t=>zl(t,e))))}else if(typeof i[r]===_l){i[r](t[r])}}return i}function Tl(t){Zf.call(this,null,t)}const Pl=[{key:{function:"normal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"lognormal"},params:[{name:"mean",type:"number",default:0},{name:"stdev",type:"number",default:1}]},{key:{function:"uniform"},params:[{name:"min",type:"number",default:0},{name:"max",type:"number",default:1}]},{key:{function:"kde"},params:[{name:"field",type:"field",required:true},{name:"from",type:"data"},{name:"bandwidth",type:"number",default:0}]}];const Ll={key:{function:"mixture"},params:[{name:"distributions",type:"param",array:true,params:Pl},{name:"weights",type:"number",array:true}]};Tl.Definition={type:"Density",metadata:{generates:true},params:[{name:"extent",type:"number",array:true,length:2},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"method",type:"string",default:"pdf",values:["pdf","cdf"]},{name:"distribution",type:"param",params:Pl.concat(Ll)},{name:"as",type:"string",array:true,default:["value","density"]}]};fn(Tl,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=zl(t.distribution,Il(e)),r=t.steps||t.minsteps||25,u=t.steps||t.maxsteps||200;let o=t.method||"pdf";if(o!=="pdf"&&o!=="cdf"){ne("Invalid density method: "+o)}if(!t.extent&&!i.data){ne("Missing density extent parameter.")}o=i[o];const s=t.as||["value","density"],a=t.extent||en(i.data()),f=tl(o,a,r,u).map((t=>{const e={};e[s[0]]=t[0];e[s[1]]=t[1];return Pa(e)}));if(this.value)n.rem=this.value;this.value=n.add=n.source=f}return n}});function Il(t){return()=>t.materialize(t.SOURCE).source}function Rl(t,e){if(!t)return null;return t.map(((t,n)=>e[n]||Qt(t)))}function ql(t,e,n){const i=[],r=t=>t(a);let u,o,s,a,f,c;if(e==null){i.push(t.map(n))}else{for(u={},o=0,s=t.length;o<s;++o){a=t[o];f=e.map(r);c=u[f];if(!c){u[f]=c=[];c.dims=f;i.push(c)}c.push(n(a))}}return i}const Ul="bin";function Wl(t){Zf.call(this,null,t)}Wl.Definition={type:"DotBin",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"step",type:"number"},{name:"smooth",type:"boolean",default:false},{name:"as",type:"string",default:Ul}]};const Gl=(t,e)=>Fn(en(t,e))/30;fn(Wl,Zf,{transform(t,e){if(this.value&&!(t.modified()||e.changed())){return e}const n=e.materialize(e.SOURCE).source,i=ql(e.source,t.groupby,oe),r=t.smooth||false,u=t.field,o=t.step||Gl(n,u),s=qa(((t,e)=>u(t)-u(e))),a=t.as||Ul,f=i.length;let c=Infinity,l=-Infinity,d=0,h;for(;d<f;++d){const t=i[d].sort(s);h=-1;for(const e of cc(t,o,r,u)){if(e<c)c=e;if(e>l)l=e;t[++h][a]=e}}this.value={start:c,stop:l,step:o};return e.reflow(true).modifies(a)}});function Hl(t){Za.call(this,null,Vl,t);this.modified(true)}fn(Hl,Za);function Vl(t){const e=t.expr;return this.value&&!t.modified("expr")?this.value:Jt((n=>e(n,t)),Zt(e),Qt(e))}function Yl(t){Zf.call(this,[undefined,undefined],t)}Yl.Definition={type:"Extent",metadata:{},params:[{name:"field",type:"field",required:true}]};fn(Yl,Zf,{transform(t,e){const n=this.value,i=t.field,r=e.changed()||e.modified(i.fields)||t.modified("field");let u=n[0],o=n[1];if(r||u==null){u=+Infinity;o=-Infinity}e.visit(r?e.SOURCE:e.ADD,(t=>{const e=De(i(t));if(e!=null){if(e<u)u=e;if(e>o)o=e}}));if(!Number.isFinite(u)||!Number.isFinite(o)){let t=Qt(i);if(t)t=` for field "${t}"`;e.dataflow.warn(`Infinite extent${t}: [${u}, ${o}]`);u=o=undefined}this.value=[u,o]}});function Xl(t,e){Za.call(this,t);this.parent=e;this.count=0}fn(Xl,Za,{connect(t){this.detachSubflow=t.detachSubflow;this.targets().add(t);return t.source=this},add(t){this.count+=1;this.value.add.push(t)},rem(t){this.count-=1;this.value.rem.push(t)},mod(t){this.value.mod.push(t)},init(t){this.value.init(t,t.NO_SOURCE)},evaluate(){return this.value}});function Jl(t){Zf.call(this,{},t);this._keys=sn();const e=this._targets=[];e.active=0;e.forEach=t=>{for(let n=0,i=e.active;n<i;++n){t(e[n],n,e)}}}fn(Jl,Zf,{activate(t){this._targets[this._targets.active++]=t},subflow(t,e,n,i){const r=this.value;let u=un(r,t)&&r[t],o,s;if(!u){s=i||(s=this._group[t])&&s.tuple;o=n.dataflow;u=new Xl(n.fork(n.NO_SOURCE),this);o.add(u).connect(e(o,t,s));r[t]=u;this.activate(u)}else if(u.value.stamp<n.stamp){u.init(n);this.activate(u)}return u},clean(){const t=this.value;let e=0;for(const n in t){if(t[n].count===0){const i=t[n].detachSubflow;if(i)i();delete t[n];++e}}if(e){const t=this._targets.filter((t=>t&&t.count>0));this.initTargets(t)}},initTargets(t){const e=this._targets,n=e.length,i=t?t.length:0;let r=0;for(;r<i;++r){e[r]=t[r]}for(;r<n&&e[r]!=null;++r){e[r]=null}e.active=i},transform(t,e){const n=e.dataflow,i=t.key,r=t.subflow,u=this._keys,o=t.modified("key"),s=t=>this.subflow(t,r,e);this._group=t.group||{};this.initTargets();e.visit(e.REM,(t=>{const e=za(t),n=u.get(e);if(n!==undefined){u.delete(e);s(n).rem(t)}}));e.visit(e.ADD,(t=>{const e=i(t);u.set(za(t),e);s(e).add(t)}));if(o||e.modified(i.fields)){e.visit(e.MOD,(t=>{const e=za(t),n=u.get(e),r=i(t);if(n===r){s(r).mod(t)}else{u.set(e,r);s(n).rem(t);s(r).add(t)}}))}else if(e.changed(e.MOD)){e.visit(e.MOD,(t=>{s(u.get(za(t))).mod(t)}))}if(o){e.visit(e.REFLOW,(t=>{const e=za(t),n=u.get(e),r=i(t);if(n!==r){u.set(e,r);s(n).rem(t);s(r).add(t)}}))}if(e.clean()){n.runAfter((()=>{this.clean();u.clean()}))}else if(u.empty>n.cleanThreshold){n.runAfter(u.clean)}return e}});function Ql(t){Za.call(this,null,Zl,t)}fn(Ql,Za);function Zl(t){return this.value&&!t.modified()?this.value:ve(t.name)?Ue(t.name).map((t=>re(t))):re(t.name,t.as)}function Kl(t){Zf.call(this,sn(),t)}Kl.Definition={type:"Filter",metadata:{changes:true},params:[{name:"expr",type:"expr",required:true}]};fn(Kl,Zf,{transform(t,e){const n=e.dataflow,i=this.value,r=e.fork(),u=r.add,o=r.rem,s=r.mod,a=t.expr;let f=true;e.visit(e.REM,(t=>{const e=za(t);if(!i.has(e))o.push(t);else i.delete(e)}));e.visit(e.ADD,(e=>{if(a(e,t))u.push(e);else i.set(za(e),1)}));function c(e){const n=za(e),r=a(e,t),c=i.get(n);if(r&&c){i.delete(n);u.push(e)}else if(!r&&!c){i.set(n,1);o.push(e)}else if(f&&r&&!c){s.push(e)}}e.visit(e.MOD,c);if(t.modified()){f=false;e.visit(e.REFLOW,c)}if(i.empty>n.cleanThreshold)n.runAfter(i.clean);return r}});function td(t){Zf.call(this,[],t)}td.Definition={type:"Flatten",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"index",type:"string"},{name:"as",type:"string",array:true}]};fn(td,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=Rl(i,t.as||[]),u=t.index||null,o=r.length;n.rem=this.value;e.visit(e.SOURCE,(t=>{const e=i.map((e=>e(t))),s=e.reduce(((t,e)=>Math.max(t,e.length)),0);let a=0,f,c,l;for(;a<s;++a){c=La(t);for(f=0;f<o;++f){c[r[f]]=(l=e[f][a])==null?null:l}if(u){c[u]=a}n.add.push(c)}}));this.value=n.source=n.add;if(u)n.modifies(u);return n.modifies(r)}});function ed(t){Zf.call(this,[],t)}ed.Definition={type:"Fold",metadata:{generates:true},params:[{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true,length:2,default:["key","value"]}]};fn(ed,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=i.map(Qt),u=t.as||["key","value"],o=u[0],s=u[1],a=i.length;n.rem=this.value;e.visit(e.SOURCE,(t=>{for(let e=0,u;e<a;++e){u=La(t);u[o]=r[e];u[s]=i[e](t);n.add.push(u)}}));this.value=n.source=n.add;return n.modifies(u)}});function nd(t){Zf.call(this,null,t)}nd.Definition={type:"Formula",metadata:{modifies:true},params:[{name:"expr",type:"expr",required:true},{name:"as",type:"string",required:true},{name:"initonly",type:"boolean"}]};fn(nd,Zf,{transform(t,e){const n=t.expr,i=t.as,r=t.modified(),u=t.initonly?e.ADD:r?e.SOURCE:e.modified(n.fields)||e.modified(i)?e.ADD_MOD:e.ADD;if(r){e=e.materialize().reflow(true)}if(!t.initonly){e.modifies(i)}return e.visit(u,(e=>e[i]=n(e,t)))}});function id(t){Zf.call(this,[],t)}fn(id,Zf,{transform(t,e){const n=e.fork(e.ALL),i=t.generator;let r=this.value,u=t.size-r.length,o,s,a;if(u>0){for(o=[];--u>=0;){o.push(a=Pa(i(t)));r.push(a)}n.add=n.add.length?n.materialize(n.ADD).add.concat(o):o}else{s=r.slice(0,-u);n.rem=n.rem.length?n.materialize(n.REM).rem.concat(s):s;r=r.slice(-u)}n.source=this.value=r;return n}});const rd={value:"value",median:zi,mean:Ni,min:Ci,max:ji};const ud=[];function od(t){Zf.call(this,[],t)}od.Definition={type:"Impute",metadata:{changes:true},params:[{name:"field",type:"field",required:true},{name:"key",type:"field",required:true},{name:"keyvals",array:true},{name:"groupby",type:"field",array:true},{name:"method",type:"enum",default:"value",values:["value","mean","median","max","min"]},{name:"value",default:0}]};function sd(t){var e=t.method||rd.value,n;if(rd[e]==null){ne("Unrecognized imputation method: "+e)}else if(e===rd.value){n=t.value!==undefined?t.value:0;return()=>n}else{return rd[e]}}function ad(t){const e=t.field;return t=>t?e(t):NaN}fn(od,Zf,{transform(t,e){var n=e.fork(e.ALL),i=sd(t),r=ad(t),u=Qt(t.field),o=Qt(t.key),s=(t.groupby||[]).map(Qt),a=fd(e.source,t.groupby,t.key,t.keyvals),f=[],c=this.value,l=a.domain.length,d,h,p,m,g,b,v,y,w,A;for(g=0,y=a.length;g<y;++g){d=a[g];p=d.values;h=NaN;for(v=0;v<l;++v){if(d[v]!=null)continue;m=a.domain[v];A={_impute:true};for(b=0,w=p.length;b<w;++b)A[s[b]]=p[b];A[o]=m;A[u]=Number.isNaN(h)?h=i(d,r):h;f.push(Pa(A))}}if(f.length)n.add=n.materialize(n.ADD).add.concat(f);if(c.length)n.rem=n.materialize(n.REM).rem.concat(c);this.value=f;return n}});function fd(t,e,n,i){var r=t=>t(g),u=[],o=i?i.slice():[],s={},a={},f,c,l,d,h,p,m,g;o.forEach(((t,e)=>s[t]=e+1));for(d=0,m=t.length;d<m;++d){g=t[d];p=n(g);h=s[p]||(s[p]=o.push(p));c=(f=e?e.map(r):ud)+"";if(!(l=a[c])){l=a[c]=[];u.push(l);l.values=f}l[h-1]=g}u.domain=o;return u}function cd(t){Al.call(this,t)}cd.Definition={type:"JoinAggregate",metadata:{modifies:true},params:[{name:"groupby",type:"field",array:true},{name:"fields",type:"field",null:true,array:true},{name:"ops",type:"enum",array:true,values:fl},{name:"as",type:"string",null:true,array:true},{name:"key",type:"field"}]};fn(cd,Al,{transform(t,e){const n=this,i=t.modified();let r;if(n.value&&(i||e.modified(n._inputs,true))){r=n.value=i?n.init(t):{};e.visit(e.SOURCE,(t=>n.add(t)))}else{r=n.value=n.value||this.init(t);e.visit(e.REM,(t=>n.rem(t)));e.visit(e.ADD,(t=>n.add(t)))}n.changes();e.visit(e.SOURCE,(t=>{tn(t,r[n.cellkey(t)].tuple)}));return e.reflow(i).modifies(this._outputs)},changes(){const t=this._adds,e=this._mods;let n,i;for(n=0,i=this._alen;n<i;++n){this.celltuple(t[n]);t[n]=null}for(n=0,i=this._mlen;n<i;++n){this.celltuple(e[n]);e[n]=null}this._alen=this._mlen=0}});function ld(t){Zf.call(this,null,t)}ld.Definition={type:"KDE",metadata:{generates:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"cumulative",type:"boolean",default:false},{name:"counts",type:"boolean",default:false},{name:"bandwidth",type:"number",default:0},{name:"extent",type:"number",array:true,length:2},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"steps",type:"number"},{name:"minsteps",type:"number",default:25},{name:"maxsteps",type:"number",default:200},{name:"as",type:"string",array:true,default:["value","density"]}]};fn(ld,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=ql(i,t.groupby,t.field),u=(t.groupby||[]).map(Qt),o=t.bandwidth,s=t.cumulative?"cdf":"pdf",a=t.as||["value","density"],f=[];let c=t.extent,l=t.steps||t.minsteps||25,d=t.steps||t.maxsteps||200;if(s!=="pdf"&&s!=="cdf"){ne("Invalid density method: "+s)}if(t.resolve==="shared"){if(!c)c=en(i,t.field);l=d=t.steps||d}r.forEach((e=>{const n=Oc(e,o)[s],i=t.counts?e.length:1,r=c||en(e);tl(n,r,l,d).forEach((t=>{const n={};for(let i=0;i<u.length;++i){n[u[i]]=e.dims[i]}n[a[0]]=t[0];n[a[1]]=t[1]*i;f.push(Pa(n))}))}));if(this.value)n.rem=this.value;this.value=n.add=n.source=f}return n}});function dd(t){Za.call(this,null,hd,t)}fn(dd,Za);function hd(t){return this.value&&!t.modified()?this.value:bn(t.fields,t.flat)}function pd(t){Zf.call(this,[],t);this._pending=null}fn(pd,Zf,{transform(t,e){const n=e.dataflow;if(this._pending){return gd(this,e,this._pending)}if(md(t))return e.StopPropagation;if(t.values){return gd(this,e,n.parse(t.values,t.format))}else if(t.async){const e=n.request(t.url,t.format).then((t=>{this._pending=Ue(t.data);return t=>t.touch(this)}));return{async:e}}else{return n.request(t.url,t.format).then((t=>gd(this,e,Ue(t.data))))}}});function md(t){return t.modified("async")&&!(t.modified("values")||t.modified("url")||t.modified("format"))}function gd(t,e,n){n.forEach(Pa);const i=e.fork(e.NO_FIELDS&e.NO_SOURCE);i.rem=t.value;t.value=i.source=i.add=n;t._pending=null;if(i.rem.length)i.clean(true);return i}function bd(t){Zf.call(this,{},t)}bd.Definition={type:"Lookup",metadata:{modifies:true},params:[{name:"index",type:"index",params:[{name:"from",type:"data",required:true},{name:"key",type:"field",required:true}]},{name:"values",type:"field",array:true},{name:"fields",type:"field",array:true,required:true},{name:"as",type:"string",array:true},{name:"default",default:null}]};fn(bd,Zf,{transform(t,e){const n=t.fields,i=t.index,r=t.values,u=t.default==null?null:t.default,o=t.modified(),s=n.length;let a=o?e.SOURCE:e.ADD,f=e,c=t.as,l,d,h;if(r){d=r.length;if(s>1&&!c){ne('Multi-field lookup requires explicit "as" parameter.')}if(c&&c.length!==s*d){ne('The "as" parameter has too few output field names.')}c=c||r.map(Qt);l=function(t){for(var e=0,o=0,a,f;e<s;++e){f=i.get(n[e](t));if(f==null)for(a=0;a<d;++a,++o)t[c[o]]=u;else for(a=0;a<d;++a,++o)t[c[o]]=r[a](f)}}}else{if(!c){ne("Missing output field names.")}l=function(t){for(var e=0,r;e<s;++e){r=i.get(n[e](t));t[c[e]]=r==null?u:r}}}if(o){f=e.reflow(true)}else{h=n.some((t=>e.modified(t.fields)));a|=h?e.MOD:0}e.visit(a,l);return f.modifies(c)}});function vd(t){Za.call(this,null,yd,t)}fn(vd,Za);function yd(t){if(this.value&&!t.modified()){return this.value}const e=t.extents,n=e.length;let i=+Infinity,r=-Infinity,u,o;for(u=0;u<n;++u){o=e[u];if(o[0]<i)i=o[0];if(o[1]>r)r=o[1]}return[i,r]}function wd(t){Za.call(this,null,Ad,t)}fn(wd,Za);function Ad(t){return this.value&&!t.modified()?this.value:t.values.reduce(((t,e)=>t.concat(e)),[])}function xd(t){Zf.call(this,null,t)}fn(xd,Zf,{transform(t,e){this.modified(t.modified());this.value=t;return e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function Od(t){Al.call(this,t)}Od.Definition={type:"Pivot",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"value",type:"field",required:true},{name:"op",type:"enum",values:fl,default:"sum"},{name:"limit",type:"number",default:0},{name:"key",type:"field"}]};fn(Od,Al,{_transform:Al.prototype.transform,transform(t,e){return this._transform(Fd(t,e),e)}});function Fd(t,e){const n=t.field,i=t.value,r=(t.op==="count"?"__count__":t.op)||"sum",u=Zt(n).concat(Zt(i)),o=kd(n,t.limit||0,e);if(e.changed())t.set("__pivot__",null,null,true);return{key:t.key,groupby:t.groupby,ops:o.map((()=>r)),fields:o.map((t=>Dd(t,n,i,u))),as:o.map((t=>t+"")),modified:t.modified.bind(t)}}function Dd(t,e,n,i){return Jt((i=>e(i)===t?n(i):NaN),i,t+"")}function kd(t,e,n){const i={},r=[];n.visit(n.SOURCE,(e=>{const n=t(e);if(!i[n]){i[n]=1;r.push(n)}}));r.sort(Ye);return e?r.slice(0,e):r}function Ed(t){Jl.call(this,t)}fn(Ed,Jl,{transform(t,e){const n=t.subflow,i=t.field,r=t=>this.subflow(za(t),n,e,t);if(t.modified("field")||i&&e.modified(Zt(i))){ne("PreFacet does not support field modification.")}this.initTargets();if(i){e.visit(e.MOD,(t=>{const e=r(t);i(t).forEach((t=>e.mod(t)))}));e.visit(e.ADD,(t=>{const e=r(t);i(t).forEach((t=>e.add(Pa(t))))}));e.visit(e.REM,(t=>{const e=r(t);i(t).forEach((t=>e.rem(t)))}))}else{e.visit(e.MOD,(t=>r(t).mod(t)));e.visit(e.ADD,(t=>r(t).add(t)));e.visit(e.REM,(t=>r(t).rem(t)))}if(e.clean()){e.runAfter((()=>this.clean()))}return e}});function $d(t){Zf.call(this,null,t)}$d.Definition={type:"Project",metadata:{generates:true,changes:true},params:[{name:"fields",type:"field",array:true},{name:"as",type:"string",null:true,array:true}]};fn($d,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.fields,r=Rl(t.fields,t.as||[]),u=i?(t,e)=>jd(t,e,i,r):Ia;let o;if(this.value){o=this.value}else{e=e.addAll();o=this.value={}}e.visit(e.REM,(t=>{const e=za(t);n.rem.push(o[e]);o[e]=null}));e.visit(e.ADD,(t=>{const e=u(t,Pa({}));o[za(t)]=e;n.add.push(e)}));e.visit(e.MOD,(t=>{n.mod.push(u(t,o[za(t)]))}));return n}});function jd(t,e,n,i){for(let r=0,u=n.length;r<u;++r){e[i[r]]=n[r](t)}return e}function Cd(t){Zf.call(this,null,t)}fn(Cd,Zf,{transform(t,e){this.value=t.value;return t.modified("value")?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function Md(t){Zf.call(this,null,t)}Md.Definition={type:"Quantile",metadata:{generates:true,changes:true},params:[{name:"groupby",type:"field",array:true},{name:"field",type:"field",required:true},{name:"probs",type:"number",array:true},{name:"step",type:"number",default:.01},{name:"as",type:"string",array:true,default:["prob","value"]}]};const Bd=1e-14;fn(Md,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=t.as||["prob","value"];if(this.value&&!t.modified()&&!e.changed()){n.source=this.value;return n}const r=e.materialize(e.SOURCE).source,u=ql(r,t.groupby,t.field),o=(t.groupby||[]).map(Qt),s=[],a=t.step||.01,f=t.probs||Li(a/2,1-Bd,a),c=f.length;u.forEach((t=>{const e=ic(t,f);for(let n=0;n<c;++n){const r={};for(let e=0;e<o.length;++e){r[o[e]]=t.dims[e]}r[i[0]]=f[n];r[i[1]]=e[n];s.push(Pa(r))}}));if(this.value)n.rem=this.value;this.value=n.add=n.source=s;return n}});function Sd(t){Zf.call(this,null,t)}fn(Sd,Zf,{transform(t,e){let n,i;if(this.value){i=this.value}else{n=e=e.addAll();i=this.value={}}if(t.derive){n=e.fork(e.NO_SOURCE);e.visit(e.REM,(t=>{const e=za(t);n.rem.push(i[e]);i[e]=null}));e.visit(e.ADD,(t=>{const e=La(t);i[za(t)]=e;n.add.push(e)}));e.visit(e.MOD,(t=>{const e=i[za(t)];for(const i in t){e[i]=t[i];n.modifies(i)}n.mod.push(e)}))}return n}});function _d(t){Zf.call(this,[],t);this.count=0}_d.Definition={type:"Sample",metadata:{},params:[{name:"size",type:"number",default:1e3}]};fn(_d,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE),i=t.modified("size"),r=t.size,u=this.value.reduce(((t,e)=>(t[za(e)]=1,t)),{});let o=this.value,s=this.count,a=0;function f(t){let e,i;if(o.length<r){o.push(t)}else{i=~~((s+1)*sc());if(i<o.length&&i>=a){e=o[i];if(u[za(e)])n.rem.push(e);o[i]=t}}++s}if(e.rem.length){e.visit(e.REM,(t=>{const e=za(t);if(u[e]){u[e]=-1;n.rem.push(t)}--s}));o=o.filter((t=>u[za(t)]!==-1))}if((e.rem.length||i)&&o.length<r&&e.source){a=s=o.length;e.visit(e.SOURCE,(t=>{if(!u[za(t)])f(t)}));a=-1}if(i&&o.length>r){const t=o.length-r;for(let e=0;e<t;++e){u[za(o[e])]=-1;n.rem.push(o[e])}o=o.slice(t)}if(e.mod.length){e.visit(e.MOD,(t=>{if(u[za(t)])n.mod.push(t)}))}if(e.add.length){e.visit(e.ADD,f)}if(e.add.length||a<0){n.add=o.filter((t=>!u[za(t)]))}this.count=s;this.value=n.source=o;return n}});function Nd(t){Zf.call(this,null,t)}Nd.Definition={type:"Sequence",metadata:{generates:true,changes:true},params:[{name:"start",type:"number",required:true},{name:"stop",type:"number",required:true},{name:"step",type:"number",default:1},{name:"as",type:"string",default:"data"}]};fn(Nd,Zf,{transform(t,e){if(this.value&&!t.modified())return;const n=e.materialize().fork(e.MOD),i=t.as||"data";n.rem=this.value?e.rem.concat(this.value):e.rem;this.value=Li(t.start,t.stop,t.step||1).map((t=>{const e={};e[i]=t;return Pa(e)}));n.add=e.add.concat(this.value);return n}});function zd(t){Zf.call(this,null,t);this.modified(true)}fn(zd,Zf,{transform(t,e){this.value=e.source;return e.changed()?e.fork(e.NO_SOURCE|e.NO_FIELDS):e.StopPropagation}});function Td(t){Zf.call(this,null,t)}const Pd=["unit0","unit1"];Td.Definition={type:"TimeUnit",metadata:{modifies:true},params:[{name:"field",type:"field",required:true},{name:"interval",type:"boolean",default:true},{name:"units",type:"enum",values:ru,array:true},{name:"step",type:"number",default:1},{name:"maxbins",type:"number",default:40},{name:"extent",type:"date",array:true},{name:"timezone",type:"enum",default:"local",values:["local","utc"]},{name:"as",type:"string",array:true,length:2,default:Pd}]};fn(Td,Zf,{transform(t,e){const n=t.field,i=t.interval!==false,r=t.timezone==="utc",u=this._floor(t,e),o=(r?Nu:_u)(u.unit).offset,s=t.as||Pd,a=s[0],f=s[1],c=u.step;let l=u.start||Infinity,d=u.stop||-Infinity,h=e.ADD;if(t.modified()||e.changed(e.REM)||e.modified(Zt(n))){e=e.reflow(true);h=e.SOURCE;l=Infinity;d=-Infinity}e.visit(h,(t=>{const e=n(t);let r,s;if(e==null){t[a]=null;if(i)t[f]=null}else{t[a]=r=s=u(e);if(i)t[f]=s=o(r,c);if(r<l)l=r;if(s>d)d=s}}));u.start=l;u.stop=d;return e.modifies(i?s:a)},_floor(t,e){const n=t.timezone==="utc";const{units:i,step:r}=t.units?{units:t.units,step:t.step||1}:ro({extent:t.extent||en(e.materialize(e.SOURCE).source,t.field),maxbins:t.maxbins});const u=ou(i),o=this.value||{},s=(n?Mu:$u)(u,r);s.unit=Fe(u);s.units=u;s.step=r;s.start=o.start;s.stop=o.stop;return this.value=s}});function Ld(t){Zf.call(this,sn(),t)}fn(Ld,Zf,{transform(t,e){const n=e.dataflow,i=t.field,r=this.value,u=t=>r.set(i(t),t);let o=true;if(t.modified("field")||e.modified(i.fields)){r.clear();e.visit(e.SOURCE,u)}else if(e.changed()){e.visit(e.REM,(t=>r.delete(i(t))));e.visit(e.ADD,u)}else{o=false}this.modified(o);if(r.empty>n.cleanThreshold)n.runAfter(r.clean);return e.fork()}});function Id(t){Zf.call(this,null,t)}fn(Id,Zf,{transform(t,e){const n=!this.value||t.modified("field")||t.modified("sort")||e.changed()||t.sort&&e.modified(t.sort.fields);if(n){this.value=(t.sort?e.source.slice().sort(qa(t.sort)):e.source).map(t.field)}}});function Rd(t,e,n,i){const r=qd[t](e,n);return{init:r.init||se,update:function(t,e){e[i]=r.next(t)}}}const qd={row_number:function(){return{next:t=>t.index+1}},rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?t=n+1:t}}},dense_rank:function(){let t;return{init:()=>t=1,next:e=>{const n=e.index,i=e.data;return n&&e.compare(i[n-1],i[n])?++t:t}}},percent_rank:function(){const t=qd.rank(),e=t.next;return{init:t.init,next:t=>(e(t)-1)/(t.data.length-1)}},cume_dist:function(){let t;return{init:()=>t=0,next:e=>{const n=e.data,i=e.compare;let r=e.index;if(t<r){while(r+1<n.length&&!i(n[r],n[r+1]))++r;t=r}return(1+t)/n.length}}},ntile:function(t,e){e=+e;if(!(e>0))ne("ntile num must be greater than zero.");const n=qd.cume_dist(),i=n.next;return{init:n.init,next:t=>Math.ceil(e*i(t))}},lag:function(t,e){e=+e||1;return{next:n=>{const i=n.index-e;return i>=0?t(n.data[i]):null}}},lead:function(t,e){e=+e||1;return{next:n=>{const i=n.index+e,r=n.data;return i<r.length?t(r[i]):null}}},first_value:function(t){return{next:e=>t(e.data[e.i0])}},last_value:function(t){return{next:e=>t(e.data[e.i1-1])}},nth_value:function(t,e){e=+e;if(!(e>0))ne("nth_value nth must be greater than zero.");return{next:n=>{const i=n.i0+(e-1);return i<n.i1?t(n.data[i]):null}}},prev_value:function(t){let e;return{init:()=>e=null,next:n=>{const i=t(n.data[n.index]);return i!=null?e=i:e}}},next_value:function(t){let e,n;return{init:()=>(e=null,n=-1),next:i=>{const r=i.data;return i.index<=n?e:(n=Ud(t,r,i.index))<0?(n=r.length,e=null):e=t(r[n])}}}};function Ud(t,e,n){for(let i=e.length;n<i;++n){const i=t(e[n]);if(i!=null)return n}return-1}const Wd=Object.keys(qd);function Gd(t){const e=Ue(t.ops),n=Ue(t.fields),i=Ue(t.params),r=Ue(t.as),u=this.outputs=[],o=this.windows=[],s={},a={},f=[],c=[];let l=true;function d(t){Ue(Zt(t)).forEach((t=>s[t]=1))}d(t.sort);e.forEach(((t,e)=>{const s=n[e],h=Qt(s),p=ul(t,h,r[e]);d(s);u.push(p);if(un(qd,t)){o.push(Rd(t,n[e],i[e],p))}else{if(s==null&&t!=="count"){ne("Null aggregate field specified.")}if(t==="count"){f.push(p);return}l=false;let e=a[h];if(!e){e=a[h]=[];e.field=s;c.push(e)}e.push(ll(t,p))}}));if(f.length||c.length){this.cell=Vd(c,f,l)}this.inputs=Object.keys(s)}const Hd=Gd.prototype;Hd.init=function(){this.windows.forEach((t=>t.init()));if(this.cell)this.cell.init()};Hd.update=function(t,e){const n=this.cell,i=this.windows,r=t.data,u=i&&i.length;let o;if(n){for(o=t.p0;o<t.i0;++o)n.rem(r[o]);for(o=t.p1;o<t.i1;++o)n.add(r[o]);n.set(e)}for(o=0;o<u;++o)i[o].update(t,e)};function Vd(t,e,n){t=t.map((t=>vl(t,t.field)));const i={num:0,agg:null,store:false,count:e};if(!n){var r=t.length,u=i.agg=Array(r),o=0;for(;o<r;++o)u[o]=new t[o](i)}if(i.store){var s=i.data=new yl}i.add=function(t){i.num+=1;if(n)return;if(s)s.add(t);for(let e=0;e<r;++e){u[e].add(u[e].get(t),t)}};i.rem=function(t){i.num-=1;if(n)return;if(s)s.rem(t);for(let e=0;e<r;++e){u[e].rem(u[e].get(t),t)}};i.set=function(t){let r,o;if(s)s.values();for(r=0,o=e.length;r<o;++r)t[e[r]]=i.num;if(!n)for(r=0,o=u.length;r<o;++r)u[r].set(t)};i.init=function(){i.num=0;if(s)s.reset();for(let t=0;t<r;++t)u[t].init()};return i}function Yd(t){Zf.call(this,{},t);this._mlen=0;this._mods=[]}Yd.Definition={type:"Window",metadata:{modifies:true},params:[{name:"sort",type:"compare"},{name:"groupby",type:"field",array:true},{name:"ops",type:"enum",array:true,values:Wd.concat(fl)},{name:"params",type:"number",null:true,array:true},{name:"fields",type:"field",null:true,array:true},{name:"as",type:"string",null:true,array:true},{name:"frame",type:"number",null:true,array:true,length:2,default:[null,0]},{name:"ignorePeers",type:"boolean",default:false}]};fn(Yd,Zf,{transform(t,e){this.stamp=e.stamp;const n=t.modified(),i=qa(t.sort),r=rl(t.groupby),u=t=>this.group(r(t));let o=this.state;if(!o||n){o=this.state=new Gd(t)}if(n||e.modified(o.inputs)){this.value={};e.visit(e.SOURCE,(t=>u(t).add(t)))}else{e.visit(e.REM,(t=>u(t).remove(t)));e.visit(e.ADD,(t=>u(t).add(t)))}for(let s=0,a=this._mlen;s<a;++s){Xd(this._mods[s],o,i,t)}this._mlen=0;this._mods=[];return e.reflow(n).modifies(o.outputs)},group(t){let e=this.value[t];if(!e){e=this.value[t]=Fl(za);e.stamp=-1}if(e.stamp<this.stamp){e.stamp=this.stamp;this._mods[this._mlen++]=e}return e}});function Xd(t,e,n,i){const r=i.sort,u=r&&!i.ignorePeers,o=i.frame||[null,0],s=t.data(n),a=s.length,f=u?ii(r):null,c={i0:0,i1:0,p0:0,p1:0,index:0,data:s,compare:r||Ze(-1)};e.init();for(let l=0;l<a;++l){Jd(c,o,l,a);if(u)Qd(c,f);e.update(c,s[l])}}function Jd(t,e,n,i){t.p0=t.i0;t.p1=t.i1;t.i0=e[0]==null?0:Math.max(0,n-Math.abs(e[0]));t.i1=e[1]==null?i:Math.min(i,n+Math.abs(e[1])+1);t.index=n}function Qd(t,e){const n=t.i0,i=t.i1-1,r=t.compare,u=t.data,o=u.length-1;if(n>0&&!r(u[n],u[n-1]))t.i0=e.left(u,u[n]);if(i<o&&!r(u[i],u[i+1]))t.i1=e.right(u,u[i])}const Zd=Object.freeze({__proto__:null,aggregate:Al,bin:Ol,collect:Dl,compare:kl,countpattern:$l,cross:Cl,density:Tl,dotbin:Wl,expression:Hl,extent:Yl,facet:Jl,field:Ql,filter:Kl,flatten:td,fold:ed,formula:nd,generate:id,impute:od,joinaggregate:cd,kde:ld,key:dd,load:pd,lookup:bd,multiextent:vd,multivalues:wd,params:xd,pivot:Od,prefacet:Ed,project:$d,proxy:Cd,quantile:Md,relay:Sd,sample:_d,sequence:Nd,sieve:zd,subflow:Xl,timeunit:Td,tupleindex:Ld,values:Id,window:Yd});function Kd(t){return t.innerRadius}function th(t){return t.outerRadius}function eh(t){return t.startAngle}function nh(t){return t.endAngle}function ih(t){return t&&t.padAngle}function rh(t,e,n,i,r,u,o,a){var f=n-t,c=i-e,l=o-r,d=a-u,h=d*f-l*c;if(h*h<s)return;h=(l*(e-u)-d*(t-r))/h;return[t+h*f,e+h*c]}function uh(t,e,n,i,r,u,o){var s=t-n,a=e-i,f=(o?u:-u)/g(s*s+a*a),c=f*a,l=-f*s,d=t+c,h=e+l,p=n+c,m=i+l,v=(d+p)/2,y=(h+m)/2,w=p-d,A=m-h,x=w*w+A*A,O=r-u,F=d*m-p*h,D=(A<0?-1:1)*g(b(0,O*O*x-F*F)),k=(F*A-w*D)/x,E=(-F*w-A*D)/x,$=(F*A+w*D)/x,j=(-F*w+A*D)/x,C=k-v,M=E-y,B=$-v,S=j-y;if(C*C+M*M>B*B+S*S)k=$,E=j;return{cx:k,cy:E,x01:-c,y01:-l,x11:k*(r/O-1),y11:E*(r/O-1)}}function oh(){var t=Kd,e=th,n=m(0),i=null,r=eh,b=nh,w=ih,A=null,x=u(O);function O(){var u,m,O=+t.apply(this,arguments),F=+e.apply(this,arguments),D=r.apply(this,arguments)-o,k=b.apply(this,arguments)-o,E=d(k-D),$=k>D;if(!A)A=u=x();if(F<O)m=F,F=O,O=m;if(!(F>s))A.moveTo(0,0);else if(E>a-s){A.moveTo(F*f(D),F*c(D));A.arc(0,0,F,D,k,!$);if(O>s){A.moveTo(O*f(k),O*c(k));A.arc(0,0,O,k,D,$)}}else{var j=D,C=k,M=D,B=k,S=E,_=E,N=w.apply(this,arguments)/2,z=N>s&&(i?+i.apply(this,arguments):g(O*O+F*F)),T=l(d(F-O)/2,+n.apply(this,arguments)),P=T,L=T,I,R;if(z>s){var q=v(z/O*c(N)),U=v(z/F*c(N));if((S-=q*2)>s)q*=$?1:-1,M+=q,B-=q;else S=0,M=B=(D+k)/2;if((_-=U*2)>s)U*=$?1:-1,j+=U,C-=U;else _=0,j=C=(D+k)/2}var W=F*f(j),G=F*c(j),H=O*f(B),V=O*c(B);if(T>s){var Y=F*f(C),X=F*c(C),J=O*f(M),Q=O*c(M),Z;if(E<p){if(Z=rh(W,G,J,Q,Y,X,H,V)){var K=W-Z[0],tt=G-Z[1],et=Y-Z[0],nt=X-Z[1],it=1/c(y((K*et+tt*nt)/(g(K*K+tt*tt)*g(et*et+nt*nt)))/2),rt=g(Z[0]*Z[0]+Z[1]*Z[1]);P=l(T,(O-rt)/(it-1));L=l(T,(F-rt)/(it+1))}else{P=L=0}}}if(!(_>s))A.moveTo(W,G);else if(L>s){I=uh(J,Q,W,G,F,L,$);R=uh(Y,X,H,V,F,L,$);A.moveTo(I.cx+I.x01,I.cy+I.y01);if(L<T)A.arc(I.cx,I.cy,L,h(I.y01,I.x01),h(R.y01,R.x01),!$);else{A.arc(I.cx,I.cy,L,h(I.y01,I.x01),h(I.y11,I.x11),!$);A.arc(0,0,F,h(I.cy+I.y11,I.cx+I.x11),h(R.cy+R.y11,R.cx+R.x11),!$);A.arc(R.cx,R.cy,L,h(R.y11,R.x11),h(R.y01,R.x01),!$)}}else A.moveTo(W,G),A.arc(0,0,F,j,C,!$);if(!(O>s)||!(S>s))A.lineTo(H,V);else if(P>s){I=uh(H,V,Y,X,O,-P,$);R=uh(W,G,J,Q,O,-P,$);A.lineTo(I.cx+I.x01,I.cy+I.y01);if(P<T)A.arc(I.cx,I.cy,P,h(I.y01,I.x01),h(R.y01,R.x01),!$);else{A.arc(I.cx,I.cy,P,h(I.y01,I.x01),h(I.y11,I.x11),!$);A.arc(0,0,O,h(I.cy+I.y11,I.cx+I.x11),h(R.cy+R.y11,R.cx+R.x11),$);A.arc(R.cx,R.cy,P,h(R.y11,R.x11),h(R.y01,R.x01),!$)}}else A.arc(0,0,O,B,M,$)}A.closePath();if(u)return A=null,u+""||null}O.centroid=function(){var n=(+t.apply(this,arguments)+ +e.apply(this,arguments))/2,i=(+r.apply(this,arguments)+ +b.apply(this,arguments))/2-p/2;return[f(i)*n,c(i)*n]};O.innerRadius=function(e){return arguments.length?(t=typeof e==="function"?e:m(+e),O):t};O.outerRadius=function(t){return arguments.length?(e=typeof t==="function"?t:m(+t),O):e};O.cornerRadius=function(t){return arguments.length?(n=typeof t==="function"?t:m(+t),O):n};O.padRadius=function(t){return arguments.length?(i=t==null?null:typeof t==="function"?t:m(+t),O):i};O.startAngle=function(t){return arguments.length?(r=typeof t==="function"?t:m(+t),O):r};O.endAngle=function(t){return arguments.length?(b=typeof t==="function"?t:m(+t),O):b};O.padAngle=function(t){return arguments.length?(w=typeof t==="function"?t:m(+t),O):w};O.context=function(t){return arguments.length?(A=t==null?null:t,O):A};return O}function sh(t,e,n){var i=null,r=m(true),o=null,s=x,a=null,f=u(c);t=typeof t==="function"?t:t===undefined?O:m(+t);e=typeof e==="function"?e:e===undefined?m(0):m(+e);n=typeof n==="function"?n:n===undefined?F:m(+n);function c(u){var c,l,d,h=(u=w(u)).length,p,m=false,g,b=new Array(h),v=new Array(h);if(o==null)a=s(g=f());for(c=0;c<=h;++c){if(!(c<h&&r(p=u[c],c,u))===m){if(m=!m){l=c;a.areaStart();a.lineStart()}else{a.lineEnd();a.lineStart();for(d=c-1;d>=l;--d){a.point(b[d],v[d])}a.lineEnd();a.areaEnd()}}if(m){b[c]=+t(p,c,u),v[c]=+e(p,c,u);a.point(i?+i(p,c,u):b[c],n?+n(p,c,u):v[c])}}if(g)return a=null,g+""||null}function l(){return A().defined(r).curve(s).context(o)}c.x=function(e){return arguments.length?(t=typeof e==="function"?e:m(+e),i=null,c):t};c.x0=function(e){return arguments.length?(t=typeof e==="function"?e:m(+e),c):t};c.x1=function(t){return arguments.length?(i=t==null?null:typeof t==="function"?t:m(+t),c):i};c.y=function(t){return arguments.length?(e=typeof t==="function"?t:m(+t),n=null,c):e};c.y0=function(t){return arguments.length?(e=typeof t==="function"?t:m(+t),c):e};c.y1=function(t){return arguments.length?(n=t==null?null:typeof t==="function"?t:m(+t),c):n};c.lineX0=c.lineY0=function(){return l().x(t).y(e)};c.lineY1=function(){return l().x(t).y(n)};c.lineX1=function(){return l().x(i).y(e)};c.defined=function(t){return arguments.length?(r=typeof t==="function"?t:m(!!t),c):r};c.curve=function(t){return arguments.length?(s=t,o!=null&&(a=s(o)),c):s};c.context=function(t){return arguments.length?(t==null?o=a=null:a=s(o=t),c):o};return c}function ah(t){this._context=t}ah.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(t,e){t=+t,e=+e;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var n=(this._x0+4*this._x1+t)/6,i=(this._y0+4*this._y1+e)/6;this._line?this._context.lineTo(n,i):this._context.moveTo(n,i);break;case 3:this._point=4;default:D(this,t,e);break}this._x0=this._x1,this._x1=t;this._y0=this._y1,this._y1=e}};function fh(t){return new ah(t)}function ch(t,e){this._basis=new k(t);this._beta=e}ch.prototype={lineStart:function(){this._x=[];this._y=[];this._basis.lineStart()},lineEnd:function(){var t=this._x,e=this._y,n=t.length-1;if(n>0){var i=t[0],r=e[0],u=t[n]-i,o=e[n]-r,s=-1,a;while(++s<=n){a=s/n;this._basis.point(this._beta*t[s]+(1-this._beta)*(i+a*u),this._beta*e[s]+(1-this._beta)*(r+a*o))}}this._x=this._y=null;this._basis.lineEnd()},point:function(t,e){this._x.push(+t);this._y.push(+e)}};const lh=function t(e){function n(t){return e===1?new k(t):new ch(t,e)}n.beta=function(e){return t(+e)};return n}(.85);function dh(t,e,n){t._context.bezierCurveTo(t._x1+t._k*(t._x2-t._x0),t._y1+t._k*(t._y2-t._y0),t._x2+t._k*(t._x1-e),t._y2+t._k*(t._y1-n),t._x2,t._y2)}function hh(t,e){this._context=t;this._k=(1-e)/6}hh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:dh(this,this._x1,this._y1);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(t,e){t=+t,e=+e;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;this._x1=t,this._y1=e;break;case 2:this._point=3;default:dh(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t;this._y0=this._y1,this._y1=this._y2,this._y2=e}};const ph=function t(e){function n(t){return new hh(t,e)}n.tension=function(e){return t(+e)};return n}(0);function mh(t,e){this._context=t;this._k=(1-e)/6}mh.prototype={areaStart:E,areaEnd:E,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(t,e){t=+t,e=+e;switch(this._point){case 0:this._point=1;this._x3=t,this._y3=e;break;case 1:this._point=2;this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3;this._x5=t,this._y5=e;break;default:dh(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t;this._y0=this._y1,this._y1=this._y2,this._y2=e}};const gh=function t(e){function n(t){return new mh(t,e)}n.tension=function(e){return t(+e)};return n}(0);function bh(t,e){this._context=t;this._k=(1-e)/6}bh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(t,e){t=+t,e=+e;switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:dh(this,t,e);break}this._x0=this._x1,this._x1=this._x2,this._x2=t;this._y0=this._y1,this._y1=this._y2,this._y2=e}};const vh=function t(e){function n(t){return new bh(t,e)}n.tension=function(e){return t(+e)};return n}(0);function yh(t,e,n){var i=t._x1,r=t._y1,u=t._x2,o=t._y2;if(t._l01_a>s){var a=2*t._l01_2a+3*t._l01_a*t._l12_a+t._l12_2a,f=3*t._l01_a*(t._l01_a+t._l12_a);i=(i*a-t._x0*t._l12_2a+t._x2*t._l01_2a)/f;r=(r*a-t._y0*t._l12_2a+t._y2*t._l01_2a)/f}if(t._l23_a>s){var c=2*t._l23_2a+3*t._l23_a*t._l12_a+t._l12_2a,l=3*t._l23_a*(t._l23_a+t._l12_a);u=(u*c+t._x1*t._l23_2a-e*t._l12_2a)/l;o=(o*c+t._y1*t._l23_2a-n*t._l12_2a)/l}t._context.bezierCurveTo(i,r,u,o,t._x2,t._y2)}function wh(t,e){this._context=t;this._alpha=e}wh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(t,e){t=+t,e=+e;if(this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;default:yh(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=t;this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Ah=function t(e){function n(t){return e?new wh(t,e):new hh(t,0)}n.alpha=function(e){return t(+e)};return n}(.5);function xh(t,e){this._context=t;this._alpha=e}xh.prototype={areaStart:E,areaEnd:E,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3);this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3);this._context.closePath();break}case 3:{this.point(this._x3,this._y3);this.point(this._x4,this._y4);this.point(this._x5,this._y5);break}}},point:function(t,e){t=+t,e=+e;if(this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;this._x3=t,this._y3=e;break;case 1:this._point=2;this._context.moveTo(this._x4=t,this._y4=e);break;case 2:this._point=3;this._x5=t,this._y5=e;break;default:yh(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=t;this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Oh=function t(e){function n(t){return e?new xh(t,e):new mh(t,0)}n.alpha=function(e){return t(+e)};return n}(.5);function Fh(t,e){this._context=t;this._alpha=e}Fh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN;this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){if(this._line||this._line!==0&&this._point===3)this._context.closePath();this._line=1-this._line},point:function(t,e){t=+t,e=+e;if(this._point){var n=this._x2-t,i=this._y2-e;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(n*n+i*i,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:yh(this,t,e);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a;this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a;this._x0=this._x1,this._x1=this._x2,this._x2=t;this._y0=this._y1,this._y1=this._y2,this._y2=e}};const Dh=function t(e){function n(t){return e?new Fh(t,e):new bh(t,0)}n.alpha=function(e){return t(+e)};return n}(.5);function kh(t){this._context=t}kh.prototype={areaStart:E,areaEnd:E,lineStart:function(){this._point=0},lineEnd:function(){if(this._point)this._context.closePath()},point:function(t,e){t=+t,e=+e;if(this._point)this._context.lineTo(t,e);else this._point=1,this._context.moveTo(t,e)}};function Eh(t){return new kh(t)}function $h(t){return t<0?-1:1}function jh(t,e,n){var i=t._x1-t._x0,r=e-t._x1,u=(t._y1-t._y0)/(i||r<0&&-0),o=(n-t._y1)/(r||i<0&&-0),s=(u*r+o*i)/(i+r);return($h(u)+$h(o))*Math.min(Math.abs(u),Math.abs(o),.5*Math.abs(s))||0}function Ch(t,e){var n=t._x1-t._x0;return n?(3*(t._y1-t._y0)/n-e)/2:e}function Mh(t,e,n){var i=t._x0,r=t._y0,u=t._x1,o=t._y1,s=(u-i)/3;t._context.bezierCurveTo(i+s,r+s*e,u-s,o-s*n,u,o)}function Bh(t){this._context=t}Bh.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN;this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Mh(this,this._t0,Ch(this,this._t0));break}if(this._line||this._line!==0&&this._point===1)this._context.closePath();this._line=1-this._line},point:function(t,e){var n=NaN;t=+t,e=+e;if(t===this._x1&&e===this._y1)return;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;break;case 2:this._point=3;Mh(this,Ch(this,n=jh(this,t,e)),n);break;default:Mh(this,this._t0,n=jh(this,t,e));break}this._x0=this._x1,this._x1=t;this._y0=this._y1,this._y1=e;this._t0=n}};function Sh(t){this._context=new _h(t)}(Sh.prototype=Object.create(Bh.prototype)).point=function(t,e){Bh.prototype.point.call(this,e,t)};function _h(t){this._context=t}_h.prototype={moveTo:function(t,e){this._context.moveTo(e,t)},closePath:function(){this._context.closePath()},lineTo:function(t,e){this._context.lineTo(e,t)},bezierCurveTo:function(t,e,n,i,r,u){this._context.bezierCurveTo(e,t,i,n,u,r)}};function Nh(t){return new Bh(t)}function zh(t){return new Sh(t)}function Th(t){this._context=t}Th.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[];this._y=[]},lineEnd:function(){var t=this._x,e=this._y,n=t.length;if(n){this._line?this._context.lineTo(t[0],e[0]):this._context.moveTo(t[0],e[0]);if(n===2){this._context.lineTo(t[1],e[1])}else{var i=Ph(t),r=Ph(e);for(var u=0,o=1;o<n;++u,++o){this._context.bezierCurveTo(i[0][u],r[0][u],i[1][u],r[1][u],t[o],e[o])}}}if(this._line||this._line!==0&&n===1)this._context.closePath();this._line=1-this._line;this._x=this._y=null},point:function(t,e){this._x.push(+t);this._y.push(+e)}};function Ph(t){var e,n=t.length-1,i,r=new Array(n),u=new Array(n),o=new Array(n);r[0]=0,u[0]=2,o[0]=t[0]+2*t[1];for(e=1;e<n-1;++e)r[e]=1,u[e]=4,o[e]=4*t[e]+2*t[e+1];r[n-1]=2,u[n-1]=7,o[n-1]=8*t[n-1]+t[n];for(e=1;e<n;++e)i=r[e]/u[e-1],u[e]-=i,o[e]-=i*o[e-1];r[n-1]=o[n-1]/u[n-1];for(e=n-2;e>=0;--e)r[e]=(o[e]-r[e+1])/u[e];u[n-1]=(t[n]+r[n-1])/2;for(e=0;e<n-1;++e)u[e]=2*t[e+1]-r[e+1];return[r,u]}function Lh(t){return new Th(t)}function Ih(t,e){this._context=t;this._t=e}Ih.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN;this._point=0},lineEnd:function(){if(0<this._t&&this._t<1&&this._point===2)this._context.lineTo(this._x,this._y);if(this._line||this._line!==0&&this._point===1)this._context.closePath();if(this._line>=0)this._t=1-this._t,this._line=1-this._line},point:function(t,e){t=+t,e=+e;switch(this._point){case 0:this._point=1;this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:{if(this._t<=0){this._context.lineTo(this._x,e);this._context.lineTo(t,e)}else{var n=this._x*(1-this._t)+t*this._t;this._context.lineTo(n,this._y);this._context.lineTo(n,e)}break}}this._x=t,this._y=e}};function Rh(t){return new Ih(t,.5)}function qh(t){return new Ih(t,0)}function Uh(t){return new Ih(t,1)}function Wh(t,e){if(typeof document!=="undefined"&&document.createElement){const n=document.createElement("canvas");if(n&&n.getContext){n.width=t;n.height=e;return n}}return null}const Gh=()=>typeof Image!=="undefined"?Image:null;function Hh(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Vh(t,e){switch(arguments.length){case 0:break;case 1:{if(typeof t==="function")this.interpolator(t);else this.range(t);break}default:{this.domain(t);if(typeof e==="function")this.interpolator(e);else this.range(e);break}}return this}const Yh=Symbol("implicit");function Xh(){var t=new hi,e=[],n=[],i=Yh;function r(r){let u=t.get(r);if(u===undefined){if(i!==Yh)return i;t.set(r,u=e.push(r)-1)}return n[u%n.length]}r.domain=function(n){if(!arguments.length)return e.slice();e=[],t=new hi;for(const i of n){if(t.has(i))continue;t.set(i,e.push(i)-1)}return r};r.range=function(t){return arguments.length?(n=Array.from(t),r):n.slice()};r.unknown=function(t){return arguments.length?(i=t,r):i};r.copy=function(){return Xh(e,n).unknown(i)};Hh.apply(r,arguments);return r}const Jh=Math.PI/180;const Qh=180/Math.PI;const Zh=18,Kh=.96422,tp=1,ep=.82521,np=4/29,ip=6/29,rp=3*ip*ip,up=ip*ip*ip;function op(t){if(t instanceof ap)return new ap(t.l,t.a,t.b,t.opacity);if(t instanceof mp)return gp(t);if(!(t instanceof $))t=j(t);var e=dp(t.r),n=dp(t.g),i=dp(t.b),r=fp((.2225045*e+.7168786*n+.0606169*i)/tp),u,o;if(e===n&&n===i)u=o=r;else{u=fp((.4360747*e+.3850649*n+.1430804*i)/Kh);o=fp((.0139322*e+.0971045*n+.7141733*i)/ep)}return new ap(116*r-16,500*(u-r),200*(r-o),t.opacity)}function sp(t,e,n,i){return arguments.length===1?op(t):new ap(t,e,n,i==null?1:i)}function ap(t,e,n,i){this.l=+t;this.a=+e;this.b=+n;this.opacity=+i}C(ap,sp,M(B,{brighter(t){return new ap(this.l+Zh*(t==null?1:t),this.a,this.b,this.opacity)},darker(t){return new ap(this.l-Zh*(t==null?1:t),this.a,this.b,this.opacity)},rgb(){var t=(this.l+16)/116,e=isNaN(this.a)?t:t+this.a/500,n=isNaN(this.b)?t:t-this.b/200;e=Kh*cp(e);t=tp*cp(t);n=ep*cp(n);return new $(lp(3.1338561*e-1.6168667*t-.4906146*n),lp(-.9787684*e+1.9161415*t+.033454*n),lp(.0719453*e-.2289914*t+1.4052427*n),this.opacity)}}));function fp(t){return t>up?Math.pow(t,1/3):t/rp+np}function cp(t){return t>ip?t*t*t:rp*(t-np)}function lp(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function dp(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function hp(t){if(t instanceof mp)return new mp(t.h,t.c,t.l,t.opacity);if(!(t instanceof ap))t=op(t);if(t.a===0&&t.b===0)return new mp(NaN,0<t.l&&t.l<100?0:NaN,t.l,t.opacity);var e=Math.atan2(t.b,t.a)*Qh;return new mp(e<0?e+360:e,Math.sqrt(t.a*t.a+t.b*t.b),t.l,t.opacity)}function pp(t,e,n,i){return arguments.length===1?hp(t):new mp(t,e,n,i==null?1:i)}function mp(t,e,n,i){this.h=+t;this.c=+e;this.l=+n;this.opacity=+i}function gp(t){if(isNaN(t.h))return new ap(t.l,0,0,t.opacity);var e=t.h*Jh;return new ap(t.l,Math.cos(e)*t.c,Math.sin(e)*t.c,t.opacity)}C(mp,pp,M(B,{brighter(t){return new mp(this.h,this.c,this.l+Zh*(t==null?1:t),this.opacity)},darker(t){return new mp(this.h,this.c,this.l-Zh*(t==null?1:t),this.opacity)},rgb(){return gp(this).rgb()}}));var bp=-.14861,vp=+1.78277,yp=-.29227,wp=-.90649,Ap=+1.97294,xp=Ap*wp,Op=Ap*vp,Fp=vp*yp-wp*bp;function Dp(t){if(t instanceof Ep)return new Ep(t.h,t.s,t.l,t.opacity);if(!(t instanceof $))t=j(t);var e=t.r/255,n=t.g/255,i=t.b/255,r=(Fp*i+xp*e-Op*n)/(Fp+xp-Op),u=i-r,o=(Ap*(n-r)-yp*u)/wp,s=Math.sqrt(o*o+u*u)/(Ap*r*(1-r)),a=s?Math.atan2(o,u)*Qh-120:NaN;return new Ep(a<0?a+360:a,s,r,t.opacity)}function kp(t,e,n,i){return arguments.length===1?Dp(t):new Ep(t,e,n,i==null?1:i)}function Ep(t,e,n,i){this.h=+t;this.s=+e;this.l=+n;this.opacity=+i}C(Ep,kp,M(B,{brighter(t){t=t==null?S:Math.pow(S,t);return new Ep(this.h,this.s,this.l*t,this.opacity)},darker(t){t=t==null?_:Math.pow(_,t);return new Ep(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*Jh,e=+this.l,n=isNaN(this.s)?0:this.s*e*(1-e),i=Math.cos(t),r=Math.sin(t);return new $(255*(e+n*(bp*i+vp*r)),255*(e+n*(yp*i+wp*r)),255*(e+n*(Ap*i)),this.opacity)}}));function $p(t,e){if(!e)e=[];var n=t?Math.min(e.length,t.length):0,i=e.slice(),r;return function(u){for(r=0;r<n;++r)i[r]=t[r]*(1-u)+e[r]*u;return i}}function jp(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Cp(t,e){return(jp(e)?$p:Mp)(t,e)}function Mp(t,e){var n=e?e.length:0,i=t?Math.min(n,t.length):0,r=new Array(i),u=new Array(n),o;for(o=0;o<i;++o)r[o]=_p(t[o],e[o]);for(;o<n;++o)u[o]=e[o];return function(t){for(o=0;o<i;++o)u[o]=r[o](t);return u}}function Bp(t,e){var n=new Date;return t=+t,e=+e,function(i){return n.setTime(t*(1-i)+e*i),n}}function Sp(t,e){var n={},i={},r;if(t===null||typeof t!=="object")t={};if(e===null||typeof e!=="object")e={};for(r in e){if(r in t){n[r]=_p(t[r],e[r])}else{i[r]=e[r]}}return function(t){for(r in n)i[r]=n[r](t);return i}}function _p(t,e){var n=typeof e,i;return e==null||n==="boolean"?N(e):(n==="number"?z:n==="string"?(i=T(e))?(e=i,P):L:e instanceof T?P:e instanceof Date?Bp:jp(e)?$p:Array.isArray(e)?Mp:typeof e.valueOf!=="function"&&typeof e.toString!=="function"||isNaN(e)?Sp:z)(t,e)}function Np(t){var e=t.length;return function(n){return t[Math.max(0,Math.min(e-1,Math.floor(n*e)))]}}function zp(t,e){var n=I(+t,+e);return function(t){var e=n(t);return e-360*Math.floor(e/360)}}function Tp(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function Pp(t){return function(e,n){var i=t((e=R(e)).h,(n=R(n)).h),r=q(e.s,n.s),u=q(e.l,n.l),o=q(e.opacity,n.opacity);return function(t){e.h=i(t);e.s=r(t);e.l=u(t);e.opacity=o(t);return e+""}}}const Lp=Pp(I);var Ip=Pp(q);function Rp(t,e){var n=q((t=sp(t)).l,(e=sp(e)).l),i=q(t.a,e.a),r=q(t.b,e.b),u=q(t.opacity,e.opacity);return function(e){t.l=n(e);t.a=i(e);t.b=r(e);t.opacity=u(e);return t+""}}function qp(t){return function(e,n){var i=t((e=pp(e)).h,(n=pp(n)).h),r=q(e.c,n.c),u=q(e.l,n.l),o=q(e.opacity,n.opacity);return function(t){e.h=i(t);e.c=r(t);e.l=u(t);e.opacity=o(t);return e+""}}}const Up=qp(I);var Wp=qp(q);function Gp(t){return function e(n){n=+n;function i(e,i){var r=t((e=kp(e)).h,(i=kp(i)).h),u=q(e.s,i.s),o=q(e.l,i.l),s=q(e.opacity,i.opacity);return function(t){e.h=r(t);e.s=u(t);e.l=o(Math.pow(t,n));e.opacity=s(t);return e+""}}i.gamma=e;return i}(1)}const Hp=Gp(I);var Vp=Gp(q);function Yp(t,e){if(e===undefined)e=t,t=_p;var n=0,i=e.length-1,r=e[0],u=new Array(i<0?0:i);while(n<i)u[n]=t(r,r=e[++n]);return function(t){var e=Math.max(0,Math.min(i-1,Math.floor(t*=i)));return u[e](t-e)}}function Xp(t,e){var n=new Array(e);for(var i=0;i<e;++i)n[i]=t(i/(e-1));return n}const Jp=Object.freeze({__proto__:null,interpolate:_p,interpolateArray:Cp,interpolateBasis:U,interpolateBasisClosed:W,interpolateDate:Bp,interpolateDiscrete:Np,interpolateHue:zp,interpolateNumber:z,interpolateNumberArray:$p,interpolateObject:Sp,interpolateRound:Tp,interpolateString:L,interpolateTransformCss:G,interpolateTransformSvg:H,interpolateZoom:V,interpolateRgb:P,interpolateRgbBasis:Y,interpolateRgbBasisClosed:X,interpolateHsl:Lp,interpolateHslLong:Ip,interpolateLab:Rp,interpolateHcl:Up,interpolateHclLong:Wp,interpolateCubehelix:Hp,interpolateCubehelixLong:Vp,piecewise:Yp,quantize:Xp});function Qp(t){return function(){return t}}function Zp(t){return+t}var Kp=[0,1];function tm(t){return t}function em(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:Qp(isNaN(e)?NaN:.5)}function nm(t,e){var n;if(t>e)n=t,t=e,e=n;return function(n){return Math.max(t,Math.min(e,n))}}function im(t,e,n){var i=t[0],r=t[1],u=e[0],o=e[1];if(r<i)i=em(r,i),u=n(o,u);else i=em(i,r),u=n(u,o);return function(t){return u(i(t))}}function rm(t,e,n){var i=Math.min(t.length,e.length)-1,r=new Array(i),u=new Array(i),o=-1;if(t[i]<t[0]){t=t.slice().reverse();e=e.slice().reverse()}while(++o<i){r[o]=em(t[o],t[o+1]);u[o]=n(e[o],e[o+1])}return function(e){var n=ai(t,e,1,i)-1;return u[n](r[n](e))}}function um(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function om(){var t=Kp,e=Kp,n=_p,i,r,u,o=tm,s,a,f;function c(){var n=Math.min(t.length,e.length);if(o!==tm)o=nm(t[0],t[n-1]);s=n>2?rm:im;a=f=null;return l}function l(r){return r==null||isNaN(r=+r)?u:(a||(a=s(t.map(i),e,n)))(i(o(r)))}l.invert=function(n){return o(r((f||(f=s(e,t.map(i),z)))(n)))};l.domain=function(e){return arguments.length?(t=Array.from(e,Zp),c()):t.slice()};l.range=function(t){return arguments.length?(e=Array.from(t),c()):e.slice()};l.rangeRound=function(t){return e=Array.from(t),n=Tp,c()};l.clamp=function(t){return arguments.length?(o=t?true:tm,c()):o!==tm};l.interpolate=function(t){return arguments.length?(n=t,c()):n};l.unknown=function(t){return arguments.length?(u=t,l):u};return function(t,e){i=t,r=e;return c()}}function sm(){return om()(tm,tm)}function am(t,e,n,i){var r=$i(t,e,n),u;i=Vi(i==null?",f":i);switch(i.type){case"s":{var o=Math.max(Math.abs(t),Math.abs(e));if(i.precision==null&&!isNaN(u=fr(r,o)))i.precision=u;return or(i,o)}case"":case"e":case"g":case"p":case"r":{if(i.precision==null&&!isNaN(u=cr(r,Math.max(Math.abs(t),Math.abs(e)))))i.precision=u-(i.type==="e");break}case"f":case"%":{if(i.precision==null&&!isNaN(u=ar(r)))i.precision=u-(i.type==="%")*2;break}}return ur(i)}function fm(t){var e=t.domain;t.ticks=function(t){var n=e();return ki(n[0],n[n.length-1],t==null?10:t)};t.tickFormat=function(t,n){var i=e();return am(i[0],i[i.length-1],t==null?10:t,n)};t.nice=function(n){if(n==null)n=10;var i=e();var r=0;var u=i.length-1;var o=i[r];var s=i[u];var a;var f;var c=10;if(s<o){f=o,o=s,s=f;f=r,r=u,u=f}while(c-- >0){f=Ei(o,s,n);if(f===a){i[r]=o;i[u]=s;return e(i)}else if(f>0){o=Math.floor(o/f)*f;s=Math.ceil(s/f)*f}else if(f<0){o=Math.ceil(o*f)/f;s=Math.floor(s*f)/f}else{break}a=f}return t};return t}function cm(){var t=sm();t.copy=function(){return um(t,cm())};Hh.apply(t,arguments);return fm(t)}function lm(t){var e;function n(t){return t==null||isNaN(t=+t)?e:t}n.invert=n;n.domain=n.range=function(e){return arguments.length?(t=Array.from(e,Zp),n):t.slice()};n.unknown=function(t){return arguments.length?(e=t,n):e};n.copy=function(){return lm(t).unknown(e)};t=arguments.length?Array.from(t,Zp):[0,1];return fm(n)}function dm(t,e){t=t.slice();var n=0,i=t.length-1,r=t[n],u=t[i],o;if(u<r){o=n,n=i,i=o;o=r,r=u,u=o}t[n]=e.floor(r);t[i]=e.ceil(u);return t}function hm(t){return Math.log(t)}function pm(t){return Math.exp(t)}function mm(t){return-Math.log(-t)}function gm(t){return-Math.exp(-t)}function bm(t){return isFinite(t)?+("1e"+t):t<0?0:t}function vm(t){return t===10?bm:t===Math.E?Math.exp:e=>Math.pow(t,e)}function ym(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function wm(t){return(e,n)=>-t(-e,n)}function Am(t){const e=t(hm,pm);const n=e.domain;let i=10;let r;let u;function o(){r=ym(i),u=vm(i);if(n()[0]<0){r=wm(r),u=wm(u);t(mm,gm)}else{t(hm,pm)}return e}e.base=function(t){return arguments.length?(i=+t,o()):i};e.domain=function(t){return arguments.length?(n(t),o()):n()};e.ticks=t=>{const e=n();let o=e[0];let s=e[e.length-1];const a=s<o;if(a)[o,s]=[s,o];let f=r(o);let c=r(s);let l;let d;const h=t==null?10:+t;let p=[];if(!(i%1)&&c-f<h){f=Math.floor(f),c=Math.ceil(c);if(o>0)for(;f<=c;++f){for(l=1;l<i;++l){d=f<0?l/u(-f):l*u(f);if(d<o)continue;if(d>s)break;p.push(d)}}else for(;f<=c;++f){for(l=i-1;l>=1;--l){d=f>0?l/u(-f):l*u(f);if(d<o)continue;if(d>s)break;p.push(d)}}if(p.length*2<h)p=ki(o,s,h)}else{p=ki(f,c,Math.min(c-f,h)).map(u)}return a?p.reverse():p};e.tickFormat=(t,n)=>{if(t==null)t=10;if(n==null)n=i===10?"s":",";if(typeof n!=="function"){if(!(i%1)&&(n=Vi(n)).precision==null)n.trim=true;n=ur(n)}if(t===Infinity)return n;const o=Math.max(1,i*t/e.ticks().length);return t=>{let e=t/u(Math.round(r(t)));if(e*i<i-.5)e*=i;return e<=o?n(t):""}};e.nice=()=>n(dm(n(),{floor:t=>u(Math.floor(r(t))),ceil:t=>u(Math.ceil(r(t)))}));return e}function xm(){const t=Am(om()).domain([1,10]);t.copy=()=>um(t,xm()).base(t.base());Hh.apply(t,arguments);return t}function Om(t){return function(e){return Math.sign(e)*Math.log1p(Math.abs(e/t))}}function Fm(t){return function(e){return Math.sign(e)*Math.expm1(Math.abs(e))*t}}function Dm(t){var e=1,n=t(Om(e),Fm(e));n.constant=function(n){return arguments.length?t(Om(e=+n),Fm(e)):e};return fm(n)}function km(){var t=Dm(om());t.copy=function(){return um(t,km()).constant(t.constant())};return Hh.apply(t,arguments)}function Em(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function $m(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function jm(t){return t<0?-t*t:t*t}function Cm(t){var e=t(tm,tm),n=1;function i(){return n===1?t(tm,tm):n===.5?t($m,jm):t(Em(n),Em(1/n))}e.exponent=function(t){return arguments.length?(n=+t,i()):n};return fm(e)}function Mm(){var t=Cm(om());t.copy=function(){return um(t,Mm()).exponent(t.exponent())};Hh.apply(t,arguments);return t}function Bm(){return Mm.apply(null,arguments).exponent(.5)}function Sm(){var t=[],e=[],n=[],i;function r(){var i=0,r=Math.max(1,e.length);n=new Array(r-1);while(++i<r)n[i-1]=_i(t,i/r);return u}function u(t){return t==null||isNaN(t=+t)?i:e[ai(n,t)]}u.invertExtent=function(i){var r=e.indexOf(i);return r<0?[NaN,NaN]:[r>0?n[r-1]:t[0],r<n.length?n[r]:t[t.length-1]]};u.domain=function(e){if(!arguments.length)return t.slice();t=[];for(let n of e)if(n!=null&&!isNaN(n=+n))t.push(n);t.sort(ei);return r()};u.range=function(t){return arguments.length?(e=Array.from(t),r()):e.slice()};u.unknown=function(t){return arguments.length?(i=t,u):i};u.quantiles=function(){return n.slice()};u.copy=function(){return Sm().domain(t).range(e).unknown(i)};return Hh.apply(u,arguments)}function _m(){var t=0,e=1,n=1,i=[.5],r=[0,1],u;function o(t){return t!=null&&t<=t?r[ai(i,t,0,n)]:u}function s(){var r=-1;i=new Array(n);while(++r<n)i[r]=((r+1)*e-(r-n)*t)/(n+1);return o}o.domain=function(n){return arguments.length?([t,e]=n,t=+t,e=+e,s()):[t,e]};o.range=function(t){return arguments.length?(n=(r=Array.from(t)).length-1,s()):r.slice()};o.invertExtent=function(u){var o=r.indexOf(u);return o<0?[NaN,NaN]:o<1?[t,i[0]]:o>=n?[i[n-1],e]:[i[o-1],i[o]]};o.unknown=function(t){return arguments.length?(u=t,o):o};o.thresholds=function(){return i.slice()};o.copy=function(){return _m().domain([t,e]).range(r).unknown(u)};return Hh.apply(fm(o),arguments)}function Nm(){var t=[.5],e=[0,1],n,i=1;function r(r){return r!=null&&r<=r?e[ai(t,r,0,i)]:n}r.domain=function(n){return arguments.length?(t=Array.from(n),i=Math.min(t.length,e.length-1),r):t.slice()};r.range=function(n){return arguments.length?(e=Array.from(n),i=Math.min(t.length,e.length-1),r):e.slice()};r.invertExtent=function(n){var i=e.indexOf(n);return[t[i-1],t[i]]};r.unknown=function(t){return arguments.length?(n=t,r):n};r.copy=function(){return Nm().domain(t).range(e).unknown(n)};return Hh.apply(r,arguments)}function zm(t){return new Date(t)}function Tm(t){return t instanceof Date?+t:+new Date(+t)}function Pm(t,e,n,i,r,u,o,s,a,f){var c=sm(),l=c.invert,d=c.domain;var h=f(".%L"),p=f(":%S"),m=f("%I:%M"),g=f("%I %p"),b=f("%a %d"),v=f("%b %d"),y=f("%B"),w=f("%Y");function A(t){return(a(t)<t?h:s(t)<t?p:o(t)<t?m:u(t)<t?g:i(t)<t?r(t)<t?b:v:n(t)<t?y:w)(t)}c.invert=function(t){return new Date(l(t))};c.domain=function(t){return arguments.length?d(Array.from(t,Tm)):d().map(zm)};c.ticks=function(e){var n=d();return t(n[0],n[n.length-1],e==null?10:e)};c.tickFormat=function(t,e){return e==null?A:f(e)};c.nice=function(t){var n=d();if(!t||typeof t.range!=="function")t=e(n[0],n[n.length-1],t==null?10:t);return t?d(dm(n,t)):c};c.copy=function(){return um(c,Pm(t,e,n,i,r,u,o,s,a,f))};return c}function Lm(){return Hh.apply(Pm(Gr,Hr,Ir,Pr,Mr,Er,Dr,Or,xr,$s).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Im(){return Hh.apply(Pm(Ur,Wr,Rr,Lr,Nr,$r,kr,Fr,xr,Cs).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Rm(){var t=0,e=1,n,i,r,u,o=tm,s=false,a;function f(t){return t==null||isNaN(t=+t)?a:o(r===0?.5:(t=(u(t)-n)*r,s?Math.max(0,Math.min(1,t)):t))}f.domain=function(o){return arguments.length?([t,e]=o,n=u(t=+t),i=u(e=+e),r=n===i?0:1/(i-n),f):[t,e]};f.clamp=function(t){return arguments.length?(s=!!t,f):s};f.interpolator=function(t){return arguments.length?(o=t,f):o};function c(t){return function(e){var n,i;return arguments.length?([n,i]=e,o=t(n,i),f):[o(0),o(1)]}}f.range=c(_p);f.rangeRound=c(Tp);f.unknown=function(t){return arguments.length?(a=t,f):a};return function(o){u=o,n=o(t),i=o(e),r=n===i?0:1/(i-n);return f}}function qm(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Um(){var t=fm(Rm()(tm));t.copy=function(){return qm(t,Um())};return Vh.apply(t,arguments)}function Wm(){var t=Am(Rm()).domain([1,10]);t.copy=function(){return qm(t,Wm()).base(t.base())};return Vh.apply(t,arguments)}function Gm(){var t=Dm(Rm());t.copy=function(){return qm(t,Gm()).constant(t.constant())};return Vh.apply(t,arguments)}function Hm(){var t=Cm(Rm());t.copy=function(){return qm(t,Hm()).exponent(t.exponent())};return Vh.apply(t,arguments)}function Vm(){return Hm.apply(null,arguments).exponent(.5)}function Ym(){var t=0,e=.5,n=1,i=1,r,u,o,s,a,f=tm,c,l=false,d;function h(t){return isNaN(t=+t)?d:(t=.5+((t=+c(t))-u)*(i*t<i*u?s:a),f(l?Math.max(0,Math.min(1,t)):t))}h.domain=function(f){return arguments.length?([t,e,n]=f,r=c(t=+t),u=c(e=+e),o=c(n=+n),s=r===u?0:.5/(u-r),a=u===o?0:.5/(o-u),i=u<r?-1:1,h):[t,e,n]};h.clamp=function(t){return arguments.length?(l=!!t,h):l};h.interpolator=function(t){return arguments.length?(f=t,h):f};function p(t){return function(e){var n,i,r;return arguments.length?([n,i,r]=e,f=Yp(t,[n,i,r]),h):[f(0),f(.5),f(1)]}}h.range=p(_p);h.rangeRound=p(Tp);h.unknown=function(t){return arguments.length?(d=t,h):d};return function(f){c=f,r=f(t),u=f(e),o=f(n),s=r===u?0:.5/(u-r),a=u===o?0:.5/(o-u),i=u<r?-1:1;return h}}function Xm(){var t=fm(Ym()(tm));t.copy=function(){return qm(t,Xm())};return Vh.apply(t,arguments)}function Jm(){var t=Am(Ym()).domain([.1,1,10]);t.copy=function(){return qm(t,Jm()).base(t.base())};return Vh.apply(t,arguments)}function Qm(){var t=Dm(Ym());t.copy=function(){return qm(t,Qm()).constant(t.constant())};return Vh.apply(t,arguments)}function Zm(){var t=Cm(Ym());t.copy=function(){return qm(t,Zm()).exponent(t.exponent())};return Vh.apply(t,arguments)}function Km(){return Zm.apply(null,arguments).exponent(.5)}function tg(t,e,n){const i=t-e+n*2;return t?i>0?i:1:0}const eg="identity";const ng="linear";const ig="log";const rg="pow";const ug="sqrt";const og="symlog";const sg="time";const ag="utc";const fg="sequential";const cg="diverging";const lg="quantile";const dg="quantize";const hg="threshold";const pg="ordinal";const mg="point";const gg="band";const bg="bin-ordinal";const vg="continuous";const yg="discrete";const wg="discretizing";const Ag="interpolating";const xg="temporal";function Og(t){return function(e){let n=e[0],i=e[1],r;if(i<n){r=n;n=i;i=r}return[t.invert(n),t.invert(i)]}}function Fg(t){return function(e){const n=t.range();let i=e[0],r=e[1],u=-1,o,s,a,f;if(r<i){s=i;i=r;r=s}for(a=0,f=n.length;a<f;++a){if(n[a]>=i&&n[a]<=r){if(u<0)u=a;o=a}}if(u<0)return undefined;i=t.invertExtent(n[u]);r=t.invertExtent(n[o]);return[i[0]===undefined?i[1]:i[0],r[1]===undefined?r[0]:r[1]]}}function Dg(){const t=Xh().unknown(undefined),e=t.domain,n=t.range;let i=[0,1],r,u,o=false,s=0,a=0,f=.5;delete t.unknown;function c(){const t=e().length,c=i[1]<i[0],l=i[1-c],d=tg(t,s,a);let h=i[c-0];r=(l-h)/(d||1);if(o){r=Math.floor(r)}h+=(l-h-r*(t-s))*f;u=r*(1-s);if(o){h=Math.round(h);u=Math.round(u)}const p=Li(t).map((t=>h+r*t));return n(c?p.reverse():p)}t.domain=function(t){if(arguments.length){e(t);return c()}else{return e()}};t.range=function(t){if(arguments.length){i=[+t[0],+t[1]];return c()}else{return i.slice()}};t.rangeRound=function(t){i=[+t[0],+t[1]];o=true;return c()};t.bandwidth=function(){return u};t.step=function(){return r};t.round=function(t){if(arguments.length){o=!!t;return c()}else{return o}};t.padding=function(t){if(arguments.length){a=Math.max(0,Math.min(1,t));s=a;return c()}else{return s}};t.paddingInner=function(t){if(arguments.length){s=Math.max(0,Math.min(1,t));return c()}else{return s}};t.paddingOuter=function(t){if(arguments.length){a=Math.max(0,Math.min(1,t));return c()}else{return a}};t.align=function(t){if(arguments.length){f=Math.max(0,Math.min(1,t));return c()}else{return f}};t.invertRange=function(t){if(t[0]==null||t[1]==null)return;const r=i[1]<i[0],o=r?n().reverse():n(),s=o.length-1;let a=+t[0],f=+t[1],c,l,d;if(a!==a||f!==f)return;if(f<a){d=a;a=f;f=d}if(f<o[0]||a>i[1-r])return;c=Math.max(0,ai(o,a)-1);l=a===f?c:ai(o,f)-1;if(a-o[c]>u+1e-10)++c;if(r){d=c;c=s-l;l=s-d}return c>l?undefined:e().slice(c,l+1)};t.invert=function(e){const n=t.invertRange([e,e]);return n?n[0]:n};t.copy=function(){return Dg().domain(e()).range(i).round(o).paddingInner(s).paddingOuter(a).align(f)};return c()}function kg(t){const e=t.copy;t.padding=t.paddingOuter;delete t.paddingInner;t.copy=function(){return kg(e())};return t}function Eg(){return kg(Dg().paddingInner(1))}var $g=Array.prototype.map;function jg(t){return $g.call(t,De)}const Cg=Array.prototype.slice;function Mg(){let t=[],e=[];function n(n){return n==null||n!==n?undefined:e[(ai(t,n)-1)%e.length]}n.domain=function(e){if(arguments.length){t=jg(e);return n}else{return t.slice()}};n.range=function(t){if(arguments.length){e=Cg.call(t);return n}else{return e.slice()}};n.tickFormat=function(e,n){return am(t[0],Fe(t),e==null?10:e,n)};n.copy=function(){return Mg().domain(n.domain()).range(n.range())};return n}const Bg=new Map;const Sg=Symbol("vega_scale");function _g(t){t[Sg]=true;return t}function Ng(t){return t&&t[Sg]===true}function zg(t,e,n){const i=function n(){const i=e();if(!i.invertRange){i.invertRange=i.invert?Og(i):i.invertExtent?Fg(i):undefined}i.type=t;return _g(i)};i.metadata=Cn(Ue(n));return i}function Tg(t,e,n){if(arguments.length>1){Bg.set(t,zg(t,e,n));return this}else{return Pg(t)?Bg.get(t):undefined}}Tg(eg,lm);Tg(ng,cm,vg);Tg(ig,xm,[vg,ig]);Tg(rg,Mm,vg);Tg(ug,Bm,vg);Tg(og,km,vg);Tg(sg,Lm,[vg,xg]);Tg(ag,Im,[vg,xg]);Tg(fg,Um,[vg,Ag]);Tg(`${fg}-${ng}`,Um,[vg,Ag]);Tg(`${fg}-${ig}`,Wm,[vg,Ag,ig]);Tg(`${fg}-${rg}`,Hm,[vg,Ag]);Tg(`${fg}-${ug}`,Vm,[vg,Ag]);Tg(`${fg}-${og}`,Gm,[vg,Ag]);Tg(`${cg}-${ng}`,Xm,[vg,Ag]);Tg(`${cg}-${ig}`,Jm,[vg,Ag,ig]);Tg(`${cg}-${rg}`,Zm,[vg,Ag]);Tg(`${cg}-${ug}`,Km,[vg,Ag]);Tg(`${cg}-${og}`,Qm,[vg,Ag]);Tg(lg,Sm,[wg,lg]);Tg(dg,_m,wg);Tg(hg,Nm,wg);Tg(bg,Mg,[yg,wg]);Tg(pg,Xh,yg);Tg(gg,Dg,yg);Tg(mg,Eg,yg);function Pg(t){return Bg.has(t)}function Lg(t,e){const n=Bg.get(t);return n&&n.metadata[e]}function Ig(t){return Lg(t,vg)}function Rg(t){return Lg(t,yg)}function qg(t){return Lg(t,wg)}function Ug(t){return Lg(t,ig)}function Wg(t){return Lg(t,xg)}function Gg(t){return Lg(t,Ag)}function Hg(t){return Lg(t,lg)}const Vg=["clamp","base","constant","exponent"];function Yg(t,e){const n=e[0],i=Fe(e)-n;return function(e){return t(n+e*i)}}function Xg(t,e,n){return Yp(Zg(e||"rgb",n),t)}function Jg(t,e){const n=new Array(e),i=e+1;for(let r=0;r<e;)n[r]=t(++r/i);return n}function Qg(t,e,n){const i=n-e;let r,u,o;if(!i||!Number.isFinite(i)){return Ze(.5)}else{r=(u=t.type).indexOf("-");u=r<0?u:u.slice(r+1);o=Tg(u)().domain([e,n]).range([0,1]);Vg.forEach((e=>t[e]?o[e](t[e]()):0));return o}}function Zg(t,e){const n=Jp[Kg(t)];return e!=null&&n&&n.gamma?n.gamma(e):n}function Kg(t){return"interpolate"+t.toLowerCase().split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}const tb={blues:"cfe1f2bed8eca8cee58fc1de74b2d75ba3cf4592c63181bd206fb2125ca40a4a90",greens:"d3eecdc0e6baabdda594d3917bc77d60ba6c46ab5e329a512089430e7735036429",greys:"e2e2e2d4d4d4c4c4c4b1b1b19d9d9d8888887575756262624d4d4d3535351e1e1e",oranges:"fdd8b3fdc998fdb87bfda55efc9244f87f2cf06b18e4580bd14904b93d029f3303",purples:"e2e1efd4d4e8c4c5e0b4b3d6a3a0cc928ec3827cb97566ae684ea25c3696501f8c",reds:"fdc9b4fcb49afc9e80fc8767fa7051f6573fec3f2fdc2a25c81b1db21218970b13",blueGreen:"d5efedc1e8e0a7ddd18bd2be70c6a958ba9144ad77319c5d2089460e7736036429",bluePurple:"ccddecbad0e4a8c2dd9ab0d4919cc98d85be8b6db28a55a6873c99822287730f71",greenBlue:"d3eecec5e8c3b1e1bb9bd8bb82cec269c2ca51b2cd3c9fc7288abd1675b10b60a1",orangeRed:"fddcaffdcf9bfdc18afdad77fb9562f67d53ee6545e24932d32d1ebf130da70403",purpleBlue:"dbdaebc8cee4b1c3de97b7d87bacd15b9fc93a90c01e7fb70b70ab056199045281",purpleBlueGreen:"dbd8eac8cee4b0c3de93b7d872acd1549fc83892bb1c88a3097f8702736b016353",purpleRed:"dcc9e2d3b3d7ce9eccd186c0da6bb2e14da0e23189d91e6fc61159ab07498f023a",redPurple:"fccfccfcbec0faa9b8f98faff571a5ec539ddb3695c41b8aa908808d0179700174",yellowGreen:"e4f4acd1eca0b9e2949ed68880c97c62bb6e47aa5e3297502083440e723b036034",yellowOrangeBrown:"feeaa1fedd84fecc63feb746fca031f68921eb7215db5e0bc54c05ab3d038f3204",yellowOrangeRed:"fee087fed16ffebd59fea849fd903efc7335f9522bee3423de1b20ca0b22af0225",blueOrange:"134b852f78b35da2cb9dcae1d2e5eff2f0ebfce0bafbbf74e8932fc5690d994a07",brownBlueGreen:"704108a0651ac79548e3c78af3e6c6eef1eac9e9e48ed1c74da79e187a72025147",purpleGreen:"5b1667834792a67fb6c9aed3e6d6e8eff0efd9efd5aedda971bb75368e490e5e29",purpleOrange:"4114696647968f83b7b9b4d6dadbebf3eeeafce0bafbbf74e8932fc5690d994a07",redBlue:"8c0d25bf363adf745ef4ae91fbdbc9f2efeed2e5ef9dcae15da2cb2f78b3134b85",redGrey:"8c0d25bf363adf745ef4ae91fcdccbfaf4f1e2e2e2c0c0c0969696646464343434",yellowGreenBlue:"eff9bddbf1b4bde5b594d5b969c5be45b4c22c9ec02182b82163aa23479c1c3185",redYellowBlue:"a50026d4322cf16e43fcac64fedd90faf8c1dcf1ecabd6e875abd04a74b4313695",redYellowGreen:"a50026d4322cf16e43fcac63fedd8df9f7aed7ee8ea4d86e64bc6122964f006837",pinkYellowGreen:"8e0152c0267edd72adf0b3d6faddedf5f3efe1f2cab6de8780bb474f9125276419",spectral:"9e0142d13c4bf0704afcac63fedd8dfbf8b0e0f3a1a9dda269bda94288b55e4fa2",viridis:"440154470e61481a6c482575472f7d443a834144873d4e8a39568c35608d31688e2d708e2a788e27818e23888e21918d1f988b1fa08822a8842ab07f35b77943bf7154c56866cc5d7ad1518fd744a5db36bcdf27d2e21be9e51afde725",magma:"0000040404130b0924150e3720114b2c11603b0f704a107957157e651a80721f817f24828c29819a2e80a8327db6377ac43c75d1426fde4968e95462f1605df76f5cfa7f5efc8f65fe9f6dfeaf78febf84fece91fddea0fcedaffcfdbf",inferno:"0000040403130c0826170c3b240c4f330a5f420a68500d6c5d126e6b176e781c6d86216b932667a12b62ae305cbb3755c73e4cd24644dd513ae65c30ed6925f3771af8850ffb9506fca50afcb519fac62df6d645f2e661f3f484fcffa4",plasma:"0d088723069033059742039d5002a25d01a66a00a87801a88405a7900da49c179ea72198b12a90ba3488c33d80cb4779d35171da5a69e16462e76e5bed7953f2834cf68f44fa9a3dfca636fdb32ffec029fcce25f9dc24f5ea27f0f921",cividis:"00205100235800265d002961012b65042e670831690d346b11366c16396d1c3c6e213f6e26426e2c456e31476e374a6e3c4d6e42506e47536d4c566d51586e555b6e5a5e6e5e616e62646f66676f6a6a706e6d717270717573727976737c79747f7c75827f758682768985778c8877908b78938e789691789a94789e9778a19b78a59e77a9a177aea575b2a874b6ab73bbaf71c0b26fc5b66dc9b96acebd68d3c065d8c462ddc85fe2cb5ce7cf58ebd355f0d652f3da4ff7de4cfae249fce647",rainbow:"6e40aa883eb1a43db3bf3cafd83fa4ee4395fe4b83ff576eff6659ff7847ff8c38f3a130e2b72fcfcc36bee044aff05b8ff4576ff65b52f6673af27828ea8d1ddfa319d0b81cbecb23abd82f96e03d82e14c6edb5a5dd0664dbf6e40aa",sinebow:"ff4040fc582af47218e78d0bd5a703bfbf00a7d5038de70b72f41858fc2a40ff402afc5818f4720be78d03d5a700bfbf03a7d50b8de71872f42a58fc4040ff582afc7218f48d0be7a703d5bf00bfd503a7e70b8df41872fc2a58ff4040",turbo:"23171b32204a3e2a71453493493eae4b49c54a53d7485ee44569ee4074f53c7ff8378af93295f72e9ff42ba9ef28b3e926bce125c5d925cdcf27d5c629dcbc2de3b232e9a738ee9d3ff39347f68950f9805afc7765fd6e70fe667cfd5e88fc5795fb51a1f84badf545b9f140c5ec3cd0e637dae034e4d931ecd12ef4c92bfac029ffb626ffad24ffa223ff9821ff8d1fff821dff771cfd6c1af76118f05616e84b14df4111d5380fcb2f0dc0260ab61f07ac1805a313029b0f00950c00910b00",browns:"eedbbdecca96e9b97ae4a865dc9856d18954c7784cc0673fb85536ad44339f3632",tealBlues:"bce4d89dd3d181c3cb65b3c245a2b9368fae347da0306a932c5985",teals:"bbdfdfa2d4d58ac9c975bcbb61b0af4da5a43799982b8b8c1e7f7f127273006667",warmGreys:"dcd4d0cec5c1c0b8b4b3aaa7a59c9998908c8b827f7e7673726866665c5a59504e",goldGreen:"f4d166d5ca60b6c35c98bb597cb25760a6564b9c533f8f4f33834a257740146c36",goldOrange:"f4d166f8be5cf8aa4cf5983bf3852aef701be2621fd65322c54923b142239e3a26",goldRed:"f4d166f6be59f9aa51fc964ef6834bee734ae56249db5247cf4244c43141b71d3e",lightGreyRed:"efe9e6e1dad7d5cbc8c8bdb9bbaea9cd967ddc7b43e15f19df4011dc000b",lightGreyTeal:"e4eaead6dcddc8ced2b7c2c7a6b4bc64b0bf22a6c32295c11f85be1876bc",lightMulti:"e0f1f2c4e9d0b0de9fd0e181f6e072f6c053f3993ef77440ef4a3c",lightOrange:"f2e7daf7d5baf9c499fab184fa9c73f68967ef7860e8645bde515bd43d5b",lightTealBlue:"e3e9e0c0dccf9aceca7abfc859afc0389fb9328dad2f7ca0276b95255988",darkBlue:"3232322d46681a5c930074af008cbf05a7ce25c0dd38daed50f3faffffff",darkGold:"3c3c3c584b37725e348c7631ae8b2bcfa424ecc31ef9de30fff184ffffff",darkGreen:"3a3a3a215748006f4d048942489e4276b340a6c63dd2d836ffeb2cffffaa",darkMulti:"3737371f5287197d8c29a86995ce3fffe800ffffff",darkRed:"3434347036339e3c38cc4037e75d1eec8620eeab29f0ce32ffeb2c"};const eb={category10:"1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf",category20:"1f77b4aec7e8ff7f0effbb782ca02c98df8ad62728ff98969467bdc5b0d58c564bc49c94e377c2f7b6d27f7f7fc7c7c7bcbd22dbdb8d17becf9edae5",category20b:"393b795254a36b6ecf9c9ede6379398ca252b5cf6bcedb9c8c6d31bd9e39e7ba52e7cb94843c39ad494ad6616be7969c7b4173a55194ce6dbdde9ed6",category20c:"3182bd6baed69ecae1c6dbefe6550dfd8d3cfdae6bfdd0a231a35474c476a1d99bc7e9c0756bb19e9ac8bcbddcdadaeb636363969696bdbdbdd9d9d9",tableau10:"4c78a8f58518e4575672b7b254a24beeca3bb279a2ff9da69d755dbab0ac",tableau20:"4c78a89ecae9f58518ffbf7954a24b88d27ab79a20f2cf5b43989483bcb6e45756ff9d9879706ebab0acd67195fcbfd2b279a2d6a5c99e765fd8b5a5",accent:"7fc97fbeaed4fdc086ffff99386cb0f0027fbf5b17666666",dark2:"1b9e77d95f027570b3e7298a66a61ee6ab02a6761d666666",paired:"a6cee31f78b4b2df8a33a02cfb9a99e31a1cfdbf6fff7f00cab2d66a3d9affff99b15928",pastel1:"fbb4aeb3cde3ccebc5decbe4fed9a6ffffcce5d8bdfddaecf2f2f2",pastel2:"b3e2cdfdcdaccbd5e8f4cae4e6f5c9fff2aef1e2cccccccc",set1:"e41a1c377eb84daf4a984ea3ff7f00ffff33a65628f781bf999999",set2:"66c2a5fc8d628da0cbe78ac3a6d854ffd92fe5c494b3b3b3",set3:"8dd3c7ffffb3bebadafb807280b1d3fdb462b3de69fccde5d9d9d9bc80bdccebc5ffed6f"};function nb(t){const e=t.length/6|0,n=new Array(e);for(let i=0;i<e;){n[i]="#"+t.slice(i*6,++i*6)}return n}function ib(t,e){for(const n in t)ub(n,e(t[n]))}const rb={};ib(eb,nb);ib(tb,(t=>Xg(nb(t))));function ub(t,e){t=t&&t.toLowerCase();if(arguments.length>1){rb[t]=e;return this}else{return rb[t]}}const ob="symbol";const sb="discrete";const ab="gradient";const fb=t=>ve(t)?t.map((t=>String(t))):String(t);const cb=(t,e)=>t[1]-e[1];const lb=(t,e)=>e[1]-t[1];function db(t,e,n){let i;if(pn(e)){if(t.bins){e=Math.max(e,t.bins.length)}if(n!=null){e=Math.min(e,Math.floor(Fn(t.domain())/n||1))}}if(ye(e)){i=e.step;e=e.interval}if(gn(e)){e=t.type===sg?_u(e):t.type==ag?Nu(e):ne("Only time and utc scales accept interval strings.");if(i)e=e.every(i)}return e}function hb(t,e,n){let i=t.range(),r=i[0],u=Fe(i),o=cb;if(r>u){i=u;u=r;r=i;o=lb}r=Math.floor(r);u=Math.ceil(u);e=e.map((e=>[e,t(e)])).filter((t=>r<=t[1]&&t[1]<=u)).sort(o).map((t=>t[0]));if(n>0&&e.length>1){const t=[e[0],Fe(e)];while(e.length>n&&e.length>=3){e=e.filter(((t,e)=>!(e%2)))}if(e.length<3){e=t}}return e}function pb(t,e){return t.bins?hb(t,t.bins):t.ticks?t.ticks(e):t.domain()}function mb(t,e,n,i,r,u){const o=e.type;let s=fb;if(o===sg||r===sg){s=t.timeFormat(i)}else if(o===ag||r===ag){s=t.utcFormat(i)}else if(Ug(o)){const r=t.formatFloat(i);if(u||e.bins){s=r}else{const t=gb(e,n,false);s=e=>t(e)?r(e):""}}else if(e.tickFormat){const r=e.domain();s=t.formatSpan(r[0],r[r.length-1],n,i)}else if(i){s=t.format(i)}return s}function gb(t,e,n){const i=pb(t,e),r=t.base(),u=Math.log(r),o=Math.max(1,r*e/i.length);const s=t=>{let e=t/Math.pow(r,Math.round(Math.log(t)/u));if(e*r<r-.5)e*=r;return e<=o};return n?i.filter(s):s}const bb={[lg]:"quantiles",[dg]:"thresholds",[hg]:"domain"};const vb={[lg]:"quantiles",[dg]:"domain"};function yb(t,e){return t.bins?xb(t.bins):t.type===ig?gb(t,e,true):bb[t.type]?Ab(t[bb[t.type]]()):pb(t,e)}function wb(t,e,n){const i=e[vb[e.type]](),r=i.length;let u=r>1?i[1]-i[0]:i[0],o;for(o=1;o<r;++o){u=Math.min(u,i[o]-i[o-1])}return t.formatSpan(0,u,3*10,n)}function Ab(t){const e=[-Infinity].concat(t);e.max=+Infinity;return e}function xb(t){const e=t.slice(0,-1);e.max=Fe(t);return e}const Ob=t=>bb[t.type]||t.bins;function Fb(t,e,n,i,r,u,o){const s=vb[e.type]&&u!==sg&&u!==ag?wb(t,e,r):mb(t,e,n,r,u,o);return i===ob&&Ob(e)?Db(s):i===sb?Eb(s):$b(s)}const Db=t=>(e,n,i)=>{const r=kb(i[n+1],kb(i.max,+Infinity)),u=jb(e,t),o=jb(r,t);return u&&o?u+" – "+o:o?"< "+o:"≥ "+u};const kb=(t,e)=>t!=null?t:e;const Eb=t=>(e,n)=>n?t(e):null;const $b=t=>e=>t(e);const jb=(t,e)=>Number.isFinite(t)?e(t):null;function Cb(t){const e=t.domain(),n=e.length-1;let i=+e[0],r=+Fe(e),u=r-i;if(t.type===hg){const t=n?u/n:.1;i-=t;r+=t;u=r-i}return t=>(t-i)/u}function Mb(t,e,n,i){const r=i||e.type;if(gn(n)&&Wg(r)){n=n.replace(/%a/g,"%A").replace(/%b/g,"%B")}return!n&&r===sg?t.timeFormat("%A, %d %B %Y, %X"):!n&&r===ag?t.utcFormat("%A, %d %B %Y, %X UTC"):Fb(t,e,5,null,n,i,true)}function Bb(t,e,n){n=n||{};const i=Math.max(3,n.maxlen||7),r=Mb(t,e,n.format,n.formatType);if(qg(e.type)){const t=yb(e).slice(1).map(r),n=t.length;return`${n} boundar${n===1?"y":"ies"}: ${t.join(", ")}`}else if(Rg(e.type)){const t=e.domain(),n=t.length,u=n>i?t.slice(0,i-2).map(r).join(", ")+", ending with "+t.slice(-1).map(r):t.map(r).join(", ");return`${n} value${n===1?"":"s"}: ${u}`}else{const t=e.domain();return`values from ${r(t[0])} to ${r(Fe(t))}`}}let Sb=0;function _b(){Sb=0}const Nb="p_";function zb(t){return t&&t.gradient}function Tb(t,e,n){const i=t.gradient;let r=t.id,u=i==="radial"?Nb:"";if(!r){r=t.id="gradient_"+Sb++;if(i==="radial"){t.x1=Pb(t.x1,.5);t.y1=Pb(t.y1,.5);t.r1=Pb(t.r1,0);t.x2=Pb(t.x2,.5);t.y2=Pb(t.y2,.5);t.r2=Pb(t.r2,.5);u=Nb}else{t.x1=Pb(t.x1,0);t.y1=Pb(t.y1,0);t.x2=Pb(t.x2,1);t.y2=Pb(t.y2,0)}}e[r]=t;return"url("+(n||"")+"#"+u+r+")"}function Pb(t,e){return t!=null?t:e}function Lb(t,e){var n=[],i;return i={gradient:"linear",x1:t?t[0]:0,y1:t?t[1]:0,x2:e?e[0]:1,y2:e?e[1]:0,stops:n,stop:function(t,e){n.push({offset:t,color:e});return i}}}const Ib={basis:{curve:Z},"basis-closed":{curve:K},"basis-open":{curve:fh},bundle:{curve:lh,tension:"beta",value:.85},cardinal:{curve:ph,tension:"tension",value:0},"cardinal-open":{curve:vh,tension:"tension",value:0},"cardinal-closed":{curve:gh,tension:"tension",value:0},"catmull-rom":{curve:Ah,tension:"alpha",value:.5},"catmull-rom-closed":{curve:Oh,tension:"alpha",value:.5},"catmull-rom-open":{curve:Dh,tension:"alpha",value:.5},linear:{curve:x},"linear-closed":{curve:Eh},monotone:{horizontal:zh,vertical:Nh},natural:{curve:Lh},step:{curve:Rh},"step-after":{curve:Uh},"step-before":{curve:qh}};function Rb(t,e,n){var i=un(Ib,t)&&Ib[t],r=null;if(i){r=i.curve||i[e||"vertical"];if(i.tension&&n!=null){r=r[i.tension](n)}}return r}const qb={m:2,l:2,h:1,v:1,z:0,c:6,s:4,q:4,t:2,a:7};const Ub=/[mlhvzcsqta]([^mlhvzcsqta]+|$)/gi;const Wb=/^[+-]?(([0-9]*\.[0-9]+)|([0-9]+\.)|([0-9]+))([eE][+-]?[0-9]+)?/;const Gb=/^((\s+,?\s*)|(,\s*))/;const Hb=/^[01]/;function Vb(t){const e=[];const n=t.match(Ub)||[];n.forEach((t=>{let n=t[0];const i=n.toLowerCase();const r=qb[i];const u=Yb(i,r,t.slice(1).trim());const o=u.length;if(o<r||o&&o%r!==0){throw Error("Invalid SVG path, incorrect parameter count")}e.push([n,...u.slice(0,r)]);if(o===r){return}if(i==="m"){n=n==="M"?"L":"l"}for(let s=r;s<o;s+=r){e.push([n,...u.slice(s,s+r)])}}));return e}function Yb(t,e,n){const i=[];for(let r=0;e&&r<n.length;){for(let u=0;u<e;++u){const e=t==="a"&&(u===3||u===4)?Hb:Wb;const o=n.slice(r).match(e);if(o===null){throw Error("Invalid SVG path, incorrect parameter type")}r+=o[0].length;i.push(+o[0]);const s=n.slice(r).match(Gb);if(s!==null){r+=s[0].length}}}return i}const Xb=Math.PI/180;const Jb=1e-14;const Qb=Math.PI/2;const Zb=Math.PI*2;const Kb=Math.sqrt(3)/2;var tv={};var ev={};var nv=[].join;function iv(t,e,n,i,r,u,o,s,a){const f=nv.call(arguments);if(tv[f]){return tv[f]}const c=o*Xb;const l=Math.sin(c);const d=Math.cos(c);n=Math.abs(n);i=Math.abs(i);const h=d*(s-t)*.5+l*(a-e)*.5;const p=d*(a-e)*.5-l*(s-t)*.5;let m=h*h/(n*n)+p*p/(i*i);if(m>1){m=Math.sqrt(m);n*=m;i*=m}const g=d/n;const b=l/n;const v=-l/i;const y=d/i;const w=g*s+b*a;const A=v*s+y*a;const x=g*t+b*e;const O=v*t+y*e;const F=(x-w)*(x-w)+(O-A)*(O-A);let D=1/F-.25;if(D<0)D=0;let k=Math.sqrt(D);if(u==r)k=-k;const E=.5*(w+x)-k*(O-A);const $=.5*(A+O)+k*(x-w);const j=Math.atan2(A-$,w-E);const C=Math.atan2(O-$,x-E);let M=C-j;if(M<0&&u===1){M+=Zb}else if(M>0&&u===0){M-=Zb}const B=Math.ceil(Math.abs(M/(Qb+.001)));const S=[];for(let _=0;_<B;++_){const t=j+_*M/B;const e=j+(_+1)*M/B;S[_]=[E,$,t,e,n,i,l,d]}return tv[f]=S}function rv(t){const e=nv.call(t);if(ev[e]){return ev[e]}var n=t[0],i=t[1],r=t[2],u=t[3],o=t[4],s=t[5],a=t[6],f=t[7];const c=f*o;const l=-a*s;const d=a*o;const h=f*s;const p=Math.cos(r);const m=Math.sin(r);const g=Math.cos(u);const b=Math.sin(u);const v=.5*(u-r);const y=Math.sin(v*.5);const w=8/3*y*y/Math.sin(v);const A=n+p-w*m;const x=i+m+w*p;const O=n+g;const F=i+b;const D=O+w*b;const k=F-w*g;return ev[e]=[c*A+l*x,d*A+h*x,c*D+l*k,d*D+h*k,c*O+l*F,d*O+h*F]}const uv=["l",0,0,0,0,0,0,0];function ov(t,e,n){const i=uv[0]=t[0];if(i==="a"||i==="A"){uv[1]=e*t[1];uv[2]=n*t[2];uv[3]=t[3];uv[4]=t[4];uv[5]=t[5];uv[6]=e*t[6];uv[7]=n*t[7]}else if(i==="h"||i==="H"){uv[1]=e*t[1]}else if(i==="v"||i==="V"){uv[1]=n*t[1]}else{for(var r=1,u=t.length;r<u;++r){uv[r]=(r%2==1?e:n)*t[r]}}return uv}function sv(t,e,n,i,r,u){var o,s=null,a=0,f=0,c=0,l=0,d,h,p,m,g=0,b=0;if(n==null)n=0;if(i==null)i=0;if(r==null)r=1;if(u==null)u=r;if(t.beginPath)t.beginPath();for(var v=0,y=e.length;v<y;++v){o=e[v];if(r!==1||u!==1){o=ov(o,r,u)}switch(o[0]){case"l":a+=o[1];f+=o[2];t.lineTo(a+n,f+i);break;case"L":a=o[1];f=o[2];t.lineTo(a+n,f+i);break;case"h":a+=o[1];t.lineTo(a+n,f+i);break;case"H":a=o[1];t.lineTo(a+n,f+i);break;case"v":f+=o[1];t.lineTo(a+n,f+i);break;case"V":f=o[1];t.lineTo(a+n,f+i);break;case"m":a+=o[1];f+=o[2];g=a;b=f;t.moveTo(a+n,f+i);break;case"M":a=o[1];f=o[2];g=a;b=f;t.moveTo(a+n,f+i);break;case"c":d=a+o[5];h=f+o[6];c=a+o[3];l=f+o[4];t.bezierCurveTo(a+o[1]+n,f+o[2]+i,c+n,l+i,d+n,h+i);a=d;f=h;break;case"C":a=o[5];f=o[6];c=o[3];l=o[4];t.bezierCurveTo(o[1]+n,o[2]+i,c+n,l+i,a+n,f+i);break;case"s":d=a+o[3];h=f+o[4];c=2*a-c;l=2*f-l;t.bezierCurveTo(c+n,l+i,a+o[1]+n,f+o[2]+i,d+n,h+i);c=a+o[1];l=f+o[2];a=d;f=h;break;case"S":d=o[3];h=o[4];c=2*a-c;l=2*f-l;t.bezierCurveTo(c+n,l+i,o[1]+n,o[2]+i,d+n,h+i);a=d;f=h;c=o[1];l=o[2];break;case"q":d=a+o[3];h=f+o[4];c=a+o[1];l=f+o[2];t.quadraticCurveTo(c+n,l+i,d+n,h+i);a=d;f=h;break;case"Q":d=o[3];h=o[4];t.quadraticCurveTo(o[1]+n,o[2]+i,d+n,h+i);a=d;f=h;c=o[1];l=o[2];break;case"t":d=a+o[1];h=f+o[2];if(s[0].match(/[QqTt]/)===null){c=a;l=f}else if(s[0]==="t"){c=2*a-p;l=2*f-m}else if(s[0]==="q"){c=2*a-c;l=2*f-l}p=c;m=l;t.quadraticCurveTo(c+n,l+i,d+n,h+i);a=d;f=h;c=a+o[1];l=f+o[2];break;case"T":d=o[1];h=o[2];c=2*a-c;l=2*f-l;t.quadraticCurveTo(c+n,l+i,d+n,h+i);a=d;f=h;break;case"a":av(t,a+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+a+n,o[7]+f+i]);a+=o[6];f+=o[7];break;case"A":av(t,a+n,f+i,[o[1],o[2],o[3],o[4],o[5],o[6]+n,o[7]+i]);a=o[6];f=o[7];break;case"z":case"Z":a=g;f=b;t.closePath();break}s=o}}function av(t,e,n,i){const r=iv(i[5],i[6],i[0],i[1],i[3],i[4],i[2],e,n);for(let u=0;u<r.length;++u){const e=rv(r[u]);t.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5])}}const fv=.5773502691896257;const cv={circle:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(n,0);t.arc(0,0,n,0,Zb)}},cross:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/2.5;t.moveTo(-n,-i);t.lineTo(-n,i);t.lineTo(-i,i);t.lineTo(-i,n);t.lineTo(i,n);t.lineTo(i,i);t.lineTo(n,i);t.lineTo(n,-i);t.lineTo(i,-i);t.lineTo(i,-n);t.lineTo(-i,-n);t.lineTo(-i,-i);t.closePath()}},diamond:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0);t.lineTo(0,-n);t.lineTo(n,0);t.lineTo(0,n);t.closePath()}},square:{draw:function(t,e){var n=Math.sqrt(e),i=-n/2;t.rect(i,i,n,n)}},arrow:{draw:function(t,e){var n=Math.sqrt(e)/2,i=n/7,r=n/2.5,u=n/8;t.moveTo(-i,n);t.lineTo(i,n);t.lineTo(i,-u);t.lineTo(r,-u);t.lineTo(0,-n);t.lineTo(-r,-u);t.lineTo(-i,-u);t.closePath()}},wedge:{draw:function(t,e){var n=Math.sqrt(e)/2,i=Kb*n,r=i-n*fv,u=n/4;t.moveTo(0,-i-r);t.lineTo(-u,i-r);t.lineTo(u,i-r);t.closePath()}},triangle:{draw:function(t,e){var n=Math.sqrt(e)/2,i=Kb*n,r=i-n*fv;t.moveTo(0,-i-r);t.lineTo(-n,i-r);t.lineTo(n,i-r);t.closePath()}},"triangle-up":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Kb*n;t.moveTo(0,-i);t.lineTo(-n,i);t.lineTo(n,i);t.closePath()}},"triangle-down":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Kb*n;t.moveTo(0,i);t.lineTo(-n,-i);t.lineTo(n,-i);t.closePath()}},"triangle-right":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Kb*n;t.moveTo(i,0);t.lineTo(-i,-n);t.lineTo(-i,n);t.closePath()}},"triangle-left":{draw:function(t,e){var n=Math.sqrt(e)/2,i=Kb*n;t.moveTo(-i,0);t.lineTo(i,-n);t.lineTo(i,n);t.closePath()}},stroke:{draw:function(t,e){const n=Math.sqrt(e)/2;t.moveTo(-n,0);t.lineTo(n,0)}}};function lv(t){return un(cv,t)?cv[t]:hv(t)}var dv={};function hv(t){if(!un(dv,t)){const e=Vb(t);dv[t]={draw:function(t,n){sv(t,e,0,0,Math.sqrt(n)/2)}}}return dv[t]}const pv=.448084975506;function mv(t){return t.x}function gv(t){return t.y}function bv(t){return t.width}function vv(t){return t.height}function yv(t){return typeof t==="function"?t:()=>+t}function wv(t,e,n){return Math.max(e,Math.min(t,n))}function Av(){var t=mv,e=gv,n=bv,i=vv,r=yv(0),u=r,o=r,s=r,a=null;function f(f,c,l){var d,h=c!=null?c:+t.call(this,f),p=l!=null?l:+e.call(this,f),m=+n.call(this,f),g=+i.call(this,f),b=Math.min(m,g)/2,v=wv(+r.call(this,f),0,b),y=wv(+u.call(this,f),0,b),w=wv(+o.call(this,f),0,b),A=wv(+s.call(this,f),0,b);if(!a)a=d=Q();if(v<=0&&y<=0&&w<=0&&A<=0){a.rect(h,p,m,g)}else{var x=h+m,O=p+g;a.moveTo(h+v,p);a.lineTo(x-y,p);a.bezierCurveTo(x-pv*y,p,x,p+pv*y,x,p+y);a.lineTo(x,O-A);a.bezierCurveTo(x,O-pv*A,x-pv*A,O,x-A,O);a.lineTo(h+w,O);a.bezierCurveTo(h+pv*w,O,h,O-pv*w,h,O-w);a.lineTo(h,p+v);a.bezierCurveTo(h,p+pv*v,h+pv*v,p,h+v,p);a.closePath()}if(d){a=null;return d+""||null}}f.x=function(e){if(arguments.length){t=yv(e);return f}else{return t}};f.y=function(t){if(arguments.length){e=yv(t);return f}else{return e}};f.width=function(t){if(arguments.length){n=yv(t);return f}else{return n}};f.height=function(t){if(arguments.length){i=yv(t);return f}else{return i}};f.cornerRadius=function(t,e,n,i){if(arguments.length){r=yv(t);u=e!=null?yv(e):r;s=n!=null?yv(n):r;o=i!=null?yv(i):u;return f}else{return r}};f.context=function(t){if(arguments.length){a=t==null?null:t;return f}else{return a}};return f}function xv(){var t,e,n,i,r=null,u,o,s,a;function f(t,e,n){const i=n/2;if(u){var f=s-e,c=t-o;if(f||c){var l=Math.sqrt(f*f+c*c),d=(f/=l)*a,h=(c/=l)*a,p=Math.atan2(c,f);r.moveTo(o-d,s-h);r.lineTo(t-f*i,e-c*i);r.arc(t,e,i,p-Math.PI,p);r.lineTo(o+d,s+h);r.arc(o,s,a,p,p+Math.PI)}else{r.arc(t,e,i,0,Zb)}r.closePath()}else{u=1}o=t;s=e;a=i}function c(o){var s,a=o.length,c,l=false,d;if(r==null)r=d=Q();for(s=0;s<=a;++s){if(!(s<a&&i(c=o[s],s,o))===l){if(l=!l)u=0}if(l)f(+t(c,s,o),+e(c,s,o),+n(c,s,o))}if(d){r=null;return d+""||null}}c.x=function(e){if(arguments.length){t=e;return c}else{return t}};c.y=function(t){if(arguments.length){e=t;return c}else{return e}};c.size=function(t){if(arguments.length){n=t;return c}else{return n}};c.defined=function(t){if(arguments.length){i=t;return c}else{return i}};c.context=function(t){if(arguments.length){if(t==null){r=null}else{r=t}return c}else{return r}};return c}function Ov(t,e){return t!=null?t:e}const Fv=t=>t.x||0,Dv=t=>t.y||0,kv=t=>t.width||0,Ev=t=>t.height||0,$v=t=>(t.x||0)+(t.width||0),jv=t=>(t.y||0)+(t.height||0),Cv=t=>t.startAngle||0,Mv=t=>t.endAngle||0,Bv=t=>t.padAngle||0,Sv=t=>t.innerRadius||0,_v=t=>t.outerRadius||0,Nv=t=>t.cornerRadius||0,zv=t=>Ov(t.cornerRadiusTopLeft,t.cornerRadius)||0,Tv=t=>Ov(t.cornerRadiusTopRight,t.cornerRadius)||0,Pv=t=>Ov(t.cornerRadiusBottomRight,t.cornerRadius)||0,Lv=t=>Ov(t.cornerRadiusBottomLeft,t.cornerRadius)||0,Iv=t=>Ov(t.size,64),Rv=t=>t.size||1,qv=t=>!(t.defined===false),Uv=t=>lv(t.shape||"circle");const Wv=oh().startAngle(Cv).endAngle(Mv).padAngle(Bv).innerRadius(Sv).outerRadius(_v).cornerRadius(Nv),Gv=sh().x(Fv).y1(Dv).y0(jv).defined(qv),Hv=sh().y(Dv).x1(Fv).x0($v).defined(qv),Vv=A().x(Fv).y(Dv).defined(qv),Yv=Av().x(Fv).y(Dv).width(kv).height(Ev).cornerRadius(zv,Tv,Pv,Lv),Xv=J().type(Uv).size(Iv),Jv=xv().x(Fv).y(Dv).defined(qv).size(Rv);function Qv(t){return t.cornerRadius||t.cornerRadiusTopLeft||t.cornerRadiusTopRight||t.cornerRadiusBottomRight||t.cornerRadiusBottomLeft}function Zv(t,e){return Wv.context(t)(e)}function Kv(t,e){const n=e[0],i=n.interpolate||"linear";return(n.orient==="horizontal"?Hv:Gv).curve(Rb(i,n.orient,n.tension)).context(t)(e)}function ty(t,e){const n=e[0],i=n.interpolate||"linear";return Vv.curve(Rb(i,n.orient,n.tension)).context(t)(e)}function ey(t,e,n,i){return Yv.context(t)(e,n,i)}function ny(t,e){return(e.mark.shape||e.shape).context(t)(e)}function iy(t,e){return Xv.context(t)(e)}function ry(t,e){return Jv.context(t)(e)}var uy=1;function oy(){uy=1}function sy(t,e,n){var i=e.clip,r=t._defs,u=e.clip_id||(e.clip_id="clip"+uy++),o=r.clipping[u]||(r.clipping[u]={id:u});if(Ge(i)){o.path=i(null)}else if(Qv(n)){o.path=ey(null,n,0,0)}else{o.width=n.width||0;o.height=n.height||0}return"url(#"+u+")"}function ay(t){this.clear();if(t)this.union(t)}ay.prototype={clone(){return new ay(this)},clear(){this.x1=+Number.MAX_VALUE;this.y1=+Number.MAX_VALUE;this.x2=-Number.MAX_VALUE;this.y2=-Number.MAX_VALUE;return this},empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE},equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2},set(t,e,n,i){if(n<t){this.x2=t;this.x1=n}else{this.x1=t;this.x2=n}if(i<e){this.y2=e;this.y1=i}else{this.y1=e;this.y2=i}return this},add(t,e){if(t<this.x1)this.x1=t;if(e<this.y1)this.y1=e;if(t>this.x2)this.x2=t;if(e>this.y2)this.y2=e;return this},expand(t){this.x1-=t;this.y1-=t;this.x2+=t;this.y2+=t;return this},round(){this.x1=Math.floor(this.x1);this.y1=Math.floor(this.y1);this.x2=Math.ceil(this.x2);this.y2=Math.ceil(this.y2);return this},scale(t){this.x1*=t;this.y1*=t;this.x2*=t;this.y2*=t;return this},translate(t,e){this.x1+=t;this.x2+=t;this.y1+=e;this.y2+=e;return this},rotate(t,e,n){const i=this.rotatedPoints(t,e,n);return this.clear().add(i[0],i[1]).add(i[2],i[3]).add(i[4],i[5]).add(i[6],i[7])},rotatedPoints(t,e,n){var{x1:i,y1:r,x2:u,y2:o}=this,s=Math.cos(t),a=Math.sin(t),f=e-e*s+n*a,c=n-e*a-n*s;return[s*i-a*r+f,a*i+s*r+c,s*i-a*o+f,a*i+s*o+c,s*u-a*r+f,a*u+s*r+c,s*u-a*o+f,a*u+s*o+c]},union(t){if(t.x1<this.x1)this.x1=t.x1;if(t.y1<this.y1)this.y1=t.y1;if(t.x2>this.x2)this.x2=t.x2;if(t.y2>this.y2)this.y2=t.y2;return this},intersect(t){if(t.x1>this.x1)this.x1=t.x1;if(t.y1>this.y1)this.y1=t.y1;if(t.x2<this.x2)this.x2=t.x2;if(t.y2<this.y2)this.y2=t.y2;return this},encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2},alignsWith(t){return t&&(this.x1==t.x1||this.x2==t.x2||this.y1==t.y1||this.y2==t.y2)},intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)},contains(t,e){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)},width(){return this.x2-this.x1},height(){return this.y2-this.y1}};function fy(t){this.mark=t;this.bounds=this.bounds||new ay}function cy(t){fy.call(this,t);this.items=this.items||[]}fn(cy,fy);function ly(t){this._pending=0;this._loader=t||Ca()}function dy(t){t._pending+=1}function hy(t){t._pending-=1}ly.prototype={pending(){return this._pending},sanitizeURL(t){const e=this;dy(e);return e._loader.sanitize(t,{context:"href"}).then((t=>{hy(e);return t})).catch((()=>{hy(e);return null}))},loadImage(t){const e=this,n=Gh();dy(e);return e._loader.sanitize(t,{context:"image"}).then((t=>{const i=t.href;if(!i||!n)throw{url:i};const r=new n;const u=un(t,"crossOrigin")?t.crossOrigin:"anonymous";if(u!=null)r.crossOrigin=u;r.onload=()=>hy(e);r.onerror=()=>hy(e);r.src=i;return r})).catch((t=>{hy(e);return{complete:false,width:0,height:0,src:t&&t.url||""}}))},ready(){const t=this;return new Promise((e=>{function n(i){if(!t.pending())e(i);else setTimeout((()=>{n(true)}),10)}n(false)}))}};function py(t,e,n){if(e.stroke&&e.opacity!==0&&e.strokeOpacity!==0){const i=e.strokeWidth!=null?+e.strokeWidth:1;t.expand(i+(n?my(e,i):0))}return t}function my(t,e){return t.strokeJoin&&t.strokeJoin!=="miter"?0:e}const gy=Zb-1e-8;let by,vy,yy,wy,Ay,xy,Oy,Fy;const Dy=(t,e)=>by.add(t,e);const ky=(t,e)=>Dy(vy=t,yy=e);const Ey=t=>Dy(t,by.y1);const $y=t=>Dy(by.x1,t);const jy=(t,e)=>Ay*t+Oy*e;const Cy=(t,e)=>xy*t+Fy*e;const My=(t,e)=>Dy(jy(t,e),Cy(t,e));const By=(t,e)=>ky(jy(t,e),Cy(t,e));function Sy(t,e){by=t;if(e){wy=e*Xb;Ay=Fy=Math.cos(wy);xy=Math.sin(wy);Oy=-xy}else{Ay=Fy=1;wy=xy=Oy=0}return _y}const _y={beginPath(){},closePath(){},moveTo:By,lineTo:By,rect(t,e,n,i){if(wy){My(t+n,e);My(t+n,e+i);My(t,e+i);By(t,e)}else{Dy(t+n,e+i);ky(t,e)}},quadraticCurveTo(t,e,n,i){const r=jy(t,e),u=Cy(t,e),o=jy(n,i),s=Cy(n,i);Ny(vy,r,o,Ey);Ny(yy,u,s,$y);ky(o,s)},bezierCurveTo(t,e,n,i,r,u){const o=jy(t,e),s=Cy(t,e),a=jy(n,i),f=Cy(n,i),c=jy(r,u),l=Cy(r,u);zy(vy,o,a,c,Ey);zy(yy,s,f,l,$y);ky(c,l)},arc(t,e,n,i,r,u){i+=wy;r+=wy;vy=n*Math.cos(r)+t;yy=n*Math.sin(r)+e;if(Math.abs(r-i)>gy){Dy(t-n,e-n);Dy(t+n,e+n)}else{const o=i=>Dy(n*Math.cos(i)+t,n*Math.sin(i)+e);let s,a;o(i);o(r);if(r!==i){i=i%Zb;if(i<0)i+=Zb;r=r%Zb;if(r<0)r+=Zb;if(r<i){u=!u;s=i;i=r;r=s}if(u){r-=Zb;s=i-i%Qb;for(a=0;a<4&&s>r;++a,s-=Qb)o(s)}else{s=i-i%Qb+Qb;for(a=0;a<4&&s<r;++a,s=s+Qb)o(s)}}}}};function Ny(t,e,n,i){const r=(t-e)/(t+n-2*e);if(0<r&&r<1)i(t+(e-t)*r)}function zy(t,e,n,i,r){const u=i-t+3*e-3*n,o=t+n-2*e,s=t-e;let a=0,f=0,c;if(Math.abs(u)>Jb){c=o*o+s*u;if(c>=0){c=Math.sqrt(c);a=(-o+c)/u;f=(-o-c)/u}}else{a=.5*s/o}if(0<a&&a<1)r(Ty(a,t,e,n,i));if(0<f&&f<1)r(Ty(f,t,e,n,i))}function Ty(t,e,n,i,r){const u=1-t,o=u*u,s=t*t;return o*u*e+3*o*t*n+3*u*s*i+s*t*r}var Py=(Py=Wh(1,1))?Py.getContext("2d"):null;const Ly=new ay;function Iy(t){return function(e,n){if(!Py)return true;t(Py,e);Ly.clear().union(e.bounds).intersect(n).round();const{x1:i,y1:r,x2:u,y2:o}=Ly;for(let t=r;t<=o;++t){for(let e=i;e<=u;++e){if(Py.isPointInPath(e,t)){return true}}}return false}}function Ry(t,e){return e.contains(t.x||0,t.y||0)}function qy(t,e){const n=t.x||0,i=t.y||0,r=t.width||0,u=t.height||0;return e.intersects(Ly.set(n,i,n+r,i+u))}function Uy(t,e){const n=t.x||0,i=t.y||0,r=t.x2!=null?t.x2:n,u=t.y2!=null?t.y2:i;return Wy(e,n,i,r,u)}function Wy(t,e,n,i,r){const{x1:u,y1:o,x2:s,y2:a}=t,f=i-e,c=r-n;let l=0,d=1,h,p,m,g;for(g=0;g<4;++g){if(g===0){h=-f;p=-(u-e)}if(g===1){h=f;p=s-e}if(g===2){h=-c;p=-(o-n)}if(g===3){h=c;p=a-n}if(Math.abs(h)<1e-10&&p<0)return false;m=p/h;if(h<0){if(m>d)return false;else if(m>l)l=m}else if(h>0){if(m<l)return false;else if(m<d)d=m}}return true}function Gy(t,e){t.globalCompositeOperation=e.blend||"source-over"}function Hy(t,e){return t==null?e:t}function Vy(t,e){const n=e.length;for(let i=0;i<n;++i){t.addColorStop(e[i].offset,e[i].color)}return t}function Yy(t,e,n){const i=n.width(),r=n.height();let u;if(e.gradient==="radial"){u=t.createRadialGradient(n.x1+Hy(e.x1,.5)*i,n.y1+Hy(e.y1,.5)*r,Math.max(i,r)*Hy(e.r1,0),n.x1+Hy(e.x2,.5)*i,n.y1+Hy(e.y2,.5)*r,Math.max(i,r)*Hy(e.r2,.5))}else{const o=Hy(e.x1,0),s=Hy(e.y1,0),a=Hy(e.x2,1),f=Hy(e.y2,0);if(o===a||s===f||i===r){u=t.createLinearGradient(n.x1+o*i,n.y1+s*r,n.x1+a*i,n.y1+f*r)}else{const n=Wh(Math.ceil(i),Math.ceil(r)),u=n.getContext("2d");u.scale(i,r);u.fillStyle=Vy(u.createLinearGradient(o,s,a,f),e.stops);u.fillRect(0,0,i,r);return t.createPattern(n,"no-repeat")}}return Vy(u,e.stops)}function Xy(t,e,n){return zb(n)?Yy(t,n,e.bounds):n}function Jy(t,e,n){n*=e.fillOpacity==null?1:e.fillOpacity;if(n>0){t.globalAlpha=n;t.fillStyle=Xy(t,e,e.fill);return true}else{return false}}var Qy=[];function Zy(t,e,n){var i=(i=e.strokeWidth)!=null?i:1;if(i<=0)return false;n*=e.strokeOpacity==null?1:e.strokeOpacity;if(n>0){t.globalAlpha=n;t.strokeStyle=Xy(t,e,e.stroke);t.lineWidth=i;t.lineCap=e.strokeCap||"butt";t.lineJoin=e.strokeJoin||"miter";t.miterLimit=e.strokeMiterLimit||10;if(t.setLineDash){t.setLineDash(e.strokeDash||Qy);t.lineDashOffset=e.strokeDashOffset||0}return true}else{return false}}function Ky(t,e){return t.zindex-e.zindex||t.index-e.index}function tw(t){if(!t.zdirty)return t.zitems;var e=t.items,n=[],i,r,u;for(r=0,u=e.length;r<u;++r){i=e[r];i.index=r;if(i.zindex)n.push(i)}t.zdirty=false;return t.zitems=n.sort(Ky)}function ew(t,e){var n=t.items,i,r;if(!n||!n.length)return;const u=tw(t);if(u&&u.length){for(i=0,r=n.length;i<r;++i){if(!n[i].zindex)e(n[i])}n=u}for(i=0,r=n.length;i<r;++i){e(n[i])}}function nw(t,e){var n=t.items,i,r;if(!n||!n.length)return null;const u=tw(t);if(u&&u.length)n=u;for(r=n.length;--r>=0;){if(i=e(n[r]))return i}if(n===u){for(n=t.items,r=n.length;--r>=0;){if(!n[r].zindex){if(i=e(n[r]))return i}}}return null}function iw(t){return function(e,n,i){ew(n,(n=>{if(!i||i.intersects(n.bounds)){uw(t,e,n,n)}}))}}function rw(t){return function(e,n,i){if(n.items.length&&(!i||i.intersects(n.bounds))){uw(t,e,n.items[0],n.items)}}}function uw(t,e,n,i){var r=n.opacity==null?1:n.opacity;if(r===0)return;if(t(e,i))return;Gy(e,n);if(n.fill&&Jy(e,n,r)){e.fill()}if(n.stroke&&Zy(e,n,r)){e.stroke()}}function ow(t){t=t||fe;return function(e,n,i,r,u,o){i*=e.pixelRatio;r*=e.pixelRatio;return nw(n,(n=>{const s=n.bounds;if(s&&!s.contains(u,o)||!s)return;if(t(e,n,i,r,u,o))return n}))}}function sw(t,e){return function(n,i,r,u){var o=Array.isArray(i)?i[0]:i,s=e==null?o.fill:e,a=o.stroke&&n.isPointInStroke,f,c;if(a){f=o.strokeWidth;c=o.strokeCap;n.lineWidth=f!=null?f:1;n.lineCap=c!=null?c:"butt"}return t(n,i)?false:s&&n.isPointInPath(r,u)||a&&n.isPointInStroke(r,u)}}function aw(t){return ow(sw(t))}function fw(t,e){return"translate("+t+","+e+")"}function cw(t){return"rotate("+t+")"}function lw(t,e){return"scale("+t+","+e+")"}function dw(t){return fw(t.x||0,t.y||0)}function hw(t){return fw(t.x||0,t.y||0)+(t.angle?" "+cw(t.angle):"")}function pw(t){return fw(t.x||0,t.y||0)+(t.angle?" "+cw(t.angle):"")+(t.scaleX||t.scaleY?" "+lw(t.scaleX||1,t.scaleY||1):"")}function mw(t,e,n){function i(t,n){t("transform",hw(n));t("d",e(null,n))}function r(t,n){e(Sy(t,n.angle),n);return py(t,n).translate(n.x||0,n.y||0)}function u(t,n){var i=n.x||0,r=n.y||0,u=n.angle||0;t.translate(i,r);if(u)t.rotate(u*=Xb);t.beginPath();e(t,n);if(u)t.rotate(-u);t.translate(-i,-r)}return{type:t,tag:"path",nested:false,attr:i,bound:r,draw:iw(u),pick:aw(u),isect:n||Iy(u)}}var gw=mw("arc",Zv);function bw(t,e){var n=t[0].orient==="horizontal"?e[1]:e[0],i=t[0].orient==="horizontal"?"y":"x",r=t.length,u=+Infinity,o,s;while(--r>=0){if(t[r].defined===false)continue;s=Math.abs(t[r][i]-n);if(s<u){u=s;o=t[r]}}return o}function vw(t,e){var n=Math.pow(t[0].strokeWidth||1,2),i=t.length,r,u,o;while(--i>=0){if(t[i].defined===false)continue;r=t[i].x-e[0];u=t[i].y-e[1];o=r*r+u*u;if(o<n)return t[i]}return null}function yw(t,e){var n=t.length,i,r,u;while(--n>=0){if(t[n].defined===false)continue;i=t[n].x-e[0];r=t[n].y-e[1];u=i*i+r*r;i=t[n].size||1;if(u<i*i)return t[n]}return null}function ww(t,e,n){function i(t,n){var i=n.mark.items;if(i.length)t("d",e(null,i))}function r(t,n){var i=n.items;if(i.length===0){return t}else{e(Sy(t),i);return py(t,i[0])}}function u(t,n){t.beginPath();e(t,n)}const o=sw(u);function s(t,e,n,i,r,u){var s=e.items,a=e.bounds;if(!s||!s.length||a&&!a.contains(r,u)){return null}n*=t.pixelRatio;i*=t.pixelRatio;return o(t,s,n,i)?s[0]:null}return{type:t,tag:"path",nested:true,attr:i,bound:r,draw:rw(u),pick:s,isect:Ry,tip:n}}var Aw=ww("area",Kv,bw);function xw(t,e){var n=e.clip;t.save();if(Ge(n)){t.beginPath();n(t);t.clip()}else{Ow(t,e.group)}}function Ow(t,e){t.beginPath();Qv(e)?ey(t,e,0,0):t.rect(0,0,e.width||0,e.height||0);t.clip()}function Fw(t){const e=Hy(t.strokeWidth,1);return t.strokeOffset!=null?t.strokeOffset:t.stroke&&e>.5&&e<1.5?.5-Math.abs(e-1):0}function Dw(t,e){t("transform",dw(e))}function kw(t,e){const n=Fw(e);t("d",ey(null,e,n,n))}function Ew(t,e){t("class","background");t("aria-hidden",true);kw(t,e)}function $w(t,e){t("class","foreground");t("aria-hidden",true);if(e.strokeForeground){kw(t,e)}else{t("d","")}}function jw(t,e,n){const i=e.clip?sy(n,e,e):null;t("clip-path",i)}function Cw(t,e){if(!e.clip&&e.items){const n=e.items,i=n.length;for(let e=0;e<i;++e){t.union(n[e].bounds)}}if((e.clip||e.width||e.height)&&!e.noBound){t.add(0,0).add(e.width||0,e.height||0)}py(t,e);return t.translate(e.x||0,e.y||0)}function Mw(t,e,n,i){const r=Fw(e);t.beginPath();ey(t,e,(n||0)+r,(i||0)+r)}const Bw=sw(Mw);const Sw=sw(Mw,false);const _w=sw(Mw,true);function Nw(t,e,n){ew(e,(e=>{const i=e.x||0,r=e.y||0,u=e.strokeForeground,o=e.opacity==null?1:e.opacity;if((e.stroke||e.fill)&&o){Mw(t,e,i,r);Gy(t,e);if(e.fill&&Jy(t,e,o)){t.fill()}if(e.stroke&&!u&&Zy(t,e,o)){t.stroke()}}t.save();t.translate(i,r);if(e.clip)Ow(t,e);if(n)n.translate(-i,-r);ew(e,(e=>{this.draw(t,e,n)}));if(n)n.translate(i,r);t.restore();if(u&&e.stroke&&o){Mw(t,e,i,r);Gy(t,e);if(Zy(t,e,o)){t.stroke()}}}))}function zw(t,e,n,i,r,u){if(e.bounds&&!e.bounds.contains(r,u)||!e.items){return null}const o=n*t.pixelRatio,s=i*t.pixelRatio;return nw(e,(a=>{let f,c,l;const d=a.bounds;if(d&&!d.contains(r,u))return;c=a.x||0;l=a.y||0;const h=c+(a.width||0),p=l+(a.height||0),m=a.clip;if(m&&(r<c||r>h||u<l||u>p))return;t.save();t.translate(c,l);c=r-c;l=u-l;if(m&&Qv(a)&&!_w(t,a,o,s)){t.restore();return null}const g=a.strokeForeground,b=e.interactive!==false;if(b&&g&&a.stroke&&Sw(t,a,o,s)){t.restore();return a}f=nw(a,(t=>Tw(t,c,l)?this.pick(t,n,i,c,l):null));if(!f&&b&&(a.fill||!g&&a.stroke)&&Bw(t,a,o,s)){f=a}t.restore();return f||null}))}function Tw(t,e,n){return(t.interactive!==false||t.marktype==="group")&&t.bounds&&t.bounds.contains(e,n)}var Pw={type:"group",tag:"g",nested:false,attr:Dw,bound:Cw,draw:Nw,pick:zw,isect:qy,content:jw,background:Ew,foreground:$w};var Lw={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1"};function Iw(t,e){var n=t.image;if(!n||t.url&&t.url!==n.url){n={complete:false,width:0,height:0};e.loadImage(t.url).then((e=>{t.image=e;t.image.url=t.url}))}return n}function Rw(t,e){return t.width!=null?t.width:!e||!e.width?0:t.aspect!==false&&t.height?t.height*e.width/e.height:e.width}function qw(t,e){return t.height!=null?t.height:!e||!e.height?0:t.aspect!==false&&t.width?t.width*e.height/e.width:e.height}function Uw(t,e){return t==="center"?e/2:t==="right"?e:0}function Ww(t,e){return t==="middle"?e/2:t==="bottom"?e:0}function Gw(t,e,n){const i=Iw(e,n),r=Rw(e,i),u=qw(e,i),o=(e.x||0)-Uw(e.align,r),s=(e.y||0)-Ww(e.baseline,u),a=!i.src&&i.toDataURL?i.toDataURL():i.src||"";t("href",a,Lw["xmlns:xlink"],"xlink:href");t("transform",fw(o,s));t("width",r);t("height",u);t("preserveAspectRatio",e.aspect===false?"none":"xMidYMid")}function Hw(t,e){const n=e.image,i=Rw(e,n),r=qw(e,n),u=(e.x||0)-Uw(e.align,i),o=(e.y||0)-Ww(e.baseline,r);return t.set(u,o,u+i,o+r)}function Vw(t,e,n){ew(e,(e=>{if(n&&!n.intersects(e.bounds))return;const i=Iw(e,this);let r=Rw(e,i);let u=qw(e,i);if(r===0||u===0)return;let o=(e.x||0)-Uw(e.align,r),s=(e.y||0)-Ww(e.baseline,u),a,f,c,l;if(e.aspect!==false){f=i.width/i.height;c=e.width/e.height;if(f===f&&c===c&&f!==c){if(c<f){l=r/f;s+=(u-l)/2;u=l}else{l=u*f;o+=(r-l)/2;r=l}}}if(i.complete||i.toDataURL){Gy(t,e);t.globalAlpha=(a=e.opacity)!=null?a:1;t.imageSmoothingEnabled=e.smooth!==false;t.drawImage(i,o,s,r,u)}}))}var Yw={type:"image",tag:"image",nested:false,attr:Gw,bound:Hw,draw:Vw,pick:ow(),isect:fe,get:Iw,xOffset:Uw,yOffset:Ww};var Xw=ww("line",ty,vw);function Jw(t,e){var n=e.scaleX||1,i=e.scaleY||1;if(n!==1||i!==1){t("vector-effect","non-scaling-stroke")}t("transform",pw(e));t("d",e.path)}function Qw(t,e){var n=e.path;if(n==null)return true;var i=e.x||0,r=e.y||0,u=e.scaleX||1,o=e.scaleY||1,s=(e.angle||0)*Xb,a=e.pathCache;if(!a||a.path!==n){(e.pathCache=a=Vb(n)).path=n}if(s&&t.rotate&&t.translate){t.translate(i,r);t.rotate(s);sv(t,a,0,0,u,o);t.rotate(-s);t.translate(-i,-r)}else{sv(t,a,i,r,u,o)}}function Zw(t,e){return Qw(Sy(t,e.angle),e)?t.set(0,0,0,0):py(t,e,true)}var Kw={type:"path",tag:"path",nested:false,attr:Jw,bound:Zw,draw:iw(Qw),pick:aw(Qw),isect:Iy(Qw)};function tA(t,e){t("d",ey(null,e))}function eA(t,e){var n,i;return py(t.set(n=e.x||0,i=e.y||0,n+e.width||0,i+e.height||0),e)}function nA(t,e){t.beginPath();ey(t,e)}var iA={type:"rect",tag:"path",nested:false,attr:tA,bound:eA,draw:iw(nA),pick:aw(nA),isect:qy};function rA(t,e){t("transform",dw(e));t("x2",e.x2!=null?e.x2-(e.x||0):0);t("y2",e.y2!=null?e.y2-(e.y||0):0)}function uA(t,e){var n,i;return py(t.set(n=e.x||0,i=e.y||0,e.x2!=null?e.x2:n,e.y2!=null?e.y2:i),e)}function oA(t,e,n){var i,r,u,o;if(e.stroke&&Zy(t,e,n)){i=e.x||0;r=e.y||0;u=e.x2!=null?e.x2:i;o=e.y2!=null?e.y2:r;t.beginPath();t.moveTo(i,r);t.lineTo(u,o);return true}return false}function sA(t,e,n){ew(e,(e=>{if(n&&!n.intersects(e.bounds))return;var i=e.opacity==null?1:e.opacity;if(i&&oA(t,e,i)){Gy(t,e);t.stroke()}}))}function aA(t,e,n,i){if(!t.isPointInStroke)return false;return oA(t,e,1)&&t.isPointInStroke(n,i)}var fA={type:"rule",tag:"line",nested:false,attr:rA,bound:uA,draw:sA,pick:ow(aA),isect:Uy};var cA=mw("shape",ny);var lA=mw("symbol",iy,Ry);const dA=wn();var hA={height:yA,measureWidth:bA,estimateWidth:mA,width:mA,canvas:pA};pA(true);function pA(t){hA.width=t&&Py?bA:mA}function mA(t,e){return gA(FA(t,e),yA(t))}function gA(t,e){return~~(.8*t.length*e)}function bA(t,e){return yA(t)<=0||!(e=FA(t,e))?0:vA(e,$A(t))}function vA(t,e){const n=`(${e}) ${t}`;let i=dA.get(n);if(i===undefined){Py.font=e;i=Py.measureText(t).width;dA.set(n,i)}return i}function yA(t){return t.fontSize!=null?+t.fontSize||0:11}function wA(t){return t.lineHeight!=null?t.lineHeight:yA(t)+2}function AA(t){return ve(t)?t.length>1?t:t[0]:t}function xA(t){return AA(t.lineBreak&&t.text&&!ve(t.text)?t.text.split(t.lineBreak):t.text)}function OA(t){const e=xA(t);return(ve(e)?e.length-1:0)*wA(t)}function FA(t,e){const n=e==null?"":(e+"").trim();return t.limit>0&&n.length?kA(t,n):n}function DA(t){if(hA.width===bA){const e=$A(t);return t=>vA(t,e)}else{const e=yA(t);return t=>gA(t,e)}}function kA(t,e){var n=+t.limit,i=DA(t);if(i(e)<n)return e;var r=t.ellipsis||"…",u=t.dir==="rtl",o=0,s=e.length,a;n-=i(r);if(u){while(o<s){a=o+s>>>1;if(i(e.slice(a))>n)o=a+1;else s=a}return r+e.slice(o)}else{while(o<s){a=1+(o+s>>>1);if(i(e.slice(0,a))<n)o=a;else s=a-1}return e.slice(0,o)+r}}function EA(t,e){var n=t.font;return(e&&n?String(n).replace(/"/g,"'"):n)||"sans-serif"}function $A(t,e){return""+(t.fontStyle?t.fontStyle+" ":"")+(t.fontVariant?t.fontVariant+" ":"")+(t.fontWeight?t.fontWeight+" ":"")+yA(t)+"px "+EA(t,e)}function jA(t){var e=t.baseline,n=yA(t);return Math.round(e==="top"?.79*n:e==="middle"?.3*n:e==="bottom"?-.21*n:e==="line-top"?.29*n+.5*wA(t):e==="line-bottom"?.29*n-.5*wA(t):0)}const CA={left:"start",center:"middle",right:"end"};const MA=new ay;function BA(t){var e=t.x||0,n=t.y||0,i=t.radius||0,r;if(i){r=(t.theta||0)-Qb;e+=i*Math.cos(r);n+=i*Math.sin(r)}MA.x1=e;MA.y1=n;return MA}function SA(t,e){var n=e.dx||0,i=(e.dy||0)+jA(e),r=BA(e),u=r.x1,o=r.y1,s=e.angle||0,a;t("text-anchor",CA[e.align]||"start");if(s){a=fw(u,o)+" "+cw(s);if(n||i)a+=" "+fw(n,i)}else{a=fw(u+n,o+i)}t("transform",a)}function _A(t,e,n){var i=hA.height(e),r=e.align,u=BA(e),o=u.x1,s=u.y1,a=e.dx||0,f=(e.dy||0)+jA(e)-Math.round(.8*i),c=xA(e),l;if(ve(c)){i+=wA(e)*(c.length-1);l=c.reduce(((t,n)=>Math.max(t,hA.width(e,n))),0)}else{l=hA.width(e,c)}if(r==="center"){a-=l/2}else if(r==="right"){a-=l}else;t.set(a+=o,f+=s,a+l,f+i);if(e.angle&&!n){t.rotate(e.angle*Xb,o,s)}else if(n===2){return t.rotatedPoints(e.angle*Xb,o,s)}return t}function NA(t,e,n){ew(e,(e=>{var i=e.opacity==null?1:e.opacity,r,u,o,s,a,f,c;if(n&&!n.intersects(e.bounds)||i===0||e.fontSize<=0||e.text==null||e.text.length===0)return;t.font=$A(e);t.textAlign=e.align||"left";r=BA(e);u=r.x1,o=r.y1;if(e.angle){t.save();t.translate(u,o);t.rotate(e.angle*Xb);u=o=0}u+=e.dx||0;o+=(e.dy||0)+jA(e);f=xA(e);Gy(t,e);if(ve(f)){a=wA(e);for(s=0;s<f.length;++s){c=FA(e,f[s]);if(e.fill&&Jy(t,e,i)){t.fillText(c,u,o)}if(e.stroke&&Zy(t,e,i)){t.strokeText(c,u,o)}o+=a}}else{c=FA(e,f);if(e.fill&&Jy(t,e,i)){t.fillText(c,u,o)}if(e.stroke&&Zy(t,e,i)){t.strokeText(c,u,o)}}if(e.angle)t.restore()}))}function zA(t,e,n,i,r,u){if(e.fontSize<=0)return false;if(!e.angle)return true;var o=BA(e),s=o.x1,a=o.y1,f=_A(MA,e,1),c=-e.angle*Xb,l=Math.cos(c),d=Math.sin(c),h=l*r-d*u+(s-l*s+d*a),p=d*r+l*u+(a-d*s-l*a);return f.contains(h,p)}function TA(t,e){const n=_A(MA,t,2);return Wy(e,n[0],n[1],n[2],n[3])||Wy(e,n[0],n[1],n[4],n[5])||Wy(e,n[4],n[5],n[6],n[7])||Wy(e,n[2],n[3],n[6],n[7])}var PA={type:"text",tag:"text",nested:false,attr:SA,bound:_A,draw:NA,pick:ow(zA),isect:TA};var LA=ww("trail",ry,yw);var IA={arc:gw,area:Aw,group:Pw,image:Yw,line:Xw,path:Kw,rect:iA,rule:fA,shape:cA,symbol:lA,text:PA,trail:LA};function RA(t,e,n){var i=IA[t.mark.marktype],r=e||i.bound;if(i.nested)t=t.mark;return r(t.bounds||(t.bounds=new ay),t,n)}var qA={mark:null};function UA(t,e,n){var i=IA[t.marktype],r=i.bound,u=t.items,o=u&&u.length,s,a,f,c;if(i.nested){if(o){f=u[0]}else{qA.mark=t;f=qA}c=RA(f,r,n);e=e&&e.union(c)||c;return e}e=e||t.bounds&&t.bounds.clear()||new ay;if(o){for(s=0,a=u.length;s<a;++s){e.union(RA(u[s],r,n))}}return t.bounds=e}const WA=["marktype","name","role","interactive","clip","items","zindex","x","y","width","height","align","baseline","fill","fillOpacity","opacity","blend","stroke","strokeOpacity","strokeWidth","strokeCap","strokeDash","strokeDashOffset","strokeForeground","strokeOffset","startAngle","endAngle","innerRadius","outerRadius","cornerRadius","padAngle","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight","interpolate","tension","orient","defined","url","aspect","smooth","path","scaleX","scaleY","x2","y2","size","shape","text","angle","theta","radius","dir","dx","dy","ellipsis","limit","lineBreak","lineHeight","font","fontSize","fontWeight","fontStyle","fontVariant","description","aria","ariaRole","ariaRoleDescription"];function GA(t,e){return JSON.stringify(t,WA,e)}function HA(t){const e=typeof t==="string"?JSON.parse(t):t;return VA(e)}function VA(t){var e=t.marktype,n=t.items,i,r,u;if(n){for(r=0,u=n.length;r<u;++r){i=e?"mark":"group";n[r][i]=t;if(n[r].zindex)n[r][i].zdirty=true;if("group"===(e||i))VA(n[r])}}if(e)UA(t);return t}function YA(t){if(arguments.length){this.root=HA(t)}else{this.root=XA({marktype:"group",name:"root",role:"frame"});this.root.items=[new cy(this.root)]}}YA.prototype={toJSON(t){return GA(this.root,t||0)},mark(t,e,n){e=e||this.root.items[0];const i=XA(t,e);e.items[n]=i;if(i.zindex)i.group.zdirty=true;return i}};function XA(t,e){const n={bounds:new ay,clip:!!t.clip,group:e,interactive:t.interactive===false?false:true,items:[],marktype:t.marktype,name:t.name||undefined,role:t.role||undefined,zindex:t.zindex||0};if(t.aria!=null){n.aria=t.aria}if(t.description){n.description=t.description}return n}function JA(t,e,n){if(!t&&typeof document!=="undefined"&&document.createElement){t=document}return t?n?t.createElementNS(n,e):t.createElement(e):null}function QA(t,e){e=e.toLowerCase();var n=t.childNodes,i=0,r=n.length;for(;i<r;++i)if(n[i].tagName.toLowerCase()===e){return n[i]}}function ZA(t,e,n,i){var r=t.childNodes[e],u;if(!r||r.tagName.toLowerCase()!==n.toLowerCase()){u=r||null;r=JA(t.ownerDocument,n,i);t.insertBefore(r,u)}return r}function KA(t,e){var n=t.childNodes,i=n.length;while(i>e)t.removeChild(n[--i]);return t}function tx(t){return"mark-"+t.marktype+(t.role?" role-"+t.role:"")+(t.name?" "+t.name:"")}function ex(t,e){const n=e.getBoundingClientRect();return[t.clientX-n.left-(e.clientLeft||0),t.clientY-n.top-(e.clientTop||0)]}function nx(t,e,n,i){var r=t&&t.mark,u,o;if(r&&(u=IA[r.marktype]).tip){o=ex(e,n);o[0]-=i[0];o[1]-=i[1];while(t=t.mark.group){o[0]-=t.x||0;o[1]-=t.y||0}t=u.tip(r.items,o)}return t}function ix(t,e){this._active=null;this._handlers={};this._loader=t||Ca();this._tooltip=e||rx}function rx(t,e,n,i){t.element().setAttribute("title",i||"")}ix.prototype={initialize(t,e,n){this._el=t;this._obj=n||null;return this.origin(e)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},origin(t){if(arguments.length){this._origin=t||[0,0];return this}else{return this._origin.slice()}},scene(t){if(!arguments.length)return this._scene;this._scene=t;return this},on(){},off(){},_handlerIndex(t,e,n){for(let i=t?t.length:0;--i>=0;){if(t[i].type===e&&(!n||t[i].handler===n)){return i}}return-1},handlers(t){const e=this._handlers,n=[];if(t){n.push(...e[this.eventName(t)])}else{for(const t in e){n.push(...e[t])}}return n},eventName(t){const e=t.indexOf(".");return e<0?t:t.slice(0,e)},handleHref(t,e,n){this._loader.sanitize(n,{context:"href"}).then((e=>{const n=new MouseEvent(t.type,t),i=JA(null,"a");for(const t in e)i.setAttribute(t,e[t]);i.dispatchEvent(n)})).catch((()=>{}))},handleTooltip(t,e,n){if(e&&e.tooltip!=null){e=nx(e,t,this.canvas(),this._origin);const i=n&&e&&e.tooltip||null;this._tooltip.call(this._obj,this,t,e,i)}},getItemBoundingClientRect(t){const e=this.canvas();if(!e)return;const n=e.getBoundingClientRect(),i=this._origin,r=t.bounds,u=r.width(),o=r.height();let s=r.x1+i[0]+n.left,a=r.y1+i[1]+n.top;while(t.mark&&(t=t.mark.group)){s+=t.x||0;a+=t.y||0}return{x:s,y:a,width:u,height:o,left:s,top:a,right:s+u,bottom:a+o}}};function ux(t){this._el=null;this._bgcolor=null;this._loader=new ly(t)}ux.prototype={initialize(t,e,n,i,r){this._el=t;return this.resize(e,n,i,r)},element(){return this._el},canvas(){return this._el&&this._el.firstChild},background(t){if(arguments.length===0)return this._bgcolor;this._bgcolor=t;return this},resize(t,e,n,i){this._width=t;this._height=e;this._origin=n||[0,0];this._scale=i||1;return this},dirty(){},render(t){const e=this;e._call=function(){e._render(t)};e._call();e._call=null;return e},_render(){},renderAsync(t){const e=this.render(t);return this._ready?this._ready.then((()=>e)):Promise.resolve(e)},_load(t,e){var n=this,i=n._loader[t](e);if(!n._ready){const t=n._call;n._ready=n._loader.ready().then((e=>{if(e)t();n._ready=null}))}return i},sanitizeURL(t){return this._load("sanitizeURL",t)},loadImage(t){return this._load("loadImage",t)}};const ox="keydown";const sx="keypress";const ax="keyup";const fx="dragenter";const cx="dragleave";const lx="dragover";const dx="mousedown";const hx="mouseup";const px="mousemove";const mx="mouseout";const gx="mouseover";const bx="click";const vx="dblclick";const yx="wheel";const wx="mousewheel";const Ax="touchstart";const xx="touchmove";const Ox="touchend";const Fx=[ox,sx,ax,fx,cx,lx,dx,hx,px,mx,gx,bx,vx,yx,wx,Ax,xx,Ox];const Dx=px;const kx=mx;const Ex=bx;function $x(t,e){ix.call(this,t,e);this._down=null;this._touch=null;this._first=true;this._events={}}const jx=t=>t===Ax||t===xx||t===Ox?[Ax,xx,Ox]:[t];function Cx(t,e){jx(e).forEach((e=>Mx(t,e)))}function Mx(t,e){const n=t.canvas();if(n&&!t._events[e]){t._events[e]=1;n.addEventListener(e,t[e]?n=>t[e](n):n=>t.fire(e,n))}}function Bx(t,e,n){return function(i){const r=this._active,u=this.pickEvent(i);if(u===r){this.fire(t,i)}else{if(!r||!r.exit){this.fire(n,i)}this._active=u;this.fire(e,i);this.fire(t,i)}}}function Sx(t){return function(e){this.fire(t,e);this._active=null}}fn($x,ix,{initialize(t,e,n){this._canvas=t&&QA(t,"canvas");[bx,dx,px,mx,cx].forEach((t=>Cx(this,t)));return ix.prototype.initialize.call(this,t,e,n)},canvas(){return this._canvas},context(){return this._canvas.getContext("2d")},events:Fx,DOMMouseScroll(t){this.fire(wx,t)},mousemove:Bx(px,gx,mx),dragover:Bx(lx,fx,cx),mouseout:Sx(mx),dragleave:Sx(cx),mousedown(t){this._down=this._active;this.fire(dx,t)},click(t){if(this._down===this._active){this.fire(bx,t);this._down=null}},touchstart(t){this._touch=this.pickEvent(t.changedTouches[0]);if(this._first){this._active=this._touch;this._first=false}this.fire(Ax,t,true)},touchmove(t){this.fire(xx,t,true)},touchend(t){this.fire(Ox,t,true);this._touch=null},fire(t,e,n){const i=n?this._touch:this._active,r=this._handlers[t];e.vegaType=t;if(t===Ex&&i&&i.href){this.handleHref(e,i,i.href)}else if(t===Dx||t===kx){this.handleTooltip(e,i,t!==kx)}if(r){for(let t=0,n=r.length;t<n;++t){r[t].handler.call(this._obj,e,i)}}},on(t,e){const n=this.eventName(t),i=this._handlers,r=this._handlerIndex(i[n],t,e);if(r<0){Cx(this,t);(i[n]||(i[n]=[])).push({type:t,handler:e})}return this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);if(r>=0){i.splice(r,1)}return this},pickEvent(t){const e=ex(t,this._canvas),n=this._origin;return this.pick(this._scene,e[0],e[1],e[0]-n[0],e[1]-n[1])},pick(t,e,n,i,r){const u=this.context(),o=IA[t.marktype];return o.pick.call(this,u,t,e,n,i,r)}});function _x(){return typeof window!=="undefined"?window.devicePixelRatio||1:1}var Nx=_x();function zx(t,e,n,i,r,u){const o=typeof HTMLElement!=="undefined"&&t instanceof HTMLElement&&t.parentNode!=null,s=t.getContext("2d"),a=o?Nx:r;t.width=e*a;t.height=n*a;for(const f in u){s[f]=u[f]}if(o&&a!==1){t.style.width=e+"px";t.style.height=n+"px"}s.pixelRatio=a;s.setTransform(a,0,0,a,a*i[0],a*i[1]);return t}function Tx(t){ux.call(this,t);this._options={};this._redraw=false;this._dirty=new ay;this._tempb=new ay}const Px=ux.prototype;const Lx=(t,e,n)=>(new ay).set(0,0,e,n).translate(-t[0],-t[1]);function Ix(t,e,n){e.expand(1).round();if(t.pixelRatio%1){e.scale(t.pixelRatio).round().scale(1/t.pixelRatio)}e.translate(-(n[0]%1),-(n[1]%1));t.beginPath();t.rect(e.x1,e.y1,e.width(),e.height());t.clip();return e}fn(Tx,ux,{initialize(t,e,n,i,r,u){this._options=u||{};this._canvas=this._options.externalContext?null:Wh(1,1);if(t&&this._canvas){KA(t,0).appendChild(this._canvas);this._canvas.setAttribute("class","marks")}return Px.initialize.call(this,t,e,n,i,r)},resize(t,e,n,i){Px.resize.call(this,t,e,n,i);if(this._canvas){zx(this._canvas,this._width,this._height,this._origin,this._scale,this._options.context)}else{const t=this._options.externalContext;if(!t)ne("CanvasRenderer is missing a valid canvas or context");t.scale(this._scale,this._scale);t.translate(this._origin[0],this._origin[1])}this._redraw=true;return this},canvas(){return this._canvas},context(){return this._options.externalContext||(this._canvas?this._canvas.getContext("2d"):null)},dirty(t){const e=this._tempb.clear().union(t.bounds);let n=t.mark.group;while(n){e.translate(n.x||0,n.y||0);n=n.mark.group}this._dirty.union(e)},_render(t){const e=this.context(),n=this._origin,i=this._width,r=this._height,u=this._dirty,o=Lx(n,i,r);e.save();const s=this._redraw||u.empty()?(this._redraw=false,o.expand(1)):Ix(e,o.intersect(u),n);this.clear(-n[0],-n[1],i,r);this.draw(e,t,s);e.restore();u.clear();return this},draw(t,e,n){const i=IA[e.marktype];if(e.clip)xw(t,e);i.draw.call(this,t,e,n);if(e.clip)t.restore()},clear(t,e,n,i){const r=this._options,u=this.context();if(r.type!=="pdf"&&!r.externalContext){u.clearRect(t,e,n,i)}if(this._bgcolor!=null){u.fillStyle=this._bgcolor;u.fillRect(t,e,n,i)}}});function Rx(t,e){ix.call(this,t,e);const n=this;n._hrefHandler=qx(n,((t,e)=>{if(e&&e.href)n.handleHref(t,e,e.href)}));n._tooltipHandler=qx(n,((t,e)=>{n.handleTooltip(t,e,t.type!==kx)}))}const qx=(t,e)=>n=>{let i=n.target.__data__;i=Array.isArray(i)?i[0]:i;n.vegaType=n.type;e.call(t._obj,n,i)};fn(Rx,ix,{initialize(t,e,n){let i=this._svg;if(i){i.removeEventListener(Ex,this._hrefHandler);i.removeEventListener(Dx,this._tooltipHandler);i.removeEventListener(kx,this._tooltipHandler)}this._svg=i=t&&QA(t,"svg");if(i){i.addEventListener(Ex,this._hrefHandler);i.addEventListener(Dx,this._tooltipHandler);i.addEventListener(kx,this._tooltipHandler)}return ix.prototype.initialize.call(this,t,e,n)},canvas(){return this._svg},on(t,e){const n=this.eventName(t),i=this._handlers,r=this._handlerIndex(i[n],t,e);if(r<0){const r={type:t,handler:e,listener:qx(this,e)};(i[n]||(i[n]=[])).push(r);if(this._svg){this._svg.addEventListener(n,r.listener)}}return this},off(t,e){const n=this.eventName(t),i=this._handlers[n],r=this._handlerIndex(i,t,e);if(r>=0){if(this._svg){this._svg.removeEventListener(n,i[r].listener)}i.splice(r,1)}return this}});const Ux="aria-hidden";const Wx="aria-label";const Gx="role";const Hx="aria-roledescription";const Vx="graphics-object";const Yx="graphics-symbol";const Xx=(t,e,n)=>({[Gx]:t,[Hx]:e,[Wx]:n||undefined});const Jx=Cn(["axis-domain","axis-grid","axis-label","axis-tick","axis-title","legend-band","legend-entry","legend-gradient","legend-label","legend-title","legend-symbol","title"]);const Qx={axis:{desc:"axis",caption:rO},legend:{desc:"legend",caption:uO},"title-text":{desc:"title",caption:t=>`Title text '${iO(t)}'`},"title-subtitle":{desc:"subtitle",caption:t=>`Subtitle text '${iO(t)}'`}};const Zx={ariaRole:Gx,ariaRoleDescription:Hx,description:Wx};function Kx(t,e){const n=e.aria===false;t(Ux,n||undefined);if(n||e.description==null){for(const e in Zx){t(Zx[e],undefined)}}else{const n=e.mark.marktype;t(Wx,e.description);t(Gx,e.ariaRole||(n==="group"?Vx:Yx));t(Hx,e.ariaRoleDescription||`${n} mark`)}}function tO(t){return t.aria===false?{[Ux]:true}:Jx[t.role]?null:Qx[t.role]?nO(t,Qx[t.role]):eO(t)}function eO(t){const e=t.marktype;const n=e==="group"||e==="text"||t.items.some((t=>t.description!=null&&t.aria!==false));return Xx(n?Vx:Yx,`${e} mark container`,t.description)}function nO(t,e){try{const n=t.items[0],i=e.caption||(()=>"");return Xx(e.role||Yx,e.desc,n.description||i(n))}catch(n){return null}}function iO(t){return Ue(t.text).join(" ")}function rO(t){const e=t.datum,n=t.orient,i=e.title?oO(t):null,r=t.context,u=r.scales[e.scale].value,o=r.dataflow.locale(),s=u.type,a=n==="left"||n==="right"?"Y":"X";return`${a}-axis`+(i?` titled '${i}'`:"")+` for a ${Rg(s)?"discrete":s} scale`+` with ${Bb(o,u,t)}`}function uO(t){const e=t.datum,n=e.title?oO(t):null,i=`${e.type||""} legend`.trim(),r=e.scales,u=Object.keys(r),o=t.context,s=o.scales[r[u[0]]].value,a=o.dataflow.locale();return aO(i)+(n?` titled '${n}'`:"")+` for ${sO(u)}`+` with ${Bb(a,s,t)}`}function oO(t){try{return Ue(Fe(t.items).items[0].text).join(" ")}catch(e){return null}}function sO(t){t=t.map((t=>t+(t==="fill"||t==="stroke"?" color":"")));return t.length<2?t[0]:t.slice(0,-1).join(", ")+" and "+Fe(t)}function aO(t){return t.length?t[0].toUpperCase()+t.slice(1):t}const fO=t=>(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");const cO=t=>fO(t).replace(/"/g,"&quot;").replace(/\t/g,"&#x9;").replace(/\n/g,"&#xA;").replace(/\r/g,"&#xD;");function lO(){let t="",e="",n="";const i=[],r=()=>e=n="",u=u=>{if(e){t+=`${e}>${n}`;r()}i.push(u)},o=(t,n)=>{if(n!=null)e+=` ${t}="${cO(n)}"`;return s},s={open(t){u(t);e="<"+t;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++){i[r-1]=arguments[r]}for(const e of i){for(const t in e)o(t,e[t])}return s},close(){const u=i.pop();if(e){t+=e+(n?`>${n}</${u}>`:"/>")}else{t+=`</${u}>`}r();return s},attr:o,text:t=>(n+=fO(t),s),toString:()=>t};return s}const dO=t=>hO(lO(),t)+"";function hO(t,e){t.open(e.tagName);if(e.hasAttributes()){const n=e.attributes,i=n.length;for(let e=0;e<i;++e){t.attr(n[e].name,n[e].value)}}if(e.hasChildNodes()){const n=e.childNodes;for(const e of n){e.nodeType===3?t.text(e.nodeValue):hO(t,e)}}return t.close()}const pO={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",strokeCap:"stroke-linecap",strokeJoin:"stroke-linejoin",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeMiterLimit:"stroke-miterlimit",opacity:"opacity"};const mO={blend:"mix-blend-mode"};const gO={fill:"none","stroke-miterlimit":10};const bO=0,vO="http://www.w3.org/2000/xmlns/",yO=Lw.xmlns;function wO(t){ux.call(this,t);this._dirtyID=0;this._dirty=[];this._svg=null;this._root=null;this._defs=null}const AO=ux.prototype;fn(wO,ux,{initialize(t,e,n,i,r){this._defs={};this._clearDefs();if(t){this._svg=ZA(t,0,"svg",yO);this._svg.setAttributeNS(vO,"xmlns",yO);this._svg.setAttributeNS(vO,"xmlns:xlink",Lw["xmlns:xlink"]);this._svg.setAttribute("version",Lw["version"]);this._svg.setAttribute("class","marks");KA(t,1);this._root=ZA(this._svg,bO,"g",yO);SO(this._root,gO);KA(this._svg,bO+1)}this.background(this._bgcolor);return AO.initialize.call(this,t,e,n,i,r)},background(t){if(arguments.length&&this._svg){this._svg.style.setProperty("background-color",t)}return AO.background.apply(this,arguments)},resize(t,e,n,i){AO.resize.call(this,t,e,n,i);if(this._svg){SO(this._svg,{width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`});this._root.setAttribute("transform",`translate(${this._origin})`)}this._dirty=[];return this},canvas(){return this._svg},svg(){const t=this._svg,e=this._bgcolor;if(!t)return null;let n;if(e){t.removeAttribute("style");n=ZA(t,bO,"rect",yO);SO(n,{width:this._width,height:this._height,fill:e})}const i=dO(t);if(e){t.removeChild(n);this._svg.style.setProperty("background-color",e)}return i},_render(t){if(this._dirtyCheck()){if(this._dirtyAll)this._clearDefs();this.mark(this._root,t);KA(this._root,1)}this.defs();this._dirty=[];++this._dirtyID;return this},dirty(t){if(t.dirty!==this._dirtyID){t.dirty=this._dirtyID;this._dirty.push(t)}},isDirty(t){return this._dirtyAll||!t._svg||!t._svg.ownerSVGElement||t.dirty===this._dirtyID},_dirtyCheck(){this._dirtyAll=true;const t=this._dirty;if(!t.length||!this._dirtyID)return true;const e=++this._dirtyID;let n,i,r,u,o,s,a;for(o=0,s=t.length;o<s;++o){n=t[o];i=n.mark;if(i.marktype!==r){r=i.marktype;u=IA[r]}if(i.zdirty&&i.dirty!==e){this._dirtyAll=false;xO(n,e);i.items.forEach((t=>{t.dirty=e}))}if(i.zdirty)continue;if(n.exit){if(u.nested&&i.items.length){a=i.items[0];if(a._svg)this._update(u,a._svg,a)}else if(n._svg){a=n._svg.parentNode;if(a)a.removeChild(n._svg)}n._svg=null;continue}n=u.nested?i.items[0]:n;if(n._update===e)continue;if(!n._svg||!n._svg.ownerSVGElement){this._dirtyAll=false;xO(n,e)}else{this._update(u,n._svg,n)}n._update=e}return!this._dirtyAll},mark(t,e,n){if(!this.isDirty(e)){return e._svg}const i=this._svg,r=IA[e.marktype],u=e.interactive===false?"none":null,o=r.tag==="g";const s=kO(e,t,n,"g",i);s.setAttribute("class",tx(e));const a=tO(e);for(const d in a)_O(s,d,a[d]);if(!o){_O(s,"pointer-events",u)}_O(s,"clip-path",e.clip?sy(this,e,e.group):null);let f=null,c=0;const l=t=>{const e=this.isDirty(t),n=kO(t,s,f,r.tag,i);if(e){this._update(r,n,t);if(o)DO(this,n,t)}f=n;++c};if(r.nested){if(e.items.length)l(e.items[0])}else{ew(e,l)}KA(s,c);return s},_update(t,e,n){$O=e;jO=e.__values__;Kx(MO,n);t.attr(MO,n,this);const i=CO[t.type];if(i)i.call(this,t,e,n);if($O)this.style($O,n)},style(t,e){if(e==null)return;for(const n in pO){let i=n==="font"?EA(e):e[n];if(i===jO[n])continue;const r=pO[n];if(i==null){t.removeAttribute(r)}else{if(zb(i)){i=Tb(i,this._defs.gradient,zO())}t.setAttribute(r,i+"")}jO[n]=i}for(const n in mO){BO(t,mO[n],e[n])}},defs(){const t=this._svg,e=this._defs;let n=e.el,i=0;for(const r in e.gradient){if(!n)e.el=n=ZA(t,bO+1,"defs",yO);i=OO(n,e.gradient[r],i)}for(const r in e.clipping){if(!n)e.el=n=ZA(t,bO+1,"defs",yO);i=FO(n,e.clipping[r],i)}if(n){i===0?(t.removeChild(n),e.el=null):KA(n,i)}},_clearDefs(){const t=this._defs;t.gradient={};t.clipping={}}});function xO(t,e){for(;t&&t.dirty!==e;t=t.mark.group){t.dirty=e;if(t.mark&&t.mark.dirty!==e){t.mark.dirty=e}else return}}function OO(t,e,n){let i,r,u;if(e.gradient==="radial"){let i=ZA(t,n++,"pattern",yO);SO(i,{id:Nb+e.id,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"});i=ZA(i,0,"rect",yO);SO(i,{width:1,height:1,fill:`url(${zO()}#${e.id})`});t=ZA(t,n++,"radialGradient",yO);SO(t,{id:e.id,fx:e.x1,fy:e.y1,fr:e.r1,cx:e.x2,cy:e.y2,r:e.r2})}else{t=ZA(t,n++,"linearGradient",yO);SO(t,{id:e.id,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2})}for(i=0,r=e.stops.length;i<r;++i){u=ZA(t,i,"stop",yO);u.setAttribute("offset",e.stops[i].offset);u.setAttribute("stop-color",e.stops[i].color)}KA(t,i);return n}function FO(t,e,n){let i;t=ZA(t,n,"clipPath",yO);t.setAttribute("id",e.id);if(e.path){i=ZA(t,0,"path",yO);i.setAttribute("d",e.path)}else{i=ZA(t,0,"rect",yO);SO(i,{x:0,y:0,width:e.width,height:e.height})}KA(t,1);return n+1}function DO(t,e,n){e=e.lastChild.previousSibling;let i,r=0;ew(n,(n=>{i=t.mark(e,n,i);++r}));KA(e,1+r)}function kO(t,e,n,i,r){let u=t._svg,o;if(!u){o=e.ownerDocument;u=JA(o,i,yO);t._svg=u;if(t.mark){u.__data__=t;u.__values__={fill:"default"};if(i==="g"){const e=JA(o,"path",yO);u.appendChild(e);e.__data__=t;const n=JA(o,"g",yO);u.appendChild(n);n.__data__=t;const i=JA(o,"path",yO);u.appendChild(i);i.__data__=t;i.__values__={fill:"default"}}}}if(u.ownerSVGElement!==r||EO(u,n)){e.insertBefore(u,n?n.nextSibling:e.firstChild)}return u}function EO(t,e){return t.parentNode&&t.parentNode.childNodes.length>1&&t.previousSibling!=e}let $O=null,jO=null;const CO={group(t,e,n){const i=$O=e.childNodes[2];jO=i.__values__;t.foreground(MO,n,this);jO=e.__values__;$O=e.childNodes[1];t.content(MO,n,this);const r=$O=e.childNodes[0];t.background(MO,n,this);const u=n.mark.interactive===false?"none":null;if(u!==jO.events){_O(i,"pointer-events",u);_O(r,"pointer-events",u);jO.events=u}if(n.strokeForeground&&n.stroke){const t=n.fill;_O(i,"display",null);this.style(r,n);_O(r,"stroke",null);if(t)n.fill=null;jO=i.__values__;this.style(i,n);if(t)n.fill=t;$O=null}else{_O(i,"display","none")}},image(t,e,n){if(n.smooth===false){BO(e,"image-rendering","optimizeSpeed");BO(e,"image-rendering","pixelated")}else{BO(e,"image-rendering",null)}},text(t,e,n){const i=xA(n);let r,u,o,s;if(ve(i)){u=i.map((t=>FA(n,t)));r=u.join("\n");if(r!==jO.text){KA(e,0);o=e.ownerDocument;s=wA(n);u.forEach(((t,i)=>{const r=JA(o,"tspan",yO);r.__data__=n;r.textContent=t;if(i){r.setAttribute("x",0);r.setAttribute("dy",s)}e.appendChild(r)}));jO.text=r}}else{u=FA(n,i);if(u!==jO.text){e.textContent=u;jO.text=u}}_O(e,"font-family",EA(n));_O(e,"font-size",yA(n)+"px");_O(e,"font-style",n.fontStyle);_O(e,"font-variant",n.fontVariant);_O(e,"font-weight",n.fontWeight)}};function MO(t,e,n){if(e===jO[t])return;if(n){NO($O,t,e,n)}else{_O($O,t,e)}jO[t]=e}function BO(t,e,n){if(n!==jO[e]){if(n==null){t.style.removeProperty(e)}else{t.style.setProperty(e,n+"")}jO[e]=n}}function SO(t,e){for(const n in e){_O(t,n,e[n])}}function _O(t,e,n){if(n!=null){t.setAttribute(e,n)}else{t.removeAttribute(e)}}function NO(t,e,n,i){if(n!=null){t.setAttributeNS(i,e,n)}else{t.removeAttributeNS(i,e)}}function zO(){let t;return typeof window==="undefined"?"":(t=window.location).hash?t.href.slice(0,-t.hash.length):t.href}function TO(t){ux.call(this,t);this._text=null;this._defs={gradient:{},clipping:{}}}fn(TO,ux,{svg(){return this._text},_render(t){const e=lO();e.open("svg",tn({},Lw,{class:"marks",width:this._width*this._scale,height:this._height*this._scale,viewBox:`0 0 ${this._width} ${this._height}`}));const n=this._bgcolor;if(n&&n!=="transparent"&&n!=="none"){e.open("rect",{width:this._width,height:this._height,fill:n}).close()}e.open("g",gO,{transform:"translate("+this._origin+")"});this.mark(e,t);e.close();this.defs(e);this._text=e.close()+"";return this},mark(t,e){const n=IA[e.marktype],i=n.tag,r=[Kx,n.attr];t.open("g",{class:tx(e),"clip-path":e.clip?sy(this,e,e.group):null},tO(e),{"pointer-events":i!=="g"&&e.interactive===false?"none":null});const u=u=>{const o=this.href(u);if(o)t.open("a",o);t.open(i,this.attr(e,u,r,i!=="g"?i:null));if(i==="text"){const e=xA(u);if(ve(e)){const n={x:0,dy:wA(u)};for(let i=0;i<e.length;++i){t.open("tspan",i?n:null).text(FA(u,e[i])).close()}}else{t.text(FA(u,e))}}else if(i==="g"){const i=u.strokeForeground,r=u.fill,o=u.stroke;if(i&&o){u.stroke=null}t.open("path",this.attr(e,u,n.background,"bgrect")).close();t.open("g",this.attr(e,u,n.content));ew(u,(e=>this.mark(t,e)));t.close();if(i&&o){if(r)u.fill=null;u.stroke=o;t.open("path",this.attr(e,u,n.foreground,"bgrect")).close();if(r)u.fill=r}else{t.open("path",this.attr(e,u,n.foreground,"bgfore")).close()}}t.close();if(o)t.close()};if(n.nested){if(e.items&&e.items.length)u(e.items[0])}else{ew(e,u)}return t.close()},href(t){const e=t.href;let n;if(e){if(n=this._hrefs&&this._hrefs[e]){return n}else{this.sanitizeURL(e).then((t=>{t["xlink:href"]=t.href;t.href=null;(this._hrefs||(this._hrefs={}))[e]=t}))}}return null},attr(t,e,n,i){const r={},u=(t,e,n,i)=>{r[i||t]=e};if(Array.isArray(n)){n.forEach((t=>t(u,e,this)))}else{n(u,e,this)}if(i){PO(r,e,t,i,this._defs)}return r},defs(t){const e=this._defs.gradient,n=this._defs.clipping,i=Object.keys(e).length+Object.keys(n).length;if(i===0)return;t.open("defs");for(const r in e){const n=e[r],i=n.stops;if(n.gradient==="radial"){t.open("pattern",{id:Nb+r,viewBox:"0,0,1,1",width:"100%",height:"100%",preserveAspectRatio:"xMidYMid slice"});t.open("rect",{width:"1",height:"1",fill:"url(#"+r+")"}).close();t.close();t.open("radialGradient",{id:r,fx:n.x1,fy:n.y1,fr:n.r1,cx:n.x2,cy:n.y2,r:n.r2})}else{t.open("linearGradient",{id:r,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2})}for(let e=0;e<i.length;++e){t.open("stop",{offset:i[e].offset,"stop-color":i[e].color}).close()}t.close()}for(const r in n){const e=n[r];t.open("clipPath",{id:r});if(e.path){t.open("path",{d:e.path}).close()}else{t.open("rect",{x:0,y:0,width:e.width,height:e.height}).close()}t.close()}t.close()}});function PO(t,e,n,i,r){let u;if(e==null)return t;if(i==="bgrect"&&n.interactive===false){t["pointer-events"]="none"}if(i==="bgfore"){if(n.interactive===false){t["pointer-events"]="none"}t.display="none";if(e.fill!==null)return t}if(i==="image"&&e.smooth===false){u=["image-rendering: optimizeSpeed;","image-rendering: pixelated;"]}if(i==="text"){t["font-family"]=EA(e);t["font-size"]=yA(e)+"px";t["font-style"]=e.fontStyle;t["font-variant"]=e.fontVariant;t["font-weight"]=e.fontWeight}for(const o in pO){let n=e[o];const i=pO[o];if(n==="transparent"&&(i==="fill"||i==="stroke"));else if(n!=null){if(zb(n)){n=Tb(n,r.gradient,"")}t[i]=n}}for(const o in mO){const t=e[o];if(t!=null){u=u||[];u.push(`${mO[o]}: ${t};`)}}if(u){t.style=u.join(" ")}return t}const LO="canvas";const IO="png";const RO="svg";const qO="none";const UO={Canvas:LO,PNG:IO,SVG:RO,None:qO};const WO={};WO[LO]=WO[IO]={renderer:Tx,headless:Tx,handler:$x};WO[RO]={renderer:wO,headless:TO,handler:Rx};WO[qO]={};function GO(t,e){t=String(t||"").toLowerCase();if(arguments.length>1){WO[t]=e;return this}else{return WO[t]}}function HO(t,e,n){const i=[],r=(new ay).union(e),u=t.marktype;return u?VO(t,r,n,i):u==="group"?XO(t,r,n,i):ne("Intersect scene must be mark node or group item.")}function VO(t,e,n,i){if(YO(t,e,n)){const r=t.items,u=t.marktype,o=r.length;let s=0;if(u==="group"){for(;s<o;++s){XO(r[s],e,n,i)}}else{for(const t=IA[u].isect;s<o;++s){const n=r[s];if(JO(n,e,t))i.push(n)}}}return i}function YO(t,e,n){return t.bounds&&e.intersects(t.bounds)&&(t.marktype==="group"||t.interactive!==false&&(!n||n(t)))}function XO(t,e,n,i){if(n&&n(t.mark)&&JO(t,e,IA.group.isect)){i.push(t)}const r=t.items,u=r&&r.length;if(u){const o=t.x||0,s=t.y||0;e.translate(-o,-s);for(let t=0;t<u;++t){VO(r[t],e,n,i)}e.translate(o,s)}return i}function JO(t,e,n){const i=t.bounds;return e.encloses(i)||e.intersects(i)&&n(t,e)}const QO=new ay;function ZO(t){const e=t.clip;if(Ge(e)){e(Sy(QO.clear()))}else if(e){QO.set(0,0,t.group.width,t.group.height)}else return;t.bounds.intersect(QO)}const KO=1e-9;function tF(t,e,n){return t===e?true:n==="path"?eF(t,e):t instanceof Date&&e instanceof Date?+t===+e:pn(t)&&pn(e)?Math.abs(t-e)<=KO:!t||!e||!ye(t)&&!ye(e)?t==e:nF(t,e)}function eF(t,e){return tF(Vb(t),Vb(e))}function nF(t,e){var n=Object.keys(t),i=Object.keys(e),r,u;if(n.length!==i.length)return false;n.sort();i.sort();for(u=n.length-1;u>=0;u--){if(n[u]!=i[u])return false}for(u=n.length-1;u>=0;u--){r=n[u];if(!tF(t[r],e[r],r))return false}return typeof t===typeof e}function iF(){oy();_b()}const rF="top";const uF="left";const oF="right";const sF="bottom";const aF="top-left";const fF="top-right";const cF="bottom-left";const lF="bottom-right";const dF="start";const hF="middle";const pF="end";const mF="x";const gF="y";const bF="group";const vF="axis";const yF="title";const wF="frame";const AF="scope";const xF="legend";const OF="row-header";const FF="row-footer";const DF="row-title";const kF="column-header";const EF="column-footer";const $F="column-title";const jF="padding";const CF="symbol";const MF="fit";const BF="fit-x";const SF="fit-y";const _F="pad";const NF="none";const zF="all";const TF="each";const PF="flush";const LF="column";const IF="row";function RF(t){Zf.call(this,null,t)}fn(RF,Zf,{transform(t,e){const n=e.dataflow,i=t.mark,r=i.marktype,u=IA[r],o=u.bound;let s=i.bounds,a;if(u.nested){if(i.items.length)n.dirty(i.items[0]);s=qF(i,o);i.items.forEach((t=>{t.bounds.clear().union(s)}))}else if(r===bF||t.modified()){e.visit(e.MOD,(t=>n.dirty(t)));s.clear();i.items.forEach((t=>s.union(qF(t,o))));switch(i.role){case vF:case xF:case yF:e.reflow()}}else{a=e.changed(e.REM);e.visit(e.ADD,(t=>{s.union(qF(t,o))}));e.visit(e.MOD,(t=>{a=a||s.alignsWith(t.bounds);n.dirty(t);s.union(qF(t,o))}));if(a){s.clear();i.items.forEach((t=>s.union(t.bounds)))}}ZO(i);return e.modifies("bounds")}});function qF(t,e,n){return e(t.bounds.clear(),t,n)}const UF=":vega_identifier:";function WF(t){Zf.call(this,0,t)}WF.Definition={type:"Identifier",metadata:{modifies:true},params:[{name:"as",type:"string",required:true}]};fn(WF,Zf,{transform(t,e){const n=GF(e.dataflow),i=t.as;let r=n.value;e.visit(e.ADD,(t=>t[i]=t[i]||++r));n.set(this.value=r);return e}});function GF(t){return t._signals[UF]||(t._signals[UF]=t.add(0))}function HF(t){Zf.call(this,null,t)}fn(HF,Zf,{transform(t,e){let n=this.value;if(!n){n=e.dataflow.scenegraph().mark(t.markdef,VF(t),t.index);n.group.context=t.context;if(!t.context.group)t.context.group=n.group;n.source=this.source;n.clip=t.clip;n.interactive=t.interactive;this.value=n}const i=n.marktype===bF?cy:fy;e.visit(e.ADD,(t=>i.call(t,n)));if(t.modified("clip")||t.modified("interactive")){n.clip=t.clip;n.interactive=!!t.interactive;n.zdirty=true;e.reflow()}n.items=e.source;return e}});function VF(t){const e=t.groups,n=t.parent;return e&&e.size===1?e.get(Object.keys(e.object)[0]):e&&n?e.lookup(n):null}function YF(t){Zf.call(this,null,t)}const XF={parity:t=>t.filter(((t,e)=>e%2?t.opacity=0:1)),greedy:(t,e)=>{let n;return t.filter(((t,i)=>!i||!JF(n.bounds,t.bounds,e)?(n=t,1):t.opacity=0))}};const JF=(t,e,n)=>n>Math.max(e.x1-t.x2,t.x1-e.x2,e.y1-t.y2,t.y1-e.y2);const QF=(t,e)=>{for(var n=1,i=t.length,r=t[0].bounds,u;n<i;r=u,++n){if(JF(r,u=t[n].bounds,e))return true}};const ZF=t=>{const e=t.bounds;return e.width()>1&&e.height()>1};const KF=(t,e,n)=>{var i=t.range(),r=new ay;if(e===rF||e===sF){r.set(i[0],-Infinity,i[1],+Infinity)}else{r.set(-Infinity,i[0],+Infinity,i[1])}r.expand(n||1);return t=>r.encloses(t.bounds)};const tD=t=>{t.forEach((t=>t.opacity=1));return t};const eD=(t,e)=>t.reflow(e.modified()).modifies("opacity");fn(YF,Zf,{transform(t,e){const n=XF[t.method]||XF.parity,i=t.separation||0;let r=e.materialize(e.SOURCE).source,u,o;if(!r||!r.length)return;if(!t.method){if(t.modified("method")){tD(r);e=eD(e,t)}return e}r=r.filter(ZF);if(!r.length)return;if(t.sort){r=r.slice().sort(t.sort)}u=tD(r);e=eD(e,t);if(u.length>=3&&QF(u,i)){do{u=n(u,i)}while(u.length>=3&&QF(u,i));if(u.length<3&&!Fe(r).opacity){if(u.length>1)Fe(u).opacity=0;Fe(r).opacity=1}}if(t.boundScale&&t.boundTolerance>=0){o=KF(t.boundScale,t.boundOrient,+t.boundTolerance);r.forEach((t=>{if(!o(t))t.opacity=0}))}const s=u[0].mark.bounds.clear();r.forEach((t=>{if(t.opacity)s.union(t.bounds)}));return e}});function nD(t){Zf.call(this,null,t)}fn(nD,Zf,{transform(t,e){const n=e.dataflow;e.visit(e.ALL,(t=>n.dirty(t)));if(e.fields&&e.fields["zindex"]){const t=e.source&&e.source[0];if(t)t.mark.zdirty=true}}});const iD=new ay;function rD(t,e,n){return t[e]===n?0:(t[e]=n,1)}function uD(t){var e=t.items[0].orient;return e===uF||e===oF}function oD(t){let e=+t.grid;return[t.ticks?e++:-1,t.labels?e++:-1,e+ +t.domain]}function sD(t,e,n,i){var r=e.items[0],u=r.datum,o=r.translate!=null?r.translate:.5,s=r.orient,a=oD(u),f=r.range,c=r.offset,l=r.position,d=r.minExtent,h=r.maxExtent,p=u.title&&r.items[a[2]].items[0],m=r.titlePadding,g=r.bounds,b=p&&OA(p),v=0,y=0,w,A;iD.clear().union(g);g.clear();if((w=a[0])>-1)g.union(r.items[w].bounds);if((w=a[1])>-1)g.union(r.items[w].bounds);switch(s){case rF:v=l||0;y=-c;A=Math.max(d,Math.min(h,-g.y1));g.add(0,-A).add(f,0);if(p)aD(t,p,A,m,b,0,-1,g);break;case uF:v=-c;y=l||0;A=Math.max(d,Math.min(h,-g.x1));g.add(-A,0).add(0,f);if(p)aD(t,p,A,m,b,1,-1,g);break;case oF:v=n+c;y=l||0;A=Math.max(d,Math.min(h,g.x2));g.add(0,0).add(A,f);if(p)aD(t,p,A,m,b,1,1,g);break;case sF:v=l||0;y=i+c;A=Math.max(d,Math.min(h,g.y2));g.add(0,0).add(f,A);if(p)aD(t,p,A,m,0,0,1,g);break;default:v=r.x;y=r.y}py(g.translate(v,y),r);if(rD(r,"x",v+o)|rD(r,"y",y+o)){r.bounds=iD;t.dirty(r);r.bounds=g;t.dirty(r)}return r.mark.bounds.clear().union(g)}function aD(t,e,n,i,r,u,o,s){const a=e.bounds;if(e.auto){const s=o*(n+r+i);let f=0,c=0;t.dirty(e);u?f=(e.x||0)-(e.x=s):c=(e.y||0)-(e.y=s);e.mark.bounds.clear().union(a.translate(-f,-c));t.dirty(e)}s.union(a)}const fD=(t,e)=>Math.floor(Math.min(t,e));const cD=(t,e)=>Math.ceil(Math.max(t,e));function lD(t){var e=t.items,n=e.length,i=0,r,u;const o={marks:[],rowheaders:[],rowfooters:[],colheaders:[],colfooters:[],rowtitle:null,coltitle:null};for(;i<n;++i){r=e[i];u=r.items;if(r.marktype===bF){switch(r.role){case vF:case xF:case yF:break;case OF:o.rowheaders.push(...u);break;case FF:o.rowfooters.push(...u);break;case kF:o.colheaders.push(...u);break;case EF:o.colfooters.push(...u);break;case DF:o.rowtitle=u[0];break;case $F:o.coltitle=u[0];break;default:o.marks.push(...u)}}}return o}function dD(t){return(new ay).set(0,0,t.width||0,t.height||0)}function hD(t){const e=t.bounds.clone();return e.empty()?e.set(0,0,0,0):e.translate(-(t.x||0),-(t.y||0))}function pD(t,e,n){const i=ye(t)?t[e]:t;return i!=null?i:n!==undefined?n:0}function mD(t){return t<0?Math.ceil(-t):0}function gD(t,e,n){var i=!n.nodirty,r=n.bounds===PF?dD:hD,u=iD.set(0,0,0,0),o=pD(n.align,LF),s=pD(n.align,IF),a=pD(n.padding,LF),f=pD(n.padding,IF),c=n.columns||e.length,l=c<=0?1:Math.ceil(e.length/c),d=e.length,h=Array(d),p=Array(c),m=0,g=Array(d),b=Array(l),v=0,y=Array(d),w=Array(d),A=Array(d),x,O,F,D,k,E,$,j,C,M,B;for(O=0;O<c;++O)p[O]=0;for(O=0;O<l;++O)b[O]=0;for(O=0;O<d;++O){E=e[O];k=A[O]=r(E);E.x=E.x||0;y[O]=0;E.y=E.y||0;w[O]=0;F=O%c;D=~~(O/c);m=Math.max(m,$=Math.ceil(k.x2));v=Math.max(v,j=Math.ceil(k.y2));p[F]=Math.max(p[F],$);b[D]=Math.max(b[D],j);h[O]=a+mD(k.x1);g[O]=f+mD(k.y1);if(i)t.dirty(e[O])}for(O=0;O<d;++O){if(O%c===0)h[O]=0;if(O<c)g[O]=0}if(o===TF){for(F=1;F<c;++F){for(B=0,O=F;O<d;O+=c){if(B<h[O])B=h[O]}for(O=F;O<d;O+=c){h[O]=B+p[F-1]}}}else if(o===zF){for(B=0,O=0;O<d;++O){if(O%c&&B<h[O])B=h[O]}for(O=0;O<d;++O){if(O%c)h[O]=B+m}}else{for(o=false,F=1;F<c;++F){for(O=F;O<d;O+=c){h[O]+=p[F-1]}}}if(s===TF){for(D=1;D<l;++D){for(B=0,O=D*c,x=O+c;O<x;++O){if(B<g[O])B=g[O]}for(O=D*c;O<x;++O){g[O]=B+b[D-1]}}}else if(s===zF){for(B=0,O=c;O<d;++O){if(B<g[O])B=g[O]}for(O=c;O<d;++O){g[O]=B+v}}else{for(s=false,D=1;D<l;++D){for(O=D*c,x=O+c;O<x;++O){g[O]+=b[D-1]}}}for(C=0,O=0;O<d;++O){C=h[O]+(O%c?C:0);y[O]+=C-e[O].x}for(F=0;F<c;++F){for(M=0,O=F;O<d;O+=c){M+=g[O];w[O]+=M-e[O].y}}if(o&&pD(n.center,LF)&&l>1){for(O=0;O<d;++O){k=o===zF?m:p[O%c];C=k-A[O].x2-e[O].x-y[O];if(C>0)y[O]+=C/2}}if(s&&pD(n.center,IF)&&c!==1){for(O=0;O<d;++O){k=s===zF?v:b[~~(O/c)];M=k-A[O].y2-e[O].y-w[O];if(M>0)w[O]+=M/2}}for(O=0;O<d;++O){u.union(A[O].translate(y[O],w[O]))}C=pD(n.anchor,mF);M=pD(n.anchor,gF);switch(pD(n.anchor,LF)){case pF:C-=u.width();break;case hF:C-=u.width()/2}switch(pD(n.anchor,IF)){case pF:M-=u.height();break;case hF:M-=u.height()/2}C=Math.round(C);M=Math.round(M);u.clear();for(O=0;O<d;++O){e[O].mark.bounds.clear()}for(O=0;O<d;++O){E=e[O];E.x+=y[O]+=C;E.y+=w[O]+=M;u.union(E.mark.bounds.union(E.bounds.translate(y[O],w[O])));if(i)t.dirty(E)}return u}function bD(t,e,n){var i=lD(e),r=i.marks,u=n.bounds===PF?vD:yD,o=n.offset,s=n.columns||r.length,a=s<=0?1:Math.ceil(r.length/s),f=a*s,c,l,d,h,p,m,g;const b=gD(t,r,n);if(b.empty())b.set(0,0,0,0);if(i.rowheaders){m=pD(n.headerBand,IF,null);c=wD(t,i.rowheaders,r,s,a,-pD(o,"rowHeader"),fD,0,u,"x1",0,s,1,m)}if(i.colheaders){m=pD(n.headerBand,LF,null);l=wD(t,i.colheaders,r,s,s,-pD(o,"columnHeader"),fD,1,u,"y1",0,1,s,m)}if(i.rowfooters){m=pD(n.footerBand,IF,null);d=wD(t,i.rowfooters,r,s,a,pD(o,"rowFooter"),cD,0,u,"x2",s-1,s,1,m)}if(i.colfooters){m=pD(n.footerBand,LF,null);h=wD(t,i.colfooters,r,s,s,pD(o,"columnFooter"),cD,1,u,"y2",f-s,1,s,m)}if(i.rowtitle){p=pD(n.titleAnchor,IF);g=pD(o,"rowTitle");g=p===pF?d+g:c-g;m=pD(n.titleBand,IF,.5);AD(t,i.rowtitle,g,0,b,m)}if(i.coltitle){p=pD(n.titleAnchor,LF);g=pD(o,"columnTitle");g=p===pF?h+g:l-g;m=pD(n.titleBand,LF,.5);AD(t,i.coltitle,g,1,b,m)}}function vD(t,e){return e==="x1"?t.x||0:e==="y1"?t.y||0:e==="x2"?(t.x||0)+(t.width||0):e==="y2"?(t.y||0)+(t.height||0):undefined}function yD(t,e){return t.bounds[e]}function wD(t,e,n,i,r,u,o,s,a,f,c,l,d,h){var p=n.length,m=0,g=0,b,v,y,w,A,x,O,F,D;if(!p)return m;for(b=c;b<p;b+=l){if(n[b])m=o(m,a(n[b],f))}if(!e.length)return m;if(e.length>r){t.warn("Grid headers exceed limit: "+r);e=e.slice(0,r)}m+=u;for(v=0,w=e.length;v<w;++v){t.dirty(e[v]);e[v].mark.bounds.clear()}for(b=c,v=0,w=e.length;v<w;++v,b+=l){x=e[v];A=x.mark.bounds;for(y=b;y>=0&&(O=n[y])==null;y-=d);if(s){F=h==null?O.x:Math.round(O.bounds.x1+h*O.bounds.width());D=m}else{F=m;D=h==null?O.y:Math.round(O.bounds.y1+h*O.bounds.height())}A.union(x.bounds.translate(F-(x.x||0),D-(x.y||0)));x.x=F;x.y=D;t.dirty(x);g=o(g,A[f])}return g}function AD(t,e,n,i,r,u){if(!e)return;t.dirty(e);var o=n,s=n;i?o=Math.round(r.x1+u*r.width()):s=Math.round(r.y1+u*r.height());e.bounds.translate(o-(e.x||0),s-(e.y||0));e.mark.bounds.clear().union(e.bounds);e.x=o;e.y=s;t.dirty(e)}function xD(t,e){const n=t[e]||{};return(e,i)=>n[e]!=null?n[e]:t[e]!=null?t[e]:i}function OD(t,e){let n=-Infinity;t.forEach((t=>{if(t.offset!=null)n=Math.max(n,t.offset)}));return n>-Infinity?n:e}function FD(t,e,n,i,r,u,o){const s=xD(n,e),a=OD(t,s("offset",0)),f=s("anchor",dF),c=f===pF?1:f===hF?.5:0;const l={align:TF,bounds:s("bounds",PF),columns:s("direction")==="vertical"?1:t.length,padding:s("margin",8),center:s("center"),nodirty:true};switch(e){case uF:l.anchor={x:Math.floor(i.x1)-a,column:pF,y:c*(o||i.height()+2*i.y1),row:f};break;case oF:l.anchor={x:Math.ceil(i.x2)+a,y:c*(o||i.height()+2*i.y1),row:f};break;case rF:l.anchor={y:Math.floor(r.y1)-a,row:pF,x:c*(u||r.width()+2*r.x1),column:f};break;case sF:l.anchor={y:Math.ceil(r.y2)+a,x:c*(u||r.width()+2*r.x1),column:f};break;case aF:l.anchor={x:a,y:a};break;case fF:l.anchor={x:u-a,y:a,column:pF};break;case cF:l.anchor={x:a,y:o-a,row:pF};break;case lF:l.anchor={x:u-a,y:o-a,column:pF,row:pF};break}return l}function DD(t,e){var n=e.items[0],i=n.datum,r=n.orient,u=n.bounds,o=n.x,s=n.y,a,f;n._bounds?n._bounds.clear().union(u):n._bounds=u.clone();u.clear();ED(t,n,n.items[0].items[0]);u=kD(n,u);a=2*n.padding;f=2*n.padding;if(!u.empty()){a=Math.ceil(u.width()+a);f=Math.ceil(u.height()+f)}if(i.type===CF){CD(n.items[0].items[0].items[0].items)}if(r!==NF){n.x=o=0;n.y=s=0}n.width=a;n.height=f;py(u.set(o,s,o+a,s+f),n);n.mark.bounds.clear().union(u);return n}function kD(t,e){t.items.forEach((t=>e.union(t.bounds)));e.x1=t.padding;e.y1=t.padding;return e}function ED(t,e,n){var i=e.padding,r=i-n.x,u=i-n.y;if(!e.datum.title){if(r||u)jD(t,n,r,u)}else{var o=e.items[1].items[0],s=o.anchor,a=e.titlePadding||0,f=i-o.x,c=i-o.y;switch(o.orient){case uF:r+=Math.ceil(o.bounds.width())+a;break;case oF:case sF:break;default:u+=o.bounds.height()+a}if(r||u)jD(t,n,r,u);switch(o.orient){case uF:c+=$D(e,n,o,s,1,1);break;case oF:f+=$D(e,n,o,pF,0,0)+a;c+=$D(e,n,o,s,1,1);break;case sF:f+=$D(e,n,o,s,0,0);c+=$D(e,n,o,pF,-1,0,1)+a;break;default:f+=$D(e,n,o,s,0,0)}if(f||c)jD(t,o,f,c);if((f=Math.round(o.bounds.x1-i))<0){jD(t,n,-f,0);jD(t,o,-f,0)}}}function $D(t,e,n,i,r,u,o){const s=t.datum.type!=="symbol",a=n.datum.vgrad,f=s&&(u||!a)&&!o?e.items[0]:e,c=f.bounds[r?"y2":"x2"]-t.padding,l=a&&u?c:0,d=a&&u?0:c,h=r<=0?0:OA(n);return Math.round(i===dF?l:i===pF?d-h:.5*(c-h))}function jD(t,e,n,i){e.x+=n;e.y+=i;e.bounds.translate(n,i);e.mark.bounds.translate(n,i);t.dirty(e)}function CD(t){const e=t.reduce(((t,e)=>{t[e.column]=Math.max(e.bounds.x2-e.x,t[e.column]||0);return t}),{});t.forEach((t=>{t.width=e[t.column];t.height=t.bounds.y2-t.y}))}function MD(t,e,n,i,r){var u=e.items[0],o=u.frame,s=u.orient,a=u.anchor,f=u.offset,c=u.padding,l=u.items[0].items[0],d=u.items[1]&&u.items[1].items[0],h=s===uF||s===oF?i:n,p=0,m=0,g=0,b=0,v=0,y;if(o!==bF){s===uF?(p=r.y2,h=r.y1):s===oF?(p=r.y1,h=r.y2):(p=r.x1,h=r.x2)}else if(s===uF){p=i,h=0}y=a===dF?p:a===pF?h:(p+h)/2;if(d&&d.text){switch(s){case rF:case sF:v=l.bounds.height()+c;break;case uF:b=l.bounds.width()+c;break;case oF:b=-l.bounds.width()-c;break}iD.clear().union(d.bounds);iD.translate(b-(d.x||0),v-(d.y||0));if(rD(d,"x",b)|rD(d,"y",v)){t.dirty(d);d.bounds.clear().union(iD);d.mark.bounds.clear().union(iD);t.dirty(d)}iD.clear().union(d.bounds)}else{iD.clear()}iD.union(l.bounds);switch(s){case rF:m=y;g=r.y1-iD.height()-f;break;case uF:m=r.x1-iD.width()-f;g=y;break;case oF:m=r.x2+iD.width()+f;g=y;break;case sF:m=y;g=r.y2+f;break;default:m=u.x;g=u.y}if(rD(u,"x",m)|rD(u,"y",g)){iD.translate(m,g);t.dirty(u);u.bounds.clear().union(iD);e.bounds.clear().union(iD);t.dirty(u)}return u.bounds}function BD(t){Zf.call(this,null,t)}fn(BD,Zf,{transform(t,e){const n=e.dataflow;t.mark.items.forEach((e=>{if(t.layout)bD(n,e,t.layout);_D(n,e,t)}));return SD(t.mark.group)?e.reflow():e}});function SD(t){return t&&t.mark.role!=="legend-entry"}function _D(t,e,n){var i=e.items,r=Math.max(0,e.width||0),u=Math.max(0,e.height||0),o=(new ay).set(0,0,r,u),s=o.clone(),a=o.clone(),f=[],c,l,d,h,p,m;for(p=0,m=i.length;p<m;++p){l=i[p];switch(l.role){case vF:h=uD(l)?s:a;h.union(sD(t,l,r,u));break;case yF:c=l;break;case xF:f.push(DD(t,l));break;case wF:case AF:case OF:case FF:case DF:case kF:case EF:case $F:s.union(l.bounds);a.union(l.bounds);break;default:o.union(l.bounds)}}if(f.length){const e={};f.forEach((t=>{d=t.orient||oF;if(d!==NF)(e[d]||(e[d]=[])).push(t)}));for(const i in e){const o=e[i];gD(t,o,FD(o,i,n.legends,s,a,r,u))}f.forEach((e=>{const i=e.bounds;if(!i.equals(e._bounds)){e.bounds=e._bounds;t.dirty(e);e.bounds=i;t.dirty(e)}if(n.autosize&&(n.autosize.type===MF||n.autosize.type===BF||n.autosize.type===SF)){switch(e.orient){case uF:case oF:o.add(i.x1,0).add(i.x2,0);break;case rF:case sF:o.add(0,i.y1).add(0,i.y2)}}else{o.union(i)}}))}o.union(s).union(a);if(c){o.union(MD(t,c,r,u,o))}if(e.clip){o.set(0,0,e.width||0,e.height||0)}ND(t,e,o,n)}function ND(t,e,n,i){const r=i.autosize||{},u=r.type;if(t._autosize<1||!u)return;let o=t._width,s=t._height,a=Math.max(0,e.width||0),f=Math.max(0,Math.ceil(-n.x1)),c=Math.max(0,e.height||0),l=Math.max(0,Math.ceil(-n.y1));const d=Math.max(0,Math.ceil(n.x2-a)),h=Math.max(0,Math.ceil(n.y2-c));if(r.contains===jF){const e=t.padding();o-=e.left+e.right;s-=e.top+e.bottom}if(u===NF){f=0;l=0;a=o;c=s}else if(u===MF){a=Math.max(0,o-f-d);c=Math.max(0,s-l-h)}else if(u===BF){a=Math.max(0,o-f-d);s=c+l+h}else if(u===SF){o=a+f+d;c=Math.max(0,s-l-h)}else if(u===_F){o=a+f+d;s=c+l+h}t._resizeView(o,s,a,c,[f,l],r.resize)}const zD=Object.freeze({__proto__:null,bound:RF,identifier:WF,mark:HF,overlap:YF,render:nD,viewlayout:BD});function TD(t){Zf.call(this,null,t)}fn(TD,Zf,{transform(t,e){if(this.value&&!t.modified()){return e.StopPropagation}var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,u=t.scale,o=t.count==null?t.values?t.values.length:10:t.count,s=db(u,o,t.minstep),a=t.format||mb(n,u,s,t.formatSpecifier,t.formatType,!!t.values),f=t.values?hb(u,t.values,s):pb(u,s);if(r)i.rem=r;r=f.map(((t,e)=>Pa({index:e/(f.length-1||1),value:t,label:a(t)})));if(t.extra&&r.length){r.push(Pa({index:-1,extra:{value:r[0].value},label:""}))}i.source=r;i.add=r;this.value=r;return i}});function PD(t){Zf.call(this,null,t)}function LD(){return Pa({})}function ID(t){const e=sn().test((t=>t.exit));e.lookup=n=>e.get(t(n));return e}fn(PD,Zf,{transform(t,e){var n=e.dataflow,i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=t.item||LD,u=t.key||za,o=this.value;if(ve(i.encode)){i.encode=null}if(o&&(t.modified("key")||e.modified(u))){ne("DataJoin does not support modified key function or fields.")}if(!o){e=e.addAll();this.value=o=ID(u)}e.visit(e.ADD,(t=>{const e=u(t);let n=o.get(e);if(n){if(n.exit){o.empty--;i.add.push(n)}else{i.mod.push(n)}}else{n=r(t);o.set(e,n);i.add.push(n)}n.datum=t;n.exit=false}));e.visit(e.MOD,(t=>{const e=u(t),n=o.get(e);if(n){n.datum=t;i.mod.push(n)}}));e.visit(e.REM,(t=>{const e=u(t),n=o.get(e);if(t===n.datum&&!n.exit){i.rem.push(n);n.exit=true;++o.empty}}));if(e.changed(e.ADD_MOD))i.modifies("datum");if(e.clean()||t.clean&&o.empty>n.cleanThreshold){n.runAfter(o.clean)}return i}});function RD(t){Zf.call(this,null,t)}fn(RD,Zf,{transform(t,e){var n=e.fork(e.ADD_REM),i=t.mod||false,r=t.encoders,u=e.encode;if(ve(u)){if(n.changed()||u.every((t=>r[t]))){u=u[0];n.encode=null}else{return e.StopPropagation}}var o=u==="enter",s=r.update||ce,a=r.enter||ce,f=r.exit||ce,c=(u&&!o?r[u]:s)||ce;if(e.changed(e.ADD)){e.visit(e.ADD,(e=>{a(e,t);s(e,t)}));n.modifies(a.output);n.modifies(s.output);if(c!==ce&&c!==s){e.visit(e.ADD,(e=>{c(e,t)}));n.modifies(c.output)}}if(e.changed(e.REM)&&f!==ce){e.visit(e.REM,(e=>{f(e,t)}));n.modifies(f.output)}if(o||c!==ce){const r=e.MOD|(t.modified()?e.REFLOW:0);if(o){e.visit(r,(e=>{const r=a(e,t)||i;if(c(e,t)||r)n.mod.push(e)}));if(n.mod.length)n.modifies(a.output)}else{e.visit(r,(e=>{if(c(e,t)||i)n.mod.push(e)}))}if(n.mod.length)n.modifies(c.output)}return n.changed()?n:e.StopPropagation}});function qD(t){Zf.call(this,[],t)}fn(qD,Zf,{transform(t,e){if(this.value!=null&&!t.modified()){return e.StopPropagation}var n=e.dataflow.locale(),i=e.fork(e.NO_SOURCE|e.NO_FIELDS),r=this.value,u=t.type||ob,o=t.scale,s=+t.limit,a=db(o,t.count==null?5:t.count,t.minstep),f=!!t.values||u===ob,c=t.format||Fb(n,o,a,u,t.formatSpecifier,t.formatType,f),l=t.values||yb(o,a),d,h,p,m,g;if(r)i.rem=r;if(u===ob){if(s&&l.length>s){e.dataflow.warn("Symbol legend count exceeds limit, filtering items.");r=l.slice(0,s-1);g=true}else{r=l}if(Ge(p=t.size)){if(!t.values&&o(r[0])===0){r=r.slice(1)}m=r.reduce(((e,n)=>Math.max(e,p(n,t))),0)}else{p=Ze(m=p||8)}r=r.map(((e,n)=>Pa({index:n,label:c(e,n,r),value:e,offset:m,size:p(e,t)})));if(g){g=l[r.length];r.push(Pa({index:r.length,label:`…${l.length-r.length} entries`,value:g,offset:m,size:p(g,t)}))}}else if(u===ab){d=o.domain(),h=Qg(o,d[0],Fe(d));if(l.length<3&&!t.values&&d[0]!==Fe(d)){l=[d[0],Fe(d)]}r=l.map(((t,e)=>Pa({index:e,label:c(t,e,l),value:t,perc:h(t)})))}else{p=l.length-1;h=Cb(o);r=l.map(((t,e)=>Pa({index:e,label:c(t,e,l),value:t,perc:e?h(t):0,perc2:e===p?1:h(l[e+1])})))}i.source=r;i.add=r;this.value=r;return i}});const UD=t=>t.source.x;const WD=t=>t.source.y;const GD=t=>t.target.x;const HD=t=>t.target.y;function VD(t){Zf.call(this,{},t)}VD.Definition={type:"LinkPath",metadata:{modifies:true},params:[{name:"sourceX",type:"field",default:"source.x"},{name:"sourceY",type:"field",default:"source.y"},{name:"targetX",type:"field",default:"target.x"},{name:"targetY",type:"field",default:"target.y"},{name:"orient",type:"enum",default:"vertical",values:["horizontal","vertical","radial"]},{name:"shape",type:"enum",default:"line",values:["line","arc","curve","diagonal","orthogonal"]},{name:"require",type:"signal"},{name:"as",type:"string",default:"path"}]};fn(VD,Zf,{transform(t,e){var n=t.sourceX||UD,i=t.sourceY||WD,r=t.targetX||GD,u=t.targetY||HD,o=t.as||"path",s=t.orient||"vertical",a=t.shape||"line",f=ok.get(a+"-"+s)||ok.get(a);if(!f){ne("LinkPath unsupported type: "+t.shape+(t.orient?"-"+t.orient:""))}e.visit(e.SOURCE,(t=>{t[o]=f(n(t),i(t),r(t),u(t))}));return e.reflow(t.modified()).modifies(o)}});const YD=(t,e,n,i)=>"M"+t+","+e+"L"+n+","+i;const XD=(t,e,n,i)=>YD(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n));const JD=(t,e,n,i)=>{var r=n-t,u=i-e,o=Math.hypot(r,u)/2,s=180*Math.atan2(u,r)/Math.PI;return"M"+t+","+e+"A"+o+","+o+" "+s+" 0 1"+" "+n+","+i};const QD=(t,e,n,i)=>JD(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n));const ZD=(t,e,n,i)=>{const r=n-t,u=i-e,o=.2*(r+u),s=.2*(u-r);return"M"+t+","+e+"C"+(t+o)+","+(e+s)+" "+(n+s)+","+(i-o)+" "+n+","+i};const KD=(t,e,n,i)=>ZD(e*Math.cos(t),e*Math.sin(t),i*Math.cos(n),i*Math.sin(n));const tk=(t,e,n,i)=>"M"+t+","+e+"V"+i+"H"+n;const ek=(t,e,n,i)=>"M"+t+","+e+"H"+n+"V"+i;const nk=(t,e,n,i)=>{const r=Math.cos(t),u=Math.sin(t),o=Math.cos(n),s=Math.sin(n),a=Math.abs(n-t)>Math.PI?n<=t:n>t;return"M"+e*r+","+e*u+"A"+e+","+e+" 0 0,"+(a?1:0)+" "+e*o+","+e*s+"L"+i*o+","+i*s};const ik=(t,e,n,i)=>{const r=(t+n)/2;return"M"+t+","+e+"C"+r+","+e+" "+r+","+i+" "+n+","+i};const rk=(t,e,n,i)=>{const r=(e+i)/2;return"M"+t+","+e+"C"+t+","+r+" "+n+","+r+" "+n+","+i};const uk=(t,e,n,i)=>{const r=Math.cos(t),u=Math.sin(t),o=Math.cos(n),s=Math.sin(n),a=(e+i)/2;return"M"+e*r+","+e*u+"C"+a*r+","+a*u+" "+a*o+","+a*s+" "+i*o+","+i*s};const ok=sn({line:YD,"line-radial":XD,arc:JD,"arc-radial":QD,curve:ZD,"curve-radial":KD,"orthogonal-horizontal":tk,"orthogonal-vertical":ek,"orthogonal-radial":nk,"diagonal-horizontal":ik,"diagonal-vertical":rk,"diagonal-radial":uk});function sk(t){Zf.call(this,null,t)}sk.Definition={type:"Pie",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"startAngle",type:"number",default:0},{name:"endAngle",type:"number",default:6.283185307179586},{name:"sort",type:"boolean",default:false},{name:"as",type:"string",array:true,length:2,default:["startAngle","endAngle"]}]};fn(sk,Zf,{transform(t,e){var n=t.as||["startAngle","endAngle"],i=n[0],r=n[1],u=t.field||ae,o=t.startAngle||0,s=t.endAngle!=null?t.endAngle:2*Math.PI,a=e.source,f=a.map(u),c=f.length,l=o,d=(s-o)/Ii(f),h=Li(c),p,m,g;if(t.sort){h.sort(((t,e)=>f[t]-f[e]))}for(p=0;p<c;++p){g=f[h[p]];m=a[h[p]];m[i]=l;m[r]=l+=g*d}this.value=f;return e.reflow(t.modified()).modifies(n)}});const ak=5;function fk(t){const e=t.type;return!t.bins&&(e===ng||e===rg||e===ug)}function ck(t){return Ig(t)&&t!==fg}const lk=Cn(["set","modified","clear","type","scheme","schemeExtent","schemeCount","domain","domainMin","domainMid","domainMax","domainRaw","domainImplicit","nice","zero","bins","range","rangeStep","round","reverse","interpolate","interpolateGamma"]);function dk(t){Zf.call(this,null,t);this.modified(true)}fn(dk,Zf,{transform(t,e){var n=e.dataflow,i=this.value,r=hk(t);if(!i||r!==i.type){this.value=i=Tg(r)()}for(r in t)if(!lk[r]){if(r==="padding"&&ck(i.type))continue;Ge(i[r])?i[r](t[r]):n.warn("Unsupported scale property: "+r)}wk(i,t,yk(i,t,mk(i,t,n)));return e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function hk(t){var e=t.type,n="",i;if(e===fg)return fg+"-"+ng;if(pk(t)){i=t.rawDomain?t.rawDomain.length:t.domain?t.domain.length+ +(t.domainMid!=null):0;n=i===2?fg+"-":i===3?cg+"-":""}return(n+e||ng).toLowerCase()}function pk(t){const e=t.type;return Ig(e)&&e!==sg&&e!==ag&&(t.scheme||t.range&&t.range.length&&t.range.every(gn))}function mk(t,e,n){const i=gk(t,e.domainRaw,n);if(i>-1)return i;var r=e.domain,u=t.type,o=e.zero||e.zero===undefined&&fk(t),s,a;if(!r)return 0;if(ck(u)&&e.padding&&r[0]!==Fe(r)){r=bk(u,r,e.range,e.padding,e.exponent,e.constant)}if(o||e.domainMin!=null||e.domainMax!=null||e.domainMid!=null){s=(r=r.slice()).length-1||1;if(o){if(r[0]>0)r[0]=0;if(r[s]<0)r[s]=0}if(e.domainMin!=null)r[0]=e.domainMin;if(e.domainMax!=null)r[s]=e.domainMax;if(e.domainMid!=null){a=e.domainMid;const t=a>r[s]?s+1:a<r[0]?0:s;if(t!==s)n.warn("Scale domainMid exceeds domain min or max.",a);r.splice(t,0,a)}}t.domain(vk(u,r,n));if(u===pg){t.unknown(e.domainImplicit?Yh:undefined)}if(e.nice&&t.nice){t.nice(e.nice!==true&&db(t,e.nice)||null)}return r.length}function gk(t,e,n){if(e){t.domain(vk(t.type,e,n));return e.length}else{return-1}}function bk(t,e,n,i,r,u){var o=Math.abs(Fe(n)-n[0]),s=o/(o-2*i),a=t===ig?Pe(e,null,s):t===ug?Le(e,null,s,.5):t===rg?Le(e,null,s,r||1):t===og?Ie(e,null,s,u||1):Te(e,null,s);e=e.slice();e[0]=a[0];e[e.length-1]=a[1];return e}function vk(t,e,n){if(Ug(t)){var i=Math.abs(e.reduce(((t,e)=>t+(e<0?-1:e>0?1:0)),0));if(i!==e.length){n.warn("Log scale domain includes zero: "+Dn(e))}}return e}function yk(t,e,n){let i=e.bins;if(i&&!ve(i)){const e=t.domain(),n=e[0],r=Fe(e),u=i.step;let o=i.start==null?n:i.start,s=i.stop==null?r:i.stop;if(!u)ne("Scale bins parameter missing step property.");if(o<n)o=u*Math.ceil(n/u);if(s>r)s=u*Math.floor(r/u);i=Li(o,s+u/2,u)}if(i){t.bins=i}else if(t.bins){delete t.bins}if(t.type===bg){if(!i){t.bins=t.domain()}else if(!e.domain&&!e.domainRaw){t.domain(i);n=i.length}}return n}function wk(t,e,n){var i=t.type,r=e.round||false,u=e.range;if(e.rangeStep!=null){u=Ak(i,e,n)}else if(e.scheme){u=xk(i,e,n);if(Ge(u)){if(t.interpolator){return t.interpolator(u)}else{ne(`Scale type ${i} does not support interpolating color schemes.`)}}}if(u&&Gg(i)){return t.interpolator(Xg(Fk(u,e.reverse),e.interpolate,e.interpolateGamma))}if(u&&e.interpolate&&t.interpolate){t.interpolate(Zg(e.interpolate,e.interpolateGamma))}else if(Ge(t.round)){t.round(r)}else if(Ge(t.rangeRound)){t.interpolate(r?Tp:_p)}if(u)t.range(Fk(u,e.reverse))}function Ak(t,e,n){if(t!==gg&&t!==mg){ne("Only band and point scales support rangeStep.")}var i=(e.paddingOuter!=null?e.paddingOuter:e.padding)||0,r=t===mg?1:(e.paddingInner!=null?e.paddingInner:e.padding)||0;return[0,e.rangeStep*tg(n,r,i)]}function xk(t,e,n){var i=e.schemeExtent,r,u;if(ve(e.scheme)){u=Xg(e.scheme,e.interpolate,e.interpolateGamma)}else{r=e.scheme.toLowerCase();u=ub(r);if(!u)ne(`Unrecognized scheme name: ${e.scheme}`)}n=t===hg?n+1:t===bg?n-1:t===lg||t===dg?+e.schemeCount||ak:n;return Gg(t)?Ok(u,i,e.reverse):Ge(u)?Jg(Ok(u,i),n):t===pg?u:u.slice(0,n)}function Ok(t,e,n){return Ge(t)&&(e||n)?Yg(t,Fk(e||[0,1],n)):t}function Fk(t,e){return e?t.slice().reverse():t}function Dk(t){Zf.call(this,null,t)}fn(Dk,Zf,{transform(t,e){const n=t.modified("sort")||e.changed(e.ADD)||e.modified(t.sort.fields)||e.modified("datum");if(n)e.source.sort(qa(t.sort));this.modified(n);return e}});const kk="zero",Ek="center",$k="normalize",jk=["y0","y1"];function Ck(t){Zf.call(this,null,t)}Ck.Definition={type:"Stack",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"groupby",type:"field",array:true},{name:"sort",type:"compare"},{name:"offset",type:"enum",default:kk,values:[kk,Ek,$k]},{name:"as",type:"string",array:true,length:2,default:jk}]};fn(Ck,Zf,{transform(t,e){var n=t.as||jk,i=n[0],r=n[1],u=qa(t.sort),o=t.field||ae,s=t.offset===Ek?Mk:t.offset===$k?Bk:Sk,a,f,c,l;a=_k(e.source,t.groupby,u,o);for(f=0,c=a.length,l=a.max;f<c;++f){s(a[f],l,o,i,r)}return e.reflow(t.modified()).modifies(n)}});function Mk(t,e,n,i,r){var u=(e-t.sum)/2,o=t.length,s=0,a;for(;s<o;++s){a=t[s];a[i]=u;a[r]=u+=Math.abs(n(a))}}function Bk(t,e,n,i,r){var u=1/t.sum,o=0,s=t.length,a=0,f=0,c;for(;a<s;++a){c=t[a];c[i]=o;c[r]=o=u*(f+=Math.abs(n(c)))}}function Sk(t,e,n,i,r){var u=0,o=0,s=t.length,a=0,f,c;for(;a<s;++a){c=t[a];f=+n(c);if(f<0){c[i]=o;c[r]=o+=f}else{c[i]=u;c[r]=u+=f}}}function _k(t,e,n,i){var r=[],u=t=>t(c),o,s,a,f,c,l,d,h,p;if(e==null){r.push(t.slice())}else{for(o={},s=0,a=t.length;s<a;++s){c=t[s];l=e.map(u);d=o[l];if(!d){o[l]=d=[];r.push(d)}d.push(c)}}for(l=0,p=0,f=r.length;l<f;++l){d=r[l];for(s=0,h=0,a=d.length;s<a;++s){h+=Math.abs(i(d[s]))}d.sum=h;if(h>p)p=h;if(n)d.sort(n)}r.max=p;return r}const Nk=Object.freeze({__proto__:null,axisticks:TD,datajoin:PD,encode:RD,legendentries:qD,linkpath:VD,pie:sk,scale:dk,sortitems:Dk,stack:Ck});var zk=1e-6;var Tk=1e-12;var Pk=Math.PI;var Lk=Pk/2;var Ik=Pk/4;var Rk=Pk*2;var qk=180/Pk;var Uk=Pk/180;var Wk=Math.abs;var Gk=Math.atan;var Hk=Math.atan2;var Vk=Math.cos;var Yk=Math.ceil;var Xk=Math.exp;var Jk=Math.hypot;var Qk=Math.log;var Zk=Math.pow;var Kk=Math.sin;var tE=Math.sign||function(t){return t>0?1:t<0?-1:0};var eE=Math.sqrt;var nE=Math.tan;function iE(t){return t>1?0:t<-1?Pk:Math.acos(t)}function rE(t){return t>1?Lk:t<-1?-Lk:Math.asin(t)}function uE(){}function oE(t,e){if(t&&aE.hasOwnProperty(t.type)){aE[t.type](t,e)}}var sE={Feature:function(t,e){oE(t.geometry,e)},FeatureCollection:function(t,e){var n=t.features,i=-1,r=n.length;while(++i<r)oE(n[i].geometry,e)}};var aE={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates;e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){var n=t.coordinates,i=-1,r=n.length;while(++i<r)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){fE(t.coordinates,e,0)},MultiLineString:function(t,e){var n=t.coordinates,i=-1,r=n.length;while(++i<r)fE(n[i],e,0)},Polygon:function(t,e){cE(t.coordinates,e)},MultiPolygon:function(t,e){var n=t.coordinates,i=-1,r=n.length;while(++i<r)cE(n[i],e)},GeometryCollection:function(t,e){var n=t.geometries,i=-1,r=n.length;while(++i<r)oE(n[i],e)}};function fE(t,e,n){var i=-1,r=t.length-n,u;e.lineStart();while(++i<r)u=t[i],e.point(u[0],u[1],u[2]);e.lineEnd()}function cE(t,e){var n=-1,i=t.length;e.polygonStart();while(++n<i)fE(t[n],e,1);e.polygonEnd()}function lE(t,e){if(t&&sE.hasOwnProperty(t.type)){sE[t.type](t,e)}else{oE(t,e)}}var dE=new di;var hE=new di,pE,mE,gE,bE,vE;var yE={point:uE,lineStart:uE,lineEnd:uE,polygonStart:function(){dE=new di;yE.lineStart=wE;yE.lineEnd=AE},polygonEnd:function(){var t=+dE;hE.add(t<0?Rk+t:t);this.lineStart=this.lineEnd=this.point=uE},sphere:function(){hE.add(Rk)}};function wE(){yE.point=xE}function AE(){OE(pE,mE)}function xE(t,e){yE.point=OE;pE=t,mE=e;t*=Uk,e*=Uk;gE=t,bE=Vk(e=e/2+Ik),vE=Kk(e)}function OE(t,e){t*=Uk,e*=Uk;e=e/2+Ik;var n=t-gE,i=n>=0?1:-1,r=i*n,u=Vk(e),o=Kk(e),s=vE*o,a=bE*u+s*Vk(r),f=s*i*Kk(r);dE.add(Hk(f,a));gE=t,bE=u,vE=o}function FE(t){hE=new di;lE(t,yE);return hE*2}function DE(t){return[Hk(t[1],t[0]),rE(t[2])]}function kE(t){var e=t[0],n=t[1],i=Vk(n);return[i*Vk(e),i*Kk(e),Kk(n)]}function EE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $E(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function jE(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function CE(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function ME(t){var e=eE(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}var BE,SE,_E,NE,zE,TE,PE,LE,IE,RE,qE;var UE={point:WE,lineStart:HE,lineEnd:VE,polygonStart:function(){UE.point=YE;UE.lineStart=XE;UE.lineEnd=JE;IE=new di;yE.polygonStart()},polygonEnd:function(){yE.polygonEnd();UE.point=WE;UE.lineStart=HE;UE.lineEnd=VE;if(dE<0)BE=-(_E=180),SE=-(NE=90);else if(IE>zk)NE=90;else if(IE<-zk)SE=-90;qE[0]=BE,qE[1]=_E},sphere:function(){BE=-(_E=180),SE=-(NE=90)}};function WE(t,e){RE.push(qE=[BE=t,_E=t]);if(e<SE)SE=e;if(e>NE)NE=e}function GE(t,e){var n=kE([t*Uk,e*Uk]);if(LE){var i=$E(LE,n),r=[i[1],-i[0],0],u=$E(r,i);ME(u);u=DE(u);var o=t-zE,s=o>0?1:-1,a=u[0]*qk*s,f,c=Wk(o)>180;if(c^(s*zE<a&&a<s*t)){f=u[1]*qk;if(f>NE)NE=f}else if(a=(a+360)%360-180,c^(s*zE<a&&a<s*t)){f=-u[1]*qk;if(f<SE)SE=f}else{if(e<SE)SE=e;if(e>NE)NE=e}if(c){if(t<zE){if(QE(BE,t)>QE(BE,_E))_E=t}else{if(QE(t,_E)>QE(BE,_E))BE=t}}else{if(_E>=BE){if(t<BE)BE=t;if(t>_E)_E=t}else{if(t>zE){if(QE(BE,t)>QE(BE,_E))_E=t}else{if(QE(t,_E)>QE(BE,_E))BE=t}}}}else{RE.push(qE=[BE=t,_E=t])}if(e<SE)SE=e;if(e>NE)NE=e;LE=n,zE=t}function HE(){UE.point=GE}function VE(){qE[0]=BE,qE[1]=_E;UE.point=WE;LE=null}function YE(t,e){if(LE){var n=t-zE;IE.add(Wk(n)>180?n+(n>0?360:-360):n)}else{TE=t,PE=e}yE.point(t,e);GE(t,e)}function XE(){yE.lineStart()}function JE(){YE(TE,PE);yE.lineEnd();if(Wk(IE)>zk)BE=-(_E=180);qE[0]=BE,qE[1]=_E;LE=null}function QE(t,e){return(e-=t)<0?e+360:e}function ZE(t,e){return t[0]-e[0]}function KE(t,e){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}function t$(t){var e,n,i,r,u,o,s;NE=_E=-(BE=SE=Infinity);RE=[];lE(t,UE);if(n=RE.length){RE.sort(ZE);for(e=1,i=RE[0],u=[i];e<n;++e){r=RE[e];if(KE(i,r[0])||KE(i,r[1])){if(QE(i[0],r[1])>QE(i[0],i[1]))i[1]=r[1];if(QE(r[0],i[1])>QE(i[0],i[1]))i[0]=r[0]}else{u.push(i=r)}}for(o=-Infinity,n=u.length-1,e=0,i=u[n];e<=n;i=r,++e){r=u[e];if((s=QE(i[1],r[0]))>o)o=s,BE=r[0],_E=i[1]}}RE=qE=null;return BE===Infinity||SE===Infinity?[[NaN,NaN],[NaN,NaN]]:[[BE,SE],[_E,NE]]}var e$,n$,i$,r$,u$,o$,s$,a$,f$,c$,l$,d$,h$,p$,m$,g$;var b$={sphere:uE,point:v$,lineStart:w$,lineEnd:O$,polygonStart:function(){b$.lineStart=F$;b$.lineEnd=D$},polygonEnd:function(){b$.lineStart=w$;b$.lineEnd=O$}};function v$(t,e){t*=Uk,e*=Uk;var n=Vk(e);y$(n*Vk(t),n*Kk(t),Kk(e))}function y$(t,e,n){++e$;i$+=(t-i$)/e$;r$+=(e-r$)/e$;u$+=(n-u$)/e$}function w$(){b$.point=A$}function A$(t,e){t*=Uk,e*=Uk;var n=Vk(e);p$=n*Vk(t);m$=n*Kk(t);g$=Kk(e);b$.point=x$;y$(p$,m$,g$)}function x$(t,e){t*=Uk,e*=Uk;var n=Vk(e),i=n*Vk(t),r=n*Kk(t),u=Kk(e),o=Hk(eE((o=m$*u-g$*r)*o+(o=g$*i-p$*u)*o+(o=p$*r-m$*i)*o),p$*i+m$*r+g$*u);n$+=o;o$+=o*(p$+(p$=i));s$+=o*(m$+(m$=r));a$+=o*(g$+(g$=u));y$(p$,m$,g$)}function O$(){b$.point=v$}function F$(){b$.point=k$}function D$(){E$(d$,h$);b$.point=v$}function k$(t,e){d$=t,h$=e;t*=Uk,e*=Uk;b$.point=E$;var n=Vk(e);p$=n*Vk(t);m$=n*Kk(t);g$=Kk(e);y$(p$,m$,g$)}function E$(t,e){t*=Uk,e*=Uk;var n=Vk(e),i=n*Vk(t),r=n*Kk(t),u=Kk(e),o=m$*u-g$*r,s=g$*i-p$*u,a=p$*r-m$*i,f=Jk(o,s,a),c=rE(f),l=f&&-c/f;f$.add(l*o);c$.add(l*s);l$.add(l*a);n$+=c;o$+=c*(p$+(p$=i));s$+=c*(m$+(m$=r));a$+=c*(g$+(g$=u));y$(p$,m$,g$)}function $$(t){e$=n$=i$=r$=u$=o$=s$=a$=0;f$=new di;c$=new di;l$=new di;lE(t,b$);var e=+f$,n=+c$,i=+l$,r=Jk(e,n,i);if(r<Tk){e=o$,n=s$,i=a$;if(n$<zk)e=i$,n=r$,i=u$;r=Jk(e,n,i);if(r<Tk)return[NaN,NaN]}return[Hk(n,e)*qk,rE(i/r)*qk]}function j$(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}if(t.invert&&e.invert)n.invert=function(n,i){return n=e.invert(n,i),n&&t.invert(n[0],n[1])};return n}function C$(t,e){if(Wk(t)>Pk)t-=Math.round(t/Rk)*Rk;return[t,e]}C$.invert=C$;function M$(t,e,n){return(t%=Rk)?e||n?j$(S$(t),_$(e,n)):S$(t):e||n?_$(e,n):C$}function B$(t){return function(e,n){e+=t;if(Wk(e)>Pk)e-=Math.round(e/Rk)*Rk;return[e,n]}}function S$(t){var e=B$(t);e.invert=B$(-t);return e}function _$(t,e){var n=Vk(t),i=Kk(t),r=Vk(e),u=Kk(e);function o(t,e){var o=Vk(e),s=Vk(t)*o,a=Kk(t)*o,f=Kk(e),c=f*n+s*i;return[Hk(a*r-c*u,s*n-f*i),rE(c*r+a*u)]}o.invert=function(t,e){var o=Vk(e),s=Vk(t)*o,a=Kk(t)*o,f=Kk(e),c=f*r-a*u;return[Hk(a*r+f*u,s*n+c*i),rE(c*n-s*i)]};return o}function N$(t){t=M$(t[0]*Uk,t[1]*Uk,t.length>2?t[2]*Uk:0);function e(e){e=t(e[0]*Uk,e[1]*Uk);return e[0]*=qk,e[1]*=qk,e}e.invert=function(e){e=t.invert(e[0]*Uk,e[1]*Uk);return e[0]*=qk,e[1]*=qk,e};return e}function z$(t,e,n,i,r,u){if(!n)return;var o=Vk(e),s=Kk(e),a=i*n;if(r==null){r=e+i*Rk;u=e-a/2}else{r=T$(o,r);u=T$(o,u);if(i>0?r<u:r>u)r+=i*Rk}for(var f,c=r;i>0?c>u:c<u;c-=a){f=DE([o,-s*Vk(c),-s*Kk(c)]);t.point(f[0],f[1])}}function T$(t,e){e=kE(e),e[0]-=t;ME(e);var n=iE(-e[1]);return((-e[2]<0?-n:n)+Rk-zk)%Rk}function P$(){var t=[],e;return{point:function(t,n,i){e.push([t,n,i])},lineStart:function(){t.push(e=[])},lineEnd:uE,rejoin:function(){if(t.length>1)t.push(t.pop().concat(t.shift()))},result:function(){var n=t;t=[];e=null;return n}}}function L$(t,e){return Wk(t[0]-e[0])<zk&&Wk(t[1]-e[1])<zk}function I$(t,e,n,i){this.x=t;this.z=e;this.o=n;this.e=i;this.v=false;this.n=this.p=null}function R$(t,e,n,i,r){var u=[],o=[],s,a;t.forEach((function(t){if((e=t.length-1)<=0)return;var e,n=t[0],i=t[e],a;if(L$(n,i)){if(!n[2]&&!i[2]){r.lineStart();for(s=0;s<e;++s)r.point((n=t[s])[0],n[1]);r.lineEnd();return}i[0]+=2*zk}u.push(a=new I$(n,t,null,true));o.push(a.o=new I$(n,null,a,false));u.push(a=new I$(i,t,null,false));o.push(a.o=new I$(i,null,a,true))}));if(!u.length)return;o.sort(e);q$(u);q$(o);for(s=0,a=o.length;s<a;++s){o[s].e=n=!n}var f=u[0],c,l;while(1){var d=f,h=true;while(d.v)if((d=d.n)===f)return;c=d.z;r.lineStart();do{d.v=d.o.v=true;if(d.e){if(h){for(s=0,a=c.length;s<a;++s)r.point((l=c[s])[0],l[1])}else{i(d.x,d.n.x,1,r)}d=d.n}else{if(h){c=d.p.z;for(s=c.length-1;s>=0;--s)r.point((l=c[s])[0],l[1])}else{i(d.x,d.p.x,-1,r)}d=d.p}d=d.o;c=d.z;h=!h}while(!d.v);r.lineEnd()}}function q$(t){if(!(e=t.length))return;var e,n=0,i=t[0],r;while(++n<e){i.n=r=t[n];r.p=i;i=r}i.n=r=t[0];r.p=i}function U$(t){return Wk(t[0])<=Pk?t[0]:tE(t[0])*((Wk(t[0])+Pk)%Rk-Pk)}function W$(t,e){var n=U$(e),i=e[1],r=Kk(i),u=[Kk(n),-Vk(n),0],o=0,s=0;var a=new di;if(r===1)i=Lk+zk;else if(r===-1)i=-Lk-zk;for(var f=0,c=t.length;f<c;++f){if(!(d=(l=t[f]).length))continue;var l,d,h=l[d-1],p=U$(h),m=h[1]/2+Ik,g=Kk(m),b=Vk(m);for(var v=0;v<d;++v,p=w,g=x,b=O,h=y){var y=l[v],w=U$(y),A=y[1]/2+Ik,x=Kk(A),O=Vk(A),F=w-p,D=F>=0?1:-1,k=D*F,E=k>Pk,$=g*x;a.add(Hk($*D*Kk(k),b*O+$*Vk(k)));o+=E?F+D*Rk:F;if(E^p>=n^w>=n){var j=$E(kE(h),kE(y));ME(j);var C=$E(u,j);ME(C);var M=(E^F>=0?-1:1)*rE(C[2]);if(i>M||i===M&&(j[0]||j[1])){s+=E^F>=0?1:-1}}}}return(o<-zk||o<zk&&a<-Tk)^s&1}function G$(t,e,n,i){return function(r){var u=e(r),o=P$(),s=e(o),a=false,f,c,l;var d={point:h,lineStart:m,lineEnd:g,polygonStart:function(){d.point=b;d.lineStart=v;d.lineEnd=y;c=[];f=[]},polygonEnd:function(){d.point=h;d.lineStart=m;d.lineEnd=g;c=Pi(c);var t=W$(f,i);if(c.length){if(!a)r.polygonStart(),a=true;R$(c,V$,t,n,r)}else if(t){if(!a)r.polygonStart(),a=true;r.lineStart();n(null,null,1,r);r.lineEnd()}if(a)r.polygonEnd(),a=false;c=f=null},sphere:function(){r.polygonStart();r.lineStart();n(null,null,1,r);r.lineEnd();r.polygonEnd()}};function h(e,n){if(t(e,n))r.point(e,n)}function p(t,e){u.point(t,e)}function m(){d.point=p;u.lineStart()}function g(){d.point=h;u.lineEnd()}function b(t,e){l.push([t,e]);s.point(t,e)}function v(){s.lineStart();l=[]}function y(){b(l[0][0],l[0][1]);s.lineEnd();var t=s.clean(),e=o.result(),n,i=e.length,u,d,h;l.pop();f.push(l);l=null;if(!i)return;if(t&1){d=e[0];if((u=d.length-1)>0){if(!a)r.polygonStart(),a=true;r.lineStart();for(n=0;n<u;++n)r.point((h=d[n])[0],h[1]);r.lineEnd()}return}if(i>1&&t&2)e.push(e.pop().concat(e.shift()));c.push(e.filter(H$))}return d}}function H$(t){return t.length>1}function V$(t,e){return((t=t.x)[0]<0?t[1]-Lk-zk:Lk-t[1])-((e=e.x)[0]<0?e[1]-Lk-zk:Lk-e[1])}const Y$=G$((function(){return true}),X$,Q$,[-Pk,-Lk]);function X$(t){var e=NaN,n=NaN,i=NaN,r;return{lineStart:function(){t.lineStart();r=1},point:function(u,o){var s=u>0?Pk:-Pk,a=Wk(u-e);if(Wk(a-Pk)<zk){t.point(e,n=(n+o)/2>0?Lk:-Lk);t.point(i,n);t.lineEnd();t.lineStart();t.point(s,n);t.point(u,n);r=0}else if(i!==s&&a>=Pk){if(Wk(e-i)<zk)e-=i*zk;if(Wk(u-s)<zk)u-=s*zk;n=J$(e,n,u,o);t.point(i,n);t.lineEnd();t.lineStart();t.point(s,n);r=0}t.point(e=u,n=o);i=s},lineEnd:function(){t.lineEnd();e=n=NaN},clean:function(){return 2-r}}}function J$(t,e,n,i){var r,u,o=Kk(t-n);return Wk(o)>zk?Gk((Kk(e)*(u=Vk(i))*Kk(n)-Kk(i)*(r=Vk(e))*Kk(t))/(r*u*o)):(e+i)/2}function Q$(t,e,n,i){var r;if(t==null){r=n*Lk;i.point(-Pk,r);i.point(0,r);i.point(Pk,r);i.point(Pk,0);i.point(Pk,-r);i.point(0,-r);i.point(-Pk,-r);i.point(-Pk,0);i.point(-Pk,r)}else if(Wk(t[0]-e[0])>zk){var u=t[0]<e[0]?Pk:-Pk;r=n*u/2;i.point(-u,r);i.point(0,r);i.point(u,r)}else{i.point(e[0],e[1])}}function Z$(t){var e=Vk(t),n=6*Uk,i=e>0,r=Wk(e)>zk;function u(e,i,r,u){z$(u,t,n,r,e,i)}function o(t,n){return Vk(t)*Vk(n)>e}function s(t){var e,n,u,s,c;return{lineStart:function(){s=u=false;c=1},point:function(l,d){var h=[l,d],p,m=o(l,d),g=i?m?0:f(l,d):m?f(l+(l<0?Pk:-Pk),d):0;if(!e&&(s=u=m))t.lineStart();if(m!==u){p=a(e,h);if(!p||L$(e,p)||L$(h,p))h[2]=1}if(m!==u){c=0;if(m){t.lineStart();p=a(h,e);t.point(p[0],p[1])}else{p=a(e,h);t.point(p[0],p[1],2);t.lineEnd()}e=p}else if(r&&e&&i^m){var b;if(!(g&n)&&(b=a(h,e,true))){c=0;if(i){t.lineStart();t.point(b[0][0],b[0][1]);t.point(b[1][0],b[1][1]);t.lineEnd()}else{t.point(b[1][0],b[1][1]);t.lineEnd();t.lineStart();t.point(b[0][0],b[0][1],3)}}}if(m&&(!e||!L$(e,h))){t.point(h[0],h[1])}e=h,u=m,n=g},lineEnd:function(){if(u)t.lineEnd();e=null},clean:function(){return c|(s&&u)<<1}}}function a(t,n,i){var r=kE(t),u=kE(n);var o=[1,0,0],s=$E(r,u),a=EE(s,s),f=s[0],c=a-f*f;if(!c)return!i&&t;var l=e*a/c,d=-e*f/c,h=$E(o,s),p=CE(o,l),m=CE(s,d);jE(p,m);var g=h,b=EE(p,g),v=EE(g,g),y=b*b-v*(EE(p,p)-1);if(y<0)return;var w=eE(y),A=CE(g,(-b-w)/v);jE(A,p);A=DE(A);if(!i)return A;var x=t[0],O=n[0],F=t[1],D=n[1],k;if(O<x)k=x,x=O,O=k;var E=O-x,$=Wk(E-Pk)<zk,j=$||E<zk;if(!$&&D<F)k=F,F=D,D=k;if(j?$?F+D>0^A[1]<(Wk(A[0]-x)<zk?F:D):F<=A[1]&&A[1]<=D:E>Pk^(x<=A[0]&&A[0]<=O)){var C=CE(g,(-b+w)/v);jE(C,p);return[A,DE(C)]}}function f(e,n){var r=i?t:Pk-t,u=0;if(e<-r)u|=1;else if(e>r)u|=2;if(n<-r)u|=4;else if(n>r)u|=8;return u}return G$(o,s,u,i?[0,-t]:[-Pk,t-Pk])}function K$(t,e,n,i,r,u){var o=t[0],s=t[1],a=e[0],f=e[1],c=0,l=1,d=a-o,h=f-s,p;p=n-o;if(!d&&p>0)return;p/=d;if(d<0){if(p<c)return;if(p<l)l=p}else if(d>0){if(p>l)return;if(p>c)c=p}p=r-o;if(!d&&p<0)return;p/=d;if(d<0){if(p>l)return;if(p>c)c=p}else if(d>0){if(p<c)return;if(p<l)l=p}p=i-s;if(!h&&p>0)return;p/=h;if(h<0){if(p<c)return;if(p<l)l=p}else if(h>0){if(p>l)return;if(p>c)c=p}p=u-s;if(!h&&p<0)return;p/=h;if(h<0){if(p>l)return;if(p>c)c=p}else if(h>0){if(p<c)return;if(p<l)l=p}if(c>0)t[0]=o+c*d,t[1]=s+c*h;if(l<1)e[0]=o+l*d,e[1]=s+l*h;return true}var tj=1e9,ej=-tj;function nj(t,e,n,i){function r(r,u){return t<=r&&r<=n&&e<=u&&u<=i}function u(r,u,s,f){var c=0,l=0;if(r==null||(c=o(r,s))!==(l=o(u,s))||a(r,u)<0^s>0){do{f.point(c===0||c===3?t:n,c>1?i:e)}while((c=(c+s+4)%4)!==l)}else{f.point(u[0],u[1])}}function o(i,r){return Wk(i[0]-t)<zk?r>0?0:3:Wk(i[0]-n)<zk?r>0?2:1:Wk(i[1]-e)<zk?r>0?1:0:r>0?3:2}function s(t,e){return a(t.x,e.x)}function a(t,e){var n=o(t,1),i=o(e,1);return n!==i?n-i:n===0?e[1]-t[1]:n===1?t[0]-e[0]:n===2?t[1]-e[1]:e[0]-t[0]}return function(o){var a=o,f=P$(),c,l,d,h,p,m,g,b,v,y,w;var A={point:x,lineStart:k,lineEnd:E,polygonStart:F,polygonEnd:D};function x(t,e){if(r(t,e))a.point(t,e)}function O(){var e=0;for(var n=0,r=l.length;n<r;++n){for(var u=l[n],o=1,s=u.length,a=u[0],f,c,d=a[0],h=a[1];o<s;++o){f=d,c=h,a=u[o],d=a[0],h=a[1];if(c<=i){if(h>i&&(d-f)*(i-c)>(h-c)*(t-f))++e}else{if(h<=i&&(d-f)*(i-c)<(h-c)*(t-f))--e}}}return e}function F(){a=f,c=[],l=[],w=true}function D(){var t=O(),e=w&&t,n=(c=Pi(c)).length;if(e||n){o.polygonStart();if(e){o.lineStart();u(null,null,1,o);o.lineEnd()}if(n){R$(c,s,t,u,o)}o.polygonEnd()}a=o,c=l=d=null}function k(){A.point=$;if(l)l.push(d=[]);y=true;v=false;g=b=NaN}function E(){if(c){$(h,p);if(m&&v)f.rejoin();c.push(f.result())}A.point=x;if(v)a.lineEnd()}function $(u,o){var s=r(u,o);if(l)d.push([u,o]);if(y){h=u,p=o,m=s;y=false;if(s){a.lineStart();a.point(u,o)}}else{if(s&&v)a.point(u,o);else{var f=[g=Math.max(ej,Math.min(tj,g)),b=Math.max(ej,Math.min(tj,b))],c=[u=Math.max(ej,Math.min(tj,u)),o=Math.max(ej,Math.min(tj,o))];if(K$(f,c,t,e,n,i)){if(!v){a.lineStart();a.point(f[0],f[1])}a.point(c[0],c[1]);if(!s)a.lineEnd();w=false}else if(s){a.lineStart();a.point(u,o);w=false}}}g=u,b=o,v=s}return A}}function ij(t,e,n){var i=Li(t,e-zk,n).concat(e);return function(t){return i.map((function(e){return[t,e]}))}}function rj(t,e,n){var i=Li(t,e-zk,n).concat(e);return function(t){return i.map((function(e){return[e,t]}))}}function uj(){var t,e,n,i,r,u,o,s,a=10,f=a,c=90,l=360,d,h,p,m,g=2.5;function b(){return{type:"MultiLineString",coordinates:v()}}function v(){return Li(Yk(i/c)*c,n,c).map(p).concat(Li(Yk(s/l)*l,o,l).map(m)).concat(Li(Yk(e/a)*a,t,a).filter((function(t){return Wk(t%c)>zk})).map(d)).concat(Li(Yk(u/f)*f,r,f).filter((function(t){return Wk(t%l)>zk})).map(h))}b.lines=function(){return v().map((function(t){return{type:"LineString",coordinates:t}}))};b.outline=function(){return{type:"Polygon",coordinates:[p(i).concat(m(o).slice(1),p(n).reverse().slice(1),m(s).reverse().slice(1))]}};b.extent=function(t){if(!arguments.length)return b.extentMinor();return b.extentMajor(t).extentMinor(t)};b.extentMajor=function(t){if(!arguments.length)return[[i,s],[n,o]];i=+t[0][0],n=+t[1][0];s=+t[0][1],o=+t[1][1];if(i>n)t=i,i=n,n=t;if(s>o)t=s,s=o,o=t;return b.precision(g)};b.extentMinor=function(n){if(!arguments.length)return[[e,u],[t,r]];e=+n[0][0],t=+n[1][0];u=+n[0][1],r=+n[1][1];if(e>t)n=e,e=t,t=n;if(u>r)n=u,u=r,r=n;return b.precision(g)};b.step=function(t){if(!arguments.length)return b.stepMinor();return b.stepMajor(t).stepMinor(t)};b.stepMajor=function(t){if(!arguments.length)return[c,l];c=+t[0],l=+t[1];return b};b.stepMinor=function(t){if(!arguments.length)return[a,f];a=+t[0],f=+t[1];return b};b.precision=function(a){if(!arguments.length)return g;g=+a;d=ij(u,r,90);h=rj(e,t,g);p=ij(s,o,90);m=rj(i,n,g);return b};return b.extentMajor([[-180,-90+zk],[180,90-zk]]).extentMinor([[-180,-80-zk],[180,80+zk]])}const oj=t=>t;var sj=new di,aj=new di,fj,cj,lj,dj;var hj={point:uE,lineStart:uE,lineEnd:uE,polygonStart:function(){hj.lineStart=pj;hj.lineEnd=bj},polygonEnd:function(){hj.lineStart=hj.lineEnd=hj.point=uE;sj.add(Wk(aj));aj=new di},result:function(){var t=sj/2;sj=new di;return t}};function pj(){hj.point=mj}function mj(t,e){hj.point=gj;fj=lj=t,cj=dj=e}function gj(t,e){aj.add(dj*t-lj*e);lj=t,dj=e}function bj(){gj(fj,cj)}var vj=Infinity,yj=vj,wj=-vj,Aj=wj;var xj={point:Oj,lineStart:uE,lineEnd:uE,polygonStart:uE,polygonEnd:uE,result:function(){var t=[[vj,yj],[wj,Aj]];wj=Aj=-(yj=vj=Infinity);return t}};function Oj(t,e){if(t<vj)vj=t;if(t>wj)wj=t;if(e<yj)yj=e;if(e>Aj)Aj=e}var Fj=0,Dj=0,kj=0,Ej=0,$j=0,jj=0,Cj=0,Mj=0,Bj=0,Sj,_j,Nj,zj;var Tj={point:Pj,lineStart:Lj,lineEnd:qj,polygonStart:function(){Tj.lineStart=Uj;Tj.lineEnd=Wj},polygonEnd:function(){Tj.point=Pj;Tj.lineStart=Lj;Tj.lineEnd=qj},result:function(){var t=Bj?[Cj/Bj,Mj/Bj]:jj?[Ej/jj,$j/jj]:kj?[Fj/kj,Dj/kj]:[NaN,NaN];Fj=Dj=kj=Ej=$j=jj=Cj=Mj=Bj=0;return t}};function Pj(t,e){Fj+=t;Dj+=e;++kj}function Lj(){Tj.point=Ij}function Ij(t,e){Tj.point=Rj;Pj(Nj=t,zj=e)}function Rj(t,e){var n=t-Nj,i=e-zj,r=eE(n*n+i*i);Ej+=r*(Nj+t)/2;$j+=r*(zj+e)/2;jj+=r;Pj(Nj=t,zj=e)}function qj(){Tj.point=Pj}function Uj(){Tj.point=Gj}function Wj(){Hj(Sj,_j)}function Gj(t,e){Tj.point=Hj;Pj(Sj=Nj=t,_j=zj=e)}function Hj(t,e){var n=t-Nj,i=e-zj,r=eE(n*n+i*i);Ej+=r*(Nj+t)/2;$j+=r*(zj+e)/2;jj+=r;r=zj*t-Nj*e;Cj+=r*(Nj+t);Mj+=r*(zj+e);Bj+=r*3;Pj(Nj=t,zj=e)}function Vj(t){this._context=t}Vj.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){if(this._line===0)this._context.closePath();this._point=NaN},point:function(t,e){switch(this._point){case 0:{this._context.moveTo(t,e);this._point=1;break}case 1:{this._context.lineTo(t,e);break}default:{this._context.moveTo(t+this._radius,e);this._context.arc(t,e,this._radius,0,Rk);break}}},result:uE};var Yj=new di,Xj,Jj,Qj,Zj,Kj;var tC={point:uE,lineStart:function(){tC.point=eC},lineEnd:function(){if(Xj)nC(Jj,Qj);tC.point=uE},polygonStart:function(){Xj=true},polygonEnd:function(){Xj=null},result:function(){var t=+Yj;Yj=new di;return t}};function eC(t,e){tC.point=nC;Jj=Zj=t,Qj=Kj=e}function nC(t,e){Zj-=t,Kj-=e;Yj.add(eE(Zj*Zj+Kj*Kj));Zj=t,Kj=e}let iC,rC,uC,oC;class sC{constructor(t){this._append=t==null?aC:fC(t);this._radius=4.5;this._=""}pointRadius(t){this._radius=+t;return this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){if(this._line===0)this._+="Z";this._point=NaN}point(t,e){switch(this._point){case 0:{this._append`M${t},${e}`;this._point=1;break}case 1:{this._append`L${t},${e}`;break}default:{this._append`M${t},${e}`;if(this._radius!==uC||this._append!==rC){const t=this._radius;const e=this._;this._="";this._append`m0,${t}a${t},${t} 0 1,1 0,${-2*t}a${t},${t} 0 1,1 0,${2*t}z`;uC=t;rC=this._append;oC=this._;this._=e}this._+=oC;break}}}result(){const t=this._;this._="";return t.length?t:null}}function aC(t){let e=1;this._+=t[0];for(const n=t.length;e<n;++e){this._+=arguments[e]+t[e]}}function fC(t){const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);if(e>15)return aC;if(e!==iC){const t=10**e;iC=e;rC=function e(n){let i=1;this._+=n[0];for(const r=n.length;i<r;++i){this._+=Math.round(arguments[i]*t)/t+n[i]}}}return rC}function cC(t,e){let n=3,i=4.5,r,u;function o(t){if(t){if(typeof i==="function")u.pointRadius(+i.apply(this,arguments));lE(t,r(u))}return u.result()}o.area=function(t){lE(t,r(hj));return hj.result()};o.measure=function(t){lE(t,r(tC));return tC.result()};o.bounds=function(t){lE(t,r(xj));return xj.result()};o.centroid=function(t){lE(t,r(Tj));return Tj.result()};o.projection=function(e){if(!arguments.length)return t;r=e==null?(t=null,oj):(t=e).stream;return o};o.context=function(t){if(!arguments.length)return e;u=t==null?(e=null,new sC(n)):new Vj(e=t);if(typeof i!=="function")u.pointRadius(i);return o};o.pointRadius=function(t){if(!arguments.length)return i;i=typeof t==="function"?t:(u.pointRadius(+t),+t);return o};o.digits=function(t){if(!arguments.length)return n;if(t==null)n=null;else{const e=Math.floor(t);if(!(e>=0))throw new RangeError(`invalid digits: ${t}`);n=e}if(e===null)u=new sC(n);return o};return o.projection(t).digits(n).context(e)}function lC(t){return function(e){var n=new dC;for(var i in t)n[i]=t[i];n.stream=e;return n}}function dC(){}dC.prototype={constructor:dC,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function hC(t,e,n){var i=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]);if(i!=null)t.clipExtent(null);lE(n,t.stream(xj));e(xj.result());if(i!=null)t.clipExtent(i);return t}function pC(t,e,n){return hC(t,(function(n){var i=e[1][0]-e[0][0],r=e[1][1]-e[0][1],u=Math.min(i/(n[1][0]-n[0][0]),r/(n[1][1]-n[0][1])),o=+e[0][0]+(i-u*(n[1][0]+n[0][0]))/2,s=+e[0][1]+(r-u*(n[1][1]+n[0][1]))/2;t.scale(150*u).translate([o,s])}),n)}function mC(t,e,n){return pC(t,[[0,0],e],n)}function gC(t,e,n){return hC(t,(function(n){var i=+e,r=i/(n[1][0]-n[0][0]),u=(i-r*(n[1][0]+n[0][0]))/2,o=-r*n[0][1];t.scale(150*r).translate([u,o])}),n)}function bC(t,e,n){return hC(t,(function(n){var i=+e,r=i/(n[1][1]-n[0][1]),u=-r*n[0][0],o=(i-r*(n[1][1]+n[0][1]))/2;t.scale(150*r).translate([u,o])}),n)}var vC=16,yC=Vk(30*Uk);function wC(t,e){return+e?xC(t,e):AC(t)}function AC(t){return lC({point:function(e,n){e=t(e,n);this.stream.point(e[0],e[1])}})}function xC(t,e){function n(i,r,u,o,s,a,f,c,l,d,h,p,m,g){var b=f-i,v=c-r,y=b*b+v*v;if(y>4*e&&m--){var w=o+d,A=s+h,x=a+p,O=eE(w*w+A*A+x*x),F=rE(x/=O),D=Wk(Wk(x)-1)<zk||Wk(u-l)<zk?(u+l)/2:Hk(A,w),k=t(D,F),E=k[0],$=k[1],j=E-i,C=$-r,M=v*j-b*C;if(M*M/y>e||Wk((b*j+v*C)/y-.5)>.3||o*d+s*h+a*p<yC){n(i,r,u,o,s,a,E,$,D,w/=O,A/=O,x,m,g);g.point(E,$);n(E,$,D,w,A,x,f,c,l,d,h,p,m,g)}}}return function(e){var i,r,u,o,s,a,f,c,l,d,h,p;var m={point:g,lineStart:b,lineEnd:y,polygonStart:function(){e.polygonStart();m.lineStart=w},polygonEnd:function(){e.polygonEnd();m.lineStart=b}};function g(n,i){n=t(n,i);e.point(n[0],n[1])}function b(){c=NaN;m.point=v;e.lineStart()}function v(i,r){var u=kE([i,r]),o=t(i,r);n(c,l,f,d,h,p,c=o[0],l=o[1],f=i,d=u[0],h=u[1],p=u[2],vC,e);e.point(c,l)}function y(){m.point=g;e.lineEnd()}function w(){b();m.point=A;m.lineEnd=x}function A(t,e){v(i=t,e),r=c,u=l,o=d,s=h,a=p;m.point=v}function x(){n(c,l,f,d,h,p,r,u,i,o,s,a,vC,e);m.lineEnd=y;y()}return m}}var OC=lC({point:function(t,e){this.stream.point(t*Uk,e*Uk)}});function FC(t){return lC({point:function(e,n){var i=t(e,n);return this.stream.point(i[0],i[1])}})}function DC(t,e,n,i,r){function u(u,o){u*=i;o*=r;return[e+t*u,n-t*o]}u.invert=function(u,o){return[(u-e)/t*i,(n-o)/t*r]};return u}function kC(t,e,n,i,r,u){if(!u)return DC(t,e,n,i,r);var o=Vk(u),s=Kk(u),a=o*t,f=s*t,c=o/t,l=s/t,d=(s*n-o*e)/t,h=(s*e+o*n)/t;function p(t,u){t*=i;u*=r;return[a*t-f*u+e,n-f*t-a*u]}p.invert=function(t,e){return[i*(c*t-l*e+d),r*(h-l*t-c*e)]};return p}function EC(t){return $C((function(){return t}))()}function $C(t){var e,n=150,i=480,r=250,u=0,o=0,s=0,a=0,f=0,c,l=0,d=1,h=1,p=null,m=Y$,g=null,b,v,y,w=oj,A=.5,x,O,F,D,k;function E(t){return F(t[0]*Uk,t[1]*Uk)}function $(t){t=F.invert(t[0],t[1]);return t&&[t[0]*qk,t[1]*qk]}E.stream=function(t){return D&&k===t?D:D=OC(FC(c)(m(x(w(k=t)))))};E.preclip=function(t){return arguments.length?(m=t,p=undefined,C()):m};E.postclip=function(t){return arguments.length?(w=t,g=b=v=y=null,C()):w};E.clipAngle=function(t){return arguments.length?(m=+t?Z$(p=t*Uk):(p=null,Y$),C()):p*qk};E.clipExtent=function(t){return arguments.length?(w=t==null?(g=b=v=y=null,oj):nj(g=+t[0][0],b=+t[0][1],v=+t[1][0],y=+t[1][1]),C()):g==null?null:[[g,b],[v,y]]};E.scale=function(t){return arguments.length?(n=+t,j()):n};E.translate=function(t){return arguments.length?(i=+t[0],r=+t[1],j()):[i,r]};E.center=function(t){return arguments.length?(u=t[0]%360*Uk,o=t[1]%360*Uk,j()):[u*qk,o*qk]};E.rotate=function(t){return arguments.length?(s=t[0]%360*Uk,a=t[1]%360*Uk,f=t.length>2?t[2]%360*Uk:0,j()):[s*qk,a*qk,f*qk]};E.angle=function(t){return arguments.length?(l=t%360*Uk,j()):l*qk};E.reflectX=function(t){return arguments.length?(d=t?-1:1,j()):d<0};E.reflectY=function(t){return arguments.length?(h=t?-1:1,j()):h<0};E.precision=function(t){return arguments.length?(x=wC(O,A=t*t),C()):eE(A)};E.fitExtent=function(t,e){return pC(E,t,e)};E.fitSize=function(t,e){return mC(E,t,e)};E.fitWidth=function(t,e){return gC(E,t,e)};E.fitHeight=function(t,e){return bC(E,t,e)};function j(){var t=kC(n,0,0,d,h,l).apply(null,e(u,o)),p=kC(n,i-t[0],r-t[1],d,h,l);c=M$(s,a,f);O=j$(e,p);F=j$(c,O);x=wC(O,A);return C()}function C(){D=k=null;return E}return function(){e=t.apply(this,arguments);E.invert=e.invert&&$;return j()}}function jC(t){var e=0,n=Pk/3,i=$C(t),r=i(e,n);r.parallels=function(t){return arguments.length?i(e=t[0]*Uk,n=t[1]*Uk):[e*qk,n*qk]};return r}function CC(t){var e=Vk(t);function n(t,n){return[t*e,Kk(n)/e]}n.invert=function(t,n){return[t/e,rE(n*e)]};return n}function MC(t,e){var n=Kk(t),i=(n+Kk(e))/2;if(Wk(i)<zk)return CC(t);var r=1+n*(2*i-n),u=eE(r)/i;function o(t,e){var n=eE(r-2*i*Kk(e))/i;return[n*Kk(t*=i),u-n*Vk(t)]}o.invert=function(t,e){var n=u-e,o=Hk(t,Wk(n))*tE(n);if(n*i<0)o-=Pk*tE(t)*tE(n);return[o/i,rE((r-(t*t+n*n)*i*i)/(2*i))]};return o}function BC(){return jC(MC).scale(155.424).center([0,33.6442])}function SC(){return BC().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function _C(t){var e=t.length;return{point:function(n,i){var r=-1;while(++r<e)t[r].point(n,i)},sphere:function(){var n=-1;while(++n<e)t[n].sphere()},lineStart:function(){var n=-1;while(++n<e)t[n].lineStart()},lineEnd:function(){var n=-1;while(++n<e)t[n].lineEnd()},polygonStart:function(){var n=-1;while(++n<e)t[n].polygonStart()},polygonEnd:function(){var n=-1;while(++n<e)t[n].polygonEnd()}}}function NC(){var t,e,n=SC(),i,r=BC().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u,o=BC().rotate([157,0]).center([-3,19.9]).parallels([8,18]),s,a,f={point:function(t,e){a=[t,e]}};function c(t){var e=t[0],n=t[1];return a=null,(i.point(e,n),a)||(u.point(e,n),a)||(s.point(e,n),a)}c.invert=function(t){var e=n.scale(),i=n.translate(),u=(t[0]-i[0])/e,s=(t[1]-i[1])/e;return(s>=.12&&s<.234&&u>=-.425&&u<-.214?r:s>=.166&&s<.234&&u>=-.214&&u<-.115?o:n).invert(t)};c.stream=function(i){return t&&e===i?t:t=_C([n.stream(e=i),r.stream(i),o.stream(i)])};c.precision=function(t){if(!arguments.length)return n.precision();n.precision(t),r.precision(t),o.precision(t);return l()};c.scale=function(t){if(!arguments.length)return n.scale();n.scale(t),r.scale(t*.35),o.scale(t);return c.translate(n.translate())};c.translate=function(t){if(!arguments.length)return n.translate();var e=n.scale(),a=+t[0],c=+t[1];i=n.translate(t).clipExtent([[a-.455*e,c-.238*e],[a+.455*e,c+.238*e]]).stream(f);u=r.translate([a-.307*e,c+.201*e]).clipExtent([[a-.425*e+zk,c+.12*e+zk],[a-.214*e-zk,c+.234*e-zk]]).stream(f);s=o.translate([a-.205*e,c+.212*e]).clipExtent([[a-.214*e+zk,c+.166*e+zk],[a-.115*e-zk,c+.234*e-zk]]).stream(f);return l()};c.fitExtent=function(t,e){return pC(c,t,e)};c.fitSize=function(t,e){return mC(c,t,e)};c.fitWidth=function(t,e){return gC(c,t,e)};c.fitHeight=function(t,e){return bC(c,t,e)};function l(){t=e=null;return c}return c.scale(1070)}function zC(t){return function(e,n){var i=Vk(e),r=Vk(n),u=t(i*r);if(u===Infinity)return[2,0];return[u*r*Kk(e),u*Kk(n)]}}function TC(t){return function(e,n){var i=eE(e*e+n*n),r=t(i),u=Kk(r),o=Vk(r);return[Hk(e*u,i*o),rE(i&&n*u/i)]}}var PC=zC((function(t){return eE(2/(1+t))}));PC.invert=TC((function(t){return 2*rE(t/2)}));function LC(){return EC(PC).scale(124.75).clipAngle(180-.001)}var IC=zC((function(t){return(t=iE(t))&&t/Kk(t)}));IC.invert=TC((function(t){return t}));function RC(){return EC(IC).scale(79.4188).clipAngle(180-.001)}function qC(t,e){return[t,Qk(nE((Lk+e)/2))]}qC.invert=function(t,e){return[t,2*Gk(Xk(e))-Lk]};function UC(){return WC(qC).scale(961/Rk)}function WC(t){var e=EC(t),n=e.center,i=e.scale,r=e.translate,u=e.clipExtent,o=null,s,a,f;e.scale=function(t){return arguments.length?(i(t),c()):i()};e.translate=function(t){return arguments.length?(r(t),c()):r()};e.center=function(t){return arguments.length?(n(t),c()):n()};e.clipExtent=function(t){return arguments.length?(t==null?o=s=a=f=null:(o=+t[0][0],s=+t[0][1],a=+t[1][0],f=+t[1][1]),c()):o==null?null:[[o,s],[a,f]]};function c(){var n=Pk*i(),r=e(N$(e.rotate()).invert([0,0]));return u(o==null?[[r[0]-n,r[1]-n],[r[0]+n,r[1]+n]]:t===qC?[[Math.max(r[0]-n,o),s],[Math.min(r[0]+n,a),f]]:[[o,Math.max(r[1]-n,s)],[a,Math.min(r[1]+n,f)]])}return c()}function GC(t){return nE((Lk+t)/2)}function HC(t,e){var n=Vk(t),i=t===e?Kk(t):Qk(n/Vk(e))/Qk(GC(e)/GC(t)),r=n*Zk(GC(t),i)/i;if(!i)return qC;function u(t,e){if(r>0){if(e<-Lk+zk)e=-Lk+zk}else{if(e>Lk-zk)e=Lk-zk}var n=r/Zk(GC(e),i);return[n*Kk(i*t),r-n*Vk(i*t)]}u.invert=function(t,e){var n=r-e,u=tE(i)*eE(t*t+n*n),o=Hk(t,Wk(n))*tE(n);if(n*i<0)o-=Pk*tE(t)*tE(n);return[o/i,2*Gk(Zk(r/u,1/i))-Lk]};return u}function VC(){return jC(HC).scale(109.5).parallels([30,30])}function YC(t,e){return[t,e]}YC.invert=YC;function XC(){return EC(YC).scale(152.63)}function JC(t,e){var n=Vk(t),i=t===e?Kk(t):(n-Vk(e))/(e-t),r=n/i+t;if(Wk(i)<zk)return YC;function u(t,e){var n=r-e,u=i*t;return[n*Kk(u),r-n*Vk(u)]}u.invert=function(t,e){var n=r-e,u=Hk(t,Wk(n))*tE(n);if(n*i<0)u-=Pk*tE(t)*tE(n);return[u/i,r-tE(i)*eE(t*t+n*n)]};return u}function QC(){return jC(JC).scale(131.154).center([0,13.9389])}var ZC=1.340264,KC=-.081106,tM=893e-6,eM=.003796,nM=eE(3)/2,iM=12;function rM(t,e){var n=rE(nM*Kk(e)),i=n*n,r=i*i*i;return[t*Vk(n)/(nM*(ZC+3*KC*i+r*(7*tM+9*eM*i))),n*(ZC+KC*i+r*(tM+eM*i))]}rM.invert=function(t,e){var n=e,i=n*n,r=i*i*i;for(var u=0,o,s,a;u<iM;++u){s=n*(ZC+KC*i+r*(tM+eM*i))-e;a=ZC+3*KC*i+r*(7*tM+9*eM*i);n-=o=s/a,i=n*n,r=i*i*i;if(Wk(o)<Tk)break}return[nM*t*(ZC+3*KC*i+r*(7*tM+9*eM*i))/Vk(n),rE(Kk(n)/nM)]};function uM(){return EC(rM).scale(177.158)}function oM(t,e){var n=Vk(e),i=Vk(t)*n;return[n*Kk(t)/i,Kk(e)/i]}oM.invert=TC(Gk);function sM(){return EC(oM).scale(144.049).clipAngle(60)}function aM(){var t=1,e=0,n=0,i=1,r=1,u=0,o,s,a=null,f,c,l,d=1,h=1,p=lC({point:function(t,e){var n=y([t,e]);this.stream.point(n[0],n[1])}}),m=oj,g,b;function v(){d=t*i;h=t*r;g=b=null;return y}function y(t){var i=t[0]*d,r=t[1]*h;if(u){var a=r*o-i*s;i=i*o+r*s;r=a}return[i+e,r+n]}y.invert=function(t){var i=t[0]-e,r=t[1]-n;if(u){var a=r*o+i*s;i=i*o-r*s;r=a}return[i/d,r/h]};y.stream=function(t){return g&&b===t?g:g=p(m(b=t))};y.postclip=function(t){return arguments.length?(m=t,a=f=c=l=null,v()):m};y.clipExtent=function(t){return arguments.length?(m=t==null?(a=f=c=l=null,oj):nj(a=+t[0][0],f=+t[0][1],c=+t[1][0],l=+t[1][1]),v()):a==null?null:[[a,f],[c,l]]};y.scale=function(e){return arguments.length?(t=+e,v()):t};y.translate=function(t){return arguments.length?(e=+t[0],n=+t[1],v()):[e,n]};y.angle=function(t){return arguments.length?(u=t%360*Uk,s=Kk(u),o=Vk(u),v()):u*qk};y.reflectX=function(t){return arguments.length?(i=t?-1:1,v()):i<0};y.reflectY=function(t){return arguments.length?(r=t?-1:1,v()):r<0};y.fitExtent=function(t,e){return pC(y,t,e)};y.fitSize=function(t,e){return mC(y,t,e)};y.fitWidth=function(t,e){return gC(y,t,e)};y.fitHeight=function(t,e){return bC(y,t,e)};return y}function fM(t,e){var n=e*e,i=n*n;return[t*(.8707-.131979*n+i*(-.013791+i*(.003971*n-.001529*i))),e*(1.007226+n*(.015085+i*(-.044475+.028874*n-.005916*i)))]}fM.invert=function(t,e){var n=e,i=25,r;do{var u=n*n,o=u*u;n-=r=(n*(1.007226+u*(.015085+o*(-.044475+.028874*u-.005916*o)))-e)/(1.007226+u*(.015085*3+o*(-.044475*7+.028874*9*u-.005916*11*o)))}while(Wk(r)>zk&&--i>0);return[t/(.8707+(u=n*n)*(-.131979+u*(-.013791+u*u*u*(.003971-.001529*u)))),n]};function cM(){return EC(fM).scale(175.295)}function lM(t,e){return[Vk(e)*Kk(t),Kk(e)]}lM.invert=TC(rE);function dM(){return EC(lM).scale(249.5).clipAngle(90+zk)}function hM(t,e){var n=Vk(e),i=1+Vk(t)*n;return[n*Kk(t)/i,Kk(e)/i]}hM.invert=TC((function(t){return 2*Gk(t)}));function pM(){return EC(hM).scale(250).clipAngle(142)}function mM(t,e){return[Qk(nE((Lk+e)/2)),-t]}mM.invert=function(t,e){return[-e,2*Gk(Xk(t))-Lk]};function gM(){var t=WC(mM),e=t.center,n=t.rotate;t.center=function(t){return arguments.length?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])};t.rotate=function(t){return arguments.length?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])};return n([0,0,90]).scale(159.155)}var bM=Math.abs;var vM=Math.cos;var yM=Math.sin;var wM=1e-6;var AM=Math.PI;var xM=AM/2;var OM=DM(2);function FM(t){return t>1?xM:t<-1?-xM:Math.asin(t)}function DM(t){return t>0?Math.sqrt(t):0}function kM(t,e){var n=t*yM(e),i=30,r;do{e-=r=(e+yM(e)-n)/(1+vM(e))}while(bM(r)>wM&&--i>0);return e/2}function EM(t,e,n){function i(i,r){return[t*i*vM(r=kM(n,r)),e*yM(r)]}i.invert=function(i,r){return r=FM(r/e),[i/(t*vM(r)),FM((2*r+yM(2*r))/n)]};return i}var $M=EM(OM/xM,OM,AM);function jM(){return EC($M).scale(169.529)}const CM=cC();const MM=["clipAngle","clipExtent","scale","translate","center","rotate","parallels","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function BM(t,e){return function n(){const i=e();i.type=t;i.path=cC().projection(i);i.copy=i.copy||function(){const t=n();MM.forEach((e=>{if(i[e])t[e](i[e]())}));t.path.pointRadius(i.path.pointRadius());return t};return _g(i)}}function SM(t,e){if(!t||typeof t!=="string"){throw new Error("Projection type must be a name string.")}t=t.toLowerCase();if(arguments.length>1){NM[t]=BM(t,e);return this}else{return NM[t]||null}}function _M(t){return t&&t.path||CM}const NM={albers:SC,albersusa:NC,azimuthalequalarea:LC,azimuthalequidistant:RC,conicconformal:VC,conicequalarea:BC,conicequidistant:QC,equalEarth:uM,equirectangular:XC,gnomonic:sM,identity:aM,mercator:UC,mollweide:jM,naturalEarth1:cM,orthographic:dM,stereographic:pM,transversemercator:gM};for(const Set in NM){SM(Set,NM[Set])}function zM(){}const TM=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function PM(){var t=1,e=1,n=s;function i(t,e){return e.map((e=>r(t,e)))}function r(t,e){var i=[],r=[];u(t,e,(u=>{n(u,t,e);if(LM(u)>0)i.push([u]);else r.push(u)}));r.forEach((t=>{for(var e=0,n=i.length,r;e<n;++e){if(IM((r=i[e])[0],t)!==-1){r.push(t);return}}}));return{type:"MultiPolygon",value:e,coordinates:i}}function u(n,i,r){var u=new Array,s=new Array,a,f,c,l,d,h;a=f=-1;l=n[0]>=i;TM[l<<1].forEach(p);while(++a<t-1){c=l,l=n[a+1]>=i;TM[c|l<<1].forEach(p)}TM[l<<0].forEach(p);while(++f<e-1){a=-1;l=n[f*t+t]>=i;d=n[f*t]>=i;TM[l<<1|d<<2].forEach(p);while(++a<t-1){c=l,l=n[f*t+t+a+1]>=i;h=d,d=n[f*t+a+1]>=i;TM[c|l<<1|d<<2|h<<3].forEach(p)}TM[l|d<<3].forEach(p)}a=-1;d=n[f*t]>=i;TM[d<<2].forEach(p);while(++a<t-1){h=d,d=n[f*t+a+1]>=i;TM[d<<2|h<<3].forEach(p)}TM[d<<3].forEach(p);function p(t){var e=[t[0][0]+a,t[0][1]+f],n=[t[1][0]+a,t[1][1]+f],i=o(e),c=o(n),l,d;if(l=s[i]){if(d=u[c]){delete s[l.end];delete u[d.start];if(l===d){l.ring.push(n);r(l.ring)}else{u[l.start]=s[d.end]={start:l.start,end:d.end,ring:l.ring.concat(d.ring)}}}else{delete s[l.end];l.ring.push(n);s[l.end=c]=l}}else if(l=u[c]){if(d=s[i]){delete u[l.start];delete s[d.end];if(l===d){l.ring.push(n);r(l.ring)}else{u[d.start]=s[l.end]={start:d.start,end:l.end,ring:d.ring.concat(l.ring)}}}else{delete u[l.start];l.ring.unshift(e);u[l.start=i]=l}}else{u[i]=s[c]={start:i,end:c,ring:[e,n]}}}}function o(e){return e[0]*2+e[1]*(t+1)*4}function s(n,i,r){n.forEach((n=>{var u=n[0],o=n[1],s=u|0,a=o|0,f,c=i[a*t+s];if(u>0&&u<t&&s===u){f=i[a*t+s-1];n[0]=u+(r-f)/(c-f)-.5}if(o>0&&o<e&&a===o){f=i[(a-1)*t+s];n[1]=o+(r-f)/(c-f)-.5}}))}i.contour=r;i.size=function(n){if(!arguments.length)return[t,e];var r=Math.floor(n[0]),u=Math.floor(n[1]);if(!(r>=0&&u>=0))ne("invalid size");return t=r,e=u,i};i.smooth=function(t){return arguments.length?(n=t?s:zM,i):n===s};return i}function LM(t){var e=0,n=t.length,i=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];while(++e<n)i+=t[e-1][1]*t[e][0]-t[e-1][0]*t[e][1];return i}function IM(t,e){var n=-1,i=e.length,r;while(++n<i)if(r=RM(t,e[n]))return r;return 0}function RM(t,e){var n=e[0],i=e[1],r=-1;for(var u=0,o=t.length,s=o-1;u<o;s=u++){var a=t[u],f=a[0],c=a[1],l=t[s],d=l[0],h=l[1];if(qM(a,l,e))return 0;if(c>i!==h>i&&n<(d-f)*(i-c)/(h-c)+f)r=-r}return r}function qM(t,e,n){var i;return UM(t,e,n)&&WM(t[i=+(t[0]===e[0])],n[i],e[i])}function UM(t,e,n){return(e[0]-t[0])*(n[1]-t[1])===(n[0]-t[0])*(e[1]-t[1])}function WM(t,e,n){return t<=e&&e<=n||n<=e&&e<=t}function GM(t,e,n){return function(i){var r=en(i),u=n?Math.min(r[0],0):r[0],o=r[1],s=o-u,a=e?$i(u,o,t):s/(t+1);return Li(u+a,o,a)}}function HM(t){Zf.call(this,null,t)}HM.Definition={type:"Isocontour",metadata:{generates:true},params:[{name:"field",type:"field"},{name:"thresholds",type:"number",array:true},{name:"levels",type:"number"},{name:"nice",type:"boolean",default:false},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"zero",type:"boolean",default:true},{name:"smooth",type:"boolean",default:true},{name:"scale",type:"number",expr:true},{name:"translate",type:"number",array:true,expr:true},{name:"as",type:"string",null:true,default:"contour"}]};fn(HM,Zf,{transform(t,e){if(this.value&&!e.changed()&&!t.modified()){return e.StopPropagation}var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=t.field||oe,u=PM().smooth(t.smooth!==false),o=t.thresholds||VM(i,r,t),s=t.as===null?null:t.as||"contour",a=[];i.forEach((e=>{const n=r(e);const i=u.size([n.width,n.height])(n.values,ve(o)?o:o(n.values));YM(i,n,e,t);i.forEach((t=>{a.push(Ia(e,Pa(s!=null?{[s]:t}:t)))}))}));if(this.value)n.rem=this.value;this.value=n.source=n.add=a;return n}});function VM(t,e,n){const i=GM(n.levels||10,n.nice,n.zero!==false);return n.resolve!=="shared"?i:i(t.map((t=>ji(e(t).values))))}function YM(t,e,n,i){let r=i.scale||e.scale,u=i.translate||e.translate;if(Ge(r))r=r(n,i);if(Ge(u))u=u(n,i);if((r===1||r==null)&&!u)return;const o=(pn(r)?r:r[0])||1,s=(pn(r)?r:r[1])||1,a=u&&u[0]||0,f=u&&u[1]||0;t.forEach(XM(e,o,s,a,f))}function XM(t,e,n,i,r){const u=t.x1||0,o=t.y1||0,s=e*n<0;function a(t){t.forEach(f)}function f(t){if(s)t.reverse();t.forEach(c)}function c(t){t[0]=(t[0]-u)*e+i;t[1]=(t[1]-o)*n+r}return function(t){t.coordinates.forEach(a);return t}}function JM(t,e,n){const i=t>=0?t:uc(e,n);return Math.round((Math.sqrt(4*i*i+1)-1)/2)}function QM(t){return Ge(t)?t:Ze(+t)}function ZM(){var t=t=>t[0],e=t=>t[1],n=ae,i=[-1,-1],r=960,u=500,o=2;function s(s,a){const f=JM(i[0],s,t)>>o,c=JM(i[1],s,e)>>o,l=f?f+2:0,d=c?c+2:0,h=2*l+(r>>o),p=2*d+(u>>o),m=new Float32Array(h*p),g=new Float32Array(h*p);let b=m;s.forEach((i=>{const r=l+(+t(i)>>o),u=d+(+e(i)>>o);if(r>=0&&r<h&&u>=0&&u<p){m[r+u*h]+=+n(i)}}));if(f>0&&c>0){KM(h,p,m,g,f);tB(h,p,g,m,c);KM(h,p,m,g,f);tB(h,p,g,m,c);KM(h,p,m,g,f);tB(h,p,g,m,c)}else if(f>0){KM(h,p,m,g,f);KM(h,p,g,m,f);KM(h,p,m,g,f);b=g}else if(c>0){tB(h,p,m,g,c);tB(h,p,g,m,c);tB(h,p,m,g,c);b=g}const v=a?Math.pow(2,-2*o):1/Ii(b);for(let t=0,e=h*p;t<e;++t)b[t]*=v;return{values:b,scale:1<<o,width:h,height:p,x1:l,y1:d,x2:l+(r>>o),y2:d+(u>>o)}}s.x=function(e){return arguments.length?(t=QM(e),s):t};s.y=function(t){return arguments.length?(e=QM(t),s):e};s.weight=function(t){return arguments.length?(n=QM(t),s):n};s.size=function(t){if(!arguments.length)return[r,u];var e=+t[0],n=+t[1];if(!(e>=0&&n>=0))ne("invalid size");return r=e,u=n,s};s.cellSize=function(t){if(!arguments.length)return 1<<o;if(!((t=+t)>=1))ne("invalid cell size");o=Math.floor(Math.log(t)/Math.LN2);return s};s.bandwidth=function(t){if(!arguments.length)return i;t=Ue(t);if(t.length===1)t=[+t[0],+t[0]];if(t.length!==2)ne("invalid bandwidth");return i=t,s};return s}function KM(t,e,n,i,r){const u=(r<<1)+1;for(let o=0;o<e;++o){for(let e=0,s=0;e<t+r;++e){if(e<t){s+=n[e+o*t]}if(e>=r){if(e>=u){s-=n[e-u+o*t]}i[e-r+o*t]=s/Math.min(e+1,t-1+u-e,u)}}}}function tB(t,e,n,i,r){const u=(r<<1)+1;for(let o=0;o<t;++o){for(let s=0,a=0;s<e+r;++s){if(s<e){a+=n[o+s*t]}if(s>=r){if(s>=u){a-=n[o+(s-u)*t]}i[o+(s-r)*t]=a/Math.min(s+1,e-1+u-s,u)}}}}function eB(t){Zf.call(this,null,t)}eB.Definition={type:"KDE2D",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"weight",type:"field"},{name:"groupby",type:"field",array:true},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number",array:true,length:2},{name:"counts",type:"boolean",default:false},{name:"as",type:"string",default:"grid"}]};const nB=["x","y","weight","size","cellSize","bandwidth"];function iB(t,e){nB.forEach((n=>e[n]!=null?t[n](e[n]):0));return t}fn(eB,Zf,{transform(t,e){if(this.value&&!e.changed()&&!t.modified())return e.StopPropagation;var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=e.materialize(e.SOURCE).source,r=rB(i,t.groupby),u=(t.groupby||[]).map(Qt),o=iB(ZM(),t),s=t.as||"grid",a=[];function f(t,e){for(let n=0;n<u.length;++n)t[u[n]]=e[n];return t}a=r.map((e=>Pa(f({[s]:o(e,t.counts)},e.dims))));if(this.value)n.rem=this.value;this.value=n.source=n.add=a;return n}});function rB(t,e){var n=[],i=t=>t(s),r,u,o,s,a,f;if(e==null){n.push(t)}else{for(r={},u=0,o=t.length;u<o;++u){s=t[u];a=e.map(i);f=r[a];if(!f){r[a]=f=[];f.dims=a;n.push(f)}f.push(s)}}return n}function uB(t){Zf.call(this,null,t)}uB.Definition={type:"Contour",metadata:{generates:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"values",type:"number",array:true},{name:"x",type:"field"},{name:"y",type:"field"},{name:"weight",type:"field"},{name:"cellSize",type:"number"},{name:"bandwidth",type:"number"},{name:"count",type:"number"},{name:"nice",type:"boolean",default:false},{name:"thresholds",type:"number",array:true},{name:"smooth",type:"boolean",default:true}]};fn(uB,Zf,{transform(t,e){if(this.value&&!e.changed()&&!t.modified()){return e.StopPropagation}var n=e.fork(e.NO_SOURCE|e.NO_FIELDS),i=PM().smooth(t.smooth!==false),r=t.values,u=t.thresholds||GM(t.count||10,t.nice,!!r),o=t.size,s,a;if(!r){r=e.materialize(e.SOURCE).source;s=iB(ZM(),t)(r,true);a=XM(s,s.scale||1,s.scale||1,0,0);o=[s.width,s.height];r=s.values}u=ve(u)?u:u(r);r=i.size(o)(r,u);if(a)r.forEach(a);if(this.value)n.rem=this.value;this.value=n.source=n.add=(r||[]).map(Pa);return n}});const oB="Feature";const sB="FeatureCollection";const aB="MultiPoint";function fB(t){Zf.call(this,null,t)}fB.Definition={type:"GeoJSON",metadata:{},params:[{name:"fields",type:"field",array:true,length:2},{name:"geojson",type:"field"}]};fn(fB,Zf,{transform(t,e){var n=this._features,i=this._points,r=t.fields,u=r&&r[0],o=r&&r[1],s=t.geojson||!r&&oe,a=e.ADD,f;f=t.modified()||e.changed(e.REM)||e.modified(Zt(s))||u&&e.modified(Zt(u))||o&&e.modified(Zt(o));if(!this.value||f){a=e.SOURCE;this._features=n=[];this._points=i=[]}if(s){e.visit(a,(t=>n.push(s(t))))}if(u&&o){e.visit(a,(t=>{var e=u(t),n=o(t);if(e!=null&&n!=null&&(e=+e)===e&&(n=+n)===n){i.push([e,n])}}));n=n.concat({type:oB,geometry:{type:aB,coordinates:i}})}this.value={type:sB,features:n}}});function cB(t){Zf.call(this,null,t)}cB.Definition={type:"GeoPath",metadata:{modifies:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"path"}]};fn(cB,Zf,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.field||oe,u=t.as||"path",o=n.SOURCE;if(!i||t.modified()){this.value=i=_M(t.projection);n.materialize().reflow()}else{o=r===oe||e.modified(r.fields)?n.ADD_MOD:n.ADD}const s=lB(i,t.pointRadius);n.visit(o,(t=>t[u]=i(r(t))));i.pointRadius(s);return n.modifies(u)}});function lB(t,e){const n=t.pointRadius();t.context(null);if(e!=null){t.pointRadius(e)}return n}function dB(t){Zf.call(this,null,t)}dB.Definition={type:"GeoPoint",metadata:{modifies:true},params:[{name:"projection",type:"projection",required:true},{name:"fields",type:"field",array:true,required:true,length:2},{name:"as",type:"string",array:true,length:2,default:["x","y"]}]};fn(dB,Zf,{transform(t,e){var n=t.projection,i=t.fields[0],r=t.fields[1],u=t.as||["x","y"],o=u[0],s=u[1],a;function f(t){const e=n([i(t),r(t)]);if(e){t[o]=e[0];t[s]=e[1]}else{t[o]=undefined;t[s]=undefined}}if(t.modified()){e=e.materialize().reflow(true).visit(e.SOURCE,f)}else{a=e.modified(i.fields)||e.modified(r.fields);e.visit(a?e.ADD_MOD:e.ADD,f)}return e.modifies(u)}});function hB(t){Zf.call(this,null,t)}hB.Definition={type:"GeoShape",metadata:{modifies:true,nomod:true},params:[{name:"projection",type:"projection"},{name:"field",type:"field",default:"datum"},{name:"pointRadius",type:"number",expr:true},{name:"as",type:"string",default:"shape"}]};fn(hB,Zf,{transform(t,e){var n=e.fork(e.ALL),i=this.value,r=t.as||"shape",u=n.ADD;if(!i||t.modified()){this.value=i=pB(_M(t.projection),t.field||re("datum"),t.pointRadius);n.materialize().reflow();u=n.SOURCE}n.visit(u,(t=>t[r]=i));return n.modifies(r)}});function pB(t,e,n){const i=n==null?n=>t(e(n)):i=>{var r=t.pointRadius(),u=t.pointRadius(n)(e(i));t.pointRadius(r);return u};i.context=e=>{t.context(e);return i};return i}function mB(t){Zf.call(this,[],t);this.generator=uj()}mB.Definition={type:"Graticule",metadata:{changes:true,generates:true},params:[{name:"extent",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMajor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"extentMinor",type:"array",array:true,length:2,content:{type:"number",array:true,length:2}},{name:"step",type:"number",array:true,length:2},{name:"stepMajor",type:"number",array:true,length:2,default:[90,360]},{name:"stepMinor",type:"number",array:true,length:2,default:[10,10]},{name:"precision",type:"number",default:2.5}]};fn(mB,Zf,{transform(t,e){var n=this.value,i=this.generator,r;if(!n.length||t.modified()){for(const e in t){if(Ge(i[e])){i[e](t[e])}}}r=i();if(n.length){e.mod.push(Ra(n[0],r))}else{e.add.push(Pa(r))}n[0]=r;return e}});function gB(t){Zf.call(this,null,t)}gB.Definition={type:"heatmap",metadata:{modifies:true},params:[{name:"field",type:"field"},{name:"color",type:"string",expr:true},{name:"opacity",type:"number",expr:true},{name:"resolve",type:"enum",values:["shared","independent"],default:"independent"},{name:"as",type:"string",default:"image"}]};fn(gB,Zf,{transform(t,e){if(!e.changed()&&!t.modified()){return e.StopPropagation}var n=e.materialize(e.SOURCE).source,i=t.resolve==="shared",r=t.field||oe,u=vB(t.opacity,t),o=bB(t.color,t),s=t.as||"image",a={$x:0,$y:0,$value:0,$max:i?ji(n.map((t=>ji(r(t).values)))):0};n.forEach((t=>{const e=r(t);const n=tn({},t,a);if(!i)n.$max=ji(e.values||[]);t[s]=wB(e,n,o.dep?o:Ze(o(n)),u.dep?u:Ze(u(n)))}));return e.reflow(true).modifies(s)}});function bB(t,e){let n;if(Ge(t)){n=n=>tt(t(n,e));n.dep=yB(t)}else{n=Ze(tt(t||"#888"))}return n}function vB(t,e){let n;if(Ge(t)){n=n=>t(n,e);n.dep=yB(t)}else if(t){n=Ze(t)}else{n=t=>t.$value/t.$max||0;n.dep=true}return n}function yB(t){if(!Ge(t))return false;const e=Cn(Zt(t));return e.$x||e.$y||e.$value||e.$max}function wB(t,e,n,i){const r=t.width,u=t.height,o=t.x1||0,s=t.y1||0,a=t.x2||r,f=t.y2||u,c=t.values,l=c?t=>c[t]:se,d=Wh(a-o,f-s),h=d.getContext("2d"),p=h.getImageData(0,0,a-o,f-s),m=p.data;for(let g=s,b=0;g<f;++g){e.$y=g-s;for(let t=o,u=g*r;t<a;++t,b+=4){e.$x=t-o;e.$value=l(t+u);const r=n(e);m[b+0]=r.r;m[b+1]=r.g;m[b+2]=r.b;m[b+3]=~~(255*i(e))}}h.putImageData(p,0,0);return d}function AB(t){Zf.call(this,null,t);this.modified(true)}fn(AB,Zf,{transform(t,e){let n=this.value;if(!n||t.modified("type")){this.value=n=OB(t.type);MM.forEach((e=>{if(t[e]!=null)FB(n,e,t[e])}))}else{MM.forEach((e=>{if(t.modified(e))FB(n,e,t[e])}))}if(t.pointRadius!=null)n.path.pointRadius(t.pointRadius);if(t.fit)xB(n,t);return e.fork(e.NO_SOURCE|e.NO_FIELDS)}});function xB(t,e){const n=DB(e.fit);e.extent?t.fitExtent(e.extent,n):e.size?t.fitSize(e.size,n):0}function OB(t){const e=SM((t||"mercator").toLowerCase());if(!e)ne("Unrecognized projection type: "+t);return e()}function FB(t,e,n){if(Ge(t[e]))t[e](n)}function DB(t){t=Ue(t);return t.length===1?t[0]:{type:sB,features:t.reduce(((t,e)=>t.concat(kB(e))),[])}}function kB(t){return t.type===sB?t.features:Ue(t).filter((t=>t!=null)).map((t=>t.type===oB?t:{type:oB,geometry:t}))}const EB=Object.freeze({__proto__:null,contour:uB,geojson:fB,geopath:cB,geopoint:dB,geoshape:hB,graticule:mB,heatmap:gB,isocontour:HM,kde2d:eB,projection:AB});function $B(t,e,n){var i=new nt,r=e;if(e==null)return i.restart(t,e,n),i;i._restart=i.restart;i.restart=function(t,e,n){e=+e,n=n==null?et():+n;i._restart((function u(o){o+=r;i._restart(u,r+=e,n);t(o)}),e,n)};i.restart(t,e,n);return i}const jB={center:rt,collide:ut,nbody:ot,link:st,x:at,y:ft};const CB="forces",MB=["alpha","alphaMin","alphaTarget","velocityDecay","forces"],BB=["static","iterations"],SB=["x","y","vx","vy"];function _B(t){Zf.call(this,null,t)}_B.Definition={type:"Force",metadata:{modifies:true},params:[{name:"static",type:"boolean",default:false},{name:"restart",type:"boolean",default:false},{name:"iterations",type:"number",default:300},{name:"alpha",type:"number",default:1},{name:"alphaMin",type:"number",default:.001},{name:"alphaTarget",type:"number",default:0},{name:"velocityDecay",type:"number",default:.4},{name:"forces",type:"param",array:true,params:[{key:{force:"center"},params:[{name:"x",type:"number",default:0},{name:"y",type:"number",default:0}]},{key:{force:"collide"},params:[{name:"radius",type:"number",expr:true},{name:"strength",type:"number",default:.7},{name:"iterations",type:"number",default:1}]},{key:{force:"nbody"},params:[{name:"strength",type:"number",default:-30},{name:"theta",type:"number",default:.9},{name:"distanceMin",type:"number",default:1},{name:"distanceMax",type:"number"}]},{key:{force:"link"},params:[{name:"links",type:"data"},{name:"id",type:"field"},{name:"distance",type:"number",default:30,expr:true},{name:"strength",type:"number",expr:true},{name:"iterations",type:"number",default:1}]},{key:{force:"x"},params:[{name:"strength",type:"number",default:.1},{name:"x",type:"field"}]},{key:{force:"y"},params:[{name:"strength",type:"number",default:.1},{name:"y",type:"field"}]}]},{name:"as",type:"string",array:true,modify:false,default:SB}]};fn(_B,Zf,{transform(t,e){var n=this.value,i=e.changed(e.ADD_REM),r=t.modified(MB),u=t.iterations||300;if(!n){this.value=n=zB(e.source,t);n.on("tick",NB(e.dataflow,this));if(!t.static){i=true;n.tick()}e.modifies("index")}else{if(i){e.modifies("index");n.nodes(e.source)}if(r||e.changed(e.MOD)){TB(n,t,0,e)}}if(r||i||t.modified(BB)||e.changed()&&t.restart){n.alpha(Math.max(n.alpha(),t.alpha||1)).alphaDecay(1-Math.pow(n.alphaMin(),1/u));if(t.static){for(n.stop();--u>=0;)n.tick()}else{if(n.stopped())n.restart();if(!i)return e.StopPropagation}}return this.finish(t,e)},finish(t,e){const n=e.dataflow;for(let s=this._argops,a=0,f=s.length,c;a<f;++a){c=s[a];if(c.name!==CB||c.op._argval.force!=="link"){continue}for(var i=c.op._argops,r=0,u=i.length,o;r<u;++r){if(i[r].name==="links"&&(o=i[r].op.source)){n.pulse(o,n.changeset().reflow());break}}}return e.reflow(t.modified()).modifies(SB)}});function NB(t,e){return()=>t.touch(e).run()}function zB(t,e){const n=it(t),i=n.stop,r=n.restart;let u=false;n.stopped=()=>u;n.restart=()=>(u=false,r());n.stop=()=>(u=true,i());return TB(n,e,true).on("end",(()=>u=true))}function TB(t,e,n,i){var r=Ue(e.forces),u,o,s,a;for(u=0,o=MB.length;u<o;++u){s=MB[u];if(s!==CB&&e.modified(s))t[s](e[s])}for(u=0,o=r.length;u<o;++u){a=CB+u;s=n||e.modified(CB,u)?LB(r[u]):i&&PB(r[u],i)?t.force(a):null;if(s)t.force(a,s)}for(o=t.numForces||0;u<o;++u){t.force(CB+u,null)}t.numForces=r.length;return t}function PB(t,e){var n,i;for(n in t){if(Ge(i=t[n])&&e.modified(Zt(i)))return 1}return 0}function LB(t){var e,n;if(!un(jB,t.force)){ne("Unrecognized force: "+t.force)}e=jB[t.force]();for(n in t){if(Ge(e[n]))IB(e[n],t[n],t)}return e}function IB(t,e,n){t(Ge(e)?t=>e(t,n):e)}const RB=Object.freeze({__proto__:null,force:_B});function qB(t,e){return t.parent===e.parent?1:2}function UB(t){return t.reduce(WB,0)/t.length}function WB(t,e){return t+e.x}function GB(t){return 1+t.reduce(HB,0)}function HB(t,e){return Math.max(t,e.y)}function VB(t){var e;while(e=t.children)t=e[0];return t}function YB(t){var e;while(e=t.children)t=e[e.length-1];return t}function XB(){var t=qB,e=1,n=1,i=false;function r(r){var u,o=0;r.eachAfter((function(e){var n=e.children;if(n){e.x=UB(n);e.y=GB(n)}else{e.x=u?o+=t(e,u):0;e.y=0;u=e}}));var s=VB(r),a=YB(r),f=s.x-t(s,a)/2,c=a.x+t(a,s)/2;return r.eachAfter(i?function(t){t.x=(t.x-r.x)*e;t.y=(r.y-t.y)*n}:function(t){t.x=(t.x-f)/(c-f)*e;t.y=(1-(r.y?t.y/r.y:1))*n})}r.separation=function(e){return arguments.length?(t=e,r):t};r.size=function(t){return arguments.length?(i=false,e=+t[0],n=+t[1],r):i?null:[e,n]};r.nodeSize=function(t){return arguments.length?(i=true,e=+t[0],n=+t[1],r):i?[e,n]:null};return r}function JB(t){var e=0,n=t.children,i=n&&n.length;if(!i)e=1;else while(--i>=0)e+=n[i].value;t.value=e}function QB(){return this.eachAfter(JB)}function ZB(t,e){let n=-1;for(const i of this){t.call(e,i,++n,this)}return this}function KB(t,e){var n=this,i=[n],r,u,o=-1;while(n=i.pop()){t.call(e,n,++o,this);if(r=n.children){for(u=r.length-1;u>=0;--u){i.push(r[u])}}}return this}function tS(t,e){var n=this,i=[n],r=[],u,o,s,a=-1;while(n=i.pop()){r.push(n);if(u=n.children){for(o=0,s=u.length;o<s;++o){i.push(u[o])}}}while(n=r.pop()){t.call(e,n,++a,this)}return this}function eS(t,e){let n=-1;for(const i of this){if(t.call(e,i,++n,this)){return i}}}function nS(t){return this.eachAfter((function(e){var n=+t(e.data)||0,i=e.children,r=i&&i.length;while(--r>=0)n+=i[r].value;e.value=n}))}function iS(t){return this.eachBefore((function(e){if(e.children){e.children.sort(t)}}))}function rS(t){var e=this,n=uS(e,t),i=[e];while(e!==n){e=e.parent;i.push(e)}var r=i.length;while(t!==n){i.splice(r,0,t);t=t.parent}return i}function uS(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),r=null;t=n.pop();e=i.pop();while(t===e){r=t;t=n.pop();e=i.pop()}return r}function oS(){var t=this,e=[t];while(t=t.parent){e.push(t)}return e}function sS(){return Array.from(this)}function aS(){var t=[];this.eachBefore((function(e){if(!e.children){t.push(e)}}));return t}function fS(){var t=this,e=[];t.each((function(n){if(n!==t){e.push({source:n.parent,target:n})}}));return e}function*cS(){var t=this,e,n=[t],i,r,u;do{e=n.reverse(),n=[];while(t=e.pop()){yield t;if(i=t.children){for(r=0,u=i.length;r<u;++r){n.push(i[r])}}}}while(n.length)}function lS(t,e){if(t instanceof Map){t=[undefined,t];if(e===undefined)e=pS}else if(e===undefined){e=hS}var n=new bS(t),i,r=[n],u,o,s,a;while(i=r.pop()){if((o=e(i.data))&&(a=(o=Array.from(o)).length)){i.children=o;for(s=a-1;s>=0;--s){r.push(u=o[s]=new bS(o[s]));u.parent=i;u.depth=i.depth+1}}}return n.eachBefore(gS)}function dS(){return lS(this).eachBefore(mS)}function hS(t){return t.children}function pS(t){return Array.isArray(t)?t[1]:null}function mS(t){if(t.data.value!==undefined)t.value=t.data.value;t.data=t.data.data}function gS(t){var e=0;do{t.height=e}while((t=t.parent)&&t.height<++e)}function bS(t){this.data=t;this.depth=this.height=0;this.parent=null}bS.prototype=lS.prototype={constructor:bS,count:QB,each:ZB,eachAfter:tS,eachBefore:KB,find:eS,sum:nS,sort:iS,path:rS,ancestors:oS,descendants:sS,leaves:aS,links:fS,copy:dS,[Symbol.iterator]:cS};function vS(t){return t==null?null:yS(t)}function yS(t){if(typeof t!=="function")throw new Error;return t}function wS(){return 0}function AS(t){return function(){return t}}const xS=1664525;const OS=1013904223;const FS=4294967296;function DS(){let t=1;return()=>(t=(xS*t+OS)%FS)/FS}function kS(t){return typeof t==="object"&&"length"in t?t:Array.from(t)}function ES(t,e){let n=t.length,i,r;while(n){r=e()*n--|0;i=t[n];t[n]=t[r];t[r]=i}return t}function $S(t,e){var n=0,i=(t=ES(Array.from(t),e)).length,r=[],u,o;while(n<i){u=t[n];if(o&&MS(o,u))++n;else o=SS(r=jS(r,u)),n=0}return o}function jS(t,e){var n,i;if(BS(e,t))return[e];for(n=0;n<t.length;++n){if(CS(e,t[n])&&BS(NS(t[n],e),t)){return[t[n],e]}}for(n=0;n<t.length-1;++n){for(i=n+1;i<t.length;++i){if(CS(NS(t[n],t[i]),e)&&CS(NS(t[n],e),t[i])&&CS(NS(t[i],e),t[n])&&BS(zS(t[n],t[i],e),t)){return[t[n],t[i],e]}}}throw new Error}function CS(t,e){var n=t.r-e.r,i=e.x-t.x,r=e.y-t.y;return n<0||n*n<i*i+r*r}function MS(t,e){var n=t.r-e.r+Math.max(t.r,e.r,1)*1e-9,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function BS(t,e){for(var n=0;n<e.length;++n){if(!MS(t,e[n])){return false}}return true}function SS(t){switch(t.length){case 1:return _S(t[0]);case 2:return NS(t[0],t[1]);case 3:return zS(t[0],t[1],t[2])}}function _S(t){return{x:t.x,y:t.y,r:t.r}}function NS(t,e){var n=t.x,i=t.y,r=t.r,u=e.x,o=e.y,s=e.r,a=u-n,f=o-i,c=s-r,l=Math.sqrt(a*a+f*f);return{x:(n+u+a/l*c)/2,y:(i+o+f/l*c)/2,r:(l+r+s)/2}}function zS(t,e,n){var i=t.x,r=t.y,u=t.r,o=e.x,s=e.y,a=e.r,f=n.x,c=n.y,l=n.r,d=i-o,h=i-f,p=r-s,m=r-c,g=a-u,b=l-u,v=i*i+r*r-u*u,y=v-o*o-s*s+a*a,w=v-f*f-c*c+l*l,A=h*p-d*m,x=(p*w-m*y)/(A*2)-i,O=(m*g-p*b)/A,F=(h*y-d*w)/(A*2)-r,D=(d*b-h*g)/A,k=O*O+D*D-1,E=2*(u+x*O+F*D),$=x*x+F*F-u*u,j=-(Math.abs(k)>1e-6?(E+Math.sqrt(E*E-4*k*$))/(2*k):$/E);return{x:i+x+O*j,y:r+F+D*j,r:j}}function TS(t,e,n){var i=t.x-e.x,r,u,o=t.y-e.y,s,a,f=i*i+o*o;if(f){u=e.r+n.r,u*=u;a=t.r+n.r,a*=a;if(u>a){r=(f+a-u)/(2*f);s=Math.sqrt(Math.max(0,a/f-r*r));n.x=t.x-r*i-s*o;n.y=t.y-r*o+s*i}else{r=(f+u-a)/(2*f);s=Math.sqrt(Math.max(0,u/f-r*r));n.x=e.x+r*i-s*o;n.y=e.y+r*o+s*i}}else{n.x=e.x+n.r;n.y=e.y}}function PS(t,e){var n=t.r+e.r-1e-6,i=e.x-t.x,r=e.y-t.y;return n>0&&n*n>i*i+r*r}function LS(t){var e=t._,n=t.next._,i=e.r+n.r,r=(e.x*n.r+n.x*e.r)/i,u=(e.y*n.r+n.y*e.r)/i;return r*r+u*u}function IS(t){this._=t;this.next=null;this.previous=null}function RS(t,e){if(!(u=(t=kS(t)).length))return 0;var n,i,r,u,o,s,a,f,c,l,d;n=t[0],n.x=0,n.y=0;if(!(u>1))return n.r;i=t[1],n.x=-i.r,i.x=n.r,i.y=0;if(!(u>2))return n.r+i.r;TS(i,n,r=t[2]);n=new IS(n),i=new IS(i),r=new IS(r);n.next=r.previous=i;i.next=n.previous=r;r.next=i.previous=n;t:for(a=3;a<u;++a){TS(n._,i._,r=t[a]),r=new IS(r);f=i.next,c=n.previous,l=i._.r,d=n._.r;do{if(l<=d){if(PS(f._,r._)){i=f,n.next=i,i.previous=n,--a;continue t}l+=f._.r,f=f.next}else{if(PS(c._,r._)){n=c,n.next=i,i.previous=n,--a;continue t}d+=c._.r,c=c.previous}}while(f!==c.next);r.previous=n,r.next=i,n.next=i.previous=i=r;o=LS(n);while((r=r.next)!==i){if((s=LS(r))<o){n=r,o=s}}i=n.next}n=[i._],r=i;while((r=r.next)!==i)n.push(r._);r=$S(n,e);for(a=0;a<u;++a)n=t[a],n.x-=r.x,n.y-=r.y;return r.r}function qS(t){return Math.sqrt(t.value)}function US(){var t=null,e=1,n=1,i=wS;function r(r){const u=DS();r.x=e/2,r.y=n/2;if(t){r.eachBefore(WS(t)).eachAfter(GS(i,.5,u)).eachBefore(HS(1))}else{r.eachBefore(WS(qS)).eachAfter(GS(wS,1,u)).eachAfter(GS(i,r.r/Math.min(e,n),u)).eachBefore(HS(Math.min(e,n)/(2*r.r)))}return r}r.radius=function(e){return arguments.length?(t=vS(e),r):t};r.size=function(t){return arguments.length?(e=+t[0],n=+t[1],r):[e,n]};r.padding=function(t){return arguments.length?(i=typeof t==="function"?t:AS(+t),r):i};return r}function WS(t){return function(e){if(!e.children){e.r=Math.max(0,+t(e)||0)}}}function GS(t,e,n){return function(i){if(r=i.children){var r,u,o=r.length,s=t(i)*e||0,a;if(s)for(u=0;u<o;++u)r[u].r+=s;a=RS(r,n);if(s)for(u=0;u<o;++u)r[u].r-=s;i.r=a+s}}}function HS(t){return function(e){var n=e.parent;e.r*=t;if(n){e.x=n.x+t*e.x;e.y=n.y+t*e.y}}}function VS(t){t.x0=Math.round(t.x0);t.y0=Math.round(t.y0);t.x1=Math.round(t.x1);t.y1=Math.round(t.y1)}function YS(t,e,n,i,r){var u=t.children,o,s=-1,a=u.length,f=t.value&&(i-e)/t.value;while(++s<a){o=u[s],o.y0=n,o.y1=r;o.x0=e,o.x1=e+=o.value*f}}function XS(){var t=1,e=1,n=0,i=false;function r(r){var o=r.height+1;r.x0=r.y0=n;r.x1=t;r.y1=e/o;r.eachBefore(u(e,o));if(i)r.eachBefore(VS);return r}function u(t,e){return function(i){if(i.children){YS(i,i.x0,t*(i.depth+1)/e,i.x1,t*(i.depth+2)/e)}var r=i.x0,u=i.y0,o=i.x1-n,s=i.y1-n;if(o<r)r=o=(r+o)/2;if(s<u)u=s=(u+s)/2;i.x0=r;i.y0=u;i.x1=o;i.y1=s}}r.round=function(t){return arguments.length?(i=!!t,r):i};r.size=function(n){return arguments.length?(t=+n[0],e=+n[1],r):[t,e]};r.padding=function(t){return arguments.length?(n=+t,r):n};return r}var JS={depth:-1},QS={},ZS={};function KS(t){return t.id}function t_(t){return t.parentId}function e_(){var t=KS,e=t_,n;function i(i){var r=Array.from(i),u=t,o=e,s,a,f,c,l,d,h,p,m=new Map;if(n!=null){const t=r.map(((t,e)=>n_(n(t,e,i))));const e=t.map(i_);const s=new Set(t).add("");for(const n of e){if(!s.has(n)){s.add(n);t.push(n);e.push(i_(n));r.push(ZS)}}u=(e,n)=>t[n];o=(t,n)=>e[n]}for(f=0,s=r.length;f<s;++f){a=r[f],d=r[f]=new bS(a);if((h=u(a,f,i))!=null&&(h+="")){p=d.id=h;m.set(p,m.has(p)?QS:d)}if((h=o(a,f,i))!=null&&(h+="")){d.parent=h}}for(f=0;f<s;++f){d=r[f];if(h=d.parent){l=m.get(h);if(!l)throw new Error("missing: "+h);if(l===QS)throw new Error("ambiguous: "+h);if(l.children)l.children.push(d);else l.children=[d];d.parent=l}else{if(c)throw new Error("multiple roots");c=d}}if(!c)throw new Error("no root");if(n!=null){while(c.data===ZS&&c.children.length===1){c=c.children[0],--s}for(let t=r.length-1;t>=0;--t){d=r[t];if(d.data!==ZS)break;d.data=null}}c.parent=JS;c.eachBefore((function(t){t.depth=t.parent.depth+1;--s})).eachBefore(gS);c.parent=null;if(s>0)throw new Error("cycle");return c}i.id=function(e){return arguments.length?(t=vS(e),i):t};i.parentId=function(t){return arguments.length?(e=vS(t),i):e};i.path=function(t){return arguments.length?(n=vS(t),i):n};return i}function n_(t){t=`${t}`;let e=t.length;if(r_(t,e-1)&&!r_(t,e-2))t=t.slice(0,-1);return t[0]==="/"?t:`/${t}`}function i_(t){let e=t.length;if(e<2)return"";while(--e>1)if(r_(t,e))break;return t.slice(0,e)}function r_(t,e){if(t[e]==="/"){let n=0;while(e>0&&t[--e]==="\\")++n;if((n&1)===0)return true}return false}function u_(t,e){return t.parent===e.parent?1:2}function o_(t){var e=t.children;return e?e[0]:t.t}function s_(t){var e=t.children;return e?e[e.length-1]:t.t}function a_(t,e,n){var i=n/(e.i-t.i);e.c-=i;e.s+=n;t.c+=i;e.z+=n;e.m+=n}function f_(t){var e=0,n=0,i=t.children,r=i.length,u;while(--r>=0){u=i[r];u.z+=e;u.m+=e;e+=u.s+(n+=u.c)}}function c_(t,e,n){return t.a.parent===e.parent?t.a:n}function l_(t,e){this._=t;this.parent=null;this.children=null;this.A=null;this.a=this;this.z=0;this.m=0;this.c=0;this.s=0;this.t=null;this.i=e}l_.prototype=Object.create(bS.prototype);function d_(t){var e=new l_(t,0),n,i=[e],r,u,o,s;while(n=i.pop()){if(u=n._.children){n.children=new Array(s=u.length);for(o=s-1;o>=0;--o){i.push(r=n.children[o]=new l_(u[o],o));r.parent=n}}}(e.parent=new l_(null,0)).children=[e];return e}function h_(){var t=u_,e=1,n=1,i=null;function r(r){var s=d_(r);s.eachAfter(u),s.parent.m=-s.z;s.eachBefore(o);if(i)r.eachBefore(a);else{var f=r,c=r,l=r;r.eachBefore((function(t){if(t.x<f.x)f=t;if(t.x>c.x)c=t;if(t.depth>l.depth)l=t}));var d=f===c?1:t(f,c)/2,h=d-f.x,p=e/(c.x+d+h),m=n/(l.depth||1);r.eachBefore((function(t){t.x=(t.x+h)*p;t.y=t.depth*m}))}return r}function u(e){var n=e.children,i=e.parent.children,r=e.i?i[e.i-1]:null;if(n){f_(e);var u=(n[0].z+n[n.length-1].z)/2;if(r){e.z=r.z+t(e._,r._);e.m=e.z-u}else{e.z=u}}else if(r){e.z=r.z+t(e._,r._)}e.parent.A=s(e,r,e.parent.A||i[0])}function o(t){t._.x=t.z+t.parent.m;t.m+=t.parent.m}function s(e,n,i){if(n){var r=e,u=e,o=n,s=r.parent.children[0],a=r.m,f=u.m,c=o.m,l=s.m,d;while(o=s_(o),r=o_(r),o&&r){s=o_(s);u=s_(u);u.a=e;d=o.z+c-r.z-a+t(o._,r._);if(d>0){a_(c_(o,e,i),e,d);a+=d;f+=d}c+=o.m;a+=r.m;l+=s.m;f+=u.m}if(o&&!s_(u)){u.t=o;u.m+=c-f}if(r&&!o_(s)){s.t=r;s.m+=a-l;i=e}}return i}function a(t){t.x*=e;t.y=t.depth*n}r.separation=function(e){return arguments.length?(t=e,r):t};r.size=function(t){return arguments.length?(i=false,e=+t[0],n=+t[1],r):i?null:[e,n]};r.nodeSize=function(t){return arguments.length?(i=true,e=+t[0],n=+t[1],r):i?[e,n]:null};return r}function p_(t,e,n,i,r){var u=t.children,o,s=-1,a=u.length,f=t.value&&(r-n)/t.value;while(++s<a){o=u[s],o.x0=e,o.x1=i;o.y0=n,o.y1=n+=o.value*f}}var m_=(1+Math.sqrt(5))/2;function g_(t,e,n,i,r,u){var o=[],s=e.children,a,f,c=0,l=0,d=s.length,h,p,m=e.value,g,b,v,y,w,A,x;while(c<d){h=r-n,p=u-i;do{g=s[l++].value}while(!g&&l<d);b=v=g;A=Math.max(p/h,h/p)/(m*t);x=g*g*A;w=Math.max(v/x,x/b);for(;l<d;++l){g+=f=s[l].value;if(f<b)b=f;if(f>v)v=f;x=g*g*A;y=Math.max(v/x,x/b);if(y>w){g-=f;break}w=y}o.push(a={value:g,dice:h<p,children:s.slice(c,l)});if(a.dice)YS(a,n,i,r,m?i+=p*g/m:u);else p_(a,n,i,m?n+=h*g/m:r,u);m-=g,c=l}return o}const b_=function t(e){function n(t,n,i,r,u){g_(e,t,n,i,r,u)}n.ratio=function(e){return t((e=+e)>1?e:1)};return n}(m_);function v_(){var t=b_,e=false,n=1,i=1,r=[0],u=wS,o=wS,s=wS,a=wS,f=wS;function c(t){t.x0=t.y0=0;t.x1=n;t.y1=i;t.eachBefore(l);r=[0];if(e)t.eachBefore(VS);return t}function l(e){var n=r[e.depth],i=e.x0+n,c=e.y0+n,l=e.x1-n,d=e.y1-n;if(l<i)i=l=(i+l)/2;if(d<c)c=d=(c+d)/2;e.x0=i;e.y0=c;e.x1=l;e.y1=d;if(e.children){n=r[e.depth+1]=u(e)/2;i+=f(e)-n;c+=o(e)-n;l-=s(e)-n;d-=a(e)-n;if(l<i)i=l=(i+l)/2;if(d<c)c=d=(c+d)/2;t(e,i,c,l,d)}}c.round=function(t){return arguments.length?(e=!!t,c):e};c.size=function(t){return arguments.length?(n=+t[0],i=+t[1],c):[n,i]};c.tile=function(e){return arguments.length?(t=yS(e),c):t};c.padding=function(t){return arguments.length?c.paddingInner(t).paddingOuter(t):c.paddingInner()};c.paddingInner=function(t){return arguments.length?(u=typeof t==="function"?t:AS(+t),c):u};c.paddingOuter=function(t){return arguments.length?c.paddingTop(t).paddingRight(t).paddingBottom(t).paddingLeft(t):c.paddingTop()};c.paddingTop=function(t){return arguments.length?(o=typeof t==="function"?t:AS(+t),c):o};c.paddingRight=function(t){return arguments.length?(s=typeof t==="function"?t:AS(+t),c):s};c.paddingBottom=function(t){return arguments.length?(a=typeof t==="function"?t:AS(+t),c):a};c.paddingLeft=function(t){return arguments.length?(f=typeof t==="function"?t:AS(+t),c):f};return c}function y_(t,e,n,i,r){var u=t.children,o,s=u.length,a,f=new Array(s+1);for(f[0]=a=o=0;o<s;++o){f[o+1]=a+=u[o].value}c(0,s,t.value,e,n,i,r);function c(t,e,n,i,r,o,s){if(t>=e-1){var a=u[t];a.x0=i,a.y0=r;a.x1=o,a.y1=s;return}var l=f[t],d=n/2+l,h=t+1,p=e-1;while(h<p){var m=h+p>>>1;if(f[m]<d)h=m+1;else p=m}if(d-f[h-1]<f[h]-d&&t+1<h)--h;var g=f[h]-l,b=n-g;if(o-i>s-r){var v=n?(i*b+o*g)/n:o;c(t,h,g,i,r,v,s);c(h,e,b,v,r,o,s)}else{var y=n?(r*b+s*g)/n:s;c(t,h,g,i,r,o,y);c(h,e,b,i,y,o,s)}}}function w_(t,e,n,i,r){(t.depth&1?p_:YS)(t,e,n,i,r)}const A_=function t(e){function n(t,n,i,r,u){if((o=t._squarify)&&o.ratio===e){var o,s,a,f,c=-1,l,d=o.length,h=t.value;while(++c<d){s=o[c],a=s.children;for(f=s.value=0,l=a.length;f<l;++f)s.value+=a[f].value;if(s.dice)YS(s,n,i,r,h?i+=(u-i)*s.value/h:u);else p_(s,n,i,h?n+=(r-n)*s.value/h:r,u);h-=s.value}}else{t._squarify=o=g_(e,t,n,i,r,u);o.ratio=e}}n.ratio=function(e){return t((e=+e)>1?e:1)};return n}(m_);function x_(t,e,n){const i={};t.each((t=>{const r=t.data;if(n(r))i[e(r)]=t}));t.lookup=i;return t}function O_(t){Zf.call(this,null,t)}O_.Definition={type:"Nest",metadata:{treesource:true,changes:true},params:[{name:"keys",type:"field",array:true},{name:"generate",type:"boolean"}]};const F_=t=>t.values;fn(O_,Zf,{transform(t,e){if(!e.source){ne("Nest transform requires an upstream data source.")}var n=t.generate,i=t.modified(),r=e.clone(),u=this.value;if(!u||i||e.changed()){if(u){u.each((t=>{if(t.children&&Na(t.data)){r.rem.push(t.data)}}))}this.value=u=lS({values:Ue(t.keys).reduce(((t,e)=>{t.key(e);return t}),D_()).entries(r.source)},F_);if(n){u.each((t=>{if(t.children){t=Pa(t.data);r.add.push(t);r.source.push(t)}}))}x_(u,za,za)}r.source.root=u;return r}});function D_(){const t=[],e={entries:t=>i(n(t,0),0),key:n=>(t.push(n),e)};function n(e,i){if(i>=t.length){return e}const r=e.length,u=t[i++],o={},s={};let a=-1,f,c,l;while(++a<r){f=u(c=e[a])+"";if(l=o[f]){l.push(c)}else{o[f]=[c]}}for(f in o){s[f]=n(o[f],i)}return s}function i(e,n){if(++n>t.length)return e;const r=[];for(const t in e){r.push({key:t,values:i(e[t],n)})}return r}return e}function k_(t){Zf.call(this,null,t)}const E_=(t,e)=>t.parent===e.parent?1:2;fn(k_,Zf,{transform(t,e){if(!e.source||!e.source.root){ne(this.constructor.name+" transform requires a backing tree data source.")}const n=this.layout(t.method),i=this.fields,r=e.source.root,u=t.as||i;if(t.field)r.sum(t.field);else r.count();if(t.sort)r.sort(qa(t.sort,(t=>t.data)));$_(n,this.params,t);if(n.separation){n.separation(t.separation!==false?E_:ae)}try{this.value=n(r)}catch(o){ne(o)}r.each((t=>j_(t,i,u)));return e.reflow(t.modified()).modifies(u).modifies("leaf")}});function $_(t,e,n){for(let i,r=0,u=e.length;r<u;++r){i=e[r];if(i in n)t[i](n[i])}}function j_(t,e,n){const i=t.data,r=e.length-1;for(let u=0;u<r;++u){i[n[u]]=t[e[u]]}i[n[r]]=t.children?t.children.length:0}const C_=["x","y","r","depth","children"];function M_(t){k_.call(this,t)}M_.Definition={type:"Pack",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"radius",type:"field",default:null},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:C_.length,default:C_}]};fn(M_,k_,{layout:US,params:["radius","size","padding"],fields:C_});const B_=["x0","y0","x1","y1","depth","children"];function S_(t){k_.call(this,t)}S_.Definition={type:"Partition",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"padding",type:"number",default:0},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:B_.length,default:B_}]};fn(S_,k_,{layout:XS,params:["size","round","padding"],fields:B_});function __(t){Zf.call(this,null,t)}__.Definition={type:"Stratify",metadata:{treesource:true},params:[{name:"key",type:"field",required:true},{name:"parentKey",type:"field",required:true}]};fn(__,Zf,{transform(t,e){if(!e.source){ne("Stratify transform requires an upstream data source.")}let n=this.value;const i=t.modified(),r=e.fork(e.ALL).materialize(e.SOURCE),u=!n||i||e.changed(e.ADD_REM)||e.modified(t.key.fields)||e.modified(t.parentKey.fields);r.source=r.source.slice();if(u){n=r.source.length?x_(e_().id(t.key).parentId(t.parentKey)(r.source),t.key,fe):x_(e_()([{}]),t.key,t.key)}r.source.root=this.value=n;return r}});const N_={tidy:h_,cluster:XB};const z_=["x","y","depth","children"];function T_(t){k_.call(this,t)}T_.Definition={type:"Tree",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"tidy",values:["tidy","cluster"]},{name:"size",type:"number",array:true,length:2},{name:"nodeSize",type:"number",array:true,length:2},{name:"separation",type:"boolean",default:true},{name:"as",type:"string",array:true,length:z_.length,default:z_}]};fn(T_,k_,{layout(t){const e=t||"tidy";if(un(N_,e))return N_[e]();else ne("Unrecognized Tree layout method: "+e)},params:["size","nodeSize"],fields:z_});function P_(t){Zf.call(this,[],t)}P_.Definition={type:"TreeLinks",metadata:{tree:true,generates:true,changes:true},params:[]};fn(P_,Zf,{transform(t,e){const n=this.value,i=e.source&&e.source.root,r=e.fork(e.NO_SOURCE),u={};if(!i)ne("TreeLinks transform requires a tree data source.");if(e.changed(e.ADD_REM)){r.rem=n;e.visit(e.SOURCE,(t=>u[za(t)]=1));i.each((t=>{const e=t.data,n=t.parent&&t.parent.data;if(n&&u[za(e)]&&u[za(n)]){r.add.push(Pa({source:n,target:e}))}}));this.value=r.add}else if(e.changed(e.MOD)){e.visit(e.MOD,(t=>u[za(t)]=1));n.forEach((t=>{if(u[za(t.source)]||u[za(t.target)]){r.mod.push(t)}}))}return r}});const L_={binary:y_,dice:YS,slice:p_,slicedice:w_,squarify:b_,resquarify:A_};const I_=["x0","y0","x1","y1","depth","children"];function R_(t){k_.call(this,t)}R_.Definition={type:"Treemap",metadata:{tree:true,modifies:true},params:[{name:"field",type:"field"},{name:"sort",type:"compare"},{name:"method",type:"enum",default:"squarify",values:["squarify","resquarify","binary","dice","slice","slicedice"]},{name:"padding",type:"number",default:0},{name:"paddingInner",type:"number",default:0},{name:"paddingOuter",type:"number",default:0},{name:"paddingTop",type:"number",default:0},{name:"paddingRight",type:"number",default:0},{name:"paddingBottom",type:"number",default:0},{name:"paddingLeft",type:"number",default:0},{name:"ratio",type:"number",default:1.618033988749895},{name:"round",type:"boolean",default:false},{name:"size",type:"number",array:true,length:2},{name:"as",type:"string",array:true,length:I_.length,default:I_}]};fn(R_,k_,{layout(){const t=v_();t.ratio=e=>{const n=t.tile();if(n.ratio)t.tile(n.ratio(e))};t.method=e=>{if(un(L_,e))t.tile(L_[e]);else ne("Unrecognized Treemap layout method: "+e)};return t},params:["method","ratio","size","round","padding","paddingInner","paddingOuter","paddingTop","paddingRight","paddingBottom","paddingLeft"],fields:I_});const q_=Object.freeze({__proto__:null,nest:O_,pack:M_,partition:S_,stratify:__,tree:T_,treelinks:P_,treemap:R_});const U_=4278190080;function W_(t,e){const n=t.bitmap();(e||[]).forEach((e=>n.set(t(e.boundary[0]),t(e.boundary[3]))));return[n,undefined]}function G_(t,e,n,i,r){const u=t.width,o=t.height,s=i||r,a=Wh(u,o).getContext("2d"),f=Wh(u,o).getContext("2d"),c=s&&Wh(u,o).getContext("2d");n.forEach((t=>V_(a,t,false)));V_(f,e,false);if(s){V_(c,e,true)}const l=H_(a,u,o),d=H_(f,u,o),h=s&&H_(c,u,o),p=t.bitmap(),m=s&&t.bitmap();let g,b,v,y,w,A,x,O;for(b=0;b<o;++b){for(g=0;g<u;++g){w=b*u+g;A=l[w]&U_;O=d[w]&U_;x=s&&h[w]&U_;if(A||x||O){v=t(g);y=t(b);if(!r&&(A||O))p.set(v,y);if(s&&(A||x))m.set(v,y)}}}return[p,m]}function H_(t,e,n){return new Uint32Array(t.getImageData(0,0,e,n).data.buffer)}function V_(t,e,n){if(!e.length)return;const i=e[0].mark.marktype;if(i==="group"){e.forEach((e=>{e.items.forEach((e=>V_(t,e.items,n)))}))}else{IA[i].draw(t,{items:n?e.map(Y_):e})}}function Y_(t){const e=Ia(t,{});if(e.stroke&&e.strokeOpacity!==0||e.fill&&e.fillOpacity!==0){return{...e,strokeOpacity:1,stroke:"#000",fillOpacity:0}}return e}const X_=5,J_=31,Q_=32,Z_=new Uint32Array(Q_+1),K_=new Uint32Array(Q_+1);K_[0]=0;Z_[0]=~K_[0];for(let Set=1;Set<=Q_;++Set){K_[Set]=K_[Set-1]<<1|1;Z_[Set]=~K_[Set]}function tN(t,e){const n=new Uint32Array(~~((t*e+Q_)/Q_));function i(t,e){n[t]|=e}function r(t,e){n[t]&=e}return{array:n,get:(e,i)=>{const r=i*t+e;return n[r>>>X_]&1<<(r&J_)},set:(e,n)=>{const r=n*t+e;i(r>>>X_,1<<(r&J_))},clear:(e,n)=>{const i=n*t+e;r(i>>>X_,~(1<<(i&J_)))},getRange:(e,i,r,u)=>{let o=u,s,a,f,c;for(;o>=i;--o){s=o*t+e;a=o*t+r;f=s>>>X_;c=a>>>X_;if(f===c){if(n[f]&Z_[s&J_]&K_[(a&J_)+1]){return true}}else{if(n[f]&Z_[s&J_])return true;if(n[c]&K_[(a&J_)+1])return true;for(let t=f+1;t<c;++t){if(n[t])return true}}}return false},setRange:(e,n,r,u)=>{let o,s,a,f,c;for(;n<=u;++n){o=n*t+e;s=n*t+r;a=o>>>X_;f=s>>>X_;if(a===f){i(a,Z_[o&J_]&K_[(s&J_)+1])}else{i(a,Z_[o&J_]);i(f,K_[(s&J_)+1]);for(c=a+1;c<f;++c)i(c,4294967295)}}},clearRange:(e,n,i,u)=>{let o,s,a,f,c;for(;n<=u;++n){o=n*t+e;s=n*t+i;a=o>>>X_;f=s>>>X_;if(a===f){r(a,K_[o&J_]|Z_[(s&J_)+1])}else{r(a,K_[o&J_]);r(f,Z_[(s&J_)+1]);for(c=a+1;c<f;++c)r(c,0)}}},outOfBounds:(n,i,r,u)=>n<0||i<0||u>=e||r>=t}}function eN(t,e,n){const i=Math.max(1,Math.sqrt(t*e/1e6)),r=~~((t+2*n+i)/i),u=~~((e+2*n+i)/i),o=t=>~~((t+n)/i);o.invert=t=>t*i-n;o.bitmap=()=>tN(r,u);o.ratio=i;o.padding=n;o.width=t;o.height=e;return o}function nN(t,e,n,i){const r=t.width,u=t.height;return function(t){const e=t.datum.datum.items[i].items,n=e.length,o=t.datum.fontSize,s=hA.width(t.datum,t.datum.text);let a=0,f,c,l,d,h,p,m;for(let i=0;i<n;++i){f=e[i].x;l=e[i].y;c=e[i].x2===undefined?f:e[i].x2;d=e[i].y2===undefined?l:e[i].y2;h=(f+c)/2;p=(l+d)/2;m=Math.abs(c-f+d-l);if(m>=a){a=m;t.x=h;t.y=p}}h=s/2;p=o/2;f=t.x-h;c=t.x+h;l=t.y-p;d=t.y+p;t.align="center";if(f<0&&c<=r){t.align="left"}else if(0<=f&&r<c){t.align="right"}t.baseline="middle";if(l<0&&d<=u){t.baseline="top"}else if(0<=l&&u<d){t.baseline="bottom"}return true}}function iN(t,e,n,i,r,u){let o=n/2;return t-o<0||t+o>r||e-(o=i/2)<0||e+o>u}function rN(t,e,n,i,r,u,o,s){const a=r*u/(i*2),f=t(e-a),c=t(e+a),l=t(n-(u=u/2)),d=t(n+u);return o.outOfBounds(f,l,c,d)||o.getRange(f,l,c,d)||s&&s.getRange(f,l,c,d)}function uN(t,e,n,i){const r=t.width,u=t.height,o=e[0],s=e[1];function a(e,n,i,a,f){const c=t.invert(e),l=t.invert(n);let d=i,h=u,p;if(!iN(c,l,a,f,r,u)&&!rN(t,c,l,f,a,d,o,s)&&!rN(t,c,l,f,a,f,o,null)){while(h-d>=1){p=(d+h)/2;if(rN(t,c,l,f,a,p,o,s)){h=p}else{d=p}}if(d>i){return[c,l,d,true]}}}return function(e){const s=e.datum.datum.items[i].items,f=s.length,c=e.datum.fontSize,l=hA.width(e.datum,e.datum.text);let d=n?c:0,h=false,p=false,m=0,g,b,v,y,w,A,x,O,F,D,k,E,$,j,C,M,B;for(let i=0;i<f;++i){g=s[i].x;v=s[i].y;b=s[i].x2===undefined?g:s[i].x2;y=s[i].y2===undefined?v:s[i].y2;if(g>b){B=g;g=b;b=B}if(v>y){B=v;v=y;y=B}F=t(g);k=t(b);D=~~((F+k)/2);E=t(v);j=t(y);$=~~((E+j)/2);for(x=D;x>=F;--x){for(O=$;O>=E;--O){M=a(x,O,d,l,c);if(M){[e.x,e.y,d,h]=M}}}for(x=D;x<=k;++x){for(O=$;O<=j;++O){M=a(x,O,d,l,c);if(M){[e.x,e.y,d,h]=M}}}if(!h&&!n){C=Math.abs(b-g+y-v);w=(g+b)/2;A=(v+y)/2;if(C>=m&&!iN(w,A,l,c,r,u)&&!rN(t,w,A,c,l,c,o,null)){m=C;e.x=w;e.y=A;p=true}}}if(h||p){w=l/2;A=c/2;o.setRange(t(e.x-w),t(e.y-A),t(e.x+w),t(e.y+A));e.align="center";e.baseline="middle";return true}else{return false}}}const oN=[-1,-1,1,1];const sN=[-1,1,-1,1];function aN(t,e,n,i){const r=t.width,u=t.height,o=e[0],s=e[1],a=t.bitmap();return function(e){const f=e.datum.datum.items[i].items,c=f.length,l=e.datum.fontSize,d=hA.width(e.datum,e.datum.text),h=[];let p=n?l:0,m=false,g=false,b=0,v,y,w,A,x,O,F,D,k,E,$,j;for(let i=0;i<c;++i){v=f[i].x;w=f[i].y;y=f[i].x2===undefined?v:f[i].x2;A=f[i].y2===undefined?w:f[i].y2;h.push([t((v+y)/2),t((w+A)/2)]);while(h.length){[F,D]=h.pop();if(o.get(F,D)||s.get(F,D)||a.get(F,D))continue;a.set(F,D);for(let t=0;t<4;++t){x=F+oN[t];O=D+sN[t];if(!a.outOfBounds(x,O,x,O))h.push([x,O])}x=t.invert(F);O=t.invert(D);k=p;E=u;if(!iN(x,O,d,l,r,u)&&!rN(t,x,O,l,d,k,o,s)&&!rN(t,x,O,l,d,l,o,null)){while(E-k>=1){$=(k+E)/2;if(rN(t,x,O,l,d,$,o,s)){E=$}else{k=$}}if(k>p){e.x=x;e.y=O;p=k;m=true}}}if(!m&&!n){j=Math.abs(y-v+A-w);x=(v+y)/2;O=(w+A)/2;if(j>=b&&!iN(x,O,d,l,r,u)&&!rN(t,x,O,l,d,l,o,null)){b=j;e.x=x;e.y=O;g=true}}}if(m||g){x=d/2;O=l/2;o.setRange(t(e.x-x),t(e.y-O),t(e.x+x),t(e.y+O));e.align="center";e.baseline="middle";return true}else{return false}}}const fN=["right","center","left"],cN=["bottom","middle","top"];function lN(t,e,n,i){const r=t.width,u=t.height,o=e[0],s=e[1],a=i.length;return function(e){const f=e.boundary,c=e.datum.fontSize;if(f[2]<0||f[5]<0||f[0]>r||f[3]>u){return false}let l=e.textWidth??0,d,h,p,m,g,b,v,y,w,A,x,O,F,D,k;for(let r=0;r<a;++r){d=(n[r]&3)-1;h=(n[r]>>>2&3)-1;p=d===0&&h===0||i[r]<0;m=d&&h?Math.SQRT1_2:1;g=i[r]<0?-1:1;b=f[1+d]+i[r]*d*m;x=f[4+h]+g*c*h/2+i[r]*h*m;y=x-c/2;w=x+c/2;O=t(b);D=t(y);k=t(w);if(!l){if(!dN(O,O,D,k,o,s,b,b,y,w,f,p)){continue}else{l=hA.width(e.datum,e.datum.text)}}A=b+g*l*d/2;b=A-l/2;v=A+l/2;O=t(b);F=t(v);if(dN(O,F,D,k,o,s,b,v,y,w,f,p)){e.x=!d?A:d*g<0?v:b;e.y=!h?x:h*g<0?w:y;e.align=fN[d*g+1];e.baseline=cN[h*g+1];o.setRange(O,D,F,k);return true}}return false}}function dN(t,e,n,i,r,u,o,s,a,f,c,l){return!(r.outOfBounds(t,n,e,i)||(l&&u||r).getRange(t,n,e,i))}const hN=0,pN=4,mN=8,gN=0,bN=1,vN=2;const yN={"top-left":hN+gN,top:hN+bN,"top-right":hN+vN,left:pN+gN,middle:pN+bN,right:pN+vN,"bottom-left":mN+gN,bottom:mN+bN,"bottom-right":mN+vN};const wN={naive:nN,"reduced-search":uN,floodfill:aN};function AN(t,e,n,i,r,u,o,s,a,f,c){if(!t.length)return t;const l=Math.max(i.length,r.length),d=xN(i,l),h=ON(r,l),p=FN(t[0].datum),m=p==="group"&&t[0].datum.items[a].marktype,g=m==="area",b=DN(p,m,s,a),v=f===null||f===Infinity,y=g&&c==="naive";let w=-1,A=-1;const x=t.map((t=>{const e=v?hA.width(t,t.text):undefined;w=Math.max(w,e);A=Math.max(A,t.fontSize);return{datum:t,opacity:0,x:undefined,y:undefined,align:undefined,baseline:undefined,boundary:b(t),textWidth:e}}));f=f===null||f===Infinity?Math.max(w,A)+Math.max(...i):f;const O=eN(e[0],e[1],f);let F;if(!y){if(n){x.sort(((t,e)=>n(t.datum,e.datum)))}let e=false;for(let t=0;t<h.length&&!e;++t){e=h[t]===5||d[t]<0}const i=(p&&o||g)&&t.map((t=>t.datum));F=u.length||i?G_(O,i||[],u,e,g):W_(O,o&&x)}const D=g?wN[c](O,F,o,a):lN(O,F,h,d);x.forEach((t=>t.opacity=+D(t)));return x}function xN(t,e){const n=new Float64Array(e),i=t.length;for(let r=0;r<i;++r)n[r]=t[r]||0;for(let r=i;r<e;++r)n[r]=n[i-1];return n}function ON(t,e){const n=new Int8Array(e),i=t.length;for(let r=0;r<i;++r)n[r]|=yN[t[r]];for(let r=i;r<e;++r)n[r]=n[i-1];return n}function FN(t){return t&&t.mark&&t.mark.marktype}function DN(t,e,n,i){const r=t=>[t.x,t.x,t.x,t.y,t.y,t.y];if(!t){return r}else if(t==="line"||t==="area"){return t=>r(t.datum)}else if(e==="line"){return t=>{const e=t.datum.items[i].items;return r(e.length?e[n==="start"?0:e.length-1]:{x:NaN,y:NaN})}}else{return t=>{const e=t.datum.bounds;return[e.x1,(e.x1+e.x2)/2,e.x2,e.y1,(e.y1+e.y2)/2,e.y2]}}}const kN=["x","y","opacity","align","baseline"];const EN=["top-left","left","bottom-left","top","bottom","top-right","right","bottom-right"];function $N(t){Zf.call(this,null,t)}$N.Definition={type:"Label",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2,required:true},{name:"sort",type:"compare"},{name:"anchor",type:"string",array:true,default:EN},{name:"offset",type:"number",array:true,default:[1]},{name:"padding",type:"number",default:0,null:true},{name:"lineAnchor",type:"string",values:["start","end"],default:"end"},{name:"markIndex",type:"number",default:0},{name:"avoidBaseMark",type:"boolean",default:true},{name:"avoidMarks",type:"data",array:true},{name:"method",type:"string",default:"naive"},{name:"as",type:"string",array:true,length:kN.length,default:kN}]};fn($N,Zf,{transform(t,e){function n(n){const i=t[n];return Ge(i)&&e.modified(i.fields)}const i=t.modified();if(!(i||e.changed(e.ADD_REM)||n("sort")))return;if(!t.size||t.size.length!==2){ne("Size parameter should be specified as a [width, height] array.")}const r=t.as||kN;AN(e.materialize(e.SOURCE).source||[],t.size,t.sort,Ue(t.offset==null?1:t.offset),Ue(t.anchor||EN),t.avoidMarks||[],t.avoidBaseMark!==false,t.lineAnchor||"end",t.markIndex||0,t.padding===undefined?0:t.padding,t.method||"naive").forEach((t=>{const e=t.datum;e[r[0]]=t.x;e[r[1]]=t.y;e[r[2]]=t.opacity;e[r[3]]=t.align;e[r[4]]=t.baseline}));return e.reflow(i).modifies(r)}});const jN=Object.freeze({__proto__:null,label:$N});function CN(t,e){var n=[],i=function(t){return t(s)},r,u,o,s,a,f;if(e==null){n.push(t)}else{for(r={},u=0,o=t.length;u<o;++u){s=t[u];a=e.map(i);f=r[a];if(!f){r[a]=f=[];f.dims=a;n.push(f)}f.push(s)}}return n}function MN(t){Zf.call(this,null,t)}MN.Definition={type:"Loess",metadata:{generates:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"bandwidth",type:"number",default:.3},{name:"as",type:"string",array:true}]};fn(MN,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=CN(i,t.groupby),u=(t.groupby||[]).map(Qt),o=u.length,s=t.as||[Qt(t.x),Qt(t.y)],a=[];r.forEach((e=>{Xc(e,t.x,t.y,t.bandwidth||.3).forEach((t=>{const n={};for(let i=0;i<o;++i){n[u[i]]=e.dims[i]}n[s[0]]=t[0];n[s[1]]=t[1];a.push(Pa(n))}))}));if(this.value)n.rem=this.value;this.value=n.add=n.source=a}return n}});const BN={linear:Lc,log:Ic,exp:Rc,pow:qc,quad:Uc,poly:Wc};const SN=(t,e)=>t==="poly"?e:t==="quad"?2:1;function _N(t){Zf.call(this,null,t)}_N.Definition={type:"Regression",metadata:{generates:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"groupby",type:"field",array:true},{name:"method",type:"string",default:"linear",values:Object.keys(BN)},{name:"order",type:"number",default:3},{name:"extent",type:"number",array:true,length:2},{name:"params",type:"boolean",default:false},{name:"as",type:"string",array:true}]};fn(_N,Zf,{transform(t,e){const n=e.fork(e.NO_SOURCE|e.NO_FIELDS);if(!this.value||e.changed()||t.modified()){const i=e.materialize(e.SOURCE).source,r=CN(i,t.groupby),u=(t.groupby||[]).map(Qt),o=t.method||"linear",s=t.order||3,a=SN(o,s),f=t.as||[Qt(t.x),Qt(t.y)],c=BN[o],l=[];let d=t.extent;if(!un(BN,o)){ne("Invalid regression method: "+o)}if(d!=null){if(o==="log"&&d[0]<=0){e.dataflow.warn("Ignoring extent with values <= 0 for log regression.");d=null}}r.forEach((n=>{const i=n.length;if(i<=a){e.dataflow.warn("Skipping regression with more parameters than data points.");return}const r=c(n,t.x,t.y,s);if(t.params){l.push(Pa({keys:n.dims,coef:r.coef,rSquared:r.rSquared}));return}const h=d||en(n,t.x),p=t=>{const e={};for(let i=0;i<u.length;++i){e[u[i]]=n.dims[i]}e[f[0]]=t[0];e[f[1]]=t[1];l.push(Pa(e))};if(o==="linear"){h.forEach((t=>p([t,r.predict(t)])))}else{tl(r.predict,h,25,200).forEach(p)}}));if(this.value)n.rem=this.value;this.value=n.add=n.source=l}return n}});const NN=Object.freeze({__proto__:null,loess:MN,regression:_N});const zN=11102230246251565e-32;const TN=134217729;const PN=(3+8*zN)*zN;function LN(t,e,n,i,r){let u,o,s,a;let f=e[0];let c=i[0];let l=0;let d=0;if(c>f===c>-f){u=f;f=e[++l]}else{u=c;c=i[++d]}let h=0;if(l<t&&d<n){if(c>f===c>-f){o=f+u;s=u-(o-f);f=e[++l]}else{o=c+u;s=u-(o-c);c=i[++d]}u=o;if(s!==0){r[h++]=s}while(l<t&&d<n){if(c>f===c>-f){o=u+f;a=o-u;s=u-(o-a)+(f-a);f=e[++l]}else{o=u+c;a=o-u;s=u-(o-a)+(c-a);c=i[++d]}u=o;if(s!==0){r[h++]=s}}}while(l<t){o=u+f;a=o-u;s=u-(o-a)+(f-a);f=e[++l];u=o;if(s!==0){r[h++]=s}}while(d<n){o=u+c;a=o-u;s=u-(o-a)+(c-a);c=i[++d];u=o;if(s!==0){r[h++]=s}}if(u!==0||h===0){r[h++]=u}return h}function IN(t,e){let n=e[0];for(let i=1;i<t;i++)n+=e[i];return n}function RN(t){return new Float64Array(t)}const qN=(3+16*zN)*zN;const UN=(2+12*zN)*zN;const WN=(9+64*zN)*zN*zN;const GN=RN(4);const HN=RN(8);const VN=RN(12);const YN=RN(16);const XN=RN(4);function JN(t,e,n,i,r,u,o){let s,a,f,c;let l,d,h,p,m,g,b,v,y,w,A,x,O,F;const D=t-r;const k=n-r;const E=e-u;const $=i-u;w=D*$;d=TN*D;h=d-(d-D);p=D-h;d=TN*$;m=d-(d-$);g=$-m;A=p*g-(w-h*m-p*m-h*g);x=E*k;d=TN*E;h=d-(d-E);p=E-h;d=TN*k;m=d-(d-k);g=k-m;O=p*g-(x-h*m-p*m-h*g);b=A-O;l=A-b;GN[0]=A-(b+l)+(l-O);v=w+b;l=v-w;y=w-(v-l)+(b-l);b=y-x;l=y-b;GN[1]=y-(b+l)+(l-x);F=v+b;l=F-v;GN[2]=v-(F-l)+(b-l);GN[3]=F;let j=IN(4,GN);let C=UN*o;if(j>=C||-j>=C){return j}l=t-D;s=t-(D+l)+(l-r);l=n-k;f=n-(k+l)+(l-r);l=e-E;a=e-(E+l)+(l-u);l=i-$;c=i-($+l)+(l-u);if(s===0&&a===0&&f===0&&c===0){return j}C=WN*o+PN*Math.abs(j);j+=D*c+$*s-(E*f+k*a);if(j>=C||-j>=C)return j;w=s*$;d=TN*s;h=d-(d-s);p=s-h;d=TN*$;m=d-(d-$);g=$-m;A=p*g-(w-h*m-p*m-h*g);x=a*k;d=TN*a;h=d-(d-a);p=a-h;d=TN*k;m=d-(d-k);g=k-m;O=p*g-(x-h*m-p*m-h*g);b=A-O;l=A-b;XN[0]=A-(b+l)+(l-O);v=w+b;l=v-w;y=w-(v-l)+(b-l);b=y-x;l=y-b;XN[1]=y-(b+l)+(l-x);F=v+b;l=F-v;XN[2]=v-(F-l)+(b-l);XN[3]=F;const M=LN(4,GN,4,XN,HN);w=D*c;d=TN*D;h=d-(d-D);p=D-h;d=TN*c;m=d-(d-c);g=c-m;A=p*g-(w-h*m-p*m-h*g);x=E*f;d=TN*E;h=d-(d-E);p=E-h;d=TN*f;m=d-(d-f);g=f-m;O=p*g-(x-h*m-p*m-h*g);b=A-O;l=A-b;XN[0]=A-(b+l)+(l-O);v=w+b;l=v-w;y=w-(v-l)+(b-l);b=y-x;l=y-b;XN[1]=y-(b+l)+(l-x);F=v+b;l=F-v;XN[2]=v-(F-l)+(b-l);XN[3]=F;const B=LN(M,HN,4,XN,VN);w=s*c;d=TN*s;h=d-(d-s);p=s-h;d=TN*c;m=d-(d-c);g=c-m;A=p*g-(w-h*m-p*m-h*g);x=a*f;d=TN*a;h=d-(d-a);p=a-h;d=TN*f;m=d-(d-f);g=f-m;O=p*g-(x-h*m-p*m-h*g);b=A-O;l=A-b;XN[0]=A-(b+l)+(l-O);v=w+b;l=v-w;y=w-(v-l)+(b-l);b=y-x;l=y-b;XN[1]=y-(b+l)+(l-x);F=v+b;l=F-v;XN[2]=v-(F-l)+(b-l);XN[3]=F;const S=LN(B,VN,4,XN,YN);return YN[S-1]}function QN(t,e,n,i,r,u){const o=(e-u)*(n-r);const s=(t-r)*(i-u);const a=o-s;if(o===0||s===0||o>0!==s>0)return a;const f=Math.abs(o+s);if(Math.abs(a)>=qN*f)return a;return-JN(t,e,n,i,r,u,f)}const ZN=Math.pow(2,-52);const KN=new Uint32Array(512);class tz{static from(t,e=az,n=fz){const i=t.length;const r=new Float64Array(i*2);for(let u=0;u<i;u++){const i=t[u];r[2*u]=e(i);r[2*u+1]=n(i)}return new tz(r)}constructor(t){const e=t.length>>1;if(e>0&&typeof t[0]!=="number")throw new Error("Expected coords to contain numbers.");this.coords=t;const n=Math.max(2*e-5,0);this._triangles=new Uint32Array(n*3);this._halfedges=new Int32Array(n*3);this._hashSize=Math.ceil(Math.sqrt(e));this._hullPrev=new Uint32Array(e);this._hullNext=new Uint32Array(e);this._hullTri=new Uint32Array(e);this._hullHash=new Int32Array(this._hashSize).fill(-1);this._ids=new Uint32Array(e);this._dists=new Float64Array(e);this.update()}update(){const{coords:t,_hullPrev:e,_hullNext:n,_hullTri:i,_hullHash:r}=this;const u=t.length>>1;let o=Infinity;let s=Infinity;let a=-Infinity;let f=-Infinity;for(let D=0;D<u;D++){const e=t[2*D];const n=t[2*D+1];if(e<o)o=e;if(n<s)s=n;if(e>a)a=e;if(n>f)f=n;this._ids[D]=D}const c=(o+a)/2;const l=(s+f)/2;let d=Infinity;let h,p,m;for(let D=0;D<u;D++){const e=nz(c,l,t[2*D],t[2*D+1]);if(e<d){h=D;d=e}}const g=t[2*h];const b=t[2*h+1];d=Infinity;for(let D=0;D<u;D++){if(D===h)continue;const e=nz(g,b,t[2*D],t[2*D+1]);if(e<d&&e>0){p=D;d=e}}let v=t[2*p];let y=t[2*p+1];let w=Infinity;for(let D=0;D<u;D++){if(D===h||D===p)continue;const e=rz(g,b,v,y,t[2*D],t[2*D+1]);if(e<w){m=D;w=e}}let A=t[2*m];let x=t[2*m+1];if(w===Infinity){for(let i=0;i<u;i++){this._dists[i]=t[2*i]-t[0]||t[2*i+1]-t[1]}oz(this._ids,this._dists,0,u-1);const e=new Uint32Array(u);let n=0;for(let t=0,i=-Infinity;t<u;t++){const r=this._ids[t];if(this._dists[r]>i){e[n++]=r;i=this._dists[r]}}this.hull=e.subarray(0,n);this.triangles=new Uint32Array(0);this.halfedges=new Uint32Array(0);return}if(QN(g,b,v,y,A,x)<0){const t=p;const e=v;const n=y;p=m;v=A;y=x;m=t;A=e;x=n}const O=uz(g,b,v,y,A,x);this._cx=O.x;this._cy=O.y;for(let D=0;D<u;D++){this._dists[D]=nz(t[2*D],t[2*D+1],O.x,O.y)}oz(this._ids,this._dists,0,u-1);this._hullStart=h;let F=3;n[h]=e[m]=p;n[p]=e[h]=m;n[m]=e[p]=h;i[h]=0;i[p]=1;i[m]=2;r.fill(-1);r[this._hashKey(g,b)]=h;r[this._hashKey(v,y)]=p;r[this._hashKey(A,x)]=m;this.trianglesLen=0;this._addTriangle(h,p,m,-1,-1,-1);for(let D=0,k,E;D<this._ids.length;D++){const u=this._ids[D];const o=t[2*u];const s=t[2*u+1];if(D>0&&Math.abs(o-k)<=ZN&&Math.abs(s-E)<=ZN)continue;k=o;E=s;if(u===h||u===p||u===m)continue;let a=0;for(let t=0,e=this._hashKey(o,s);t<this._hashSize;t++){a=r[(e+t)%this._hashSize];if(a!==-1&&a!==n[a])break}a=e[a];let f=a,c;while(c=n[f],QN(o,s,t[2*f],t[2*f+1],t[2*c],t[2*c+1])>=0){f=c;if(f===a){f=-1;break}}if(f===-1)continue;let l=this._addTriangle(f,u,n[f],-1,-1,i[f]);i[u]=this._legalize(l+2);i[f]=l;F++;let d=n[f];while(c=n[d],QN(o,s,t[2*d],t[2*d+1],t[2*c],t[2*c+1])<0){l=this._addTriangle(d,u,c,i[u],-1,i[d]);i[u]=this._legalize(l+2);n[d]=d;F--;d=c}if(f===a){while(c=e[f],QN(o,s,t[2*c],t[2*c+1],t[2*f],t[2*f+1])<0){l=this._addTriangle(c,u,f,-1,i[f],i[c]);this._legalize(l+2);i[c]=l;n[f]=f;F--;f=c}}this._hullStart=e[u]=f;n[f]=e[d]=u;n[u]=d;r[this._hashKey(o,s)]=u;r[this._hashKey(t[2*f],t[2*f+1])]=f}this.hull=new Uint32Array(F);for(let D=0,k=this._hullStart;D<F;D++){this.hull[D]=k;k=n[k]}this.triangles=this._triangles.subarray(0,this.trianglesLen);this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(t,e){return Math.floor(ez(t-this._cx,e-this._cy)*this._hashSize)%this._hashSize}_legalize(t){const{_triangles:e,_halfedges:n,coords:i}=this;let r=0;let u=0;while(true){const o=n[t];const s=t-t%3;u=s+(t+2)%3;if(o===-1){if(r===0)break;t=KN[--r];continue}const a=o-o%3;const f=s+(t+1)%3;const c=a+(o+2)%3;const l=e[u];const d=e[t];const h=e[f];const p=e[c];const m=iz(i[2*l],i[2*l+1],i[2*d],i[2*d+1],i[2*h],i[2*h+1],i[2*p],i[2*p+1]);if(m){e[t]=p;e[o]=l;const i=n[c];if(i===-1){let e=this._hullStart;do{if(this._hullTri[e]===c){this._hullTri[e]=t;break}e=this._hullPrev[e]}while(e!==this._hullStart)}this._link(t,i);this._link(o,n[u]);this._link(u,c);const s=a+(o+1)%3;if(r<KN.length){KN[r++]=s}}else{if(r===0)break;t=KN[--r]}}return u}_link(t,e){this._halfedges[t]=e;if(e!==-1)this._halfedges[e]=t}_addTriangle(t,e,n,i,r,u){const o=this.trianglesLen;this._triangles[o]=t;this._triangles[o+1]=e;this._triangles[o+2]=n;this._link(o,i);this._link(o+1,r);this._link(o+2,u);this.trianglesLen+=3;return o}}function ez(t,e){const n=t/(Math.abs(t)+Math.abs(e));return(e>0?3-n:1+n)/4}function nz(t,e,n,i){const r=t-n;const u=e-i;return r*r+u*u}function iz(t,e,n,i,r,u,o,s){const a=t-o;const f=e-s;const c=n-o;const l=i-s;const d=r-o;const h=u-s;const p=a*a+f*f;const m=c*c+l*l;const g=d*d+h*h;return a*(l*g-m*h)-f*(c*g-m*d)+p*(c*h-l*d)<0}function rz(t,e,n,i,r,u){const o=n-t;const s=i-e;const a=r-t;const f=u-e;const c=o*o+s*s;const l=a*a+f*f;const d=.5/(o*f-s*a);const h=(f*c-s*l)*d;const p=(o*l-a*c)*d;return h*h+p*p}function uz(t,e,n,i,r,u){const o=n-t;const s=i-e;const a=r-t;const f=u-e;const c=o*o+s*s;const l=a*a+f*f;const d=.5/(o*f-s*a);const h=t+(f*c-s*l)*d;const p=e+(o*l-a*c)*d;return{x:h,y:p}}function oz(t,e,n,i){if(i-n<=20){for(let r=n+1;r<=i;r++){const i=t[r];const u=e[i];let o=r-1;while(o>=n&&e[t[o]]>u)t[o+1]=t[o--];t[o+1]=i}}else{const r=n+i>>1;let u=n+1;let o=i;sz(t,r,u);if(e[t[n]]>e[t[i]])sz(t,n,i);if(e[t[u]]>e[t[i]])sz(t,u,i);if(e[t[n]]>e[t[u]])sz(t,n,u);const s=t[u];const a=e[s];while(true){do{u++}while(e[t[u]]<a);do{o--}while(e[t[o]]>a);if(o<u)break;sz(t,u,o)}t[n+1]=t[o];t[o]=s;if(i-u+1>=o-n){oz(t,e,u,i);oz(t,e,n,o-1)}else{oz(t,e,n,o-1);oz(t,e,u,i)}}}function sz(t,e,n){const i=t[e];t[e]=t[n];t[n]=i}function az(t){return t[0]}function fz(t){return t[1]}const cz=1e-6;class lz{constructor(){this._x0=this._y0=this._x1=this._y1=null;this._=""}moveTo(t,e){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){if(this._x1!==null){this._x1=this._x0,this._y1=this._y0;this._+="Z"}}lineTo(t,e){this._+=`L${this._x1=+t},${this._y1=+e}`}arc(t,e,n){t=+t,e=+e,n=+n;const i=t+n;const r=e;if(n<0)throw new Error("negative radius");if(this._x1===null)this._+=`M${i},${r}`;else if(Math.abs(this._x1-i)>cz||Math.abs(this._y1-r)>cz)this._+="L"+i+","+r;if(!n)return;this._+=`A${n},${n},0,1,1,${t-n},${e}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`}rect(t,e,n,i){this._+=`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class dz{constructor(){this._=[]}moveTo(t,e){this._.push([t,e])}closePath(){this._.push(this._[0].slice())}lineTo(t,e){this._.push([t,e])}value(){return this._.length?this._:null}}class hz{constructor(t,[e,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(e=+e))||!((r=+r)>=(n=+n)))throw new Error("invalid bounds");this.delaunay=t;this._circumcenters=new Float64Array(t.points.length*2);this.vectors=new Float64Array(t.points.length*2);this.xmax=i,this.xmin=e;this.ymax=r,this.ymin=n;this._init()}update(){this.delaunay.update();this._init();return this}_init(){const{delaunay:{points:t,hull:e,triangles:n},vectors:i}=this;const r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let d=0,h=0,p=n.length,m,g;d<p;d+=3,h+=2){const e=n[d]*2;const i=n[d+1]*2;const u=n[d+2]*2;const o=t[e];const s=t[e+1];const a=t[i];const f=t[i+1];const c=t[u];const l=t[u+1];const p=a-o;const b=f-s;const v=c-o;const y=l-s;const w=(p*y-b*v)*2;if(Math.abs(w)<1e-9){let e=1e9;const i=n[0]*2;e*=Math.sign((t[i]-o)*y-(t[i+1]-s)*v);m=(o+c)/2-e*y;g=(s+l)/2+e*v}else{const t=1/w;const e=p*p+b*b;const n=v*v+y*y;m=o+(y*e-b*n)*t;g=s+(p*n-v*e)*t}r[h]=m;r[h+1]=g}let u=e[e.length-1];let o,s=u*4;let a,f=t[2*u];let c,l=t[2*u+1];i.fill(0);for(let d=0;d<e.length;++d){u=e[d];o=s,a=f,c=l;s=u*4,f=t[2*u],l=t[2*u+1];i[o+2]=i[s]=c-l;i[o+3]=i[s+1]=f-a}}render(t){const e=t==null?t=new lz:undefined;const{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:u,vectors:o}=this;if(r.length<=1)return null;for(let f=0,c=n.length;f<c;++f){const e=n[f];if(e<f)continue;const i=Math.floor(f/3)*2;const r=Math.floor(e/3)*2;const o=u[i];const s=u[i+1];const a=u[r];const c=u[r+1];this._renderSegment(o,s,a,c,t)}let s,a=r[r.length-1];for(let f=0;f<r.length;++f){s=a,a=r[f];const e=Math.floor(i[a]/3)*2;const n=u[e];const c=u[e+1];const l=s*4;const d=this._project(n,c,o[l+2],o[l+3]);if(d)this._renderSegment(n,c,d[0],d[1],t)}return e&&e.value()}renderBounds(t){const e=t==null?t=new lz:undefined;t.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin);return e&&e.value()}renderCell(t,e){const n=e==null?e=new lz:undefined;const i=this._clip(t);if(i===null||!i.length)return;e.moveTo(i[0],i[1]);let r=i.length;while(i[0]===i[r-2]&&i[1]===i[r-1]&&r>1)r-=2;for(let u=2;u<r;u+=2){if(i[u]!==i[u-2]||i[u+1]!==i[u-1])e.lineTo(i[u],i[u+1])}e.closePath();return n&&n.value()}*cellPolygons(){const{delaunay:{points:t}}=this;for(let e=0,n=t.length/2;e<n;++e){const t=this.cellPolygon(e);if(t)t.index=e,yield t}}cellPolygon(t){const e=new dz;this.renderCell(t,e);return e.value()}_renderSegment(t,e,n,i,r){let u;const o=this._regioncode(t,e);const s=this._regioncode(n,i);if(o===0&&s===0){r.moveTo(t,e);r.lineTo(n,i)}else if(u=this._clipSegment(t,e,n,i,o,s)){r.moveTo(u[0],u[1]);r.lineTo(u[2],u[3])}}contains(t,e,n){if((e=+e,e!==e)||(n=+n,n!==n))return false;return this.delaunay._step(t,e,n)===t}*neighbors(t){const e=this._clip(t);if(e)for(const n of this.delaunay.neighbors(t)){const t=this._clip(n);if(t)t:for(let i=0,r=e.length;i<r;i+=2){for(let u=0,o=t.length;u<o;u+=2){if(e[i]==t[u]&&e[i+1]==t[u+1]&&e[(i+2)%r]==t[(u+o-2)%o]&&e[(i+3)%r]==t[(u+o-1)%o]){yield n;break t}}}}}_cell(t){const{circumcenters:e,delaunay:{inedges:n,halfedges:i,triangles:r}}=this;const u=n[t];if(u===-1)return null;const o=[];let s=u;do{const n=Math.floor(s/3);o.push(e[n*2],e[n*2+1]);s=s%3===2?s-2:s+1;if(r[s]!==t)break;s=i[s]}while(s!==u&&s!==-1);return o}_clip(t){if(t===0&&this.delaunay.hull.length===1){return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin]}const e=this._cell(t);if(e===null)return null;const{vectors:n}=this;const i=t*4;return n[i]||n[i+1]?this._clipInfinite(t,e,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(t,e)}_clipFinite(t,e){const n=e.length;let i=null;let r,u,o=e[n-2],s=e[n-1];let a,f=this._regioncode(o,s);let c,l=0;for(let d=0;d<n;d+=2){r=o,u=s,o=e[d],s=e[d+1];a=f,f=this._regioncode(o,s);if(a===0&&f===0){c=l,l=0;if(i)i.push(o,s);else i=[o,s]}else{let e,n,d,h,p;if(a===0){if((e=this._clipSegment(r,u,o,s,a,f))===null)continue;[n,d,h,p]=e}else{if((e=this._clipSegment(o,s,r,u,f,a))===null)continue;[h,p,n,d]=e;c=l,l=this._edgecode(n,d);if(c&&l)this._edge(t,c,l,i,i.length);if(i)i.push(n,d);else i=[n,d]}c=l,l=this._edgecode(h,p);if(c&&l)this._edge(t,c,l,i,i.length);if(i)i.push(h,p);else i=[h,p]}}if(i){c=l,l=this._edgecode(i[0],i[1]);if(c&&l)this._edge(t,c,l,i,i.length)}else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)){return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin]}return i}_clipSegment(t,e,n,i,r,u){while(true){if(r===0&&u===0)return[t,e,n,i];if(r&u)return null;let o,s,a=r||u;if(a&8)o=t+(n-t)*(this.ymax-e)/(i-e),s=this.ymax;else if(a&4)o=t+(n-t)*(this.ymin-e)/(i-e),s=this.ymin;else if(a&2)s=e+(i-e)*(this.xmax-t)/(n-t),o=this.xmax;else s=e+(i-e)*(this.xmin-t)/(n-t),o=this.xmin;if(r)t=o,e=s,r=this._regioncode(t,e);else n=o,i=s,u=this._regioncode(n,i)}}_clipInfinite(t,e,n,i,r,u){let o=Array.from(e),s;if(s=this._project(o[0],o[1],n,i))o.unshift(s[0],s[1]);if(s=this._project(o[o.length-2],o[o.length-1],r,u))o.push(s[0],s[1]);if(o=this._clipFinite(t,o)){for(let e=0,n=o.length,i,r=this._edgecode(o[n-2],o[n-1]);e<n;e+=2){i=r,r=this._edgecode(o[e],o[e+1]);if(i&&r)e=this._edge(t,i,r,o,e),n=o.length}}else if(this.contains(t,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)){o=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]}return o}_edge(t,e,n,i,r){while(e!==n){let n,u;switch(e){case 5:e=4;continue;case 4:e=6,n=this.xmax,u=this.ymin;break;case 6:e=2;continue;case 2:e=10,n=this.xmax,u=this.ymax;break;case 10:e=8;continue;case 8:e=9,n=this.xmin,u=this.ymax;break;case 9:e=1;continue;case 1:e=5,n=this.xmin,u=this.ymin;break}if((i[r]!==n||i[r+1]!==u)&&this.contains(t,n,u)){i.splice(r,0,n,u),r+=2}}if(i.length>4){for(let t=0;t<i.length;t+=2){const e=(t+2)%i.length,n=(t+4)%i.length;if(i[t]===i[e]&&i[e]===i[n]||i[t+1]===i[e+1]&&i[e+1]===i[n+1])i.splice(e,2),t-=2}}return r}_project(t,e,n,i){let r=Infinity,u,o,s;if(i<0){if(e<=this.ymin)return null;if((u=(this.ymin-e)/i)<r)s=this.ymin,o=t+(r=u)*n}else if(i>0){if(e>=this.ymax)return null;if((u=(this.ymax-e)/i)<r)s=this.ymax,o=t+(r=u)*n}if(n>0){if(t>=this.xmax)return null;if((u=(this.xmax-t)/n)<r)o=this.xmax,s=e+(r=u)*i}else if(n<0){if(t<=this.xmin)return null;if((u=(this.xmin-t)/n)<r)o=this.xmin,s=e+(r=u)*i}return[o,s]}_edgecode(t,e){return(t===this.xmin?1:t===this.xmax?2:0)|(e===this.ymin?4:e===this.ymax?8:0)}_regioncode(t,e){return(t<this.xmin?1:t>this.xmax?2:0)|(e<this.ymin?4:e>this.ymax?8:0)}}const pz=2*Math.PI,mz=Math.pow;function gz(t){return t[0]}function bz(t){return t[1]}function vz(t){const{triangles:e,coords:n}=t;for(let i=0;i<e.length;i+=3){const t=2*e[i],r=2*e[i+1],u=2*e[i+2],o=(n[u]-n[t])*(n[r+1]-n[t+1])-(n[r]-n[t])*(n[u+1]-n[t+1]);if(o>1e-10)return false}return true}function yz(t,e,n){return[t+Math.sin(t+e)*n,e+Math.cos(t-e)*n]}class wz{static from(t,e=gz,n=bz,i){return new wz("length"in t?Az(t,e,n,i):Float64Array.from(xz(t,e,n,i)))}constructor(t){this._delaunator=new tz(t);this.inedges=new Int32Array(t.length/2);this._hullIndex=new Int32Array(t.length/2);this.points=this._delaunator.coords;this._init()}update(){this._delaunator.update();this._init();return this}_init(){const t=this._delaunator,e=this.points;if(t.hull&&t.hull.length>2&&vz(t)){this.collinear=Int32Array.from({length:e.length/2},((t,e)=>e)).sort(((t,n)=>e[2*t]-e[2*n]||e[2*t+1]-e[2*n+1]));const t=this.collinear[0],n=this.collinear[this.collinear.length-1],i=[e[2*t],e[2*t+1],e[2*n],e[2*n+1]],r=1e-8*Math.hypot(i[3]-i[1],i[2]-i[0]);for(let u=0,o=e.length/2;u<o;++u){const t=yz(e[2*u],e[2*u+1],r);e[2*u]=t[0];e[2*u+1]=t[1]}this._delaunator=new tz(e)}else{delete this.collinear}const n=this.halfedges=this._delaunator.halfedges;const i=this.hull=this._delaunator.hull;const r=this.triangles=this._delaunator.triangles;const u=this.inedges.fill(-1);const o=this._hullIndex.fill(-1);for(let s=0,a=n.length;s<a;++s){const t=r[s%3===2?s-2:s+1];if(n[s]===-1||u[t]===-1)u[t]=s}for(let s=0,a=i.length;s<a;++s){o[i[s]]=s}if(i.length<=2&&i.length>0){this.triangles=new Int32Array(3).fill(-1);this.halfedges=new Int32Array(3).fill(-1);this.triangles[0]=i[0];u[i[0]]=1;if(i.length===2){u[i[1]]=0;this.triangles[1]=i[1];this.triangles[2]=i[1]}}}voronoi(t){return new hz(this,t)}*neighbors(t){const{inedges:e,hull:n,_hullIndex:i,halfedges:r,triangles:u,collinear:o}=this;if(o){const e=o.indexOf(t);if(e>0)yield o[e-1];if(e<o.length-1)yield o[e+1];return}const s=e[t];if(s===-1)return;let a=s,f=-1;do{yield f=u[a];a=a%3===2?a-2:a+1;if(u[a]!==t)return;a=r[a];if(a===-1){const e=n[(i[t]+1)%n.length];if(e!==f)yield e;return}}while(a!==s)}find(t,e,n=0){if((t=+t,t!==t)||(e=+e,e!==e))return-1;const i=n;let r;while((r=this._step(n,t,e))>=0&&r!==n&&r!==i)n=r;return r}_step(t,e,n){const{inedges:i,hull:r,_hullIndex:u,halfedges:o,triangles:s,points:a}=this;if(i[t]===-1||!a.length)return(t+1)%(a.length>>1);let f=t;let c=mz(e-a[t*2],2)+mz(n-a[t*2+1],2);const l=i[t];let d=l;do{let i=s[d];const l=mz(e-a[i*2],2)+mz(n-a[i*2+1],2);if(l<c)c=l,f=i;d=d%3===2?d-2:d+1;if(s[d]!==t)break;d=o[d];if(d===-1){d=r[(u[t]+1)%r.length];if(d!==i){if(mz(e-a[d*2],2)+mz(n-a[d*2+1],2)<c)return d}break}}while(d!==l);return f}render(t){const e=t==null?t=new lz:undefined;const{points:n,halfedges:i,triangles:r}=this;for(let u=0,o=i.length;u<o;++u){const e=i[u];if(e<u)continue;const o=r[u]*2;const s=r[e]*2;t.moveTo(n[o],n[o+1]);t.lineTo(n[s],n[s+1])}this.renderHull(t);return e&&e.value()}renderPoints(t,e){if(e===undefined&&(!t||typeof t.moveTo!=="function"))e=t,t=null;e=e==undefined?2:+e;const n=t==null?t=new lz:undefined;const{points:i}=this;for(let r=0,u=i.length;r<u;r+=2){const n=i[r],u=i[r+1];t.moveTo(n+e,u);t.arc(n,u,e,0,pz)}return n&&n.value()}renderHull(t){const e=t==null?t=new lz:undefined;const{hull:n,points:i}=this;const r=n[0]*2,u=n.length;t.moveTo(i[r],i[r+1]);for(let o=1;o<u;++o){const e=2*n[o];t.lineTo(i[e],i[e+1])}t.closePath();return e&&e.value()}hullPolygon(){const t=new dz;this.renderHull(t);return t.value()}renderTriangle(t,e){const n=e==null?e=new lz:undefined;const{points:i,triangles:r}=this;const u=r[t*=3]*2;const o=r[t+1]*2;const s=r[t+2]*2;e.moveTo(i[u],i[u+1]);e.lineTo(i[o],i[o+1]);e.lineTo(i[s],i[s+1]);e.closePath();return n&&n.value()}*trianglePolygons(){const{triangles:t}=this;for(let e=0,n=t.length/3;e<n;++e){yield this.trianglePolygon(e)}}trianglePolygon(t){const e=new dz;this.renderTriangle(t,e);return e.value()}}function Az(t,e,n,i){const r=t.length;const u=new Float64Array(r*2);for(let o=0;o<r;++o){const r=t[o];u[o*2]=e.call(i,r,o,t);u[o*2+1]=n.call(i,r,o,t)}return u}function*xz(t,e,n,i){let r=0;for(const u of t){yield e.call(i,u,r,t);yield n.call(i,u,r,t);++r}}function Oz(t){Zf.call(this,null,t)}Oz.Definition={type:"Voronoi",metadata:{modifies:true},params:[{name:"x",type:"field",required:true},{name:"y",type:"field",required:true},{name:"size",type:"number",array:true,length:2},{name:"extent",type:"array",array:true,length:2,default:[[-1e5,-1e5],[1e5,1e5]],content:{type:"number",array:true,length:2}},{name:"as",type:"string",default:"path"}]};const Fz=[-1e5,-1e5,1e5,1e5];fn(Oz,Zf,{transform(t,e){const n=t.as||"path",i=e.source;if(!i||!i.length)return e;let r=t.size;r=r?[0,0,r[0],r[1]]:(r=t.extent)?[r[0][0],r[0][1],r[1][0],r[1][1]]:Fz;const u=this.value=wz.from(i,t.x,t.y).voronoi(r);for(let o=0,s=i.length;o<s;++o){const t=u.cellPolygon(o);i[o][n]=t?Dz(t):null}return e.reflow(t.modified()).modifies(n)}});function Dz(t){const e=t[0][0],n=t[0][1];let i=t.length-1;for(;t[i][0]===e&&t[i][1]===n;--i);return"M"+t.slice(0,i+1).join("L")+"Z"}const kz=Object.freeze({__proto__:null,voronoi:Oz});var Ez=Math.PI/180,$z=1<<11>>5,jz=1<<11;function Cz(){var t=[256,256],e,n,i,r,u,o,s,a=Nz,f=[],c=Math.random,l={};l.layout=function(){var a=d(Wh()),l=Tz((t[0]>>5)*t[1]),p=null,m=f.length,g=-1,b=[],v=f.map((t=>({text:e(t),font:n(t),style:r(t),weight:u(t),rotate:o(t),size:~~(i(t)+1e-14),padding:s(t),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:false,sprite:null,datum:t}))).sort(((t,e)=>e.size-t.size));while(++g<m){var y=v[g];y.x=t[0]*(c()+.5)>>1;y.y=t[1]*(c()+.5)>>1;Mz(a,y,v,g);if(y.hasText&&h(l,y,p)){b.push(y);if(p)Sz(p,y);else p=[{x:y.x+y.x0,y:y.y+y.y0},{x:y.x+y.x1,y:y.y+y.y1}];y.x-=t[0]>>1;y.y-=t[1]>>1}}return b};function d(t){t.width=t.height=1;var e=Math.sqrt(t.getContext("2d").getImageData(0,0,1,1).data.length>>2);t.width=($z<<5)/e;t.height=jz/e;var n=t.getContext("2d");n.fillStyle=n.strokeStyle="red";n.textAlign="center";return{context:n,ratio:e}}function h(e,n,i){var r=n.x,u=n.y,o=Math.sqrt(t[0]*t[0]+t[1]*t[1]),s=a(t),f=c()<.5?1:-1,l=-f,d,h,p;while(d=s(l+=f)){h=~~d[0];p=~~d[1];if(Math.min(Math.abs(h),Math.abs(p))>=o)break;n.x=r+h;n.y=u+p;if(n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>t[0]||n.y+n.y1>t[1])continue;if(!i||!Bz(n,e,t[0])){if(!i||_z(n,i)){var m=n.sprite,g=n.width>>5,b=t[0]>>5,v=n.x-(g<<4),y=v&127,w=32-y,A=n.y1-n.y0,x=(n.y+n.y0)*b+(v>>5),O;for(var F=0;F<A;F++){O=0;for(var D=0;D<=g;D++){e[x+D]|=O<<w|(D<g?(O=m[F*g+D])>>>y:0)}x+=b}n.sprite=null;return true}}}return false}l.words=function(t){if(arguments.length){f=t;return l}else{return f}};l.size=function(e){if(arguments.length){t=[+e[0],+e[1]];return l}else{return t}};l.font=function(t){if(arguments.length){n=Pz(t);return l}else{return n}};l.fontStyle=function(t){if(arguments.length){r=Pz(t);return l}else{return r}};l.fontWeight=function(t){if(arguments.length){u=Pz(t);return l}else{return u}};l.rotate=function(t){if(arguments.length){o=Pz(t);return l}else{return o}};l.text=function(t){if(arguments.length){e=Pz(t);return l}else{return e}};l.spiral=function(t){if(arguments.length){a=Lz[t]||t;return l}else{return a}};l.fontSize=function(t){if(arguments.length){i=Pz(t);return l}else{return i}};l.padding=function(t){if(arguments.length){s=Pz(t);return l}else{return s}};l.random=function(t){if(arguments.length){c=t;return l}else{return c}};return l}function Mz(t,e,n,i){if(e.sprite)return;var r=t.context,u=t.ratio;r.clearRect(0,0,($z<<5)/u,jz/u);var o=0,s=0,a=0,f=n.length,c,l,d,h,p;--i;while(++i<f){e=n[i];r.save();r.font=e.style+" "+e.weight+" "+~~((e.size+1)/u)+"px "+e.font;c=r.measureText(e.text+"m").width*u;d=e.size<<1;if(e.rotate){var m=Math.sin(e.rotate*Ez),g=Math.cos(e.rotate*Ez),b=c*g,v=c*m,y=d*g,w=d*m;c=Math.max(Math.abs(b+w),Math.abs(b-w))+31>>5<<5;d=~~Math.max(Math.abs(v+y),Math.abs(v-y))}else{c=c+31>>5<<5}if(d>a)a=d;if(o+c>=$z<<5){o=0;s+=a;a=0}if(s+d>=jz)break;r.translate((o+(c>>1))/u,(s+(d>>1))/u);if(e.rotate)r.rotate(e.rotate*Ez);r.fillText(e.text,0,0);if(e.padding){r.lineWidth=2*e.padding;r.strokeText(e.text,0,0)}r.restore();e.width=c;e.height=d;e.xoff=o;e.yoff=s;e.x1=c>>1;e.y1=d>>1;e.x0=-e.x1;e.y0=-e.y1;e.hasText=true;o+=c}var A=r.getImageData(0,0,($z<<5)/u,jz/u).data,x=[];while(--i>=0){e=n[i];if(!e.hasText)continue;c=e.width;l=c>>5;d=e.y1-e.y0;for(h=0;h<d*l;h++)x[h]=0;o=e.xoff;if(o==null)return;s=e.yoff;var O=0,F=-1;for(p=0;p<d;p++){for(h=0;h<c;h++){var D=l*p+(h>>5),k=A[(s+p)*($z<<5)+(o+h)<<2]?1<<31-h%32:0;x[D]|=k;O|=k}if(O)F=p;else{e.y0++;d--;p--;s++}}e.y1=e.y0+F;e.sprite=x.slice(0,(e.y1-e.y0)*l)}}function Bz(t,e,n){n>>=5;var i=t.sprite,r=t.width>>5,u=t.x-(r<<4),o=u&127,s=32-o,a=t.y1-t.y0,f=(t.y+t.y0)*n+(u>>5),c;for(var l=0;l<a;l++){c=0;for(var d=0;d<=r;d++){if((c<<s|(d<r?(c=i[l*r+d])>>>o:0))&e[f+d])return true}f+=n}return false}function Sz(t,e){var n=t[0],i=t[1];if(e.x+e.x0<n.x)n.x=e.x+e.x0;if(e.y+e.y0<n.y)n.y=e.y+e.y0;if(e.x+e.x1>i.x)i.x=e.x+e.x1;if(e.y+e.y1>i.y)i.y=e.y+e.y1}function _z(t,e){return t.x+t.x1>e[0].x&&t.x+t.x0<e[1].x&&t.y+t.y1>e[0].y&&t.y+t.y0<e[1].y}function Nz(t){var e=t[0]/t[1];return function(t){return[e*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function zz(t){var e=4,n=e*t[0]/t[1],i=0,r=0;return function(t){var u=t<0?-1:1;switch(Math.sqrt(1+4*u*t)-u&3){case 0:i+=n;break;case 1:r+=e;break;case 2:i-=n;break;default:r-=e;break}return[i,r]}}function Tz(t){var e=[],n=-1;while(++n<t)e[n]=0;return e}function Pz(t){return typeof t==="function"?t:function(){return t}}var Lz={archimedean:Nz,rectangular:zz};const Iz=["x","y","font","fontSize","fontStyle","fontWeight","angle"];const Rz=["text","font","rotate","fontSize","fontStyle","fontWeight"];function qz(t){Zf.call(this,Cz(),t)}qz.Definition={type:"Wordcloud",metadata:{modifies:true},params:[{name:"size",type:"number",array:true,length:2},{name:"font",type:"string",expr:true,default:"sans-serif"},{name:"fontStyle",type:"string",expr:true,default:"normal"},{name:"fontWeight",type:"string",expr:true,default:"normal"},{name:"fontSize",type:"number",expr:true,default:14},{name:"fontSizeRange",type:"number",array:"nullable",default:[10,50]},{name:"rotate",type:"number",expr:true,default:0},{name:"text",type:"field"},{name:"spiral",type:"string",values:["archimedean","rectangular"]},{name:"padding",type:"number",expr:true},{name:"as",type:"string",array:true,length:7,default:Iz}]};fn(qz,Zf,{transform(t,e){if(t.size&&!(t.size[0]&&t.size[1])){ne("Wordcloud size dimensions must be non-zero.")}function n(n){const i=t[n];return Ge(i)&&e.modified(i.fields)}const i=t.modified();if(!(i||e.changed(e.ADD_REM)||Rz.some(n)))return;const r=e.materialize(e.SOURCE).source,u=this.value,o=t.as||Iz;let s=t.fontSize||14,a;Ge(s)?a=t.fontSizeRange:s=Ze(s);if(a){const t=s,e=Tg("sqrt")().domain(en(r,t)).range(a);s=n=>e(t(n))}r.forEach((t=>{t[o[0]]=NaN;t[o[1]]=NaN;t[o[3]]=0}));const f=u.words(r).text(t.text).size(t.size||[500,500]).padding(t.padding||1).spiral(t.spiral||"archimedean").rotate(t.rotate||0).font(t.font||"sans-serif").fontStyle(t.fontStyle||"normal").fontWeight(t.fontWeight||"normal").fontSize(s).random(sc).layout();const c=u.size(),l=c[0]>>1,d=c[1]>>1,h=f.length;for(let p=0,m,g;p<h;++p){m=f[p];g=m.datum;g[o[0]]=m.x+l;g[o[1]]=m.y+d;g[o[2]]=m.font;g[o[3]]=m.size;g[o[4]]=m.style;g[o[5]]=m.weight;g[o[6]]=m.rotate}return e.reflow(i).modifies(o)}});const Uz=Object.freeze({__proto__:null,wordcloud:qz});const Wz=t=>new Uint8Array(t);const Gz=t=>new Uint16Array(t);const Hz=t=>new Uint32Array(t);function Vz(){let t=8,e=[],n=Hz(0),i=Xz(0,t),r=Xz(0,t);return{data:()=>e,seen:()=>n=Yz(n,e.length),add(t){for(let n=0,i=e.length,r=t.length,u;n<r;++n){u=t[n];u._index=i++;e.push(u)}},remove(t,n){const u=e.length,o=Array(u-t),s=e;let a,f,c;for(f=0;!n[f]&&f<u;++f){o[f]=e[f];s[f]=f}for(c=f;f<u;++f){a=e[f];if(!n[f]){s[f]=c;i[c]=i[f];r[c]=r[f];o[c]=a;a._index=c++}else{s[f]=-1}i[f]=0}e=o;return s},size:()=>e.length,curr:()=>i,prev:()=>r,reset:t=>r[t]=i[t],all:()=>t<257?255:t<65537?65535:4294967295,set(t,e){i[t]|=e},clear(t,e){i[t]&=~e},resize(e,n){const u=i.length;if(e>u||n>t){t=Math.max(n,t);i=Xz(e,t,i);r=Xz(e,t)}}}}function Yz(t,e,n){if(t.length>=e)return t;n=n||new t.constructor(e);n.set(t);return n}function Xz(t,e,n){const i=(e<257?Wz:e<65537?Gz:Hz)(t);if(n)i.set(n);return i}function Jz(t,e,n){const i=1<<e;return{one:i,zero:~i,range:n.slice(),bisect:t.bisect,index:t.index,size:t.size,onAdd(t,e){const n=this,r=n.bisect(n.range,t.value),u=t.index,o=r[0],s=r[1],a=u.length;let f;for(f=0;f<o;++f)e[u[f]]|=i;for(f=s;f<a;++f)e[u[f]]|=i;return n}}}function Qz(){let t=Hz(0),e=[],n=0;function i(i,r,u){if(!r.length)return[];const o=n,s=r.length,a=Hz(s);let f=Array(s),c,l,d;for(d=0;d<s;++d){f[d]=i(r[d]);a[d]=d}f=Zz(f,a);if(o){c=e;l=t;e=Array(o+s);t=Hz(o+s);Kz(u,c,l,o,f,a,s,e,t)}else{if(u>0)for(d=0;d<s;++d){a[d]+=u}e=f;t=a}n=o+s;return{index:a,value:f}}function r(i,r){const u=n;let o,s,a;for(s=0;!r[t[s]]&&s<u;++s);for(a=s;s<u;++s){if(!r[o=t[s]]){t[a]=o;e[a]=e[s];++a}}n=u-i}function u(e){for(let i=0,r=n;i<r;++i){t[i]=e[t[i]]}}function o(t,i){let r;if(i){r=i.length}else{i=e;r=n}return[fi(i,t[0],0,r),ai(i,t[1],0,r)]}return{insert:i,remove:r,bisect:o,reindex:u,index:()=>t,size:()=>n}}function Zz(t,e){t.sort.call(e,((e,n)=>{const i=t[e],r=t[n];return i<r?-1:i>r?1:0}));return yi(t,e)}function Kz(t,e,n,i,r,u,o,s,a){let f=0,c=0,l;for(l=0;f<i&&c<o;++l){if(e[f]<r[c]){s[l]=e[f];a[l]=n[f++]}else{s[l]=r[c];a[l]=u[c++]+t}}for(;f<i;++f,++l){s[l]=e[f];a[l]=n[f]}for(;c<o;++c,++l){s[l]=r[c];a[l]=u[c]+t}}function tT(t){Zf.call(this,Vz(),t);this._indices=null;this._dims=null}tT.Definition={type:"CrossFilter",metadata:{},params:[{name:"fields",type:"field",array:true,required:true},{name:"query",type:"array",array:true,required:true,content:{type:"number",array:true,length:2}}]};fn(tT,Zf,{transform(t,e){if(!this._dims){return this.init(t,e)}else{var n=t.modified("fields")||t.fields.some((t=>e.modified(t.fields)));return n?this.reinit(t,e):this.eval(t,e)}},init(t,e){const n=t.fields,i=t.query,r=this._indices={},u=this._dims=[],o=i.length;let s=0,a,f;for(;s<o;++s){a=n[s].fname;f=r[a]||(r[a]=Qz());u.push(Jz(f,s,i[s]))}return this.eval(t,e)},reinit(t,e){const n=e.materialize().fork(),i=t.fields,r=t.query,u=this._indices,o=this._dims,s=this.value,a=s.curr(),f=s.prev(),c=s.all(),l=n.rem=n.add,d=n.mod,h=r.length,p={};let m,g,b,v,y,w,A,x,O;f.set(a);if(e.rem.length){y=this.remove(t,e,n)}if(e.add.length){s.add(e.add)}if(e.mod.length){w={};for(v=e.mod,A=0,x=v.length;A<x;++A){w[v[A]._index]=1}}for(A=0;A<h;++A){O=i[A];if(!o[A]||t.modified("fields",A)||e.modified(O.fields)){b=O.fname;if(!(m=p[b])){u[b]=g=Qz();p[b]=m=g.insert(O,e.source,0)}o[A]=Jz(g,A,r[A]).onAdd(m,a)}}for(A=0,x=s.data().length;A<x;++A){if(y[A]){continue}else if(f[A]!==a[A]){l.push(A)}else if(w[A]&&a[A]!==c){d.push(A)}}s.mask=(1<<h)-1;return n},eval(t,e){const n=e.materialize().fork(),i=this._dims.length;let r=0;if(e.rem.length){this.remove(t,e,n);r|=(1<<i)-1}if(t.modified("query")&&!t.modified("fields")){r|=this.update(t,e,n)}if(e.add.length){this.insert(t,e,n);r|=(1<<i)-1}if(e.mod.length){this.modify(e,n);r|=(1<<i)-1}this.value.mask=r;return n},insert(t,e,n){const i=e.add,r=this.value,u=this._dims,o=this._indices,s=t.fields,a={},f=n.add,c=r.size()+i.length,l=u.length;let d=r.size(),h,p,m;r.resize(c,l);r.add(i);const g=r.curr(),b=r.prev(),v=r.all();for(h=0;h<l;++h){p=s[h].fname;m=a[p]||(a[p]=o[p].insert(s[h],i,d));u[h].onAdd(m,g)}for(;d<c;++d){b[d]=v;if(g[d]!==v)f.push(d)}},modify(t,e){const n=e.mod,i=this.value,r=i.curr(),u=i.all(),o=t.mod;let s,a,f;for(s=0,a=o.length;s<a;++s){f=o[s]._index;if(r[f]!==u)n.push(f)}},remove(t,e,n){const i=this._indices,r=this.value,u=r.curr(),o=r.prev(),s=r.all(),a={},f=n.rem,c=e.rem;let l,d,h,p;for(l=0,d=c.length;l<d;++l){h=c[l]._index;a[h]=1;o[h]=p=u[h];u[h]=s;if(p!==s)f.push(h)}for(h in i){i[h].remove(d,a)}this.reindex(e,d,a);return a},reindex(t,e,n){const i=this._indices,r=this.value;t.runAfter((()=>{const t=r.remove(e,n);for(const e in i)i[e].reindex(t)}))},update(t,e,n){const i=this._dims,r=t.query,u=e.stamp,o=i.length;let s=0,a,f;n.filters=0;for(f=0;f<o;++f){if(t.modified("query",f)){a=f;++s}}if(s===1){s=i[a].one;this.incrementOne(i[a],r[a],n.add,n.rem)}else{for(f=0,s=0;f<o;++f){if(!t.modified("query",f))continue;s|=i[f].one;this.incrementAll(i[f],r[f],u,n.add);n.rem=n.add}}return s},incrementAll(t,e,n,i){const r=this.value,u=r.seen(),o=r.curr(),s=r.prev(),a=t.index(),f=t.bisect(t.range),c=t.bisect(e),l=c[0],d=c[1],h=f[0],p=f[1],m=t.one;let g,b,v;if(l<h){for(g=l,b=Math.min(h,d);g<b;++g){v=a[g];if(u[v]!==n){s[v]=o[v];u[v]=n;i.push(v)}o[v]^=m}}else if(l>h){for(g=h,b=Math.min(l,p);g<b;++g){v=a[g];if(u[v]!==n){s[v]=o[v];u[v]=n;i.push(v)}o[v]^=m}}if(d>p){for(g=Math.max(l,p),b=d;g<b;++g){v=a[g];if(u[v]!==n){s[v]=o[v];u[v]=n;i.push(v)}o[v]^=m}}else if(d<p){for(g=Math.max(h,d),b=p;g<b;++g){v=a[g];if(u[v]!==n){s[v]=o[v];u[v]=n;i.push(v)}o[v]^=m}}t.range=e.slice()},incrementOne(t,e,n,i){const r=this.value,u=r.curr(),o=t.index(),s=t.bisect(t.range),a=t.bisect(e),f=a[0],c=a[1],l=s[0],d=s[1],h=t.one;let p,m,g;if(f<l){for(p=f,m=Math.min(l,c);p<m;++p){g=o[p];u[g]^=h;n.push(g)}}else if(f>l){for(p=l,m=Math.min(f,d);p<m;++p){g=o[p];u[g]^=h;i.push(g)}}if(c>d){for(p=Math.max(f,d),m=c;p<m;++p){g=o[p];u[g]^=h;n.push(g)}}else if(c<d){for(p=Math.max(l,c),m=d;p<m;++p){g=o[p];u[g]^=h;i.push(g)}}t.range=e.slice()}});function eT(t){Zf.call(this,null,t)}eT.Definition={type:"ResolveFilter",metadata:{},params:[{name:"ignore",type:"number",required:true,description:"A bit mask indicating which filters to ignore."},{name:"filter",type:"object",required:true,description:"Per-tuple filter bitmaps from a CrossFilter transform."}]};fn(eT,Zf,{transform(t,e){const n=~(t.ignore||0),i=t.filter,r=i.mask;if((r&n)===0)return e.StopPropagation;const u=e.fork(e.ALL),o=i.data(),s=i.curr(),a=i.prev(),f=t=>!(s[t]&n)?o[t]:null;u.filter(u.MOD,f);if(!(r&r-1)){u.filter(u.ADD,f);u.filter(u.REM,(t=>(s[t]&n)===r?o[t]:null))}else{u.filter(u.ADD,(t=>{const e=s[t]&n,i=!e&&e^a[t]&n;return i?o[t]:null}));u.filter(u.REM,(t=>{const e=s[t]&n,i=e&&!(e^(e^a[t]&n));return i?o[t]:null}))}return u.filter(u.SOURCE,(t=>f(t._index)))}});const nT=Object.freeze({__proto__:null,crossfilter:tT,resolvefilter:eT});const iT="RawCode";const rT="Literal";const uT="Property";const oT="Identifier";const sT="ArrayExpression";const aT="BinaryExpression";const fT="CallExpression";const cT="ConditionalExpression";const lT="LogicalExpression";const dT="MemberExpression";const hT="ObjectExpression";const pT="UnaryExpression";function mT(t){this.type=t}mT.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=gT(this),n=0,i=e.length;n<i;++n){if(e[n].visit(t))return 1}};function gT(t){switch(t.type){case sT:return t.elements;case aT:case lT:return[t.left,t.right];case fT:return[t.callee].concat(t.arguments);case cT:return[t.test,t.consequent,t.alternate];case dT:return[t.object,t.property];case hT:return t.properties;case uT:return[t.key,t.value];case pT:return[t.argument];case oT:case rT:case iT:default:return[]}}var bT,vT,yT,wT,AT;var xT=1,OT=2,FT=3,DT=4,kT=5,ET=6,$T=7,jT=8,CT=9;bT={};bT[xT]="Boolean";bT[OT]="<end>";bT[FT]="Identifier";bT[DT]="Keyword";bT[kT]="Null";bT[ET]="Numeric";bT[$T]="Punctuator";bT[jT]="String";bT[CT]="RegularExpression";var MT="ArrayExpression",BT="BinaryExpression",ST="CallExpression",_T="ConditionalExpression",NT="Identifier",zT="Literal",TT="LogicalExpression",PT="MemberExpression",LT="ObjectExpression",IT="Property",RT="UnaryExpression";var qT="Unexpected token %0",UT="Unexpected number",WT="Unexpected string",GT="Unexpected identifier",HT="Unexpected reserved word",VT="Unexpected end of input",YT="Invalid regular expression",XT="Invalid regular expression: missing /",JT="Octal literals are not allowed in strict mode.",QT="Duplicate data property in object literal not allowed in strict mode";var ZT="ILLEGAL",KT="Disabled.";var tP=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),eP=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function nP(t,e){if(!t){throw new Error("ASSERT: "+e)}}function iP(t){return t>=48&&t<=57}function rP(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function uP(t){return"01234567".indexOf(t)>=0}function oP(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function sP(t){return t===10||t===13||t===8232||t===8233}function aP(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&tP.test(String.fromCharCode(t))}function fP(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&eP.test(String.fromCharCode(t))}const cP={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function lP(){while(yT<wT){const t=vT.charCodeAt(yT);if(oP(t)||sP(t)){++yT}else{break}}}function dP(t){var e,n,i,r=0;n=t==="u"?4:2;for(e=0;e<n;++e){if(yT<wT&&rP(vT[yT])){i=vT[yT++];r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())}else{IP({},qT,ZT)}}return String.fromCharCode(r)}function hP(){var t,e,n,i;t=vT[yT];e=0;if(t==="}"){IP({},qT,ZT)}while(yT<wT){t=vT[yT++];if(!rP(t)){break}e=e*16+"0123456789abcdef".indexOf(t.toLowerCase())}if(e>1114111||t!=="}"){IP({},qT,ZT)}if(e<=65535){return String.fromCharCode(e)}n=(e-65536>>10)+55296;i=(e-65536&1023)+56320;return String.fromCharCode(n,i)}function pP(){var t,e;t=vT.charCodeAt(yT++);e=String.fromCharCode(t);if(t===92){if(vT.charCodeAt(yT)!==117){IP({},qT,ZT)}++yT;t=dP("u");if(!t||t==="\\"||!aP(t.charCodeAt(0))){IP({},qT,ZT)}e=t}while(yT<wT){t=vT.charCodeAt(yT);if(!fP(t)){break}++yT;e+=String.fromCharCode(t);if(t===92){e=e.substr(0,e.length-1);if(vT.charCodeAt(yT)!==117){IP({},qT,ZT)}++yT;t=dP("u");if(!t||t==="\\"||!fP(t.charCodeAt(0))){IP({},qT,ZT)}e+=t}}return e}function mP(){var t,e;t=yT++;while(yT<wT){e=vT.charCodeAt(yT);if(e===92){yT=t;return pP()}if(fP(e)){++yT}else{break}}return vT.slice(t,yT)}function gP(){var t,e,n;t=yT;e=vT.charCodeAt(yT)===92?pP():mP();if(e.length===1){n=FT}else if(cP.hasOwnProperty(e)){n=DT}else if(e==="null"){n=kT}else if(e==="true"||e==="false"){n=xT}else{n=FT}return{type:n,value:e,start:t,end:yT}}function bP(){var t=yT,e=vT.charCodeAt(yT),n,i=vT[yT],r,u,o;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++yT;return{type:$T,value:String.fromCharCode(e),start:t,end:yT};default:n=vT.charCodeAt(yT+1);if(n===61){switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:yT+=2;return{type:$T,value:String.fromCharCode(e)+String.fromCharCode(n),start:t,end:yT};case 33:case 61:yT+=2;if(vT.charCodeAt(yT)===61){++yT}return{type:$T,value:vT.slice(t,yT),start:t,end:yT}}}}o=vT.substr(yT,4);if(o===">>>="){yT+=4;return{type:$T,value:o,start:t,end:yT}}u=o.substr(0,3);if(u===">>>"||u==="<<="||u===">>="){yT+=3;return{type:$T,value:u,start:t,end:yT}}r=u.substr(0,2);if(i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>"){yT+=2;return{type:$T,value:r,start:t,end:yT}}if(r==="//"){IP({},qT,ZT)}if("<>=!+-*%&|^/".indexOf(i)>=0){++yT;return{type:$T,value:i,start:t,end:yT}}IP({},qT,ZT)}function vP(t){let e="";while(yT<wT){if(!rP(vT[yT])){break}e+=vT[yT++]}if(e.length===0){IP({},qT,ZT)}if(aP(vT.charCodeAt(yT))){IP({},qT,ZT)}return{type:ET,value:parseInt("0x"+e,16),start:t,end:yT}}function yP(t){let e="0"+vT[yT++];while(yT<wT){if(!uP(vT[yT])){break}e+=vT[yT++]}if(aP(vT.charCodeAt(yT))||iP(vT.charCodeAt(yT))){IP({},qT,ZT)}return{type:ET,value:parseInt(e,8),octal:true,start:t,end:yT}}function wP(){var t,e,n;n=vT[yT];nP(iP(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point");e=yT;t="";if(n!=="."){t=vT[yT++];n=vT[yT];if(t==="0"){if(n==="x"||n==="X"){++yT;return vP(e)}if(uP(n)){return yP(e)}if(n&&iP(n.charCodeAt(0))){IP({},qT,ZT)}}while(iP(vT.charCodeAt(yT))){t+=vT[yT++]}n=vT[yT]}if(n==="."){t+=vT[yT++];while(iP(vT.charCodeAt(yT))){t+=vT[yT++]}n=vT[yT]}if(n==="e"||n==="E"){t+=vT[yT++];n=vT[yT];if(n==="+"||n==="-"){t+=vT[yT++]}if(iP(vT.charCodeAt(yT))){while(iP(vT.charCodeAt(yT))){t+=vT[yT++]}}else{IP({},qT,ZT)}}if(aP(vT.charCodeAt(yT))){IP({},qT,ZT)}return{type:ET,value:parseFloat(t),start:e,end:yT}}function AP(){var t="",e,n,i,r,u=false;e=vT[yT];nP(e==="'"||e==='"',"String literal must starts with a quote");n=yT;++yT;while(yT<wT){i=vT[yT++];if(i===e){e="";break}else if(i==="\\"){i=vT[yT++];if(!i||!sP(i.charCodeAt(0))){switch(i){case"u":case"x":if(vT[yT]==="{"){++yT;t+=hP()}else{t+=dP(i)}break;case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:if(uP(i)){r="01234567".indexOf(i);if(r!==0){u=true}if(yT<wT&&uP(vT[yT])){u=true;r=r*8+"01234567".indexOf(vT[yT++]);if("0123".indexOf(i)>=0&&yT<wT&&uP(vT[yT])){r=r*8+"01234567".indexOf(vT[yT++])}}t+=String.fromCharCode(r)}else{t+=i}break}}else{if(i==="\r"&&vT[yT]==="\n"){++yT}}}else if(sP(i.charCodeAt(0))){break}else{t+=i}}if(e!==""){IP({},qT,ZT)}return{type:jT,value:t,octal:u,start:n,end:yT}}function xP(t,e){let n=t;if(e.indexOf("u")>=0){n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111){return"x"}IP({},YT)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x")}try{return new RegExp(t,e)}catch(i){return null}}function OP(){var t,e,n,i,r;t=vT[yT];nP(t==="/","Regular expression literal must start with a slash");e=vT[yT++];n=false;i=false;while(yT<wT){t=vT[yT++];e+=t;if(t==="\\"){t=vT[yT++];if(sP(t.charCodeAt(0))){IP({},XT)}e+=t}else if(sP(t.charCodeAt(0))){IP({},XT)}else if(n){if(t==="]"){n=false}}else{if(t==="/"){i=true;break}else if(t==="["){n=true}}}if(!i){IP({},XT)}r=e.substr(1,e.length-2);return{value:r,literal:e}}function FP(){var t,e,n;e="";n="";while(yT<wT){t=vT[yT];if(!fP(t.charCodeAt(0))){break}++yT;if(t==="\\"&&yT<wT){IP({},qT,ZT)}else{n+=t;e+=t}}if(n.search(/[^gimuy]/g)>=0){IP({},YT,n)}return{value:n,literal:e}}function DP(){var t,e,n,i;AT=null;lP();t=yT;e=OP();n=FP();i=xP(e.value,n.value);return{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:yT}}function kP(t){return t.type===FT||t.type===DT||t.type===xT||t.type===kT}function EP(){lP();if(yT>=wT){return{type:OT,start:yT,end:yT}}const t=vT.charCodeAt(yT);if(aP(t)){return gP()}if(t===40||t===41||t===59){return bP()}if(t===39||t===34){return AP()}if(t===46){if(iP(vT.charCodeAt(yT+1))){return wP()}return bP()}if(iP(t)){return wP()}return bP()}function $P(){const t=AT;yT=t.end;AT=EP();yT=t.end;return t}function jP(){const t=yT;AT=EP();yT=t}function CP(t){const e=new mT(MT);e.elements=t;return e}function MP(t,e,n){const i=new mT(t==="||"||t==="&&"?TT:BT);i.operator=t;i.left=e;i.right=n;return i}function BP(t,e){const n=new mT(ST);n.callee=t;n.arguments=e;return n}function SP(t,e,n){const i=new mT(_T);i.test=t;i.consequent=e;i.alternate=n;return i}function _P(t){const e=new mT(NT);e.name=t;return e}function NP(t){const e=new mT(zT);e.value=t.value;e.raw=vT.slice(t.start,t.end);if(t.regex){if(e.raw==="//"){e.raw="/(?:)/"}e.regex=t.regex}return e}function zP(t,e,n){const i=new mT(PT);i.computed=t==="[";i.object=e;i.property=n;if(!i.computed)n.member=true;return i}function TP(t){const e=new mT(LT);e.properties=t;return e}function PP(t,e,n){const i=new mT(IT);i.key=e;i.value=n;i.kind=t;return i}function LP(t,e){const n=new mT(RT);n.operator=t;n.argument=e;n.prefix=true;return n}function IP(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,((t,e)=>{nP(e<i.length,"Message reference must be in range");return i[e]}));n=new Error(r);n.index=yT;n.description=r;throw n}function RP(t){if(t.type===OT){IP(t,VT)}if(t.type===ET){IP(t,UT)}if(t.type===jT){IP(t,WT)}if(t.type===FT){IP(t,GT)}if(t.type===DT){IP(t,HT)}IP(t,qT,t.value)}function qP(t){const e=$P();if(e.type!==$T||e.value!==t){RP(e)}}function UP(t){return AT.type===$T&&AT.value===t}function WP(t){return AT.type===DT&&AT.value===t}function GP(){const t=[];yT=AT.start;qP("[");while(!UP("]")){if(UP(",")){$P();t.push(null)}else{t.push(sL());if(!UP("]")){qP(",")}}}$P();return CP(t)}function HP(){yT=AT.start;const t=$P();if(t.type===jT||t.type===ET){if(t.octal){IP(t,JT)}return NP(t)}return _P(t.value)}function VP(){var t,e,n,i;yT=AT.start;t=AT;if(t.type===FT){n=HP();qP(":");i=sL();return PP("init",n,i)}if(t.type===OT||t.type===$T){RP(t)}else{e=HP();qP(":");i=sL();return PP("init",e,i)}}function YP(){var t=[],e,n,i,r={},u=String;yT=AT.start;qP("{");while(!UP("}")){e=VP();if(e.key.type===NT){n=e.key.name}else{n=u(e.key.value)}i="$"+n;if(Object.prototype.hasOwnProperty.call(r,i)){IP({},QT)}else{r[i]=true}t.push(e);if(!UP("}")){qP(",")}}qP("}");return TP(t)}function XP(){qP("(");const t=aL();qP(")");return t}const JP={if:1};function QP(){var t,e,n;if(UP("(")){return XP()}if(UP("[")){return GP()}if(UP("{")){return YP()}t=AT.type;yT=AT.start;if(t===FT||JP[AT.value]){n=_P($P().value)}else if(t===jT||t===ET){if(AT.octal){IP(AT,JT)}n=NP($P())}else if(t===DT){throw new Error(KT)}else if(t===xT){e=$P();e.value=e.value==="true";n=NP(e)}else if(t===kT){e=$P();e.value=null;n=NP(e)}else if(UP("/")||UP("/=")){n=NP(DP());jP()}else{RP($P())}return n}function ZP(){const t=[];qP("(");if(!UP(")")){while(yT<wT){t.push(sL());if(UP(")")){break}qP(",")}}qP(")");return t}function KP(){yT=AT.start;const t=$P();if(!kP(t)){RP(t)}return _P(t.value)}function tL(){qP(".");return KP()}function eL(){qP("[");const t=aL();qP("]");return t}function nL(){var t,e,n;t=QP();for(;;){if(UP(".")){n=tL();t=zP(".",t,n)}else if(UP("(")){e=ZP();t=BP(t,e)}else if(UP("[")){n=eL();t=zP("[",t,n)}else{break}}return t}function iL(){const t=nL();if(AT.type===$T){if(UP("++")||UP("--")){throw new Error(KT)}}return t}function rL(){var t,e;if(AT.type!==$T&&AT.type!==DT){e=iL()}else if(UP("++")||UP("--")){throw new Error(KT)}else if(UP("+")||UP("-")||UP("~")||UP("!")){t=$P();e=rL();e=LP(t.value,e)}else if(WP("delete")||WP("void")||WP("typeof")){throw new Error(KT)}else{e=iL()}return e}function uL(t){let e=0;if(t.type!==$T&&t.type!==DT){return 0}switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function oL(){var t,e,n,i,r,u,o,s,a,f;t=AT;a=rL();i=AT;r=uL(i);if(r===0){return a}i.prec=r;$P();e=[t,AT];o=rL();u=[a,i,o];while((r=uL(AT))>0){while(u.length>2&&r<=u[u.length-2].prec){o=u.pop();s=u.pop().value;a=u.pop();e.pop();n=MP(s,a,o);u.push(n)}i=$P();i.prec=r;u.push(i);e.push(AT);n=rL();u.push(n)}f=u.length-1;n=u[f];e.pop();while(f>1){e.pop();n=MP(u[f-1].value,u[f-2],n);f-=2}return n}function sL(){var t,e,n;t=oL();if(UP("?")){$P();e=sL();qP(":");n=sL();t=SP(t,e,n)}return t}function aL(){const t=sL();if(UP(",")){throw new Error(KT)}return t}function fL(t){vT=t;yT=0;wT=vT.length;AT=null;jP();const e=aL();if(AT.type!==OT){throw new Error("Unexpect token after expression.")}return e}var cL={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function lL(t){function e(e,n,i,r){let u=t(n[0]);if(i){u=i+"("+u+")";if(i.lastIndexOf("new ",0)===0)u="("+u+")"}return u+"."+e+(r<0?"":r===0?"()":"("+n.slice(1).map(t).join(",")+")")}function n(t,n,i){return r=>e(t,r,n,i)}const i="new Date",r="String",u="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",hypot:"Math.hypot",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){if(e.length<3)ne("Missing arguments to clamp function.");if(e.length>3)ne("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:u,test:n("test",u),if:function(e){if(e.length<3)ne("Missing arguments to if function.");if(e.length>3)ne("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function dL(t){const e=t&&t.length-1;return e&&(t[0]==='"'&&t[e]==='"'||t[0]==="'"&&t[e]==="'")?t.slice(1,-1):t}function hL(t){t=t||{};const e=t.allowed?Cn(t.allowed):{},n=t.forbidden?Cn(t.forbidden):{},i=t.constants||cL,r=(t.functions||lL)(l),u=t.globalvar,o=t.fieldvar,s=Ge(u)?u:t=>`${u}["${t}"]`;let a={},f={},c=0;function l(t){if(gn(t))return t;const e=d[t.type];if(e==null)ne("Unsupported type: "+t.type);return e(t)}const d={Literal:t=>t.raw,Identifier:t=>{const r=t.name;if(c>0){return r}else if(un(n,r)){return ne("Illegal identifier: "+r)}else if(un(i,r)){return i[r]}else if(un(e,r)){return r}else{a[r]=1;return s(r)}},MemberExpression:t=>{const e=!t.computed,n=l(t.object);if(e)c+=1;const i=l(t.property);if(n===o){f[dL(i)]=1}if(e)c-=1;return n+(e?"."+i:"["+i+"]")},CallExpression:t=>{if(t.callee.type!=="Identifier"){ne("Illegal callee type: "+t.callee.type)}const e=t.callee.name,n=t.arguments,i=un(r,e)&&r[e];if(!i)ne("Unrecognized function: "+e);return Ge(i)?i(n):i+"("+n.map(l).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(l).join(",")+"]",BinaryExpression:t=>"("+l(t.left)+" "+t.operator+" "+l(t.right)+")",UnaryExpression:t=>"("+t.operator+l(t.argument)+")",ConditionalExpression:t=>"("+l(t.test)+"?"+l(t.consequent)+":"+l(t.alternate)+")",LogicalExpression:t=>"("+l(t.left)+t.operator+l(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(l).join(",")+"}",Property:t=>{c+=1;const e=l(t.key);c-=1;return e+":"+l(t.value)}};function h(t){const e={code:l(t),globals:Object.keys(a),fields:Object.keys(f)};a={};f={};return e}h.functions=r;h.constants=i;return h}function pL(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function mL(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function gL(t){let e,n,i;if(t.length!==2){e=pL;n=(e,n)=>pL(t(e),n);i=(e,n)=>t(e)-n}else{e=t===pL||t===mL?t:bL;n=t;i=t}function r(t,i,r=0,u=t.length){if(r<u){if(e(i,i)!==0)return u;do{const e=r+u>>>1;if(n(t[e],i)<0)r=e+1;else u=e}while(r<u)}return r}function u(t,i,r=0,u=t.length){if(r<u){if(e(i,i)!==0)return u;do{const e=r+u>>>1;if(n(t[e],i)<=0)r=e+1;else u=e}while(r<u)}return r}function o(t,e,n=0,u=t.length){const o=r(t,e,n,u-1);return o>n&&i(t[o-1],e)>-i(t[o],e)?o-1:o}return{left:r,center:o,right:u}}function bL(){return 0}function vL(t,...e){t=new pi(t);e=e.map(yL);t:for(const n of t){for(const i of e){if(!i.has(n)){t.delete(n);continue t}}}return t}function yL(t){return t instanceof pi?t:new pi(t)}function wL(...t){const e=new pi;for(const n of t){for(const t of n){e.add(t)}}return e}const AL="RawCode";const xL="Literal";const OL="Property";const FL="Identifier";const DL="ArrayExpression";const kL="BinaryExpression";const EL="CallExpression";const $L="ConditionalExpression";const jL="LogicalExpression";const CL="MemberExpression";const ML="ObjectExpression";const BL="UnaryExpression";function SL(t){this.type=t}SL.prototype.visit=function(t){let e,n,i;if(t(this))return 1;for(e=_L(this),n=0,i=e.length;n<i;++n){if(e[n].visit(t))return 1}};function _L(t){switch(t.type){case DL:return t.elements;case kL:case jL:return[t.left,t.right];case EL:return[t.callee].concat(t.arguments);case $L:return[t.test,t.consequent,t.alternate];case CL:return[t.object,t.property];case ML:return t.properties;case OL:return[t.key,t.value];case BL:return[t.argument];case FL:case xL:case AL:default:return[]}}var NL,zL,TL,PL,LL;var IL=1,RL=2,qL=3,UL=4,WL=5,GL=6,HL=7,VL=8,YL=9;NL={};NL[IL]="Boolean";NL[RL]="<end>";NL[qL]="Identifier";NL[UL]="Keyword";NL[WL]="Null";NL[GL]="Numeric";NL[HL]="Punctuator";NL[VL]="String";NL[YL]="RegularExpression";var XL="ArrayExpression",JL="BinaryExpression",QL="CallExpression",ZL="ConditionalExpression",KL="Identifier",tI="Literal",eI="LogicalExpression",nI="MemberExpression",iI="ObjectExpression",rI="Property",uI="UnaryExpression";var oI="Unexpected token %0",sI="Unexpected number",aI="Unexpected string",fI="Unexpected identifier",cI="Unexpected reserved word",lI="Unexpected end of input",dI="Invalid regular expression",hI="Invalid regular expression: missing /",pI="Octal literals are not allowed in strict mode.",mI="Duplicate data property in object literal not allowed in strict mode";var gI="ILLEGAL",bI="Disabled.";var vI=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0370-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0620-\\u064A\\u066E\\u066F\\u0671-\\u06D3\\u06D5\\u06E5\\u06E6\\u06EE\\u06EF\\u06FA-\\u06FC\\u06FF\\u0710\\u0712-\\u072F\\u074D-\\u07A5\\u07B1\\u07CA-\\u07EA\\u07F4\\u07F5\\u07FA\\u0800-\\u0815\\u081A\\u0824\\u0828\\u0840-\\u0858\\u08A0-\\u08B2\\u0904-\\u0939\\u093D\\u0950\\u0958-\\u0961\\u0971-\\u0980\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BD\\u09CE\\u09DC\\u09DD\\u09DF-\\u09E1\\u09F0\\u09F1\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A59-\\u0A5C\\u0A5E\\u0A72-\\u0A74\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABD\\u0AD0\\u0AE0\\u0AE1\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3D\\u0B5C\\u0B5D\\u0B5F-\\u0B61\\u0B71\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BD0\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D\\u0C58\\u0C59\\u0C60\\u0C61\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBD\\u0CDE\\u0CE0\\u0CE1\\u0CF1\\u0CF2\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D\\u0D4E\\u0D60\\u0D61\\u0D7A-\\u0D7F\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0E01-\\u0E30\\u0E32\\u0E33\\u0E40-\\u0E46\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB0\\u0EB2\\u0EB3\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EDC-\\u0EDF\\u0F00\\u0F40-\\u0F47\\u0F49-\\u0F6C\\u0F88-\\u0F8C\\u1000-\\u102A\\u103F\\u1050-\\u1055\\u105A-\\u105D\\u1061\\u1065\\u1066\\u106E-\\u1070\\u1075-\\u1081\\u108E\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1711\\u1720-\\u1731\\u1740-\\u1751\\u1760-\\u176C\\u176E-\\u1770\\u1780-\\u17B3\\u17D7\\u17DC\\u1820-\\u1877\\u1880-\\u18A8\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1950-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19C1-\\u19C7\\u1A00-\\u1A16\\u1A20-\\u1A54\\u1AA7\\u1B05-\\u1B33\\u1B45-\\u1B4B\\u1B83-\\u1BA0\\u1BAE\\u1BAF\\u1BBA-\\u1BE5\\u1C00-\\u1C23\\u1C4D-\\u1C4F\\u1C5A-\\u1C7D\\u1CE9-\\u1CEC\\u1CEE-\\u1CF1\\u1CF5\\u1CF6\\u1D00-\\u1DBF\\u1E00-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u2071\\u207F\\u2090-\\u209C\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CEE\\u2CF2\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D80-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2E2F\\u3005-\\u3007\\u3021-\\u3029\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA61F\\uA62A\\uA62B\\uA640-\\uA66E\\uA67F-\\uA69D\\uA6A0-\\uA6EF\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA801\\uA803-\\uA805\\uA807-\\uA80A\\uA80C-\\uA822\\uA840-\\uA873\\uA882-\\uA8B3\\uA8F2-\\uA8F7\\uA8FB\\uA90A-\\uA925\\uA930-\\uA946\\uA960-\\uA97C\\uA984-\\uA9B2\\uA9CF\\uA9E0-\\uA9E4\\uA9E6-\\uA9EF\\uA9FA-\\uA9FE\\uAA00-\\uAA28\\uAA40-\\uAA42\\uAA44-\\uAA4B\\uAA60-\\uAA76\\uAA7A\\uAA7E-\\uAAAF\\uAAB1\\uAAB5\\uAAB6\\uAAB9-\\uAABD\\uAAC0\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEA\\uAAF2-\\uAAF4\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABE2\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D\\uFB1F-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF21-\\uFF3A\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]"),yI=new RegExp("[\\xAA\\xB5\\xBA\\xC0-\\xD6\\xD8-\\xF6\\xF8-\\u02C1\\u02C6-\\u02D1\\u02E0-\\u02E4\\u02EC\\u02EE\\u0300-\\u0374\\u0376\\u0377\\u037A-\\u037D\\u037F\\u0386\\u0388-\\u038A\\u038C\\u038E-\\u03A1\\u03A3-\\u03F5\\u03F7-\\u0481\\u0483-\\u0487\\u048A-\\u052F\\u0531-\\u0556\\u0559\\u0561-\\u0587\\u0591-\\u05BD\\u05BF\\u05C1\\u05C2\\u05C4\\u05C5\\u05C7\\u05D0-\\u05EA\\u05F0-\\u05F2\\u0610-\\u061A\\u0620-\\u0669\\u066E-\\u06D3\\u06D5-\\u06DC\\u06DF-\\u06E8\\u06EA-\\u06FC\\u06FF\\u0710-\\u074A\\u074D-\\u07B1\\u07C0-\\u07F5\\u07FA\\u0800-\\u082D\\u0840-\\u085B\\u08A0-\\u08B2\\u08E4-\\u0963\\u0966-\\u096F\\u0971-\\u0983\\u0985-\\u098C\\u098F\\u0990\\u0993-\\u09A8\\u09AA-\\u09B0\\u09B2\\u09B6-\\u09B9\\u09BC-\\u09C4\\u09C7\\u09C8\\u09CB-\\u09CE\\u09D7\\u09DC\\u09DD\\u09DF-\\u09E3\\u09E6-\\u09F1\\u0A01-\\u0A03\\u0A05-\\u0A0A\\u0A0F\\u0A10\\u0A13-\\u0A28\\u0A2A-\\u0A30\\u0A32\\u0A33\\u0A35\\u0A36\\u0A38\\u0A39\\u0A3C\\u0A3E-\\u0A42\\u0A47\\u0A48\\u0A4B-\\u0A4D\\u0A51\\u0A59-\\u0A5C\\u0A5E\\u0A66-\\u0A75\\u0A81-\\u0A83\\u0A85-\\u0A8D\\u0A8F-\\u0A91\\u0A93-\\u0AA8\\u0AAA-\\u0AB0\\u0AB2\\u0AB3\\u0AB5-\\u0AB9\\u0ABC-\\u0AC5\\u0AC7-\\u0AC9\\u0ACB-\\u0ACD\\u0AD0\\u0AE0-\\u0AE3\\u0AE6-\\u0AEF\\u0B01-\\u0B03\\u0B05-\\u0B0C\\u0B0F\\u0B10\\u0B13-\\u0B28\\u0B2A-\\u0B30\\u0B32\\u0B33\\u0B35-\\u0B39\\u0B3C-\\u0B44\\u0B47\\u0B48\\u0B4B-\\u0B4D\\u0B56\\u0B57\\u0B5C\\u0B5D\\u0B5F-\\u0B63\\u0B66-\\u0B6F\\u0B71\\u0B82\\u0B83\\u0B85-\\u0B8A\\u0B8E-\\u0B90\\u0B92-\\u0B95\\u0B99\\u0B9A\\u0B9C\\u0B9E\\u0B9F\\u0BA3\\u0BA4\\u0BA8-\\u0BAA\\u0BAE-\\u0BB9\\u0BBE-\\u0BC2\\u0BC6-\\u0BC8\\u0BCA-\\u0BCD\\u0BD0\\u0BD7\\u0BE6-\\u0BEF\\u0C00-\\u0C03\\u0C05-\\u0C0C\\u0C0E-\\u0C10\\u0C12-\\u0C28\\u0C2A-\\u0C39\\u0C3D-\\u0C44\\u0C46-\\u0C48\\u0C4A-\\u0C4D\\u0C55\\u0C56\\u0C58\\u0C59\\u0C60-\\u0C63\\u0C66-\\u0C6F\\u0C81-\\u0C83\\u0C85-\\u0C8C\\u0C8E-\\u0C90\\u0C92-\\u0CA8\\u0CAA-\\u0CB3\\u0CB5-\\u0CB9\\u0CBC-\\u0CC4\\u0CC6-\\u0CC8\\u0CCA-\\u0CCD\\u0CD5\\u0CD6\\u0CDE\\u0CE0-\\u0CE3\\u0CE6-\\u0CEF\\u0CF1\\u0CF2\\u0D01-\\u0D03\\u0D05-\\u0D0C\\u0D0E-\\u0D10\\u0D12-\\u0D3A\\u0D3D-\\u0D44\\u0D46-\\u0D48\\u0D4A-\\u0D4E\\u0D57\\u0D60-\\u0D63\\u0D66-\\u0D6F\\u0D7A-\\u0D7F\\u0D82\\u0D83\\u0D85-\\u0D96\\u0D9A-\\u0DB1\\u0DB3-\\u0DBB\\u0DBD\\u0DC0-\\u0DC6\\u0DCA\\u0DCF-\\u0DD4\\u0DD6\\u0DD8-\\u0DDF\\u0DE6-\\u0DEF\\u0DF2\\u0DF3\\u0E01-\\u0E3A\\u0E40-\\u0E4E\\u0E50-\\u0E59\\u0E81\\u0E82\\u0E84\\u0E87\\u0E88\\u0E8A\\u0E8D\\u0E94-\\u0E97\\u0E99-\\u0E9F\\u0EA1-\\u0EA3\\u0EA5\\u0EA7\\u0EAA\\u0EAB\\u0EAD-\\u0EB9\\u0EBB-\\u0EBD\\u0EC0-\\u0EC4\\u0EC6\\u0EC8-\\u0ECD\\u0ED0-\\u0ED9\\u0EDC-\\u0EDF\\u0F00\\u0F18\\u0F19\\u0F20-\\u0F29\\u0F35\\u0F37\\u0F39\\u0F3E-\\u0F47\\u0F49-\\u0F6C\\u0F71-\\u0F84\\u0F86-\\u0F97\\u0F99-\\u0FBC\\u0FC6\\u1000-\\u1049\\u1050-\\u109D\\u10A0-\\u10C5\\u10C7\\u10CD\\u10D0-\\u10FA\\u10FC-\\u1248\\u124A-\\u124D\\u1250-\\u1256\\u1258\\u125A-\\u125D\\u1260-\\u1288\\u128A-\\u128D\\u1290-\\u12B0\\u12B2-\\u12B5\\u12B8-\\u12BE\\u12C0\\u12C2-\\u12C5\\u12C8-\\u12D6\\u12D8-\\u1310\\u1312-\\u1315\\u1318-\\u135A\\u135D-\\u135F\\u1380-\\u138F\\u13A0-\\u13F4\\u1401-\\u166C\\u166F-\\u167F\\u1681-\\u169A\\u16A0-\\u16EA\\u16EE-\\u16F8\\u1700-\\u170C\\u170E-\\u1714\\u1720-\\u1734\\u1740-\\u1753\\u1760-\\u176C\\u176E-\\u1770\\u1772\\u1773\\u1780-\\u17D3\\u17D7\\u17DC\\u17DD\\u17E0-\\u17E9\\u180B-\\u180D\\u1810-\\u1819\\u1820-\\u1877\\u1880-\\u18AA\\u18B0-\\u18F5\\u1900-\\u191E\\u1920-\\u192B\\u1930-\\u193B\\u1946-\\u196D\\u1970-\\u1974\\u1980-\\u19AB\\u19B0-\\u19C9\\u19D0-\\u19D9\\u1A00-\\u1A1B\\u1A20-\\u1A5E\\u1A60-\\u1A7C\\u1A7F-\\u1A89\\u1A90-\\u1A99\\u1AA7\\u1AB0-\\u1ABD\\u1B00-\\u1B4B\\u1B50-\\u1B59\\u1B6B-\\u1B73\\u1B80-\\u1BF3\\u1C00-\\u1C37\\u1C40-\\u1C49\\u1C4D-\\u1C7D\\u1CD0-\\u1CD2\\u1CD4-\\u1CF6\\u1CF8\\u1CF9\\u1D00-\\u1DF5\\u1DFC-\\u1F15\\u1F18-\\u1F1D\\u1F20-\\u1F45\\u1F48-\\u1F4D\\u1F50-\\u1F57\\u1F59\\u1F5B\\u1F5D\\u1F5F-\\u1F7D\\u1F80-\\u1FB4\\u1FB6-\\u1FBC\\u1FBE\\u1FC2-\\u1FC4\\u1FC6-\\u1FCC\\u1FD0-\\u1FD3\\u1FD6-\\u1FDB\\u1FE0-\\u1FEC\\u1FF2-\\u1FF4\\u1FF6-\\u1FFC\\u200C\\u200D\\u203F\\u2040\\u2054\\u2071\\u207F\\u2090-\\u209C\\u20D0-\\u20DC\\u20E1\\u20E5-\\u20F0\\u2102\\u2107\\u210A-\\u2113\\u2115\\u2119-\\u211D\\u2124\\u2126\\u2128\\u212A-\\u212D\\u212F-\\u2139\\u213C-\\u213F\\u2145-\\u2149\\u214E\\u2160-\\u2188\\u2C00-\\u2C2E\\u2C30-\\u2C5E\\u2C60-\\u2CE4\\u2CEB-\\u2CF3\\u2D00-\\u2D25\\u2D27\\u2D2D\\u2D30-\\u2D67\\u2D6F\\u2D7F-\\u2D96\\u2DA0-\\u2DA6\\u2DA8-\\u2DAE\\u2DB0-\\u2DB6\\u2DB8-\\u2DBE\\u2DC0-\\u2DC6\\u2DC8-\\u2DCE\\u2DD0-\\u2DD6\\u2DD8-\\u2DDE\\u2DE0-\\u2DFF\\u2E2F\\u3005-\\u3007\\u3021-\\u302F\\u3031-\\u3035\\u3038-\\u303C\\u3041-\\u3096\\u3099\\u309A\\u309D-\\u309F\\u30A1-\\u30FA\\u30FC-\\u30FF\\u3105-\\u312D\\u3131-\\u318E\\u31A0-\\u31BA\\u31F0-\\u31FF\\u3400-\\u4DB5\\u4E00-\\u9FCC\\uA000-\\uA48C\\uA4D0-\\uA4FD\\uA500-\\uA60C\\uA610-\\uA62B\\uA640-\\uA66F\\uA674-\\uA67D\\uA67F-\\uA69D\\uA69F-\\uA6F1\\uA717-\\uA71F\\uA722-\\uA788\\uA78B-\\uA78E\\uA790-\\uA7AD\\uA7B0\\uA7B1\\uA7F7-\\uA827\\uA840-\\uA873\\uA880-\\uA8C4\\uA8D0-\\uA8D9\\uA8E0-\\uA8F7\\uA8FB\\uA900-\\uA92D\\uA930-\\uA953\\uA960-\\uA97C\\uA980-\\uA9C0\\uA9CF-\\uA9D9\\uA9E0-\\uA9FE\\uAA00-\\uAA36\\uAA40-\\uAA4D\\uAA50-\\uAA59\\uAA60-\\uAA76\\uAA7A-\\uAAC2\\uAADB-\\uAADD\\uAAE0-\\uAAEF\\uAAF2-\\uAAF6\\uAB01-\\uAB06\\uAB09-\\uAB0E\\uAB11-\\uAB16\\uAB20-\\uAB26\\uAB28-\\uAB2E\\uAB30-\\uAB5A\\uAB5C-\\uAB5F\\uAB64\\uAB65\\uABC0-\\uABEA\\uABEC\\uABED\\uABF0-\\uABF9\\uAC00-\\uD7A3\\uD7B0-\\uD7C6\\uD7CB-\\uD7FB\\uF900-\\uFA6D\\uFA70-\\uFAD9\\uFB00-\\uFB06\\uFB13-\\uFB17\\uFB1D-\\uFB28\\uFB2A-\\uFB36\\uFB38-\\uFB3C\\uFB3E\\uFB40\\uFB41\\uFB43\\uFB44\\uFB46-\\uFBB1\\uFBD3-\\uFD3D\\uFD50-\\uFD8F\\uFD92-\\uFDC7\\uFDF0-\\uFDFB\\uFE00-\\uFE0F\\uFE20-\\uFE2D\\uFE33\\uFE34\\uFE4D-\\uFE4F\\uFE70-\\uFE74\\uFE76-\\uFEFC\\uFF10-\\uFF19\\uFF21-\\uFF3A\\uFF3F\\uFF41-\\uFF5A\\uFF66-\\uFFBE\\uFFC2-\\uFFC7\\uFFCA-\\uFFCF\\uFFD2-\\uFFD7\\uFFDA-\\uFFDC]");function wI(t,e){if(!t){throw new Error("ASSERT: "+e)}}function AI(t){return t>=48&&t<=57}function xI(t){return"0123456789abcdefABCDEF".indexOf(t)>=0}function OI(t){return"01234567".indexOf(t)>=0}function FI(t){return t===32||t===9||t===11||t===12||t===160||t>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(t)>=0}function DI(t){return t===10||t===13||t===8232||t===8233}function kI(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t===92||t>=128&&vI.test(String.fromCharCode(t))}function EI(t){return t===36||t===95||t>=65&&t<=90||t>=97&&t<=122||t>=48&&t<=57||t===92||t>=128&&yI.test(String.fromCharCode(t))}const $I={if:1,in:1,do:1,var:1,for:1,new:1,try:1,let:1,this:1,else:1,case:1,void:1,with:1,enum:1,while:1,break:1,catch:1,throw:1,const:1,yield:1,class:1,super:1,return:1,typeof:1,delete:1,switch:1,export:1,import:1,public:1,static:1,default:1,finally:1,extends:1,package:1,private:1,function:1,continue:1,debugger:1,interface:1,protected:1,instanceof:1,implements:1};function jI(){while(TL<PL){const t=zL.charCodeAt(TL);if(FI(t)||DI(t)){++TL}else{break}}}function CI(t){var e,n,i,r=0;n=t==="u"?4:2;for(e=0;e<n;++e){if(TL<PL&&xI(zL[TL])){i=zL[TL++];r=r*16+"0123456789abcdef".indexOf(i.toLowerCase())}else{rR({},oI,gI)}}return String.fromCharCode(r)}function MI(){var t,e,n,i;t=zL[TL];e=0;if(t==="}"){rR({},oI,gI)}while(TL<PL){t=zL[TL++];if(!xI(t)){break}e=e*16+"0123456789abcdef".indexOf(t.toLowerCase())}if(e>1114111||t!=="}"){rR({},oI,gI)}if(e<=65535){return String.fromCharCode(e)}n=(e-65536>>10)+55296;i=(e-65536&1023)+56320;return String.fromCharCode(n,i)}function BI(){var t,e;t=zL.charCodeAt(TL++);e=String.fromCharCode(t);if(t===92){if(zL.charCodeAt(TL)!==117){rR({},oI,gI)}++TL;t=CI("u");if(!t||t==="\\"||!kI(t.charCodeAt(0))){rR({},oI,gI)}e=t}while(TL<PL){t=zL.charCodeAt(TL);if(!EI(t)){break}++TL;e+=String.fromCharCode(t);if(t===92){e=e.substr(0,e.length-1);if(zL.charCodeAt(TL)!==117){rR({},oI,gI)}++TL;t=CI("u");if(!t||t==="\\"||!EI(t.charCodeAt(0))){rR({},oI,gI)}e+=t}}return e}function SI(){var t,e;t=TL++;while(TL<PL){e=zL.charCodeAt(TL);if(e===92){TL=t;return BI()}if(EI(e)){++TL}else{break}}return zL.slice(t,TL)}function _I(){var t,e,n;t=TL;e=zL.charCodeAt(TL)===92?BI():SI();if(e.length===1){n=qL}else if($I.hasOwnProperty(e)){n=UL}else if(e==="null"){n=WL}else if(e==="true"||e==="false"){n=IL}else{n=qL}return{type:n,value:e,start:t,end:TL}}function NI(){var t=TL,e=zL.charCodeAt(TL),n,i=zL[TL],r,u,o;switch(e){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:++TL;return{type:HL,value:String.fromCharCode(e),start:t,end:TL};default:n=zL.charCodeAt(TL+1);if(n===61){switch(e){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:TL+=2;return{type:HL,value:String.fromCharCode(e)+String.fromCharCode(n),start:t,end:TL};case 33:case 61:TL+=2;if(zL.charCodeAt(TL)===61){++TL}return{type:HL,value:zL.slice(t,TL),start:t,end:TL}}}}o=zL.substr(TL,4);if(o===">>>="){TL+=4;return{type:HL,value:o,start:t,end:TL}}u=o.substr(0,3);if(u===">>>"||u==="<<="||u===">>="){TL+=3;return{type:HL,value:u,start:t,end:TL}}r=u.substr(0,2);if(i===r[1]&&"+-<>&|".indexOf(i)>=0||r==="=>"){TL+=2;return{type:HL,value:r,start:t,end:TL}}if(r==="//"){rR({},oI,gI)}if("<>=!+-*%&|^/".indexOf(i)>=0){++TL;return{type:HL,value:i,start:t,end:TL}}rR({},oI,gI)}function zI(t){let e="";while(TL<PL){if(!xI(zL[TL])){break}e+=zL[TL++]}if(e.length===0){rR({},oI,gI)}if(kI(zL.charCodeAt(TL))){rR({},oI,gI)}return{type:GL,value:parseInt("0x"+e,16),start:t,end:TL}}function TI(t){let e="0"+zL[TL++];while(TL<PL){if(!OI(zL[TL])){break}e+=zL[TL++]}if(kI(zL.charCodeAt(TL))||AI(zL.charCodeAt(TL))){rR({},oI,gI)}return{type:GL,value:parseInt(e,8),octal:true,start:t,end:TL}}function PI(){var t,e,n;n=zL[TL];wI(AI(n.charCodeAt(0))||n===".","Numeric literal must start with a decimal digit or a decimal point");e=TL;t="";if(n!=="."){t=zL[TL++];n=zL[TL];if(t==="0"){if(n==="x"||n==="X"){++TL;return zI(e)}if(OI(n)){return TI(e)}if(n&&AI(n.charCodeAt(0))){rR({},oI,gI)}}while(AI(zL.charCodeAt(TL))){t+=zL[TL++]}n=zL[TL]}if(n==="."){t+=zL[TL++];while(AI(zL.charCodeAt(TL))){t+=zL[TL++]}n=zL[TL]}if(n==="e"||n==="E"){t+=zL[TL++];n=zL[TL];if(n==="+"||n==="-"){t+=zL[TL++]}if(AI(zL.charCodeAt(TL))){while(AI(zL.charCodeAt(TL))){t+=zL[TL++]}}else{rR({},oI,gI)}}if(kI(zL.charCodeAt(TL))){rR({},oI,gI)}return{type:GL,value:parseFloat(t),start:e,end:TL}}function LI(){var t="",e,n,i,r,u=false;e=zL[TL];wI(e==="'"||e==='"',"String literal must starts with a quote");n=TL;++TL;while(TL<PL){i=zL[TL++];if(i===e){e="";break}else if(i==="\\"){i=zL[TL++];if(!i||!DI(i.charCodeAt(0))){switch(i){case"u":case"x":if(zL[TL]==="{"){++TL;t+=MI()}else{t+=CI(i)}break;case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:if(OI(i)){r="01234567".indexOf(i);if(r!==0){u=true}if(TL<PL&&OI(zL[TL])){u=true;r=r*8+"01234567".indexOf(zL[TL++]);if("0123".indexOf(i)>=0&&TL<PL&&OI(zL[TL])){r=r*8+"01234567".indexOf(zL[TL++])}}t+=String.fromCharCode(r)}else{t+=i}break}}else{if(i==="\r"&&zL[TL]==="\n"){++TL}}}else if(DI(i.charCodeAt(0))){break}else{t+=i}}if(e!==""){rR({},oI,gI)}return{type:VL,value:t,octal:u,start:n,end:TL}}function II(t,e){let n=t;if(e.indexOf("u")>=0){n=n.replace(/\\u\{([0-9a-fA-F]+)\}/g,((t,e)=>{if(parseInt(e,16)<=1114111){return"x"}rR({},dI)})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x")}try{return new RegExp(t,e)}catch(i){return null}}function RI(){var t,e,n,i,r;t=zL[TL];wI(t==="/","Regular expression literal must start with a slash");e=zL[TL++];n=false;i=false;while(TL<PL){t=zL[TL++];e+=t;if(t==="\\"){t=zL[TL++];if(DI(t.charCodeAt(0))){rR({},hI)}e+=t}else if(DI(t.charCodeAt(0))){rR({},hI)}else if(n){if(t==="]"){n=false}}else{if(t==="/"){i=true;break}else if(t==="["){n=true}}}if(!i){rR({},hI)}r=e.substr(1,e.length-2);return{value:r,literal:e}}function qI(){var t,e,n;e="";n="";while(TL<PL){t=zL[TL];if(!EI(t.charCodeAt(0))){break}++TL;if(t==="\\"&&TL<PL){rR({},oI,gI)}else{n+=t;e+=t}}if(n.search(/[^gimuy]/g)>=0){rR({},dI,n)}return{value:n,literal:e}}function UI(){var t,e,n,i;LL=null;jI();t=TL;e=RI();n=qI();i=II(e.value,n.value);return{literal:e.literal+n.literal,value:i,regex:{pattern:e.value,flags:n.value},start:t,end:TL}}function WI(t){return t.type===qL||t.type===UL||t.type===IL||t.type===WL}function GI(){jI();if(TL>=PL){return{type:RL,start:TL,end:TL}}const t=zL.charCodeAt(TL);if(kI(t)){return _I()}if(t===40||t===41||t===59){return NI()}if(t===39||t===34){return LI()}if(t===46){if(AI(zL.charCodeAt(TL+1))){return PI()}return NI()}if(AI(t)){return PI()}return NI()}function HI(){const t=LL;TL=t.end;LL=GI();TL=t.end;return t}function VI(){const t=TL;LL=GI();TL=t}function YI(t){const e=new SL(XL);e.elements=t;return e}function XI(t,e,n){const i=new SL(t==="||"||t==="&&"?eI:JL);i.operator=t;i.left=e;i.right=n;return i}function JI(t,e){const n=new SL(QL);n.callee=t;n.arguments=e;return n}function QI(t,e,n){const i=new SL(ZL);i.test=t;i.consequent=e;i.alternate=n;return i}function ZI(t){const e=new SL(KL);e.name=t;return e}function KI(t){const e=new SL(tI);e.value=t.value;e.raw=zL.slice(t.start,t.end);if(t.regex){if(e.raw==="//"){e.raw="/(?:)/"}e.regex=t.regex}return e}function tR(t,e,n){const i=new SL(nI);i.computed=t==="[";i.object=e;i.property=n;if(!i.computed)n.member=true;return i}function eR(t){const e=new SL(iI);e.properties=t;return e}function nR(t,e,n){const i=new SL(rI);i.key=e;i.value=n;i.kind=t;return i}function iR(t,e){const n=new SL(uI);n.operator=t;n.argument=e;n.prefix=true;return n}function rR(t,e){var n,i=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,((t,e)=>{wI(e<i.length,"Message reference must be in range");return i[e]}));n=new Error(r);n.index=TL;n.description=r;throw n}function uR(t){if(t.type===RL){rR(t,lI)}if(t.type===GL){rR(t,sI)}if(t.type===VL){rR(t,aI)}if(t.type===qL){rR(t,fI)}if(t.type===UL){rR(t,cI)}rR(t,oI,t.value)}function oR(t){const e=HI();if(e.type!==HL||e.value!==t){uR(e)}}function sR(t){return LL.type===HL&&LL.value===t}function aR(t){return LL.type===UL&&LL.value===t}function fR(){const t=[];TL=LL.start;oR("[");while(!sR("]")){if(sR(",")){HI();t.push(null)}else{t.push(DR());if(!sR("]")){oR(",")}}}HI();return YI(t)}function cR(){TL=LL.start;const t=HI();if(t.type===VL||t.type===GL){if(t.octal){rR(t,pI)}return KI(t)}return ZI(t.value)}function lR(){var t,e,n,i;TL=LL.start;t=LL;if(t.type===qL){n=cR();oR(":");i=DR();return nR("init",n,i)}if(t.type===RL||t.type===HL){uR(t)}else{e=cR();oR(":");i=DR();return nR("init",e,i)}}function dR(){var t=[],e,n,i,r={},u=String;TL=LL.start;oR("{");while(!sR("}")){e=lR();if(e.key.type===KL){n=e.key.name}else{n=u(e.key.value)}i="$"+n;if(Object.prototype.hasOwnProperty.call(r,i)){rR({},mI)}else{r[i]=true}t.push(e);if(!sR("}")){oR(",")}}oR("}");return eR(t)}function hR(){oR("(");const t=kR();oR(")");return t}const pR={if:1};function mR(){var t,e,n;if(sR("(")){return hR()}if(sR("[")){return fR()}if(sR("{")){return dR()}t=LL.type;TL=LL.start;if(t===qL||pR[LL.value]){n=ZI(HI().value)}else if(t===VL||t===GL){if(LL.octal){rR(LL,pI)}n=KI(HI())}else if(t===UL){throw new Error(bI)}else if(t===IL){e=HI();e.value=e.value==="true";n=KI(e)}else if(t===WL){e=HI();e.value=null;n=KI(e)}else if(sR("/")||sR("/=")){n=KI(UI());VI()}else{uR(HI())}return n}function gR(){const t=[];oR("(");if(!sR(")")){while(TL<PL){t.push(DR());if(sR(")")){break}oR(",")}}oR(")");return t}function bR(){TL=LL.start;const t=HI();if(!WI(t)){uR(t)}return ZI(t.value)}function vR(){oR(".");return bR()}function yR(){oR("[");const t=kR();oR("]");return t}function wR(){var t,e,n;t=mR();for(;;){if(sR(".")){n=vR();t=tR(".",t,n)}else if(sR("(")){e=gR();t=JI(t,e)}else if(sR("[")){n=yR();t=tR("[",t,n)}else{break}}return t}function AR(){const t=wR();if(LL.type===HL){if(sR("++")||sR("--")){throw new Error(bI)}}return t}function xR(){var t,e;if(LL.type!==HL&&LL.type!==UL){e=AR()}else if(sR("++")||sR("--")){throw new Error(bI)}else if(sR("+")||sR("-")||sR("~")||sR("!")){t=HI();e=xR();e=iR(t.value,e)}else if(aR("delete")||aR("void")||aR("typeof")){throw new Error(bI)}else{e=AR()}return e}function OR(t){let e=0;if(t.type!==HL&&t.type!==UL){return 0}switch(t.value){case"||":e=1;break;case"&&":e=2;break;case"|":e=3;break;case"^":e=4;break;case"&":e=5;break;case"==":case"!=":case"===":case"!==":e=6;break;case"<":case">":case"<=":case">=":case"instanceof":case"in":e=7;break;case"<<":case">>":case">>>":e=8;break;case"+":case"-":e=9;break;case"*":case"/":case"%":e=11;break}return e}function FR(){var t,e,n,i,r,u,o,s,a,f;t=LL;a=xR();i=LL;r=OR(i);if(r===0){return a}i.prec=r;HI();e=[t,LL];o=xR();u=[a,i,o];while((r=OR(LL))>0){while(u.length>2&&r<=u[u.length-2].prec){o=u.pop();s=u.pop().value;a=u.pop();e.pop();n=XI(s,a,o);u.push(n)}i=HI();i.prec=r;u.push(i);e.push(LL);n=xR();u.push(n)}f=u.length-1;n=u[f];e.pop();while(f>1){e.pop();n=XI(u[f-1].value,u[f-2],n);f-=2}return n}function DR(){var t,e,n;t=FR();if(sR("?")){HI();e=DR();oR(":");n=DR();t=QI(t,e,n)}return t}function kR(){const t=DR();if(sR(",")){throw new Error(bI)}return t}function ER(t){zL=t;TL=0;PL=zL.length;LL=null;VI();const e=kR();if(LL.type!==RL){throw new Error("Unexpect token after expression.")}return e}var $R={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2",MIN_VALUE:"Number.MIN_VALUE",MAX_VALUE:"Number.MAX_VALUE"};function jR(t){function e(e,n,i,r){let u=t(n[0]);if(i){u=i+"("+u+")";if(i.lastIndexOf("new ",0)===0)u="("+u+")"}return u+"."+e+(r<0?"":r===0?"()":"("+n.slice(1).map(t).join(",")+")")}function n(t,n,i){return r=>e(t,r,n,i)}const i="new Date",r="String",u="RegExp";return{isNaN:"Number.isNaN",isFinite:"Number.isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",clamp:function(e){if(e.length<3)ne("Missing arguments to clamp function.");if(e.length>3)ne("Too many arguments to clamp function.");const n=e.map(t);return"Math.max("+n[1]+", Math.min("+n[2]+","+n[0]+"))"},now:"Date.now",utc:"Date.UTC",datetime:i,date:n("getDate",i,0),day:n("getDay",i,0),year:n("getFullYear",i,0),month:n("getMonth",i,0),hours:n("getHours",i,0),minutes:n("getMinutes",i,0),seconds:n("getSeconds",i,0),milliseconds:n("getMilliseconds",i,0),time:n("getTime",i,0),timezoneoffset:n("getTimezoneOffset",i,0),utcdate:n("getUTCDate",i,0),utcday:n("getUTCDay",i,0),utcyear:n("getUTCFullYear",i,0),utcmonth:n("getUTCMonth",i,0),utchours:n("getUTCHours",i,0),utcminutes:n("getUTCMinutes",i,0),utcseconds:n("getUTCSeconds",i,0),utcmilliseconds:n("getUTCMilliseconds",i,0),length:n("length",null,-1),parseFloat:"parseFloat",parseInt:"parseInt",upper:n("toUpperCase",r,0),lower:n("toLowerCase",r,0),substring:n("substring",r),split:n("split",r),trim:n("trim",r,0),regexp:u,test:n("test",u),if:function(e){if(e.length<3)ne("Missing arguments to if function.");if(e.length>3)ne("Too many arguments to if function.");const n=e.map(t);return"("+n[0]+"?"+n[1]+":"+n[2]+")"}}}function CR(t){const e=t&&t.length-1;return e&&(t[0]==='"'&&t[e]==='"'||t[0]==="'"&&t[e]==="'")?t.slice(1,-1):t}function MR(t){t=t||{};const e=t.allowed?Cn(t.allowed):{},n=t.forbidden?Cn(t.forbidden):{},i=t.constants||$R,r=(t.functions||jR)(l),u=t.globalvar,o=t.fieldvar,s=Ge(u)?u:t=>`${u}["${t}"]`;let a={},f={},c=0;function l(t){if(gn(t))return t;const e=d[t.type];if(e==null)ne("Unsupported type: "+t.type);return e(t)}const d={Literal:t=>t.raw,Identifier:t=>{const r=t.name;if(c>0){return r}else if(un(n,r)){return ne("Illegal identifier: "+r)}else if(un(i,r)){return i[r]}else if(un(e,r)){return r}else{a[r]=1;return s(r)}},MemberExpression:t=>{const e=!t.computed,n=l(t.object);if(e)c+=1;const i=l(t.property);if(n===o){f[CR(i)]=1}if(e)c-=1;return n+(e?"."+i:"["+i+"]")},CallExpression:t=>{if(t.callee.type!=="Identifier"){ne("Illegal callee type: "+t.callee.type)}const e=t.callee.name,n=t.arguments,i=un(r,e)&&r[e];if(!i)ne("Unrecognized function: "+e);return Ge(i)?i(n):i+"("+n.map(l).join(",")+")"},ArrayExpression:t=>"["+t.elements.map(l).join(",")+"]",BinaryExpression:t=>"("+l(t.left)+" "+t.operator+" "+l(t.right)+")",UnaryExpression:t=>"("+t.operator+l(t.argument)+")",ConditionalExpression:t=>"("+l(t.test)+"?"+l(t.consequent)+":"+l(t.alternate)+")",LogicalExpression:t=>"("+l(t.left)+t.operator+l(t.right)+")",ObjectExpression:t=>"{"+t.properties.map(l).join(",")+"}",Property:t=>{c+=1;const e=l(t.key);c-=1;return e+":"+l(t.value)}};function h(t){const e={code:l(t),globals:Object.keys(a),fields:Object.keys(f)};a={};f={};return e}h.functions=r;h.constants=i;return h}const BR="intersect";const SR="union";const _R="vlMulti";const NR="vlPoint";const zR="or";const TR="and";const PR="_vgsid_";const LR=re(PR);const IR="E",RR="R",qR="R-E",UR="R-LE",WR="R-RE",GR="index:unit";function HR(t,e){var n=e.fields,i=e.values,r=n.length,u=0,o,s;for(;u<r;++u){s=n[u];s.getter=re.getter||re(s.field);o=s.getter(t);if(dn(o))o=De(o);if(dn(i[u]))i[u]=De(i[u]);if(dn(i[u][0]))i[u]=i[u].map(De);if(s.type===IR){if(ve(i[u])?i[u].indexOf(o)<0:o!==i[u]){return false}}else{if(s.type===RR){if(!cn(o,i[u]))return false}else if(s.type===WR){if(!cn(o,i[u],true,false))return false}else if(s.type===qR){if(!cn(o,i[u],false,false))return false}else if(s.type===UR){if(!cn(o,i[u],false,true))return false}}}return true}function VR(t,e,n){var i=this.context.data[t],r=i?i.values.value:[],u=i?i[GR]&&i[GR].value:undefined,o=n===BR,s=r.length,a=0,f,c,l,d,h;for(;a<s;++a){f=r[a];if(u&&o){c=c||{};l=c[d=f.unit]||0;if(l===-1)continue;h=HR(e,f);c[d]=h?-1:++l;if(h&&u.size===1)return true;if(!h&&l===u.get(d).count)return false}else{h=HR(e,f);if(o^h)return h}}return s&&o}const YR=gL(LR),XR=YR.left,JR=YR.right;function QR(t,e,n){const i=this.context.data[t],r=i?i.values.value:[],u=i?i[GR]&&i[GR].value:undefined,o=n===BR,s=LR(e),a=XR(r,s);if(a===r.length)return false;if(LR(r[a])!==s)return false;if(u&&o){if(u.size===1)return true;if(JR(r,s)-a<u.size)return false}return true}function ZR(t,e){return t.map((t=>tn(e.fields?{values:e.fields.map((e=>(e.getter||(e.getter=re(e.field)))(t.datum)))}:{[PR]:LR(t.datum)},e)))}function KR(t,e,n,i){var r=this.context.data[t],u=r?r.values.value:[],o={},s={},a={},f,c,l,d,h,p,m,g,b,v,y=u.length,w=0,A,x;for(;w<y;++w){f=u[w];d=f.unit;c=f.fields;l=f.values;if(c&&l){for(A=0,x=c.length;A<x;++A){h=c[A];m=o[h.field]||(o[h.field]={});g=m[d]||(m[d]=[]);a[h.field]=b=h.type.charAt(0);v=tq[`${b}_union`];m[d]=v(g,Ue(l[A]))}if(n){g=s[d]||(s[d]=[]);g.push(Ue(l).reduce(((t,e,n)=>(t[c[n].field]=e,t)),{}))}}else{h=PR;p=LR(f);m=o[h]||(o[h]={});g=m[d]||(m[d]=[]);g.push(p);if(n){g=s[d]||(s[d]=[]);g.push({[PR]:p})}}}e=e||SR;if(o[PR]){o[PR]=tq[`${PR}_${e}`](...Object.values(o[PR]))}else{Object.keys(o).forEach((t=>{o[t]=Object.keys(o[t]).map((e=>o[t][e])).reduce(((n,i)=>n===undefined?i:tq[`${a[t]}_${e}`](n,i)))}))}u=Object.keys(s);if(n&&u.length){const t=i?NR:_R;o[t]=e===SR?{[zR]:u.reduce(((t,e)=>(t.push(...s[e]),t)),[])}:{[TR]:u.map((t=>({[zR]:s[t]})))}}return o}var tq={[`${PR}_union`]:wL,[`${PR}_intersect`]:vL,E_union:function(t,e){if(!t.length)return e;var n=0,i=e.length;for(;n<i;++n)if(t.indexOf(e[n])<0)t.push(e[n]);return t},E_intersect:function(t,e){return!t.length?e:t.filter((t=>e.indexOf(t)>=0))},R_union:function(t,e){var n=De(e[0]),i=De(e[1]);if(n>i){n=e[1];i=e[0]}if(!t.length)return[n,i];if(t[0]>n)t[0]=n;if(t[1]<i)t[1]=i;return t},R_intersect:function(t,e){var n=De(e[0]),i=De(e[1]);if(n>i){n=e[1];i=e[0]}if(!t.length)return[n,i];if(i<t[0]||t[1]<n){return[]}else{if(t[0]<n)t[0]=n;if(t[1]>i)t[1]=i}return t}};const eq=":",nq="@";function iq(t,e,n,i){if(e[0].type!==xL)ne("First argument to selection functions must be a string literal.");const r=e[0].value,u=e.length>=2&&Fe(e).value,o="unit",s=nq+o,a=eq+r;if(u===BR&&!un(i,s)){i[s]=n.getData(r).indataRef(n,o)}if(!un(i,a)){i[a]=n.getData(r).tuplesRef()}}function rq(t){const e=this.context.data[t];return e?e.values.value:[]}function uq(t,e,n){const i=this.context.data[t]["index:"+e],r=i?i.value.get(n):undefined;return r?r.count:r}function oq(t,e){const n=this.context.dataflow,i=this.context.data[t],r=i.input;n.pulse(r,n.changeset().remove(fe).insert(e));return 1}function sq(t,e,n){if(t){const n=this.context.dataflow,i=t.mark.source;n.pulse(i,n.changeset().encode(t,e))}return n!==undefined?n:t}const aq=t=>function(e,n){const i=this.context.dataflow.locale();return i[t](n)(e)};const fq=aq("format");const cq=aq("timeFormat");const lq=aq("utcFormat");const dq=aq("timeParse");const hq=aq("utcParse");const pq=new Date(2e3,0,1);function mq(t,e,n){if(!Number.isInteger(t)||!Number.isInteger(e))return"";pq.setYear(2e3);pq.setMonth(t);pq.setDate(e);return cq.call(this,pq,n)}function gq(t){return mq.call(this,t,1,"%B")}function bq(t){return mq.call(this,t,1,"%b")}function vq(t){return mq.call(this,0,2+t,"%A")}function yq(t){return mq.call(this,0,2+t,"%a")}const wq=":";const Aq="@";const xq="%";const Oq="$";function Fq(t,e,n,i){if(e[0].type!==rT){ne("First argument to data functions must be a string literal.")}const r=e[0].value,u=wq+r;if(!un(u,i)){try{i[u]=n.getData(r).tuplesRef()}catch(o){}}}function Dq(t,e,n,i){if(e[0].type!==rT)ne("First argument to indata must be a string literal.");if(e[1].type!==rT)ne("Second argument to indata must be a string literal.");const r=e[0].value,u=e[1].value,o=Aq+u;if(!un(o,i)){i[o]=n.getData(r).indataRef(n,u)}}function kq(t,e,n,i){if(e[0].type===rT){Eq(n,i,e[0].value)}else{for(t in n.scales){Eq(n,i,t)}}}function Eq(t,e,n){const i=xq+n;if(!un(e,i)){try{e[i]=t.scaleRef(n)}catch(r){}}}function $q(t,e){if(Ge(t)){return t}if(gn(t)){const n=e.scales[t];return n&&Ng(n.value)?n.value:undefined}return undefined}function jq(t,e,n){e.__bandwidth=t=>t&&t.bandwidth?t.bandwidth():0;n._bandwidth=kq;n._range=kq;n._scale=kq;const i=e=>"_["+(e.type===rT?Dn(xq+e.value):Dn(xq)+"+"+t(e))+"]";return{_bandwidth:t=>`this.__bandwidth(${i(t[0])})`,_range:t=>`${i(t[0])}.range()`,_scale:e=>`${i(e[0])}(${t(e[1])})`}}function Cq(t,e){return function(n,i,r){if(n){const e=$q(n,(r||this).context);return e&&e.path[t](i)}else{return e(i)}}}const Mq=Cq("area",FE);const Bq=Cq("bounds",t$);const Sq=Cq("centroid",$$);function _q(t){const e=this.context.group;let n=false;if(e)while(t){if(t===e){n=true;break}t=t.mark.group}return n}function Nq(t,e,n){try{t[e].apply(t,["EXPRESSION"].concat([].slice.call(n)))}catch(i){t.warn(i)}return n[n.length-1]}function zq(){return Nq(this.context.dataflow,"warn",arguments)}function Tq(){return Nq(this.context.dataflow,"info",arguments)}function Pq(){return Nq(this.context.dataflow,"debug",arguments)}function Lq(t){const e=t/255;if(e<=.03928){return e/12.92}return Math.pow((e+.055)/1.055,2.4)}function Iq(t){const e=tt(t),n=Lq(e.r),i=Lq(e.g),r=Lq(e.b);return.2126*n+.7152*i+.0722*r}function Rq(t,e){const n=Iq(t),i=Iq(e),r=Math.max(n,i),u=Math.min(n,i);return(r+.05)/(u+.05)}function qq(){const t=[].slice.call(arguments);t.unshift({});return tn(...t)}function Uq(t,e){return t===e||t!==t&&e!==e?true:ve(t)?ve(e)&&t.length===e.length?Wq(t,e):false:ye(t)&&ye(e)?Gq(t,e):false}function Wq(t,e){for(let n=0,i=t.length;n<i;++n){if(!Uq(t[n],e[n]))return false}return true}function Gq(t,e){for(const n in t){if(!Uq(t[n],e[n]))return false}return true}function Hq(t){return e=>Gq(t,e)}function Vq(t,e,n,i,r,u){const o=this.context.dataflow,s=this.context.data[t],a=s.input,f=o.stamp();let c=s.changes,l,d;if(o._trigger===false||!(a.value.length||e||i)){return 0}if(!c||c.stamp<f){s.changes=c=o.changeset();c.stamp=f;o.runAfter((()=>{s.modified=true;o.pulse(a,c).run()}),true,1)}if(n){l=n===true?fe:ve(n)||Na(n)?n:Hq(n);c.remove(l)}if(e){c.insert(e)}if(i){l=Hq(i);if(a.value.some(l)){c.remove(l)}else{c.insert(i)}}if(r){for(d in u){c.modify(r,d,u[d])}}return 1}function Yq(t){const e=t.touches,n=e[0].clientX-e[1].clientX,i=e[0].clientY-e[1].clientY;return Math.hypot(n,i)}function Xq(t){const e=t.touches;return Math.atan2(e[0].clientY-e[1].clientY,e[0].clientX-e[1].clientX)}const Jq={};function Qq(t,e){const n=Jq[e]||(Jq[e]=re(e));return ve(t)?t.map(n):n(t)}function Zq(t){return ve(t)||ArrayBuffer.isView(t)?t:null}function Kq(t){return Zq(t)||(gn(t)?t:null)}function tU(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++){n[i-1]=arguments[i]}return Zq(t).join(...n)}function eU(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++){n[i-1]=arguments[i]}return Kq(t).indexOf(...n)}function nU(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++){n[i-1]=arguments[i]}return Kq(t).lastIndexOf(...n)}function iU(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++){n[i-1]=arguments[i]}return Kq(t).slice(...n)}function rU(t,e,n){if(Ge(n))ne("Function argument passed to replace.");return String(t).replace(e,n)}function uU(t){return Zq(t).slice().reverse()}function oU(t,e,n){return tg(t||0,e||0,n||0)}function sU(t,e){const n=$q(t,(e||this).context);return n&&n.bandwidth?n.bandwidth():0}function aU(t,e){const n=$q(t,(e||this).context);return n?n.copy():undefined}function fU(t,e){const n=$q(t,(e||this).context);return n?n.domain():[]}function cU(t,e,n){const i=$q(t,(n||this).context);return!i?undefined:ve(e)?(i.invertRange||i.invert)(e):(i.invert||i.invertExtent)(e)}function lU(t,e){const n=$q(t,(e||this).context);return n&&n.range?n.range():[]}function dU(t,e,n){const i=$q(t,(n||this).context);return i?i(e):undefined}function hU(t,e,n,i,r){t=$q(t,(r||this).context);const u=Lb(e,n);let o=t.domain(),s=o[0],a=Fe(o),f=oe;if(!(a-s)){t=(t.interpolator?Tg("sequential")().interpolator(t.interpolator()):Tg("linear")().interpolate(t.interpolate()).range(t.range())).domain([s=0,a=1])}else{f=Qg(t,s,a)}if(t.ticks){o=t.ticks(+i||15);if(s!==o[0])o.unshift(s);if(a!==Fe(o))o.push(a)}o.forEach((e=>u.stop(f(e),t(e))));return u}function pU(t,e,n){const i=$q(t,(n||this).context);return function(t){return i?i.path.context(t)(e):""}}function mU(t){let e=null;return function(n){return n?sv(n,e=e||Vb(t)):t}}const gU=t=>t.data;function bU(t,e){const n=rq.call(e,t);return n.root&&n.root.lookup||{}}function vU(t,e,n){const i=bU(t,this),r=i[e],u=i[n];return r&&u?r.path(u).map(gU):undefined}function yU(t,e){const n=bU(t,this)[e];return n?n.ancestors().map(gU):undefined}const wU=()=>typeof window!=="undefined"&&window||null;function AU(){const t=wU();return t?t.screen:{}}function xU(){const t=wU();return t?[t.innerWidth,t.innerHeight]:[undefined,undefined]}function OU(){const t=this.context.dataflow,e=t.container&&t.container();return e?[e.clientWidth,e.clientHeight]:[undefined,undefined]}function FU(t,e,n){if(!t)return[];const[i,r]=t,u=(new ay).set(i[0],i[1],r[0],r[1]),o=n||this.context.dataflow.scenegraph().root;return HO(o,u,DU(e))}function DU(t){let e=null;if(t){const n=Ue(t.marktype),i=Ue(t.markname);e=t=>(!n.length||n.some((e=>t.marktype===e)))&&(!i.length||i.some((e=>t.name===e)))}return e}function kU(t,e,n){let i=arguments.length>3&&arguments[3]!==undefined?arguments[3]:5;t=Ue(t);const r=t[t.length-1];return r===undefined||Math.hypot(r[0]-e,r[1]-n)>i?[...t,[e,n]]:t}function EU(t){return Ue(t).reduce(((e,n,i)=>{let[r,u]=n;return e+=i==0?`M ${r},${u} `:i===t.length-1?" Z":`L ${r},${u} `}),"")}function $U(t,e,n){const{x:i,y:r,mark:u}=n;const o=(new ay).set(Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER);for(const[a,f]of e){if(a<o.x1)o.x1=a;if(a>o.x2)o.x2=a;if(f<o.y1)o.y1=f;if(f>o.y2)o.y2=f}o.translate(i,r);const s=FU([[o.x1,o.y1],[o.x2,o.y2]],t,u);return s.filter((t=>jU(t.x,t.y,e)))}function jU(t,e,n){let i=0;for(let r=0,u=n.length-1;r<n.length;u=r++){const[o,s]=n[u];const[a,f]=n[r];if(f>e!=s>e&&t<(o-a)*(e-f)/(s-f)+a){i++}}return i&1}const CU={random(){return sc()},cumulativeNormal:yc,cumulativeLogNormal:kc,cumulativeUniform:Bc,densityNormal:vc,densityLogNormal:Dc,densityUniform:Mc,quantileNormal:wc,quantileLogNormal:Ec,quantileUniform:Sc,sampleNormal:bc,sampleLogNormal:Fc,sampleUniform:Cc,isArray:ve,isBoolean:ln,isDate:dn,isDefined(t){return t!==undefined},isNumber:pn,isObject:ye,isRegExp:mn,isString:gn,isTuple:Na,isValid(t){return t!=null&&t===t},toBoolean:kn,toDate(t){return $n(t)},toNumber:De,toString:jn,indexof:eU,join:tU,lastindexof:nU,replace:rU,reverse:uU,slice:iU,flush:an,lerp:vn,merge:qq,pad:On,peek:Fe,pluck:Qq,span:Fn,inrange:cn,truncate:Mn,rgb:tt,lab:sp,hcl:pp,hsl:R,luminance:Iq,contrast:Rq,sequence:Li,format:fq,utcFormat:lq,utcParse:hq,utcOffset:Pu,utcSequence:Ru,timeFormat:cq,timeParse:dq,timeOffset:Tu,timeSequence:Iu,timeUnitSpecifier:au,monthFormat:gq,monthAbbrevFormat:bq,dayFormat:vq,dayAbbrevFormat:yq,quarter:Re,utcquarter:qe,week:du,utcweek:vu,dayofyear:lu,utcdayofyear:bu,warn:zq,info:Tq,debug:Pq,extent(t){return en(t)},inScope:_q,intersect:FU,clampRange:We,pinchDistance:Yq,pinchAngle:Xq,screen:AU,containerSize:OU,windowSize:xU,bandspace:oU,setdata:oq,pathShape:mU,panLinear:Be,panLog:Se,panPow:_e,panSymlog:Ne,zoomLinear:Te,zoomLog:Pe,zoomPow:Le,zoomSymlog:Ie,encode:sq,modify:Vq,lassoAppend:kU,lassoPath:EU,intersectLasso:$U};const MU=["view","item","group","xy","x","y"],BU="event.vega.",SU="this.",_U={};const NU={forbidden:["_"],allowed:["datum","event","item"],fieldvar:"datum",globalvar:t=>`_[${Dn(Oq+t)}]`,functions:TU,constants:cL,visitors:_U};const zU=hL(NU);function TU(t){const e=lL(t);MU.forEach((t=>e[t]=BU+t));for(const n in CU){e[n]=SU+n}tn(e,jq(t,CU,_U));return e}function PU(t,e,n){if(arguments.length===1){return CU[t]}CU[t]=e;if(n)_U[t]=n;if(zU)zU.functions[t]=SU+t;return this}PU("bandwidth",sU,kq);PU("copy",aU,kq);PU("domain",fU,kq);PU("range",lU,kq);PU("invert",cU,kq);PU("scale",dU,kq);PU("gradient",hU,kq);PU("geoArea",Mq,kq);PU("geoBounds",Bq,kq);PU("geoCentroid",Sq,kq);PU("geoShape",pU,kq);PU("indata",uq,Dq);PU("data",rq,Fq);PU("treePath",vU,Fq);PU("treeAncestors",yU,Fq);PU("vlSelectionTest",VR,iq);PU("vlSelectionIdTest",QR,iq);PU("vlSelectionResolve",KR,iq);PU("vlSelectionTuples",ZR);function LU(t,e){const n={};let i;try{t=gn(t)?t:Dn(t)+"";i=fL(t)}catch(u){ne("Expression parse error: "+t)}i.visit((t=>{if(t.type!==fT)return;const i=t.callee.name,r=NU.visitors[i];if(r)r(i,t.arguments,e,n)}));const r=zU(i);r.globals.forEach((t=>{const i=Oq+t;if(!un(n,i)&&e.getSignal(t)){n[i]=e.signalRef(t)}}));return{$expr:tn({code:r.code},e.options.ast?{ast:i}:null),$fields:r.fields,$params:n}}function IU(t){const e=this,n=t.operators||[];if(t.background){e.background=t.background}if(t.eventConfig){e.eventConfig=t.eventConfig}if(t.locale){e.locale=t.locale}n.forEach((t=>e.parseOperator(t)));n.forEach((t=>e.parseOperatorParameters(t)));(t.streams||[]).forEach((t=>e.parseStream(t)));(t.updates||[]).forEach((t=>e.parseUpdate(t)));return e.resolve()}const RU=Cn(["rule"]),qU=Cn(["group","image","rect"]);function UU(t,e){let n="";if(RU[e])return n;if(t.x2){if(t.x){if(qU[e]){n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"}n+="o.width=o.x2-o.x;"}else{n+="o.x=o.x2-(o.width||0);"}}if(t.xc){n+="o.x=o.xc-(o.width||0)/2;"}if(t.y2){if(t.y){if(qU[e]){n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"}n+="o.height=o.y2-o.y;"}else{n+="o.y=o.y2-(o.height||0);"}}if(t.yc){n+="o.y=o.yc-(o.height||0)/2;"}return n}function WU(t){return(t+"").toLowerCase()}function GU(t){return WU(t)==="operator"}function HU(t){return WU(t)==="collect"}function VU(t,e,n){if(!n.endsWith(";")){n="return("+n+");"}const i=Function(...e.concat(n));return t&&t.functions?i.bind(t.functions):i}function YU(t,e,n,i){return`((u = ${t}) < (v = ${e}) || u == null) && v != null ? ${n}\n  : (u > v || v == null) && u != null ? ${i}\n  : ((v = v instanceof Date ? +v : v), (u = u instanceof Date ? +u : u)) !== u && v === v ? ${n}\n  : v !== v && u === u ? ${i} : `}var XU={operator:(t,e)=>VU(t,["_"],e.code),parameter:(t,e)=>VU(t,["datum","_"],e.code),event:(t,e)=>VU(t,["event"],e.code),handler:(t,e)=>{const n=`var datum=event.item&&event.item.datum;return ${e.code};`;return VU(t,["_","event"],n)},encode:(t,e)=>{const{marktype:n,channels:i}=e;let r="var o=item,datum=o.datum,m=0,$;";for(const u in i){const t="o["+Dn(u)+"]";r+=`$=${i[u].code};if(${t}!==$)${t}=$,m=1;`}r+=UU(i,n);r+="return m;";return VU(t,["item","_"],r)},codegen:{get(t){const e=`[${t.map(Dn).join("][")}]`;const n=Function("_",`return _${e};`);n.path=e;return n},comparator(t,e){let n;const i=(t,i)=>{const r=e[i];let u,o;if(t.path){u=`a${t.path}`;o=`b${t.path}`}else{(n=n||{})["f"+i]=t;u=`this.f${i}(a)`;o=`this.f${i}(b)`}return YU(u,o,-r,r)};const r=Function("a","b","var u, v; return "+t.map(i).join("")+"0;");return n?r.bind(n):r}}};function JU(t){const e=this;if(GU(t.type)||!t.type){e.operator(t,t.update?e.operatorExpression(t.update):null)}else{e.transform(t,t.type)}}function QU(t){const e=this;if(t.params){const n=e.get(t.id);if(!n)ne("Invalid operator id: "+t.id);e.dataflow.connect(n,n.parameters(e.parseParameters(t.params),t.react,t.initonly))}}function ZU(t,e){e=e||{};const n=this;for(const i in t){const r=t[i];e[i]=ve(r)?r.map((t=>KU(t,n,e))):KU(r,n,e)}return e}function KU(t,e,n){if(!t||!ye(t))return t;for(let i=0,r=tW.length,u;i<r;++i){u=tW[i];if(un(t,u.key)){return u.parse(t,e,n)}}return t}var tW=[{key:"$ref",parse:eW},{key:"$key",parse:iW},{key:"$expr",parse:nW},{key:"$field",parse:rW},{key:"$encode",parse:oW},{key:"$compare",parse:uW},{key:"$context",parse:sW},{key:"$subflow",parse:aW},{key:"$tupleid",parse:fW}];function eW(t,e){return e.get(t.$ref)||ne("Operator not defined: "+t.$ref)}function nW(t,e,n){if(t.$params){e.parseParameters(t.$params,n)}const i="e:"+t.$expr.code;return e.fn[i]||(e.fn[i]=Jt(e.parameterExpression(t.$expr),t.$fields))}function iW(t,e){const n="k:"+t.$key+"_"+!!t.$flat;return e.fn[n]||(e.fn[n]=bn(t.$key,t.$flat,e.expr.codegen))}function rW(t,e){if(!t.$field)return null;const n="f:"+t.$field+"_"+t.$name;return e.fn[n]||(e.fn[n]=re(t.$field,t.$name,e.expr.codegen))}function uW(t,e){const n="c:"+t.$compare+"_"+t.$order,i=Ue(t.$compare).map((t=>t&&t.$tupleid?za:t));return e.fn[n]||(e.fn[n]=Ve(i,t.$order,e.expr.codegen))}function oW(t,e){const n=t.$encode,i={};for(const r in n){const t=n[r];i[r]=Jt(e.encodeExpression(t.$expr),t.$fields);i[r].output=t.$output}return i}function sW(t,e){return e}function aW(t,e){const n=t.$subflow;return function(t,i,r){const u=e.fork().parse(n),o=u.get(n.operators[0].id),s=u.signals.parent;if(s)s.set(r);o.detachSubflow=()=>e.detach(u);return o}}function fW(){return za}function cW(t){var e=this,n=t.filter!=null?e.eventExpression(t.filter):undefined,i=t.stream!=null?e.get(t.stream):undefined,r;if(t.source){i=e.events(t.source,t.type,n)}else if(t.merge){r=t.merge.map((t=>e.get(t)));i=r[0].merge.apply(r[0],r.slice(1))}if(t.between){r=t.between.map((t=>e.get(t)));i=i.between(r[0],r[1])}if(t.filter){i=i.filter(n)}if(t.throttle!=null){i=i.throttle(+t.throttle)}if(t.debounce!=null){i=i.debounce(+t.debounce)}if(i==null){ne("Invalid stream definition: "+JSON.stringify(t))}if(t.consume)i.consume(true);e.stream(t,i)}function lW(t){var e=this,n=ye(n=t.source)?n.$ref:n,i=e.get(n),r=null,u=t.update,o=undefined;if(!i)ne("Source not defined: "+t.source);r=t.target&&t.target.$expr?e.eventExpression(t.target.$expr):e.get(t.target);if(u&&u.$expr){if(u.$params){o=e.parseParameters(u.$params)}u=e.handlerExpression(u.$expr)}e.update(t,i,r,u,o)}const dW={skip:true};function hW(t){var e=this,n={};if(t.signals){var i=n.signals={};Object.keys(e.signals).forEach((n=>{const r=e.signals[n];if(t.signals(n,r)){i[n]=r.value}}))}if(t.data){var r=n.data={};Object.keys(e.data).forEach((n=>{const i=e.data[n];if(t.data(n,i)){r[n]=i.input.value}}))}if(e.subcontext&&t.recurse!==false){n.subcontext=e.subcontext.map((e=>e.getState(t)))}return n}function pW(t){var e=this,n=e.dataflow,i=t.data,r=t.signals;Object.keys(r||{}).forEach((t=>{n.update(e.signals[t],r[t],dW)}));Object.keys(i||{}).forEach((t=>{n.pulse(e.data[t].input,n.changeset().remove(fe).insert(i[t]))}));(t.subcontext||[]).forEach(((t,n)=>{const i=e.subcontext[n];if(i)i.setState(t)}))}function mW(t,e,n,i){return new gW(t,e,n,i)}function gW(t,e,n,i){this.dataflow=t;this.transforms=e;this.events=t.events.bind(t);this.expr=i||XU,this.signals={};this.scales={};this.nodes={};this.data={};this.fn={};if(n){this.functions=Object.create(n);this.functions.context=this}}function bW(t){this.dataflow=t.dataflow;this.transforms=t.transforms;this.events=t.events;this.expr=t.expr;this.signals=Object.create(t.signals);this.scales=Object.create(t.scales);this.nodes=Object.create(t.nodes);this.data=Object.create(t.data);this.fn=Object.create(t.fn);if(t.functions){this.functions=Object.create(t.functions);this.functions.context=this}}gW.prototype=bW.prototype={fork(){const t=new bW(this);(this.subcontext||(this.subcontext=[])).push(t);return t},detach(t){this.subcontext=this.subcontext.filter((e=>e!==t));const e=Object.keys(t.nodes);for(const n of e)t.nodes[n]._targets=null;for(const n of e)t.nodes[n].detach();t.nodes=null},get(t){return this.nodes[t]},set(t,e){return this.nodes[t]=e},add(t,e){const n=this,i=n.dataflow,r=t.value;n.set(t.id,e);if(HU(t.type)&&r){if(r.$ingest){i.ingest(e,r.$ingest,r.$format)}else if(r.$request){i.preload(e,r.$request,r.$format)}else{i.pulse(e,i.changeset().insert(r))}}if(t.root){n.root=e}if(t.parent){let r=n.get(t.parent.$ref);if(r){i.connect(r,[e]);e.targets().add(r)}else{(n.unresolved=n.unresolved||[]).push((()=>{r=n.get(t.parent.$ref);i.connect(r,[e]);e.targets().add(r)}))}}if(t.signal){n.signals[t.signal]=e}if(t.scale){n.scales[t.scale]=e}if(t.data){for(const i in t.data){const r=n.data[i]||(n.data[i]={});t.data[i].forEach((t=>r[t]=e))}}},resolve(){(this.unresolved||[]).forEach((t=>t()));delete this.unresolved;return this},operator(t,e){this.add(t,this.dataflow.add(t.value,e))},transform(t,e){this.add(t,this.dataflow.add(this.transforms[WU(e)]))},stream(t,e){this.set(t.id,e)},update(t,e,n,i,r){this.dataflow.on(e,n,i,r,t.options)},operatorExpression(t){return this.expr.operator(this,t)},parameterExpression(t){return this.expr.parameter(this,t)},eventExpression(t){return this.expr.event(this,t)},handlerExpression(t){return this.expr.handler(this,t)},encodeExpression(t){return this.expr.encode(this,t)},parse:IU,parseOperator:JU,parseOperatorParameters:QU,parseParameters:ZU,parseStream:cW,parseUpdate:lW,getState:hW,setState:pW};function vW(t){const e=t.container();if(e){e.setAttribute("role","graphics-document");e.setAttribute("aria-roleDescription","visualization");yW(e,t.description())}}function yW(t,e){if(t)e==null?t.removeAttribute("aria-label"):t.setAttribute("aria-label",e)}function wW(t){t.add(null,(e=>{t._background=e.bg;t._resize=1;return e.bg}),{bg:t._signals.background})}const AW="default";function xW(t){const e=t._signals.cursor||(t._signals.cursor=t.add({user:AW,item:null}));t.on(t.events("view","mousemove"),e,((t,n)=>{const i=e.value,r=i?gn(i)?i:i.user:AW,u=n.item&&n.item.cursor||null;return i&&r===i.user&&u==i.item?i:{user:r,item:u}}));t.add(null,(function(e){let n=e.cursor,i=this.value;if(!gn(n)){i=n.item;n=n.user}OW(t,n&&n!==AW?n:i||n);return i}),{cursor:e})}function OW(t,e){const n=t.globalCursor()?typeof document!=="undefined"&&document.body:t.container();if(n){return e==null?n.style.removeProperty("cursor"):n.style.cursor=e}}function FW(t,e){var n=t._runtime.data;if(!un(n,e)){ne("Unrecognized data set: "+e)}return n[e]}function DW(t,e){return arguments.length<2?FW(this,t).values.value:kW.call(this,t,Wa().remove(fe).insert(e))}function kW(t,e){if(!Ua(e)){ne("Second argument to changes must be a changeset.")}const n=FW(this,t);n.modified=true;return this.pulse(n.input,e)}function EW(t,e){return kW.call(this,t,Wa().insert(e))}function $W(t,e){return kW.call(this,t,Wa().remove(e))}function jW(t){var e=t.padding();return Math.max(0,t._viewWidth+e.left+e.right)}function CW(t){var e=t.padding();return Math.max(0,t._viewHeight+e.top+e.bottom)}function MW(t){var e=t.padding(),n=t._origin;return[e.left+n[0],e.top+n[1]]}function BW(t){var e=MW(t),n=jW(t),i=CW(t);t._renderer.background(t.background());t._renderer.resize(n,i,e);t._handler.origin(e);t._resizeListeners.forEach((e=>{try{e(n,i)}catch(ne){t.error(ne)}}))}function SW(t,e,n){var i=t._renderer,r=i&&i.canvas(),u,o,s;if(r){s=MW(t);o=e.changedTouches?e.changedTouches[0]:e;u=ex(o,r);u[0]-=s[0];u[1]-=s[1]}e.dataflow=t;e.item=n;e.vega=_W(t,n,u);return e}function _W(t,e,n){const i=e?e.mark.marktype==="group"?e:e.mark.group:null;function r(t){var n=i,r;if(t)for(r=e;r;r=r.mark.group){if(r.mark.name===t){n=r;break}}return n&&n.mark&&n.mark.interactive?n:{}}function u(t){if(!t)return n;if(gn(t))t=r(t);const e=n.slice();while(t){e[0]-=t.x||0;e[1]-=t.y||0;t=t.mark&&t.mark.group}return e}return{view:Ze(t),item:Ze(e||{}),group:r,xy:u,x:t=>u(t)[0],y:t=>u(t)[1]}}const NW="view",zW="timer",TW="window",PW={trap:false};function LW(t){const e=tn({defaults:{}},t);const n=(t,e)=>{e.forEach((e=>{if(ve(t[e]))t[e]=Cn(t[e])}))};n(e.defaults,["prevent","allow"]);n(e,["view","window","selector"]);return e}function IW(t,e,n,i){t._eventListeners.push({type:n,sources:Ue(e),handler:i})}function RW(t,e){var n=t._eventConfig.defaults,i=n.prevent,r=n.allow;return i===false||r===true?false:i===true||r===false?true:i?i[e]:r?!r[e]:t.preventDefault()}function qW(t,e,n){const i=t._eventConfig&&t._eventConfig[e];if(i===false||ye(i)&&!i[n]){t.warn(`Blocked ${e} ${n} event listener.`);return false}return true}function UW(t,e,n){var i=this,r=new rf(n),u=function(n,u){i.runAsync(null,(()=>{if(t===NW&&RW(i,e)){n.preventDefault()}r.receive(SW(i,n,u))}))},o;if(t===zW){if(qW(i,"timer",e)){i.timer(u,e)}}else if(t===NW){if(qW(i,"view",e)){i.addEventListener(e,u,PW)}}else{if(t===TW){if(qW(i,"window",e)&&typeof window!=="undefined"){o=[window]}}else if(typeof document!=="undefined"){if(qW(i,"selector",e)){o=Array.from(document.querySelectorAll(t))}}if(!o){i.warn("Can not resolve event source: "+t)}else{for(var s=0,a=o.length;s<a;++s){o[s].addEventListener(e,u)}IW(i,o,e,u)}}return r}function WW(t){return t.item}function GW(t){return t.item.mark.source}function HW(t){return function(e,n){return n.vega.view().changeset().encode(n.item,t)}}function VW(t,e){t=[t||"hover"];e=[e||"update",t[0]];this.on(this.events("view","mouseover",WW),GW,HW(t));this.on(this.events("view","mouseout",WW),GW,HW(e));return this}function YW(){var t=this._tooltip,e=this._timers,n=this._eventListeners,i,r,u;i=e.length;while(--i>=0){e[i].stop()}i=n.length;while(--i>=0){u=n[i];r=u.sources.length;while(--r>=0){u.sources[r].removeEventListener(u.type,u.handler)}}if(t){t.call(this,this._handler,null,null,null)}return this}function XW(t,e,n){const i=document.createElement(t);for(const r in e)i.setAttribute(r,e[r]);if(n!=null)i.textContent=n;return i}const JW="vega-bind",QW="vega-bind-name",ZW="vega-bind-radio";function KW(t,e,n){if(!e)return;const i=n.param;let r=n.state;if(!r){r=n.state={elements:null,active:false,set:null,update:e=>{if(e!=t.signal(i.signal)){t.runAsync(null,(()=>{r.source=true;t.signal(i.signal,e)}))}}};if(i.debounce){r.update=Ke(i.debounce,r.update)}}const u=i.input==null&&i.element?tG:nG;u(r,e,i,t);if(!r.active){t.on(t._signals[i.signal],null,(()=>{r.source?r.source=false:r.set(t.signal(i.signal))}));r.active=true}return r}function tG(t,e,n,i){const r=n.event||"input";const u=()=>t.update(e.value);i.signal(n.signal,e.value);e.addEventListener(r,u);IW(i,e,r,u);t.set=t=>{e.value=t;e.dispatchEvent(eG(r))}}function eG(t){return typeof Event!=="undefined"?new Event(t):{type:t}}function nG(t,e,n,i){const r=i.signal(n.signal);const u=XW("div",{class:JW});const o=n.input==="radio"?u:u.appendChild(XW("label"));o.appendChild(XW("span",{class:QW},n.name||n.signal));e.appendChild(u);let s=iG;switch(n.input){case"checkbox":s=rG;break;case"select":s=uG;break;case"radio":s=oG;break;case"range":s=sG;break}s(t,o,n,r)}function iG(t,e,n,i){const r=XW("input");for(const u in n){if(u!=="signal"&&u!=="element"){r.setAttribute(u==="input"?"type":u,n[u])}}r.setAttribute("name",n.signal);r.value=i;e.appendChild(r);r.addEventListener("input",(()=>t.update(r.value)));t.elements=[r];t.set=t=>r.value=t}function rG(t,e,n,i){const r={type:"checkbox",name:n.signal};if(i)r.checked=true;const u=XW("input",r);e.appendChild(u);u.addEventListener("change",(()=>t.update(u.checked)));t.elements=[u];t.set=t=>u.checked=!!t||null}function uG(t,e,n,i){const r=XW("select",{name:n.signal}),u=n.labels||[];n.options.forEach(((t,e)=>{const n={value:t};if(aG(t,i))n.selected=true;r.appendChild(XW("option",n,(u[e]||t)+""))}));e.appendChild(r);r.addEventListener("change",(()=>{t.update(n.options[r.selectedIndex])}));t.elements=[r];t.set=t=>{for(let e=0,i=n.options.length;e<i;++e){if(aG(n.options[e],t)){r.selectedIndex=e;return}}}}function oG(t,e,n,i){const r=XW("span",{class:ZW}),u=n.labels||[];e.appendChild(r);t.elements=n.options.map(((e,o)=>{const s={type:"radio",name:n.signal,value:e};if(aG(e,i))s.checked=true;const a=XW("input",s);a.addEventListener("change",(()=>t.update(e)));const f=XW("label",{},(u[o]||e)+"");f.prepend(a);r.appendChild(f);return a}));t.set=e=>{const n=t.elements,i=n.length;for(let t=0;t<i;++t){if(aG(n[t].value,e))n[t].checked=true}}}function sG(t,e,n,i){i=i!==undefined?i:(+n.max+ +n.min)/2;const r=n.max!=null?n.max:Math.max(100,+i)||100,u=n.min||Math.min(0,r,+i)||0,o=n.step||$i(u,r,100);const s=XW("input",{type:"range",name:n.signal,min:u,max:r,step:o});s.value=i;const a=XW("span",{},+i);e.appendChild(s);e.appendChild(a);const f=()=>{a.textContent=s.value;t.update(+s.value)};s.addEventListener("input",f);s.addEventListener("change",f);t.elements=[s];t.set=t=>{s.value=t;a.textContent=t}}function aG(t,e){return t===e||t+""===e+""}function fG(t,e,n,i,r,u){e=e||new i(t.loader());return e.initialize(n,jW(t),CW(t),MW(t),r,u).background(t.background())}function cG(t,e){return!e?null:function(){try{e.apply(this,arguments)}catch(ne){t.error(ne)}}}function lG(t,e,n,i){const r=new i(t.loader(),cG(t,t.tooltip())).scene(t.scenegraph().root).initialize(n,MW(t),t);if(e){e.handlers().forEach((t=>{r.on(t.type,t.handler)}))}return r}function dG(t,e){const n=this,i=n._renderType,r=n._eventConfig.bind,u=GO(i);t=n._el=t?hG(n,t,true):null;vW(n);if(!u)n.error("Unrecognized renderer type: "+i);const o=u.handler||$x,s=t?u.renderer:u.headless;n._renderer=!s?null:fG(n,n._renderer,t,s);n._handler=lG(n,n._handler,t,o);n._redraw=true;if(t&&r!=="none"){e=e?n._elBind=hG(n,e,true):t.appendChild(XW("form",{class:"vega-bindings"}));n._bind.forEach((t=>{if(t.param.element&&r!=="container"){t.element=hG(n,t.param.element,!!t.param.input)}}));n._bind.forEach((t=>{KW(n,t.element||e,t)}))}return n}function hG(t,e,n){if(typeof e==="string"){if(typeof document!=="undefined"){e=document.querySelector(e);if(!e){t.error("Signal bind element not found: "+e);return null}}else{t.error("DOM document instance not found.");return null}}if(e&&n){try{e.textContent=""}catch(mat){e=null;t.error(mat)}}return e}const pG=t=>+t||0;const mG=t=>({top:t,bottom:t,left:t,right:t});function gG(t){return ye(t)?{top:pG(t.top),bottom:pG(t.bottom),left:pG(t.left),right:pG(t.right)}:mG(pG(t))}async function bG(t,e,n,i){const r=GO(e),u=r&&r.headless;if(!u)ne("Unrecognized renderer type: "+e);await t.runAsync();return fG(t,null,null,u,n,i).renderAsync(t._scenegraph.root)}async function vG(t,e){if(t!==UO.Canvas&&t!==UO.SVG&&t!==UO.PNG){ne("Unrecognized image type: "+t)}const n=await bG(this,t,e);return t===UO.SVG?yG(n.svg(),"image/svg+xml"):n.canvas().toDataURL("image/png")}function yG(t,e){const n=new Blob([t],{type:e});return window.URL.createObjectURL(n)}async function wG(t,e){const n=await bG(this,UO.Canvas,t,e);return n.canvas()}async function AG(t){const e=await bG(this,UO.SVG,t);return e.svg()}function xG(t,e,n){return mW(t,Kf,CU,n).parse(e)}function OG(t){var e=this._runtime.scales;if(!un(e,t)){ne("Unrecognized scale or projection: "+t)}return e[t].value}var FG="width",DG="height",kG="padding",EG={skip:true};function $G(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===kG?i.left+i.right:0)}function jG(t,e){var n=t.autosize(),i=t.padding();return e-(n&&n.contains===kG?i.top+i.bottom:0)}function CG(t){var e=t._signals,n=e[FG],i=e[DG],r=e[kG];function u(){t._autosize=t._resize=1}t._resizeWidth=t.add(null,(e=>{t._width=e.size;t._viewWidth=$G(t,e.size);u()}),{size:n});t._resizeHeight=t.add(null,(e=>{t._height=e.size;t._viewHeight=jG(t,e.size);u()}),{size:i});const o=t.add(null,u,{pad:r});t._resizeWidth.rank=n.rank+1;t._resizeHeight.rank=i.rank+1;o.rank=r.rank+1}function MG(t,e,n,i,r,u){this.runAfter((o=>{let s=0;o._autosize=0;if(o.width()!==n){s=1;o.signal(FG,n,EG);o._resizeWidth.skip(true)}if(o.height()!==i){s=1;o.signal(DG,i,EG);o._resizeHeight.skip(true)}if(o._viewWidth!==t){o._resize=1;o._viewWidth=t}if(o._viewHeight!==e){o._resize=1;o._viewHeight=e}if(o._origin[0]!==r[0]||o._origin[1]!==r[1]){o._resize=1;o._origin=r}if(s)o.run("enter");if(u)o.runAfter((t=>t.resize()))}),false,1)}function BG(t){return this._runtime.getState(t||{data:SG,signals:_G,recurse:true})}function SG(t,e){return e.modified&&ve(e.input.value)&&t.indexOf("_:vega:_")}function _G(t,e){return!(t==="parent"||e instanceof Kf.proxy)}function NG(t){this.runAsync(null,(e=>{e._trigger=false;e._runtime.setState(t)}),(t=>{t._trigger=true}));return this}function zG(t,e){function n(e){t({timestamp:Date.now(),elapsed:e})}this._timers.push($B(n,e))}function TG(t,e,n,i){const r=t.element();if(r)r.setAttribute("title",PG(i))}function PG(t){return t==null?"":ve(t)?IG(t):ye(t)&&!dn(t)?LG(t):t+""}function LG(t){return Object.keys(t).map((e=>{const n=t[e];return e+": "+(ve(n)?IG(n):RG(n))})).join("\n")}function IG(t){return"["+t.map(RG).join(", ")+"]"}function RG(t){return ve(t)?"[…]":ye(t)&&!dn(t)?"{…}":t}function qG(t,e){const n=this;e=e||{};Jf.call(n);if(e.loader)n.loader(e.loader);if(e.logger)n.logger(e.logger);if(e.logLevel!=null)n.logLevel(e.logLevel);if(e.locale||t.locale){const i=tn({},t.locale,e.locale);n.locale(Ys(i.number,i.time))}n._el=null;n._elBind=null;n._renderType=e.renderer||UO.Canvas;n._scenegraph=new YA;const i=n._scenegraph.root;n._renderer=null;n._tooltip=e.tooltip||TG,n._redraw=true;n._handler=(new $x).scene(i);n._globalCursor=false;n._preventDefault=false;n._timers=[];n._eventListeners=[];n._resizeListeners=[];n._eventConfig=LW(t.eventConfig);n.globalCursor(n._eventConfig.globalCursor);const r=xG(n,t,e.expr);n._runtime=r;n._signals=r.signals;n._bind=(t.bindings||[]).map((t=>({state:null,param:tn({},t)})));if(r.root)r.root.set(i);i.source=r.data.root.input;n.pulse(r.data.root.input,n.changeset().insert(i.items));n._width=n.width();n._height=n.height();n._viewWidth=$G(n,n._width);n._viewHeight=jG(n,n._height);n._origin=[0,0];n._resize=0;n._autosize=1;CG(n);wW(n);xW(n);n.description(t.description);if(e.hover)n.hover();if(e.container)n.initialize(e.container,e.bind)}function UG(t,e){return un(t._signals,e)?t._signals[e]:ne("Unrecognized signal name: "+Dn(e))}function WG(t,e){const n=(t._targets||[]).filter((t=>t._update&&t._update.handler===e));return n.length?n[0]:null}function GG(t,e,n,i){let r=WG(n,i);if(!r){r=cG(t,(()=>i(e,n.value)));r.handler=i;t.on(n,null,r)}return t}function HG(t,e,n){const i=WG(e,n);if(i)e._targets.remove(i);return t}fn(qG,Jf,{async evaluate(t,e,n){await Jf.prototype.evaluate.call(this,t,e);if(this._redraw||this._resize){try{if(this._renderer){if(this._resize){this._resize=0;BW(this)}await this._renderer.renderAsync(this._scenegraph.root)}this._redraw=false}catch(mat){this.error(mat)}}if(n)Ba(this,n);return this},dirty(t){this._redraw=true;this._renderer&&this._renderer.dirty(t)},description(t){if(arguments.length){const e=t!=null?t+"":null;if(e!==this._desc)yW(this._el,this._desc=e);return this}return this._desc},container(){return this._el},scenegraph(){return this._scenegraph},origin(){return this._origin.slice()},signal(t,e,n){const i=UG(this,t);return arguments.length===1?i.value:this.update(i,e,n)},width(t){return arguments.length?this.signal("width",t):this.signal("width")},height(t){return arguments.length?this.signal("height",t):this.signal("height")},padding(t){return arguments.length?this.signal("padding",gG(t)):gG(this.signal("padding"))},autosize(t){return arguments.length?this.signal("autosize",t):this.signal("autosize")},background(t){return arguments.length?this.signal("background",t):this.signal("background")},renderer(t){if(!arguments.length)return this._renderType;if(!GO(t))ne("Unrecognized renderer type: "+t);if(t!==this._renderType){this._renderType=t;this._resetRenderer()}return this},tooltip(t){if(!arguments.length)return this._tooltip;if(t!==this._tooltip){this._tooltip=t;this._resetRenderer()}return this},loader(t){if(!arguments.length)return this._loader;if(t!==this._loader){Jf.prototype.loader.call(this,t);this._resetRenderer()}return this},resize(){this._autosize=1;return this.touch(UG(this,"autosize"))},_resetRenderer(){if(this._renderer){this._renderer=null;this.initialize(this._el,this._elBind)}},_resizeView:MG,addEventListener(t,e,n){let i=e;if(!(n&&n.trap===false)){i=cG(this,e);i.raw=e}this._handler.on(t,i);return this},removeEventListener(t,e){var n=this._handler.handlers(t),i=n.length,r,u;while(--i>=0){u=n[i].type;r=n[i].handler;if(t===u&&(e===r||e===r.raw)){this._handler.off(u,r);break}}return this},addResizeListener(t){const e=this._resizeListeners;if(e.indexOf(t)<0){e.push(t)}return this},removeResizeListener(t){var e=this._resizeListeners,n=e.indexOf(t);if(n>=0){e.splice(n,1)}return this},addSignalListener(t,e){return GG(this,t,UG(this,t),e)},removeSignalListener(t,e){return HG(this,UG(this,t),e)},addDataListener(t,e){return GG(this,t,FW(this,t).values,e)},removeDataListener(t,e){return HG(this,FW(this,t).values,e)},globalCursor(t){if(arguments.length){if(this._globalCursor!==!!t){const e=OW(this,null);this._globalCursor=!!t;if(e)OW(this,e)}return this}else{return this._globalCursor}},preventDefault(t){if(arguments.length){this._preventDefault=t;return this}else{return this._preventDefault}},timer:zG,events:UW,finalize:YW,hover:VW,data:DW,change:kW,insert:EW,remove:$W,scale:OG,initialize:dG,toImageURL:vG,toCanvas:wG,toSVG:AG,getState:BG,setState:NG});const VG="view",YG="[",XG="]",JG="{",QG="}",ZG=":",KG=",",tH="@",eH=">",nH=/[[\]{}]/,iH={"*":1,arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};let rH,uH;function oH(t,e,n){rH=e||VG;uH=n||iH;return fH(t.trim()).map(cH)}function sH(t){return uH[t]}function aH(t,e,n,i,r){const u=t.length;let o=0,s;for(;e<u;++e){s=t[e];if(!o&&s===n)return e;else if(r&&r.indexOf(s)>=0)--o;else if(i&&i.indexOf(s)>=0)++o}return e}function fH(t){const e=[],n=t.length;let i=0,r=0;while(r<n){r=aH(t,r,KG,YG+JG,XG+QG);e.push(t.substring(i,r).trim());i=++r}if(e.length===0){throw"Empty event selector: "+t}return e}function cH(t){return t[0]==="["?lH(t):dH(t)}function lH(t){const e=t.length;let n=1,i;n=aH(t,n,XG,YG,XG);if(n===e){throw"Empty between selector: "+t}i=fH(t.substring(1,n));if(i.length!==2){throw"Between selector must have two elements: "+t}t=t.slice(n+1).trim();if(t[0]!==eH){throw"Expected '>' after between selector: "+t}i=i.map(cH);const r=cH(t.slice(1).trim());if(r.between){return{between:i,stream:r}}else{r.between=i}return r}function dH(t){const e={source:rH},n=[];let i=[0,0],r=0,u=0,o=t.length,s=0,a,f;if(t[o-1]===QG){s=t.lastIndexOf(JG);if(s>=0){try{i=hH(t.substring(s+1,o-1))}catch(mat){throw"Invalid throttle specification: "+t}t=t.slice(0,s).trim();o=t.length}else throw"Unmatched right brace: "+t;s=0}if(!o)throw t;if(t[0]===tH)r=++s;a=aH(t,s,ZG);if(a<o){n.push(t.substring(u,a).trim());u=s=++a}s=aH(t,s,YG);if(s===o){n.push(t.substring(u,o).trim())}else{n.push(t.substring(u,s).trim());f=[];u=++s;if(u===o)throw"Unmatched left bracket: "+t}while(s<o){s=aH(t,s,XG);if(s===o)throw"Unmatched left bracket: "+t;f.push(t.substring(u,s).trim());if(s<o-1&&t[++s]!==YG)throw"Expected left bracket: "+t;u=++s}if(!(o=n.length)||nH.test(n[o-1])){throw"Invalid event selector: "+t}if(o>1){e.type=n[1];if(r){e.markname=n[0].slice(1)}else if(sH(n[0])){e.marktype=n[0]}else{e.source=n[0]}}else{e.type=n[0]}if(e.type.slice(-1)==="!"){e.consume=true;e.type=e.type.slice(0,-1)}if(f!=null)e.filter=f;if(i[0])e.throttle=i[0];if(i[1])e.debounce=i[1];return e}function hH(t){const e=t.split(KG);if(!t.length||e.length>2)throw t;return e.map((e=>{const n=+e;if(n!==n)throw t;return n}))}function pH(t){return ye(t)?t:{type:t||"pad"}}const mH=t=>+t||0;const gH=t=>({top:t,bottom:t,left:t,right:t});function bH(t){return!ye(t)?gH(mH(t)):t.signal?t:{top:mH(t.top),bottom:mH(t.bottom),left:mH(t.left),right:mH(t.right)}}const vH=t=>ye(t)&&!ve(t)?tn({},t):{value:t};function yH(t,e,n,i){if(n!=null){const r=ye(n)&&!ve(n)||ve(n)&&n.length&&ye(n[0]);if(r){t.update[e]=n}else{t[i||"enter"][e]={value:n}}return 1}else{return 0}}function wH(t,e,n){for(const i in e){yH(t,i,e[i])}for(const i in n){yH(t,i,n[i],"update")}}function AH(t,e,n){for(const i in e){if(n&&un(n,i))continue;t[i]=tn(t[i]||{},e[i])}return t}function xH(t,e){return e&&(e.enter&&e.enter[t]||e.update&&e.update[t])}const OH="mark";const FH="frame";const DH="scope";const kH="axis";const EH="axis-domain";const $H="axis-grid";const jH="axis-label";const CH="axis-tick";const MH="axis-title";const BH="legend";const SH="legend-band";const _H="legend-entry";const NH="legend-gradient";const zH="legend-label";const TH="legend-symbol";const PH="legend-title";const LH="title";const IH="title-text";const RH="title-subtitle";function qH(t,e,n,i,r){const u={},o={};let s,a,f,c;a="lineBreak";if(e==="text"&&r[a]!=null&&!xH(a,t)){UH(u,a,r[a])}if(n=="legend"||String(n).startsWith("axis")){n=null}c=n===FH?r.group:n===OH?tn({},r.mark,r[e]):null;for(a in c){f=xH(a,t)||(a==="fill"||a==="stroke")&&(xH("fill",t)||xH("stroke",t));if(!f)UH(u,a,c[a])}Ue(i).forEach((e=>{const n=r.style&&r.style[e];for(const i in n){if(!xH(i,t)){UH(u,i,n[i])}}}));t=tn({},t);for(a in u){c=u[a];if(c.signal){(s=s||{})[a]=c}else{o[a]=c}}t.enter=tn(o,t.enter);if(s)t.update=tn(s,t.update);return t}function UH(t,e,n){t[e]=n&&n.signal?{signal:n.signal}:{value:n}}const WH=t=>gn(t)?Dn(t):t.signal?`(${t.signal})`:JH(t);function GH(t){if(t.gradient!=null){return YH(t)}let e=t.signal?`(${t.signal})`:t.color?VH(t.color):t.field!=null?JH(t.field):t.value!==undefined?Dn(t.value):undefined;if(t.scale!=null){e=ZH(t,e)}if(e===undefined){e=null}if(t.exponent!=null){e=`pow(${e},${XH(t.exponent)})`}if(t.mult!=null){e+=`*${XH(t.mult)}`}if(t.offset!=null){e+=`+${XH(t.offset)}`}if(t.round){e=`round(${e})`}return e}const HH=(t,e,n,i)=>`(${t}(${[e,n,i].map(GH).join(",")})+'')`;function VH(t){return t.c?HH("hcl",t.h,t.c,t.l):t.h||t.s?HH("hsl",t.h,t.s,t.l):t.l||t.a?HH("lab",t.l,t.a,t.b):t.r||t.g||t.b?HH("rgb",t.r,t.g,t.b):null}function YH(t){const e=[t.start,t.stop,t.count].map((t=>t==null?null:Dn(t)));while(e.length&&Fe(e)==null)e.pop();e.unshift(WH(t.gradient));return`gradient(${e.join(",")})`}function XH(t){return ye(t)?"("+GH(t)+")":t}function JH(t){return QH(ye(t)?t:{datum:t})}function QH(t){let e,n,i;if(t.signal){e="datum";i=t.signal}else if(t.group||t.parent){n=Math.max(1,t.level||1);e="item";while(n-- >0){e+=".mark.group"}if(t.parent){i=t.parent;e+=".datum"}else{i=t.group}}else if(t.datum){e="datum";i=t.datum}else{ne("Invalid field reference: "+Dn(t))}if(!t.signal){i=gn(i)?ie(i).map(Dn).join("]["):QH(i)}return e+"["+i+"]"}function ZH(t,e){const n=WH(t.scale);if(t.range!=null){e=`lerp(_range(${n}), ${+t.range})`}else{if(e!==undefined)e=`_scale(${n}, ${e})`;if(t.band){e=(e?e+"+":"")+`_bandwidth(${n})`+(+t.band===1?"":"*"+XH(t.band));if(t.extra){e=`(datum.extra ? _scale(${n}, datum.extra.value) : ${e})`}}if(e==null)e="0"}return e}function KH(t){let e="";t.forEach((t=>{const n=GH(t);e+=t.test?`(${t.test})?${n}:`:n}));if(Fe(e)===":"){e+="null"}return e}function tV(t,e,n,i,r,u){const o={};u=u||{};u.encoders={$encode:o};t=qH(t,e,n,i,r.config);for(const s in t){o[s]=eV(t[s],e,u,r)}return u}function eV(t,e,n,i){const r={},u={};for(const o in t){if(t[o]!=null){r[o]=iV(nV(t[o]),i,n,u)}}return{$expr:{marktype:e,channels:r},$fields:Object.keys(u),$output:Object.keys(t)}}function nV(t){return ve(t)?KH(t):GH(t)}function iV(t,e,n,i){const r=LU(t,e);r.$fields.forEach((t=>i[t]=1));tn(n,r.$params);return r.$expr}const rV="outer",uV=["value","update","init","react","bind"];function oV(t,e){ne(t+' for "outer" push: '+Dn(e))}function sV(t,e){const n=t.name;if(t.push===rV){if(!e.signals[n])oV("No prior signal definition",n);uV.forEach((e=>{if(t[e]!==undefined)oV("Invalid property ",e)}))}else{const i=e.addSignal(n,t.value);if(t.react===false)i.react=false;if(t.bind)e.addBinding(n,t.bind)}}function aV(t,e,n,i){this.id=-1;this.type=t;this.value=e;this.params=n;if(i)this.parent=i}function fV(t,e,n,i){return new aV(t,e,n,i)}function cV(t,e){return fV("operator",t,e)}function lV(t){const e={$ref:t.id};if(t.id<0)(t.refs=t.refs||[]).push(e);return e}function dV(t,e){return e?{$field:t,$name:e}:{$field:t}}const hV=dV("key");function pV(t,e){return{$compare:t,$order:e}}function mV(t,e){const n={$key:t};if(e)n.$flat=true;return n}const gV="ascending";const bV="descending";function vV(t){return!ye(t)?"":(t.order===bV?"-":"+")+yV(t.op,t.field)}function yV(t,e){return(t&&t.signal?"$"+t.signal:t||"")+(t&&e?"_":"")+(e&&e.signal?"$"+e.signal:e||"")}const wV="scope";const AV="view";function xV(t){return t&&t.signal}function OV(t){return t&&t.expr}function FV(t){if(xV(t))return true;if(ye(t))for(const e in t){if(FV(t[e]))return true}return false}function DV(t,e){return t!=null?t:e}function kV(t){return t&&t.signal||t}const EV="timer";function $V(t,e){const n=t.merge?CV:t.stream?MV:t.type?BV:ne("Invalid stream specification: "+Dn(t));return n(t,e)}function jV(t){return t===wV?AV:t||AV}function CV(t,e){const n=t.merge.map((t=>$V(t,e))),i=SV({merge:n},t,e);return e.addStream(i).id}function MV(t,e){const n=$V(t.stream,e),i=SV({stream:n},t,e);return e.addStream(i).id}function BV(t,e){let n;if(t.type===EV){n=e.event(EV,t.throttle);t={between:t.between,filter:t.filter}}else{n=e.event(jV(t.source),t.type)}const i=SV({stream:n},t,e);return Object.keys(i).length===1?n:e.addStream(i).id}function SV(t,e,n){let i=e.between;if(i){if(i.length!==2){ne('Stream "between" parameter must have 2 entries: '+Dn(e))}t.between=[$V(i[0],n),$V(i[1],n)]}i=e.filter?[].concat(e.filter):[];if(e.marktype||e.markname||e.markrole){i.push(_V(e.marktype,e.markname,e.markrole))}if(e.source===wV){i.push("inScope(event.item)")}if(i.length){t.filter=LU("("+i.join(")&&(")+")",n).$expr}if((i=e.throttle)!=null){t.throttle=+i}if((i=e.debounce)!=null){t.debounce=+i}if(e.consume){t.consume=true}return t}function _V(t,e,n){const i="event.item";return i+(t&&t!=="*"?"&&"+i+".mark.marktype==='"+t+"'":"")+(n?"&&"+i+".mark.role==='"+n+"'":"")+(e?"&&"+i+".mark.name==='"+e+"'":"")}const NV={code:"_.$value",ast:{type:"Identifier",value:"value"}};function zV(t,e,n){const i=t.encode,r={target:n};let u=t.events,o=t.update,s=[];if(!u){ne("Signal update missing events specification.")}if(gn(u)){u=oH(u,e.isSubscope()?wV:AV)}u=Ue(u).filter((t=>t.signal||t.scale?(s.push(t),0):1));if(s.length>1){s=[PV(s)]}if(u.length){s.push(u.length>1?{merge:u}:u[0])}if(i!=null){if(o)ne("Signal encode and update are mutually exclusive.");o="encode(item(),"+Dn(i)+")"}r.update=gn(o)?LU(o,e):o.expr!=null?LU(o.expr,e):o.value!=null?o.value:o.signal!=null?{$expr:NV,$params:{$value:e.signalRef(o.signal)}}:ne("Invalid signal update specification.");if(t.force){r.options={force:true}}s.forEach((t=>e.addUpdate(tn(TV(t,e),r))))}function TV(t,e){return{source:t.signal?e.signalRef(t.signal):t.scale?e.scaleRef(t.scale):$V(t,e)}}function PV(t){return{signal:"["+t.map((t=>t.scale?'scale("'+t.scale+'")':t.signal))+"]"}}function LV(t,e){const n=e.getSignal(t.name);let i=t.update;if(t.init){if(i){ne("Signals can not include both init and update expressions.")}else{i=t.init;n.initonly=true}}if(i){i=LU(i,e);n.update=i.$expr;n.params=i.$params}if(t.on){t.on.forEach((t=>zV(t,e,n.id)))}}const IV=t=>(e,n,i)=>fV(t,n,e||undefined,i);const RV=IV("aggregate");const qV=IV("axisticks");const UV=IV("bound");const WV=IV("collect");const GV=IV("compare");const HV=IV("datajoin");const VV=IV("encode");const YV=IV("expression");const XV=IV("facet");const JV=IV("field");const QV=IV("key");const ZV=IV("legendentries");const KV=IV("load");const tY=IV("mark");const eY=IV("multiextent");const nY=IV("multivalues");const iY=IV("overlap");const rY=IV("params");const uY=IV("prefacet");const oY=IV("projection");const sY=IV("proxy");const aY=IV("relay");const fY=IV("render");const cY=IV("scale");const lY=IV("sieve");const dY=IV("sortitems");const hY=IV("viewlayout");const pY=IV("values");let mY=0;const gY={min:"min",max:"max",count:"sum"};function bY(t,e){const n=t.type||"linear";if(!Pg(n)){ne("Unrecognized scale type: "+Dn(n))}e.addScale(t.name,{type:n,domain:undefined})}function vY(t,e){const n=e.getScale(t.name).params;let i;n.domain=xY(t.domain,t,e);if(t.range!=null){n.range=_Y(t,e,n)}if(t.interpolate!=null){SY(t.interpolate,n)}if(t.nice!=null){n.nice=BY(t.nice)}if(t.bins!=null){n.bins=MY(t.bins,e)}for(i in t){if(un(n,i)||i==="name")continue;n[i]=yY(t[i],e)}}function yY(t,e){return!ye(t)?t:t.signal?e.signalRef(t.signal):ne("Unsupported object: "+Dn(t))}function wY(t,e){return t.signal?e.signalRef(t.signal):t.map((t=>yY(t,e)))}function AY(t){ne("Can not find data set: "+Dn(t))}function xY(t,e,n){if(!t){if(e.domainMin!=null||e.domainMax!=null){ne("No scale domain defined for domainMin/domainMax to override.")}return}return t.signal?n.signalRef(t.signal):(ve(t)?OY:t.fields?DY:FY)(t,e,n)}function OY(t,e,n){return t.map((t=>yY(t,n)))}function FY(t,e,n){const i=n.getData(t.data);if(!i)AY(t.data);return Rg(e.type)?i.valuesRef(n,t.field,$Y(t.sort,false)):Hg(e.type)?i.domainRef(n,t.field):i.extentRef(n,t.field)}function DY(t,e,n){const i=t.data,r=t.fields.reduce(((t,e)=>{e=gn(e)?{data:i,field:e}:ve(e)||e.signal?kY(e,n):e;t.push(e);return t}),[]);return(Rg(e.type)?EY:Hg(e.type)?jY:CY)(t,n,r)}function kY(t,e){const n="_:vega:_"+mY++,i=WV({});if(ve(t)){i.value={$ingest:t}}else if(t.signal){const r="setdata("+Dn(n)+","+t.signal+")";i.params.input=e.signalRef(r)}e.addDataPipeline(n,[i,lY({})]);return{data:n,field:"data"}}function EY(t,e,n){const i=$Y(t.sort,true);let r,u;const o=n.map((t=>{const n=e.getData(t.data);if(!n)AY(t.data);return n.countsRef(e,t.field,i)}));const s={groupby:hV,pulse:o};if(i){r=i.op||"count";u=i.field?yV(r,i.field):"count";s.ops=[gY[r]];s.fields=[e.fieldRef(u)];s.as=[u]}r=e.add(RV(s));const a=e.add(WV({pulse:lV(r)}));u=e.add(pY({field:hV,sort:e.sortRef(i),pulse:lV(a)}));return lV(u)}function $Y(t,e){if(t){if(!t.field&&!t.op){if(ye(t))t.field="key";else t={field:"key"}}else if(!t.field&&t.op!=="count"){ne("No field provided for sort aggregate op: "+t.op)}else if(e&&t.field){if(t.op&&!gY[t.op]){ne("Multiple domain scales can not be sorted using "+t.op)}}}return t}function jY(t,e,n){const i=n.map((t=>{const n=e.getData(t.data);if(!n)AY(t.data);return n.domainRef(e,t.field)}));return lV(e.add(nY({values:i})))}function CY(t,e,n){const i=n.map((t=>{const n=e.getData(t.data);if(!n)AY(t.data);return n.extentRef(e,t.field)}));return lV(e.add(eY({extents:i})))}function MY(t,e){return t.signal||ve(t)?wY(t,e):e.objectProperty(t)}function BY(t){return ye(t)?{interval:yY(t.interval),step:yY(t.step)}:yY(t)}function SY(t,e){e.interpolate=yY(t.type||t);if(t.gamma!=null){e.interpolateGamma=yY(t.gamma)}}function _Y(t,e,n){const i=e.config.range;let r=t.range;if(r.signal){return e.signalRef(r.signal)}else if(gn(r)){if(i&&un(i,r)){t=tn({},t,{range:i[r]});return _Y(t,e,n)}else if(r==="width"){r=[0,{signal:"width"}]}else if(r==="height"){r=Rg(t.type)?[0,{signal:"height"}]:[{signal:"height"},0]}else{ne("Unrecognized scale range value: "+Dn(r))}}else if(r.scheme){n.scheme=ve(r.scheme)?wY(r.scheme,e):yY(r.scheme,e);if(r.extent)n.schemeExtent=wY(r.extent,e);if(r.count)n.schemeCount=yY(r.count,e);return}else if(r.step){n.rangeStep=yY(r.step,e);return}else if(Rg(t.type)&&!ve(r)){return xY(r,t,e)}else if(!ve(r)){ne("Unsupported range type: "+Dn(r))}return r.map((t=>(ve(t)?wY:yY)(t,e)))}function NY(t,e){const n=e.config.projection||{},i={};for(const r in t){if(r==="name")continue;i[r]=zY(t[r],r,e)}for(const r in n){if(i[r]==null){i[r]=zY(n[r],r,e)}}e.addProjection(t.name,i)}function zY(t,e,n){return ve(t)?t.map((t=>zY(t,e,n))):!ye(t)?t:t.signal?n.signalRef(t.signal):e==="fit"?t:ne("Unsupported parameter object: "+Dn(t))}const TY="top";const PY="left";const LY="right";const IY="bottom";const RY="center";const qY="vertical";const UY="start";const WY="middle";const GY="end";const HY="index";const VY="label";const YY="offset";const XY="perc";const JY="perc2";const QY="value";const ZY="guide-label";const KY="guide-title";const tX="group-title";const eX="group-subtitle";const nX="symbol";const iX="gradient";const rX="discrete";const uX="size";const oX="shape";const sX="fill";const aX="stroke";const fX="strokeWidth";const cX="strokeDash";const lX="opacity";const dX=[uX,oX,sX,aX,fX,cX,lX];const hX={name:1,style:1,interactive:1};const pX={value:0};const mX={value:1};const gX="group";const bX="rect";const vX="rule";const yX="symbol";const wX="text";function AX(t){t.type=gX;t.interactive=t.interactive||false;return t}function xX(t,e){const n=(n,i)=>DV(t[n],DV(e[n],i));n.isVertical=n=>qY===DV(t.direction,e.direction||(n?e.symbolDirection:e.gradientDirection));n.gradientLength=()=>DV(t.gradientLength,e.gradientLength||e.gradientWidth);n.gradientThickness=()=>DV(t.gradientThickness,e.gradientThickness||e.gradientHeight);n.entryColumns=()=>DV(t.columns,DV(e.columns,+n.isVertical(true)));return n}function OX(t,e){const n=e&&(e.update&&e.update[t]||e.enter&&e.enter[t]);return n&&n.signal?n:n?n.value:null}function FX(t,e,n){const i=e.config.style[n];return i&&i[t]}function DX(t,e,n){return`item.anchor === '${UY}' ? ${t} : item.anchor === '${GY}' ? ${e} : ${n}`}const kX=DX(Dn(PY),Dn(LY),Dn(RY));function EX(t){const e=t("tickBand");let n=t("tickOffset"),i,r;if(!e){i=t("bandPosition");r=t("tickExtra")}else if(e.signal){i={signal:`(${e.signal}) === 'extent' ? 1 : 0.5`};r={signal:`(${e.signal}) === 'extent'`};if(!ye(n)){n={signal:`(${e.signal}) === 'extent' ? 0 : ${n}`}}}else if(e==="extent"){i=1;r=true;n=0}else{i=.5;r=false}return{extra:r,band:i,offset:n}}function $X(t,e){return!e?t:!t?e:!ye(t)?{value:t,offset:e}:Object.assign({},t,{offset:$X(t.offset,e)})}function jX(t,e){if(e){t.name=e.name;t.style=e.style||t.style;t.interactive=!!e.interactive;t.encode=AH(t.encode,e,hX)}else{t.interactive=false}return t}function CX(t,e,n,i){const r=xX(t,n),u=r.isVertical(),o=r.gradientThickness(),s=r.gradientLength();let a,f,c,l,d;if(u){f=[0,1];c=[0,0];l=o;d=s}else{f=[0,0];c=[1,0];l=s;d=o}const h={enter:a={opacity:pX,x:pX,y:pX,width:vH(l),height:vH(d)},update:tn({},a,{opacity:mX,fill:{gradient:e,start:f,stop:c}}),exit:{opacity:pX}};wH(h,{stroke:r("gradientStrokeColor"),strokeWidth:r("gradientStrokeWidth")},{opacity:r("gradientOpacity")});return jX({type:bX,role:NH,encode:h},i)}function MX(t,e,n,i,r){const u=xX(t,n),o=u.isVertical(),s=u.gradientThickness(),a=u.gradientLength();let f,c,l,d,h="";o?(f="y",l="y2",c="x",d="width",h="1-"):(f="x",l="x2",c="y",d="height");const p={opacity:pX,fill:{scale:e,field:QY}};p[f]={signal:h+"datum."+XY,mult:a};p[c]=pX;p[l]={signal:h+"datum."+JY,mult:a};p[d]=vH(s);const m={enter:p,update:tn({},p,{opacity:mX}),exit:{opacity:pX}};wH(m,{stroke:u("gradientStrokeColor"),strokeWidth:u("gradientStrokeWidth")},{opacity:u("gradientOpacity")});return jX({type:bX,role:SH,key:QY,from:r,encode:m},i)}const BX=`datum.${XY}<=0?"${PY}":datum.${XY}>=1?"${LY}":"${RY}"`,SX=`datum.${XY}<=0?"${IY}":datum.${XY}>=1?"${TY}":"${WY}"`;function _X(t,e,n,i){const r=xX(t,e),u=r.isVertical(),o=vH(r.gradientThickness()),s=r.gradientLength();let a=r("labelOverlap"),f,c,l,d,h="";const p={enter:f={opacity:pX},update:c={opacity:mX,text:{field:VY}},exit:{opacity:pX}};wH(p,{fill:r("labelColor"),fillOpacity:r("labelOpacity"),font:r("labelFont"),fontSize:r("labelFontSize"),fontStyle:r("labelFontStyle"),fontWeight:r("labelFontWeight"),limit:DV(t.labelLimit,e.gradientLabelLimit)});if(u){f.align={value:"left"};f.baseline=c.baseline={signal:SX};l="y";d="x";h="1-"}else{f.align=c.align={signal:BX};f.baseline={value:"top"};l="x";d="y"}f[l]=c[l]={signal:h+"datum."+XY,mult:s};f[d]=c[d]=o;o.offset=DV(t.labelOffset,e.gradientLabelOffset)||0;a=a?{separation:r("labelSeparation"),method:a,order:"datum."+HY}:undefined;return jX({type:wX,role:zH,style:ZY,key:QY,from:i,encode:p,overlap:a},n)}function NX(t,e,n,i,r){const u=xX(t,e),o=n.entries,s=!!(o&&o.interactive),a=o?o.name:undefined,f=u("clipHeight"),c=u("symbolOffset"),l={data:"value"},d=`(${r}) ? datum.${YY} : datum.${uX}`,h=f?vH(f):{field:uX},p=`datum.${HY}`,m=`max(1, ${r})`;let g,b,v,y,w;h.mult=.5;g={enter:b={opacity:pX,x:{signal:d,mult:.5,offset:c},y:h},update:v={opacity:mX,x:b.x,y:b.y},exit:{opacity:pX}};let A=null,x=null;if(!t.fill){A=e.symbolBaseFillColor;x=e.symbolBaseStrokeColor}wH(g,{fill:u("symbolFillColor",A),shape:u("symbolType"),size:u("symbolSize"),stroke:u("symbolStrokeColor",x),strokeDash:u("symbolDash"),strokeDashOffset:u("symbolDashOffset"),strokeWidth:u("symbolStrokeWidth")},{opacity:u("symbolOpacity")});dX.forEach((e=>{if(t[e]){v[e]=b[e]={scale:t[e],field:QY}}}));const O=jX({type:yX,role:TH,key:QY,from:l,clip:f?true:undefined,encode:g},n.symbols);const F=vH(c);F.offset=u("labelOffset");g={enter:b={opacity:pX,x:{signal:d,offset:F},y:h},update:v={opacity:mX,text:{field:VY},x:b.x,y:b.y},exit:{opacity:pX}};wH(g,{align:u("labelAlign"),baseline:u("labelBaseline"),fill:u("labelColor"),fillOpacity:u("labelOpacity"),font:u("labelFont"),fontSize:u("labelFontSize"),fontStyle:u("labelFontStyle"),fontWeight:u("labelFontWeight"),limit:u("labelLimit")});const D=jX({type:wX,role:zH,style:ZY,key:QY,from:l,encode:g},n.labels);g={enter:{noBound:{value:!f},width:pX,height:f?vH(f):pX,opacity:pX},exit:{opacity:pX},update:v={opacity:mX,row:{signal:null},column:{signal:null}}};if(u.isVertical(true)){y=`ceil(item.mark.items.length / ${m})`;v.row.signal=`${p}%${y}`;v.column.signal=`floor(${p} / ${y})`;w={field:["row",p]}}else{v.row.signal=`floor(${p} / ${m})`;v.column.signal=`${p} % ${m}`;w={field:p}}v.column.signal=`(${r})?${v.column.signal}:${p}`;i={facet:{data:i,name:"value",groupby:HY}};return AX({role:DH,from:i,encode:AH(g,o,hX),marks:[O,D],name:a,interactive:s,sort:w})}function zX(t,e){const n=xX(t,e);return{align:n("gridAlign"),columns:n.entryColumns(),center:{row:true,column:false},padding:{row:n("rowPadding"),column:n("columnPadding")}}}const TX='item.orient === "left"',PX='item.orient === "right"',LX=`(${TX} || ${PX})`,IX=`datum.vgrad && ${LX}`,RX=DX('"top"','"bottom"','"middle"'),qX=DX('"right"','"left"','"center"'),UX=`datum.vgrad && ${PX} ? (${qX}) : (${LX} && !(datum.vgrad && ${TX})) ? "left" : ${kX}`,WX=`item._anchor || (${LX} ? "middle" : "start")`,GX=`${IX} ? (${TX} ? -90 : 90) : 0`,HX=`${LX} ? (datum.vgrad ? (${PX} ? "bottom" : "top") : ${RX}) : "top"`;function VX(t,e,n,i){const r=xX(t,e);const u={enter:{opacity:pX},update:{opacity:mX,x:{field:{group:"padding"}},y:{field:{group:"padding"}}},exit:{opacity:pX}};wH(u,{orient:r("titleOrient"),_anchor:r("titleAnchor"),anchor:{signal:WX},angle:{signal:GX},align:{signal:UX},baseline:{signal:HX},text:t.title,fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),baseline:r("titleBaseline")});return jX({type:wX,role:PH,style:KY,from:i,encode:u},n)}function YX(t,e){let n;if(ye(t)){if(t.signal){n=t.signal}else if(t.path){n="pathShape("+XX(t.path)+")"}else if(t.sphere){n="geoShape("+XX(t.sphere)+', {type: "Sphere"})'}}return n?e.signalRef(n):!!t}function XX(t){return ye(t)&&t.signal?t.signal:Dn(t)}function JX(t){const e=t.role||"";return!e.indexOf("axis")||!e.indexOf("legend")||!e.indexOf("title")?e:t.type===gX?DH:e||OH}function QX(t){return{marktype:t.type,name:t.name||undefined,role:t.role||JX(t),zindex:+t.zindex||undefined,aria:t.aria,description:t.description}}function ZX(t,e){return t&&t.signal?e.signalRef(t.signal):t===false?false:true}function KX(t,e){const n=tc(t.type);if(!n)ne("Unrecognized transform type: "+Dn(t.type));const i=fV(n.type.toLowerCase(),null,tJ(n,t,e));if(t.signal)e.addSignal(t.signal,e.proxy(i));i.metadata=n.metadata||{};return i}function tJ(t,e,n){const i={},r=t.params.length;for(let u=0;u<r;++u){const r=t.params[u];i[r.name]=eJ(r,e,n)}return i}function eJ(t,e,n){const i=t.type,r=e[t.name];if(i==="index"){return iJ(t,e,n)}else if(r===undefined){if(t.required){ne("Missing required "+Dn(e.type)+" parameter: "+Dn(t.name))}return}else if(i==="param"){return rJ(t,e,n)}else if(i==="projection"){return n.projectionRef(e[t.name])}return t.array&&!xV(r)?r.map((e=>nJ(t,e,n))):nJ(t,r,n)}function nJ(t,e,n){const i=t.type;if(xV(e)){return fJ(i)?ne("Expression references can not be signals."):cJ(i)?n.fieldRef(e):lJ(i)?n.compareRef(e):n.signalRef(e.signal)}else{const r=t.expr||cJ(i);return r&&oJ(e)?n.exprRef(e.expr,e.as):r&&sJ(e)?dV(e.field,e.as):fJ(i)?LU(e,n):aJ(i)?lV(n.getData(e).values):cJ(i)?dV(e):lJ(i)?n.compareRef(e):e}}function iJ(t,e,n){if(!gn(e.from)){ne('Lookup "from" parameter must be a string literal.')}return n.getData(e.from).lookupRef(n,e.key)}function rJ(t,e,n){const i=e[t.name];if(t.array){if(!ve(i)){ne("Expected an array of sub-parameters. Instead: "+Dn(i))}return i.map((e=>uJ(t,e,n)))}else{return uJ(t,i,n)}}function uJ(t,e,n){const i=t.params.length;let r;for(let o=0;o<i;++o){r=t.params[o];for(const t in r.key){if(r.key[t]!==e[t]){r=null;break}}if(r)break}if(!r)ne("Unsupported parameter: "+Dn(e));const u=tn(tJ(r,e,n),r.key);return lV(n.add(rY(u)))}const oJ=t=>t&&t.expr;const sJ=t=>t&&t.field;const aJ=t=>t==="data";const fJ=t=>t==="expr";const cJ=t=>t==="field";const lJ=t=>t==="compare";function dJ(t,e,n){let i,r,u,o,s;if(!t){o=lV(n.add(WV(null,[{}])))}else if(i=t.facet){if(!e)ne("Only group marks can be faceted.");if(i.field!=null){o=s=hJ(i,n)}else{if(!t.data){u=KX(tn({type:"aggregate",groupby:Ue(i.groupby)},i.aggregate),n);u.params.key=n.keyRef(i.groupby);u.params.pulse=hJ(i,n);o=s=lV(n.add(u))}else{s=lV(n.getData(t.data).aggregate)}r=n.keyRef(i.groupby,true)}}if(!o){o=hJ(t,n)}return{key:r,pulse:o,parent:s}}function hJ(t,e){return t.$ref?t:t.data&&t.data.$ref?t.data:lV(e.getData(t.data).output)}function pJ(t,e,n,i,r){this.scope=t;this.input=e;this.output=n;this.values=i;this.aggregate=r;this.index={}}pJ.fromEntries=function(t,e){const n=e.length,i=e[n-1],r=e[n-2];let u=e[0],o=null,s=1;if(u&&u.type==="load"){u=e[1]}t.add(e[0]);for(;s<n;++s){e[s].params.pulse=lV(e[s-1]);t.add(e[s]);if(e[s].type==="aggregate")o=e[s]}return new pJ(t,u,r,i,o)};function mJ(t){return gn(t)?t:null}function gJ(t,e,n){const i=yV(n.op,n.field);let r;if(e.ops){for(let t=0,n=e.as.length;t<n;++t){if(e.as[t]===i)return}}else{e.ops=["count"];e.fields=[null];e.as=["count"]}if(n.op){e.ops.push((r=n.op.signal)?t.signalRef(r):n.op);e.fields.push(t.fieldRef(n.field));e.as.push(i)}}function bJ(t,e,n,i,r,u,o){const s=e[n]||(e[n]={}),a=vV(u);let f=mJ(r),c,l;if(f!=null){t=e.scope;f=f+(a?"|"+a:"");c=s[f]}if(!c){const n=u?{field:hV,pulse:e.countsRef(t,r,u)}:{field:t.fieldRef(r),pulse:lV(e.output)};if(a)n.sort=t.sortRef(u);l=t.add(fV(i,undefined,n));if(o)e.index[r]=l;c=lV(l);if(f!=null)s[f]=c}return c}pJ.prototype={countsRef(t,e,n){const i=this,r=i.counts||(i.counts={}),u=mJ(e);let o,s,a;if(u!=null){t=i.scope;o=r[u]}if(!o){a={groupby:t.fieldRef(e,"key"),pulse:lV(i.output)};if(n&&n.field)gJ(t,a,n);s=t.add(RV(a));o=t.add(WV({pulse:lV(s)}));o={agg:s,ref:lV(o)};if(u!=null)r[u]=o}else if(n&&n.field){gJ(t,o.agg.params,n)}return o.ref},tuplesRef(){return lV(this.values)},extentRef(t,e){return bJ(t,this,"extent","extent",e,false)},domainRef(t,e){return bJ(t,this,"domain","values",e,false)},valuesRef(t,e,n){return bJ(t,this,"vals","values",e,n||true)},lookupRef(t,e){return bJ(t,this,"lookup","tupleindex",e,false)},indataRef(t,e){return bJ(t,this,"indata","tupleindex",e,true,true)}};function vJ(t,e,n){const i=t.from.facet,r=i.name,u=hJ(i,e);let o;if(!i.name){ne("Facet must have a name: "+Dn(i))}if(!i.data){ne("Facet must reference a data set: "+Dn(i))}if(i.field){o=e.add(uY({field:e.fieldRef(i.field),pulse:u}))}else if(i.groupby){o=e.add(XV({key:e.keyRef(i.groupby),group:lV(e.proxy(n.parent)),pulse:u}))}else{ne("Facet must specify groupby or field: "+Dn(i))}const s=e.fork(),a=s.add(WV()),f=s.add(lY({pulse:lV(a)}));s.addData(r,new pJ(s,a,a,f));s.addSignal("parent",null);o.params.subflow={$subflow:s.parse(t).toRuntime()}}function yJ(t,e,n){const i=e.add(uY({pulse:n.pulse})),r=e.fork();r.add(lY());r.addSignal("parent",null);i.params.subflow={$subflow:r.parse(t).toRuntime()}}function wJ(t,e,n){const i=t.remove,r=t.insert,u=t.toggle,o=t.modify,s=t.values,a=e.add(cV());const f="if("+t.trigger+',modify("'+n+'",'+[r,i,u,o,s].map((t=>t==null?"null":t)).join(",")+"),0)";const c=LU(f,e);a.update=c.$expr;a.params=c.$params}function AJ(t,e){const n=JX(t),i=t.type===gX,r=t.from&&t.from.facet,u=t.overlap;let o=t.layout||n===DH||n===FH,s,a,f,c,l,d,h;const p=n===OH||o||r;const m=dJ(t.from,i,e);a=e.add(HV({key:m.key||(t.key?dV(t.key):undefined),pulse:m.pulse,clean:!i}));const g=lV(a);a=f=e.add(WV({pulse:g}));a=e.add(tY({markdef:QX(t),interactive:ZX(t.interactive,e),clip:YX(t.clip,e),context:{$context:true},groups:e.lookup(),parent:e.signals.parent?e.signalRef("parent"):null,index:e.markpath(),pulse:lV(a)}));const b=lV(a);a=c=e.add(VV(tV(t.encode,t.type,n,t.style,e,{mod:false,pulse:b})));a.params.parent=e.encode();if(t.transform){t.transform.forEach((t=>{const n=KX(t,e),i=n.metadata;if(i.generates||i.changes){ne("Mark transforms should not generate new data.")}if(!i.nomod)c.params.mod=true;n.params.pulse=lV(a);e.add(a=n)}))}if(t.sort){a=e.add(dY({sort:e.compareRef(t.sort),pulse:lV(a)}))}const v=lV(a);if(r||o){o=e.add(hY({layout:e.objectProperty(t.layout),legends:e.legends,mark:b,pulse:v}));d=lV(o)}const y=e.add(UV({mark:b,pulse:d||v}));h=lV(y);if(i){if(p){s=e.operators;s.pop();if(o)s.pop()}e.pushState(v,d||h,g);r?vJ(t,e,m):p?yJ(t,e,m):e.parse(t);e.popState();if(p){if(o)s.push(o);s.push(y)}}if(u){h=xJ(u,h,e)}const w=e.add(fY({pulse:h})),A=e.add(lY({pulse:lV(w)},undefined,e.parent()));if(t.name!=null){l=t.name;e.addData(l,new pJ(e,f,w,A));if(t.on)t.on.forEach((t=>{if(t.insert||t.remove||t.toggle){ne("Marks only support modify triggers.")}wJ(t,e,l)}))}}function xJ(t,e,n){const i=t.method,r=t.bound,u=t.separation;const o={separation:xV(u)?n.signalRef(u.signal):u,method:xV(i)?n.signalRef(i.signal):i,pulse:e};if(t.order){o.sort=n.compareRef({field:t.order})}if(r){const t=r.tolerance;o.boundTolerance=xV(t)?n.signalRef(t.signal):+t;o.boundScale=n.scaleRef(r.scale);o.boundOrient=r.orient}return lV(n.add(iY(o)))}function OJ(t,e){const n=e.config.legend,i=t.encode||{},r=xX(t,n),u=i.legend||{},o=u.name||undefined,s=u.interactive,a=u.style,f={};let c=0,l,d,h;dX.forEach((e=>t[e]?(f[e]=t[e],c=c||t[e]):0));if(!c)ne("Missing valid scale for legend.");const p=FJ(t,e.scaleType(c));const m={title:t.title!=null,scales:f,type:p,vgrad:p!=="symbol"&&r.isVertical()};const g=lV(e.add(WV(null,[m])));const b={enter:{x:{value:0},y:{value:0}}};const v=lV(e.add(ZV(d={type:p,scale:e.scaleRef(c),count:e.objectProperty(r("tickCount")),limit:e.property(r("symbolLimit")),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));if(p===iX){h=[CX(t,c,n,i.gradient),_X(t,n,i.labels,v)];d.count=d.count||e.signalRef(`max(2,2*floor((${kV(r.gradientLength())})/100))`)}else if(p===rX){h=[MX(t,c,n,i.gradient,v),_X(t,n,i.labels,v)]}else{l=zX(t,n);h=[NX(t,n,i,v,kV(l.columns))];d.size=EJ(t,e,h[0].marks)}h=[AX({role:_H,from:g,encode:b,marks:h,layout:l,interactive:s})];if(m.title){h.push(VX(t,n,i.title,g))}return AJ(AX({role:BH,from:g,encode:AH(kJ(r,t,n),u,hX),marks:h,aria:r("aria"),description:r("description"),zindex:r("zindex"),name:o,interactive:s,style:a}),e)}function FJ(t,e){let n=t.type||nX;if(!t.type&&DJ(t)===1&&(t.fill||t.stroke)){n=Ig(e)?iX:qg(e)?rX:nX}return n!==iX?n:qg(e)?rX:iX}function DJ(t){return dX.reduce(((e,n)=>e+(t[n]?1:0)),0)}function kJ(t,e,n){const i={enter:{},update:{}};wH(i,{orient:t("orient"),offset:t("offset"),padding:t("padding"),titlePadding:t("titlePadding"),cornerRadius:t("cornerRadius"),fill:t("fillColor"),stroke:t("strokeColor"),strokeWidth:n.strokeWidth,strokeDash:n.strokeDash,x:t("legendX"),y:t("legendY"),format:e.format,formatType:e.formatType});return i}function EJ(t,e,n){const i=kV($J("size",t,n)),r=kV($J("strokeWidth",t,n)),u=kV(jJ(n[1].encode,e,ZY));return LU(`max(ceil(sqrt(${i})+${r}),${u})`,e)}function $J(t,e,n){return e[t]?`scale("${e[t]}",datum)`:OX(t,n[0].encode)}function jJ(t,e,n){return OX("fontSize",t)||FX("fontSize",e,n)}const CJ=`item.orient==="${PY}"?-90:item.orient==="${LY}"?90:0`;function MJ(t,e){t=gn(t)?{text:t}:t;const n=xX(t,e.config.title),i=t.encode||{},r=i.group||{},u=r.name||undefined,o=r.interactive,s=r.style,a=[];const f={},c=lV(e.add(WV(null,[f])));a.push(_J(t,n,BJ(t),c));if(t.subtitle){a.push(NJ(t,n,i.subtitle,c))}return AJ(AX({role:LH,from:c,encode:SJ(n,r),marks:a,aria:n("aria"),description:n("description"),zindex:n("zindex"),name:u,interactive:o,style:s}),e)}function BJ(t){const e=t.encode;return e&&e.title||tn({name:t.name,interactive:t.interactive,style:t.style},e)}function SJ(t,e){const n={enter:{},update:{}};wH(n,{orient:t("orient"),anchor:t("anchor"),align:{signal:kX},angle:{signal:CJ},limit:t("limit"),frame:t("frame"),offset:t("offset")||0,padding:t("subtitlePadding")});return AH(n,e,hX)}function _J(t,e,n,i){const r={value:0},u=t.text,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};wH(o,{text:u,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("color"),font:e("font"),fontSize:e("fontSize"),fontStyle:e("fontStyle"),fontWeight:e("fontWeight"),lineHeight:e("lineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")});return jX({type:wX,role:IH,style:tX,from:i,encode:o},n)}function NJ(t,e,n,i){const r={value:0},u=t.subtitle,o={enter:{opacity:r},update:{opacity:{value:1}},exit:{opacity:r}};wH(o,{text:u,align:{signal:"item.mark.group.align"},angle:{signal:"item.mark.group.angle"},limit:{signal:"item.mark.group.limit"},baseline:"top",dx:e("dx"),dy:e("dy"),fill:e("subtitleColor"),font:e("subtitleFont"),fontSize:e("subtitleFontSize"),fontStyle:e("subtitleFontStyle"),fontWeight:e("subtitleFontWeight"),lineHeight:e("subtitleLineHeight")},{align:e("align"),angle:e("angle"),baseline:e("baseline")});return jX({type:wX,role:RH,style:eX,from:i,encode:o},n)}function zJ(t,e){const n=[];if(t.transform){t.transform.forEach((t=>{n.push(KX(t,e))}))}if(t.on){t.on.forEach((n=>{wJ(n,e,t.name)}))}e.addDataPipeline(t.name,TJ(t,e,n))}function TJ(t,e,n){const i=[];let r=null,u=false,o=false,s,a,f,c,l;if(t.values){if(xV(t.values)||FV(t.format)){i.push(LJ(e,t));i.push(r=PJ())}else{i.push(r=PJ({$ingest:t.values,$format:t.format}))}}else if(t.url){if(FV(t.url)||FV(t.format)){i.push(LJ(e,t));i.push(r=PJ())}else{i.push(r=PJ({$request:t.url,$format:t.format}))}}else if(t.source){r=s=Ue(t.source).map((t=>lV(e.getData(t).output)));i.push(null)}for(a=0,f=n.length;a<f;++a){c=n[a];l=c.metadata;if(!r&&!l.source){i.push(r=PJ())}i.push(c);if(l.generates)o=true;if(l.modifies&&!o)u=true;if(l.source)r=c;else if(l.changes)r=null}if(s){f=s.length-1;i[0]=aY({derive:u,pulse:f?s:s[0]});if(u||f){i.splice(1,0,PJ())}}if(!r)i.push(PJ());i.push(lY({}));return i}function PJ(t){const e=WV({},t);e.metadata={source:true};return e}function LJ(t,e){return KV({url:e.url?t.property(e.url):undefined,async:e.async?t.property(e.async):undefined,values:e.values?t.property(e.values):undefined,format:t.objectProperty(e.format)})}const IJ=t=>t===IY||t===TY;const RJ=(t,e,n)=>xV(t)?YJ(t.signal,e,n):t===PY||t===TY?e:n;const qJ=(t,e,n)=>xV(t)?HJ(t.signal,e,n):IJ(t)?e:n;const UJ=(t,e,n)=>xV(t)?VJ(t.signal,e,n):IJ(t)?n:e;const WJ=(t,e,n)=>xV(t)?XJ(t.signal,e,n):t===TY?{value:e}:{value:n};const GJ=(t,e,n)=>xV(t)?JJ(t.signal,e,n):t===LY?{value:e}:{value:n};const HJ=(t,e,n)=>QJ(`${t} === '${TY}' || ${t} === '${IY}'`,e,n);const VJ=(t,e,n)=>QJ(`${t} !== '${TY}' && ${t} !== '${IY}'`,e,n);const YJ=(t,e,n)=>KJ(`${t} === '${PY}' || ${t} === '${TY}'`,e,n);const XJ=(t,e,n)=>KJ(`${t} === '${TY}'`,e,n);const JJ=(t,e,n)=>KJ(`${t} === '${LY}'`,e,n);const QJ=(t,e,n)=>{e=e!=null?vH(e):e;n=n!=null?vH(n):n;if(ZJ(e)&&ZJ(n)){e=e?e.signal||Dn(e.value):null;n=n?n.signal||Dn(n.value):null;return{signal:`${t} ? (${e}) : (${n})`}}else{return[tn({test:t},e)].concat(n||[])}};const ZJ=t=>t==null||Object.keys(t).length===1;const KJ=(t,e,n)=>({signal:`${t} ? (${eQ(e)}) : (${eQ(n)})`});const tQ=(t,e,n,i,r)=>({signal:(i!=null?`${t} === '${PY}' ? (${eQ(i)}) : `:"")+(n!=null?`${t} === '${IY}' ? (${eQ(n)}) : `:"")+(r!=null?`${t} === '${LY}' ? (${eQ(r)}) : `:"")+(e!=null?`${t} === '${TY}' ? (${eQ(e)}) : `:"")+"(null)"});const eQ=t=>xV(t)?t.signal:t==null?null:Dn(t);const nQ=(t,e)=>e===0?0:xV(t)?{signal:`(${t.signal}) * ${e}`}:{value:t*e};const iQ=(t,e)=>{const n=t.signal;return n&&n.endsWith("(null)")?{signal:n.slice(0,-6)+e.signal}:t};function rQ(t,e,n,i){let r;if(e&&un(e,t)){return e[t]}else if(un(n,t)){return n[t]}else if(t.startsWith("title")){switch(t){case"titleColor":r="fill";break;case"titleFont":case"titleFontSize":case"titleFontWeight":r=t[5].toLowerCase()+t.slice(6)}return i[KY][r]}else if(t.startsWith("label")){switch(t){case"labelColor":r="fill";break;case"labelFont":case"labelFontSize":r=t[5].toLowerCase()+t.slice(6)}return i[ZY][r]}return null}function uQ(t){const e={};for(const n of t){if(!n)continue;for(const t in n)e[t]=1}return Object.keys(e)}function oQ(t,e){var n=e.config,i=n.style,r=n.axis,u=e.scaleType(t.scale)==="band"&&n.axisBand,o=t.orient,s,a,f;if(xV(o)){const t=uQ([n.axisX,n.axisY]),e=uQ([n.axisTop,n.axisBottom,n.axisLeft,n.axisRight]);s={};for(f of t){s[f]=qJ(o,rQ(f,n.axisX,r,i),rQ(f,n.axisY,r,i))}a={};for(f of e){a[f]=tQ(o.signal,rQ(f,n.axisTop,r,i),rQ(f,n.axisBottom,r,i),rQ(f,n.axisLeft,r,i),rQ(f,n.axisRight,r,i))}}else{s=o===TY||o===IY?n.axisX:n.axisY;a=n["axis"+o[0].toUpperCase()+o.slice(1)]}const c=s||a||u?tn({},r,s,a,u):r;return c}function sQ(t,e,n,i){const r=xX(t,e),u=t.orient;let o,s;const a={enter:o={opacity:pX},update:s={opacity:mX},exit:{opacity:pX}};wH(a,{stroke:r("domainColor"),strokeCap:r("domainCap"),strokeDash:r("domainDash"),strokeDashOffset:r("domainDashOffset"),strokeWidth:r("domainWidth"),strokeOpacity:r("domainOpacity")});const f=aQ(t,0);const c=aQ(t,1);o.x=s.x=qJ(u,f,pX);o.x2=s.x2=qJ(u,c);o.y=s.y=UJ(u,f,pX);o.y2=s.y2=UJ(u,c);return jX({type:vX,role:EH,from:i,encode:a},n)}function aQ(t,e){return{scale:t.scale,range:e}}function fQ(t,e,n,i,r){const u=xX(t,e),o=t.orient,s=t.gridScale,a=RJ(o,1,-1),f=cQ(t.offset,a);let c,l,d;const h={enter:c={opacity:pX},update:d={opacity:mX},exit:l={opacity:pX}};wH(h,{stroke:u("gridColor"),strokeCap:u("gridCap"),strokeDash:u("gridDash"),strokeDashOffset:u("gridDashOffset"),strokeOpacity:u("gridOpacity"),strokeWidth:u("gridWidth")});const p={scale:t.scale,field:QY,band:r.band,extra:r.extra,offset:r.offset,round:u("tickRound")};const m=qJ(o,{signal:"height"},{signal:"width"});const g=s?{scale:s,range:0,mult:a,offset:f}:{value:0,offset:f};const b=s?{scale:s,range:1,mult:a,offset:f}:tn(m,{mult:a,offset:f});c.x=d.x=qJ(o,p,g);c.y=d.y=UJ(o,p,g);c.x2=d.x2=UJ(o,b);c.y2=d.y2=qJ(o,b);l.x=qJ(o,p);l.y=UJ(o,p);return jX({type:vX,role:$H,key:QY,from:i,encode:h},n)}function cQ(t,e){if(e===1);else if(!ye(t)){t=xV(e)?{signal:`(${e.signal}) * (${t||0})`}:e*(t||0)}else{let n=t=tn({},t);while(n.mult!=null){if(!ye(n.mult)){n.mult=xV(e)?{signal:`(${n.mult}) * (${e.signal})`}:n.mult*e;return t}else{n=n.mult=tn({},n.mult)}}n.mult=e}return t}function lQ(t,e,n,i,r,u){const o=xX(t,e),s=t.orient,a=RJ(s,-1,1);let f,c,l;const d={enter:f={opacity:pX},update:l={opacity:mX},exit:c={opacity:pX}};wH(d,{stroke:o("tickColor"),strokeCap:o("tickCap"),strokeDash:o("tickDash"),strokeDashOffset:o("tickDashOffset"),strokeOpacity:o("tickOpacity"),strokeWidth:o("tickWidth")});const h=vH(r);h.mult=a;const p={scale:t.scale,field:QY,band:u.band,extra:u.extra,offset:u.offset,round:o("tickRound")};l.y=f.y=qJ(s,pX,p);l.y2=f.y2=qJ(s,h);c.x=qJ(s,p);l.x=f.x=UJ(s,pX,p);l.x2=f.x2=UJ(s,h);c.y=UJ(s,p);return jX({type:vX,role:CH,key:QY,from:i,encode:d},n)}function dQ(t,e,n,i,r){return{signal:'flush(range("'+t+'"), '+'scale("'+t+'", datum.value), '+e+","+n+","+i+","+r+")"}}function hQ(t,e,n,i,r,u){const o=xX(t,e),s=t.orient,a=t.scale,f=RJ(s,-1,1),c=kV(o("labelFlush")),l=kV(o("labelFlushOffset")),d=o("labelAlign"),h=o("labelBaseline");let p=c===0||!!c,m;const g=vH(r);g.mult=f;g.offset=vH(o("labelPadding")||0);g.offset.mult=f;const b={scale:a,field:QY,band:.5,offset:$X(u.offset,o("labelOffset"))};const v=qJ(s,p?dQ(a,c,'"left"','"right"','"center"'):{value:"center"},GJ(s,"left","right"));const y=qJ(s,WJ(s,"bottom","top"),p?dQ(a,c,'"top"','"bottom"','"middle"'):{value:"middle"});const w=dQ(a,c,`-(${l})`,l,0);p=p&&l;const A={opacity:pX,x:qJ(s,b,g),y:UJ(s,b,g)};const x={enter:A,update:m={opacity:mX,text:{field:VY},x:A.x,y:A.y,align:v,baseline:y},exit:{opacity:pX,x:A.x,y:A.y}};wH(x,{dx:!d&&p?qJ(s,w):null,dy:!h&&p?UJ(s,w):null});wH(x,{angle:o("labelAngle"),fill:o("labelColor"),fillOpacity:o("labelOpacity"),font:o("labelFont"),fontSize:o("labelFontSize"),fontWeight:o("labelFontWeight"),fontStyle:o("labelFontStyle"),limit:o("labelLimit"),lineHeight:o("labelLineHeight")},{align:d,baseline:h});const O=o("labelBound");let F=o("labelOverlap");F=F||O?{separation:o("labelSeparation"),method:F,order:"datum.index",bound:O?{scale:a,orient:s,tolerance:O}:null}:undefined;if(m.align!==v){m.align=iQ(m.align,v)}if(m.baseline!==y){m.baseline=iQ(m.baseline,y)}return jX({type:wX,role:jH,style:ZY,key:QY,from:i,encode:x,overlap:F},n)}function pQ(t,e,n,i){const r=xX(t,e),u=t.orient,o=RJ(u,-1,1);let s,a;const f={enter:s={opacity:pX,anchor:vH(r("titleAnchor",null)),align:{signal:kX}},update:a=tn({},s,{opacity:mX,text:vH(t.title)}),exit:{opacity:pX}};const c={signal:`lerp(range("${t.scale}"), ${DX(0,1,.5)})`};a.x=qJ(u,c);a.y=UJ(u,c);s.angle=qJ(u,pX,nQ(o,90));s.baseline=qJ(u,WJ(u,IY,TY),{value:IY});a.angle=s.angle;a.baseline=s.baseline;wH(f,{fill:r("titleColor"),fillOpacity:r("titleOpacity"),font:r("titleFont"),fontSize:r("titleFontSize"),fontStyle:r("titleFontStyle"),fontWeight:r("titleFontWeight"),limit:r("titleLimit"),lineHeight:r("titleLineHeight")},{align:r("titleAlign"),angle:r("titleAngle"),baseline:r("titleBaseline")});mQ(r,u,f,n);f.update.align=iQ(f.update.align,s.align);f.update.angle=iQ(f.update.angle,s.angle);f.update.baseline=iQ(f.update.baseline,s.baseline);return jX({type:wX,role:MH,style:KY,from:i,encode:f},n)}function mQ(t,e,n,i){const r=(t,e)=>t!=null?(n.update[e]=iQ(vH(t),n.update[e]),false):!xH(e,i)?true:false;const u=r(t("titleX"),"x"),o=r(t("titleY"),"y");n.enter.auto=o===u?vH(o):qJ(e,vH(o),vH(u))}function gQ(t,e){const n=oQ(t,e),i=t.encode||{},r=i.axis||{},u=r.name||undefined,o=r.interactive,s=r.style,a=xX(t,n),f=EX(a);const c={scale:t.scale,ticks:!!a("ticks"),labels:!!a("labels"),grid:!!a("grid"),domain:!!a("domain"),title:t.title!=null};const l=lV(e.add(WV({},[c])));const d=lV(e.add(qV({scale:e.scaleRef(t.scale),extra:e.property(f.extra),count:e.objectProperty(t.tickCount),values:e.objectProperty(t.values),minstep:e.property(t.tickMinStep),formatType:e.property(t.formatType),formatSpecifier:e.property(t.format)})));const h=[];let p;if(c.grid){h.push(fQ(t,n,i.grid,d,f))}if(c.ticks){p=a("tickSize");h.push(lQ(t,n,i.ticks,d,p,f))}if(c.labels){p=c.ticks?p:0;h.push(hQ(t,n,i.labels,d,p,f))}if(c.domain){h.push(sQ(t,n,i.domain,l))}if(c.title){h.push(pQ(t,n,i.title,l))}return AJ(AX({role:kH,from:l,encode:AH(bQ(a,t),r,hX),marks:h,aria:a("aria"),description:a("description"),zindex:a("zindex"),name:u,interactive:o,style:s}),e)}function bQ(t,e){const n={enter:{},update:{}};wH(n,{orient:t("orient"),offset:t("offset")||0,position:DV(e.position,0),titlePadding:t("titlePadding"),minExtent:t("minExtent"),maxExtent:t("maxExtent"),range:{signal:`abs(span(range("${e.scale}")))`},translate:t("translate"),format:e.format,formatType:e.formatType});return n}function vQ(t,e,n){const i=Ue(t.signals),r=Ue(t.scales);if(!n)i.forEach((t=>sV(t,e)));Ue(t.projections).forEach((t=>NY(t,e)));r.forEach((t=>bY(t,e)));Ue(t.data).forEach((t=>zJ(t,e)));r.forEach((t=>vY(t,e)));(n||i).forEach((t=>LV(t,e)));Ue(t.axes).forEach((t=>gQ(t,e)));Ue(t.marks).forEach((t=>AJ(t,e)));Ue(t.legends).forEach((t=>OJ(t,e)));if(t.title)MJ(t.title,e);e.parseLambdas();return e}const yQ=t=>AH({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},t);function wQ(t,e){const n=e.config;const i=lV(e.root=e.add(cV()));const r=xQ(t,n);r.forEach((t=>sV(t,e)));e.description=t.description||n.description;e.eventConfig=n.events;e.legends=e.objectProperty(n.legend&&n.legend.layout);e.locale=n.locale;const u=e.add(WV());const o=e.add(VV(tV(yQ(t.encode),gX,FH,t.style,e,{pulse:lV(u)})));const s=e.add(hY({layout:e.objectProperty(t.layout),legends:e.legends,autosize:e.signalRef("autosize"),mark:i,pulse:lV(o)}));e.operators.pop();e.pushState(lV(o),lV(s),null);vQ(t,e,r);e.operators.push(s);let a=e.add(UV({mark:i,pulse:lV(s)}));a=e.add(fY({pulse:lV(a)}));a=e.add(lY({pulse:lV(a)}));e.addData("root",new pJ(e,u,u,a));return e}function AQ(t,e){return e&&e.signal?{name:t,update:e.signal}:{name:t,value:e}}function xQ(t,e){const n=n=>DV(t[n],e[n]),i=[AQ("background",n("background")),AQ("autosize",pH(n("autosize"))),AQ("padding",bH(n("padding"))),AQ("width",n("width")||0),AQ("height",n("height")||0)],r=i.reduce(((t,e)=>(t[e.name]=e,t)),{}),u={};Ue(t.signals).forEach((t=>{if(un(r,t.name)){t=tn(r[t.name],t)}else{i.push(t)}u[t.name]=t}));Ue(e.signals).forEach((t=>{if(!un(u,t.name)&&!un(r,t.name)){i.push(t)}}));return i}function OQ(t,e){this.config=t||{};this.options=e||{};this.bindings=[];this.field={};this.signals={};this.lambdas={};this.scales={};this.events={};this.data={};this.streams=[];this.updates=[];this.operators=[];this.eventConfig=null;this.locale=null;this._id=0;this._subid=0;this._nextsub=[0];this._parent=[];this._encode=[];this._lookup=[];this._markpath=[]}function FQ(t){this.config=t.config;this.options=t.options;this.legends=t.legends;this.field=Object.create(t.field);this.signals=Object.create(t.signals);this.lambdas=Object.create(t.lambdas);this.scales=Object.create(t.scales);this.events=Object.create(t.events);this.data=Object.create(t.data);this.streams=[];this.updates=[];this.operators=[];this._id=0;this._subid=++t._nextsub[0];this._nextsub=t._nextsub;this._parent=t._parent.slice();this._encode=t._encode.slice();this._lookup=t._lookup.slice();this._markpath=t._markpath}OQ.prototype=FQ.prototype={parse(t){return vQ(t,this)},fork(){return new FQ(this)},isSubscope(){return this._subid>0},toRuntime(){this.finish();return{description:this.description,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig,locale:this.locale}},id(){return(this._subid?this._subid+":":0)+this._id++},add(t){this.operators.push(t);t.id=this.id();if(t.refs){t.refs.forEach((e=>{e.$ref=t.id}));t.refs=null}return t},proxy(t){const e=t instanceof aV?lV(t):t;return this.add(sY({value:e}))},addStream(t){this.streams.push(t);t.id=this.id();return t},addUpdate(t){this.updates.push(t);return t},finish(){let t,e;if(this.root)this.root.root=true;for(t in this.signals){this.signals[t].signal=t}for(t in this.scales){this.scales[t].scale=t}function n(t,e,n){let i,r;if(t){i=t.data||(t.data={});r=i[e]||(i[e]=[]);r.push(n)}}for(t in this.data){e=this.data[t];n(e.input,t,"input");n(e.output,t,"output");n(e.values,t,"values");for(const i in e.index){n(e.index[i],t,"index:"+i)}}return this},pushState(t,e,n){this._encode.push(lV(this.add(lY({pulse:t}))));this._parent.push(e);this._lookup.push(n?lV(this.proxy(n)):null);this._markpath.push(-1)},popState(){this._encode.pop();this._parent.pop();this._lookup.pop();this._markpath.pop()},parent(){return Fe(this._parent)},encode(){return Fe(this._encode)},lookup(){return Fe(this._lookup)},markpath(){const t=this._markpath;return++t[t.length-1]},fieldRef(t,e){if(gn(t))return dV(t,e);if(!t.signal){ne("Unsupported field reference: "+Dn(t))}const n=t.signal;let i=this.field[n];if(!i){const t={name:this.signalRef(n)};if(e)t.as=e;this.field[n]=i=lV(this.add(JV(t)))}return i},compareRef(t){let e=false;const n=t=>xV(t)?(e=true,this.signalRef(t.signal)):OV(t)?(e=true,this.exprRef(t.expr)):t;const i=Ue(t.field).map(n),r=Ue(t.order).map(n);return e?lV(this.add(GV({fields:i,orders:r}))):pV(i,r)},keyRef(t,e){let n=false;const i=t=>xV(t)?(n=true,lV(r[t.signal])):t;const r=this.signals;t=Ue(t).map(i);return n?lV(this.add(QV({fields:t,flat:e}))):mV(t,e)},sortRef(t){if(!t)return t;const e=yV(t.op,t.field),n=t.order||gV;return n.signal?lV(this.add(GV({fields:e,orders:this.signalRef(n.signal)}))):pV(e,n)},event(t,e){const n=t+":"+e;if(!this.events[n]){const i=this.id();this.streams.push({id:i,source:t,type:e});this.events[n]=i}return this.events[n]},hasOwnSignal(t){return un(this.signals,t)},addSignal(t,e){if(this.hasOwnSignal(t)){ne("Duplicate signal name: "+Dn(t))}const n=e instanceof aV?e:this.add(cV(e));return this.signals[t]=n},getSignal(t){if(!this.signals[t]){ne("Unrecognized signal name: "+Dn(t))}return this.signals[t]},signalRef(t){if(this.signals[t]){return lV(this.signals[t])}else if(!un(this.lambdas,t)){this.lambdas[t]=this.add(cV(null))}return lV(this.lambdas[t])},parseLambdas(){const t=Object.keys(this.lambdas);for(let e=0,n=t.length;e<n;++e){const n=t[e],i=LU(n,this),r=this.lambdas[n];r.params=i.$params;r.update=i.$expr}},property(t){return t&&t.signal?this.signalRef(t.signal):t},objectProperty(t){return!t||!ye(t)?t:this.signalRef(t.signal||DQ(t))},exprRef(t,e){const n={expr:LU(t,this)};if(e)n.expr.$name=e;return lV(this.add(YV(n)))},addBinding(t,e){if(!this.bindings){ne("Nested signals do not support binding: "+Dn(t))}this.bindings.push(tn({signal:t},e))},addScaleProj(t,e){if(un(this.scales,t)){ne("Duplicate scale or projection name: "+Dn(t))}this.scales[t]=this.add(e)},addScale(t,e){this.addScaleProj(t,cY(e))},addProjection(t,e){this.addScaleProj(t,oY(e))},getScale(t){if(!this.scales[t]){ne("Unrecognized scale name: "+Dn(t))}return this.scales[t]},scaleRef(t){return lV(this.getScale(t))},scaleType(t){return this.getScale(t).params.type},projectionRef(t){return this.scaleRef(t)},projectionType(t){return this.scaleType(t)},addData(t,e){if(un(this.data,t)){ne("Duplicate data set name: "+Dn(t))}return this.data[t]=e},getData(t){if(!this.data[t]){ne("Undefined data set name: "+Dn(t))}return this.data[t]},addDataPipeline(t,e){if(un(this.data,t)){ne("Duplicate data set name: "+Dn(t))}return this.addData(t,pJ.fromEntries(this,e))}};function DQ(t){return(ve(t)?kQ:EQ)(t)}function kQ(t){const e=t.length;let n="[";for(let i=0;i<e;++i){const e=t[i];n+=(i>0?",":"")+(ye(e)?e.signal||DQ(e):Dn(e))}return n+"]"}function EQ(t){let e="{",n=0,i,r;for(i in t){r=t[i];e+=(++n>1?",":"")+Dn(i)+":"+(ye(r)?r.signal||DQ(r):Dn(r))}return e+"}"}function $Q(){const t="sans-serif",e=30,n=2,i="#4c78a8",r="#000",u="#888",o="#ddd";return{description:"Vega visualization",padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:i},area:{fill:i},image:null,line:{stroke:i,strokeWidth:n},path:{stroke:i},rect:{fill:i},rule:{stroke:r},shape:{stroke:i},symbol:{fill:i,size:64},text:{fill:r,font:t,fontSize:11},trail:{fill:i,size:n},style:{"guide-label":{fill:r,font:t,fontSize:10},"guide-title":{fill:r,font:t,fontSize:11,fontWeight:"bold"},"group-title":{fill:r,font:t,fontSize:13,fontWeight:"bold"},"group-subtitle":{fill:r,font:t,fontSize:12},point:{size:e,strokeWidth:n,shape:"circle"},circle:{size:e,strokeWidth:n},square:{size:e,strokeWidth:n,shape:"square"},cell:{fill:"transparent",stroke:o},view:{fill:"transparent"}},title:{orient:"top",anchor:"middle",offset:4,subtitlePadding:3},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:true,domainWidth:1,domainColor:u,grid:false,gridWidth:1,gridColor:o,labels:true,labelAngle:0,labelLimit:180,labelOffset:0,labelPadding:2,ticks:true,tickColor:u,tickOffset:0,tickRound:true,tickSize:5,tickWidth:1,titlePadding:4},axisBand:{tickOffset:-.5},projection:{type:"mercator"},legend:{orient:"right",padding:0,gridAlign:"each",columnPadding:10,rowPadding:2,symbolDirection:"vertical",gradientDirection:"vertical",gradientLength:200,gradientThickness:16,gradientStrokeColor:o,gradientStrokeWidth:0,gradientLabelOffset:2,labelAlign:"left",labelBaseline:"middle",labelLimit:160,labelOffset:4,labelOverlap:true,symbolLimit:30,symbolType:"circle",symbolSize:100,symbolOffset:0,symbolStrokeWidth:1.5,symbolBaseFillColor:"transparent",symbolBaseStrokeColor:u,titleLimit:180,titleOrient:"top",titlePadding:5,layout:{offset:18,direction:"horizontal",left:{direction:"vertical"},right:{direction:"vertical"}}},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues"},heatmap:{scheme:"yellowgreenblue"},ramp:{scheme:"blues"},diverging:{scheme:"blueorange",extent:[1,0]},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}function jQ(t,e,n){if(!ye(t)){ne("Input Vega specification must be an object.")}e=Ae($Q(),e,t.config);return wQ(t,new OQ(e,n)).toRuntime()}var CQ="5.23.0";tn(Kf,Zd,zD,Nk,EB,RB,jN,q_,NN,kz,Uz,nT);const MQ=Object.freeze({__proto__:null,version:CQ,Dataflow:Jf,EventStream:rf,MultiPulse:_f,Operator:Za,Parameters:Ha,Pulse:Cf,Transform:Zf,changeset:Wa,definition:tc,ingest:Pa,isTuple:Na,transform:ec,transforms:Kf,tupleid:za,interpolate:Zg,interpolateColors:Xg,interpolateRange:Yg,quantizeInterpolator:Jg,scale:Tg,scheme:ub,projection:SM,View:qG,defaultLocale:Xs,formatLocale:Is,locale:Ys,resetDefaultLocale:Js,timeFormatLocale:Hs,expressionFunction:PU,parse:jQ,runtimeContext:mW,codegenExpression:MR,parseExpression:ER,parseSelector:oH,Debug:ge,Error:he,Info:me,None:de,Warn:pe,accessor:Jt,accessorFields:Zt,accessorName:Qt,array:Ue,ascending:Ye,clampRange:We,compare:Ve,constant:Ze,debounce:Ke,error:ne,extend:tn,extent:en,extentIndex:nn,falsy:ce,fastmap:sn,field:re,flush:an,hasOwnProperty:un,id:ue,identity:oe,inherits:fn,inrange:cn,isArray:ve,isBoolean:ln,isDate:dn,isFunction:Ge,isIterable:hn,isNumber:pn,isObject:ye,isRegExp:mn,isString:gn,key:bn,lerp:vn,logger:be,lruCache:wn,merge:An,mergeConfig:Ae,one:ae,pad:On,panLinear:Be,panLog:Se,panPow:_e,panSymlog:Ne,peek:Fe,quarter:Re,repeat:xn,span:Fn,splitAccessPath:ie,stringValue:Dn,toBoolean:kn,toDate:$n,toNumber:De,toSet:Cn,toString:jn,truncate:Mn,truthy:fe,utcquarter:qe,visitArray:Bn,writeConfig:xe,zero:se,zoomLinear:Te,zoomLog:Pe,zoomPow:Le,zoomSymlog:Ie,bandwidthNRD:uc,bin:oc,bootstrapCI:fc,cumulativeLogNormal:kc,cumulativeNormal:yc,cumulativeUniform:Bc,densityLogNormal:Dc,densityNormal:vc,densityUniform:Mc,dotbin:cc,quantileLogNormal:Ec,quantileNormal:wc,quantileUniform:Sc,quantiles:ic,quartiles:rc,get random(){return sc},randomInteger:hc,randomKDE:Oc,randomLCG:dc,randomLogNormal:$c,randomMixture:jc,randomNormal:xc,randomUniform:_c,regressionExp:Rc,regressionLinear:Lc,regressionLoess:Xc,regressionLog:Ic,regressionPoly:Wc,regressionPow:qc,regressionQuad:Uc,sampleCurve:tl,sampleLogNormal:Fc,sampleNormal:bc,sampleUniform:Cc,setRandom:ac,DATE:Qr,DAY:Zr,DAYOFYEAR:Kr,HOURS:tu,MILLISECONDS:iu,MINUTES:eu,MONTH:Xr,QUARTER:Yr,SECONDS:nu,TIME_UNITS:ru,WEEK:Jr,YEAR:Vr,dayofyear:lu,timeBin:ro,timeFloor:$u,timeInterval:_u,timeOffset:Tu,timeSequence:Iu,timeUnitSpecifier:au,timeUnits:ou,utcFloor:Mu,utcInterval:Nu,utcOffset:Pu,utcSequence:Ru,utcdayofyear:bu,utcweek:vu,week:du,format:Da,formats:ka,inferType:ga,inferTypes:ba,loader:Ca,read:$a,responseType:Ea,typeParsers:ha,path:Q,Bounds:ay,CanvasHandler:$x,CanvasRenderer:Tx,Gradient:Lb,GroupItem:cy,Handler:ix,Item:fy,Marks:IA,RenderType:UO,Renderer:ux,ResourceLoader:ly,SVGHandler:Rx,SVGRenderer:wO,SVGStringRenderer:TO,Scenegraph:YA,boundClip:ZO,boundContext:Sy,boundItem:RA,boundMark:UA,boundStroke:py,domChild:ZA,domClear:KA,domCreate:JA,domFind:QA,font:$A,fontFamily:EA,fontSize:yA,intersect:HO,intersectBoxLine:Wy,intersectPath:Iy,intersectPoint:Ry,intersectRule:Uy,lineHeight:wA,markup:lO,multiLineOffset:OA,pathCurves:Rb,pathEqual:eF,pathParse:Vb,pathRectangle:Av,pathRender:sv,pathSymbols:lv,pathTrail:xv,point:ex,renderModule:GO,resetSVGClipId:oy,resetSVGDefIds:iF,sceneEqual:tF,sceneFromJSON:HA,scenePickVisit:nw,sceneToJSON:GA,sceneVisit:ew,sceneZOrder:tw,serializeXML:dO,textMetrics:hA});function BQ(t,e,n){let i;if(e.x2){if(e.x){if(n&&t.x>t.x2){i=t.x;t.x=t.x2;t.x2=i}t.width=t.x2-t.x}else{t.x=t.x2-(t.width||0)}}if(e.xc){t.x=t.xc-(t.width||0)/2}if(e.y2){if(e.y){if(n&&t.y>t.y2){i=t.y;t.y=t.y2;t.y2=i}t.height=t.y2-t.y}else{t.y=t.y2-(t.height||0)}}if(e.yc){t.y=t.yc-(t.height||0)/2}}var SQ={NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE};var _Q={"*":(t,e)=>t*e,"+":(t,e)=>t+e,"-":(t,e)=>t-e,"/":(t,e)=>t/e,"%":(t,e)=>t%e,">":(t,e)=>t>e,"<":(t,e)=>t<e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e,"==":(t,e)=>t==e,"!=":(t,e)=>t!=e,"===":(t,e)=>t===e,"!==":(t,e)=>t!==e,"&":(t,e)=>t&e,"|":(t,e)=>t|e,"^":(t,e)=>t^e,"<<":(t,e)=>t<<e,">>":(t,e)=>t>>e,">>>":(t,e)=>t>>>e};var NQ={"+":t=>+t,"-":t=>-t,"~":t=>~t,"!":t=>!t};const zQ=Array.prototype.slice;const TQ=(t,e,n)=>{const i=n?n(e[0]):e[0];return i[t].apply(i,zQ.call(e,1))};const PQ=(t,e,n,i,r,u,o)=>new Date(t,e||0,n!=null?n:1,i||0,r||0,u||0,o||0);var LQ={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(t,e,n)=>Math.max(e,Math.min(n,t)),now:Date.now,utc:Date.UTC,datetime:PQ,date:t=>new Date(t).getDate(),day:t=>new Date(t).getDay(),year:t=>new Date(t).getFullYear(),month:t=>new Date(t).getMonth(),hours:t=>new Date(t).getHours(),minutes:t=>new Date(t).getMinutes(),seconds:t=>new Date(t).getSeconds(),milliseconds:t=>new Date(t).getMilliseconds(),time:t=>new Date(t).getTime(),timezoneoffset:t=>new Date(t).getTimezoneOffset(),utcdate:t=>new Date(t).getUTCDate(),utcday:t=>new Date(t).getUTCDay(),utcyear:t=>new Date(t).getUTCFullYear(),utcmonth:t=>new Date(t).getUTCMonth(),utchours:t=>new Date(t).getUTCHours(),utcminutes:t=>new Date(t).getUTCMinutes(),utcseconds:t=>new Date(t).getUTCSeconds(),utcmilliseconds:t=>new Date(t).getUTCMilliseconds(),length:t=>t.length,join:function(){return TQ("join",arguments)},indexof:function(){return TQ("indexOf",arguments)},lastindexof:function(){return TQ("lastIndexOf",arguments)},slice:function(){return TQ("slice",arguments)},reverse:t=>t.slice().reverse(),parseFloat,parseInt,upper:t=>String(t).toUpperCase(),lower:t=>String(t).toLowerCase(),substring:function(){return TQ("substring",arguments,String)},split:function(){return TQ("split",arguments,String)},replace:function(){return TQ("replace",arguments,String)},trim:t=>String(t).trim(),regexp:RegExp,test:(t,e)=>RegExp(t).test(e)};const IQ=["view","item","group","xy","x","y"];const RQ={Literal:(t,e)=>e.value,Identifier:(t,e)=>{const n=e.name;return t.memberDepth>0?n:n==="datum"?t.datum:n==="event"?t.event:n==="item"?t.item:SQ[n]||t.params["$"+n]},MemberExpression:(t,e)=>{const n=!e.computed,i=t(e.object);if(n)t.memberDepth+=1;const r=t(e.property);if(n)t.memberDepth-=1;return i[r]},CallExpression:(t,e)=>{const n=e.arguments;let i=e.callee.name;if(i.startsWith("_")){i=i.slice(1)}return i==="if"?t(n[0])?t(n[1]):t(n[2]):(t.fn[i]||LQ[i]).apply(t.fn,n.map(t))},ArrayExpression:(t,e)=>e.elements.map(t),BinaryExpression:(t,e)=>_Q[e.operator](t(e.left),t(e.right)),UnaryExpression:(t,e)=>NQ[e.operator](t(e.argument)),ConditionalExpression:(t,e)=>t(e.test)?t(e.consequent):t(e.alternate),LogicalExpression:(t,e)=>e.operator==="&&"?t(e.left)&&t(e.right):t(e.left)||t(e.right),ObjectExpression:(t,e)=>e.properties.reduce(((e,n)=>{t.memberDepth+=1;const i=t(n.key);t.memberDepth-=1;e[i]=t(n.value);return e}),{})};function qQ(t,e,n,i,r,u){const o=t=>RQ[t.type](o,t);o.memberDepth=0;o.fn=Object.create(e);o.params=n;o.datum=i;o.event=r;o.item=u;IQ.forEach((t=>o.fn[t]=(...e)=>r.vega[t](...e)));return o(t)}var UQ={operator(t,e){const n=e.ast,i=t.functions;return t=>qQ(n,i,t)},parameter(t,e){const n=e.ast,i=t.functions;return(t,e)=>qQ(n,i,e,t)},event(t,e){const n=e.ast,i=t.functions;return t=>qQ(n,i,undefined,undefined,t)},handler(t,e){const n=e.ast,i=t.functions;return(t,e)=>{const r=e.item&&e.item.datum;return qQ(n,i,t,r,e)}},encode(t,e){const{marktype:n,channels:i}=e,r=t.functions,u=n==="group"||n==="image"||n==="rect";return(t,e)=>{const o=t.datum;let s=0,a;for(const n in i){a=qQ(i[n].ast,r,e,o,undefined,t);if(t[n]!==a){t[n]=a;s=1}}if(n!=="rule"){BQ(t,i,u)}return s}}};const WQ="vega-lite";const GQ='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer';const HQ="5.2.0";const VQ=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"];const YQ="https://vega.github.io/vega-lite/";const XQ="Vega-Lite is a concise high-level language for interactive visualization.";const JQ="build/vega-lite.js";const QQ="build/vega-lite.min.js";const ZQ="build/vega-lite.min.js";const KQ="build/src/index";const tZ="build/src/index.d.ts";const eZ={vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2pdf:"./bin/vl2pdf",vl2vg:"./bin/vl2vg"};const nZ={test:"test"};const iZ=["bin","build","src","vega-lite*","tsconfig.json"];const rZ={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.js","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json","predeploy:site":"yarn presite","deploy:site":"gh-pages -d site",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",eslintbase:"eslint .",format:"yarn eslintbase --fix && yarn prettierbase --write",lint:"yarn eslintbase && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/"};const uZ={type:"git",url:"https://github.com/vega/vega-lite.git"};const oZ="BSD-3-Clause";const sZ={url:"https://github.com/vega/vega-lite/issues"};const aZ={"@babel/core":"^7.16.0","@babel/preset-env":"^7.16.0","@babel/preset-typescript":"^7.16.0","@rollup/plugin-alias":"^3.1.8","@rollup/plugin-babel":"^5.3.0","@rollup/plugin-commonjs":"^21.0.1","@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^13.0.6","@types/chai":"^4.2.22","@types/d3":"^7.1.0","@types/jest":"^27.0.2","@types/mkdirp":"^1.0.2","@types/pako":"^1.0.2","@typescript-eslint/eslint-plugin":"^5.4.0","@typescript-eslint/parser":"^5.4.0",ajv:"^8.8.0","ajv-formats":"^2.1.1",chai:"^4.3.4",cheerio:"^1.0.0-rc.10","conventional-changelog-cli":"^2.1.1",d3:"^7.1.1","del-cli":"^4.0.1",eslint:"^8.2.0","eslint-config-prettier":"^8.3.0","eslint-plugin-jest":"^25.2.4","eslint-plugin-prettier":"^4.0.0","gh-pages":"^3.2.3","highlight.js":"^11.3.1",jest:"^27.3.1","jest-dev-server":"^6.0.0",mkdirp:"^1.0.4",pako:"^2.0.4",prettier:"^2.4.1",puppeteer:"^11.0.0",rollup:"^2.60.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3","rollup-plugin-terser":"^7.0.2",serve:"^13.0.2",terser:"^5.10.0","ts-jest":"^27.0.7","ts-json-schema-generator":"^0.97.0",typescript:"~4.5.2","vega-cli":"^5.21.0","vega-datasets":"~2.2.0","vega-embed":"^6.20.2","vega-tooltip":"^0.27.0","yaml-front-matter":"^4.1.1"};const fZ={"@types/clone":"~2.1.1","array-flat-polyfill":"^1.0.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.3.1","vega-event-selector":"~3.0.0","vega-expression":"~5.0.0","vega-util":"~1.17.0",yargs:"~17.2.1"};const cZ={vega:"^5.21.0"};const lZ={node:">=12"};const dZ={name:WQ,author:GQ,version:HQ,collaborators:VQ,homepage:YQ,description:XQ,main:JQ,unpkg:QQ,jsdelivr:ZQ,module:KQ,types:tZ,bin:eZ,directories:nZ,files:iZ,scripts:rZ,repository:uZ,license:oZ,bugs:sZ,devDependencies:aZ,dependencies:fZ,peerDependencies:cZ,engines:lZ};Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(n,i){return Array.isArray(i)?n.push.apply(n,t.call(i,e-1)):n.push(i),n}),[]):Array.prototype.slice.call(this)},writable:!0}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,value:function(t){return Array.prototype.map.apply(this,arguments).flat()},writable:!0});var hZ=ct((function(t){var e=function(){function t(t,e){return e!=null&&t instanceof e}var e;try{e=Map}catch(c){e=function(){}}var n;try{n=Set}catch(c){n=function(){}}var i;try{i=Promise}catch(c){i=function(){}}function r(u,o,s,a,c){if(typeof o==="object"){s=o.depth;a=o.prototype;c=o.includeNonEnumerable;o=o.circular}var l=[];var d=[];var h=typeof Buffer!="undefined";if(typeof o=="undefined")o=true;if(typeof s=="undefined")s=Infinity;function p(u,s){if(u===null)return null;if(s===0)return u;var m;var g;if(typeof u!="object"){return u}if(t(u,e)){m=new e}else if(t(u,n)){m=new n}else if(t(u,i)){m=new i((function(t,e){u.then((function(e){t(p(e,s-1))}),(function(t){e(p(t,s-1))}))}))}else if(r.__isArray(u)){m=[]}else if(r.__isRegExp(u)){m=new RegExp(u.source,f(u));if(u.lastIndex)m.lastIndex=u.lastIndex}else if(r.__isDate(u)){m=new Date(u.getTime())}else if(h&&Buffer.isBuffer(u)){if(Buffer.allocUnsafe){m=Buffer.allocUnsafe(u.length)}else{m=new Buffer(u.length)}u.copy(m);return m}else if(t(u,Error)){m=Object.create(u)}else{if(typeof a=="undefined"){g=Object.getPrototypeOf(u);m=Object.create(g)}else{m=Object.create(a);g=a}}if(o){var b=l.indexOf(u);if(b!=-1){return d[b]}l.push(u);d.push(m)}if(t(u,e)){u.forEach((function(t,e){var n=p(e,s-1);var i=p(t,s-1);m.set(n,i)}))}if(t(u,n)){u.forEach((function(t){var e=p(t,s-1);m.add(e)}))}for(var v in u){var y;if(g){y=Object.getOwnPropertyDescriptor(g,v)}if(y&&y.set==null){continue}m[v]=p(u[v],s-1)}if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(u);for(var v=0;v<w.length;v++){var A=w[v];var x=Object.getOwnPropertyDescriptor(u,A);if(x&&!x.enumerable&&!c){continue}m[A]=p(u[A],s-1);if(!x.enumerable){Object.defineProperty(m,A,{enumerable:false})}}}if(c){var O=Object.getOwnPropertyNames(u);for(var v=0;v<O.length;v++){var F=O[v];var x=Object.getOwnPropertyDescriptor(u,F);if(x&&x.enumerable){continue}m[F]=p(u[F],s-1);Object.defineProperty(m,F,{enumerable:false})}}return m}return p(u,s)}r.clonePrototype=function t(e){if(e===null)return null;var n=function(){};n.prototype=e;return new n};function u(t){return Object.prototype.toString.call(t)}r.__objToStr=u;function o(t){return typeof t==="object"&&u(t)==="[object Date]"}r.__isDate=o;function s(t){return typeof t==="object"&&u(t)==="[object Array]"}r.__isArray=s;function a(t){return typeof t==="object"&&u(t)==="[object RegExp]"}r.__isRegExp=a;function f(t){var e="";if(t.global)e+="g";if(t.ignoreCase)e+="i";if(t.multiline)e+="m";return e}r.__getRegExpFlags=f;return r}();if(t.exports){t.exports=e}}));var pZ=function t(e,n){if(e===n)return true;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return false;var i,r,u;if(Array.isArray(e)){i=e.length;if(i!=n.length)return false;for(r=i;r--!==0;)if(!t(e[r],n[r]))return false;return true}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();u=Object.keys(e);i=u.length;if(i!==Object.keys(n).length)return false;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,u[r]))return false;for(r=i;r--!==0;){var o=u[r];if(!t(e[o],n[o]))return false}return true}return e!==e&&n!==n};var mZ=function(t,e){if(!e)e={};if(typeof e==="function")e={cmp:e};var n=typeof e.cycles==="boolean"?e.cycles:false;var i=e.cmp&&function(t){return function(e){return function(n,i){var r={key:n,value:e[n]};var u={key:i,value:e[i]};return t(r,u)}}}(e.cmp);var r=[];return function t(e){if(e&&e.toJSON&&typeof e.toJSON==="function"){e=e.toJSON()}if(e===undefined)return;if(typeof e=="number")return isFinite(e)?""+e:"null";if(typeof e!=="object")return JSON.stringify(e);var u,o;if(Array.isArray(e)){o="[";for(u=0;u<e.length;u++){if(u)o+=",";o+=t(e[u])||"null"}return o+"]"}if(e===null)return"null";if(r.indexOf(e)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var s=r.push(e)-1;var a=Object.keys(e).sort(i&&i(e));o="";for(u=0;u<a.length;u++){var f=a[u];var c=t(e[f]);if(!c)continue;if(o)o+=",";o+=JSON.stringify(f)+":"+c}r.splice(s,1);return"{"+o+"}"}(t)};function gZ(t){return!!t.or}function bZ(t){return!!t.and}function vZ(t){return!!t.not}function yZ(t,e){if(vZ(t)){yZ(t.not,e)}else if(bZ(t)){for(const n of t.and){yZ(n,e)}}else if(gZ(t)){for(const n of t.or){yZ(n,e)}}else{e(t)}}function wZ(t,e){if(vZ(t)){return{not:wZ(t.not,e)}}else if(bZ(t)){return{and:t.and.map((t=>wZ(t,e)))}}else if(gZ(t)){return{or:t.or.map((t=>wZ(t,e)))}}else{return e(t)}}const AZ=pZ;const xZ=hZ;function OZ(t){throw new Error(t)}function FZ(t,e){const n={};for(const i of e){if(un(t,i)){n[i]=t[i]}}return n}function DZ(t,e){const n=Object.assign({},t);for(const i of e){delete n[i]}return n}Set.prototype["toJSON"]=function(){return`Set(${[...this].map((t=>mZ(t))).join(",")})`};const kZ=mZ;function EZ(t){if(pn(t)){return t}const e=gn(t)?t:mZ(t);if(e.length<250){return e}let n=0;for(let i=0;i<e.length;i++){const t=e.charCodeAt(i);n=(n<<5)-n+t;n=n&n}return n}function $Z(t){return t===false||t===null}function jZ(t,e){return t.includes(e)}function CZ(t,e){let n=0;for(const[i,r]of t.entries()){if(e(r,i,n++)){return true}}return false}function MZ(t,e){let n=0;for(const[i,r]of t.entries()){if(!e(r,i,n++)){return false}}return true}function BZ(t,...e){for(const n of e){SZ(t,n!==null&&n!==void 0?n:{})}return t}function SZ(t,e){for(const n of RZ(e)){xe(t,n,e[n],true)}}function _Z(t,e){const n=[];const i={};let r;for(const u of t){r=e(u);if(r in i){continue}i[r]=1;n.push(u)}return n}function NZ(t,e){const n=RZ(t);const i=RZ(e);if(n.length!==i.length){return false}for(const r of n){if(t[r]!==e[r]){return false}}return true}function zZ(t,e){if(t.size!==e.size){return false}for(const n of t){if(!e.has(n)){return false}}return true}function TZ(t,e){for(const n of t){if(e.has(n)){return true}}return false}function PZ(t){const e=new Set;for(const n of t){const t=ie(n);const i=t.map(((t,e)=>e===0?t:`[${t}]`));const r=i.map(((t,e)=>i.slice(0,e+1).join("")));for(const n of r){e.add(n)}}return e}function LZ(t,e){if(t===undefined||e===undefined){return true}return TZ(PZ(t),PZ(e))}function IZ(t){return RZ(t).length===0}const RZ=Object.keys;const qZ=Object.values;const UZ=Object.entries;function WZ(t){return t===true||t===false}function GZ(t){const e=t.replace(/\W/g,"_");return(t.match(/^\d+/)?"_":"")+e}function HZ(t,e){if(vZ(t)){return`!(${HZ(t.not,e)})`}else if(bZ(t)){return`(${t.and.map((t=>HZ(t,e))).join(") && (")})`}else if(gZ(t)){return`(${t.or.map((t=>HZ(t,e))).join(") || (")})`}else{return e(t)}}function VZ(t,e){if(e.length===0){return true}const n=e.shift();if(n in t&&VZ(t[n],e)){delete t[n]}return IZ(t)}function YZ(t){return t.charAt(0).toUpperCase()+t.substr(1)}function XZ(t,e="datum"){const n=ie(t);const i=[];for(let r=1;r<=n.length;r++){const t=`[${n.slice(0,r).map(Dn).join("][")}]`;i.push(`${e}${t}`)}return i.join(" && ")}function JZ(t,e="datum"){return`${e}[${Dn(ie(t).join("."))}]`}function QZ(t){return t.replace(/(\[|\]|\.|'|")/g,"\\$1")}function ZZ(t){return`${ie(t).map(QZ).join("\\.")}`}function KZ(t,e,n){return t.replace(new RegExp(e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function tK(t){return`${ie(t).join(".")}`}function eK(t){if(!t){return 0}return ie(t).length}function nK(...t){for(const e of t){if(e!==undefined){return e}}return undefined}let iK=42;function rK(t){const e=++iK;return t?String(t)+e:e}function uK(){iK=42}function oK(t){return sK(t)?t:`__${t}`}function sK(t){return t.startsWith("__")}function aK(t){if(t===undefined){return undefined}return(t%360+360)%360}function fK(t){if(pn(t)){return true}return!isNaN(t)&&!isNaN(parseFloat(t))}var cK=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const lK="row";const dK="column";const hK="facet";const pK="x";const mK="y";const gK="x2";const bK="y2";const vK="xOffset";const yK="yOffset";const wK="radius";const AK="radius2";const xK="theta";const OK="theta2";const FK="latitude";const DK="longitude";const kK="latitude2";const EK="longitude2";const $K="color";const jK="fill";const CK="stroke";const MK="shape";const BK="size";const SK="angle";const _K="opacity";const NK="fillOpacity";const zK="strokeOpacity";const TK="strokeWidth";const PK="strokeDash";const LK="text";const IK="order";const RK="detail";const qK="key";const UK="tooltip";const WK="href";const GK="url";const HK="description";const VK={x:1,y:1,x2:1,y2:1};const YK={theta:1,theta2:1,radius:1,radius2:1};function XK(t){return t in YK}const JK={longitude:1,longitude2:1,latitude:1,latitude2:1};function QK(t){switch(t){case FK:return"y";case kK:return"y2";case DK:return"x";case EK:return"x2"}}function ZK(t){return t in JK}const KK=RZ(JK);const t0=Object.assign(Object.assign(Object.assign(Object.assign({},VK),YK),JK),{xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1});function e0(t){return t===$K||t===jK||t===CK}const n0={row:1,column:1,facet:1};const i0=RZ(n0);const r0=Object.assign(Object.assign({},t0),n0);const u0=RZ(r0);const o0=cK(r0,["order","detail","tooltip"]);const s0=cK(o0,["row","column","facet"]);function a0(t){return!!s0[t]}function f0(t){return!!r0[t]}const c0=[gK,bK,kK,EK,OK,AK];function l0(t){const e=d0(t);return e!==t}function d0(t){switch(t){case gK:return pK;case bK:return mK;case kK:return FK;case EK:return DK;case OK:return xK;case AK:return wK}return t}function h0(t){if(XK(t)){switch(t){case xK:return"startAngle";case OK:return"endAngle";case wK:return"outerRadius";case AK:return"innerRadius"}}return t}function p0(t){switch(t){case pK:return gK;case mK:return bK;case FK:return kK;case DK:return EK;case xK:return OK;case wK:return AK}return undefined}function m0(t){switch(t){case pK:case gK:return"width";case mK:case bK:return"height"}return undefined}function g0(t){switch(t){case pK:return"xOffset";case mK:return"yOffset";case gK:return"x2Offset";case bK:return"y2Offset";case xK:return"thetaOffset";case wK:return"radiusOffset";case OK:return"theta2Offset";case AK:return"radius2Offset"}return undefined}function b0(t){switch(t){case pK:return"xOffset";case mK:return"yOffset"}return undefined}function v0(t){switch(t){case"xOffset":return"x";case"yOffset":return"y"}}const y0=RZ(t0);const w0=cK(t0,["x","y","x2","y2","xOffset","yOffset","latitude","longitude","latitude2","longitude2","theta","theta2","radius","radius2"]);const A0=RZ(w0);const x0={x:1,y:1};const O0=RZ(x0);function F0(t){return t in x0}const D0={theta:1,radius:1};const k0=RZ(D0);function E0(t){return t==="width"?pK:mK}const $0={xOffset:1,yOffset:1};function j0(t){return t in $0}const C0=cK(w0,["text","tooltip","href","url","description","detail","key","order"]);const M0=RZ(C0);function B0(t){return!!w0[t]}function S0(t){switch(t){case $K:case jK:case CK:case BK:case MK:case _K:case TK:case PK:return true;case NK:case zK:case SK:return false}}const _0=Object.assign(Object.assign(Object.assign(Object.assign({},x0),D0),$0),C0);const N0=RZ(_0);function z0(t){return!!_0[t]}function T0(t,e){return I0(t)[e]}const P0={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"};const L0=cK(P0,["geoshape"]);function I0(t){switch(t){case $K:case jK:case CK:case HK:case RK:case qK:case UK:case WK:case IK:case _K:case NK:case zK:case TK:case hK:case lK:case dK:return P0;case pK:case mK:case vK:case yK:case FK:case DK:return L0;case gK:case bK:case kK:case EK:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case BK:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case PK:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case MK:return{point:"always",geoshape:"always"};case LK:return{text:"always"};case SK:return{point:"always",square:"always",text:"always"};case GK:return{image:"always"};case xK:return{text:"always",arc:"always"};case wK:return{text:"always",arc:"always"};case OK:case AK:return{arc:"always"}}}function R0(t){switch(t){case pK:case mK:case xK:case wK:case vK:case yK:case BK:case SK:case TK:case _K:case NK:case zK:case gK:case bK:case OK:case AK:return undefined;case hK:case lK:case dK:case MK:case PK:case LK:case UK:case WK:case GK:case HK:return"discrete";case $K:case jK:case CK:return"flexible";case FK:case DK:case kK:case EK:case RK:case qK:case IK:return undefined}}const q0={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1};const U0={count:1,min:1,max:1};function W0(t){return!!t&&!!t["argmin"]}function G0(t){return!!t&&!!t["argmax"]}function H0(t){return gn(t)&&!!q0[t]}const V0=new Set(["count","valid","missing","distinct"]);function Y0(t){return gn(t)&&V0.has(t)}function X0(t){return gn(t)&&jZ(["min","max"],t)}const J0=new Set(["count","sum","distinct","valid","missing"]);const Q0=new Set(["mean","average","median","q1","q3","min","max"]);function Z0(t){if(ln(t)){t=q8(t,undefined)}return"bin"+RZ(t).map((e=>n1(t[e])?GZ(`_${e}_${UZ(t[e])}`):GZ(`_${e}_${t[e]}`))).join("")}function K0(t){return t===true||e1(t)&&!t.binned}function t1(t){return t==="binned"||e1(t)&&t.binned===true}function e1(t){return ye(t)}function n1(t){return t===null||t===void 0?void 0:t["param"]}function i1(t){switch(t){case lK:case dK:case BK:case $K:case jK:case CK:case TK:case _K:case NK:case zK:case MK:return 6;case PK:return 4;default:return 10}}function r1(t){return t&&!!t["expr"]}function u1(t){const e=RZ(t||{});const n={};for(const i of e){n[i]=w1(t[i])}return n}var o1=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function s1(t){const{anchor:e,frame:n,offset:i,orient:r,angle:u,limit:o,color:s,subtitleColor:a,subtitleFont:f,subtitleFontSize:c,subtitleFontStyle:l,subtitleFontWeight:d,subtitleLineHeight:h,subtitlePadding:p}=t,m=o1(t,["anchor","frame","offset","orient","angle","limit","color","subtitleColor","subtitleFont","subtitleFontSize","subtitleFontStyle","subtitleFontWeight","subtitleLineHeight","subtitlePadding"]);const g=Object.assign(Object.assign({},m),s?{fill:s}:{});const b=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e?{anchor:e}:{}),n?{frame:n}:{}),i?{offset:i}:{}),r?{orient:r}:{}),u!==undefined?{angle:u}:{}),o!==undefined?{limit:o}:{});const v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a?{subtitleColor:a}:{}),f?{subtitleFont:f}:{}),c?{subtitleFontSize:c}:{}),l?{subtitleFontStyle:l}:{}),d?{subtitleFontWeight:d}:{}),h?{subtitleLineHeight:h}:{}),p?{subtitlePadding:p}:{});const y=FZ(t,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:g,subtitleMarkConfig:y,nonMarkTitleProperties:b,subtitle:v}}function a1(t){return gn(t)||ve(t)&&gn(t[0])}function f1(t){return t&&!!t["signal"]}function c1(t){return!!t["step"]}function l1(t){if(!ve(t)){return"fields"in t&&!("data"in t)}return false}function d1(t){if(!ve(t)){return"fields"in t&&"data"in t}return false}function h1(t){if(!ve(t)){return"field"in t&&"data"in t}return false}const p1={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1};const m1=RZ(p1);const g1={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1};const b1=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];var v1=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function y1(t){const e=ve(t.condition)?t.condition.map(A1):A1(t.condition);return Object.assign(Object.assign({},w1(t)),{condition:e})}function w1(t){if(r1(t)){const{expr:e}=t,n=v1(t,["expr"]);return Object.assign({signal:e},n)}return t}function A1(t){if(r1(t)){const{expr:e}=t,n=v1(t,["expr"]);return Object.assign({signal:e},n)}return t}function x1(t){if(r1(t)){const{expr:e}=t,n=v1(t,["expr"]);return Object.assign({signal:e},n)}if(f1(t)){return t}return t!==undefined?{value:t}:undefined}function O1(t){if(f1(t)){return t.signal}return Dn(t)}function F1(t){if(f1(t)){return t.signal}return Dn(t.value)}function D1(t){if(f1(t)){return t.signal}return t==null?null:Dn(t)}function k1(t,e,n){for(const i of n){const n=j1(i,e.markDef,e.config);if(n!==undefined){t[i]=x1(n)}}return t}function E1(t){var e;return[].concat(t.type,(e=t.style)!==null&&e!==void 0?e:[])}function $1(t,e,n,i={}){const{vgChannel:r,ignoreVgConfig:u}=i;if(r&&e[r]!==undefined){return e[r]}else if(e[t]!==undefined){return e[t]}else if(u&&(!r||r===t)){return undefined}return j1(t,e,n,i)}function j1(t,e,n,{vgChannel:i}={}){return nK(i?C1(t,e,n.style):undefined,C1(t,e,n.style),i?n[e.type][i]:undefined,n[e.type][t],i?n.mark[i]:n.mark[t])}function C1(t,e,n){return M1(t,E1(e),n)}function M1(t,e,n){e=Ue(e);let i;for(const r of e){const e=n[r];if(e&&e[t]!==undefined){i=e[t]}}return i}function B1(t,e){return Ue(t).reduce(((t,n)=>{var i;t.field.push(A8(n,e));t.order.push((i=n.sort)!==null&&i!==void 0?i:"ascending");return t}),{field:[],order:[]})}function S1(t,e){const n=[...t];e.forEach((t=>{for(const e of n){if(AZ(e,t)){return}}n.push(t)}));return n}function _1(t,e){if(AZ(t,e)||!e){return t}else if(!t){return e}else{return[...Ue(t),...Ue(e)].join(", ")}}function N1(t,e){const n=t.value;const i=e.value;if(n==null||i===null){return{explicit:t.explicit,value:null}}else if((a1(n)||f1(n))&&(a1(i)||f1(i))){return{explicit:t.explicit,value:_1(n,i)}}else if(a1(n)||f1(n)){return{explicit:t.explicit,value:n}}else if(a1(i)||f1(i)){return{explicit:t.explicit,value:i}}else if(!a1(n)&&!f1(n)&&!a1(i)&&!f1(i)){return{explicit:t.explicit,value:S1(n,i)}}throw new Error("It should never reach here")}function z1(t){return`Invalid specification ${kZ(t)}. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".`}const T1='Autosize "fit" only works for single views and layered views.';function P1(t){const e=t=="width"?"Width":"Height";return`${e} "container" only works for single views and layered views.`}function L1(t){const e=t=="width"?"Width":"Height";const n=t=="width"?"x":"y";return`${e} "container" only works well with autosize "fit" or "fit-${n}".`}function I1(t){return t?`Dropping "fit-${t}" because spec has discrete ${m0(t)}.`:`Dropping "fit" because spec has discrete size.`}function R1(t){return`Unknown field for ${t}. Cannot calculate view size.`}function q1(t){return`Cannot project a selection on encoding channel "${t}", which has no field.`}function U1(t,e){return`Cannot project a selection on encoding channel "${t}" as it uses an aggregate function ("${e}").`}function W1(t){return`The "nearest" transform is not supported for ${t} marks.`}function G1(t){return`Selection not supported for ${t} yet.`}function H1(t){return`Cannot find a selection named "${t}".`}const V1="Scale bindings are currently only supported for scales with unbinned, continuous domains.";const Y1="Legend bindings are only supported for selections over an individual field or encoding channel.";function X1(t){return`Lookups can only be performed on selection parameters. "${t}" is a variable parameter.`}function J1(t){return`Cannot define and lookup the "${t}" selection in the same view. `+`Try moving the lookup into a second, layered view?`}const Q1="The same selection must be used to override scale domains in a layered view.";const Z1='Interval selections should be initialized using "x" and/or "y" keys.';function K1(t){return`Unknown repeated value "${t}".`}function t2(t){return`The "columns" property cannot be used when "${t}" has nested row/column.`}const e2="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function n2(t){return`Unrecognized parse "${t}".`}function i2(t,e,n){return`An ancestor parsed field "${t}" as ${n} but a child wants to parse the field as ${e}.`}const r2="Attempt to add the same child twice.";function u2(t){return`Ignoring an invalid transform: ${kZ(t)}.`}const o2='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function s2(t){return`Config.customFormatTypes is not true, thus custom format type and format for channel ${t} are dropped.`}function a2(t){const{parentProjection:e,projection:n}=t;return`Layer's shared projection ${kZ(e)} is overridden by a child projection ${kZ(n)}.`}const f2="Arc marks uses theta channel rather than angle, replacing angle with theta.";function c2(t){return`${t}Offset dropped because ${t} is continuous`}function l2(t){return`There is no ${t} encoding. Replacing ${t}Offset encoding as ${t}.`}function d2(t,e,n){return`Channel ${t} is a ${e}. Converted to {value: ${kZ(n)}}.`}function h2(t){return`Invalid field type "${t}".`}function p2(t,e){return`Invalid field type "${t}" for aggregate: "${e}", using "quantitative" instead.`}function m2(t){return`Invalid aggregation operator "${t}".`}function g2(t,e){const{fill:n,stroke:i}=e;return`Dropping color ${t} as the plot also has ${n&&i?"fill and stroke":n?"fill":"stroke"}.`}function b2(t){return`Position range does not support relative band size for ${t}.`}function v2(t,e){return`Dropping ${kZ(t)} from channel "${e}" since it does not contain any data field, datum, value, or signal.`}const y2="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function w2(t,e,n){return`${t} dropped as it is incompatible with "${e}"${n?` when ${n}`:""}.`}function A2(t){return`${t} encoding has no scale, so specified scale is ignored.`}function x2(t){return`${t}-encoding is dropped as ${t} is not a valid encoding channel.`}function O2(t){return`${t} encoding should be discrete (ordinal / nominal / binned).`}function F2(t){return`${t} encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).`}function D2(t){return`Facet encoding dropped as ${t.join(" and ")} ${t.length>1?"are":"is"} also specified.`}function k2(t,e){return`Using discrete channel "${t}" to encode "${e}" field can be misleading as it does not encode ${e==="ordinal"?"order":"magnitude"}.`}function E2(t){return`The ${t} for range marks cannot be an expression`}function $2(t,e){const n=t&&e?"x2 and y2":t?"x2":"y2";return`Line mark is for continuous lines and thus cannot be used with ${n}. We will use the rule mark (line segments) instead.`}function j2(t,e){return`Specified orient "${t}" overridden with "${e}".`}function C2(t){return`Cannot use the scale property "${t}" with non-color channel.`}function M2(t){return`Cannot use the relative band size with ${t} scale.`}function B2(t){return`Using unaggregated domain with raw field has no effect (${kZ(t)}).`}function S2(t){return`Unaggregated domain not applicable for "${t}" since it produces values outside the origin domain of the source data.`}function _2(t){return`Unaggregated domain is currently unsupported for log scale (${kZ(t)}).`}function N2(t){return`Cannot apply size to non-oriented mark "${t}".`}function z2(t,e,n){return`Channel "${t}" does not work with "${e}" scale. We are using "${n}" scale instead.`}function T2(t,e){return`FieldDef does not work with "${t}" scale. We are using "${e}" scale instead.`}function P2(t,e,n){return`${n}-scale's "${e}" is dropped as it does not work with ${t} scale.`}function L2(t){return`The step for "${t}" is dropped because the ${t==="width"?"x":"y"} is continuous.`}function I2(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${kZ(n)} and ${kZ(i)}). Using ${kZ(n)}.`}function R2(t,e,n,i){return`Conflicting ${e.toString()} property "${t.toString()}" (${kZ(n)} and ${kZ(i)}). Using the union of the two domains.`}function q2(t){return`Setting the scale to be independent for "${t}" means we also have to set the guide (axis or legend) to be independent.`}function U2(t){return`Dropping sort property ${kZ(t)} as unioned domains only support boolean or op "count", "min", and "max".`}const W2="Domains that should be unioned has conflicting sort properties. Sort will be set to true.";const G2="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.";const H2="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.";const V2="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Y2(t){return`Cannot stack "${t}" if there is already "${t}2".`}function X2(t){return`Cannot stack non-linear scale (${t}).`}function J2(t){return`Stacking is applied even though the aggregate function is non-summative ("${t}").`}function Q2(t,e){return`Invalid ${t}: ${kZ(e)}.`}function Z2(t){return`Dropping day from datetime ${kZ(t)} as day cannot be combined with other units.`}function K2(t,e){return`${e?"extent ":""}${e&&t?"and ":""}${t?"center ":""}${e&&t?"are ":"is "}not needed when data are aggregated.`}function t3(t,e,n){return`${t} is not usually used with ${e} for ${n}.`}function e3(t,e){return`Continuous axis should not have customized aggregation function ${t}; ${e} already agregates the axis.`}function n3(t){return`1D error band does not support ${t}.`}function i3(t){return`Channel ${t} is required for "binned" bin.`}function r3(t){return`Channel ${t} should not be used with "binned" bin.`}function u3(t){return`Domain for ${t} is required for threshold scale.`}const o3=be(pe);let s3=o3;function a3(t){s3=t;return s3}function f3(){s3=o3;return s3}function c3(...t){s3.warn(...t)}function l3(...t){s3.debug(...t)}function d3(t){if(t&&ye(t)){for(const e of k3){if(e in t){return true}}}return false}const h3=["january","february","march","april","may","june","july","august","september","october","november","december"];const p3=h3.map((t=>t.substr(0,3)));const m3=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];const g3=m3.map((t=>t.substr(0,3)));function b3(t){if(fK(t)){t=+t}if(pn(t)){if(t>4){c3(Q2("quarter",t))}return t-1}else{throw new Error(Q2("quarter",t))}}function v3(t){if(fK(t)){t=+t}if(pn(t)){return t-1}else{const e=t.toLowerCase();const n=h3.indexOf(e);if(n!==-1){return n}const i=e.substr(0,3);const r=p3.indexOf(i);if(r!==-1){return r}throw new Error(Q2("month",t))}}function y3(t){if(fK(t)){t=+t}if(pn(t)){return t%7}else{const e=t.toLowerCase();const n=m3.indexOf(e);if(n!==-1){return n}const i=e.substr(0,3);const r=g3.indexOf(i);if(r!==-1){return r}throw new Error(Q2("day",t))}}function w3(t,e){const n=[];if(e&&t.day!==undefined){if(RZ(t).length>1){c3(Z2(t));t=xZ(t);delete t.day}}if(t.year!==undefined){n.push(t.year)}else{n.push(2012)}if(t.month!==undefined){const i=e?v3(t.month):t.month;n.push(i)}else if(t.quarter!==undefined){const i=e?b3(t.quarter):t.quarter;n.push(pn(i)?i*3:`${i}*3`)}else{n.push(0)}if(t.date!==undefined){n.push(t.date)}else if(t.day!==undefined){const i=e?y3(t.day):t.day;n.push(pn(i)?i+1:`${i}+1`)}else{n.push(1)}for(const i of["hours","minutes","seconds","milliseconds"]){const e=t[i];n.push(typeof e==="undefined"?0:e)}return n}function A3(t){const e=w3(t,true);const n=e.join(", ");if(t.utc){return`utc(${n})`}else{return`datetime(${n})`}}function x3(t){const e=w3(t,false);const n=e.join(", ");if(t.utc){return`utc(${n})`}else{return`datetime(${n})`}}function O3(t){const e=w3(t,true);if(t.utc){return+new Date(Date.UTC(...e))}else{return+new Date(...e)}}var F3=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const D3={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};const k3=RZ(D3);function E3(t){return!!D3[t]}function $3(t){return t.startsWith("utc")}function j3(t){return t.substr(3)}const C3={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function M3(t){return k3.filter((e=>B3(t,e)))}function B3(t,e){const n=t.indexOf(e);if(n<0){return false}if(n>0&&e==="seconds"&&t.charAt(n-1)==="i"){return false}if(t.length>n+3&&e==="day"&&t.charAt(n+3)==="o"){return false}if(n>0&&e==="year"&&t.charAt(n-1)==="f"){return false}return true}function S3(t,e,{end:n}={end:false}){const i=XZ(e);const r=$3(t)?"utc":"";function u(t){if(t==="quarter"){return`(${r}quarter(${i})-1)`}else{return`${r}${t}(${i})`}}let o;const s={};for(const a of k3){if(B3(t,a)){s[a]=u(a);o=a}}if(n){s[o]+="+1"}return x3(s)}function _3(t){if(!t){return undefined}const e=M3(t);return`timeUnitSpecifier(${kZ(e)}, ${kZ(C3)})`}function N3(t,e,n){if(!t){return undefined}const i=_3(t);const r=n||$3(t);return`${r?"utc":"time"}Format(${e}, ${i})`}function z3(t){if(!t){return undefined}let e;if(gn(t)){e={unit:t}}else if(ye(t)){e=Object.assign(Object.assign({},t),t.unit?{unit:t.unit}:{})}if($3(e.unit)){e.utc=true;e.unit=j3(e.unit)}return e}function T3(t){const e=z3(t),{utc:n}=e,i=F3(e,["utc"]);if(i.unit){return(n?"utc":"")+RZ(i).map((t=>GZ(`${t==="unit"?"":`_${t}_`}${i[t]}`))).join("")}else{return(n?"utc":"")+"timeunit"+RZ(i).map((t=>GZ(`_${t}_${i[t]}`))).join("")}}function P3(t){return t===null||t===void 0?void 0:t["param"]}function L3(t){return t&&!!t.field&&t.equal!==undefined}function I3(t){return t&&!!t.field&&t.lt!==undefined}function R3(t){return t&&!!t.field&&t.lte!==undefined}function q3(t){return t&&!!t.field&&t.gt!==undefined}function U3(t){return t&&!!t.field&&t.gte!==undefined}function W3(t){if(t===null||t===void 0?void 0:t.field){if(ve(t.range)&&t.range.length===2){return true}else if(f1(t.range)){return true}}return false}function G3(t){return t&&!!t.field&&(ve(t.oneOf)||ve(t.in))}function H3(t){return t&&!!t.field&&t.valid!==undefined}function V3(t){return G3(t)||L3(t)||W3(t)||I3(t)||q3(t)||R3(t)||U3(t)}function Y3(t,e){return V8(t,{timeUnit:e,wrapTime:true})}function X3(t,e){return t.map((t=>Y3(t,e)))}function J3(t,e=true){var n;const{field:i}=t;const r=(n=z3(t.timeUnit))===null||n===void 0?void 0:n.unit;const u=r?`time(${S3(r,i)})`:A8(t,{expr:"datum"});if(L3(t)){return`${u}===${Y3(t.equal,r)}`}else if(I3(t)){const e=t.lt;return`${u}<${Y3(e,r)}`}else if(q3(t)){const e=t.gt;return`${u}>${Y3(e,r)}`}else if(R3(t)){const e=t.lte;return`${u}<=${Y3(e,r)}`}else if(U3(t)){const e=t.gte;return`${u}>=${Y3(e,r)}`}else if(G3(t)){return`indexof([${X3(t.oneOf,r).join(",")}], ${u}) !== -1`}else if(H3(t)){return Q3(u,t.valid)}else if(W3(t)){const{range:n}=t;const i=f1(n)?{signal:`${n.signal}[0]`}:n[0];const o=f1(n)?{signal:`${n.signal}[1]`}:n[1];if(i!==null&&o!==null&&e){return"inrange("+u+", ["+Y3(i,r)+", "+Y3(o,r)+"])"}const s=[];if(i!==null){s.push(`${u} >= ${Y3(i,r)}`)}if(o!==null){s.push(`${u} <= ${Y3(o,r)}`)}return s.length>0?s.join(" && "):"true"}throw new Error(`Invalid field predicate: ${kZ(t)}`)}function Q3(t,e=true){if(e){return`isValid(${t}) && isFinite(+${t})`}else{return`!isValid(${t}) || !isFinite(+${t})`}}function Z3(t){var e;if(V3(t)&&t.timeUnit){return Object.assign(Object.assign({},t),{timeUnit:(e=z3(t.timeUnit))===null||e===void 0?void 0:e.unit})}return t}const K3={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function t5(t){return t==="quantitative"||t==="temporal"}function e5(t){return t==="ordinal"||t==="nominal"}const n5=K3.quantitative;const i5=K3.ordinal;const r5=K3.temporal;const u5=K3.nominal;const o5=K3.geojson;function s5(t){if(t){t=t.toLowerCase();switch(t){case"q":case n5:return"quantitative";case"t":case r5:return"temporal";case"o":case i5:return"ordinal";case"n":case u5:return"nominal";case o5:return"geojson"}}return undefined}var a5=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const f5={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"};const c5={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function l5(t,e){const n=c5[t];const i=c5[e];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const d5={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function h5(t){return d5[t]}const p5=new Set(["linear","log","pow","sqrt","symlog"]);const m5=new Set([...p5,"time","utc"]);function g5(t){return p5.has(t)}const b5=new Set(["quantile","quantize","threshold"]);const v5=new Set([...m5,...b5,"sequential","identity"]);const y5=new Set(["ordinal","bin-ordinal","point","band"]);function w5(t){return y5.has(t)}function A5(t){return v5.has(t)}function x5(t){return m5.has(t)}function O5(t){return b5.has(t)}const F5={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4};function D5(t){return!gn(t)&&!!t["name"]}function k5(t){return t===null||t===void 0?void 0:t["param"]}function E5(t){return t&&t["unionWith"]}function $5(t){return ye(t)&&"field"in t}const j5={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1};const C5=a5(j5,["type","domain","range","rangeMax","rangeMin","scheme"]);const M5=RZ(C5);function B5(t,e){switch(e){case"type":case"domain":case"reverse":case"range":return true;case"scheme":case"interpolate":return!["point","band","identity"].includes(t);case"bins":return!["point","band","identity","ordinal"].includes(t);case"round":return x5(t)||t==="band"||t==="point";case"padding":case"rangeMin":case"rangeMax":return x5(t)||["point","band"].includes(t);case"paddingOuter":case"align":return["point","band"].includes(t);case"paddingInner":return t==="band";case"domainMax":case"domainMid":case"domainMin":case"clamp":return x5(t);case"nice":return x5(t)||t==="quantize"||t==="threshold";case"exponent":return t==="pow";case"base":return t==="log";case"constant":return t==="symlog";case"zero":return A5(t)&&!jZ(["log","time","utc","threshold","quantile"],t)}}function S5(t,e){switch(e){case"interpolate":case"scheme":case"domainMid":if(!e0(t)){return C2(t)}return undefined;case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return undefined}}function _5(t,e){if(jZ([i5,u5],e)){return t===undefined||w5(t)}else if(e===r5){return jZ([f5.TIME,f5.UTC,undefined],t)}else if(e===n5){return g5(t)||O5(t)||t===undefined}return true}function N5(t,e,n=false){if(!z0(t)){return false}switch(t){case pK:case mK:case vK:case yK:case xK:case wK:if(x5(e)){return true}else if(e==="band"){return true}else if(e==="point"){return!n}return false;case BK:case TK:case _K:case NK:case zK:case SK:return x5(e)||O5(e)||jZ(["band","point","ordinal"],e);case $K:case jK:case CK:return e!=="band";case PK:case MK:return e==="ordinal"||O5(e)}}const z5={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"};const T5=z5.arc;const P5=z5.area;const L5=z5.bar;const I5=z5.image;const R5=z5.line;const q5=z5.point;const U5=z5.rect;const W5=z5.rule;const G5=z5.text;const H5=z5.tick;const V5=z5.trail;const Y5=z5.circle;const X5=z5.square;const J5=z5.geoshape;function Q5(t){return["line","area","trail"].includes(t)}function Z5(t){return["rect","bar","image","arc"].includes(t)}const K5=new Set(RZ(z5));function t6(t){return t["type"]}const e6=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"];const n6=["fill","fillOpacity"];const i6=[...e6,...n6];const r6={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1};const u6=RZ(r6);const o6={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize"],line:["point"],tick:["bandSize","thickness"]};const s6={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1};const a6={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1};const f6=RZ(a6);function c6(t){return t&&t["band"]!=undefined}const l6={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]};const d6=5;const h6={binSpacing:1,continuousBandSize:d6,timeUnitBandPosition:.5};const p6={binSpacing:0,continuousBandSize:d6,timeUnitBandPosition:.5};const m6={thickness:1};function g6(t){return t6(t)?t.type:t}function b6(t){const{channel:e,channelDef:n,markDef:i,scale:r,config:u}=t;const o=F6(t);if(s8(n)&&!Y0(n.aggregate)&&r&&x5(r.get("type"))){return v6({fieldDef:n,channel:e,markDef:i,ref:o,config:u})}return o}function v6({fieldDef:t,channel:e,markDef:n,ref:i,config:r}){if(Q5(n.type)){return i}const u=$1("invalid",n,r);if(u===null){return[y6(t,e),i]}return i}function y6(t,e){const n=w6(t,true);const i=d0(e);const r=i==="y"?{field:{group:"height"}}:{value:0};return Object.assign({test:n},r)}function w6(t,e=true){return Q3(gn(t)?t:A8(t,{expr:"datum"}),!e)}function A6(t){const{datum:e}=t;if(d3(e)){return A3(e)}return`${kZ(e)}`}function x6(t,e,n,i){const r={};if(e){r.scale=e}if(f8(t)){const{datum:e}=t;if(d3(e)){r.signal=A3(e)}else if(f1(e)){r.signal=e.signal}else if(r1(e)){r.signal=e.expr}else{r.value=e}}else{r.field=A8(t,n)}if(i){const{offset:t,band:e}=i;if(t){r.offset=t}if(e){r.band=e}}return r}function O6({scaleName:t,fieldOrDatumDef:e,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:u=.5}){const o=0<u&&u<1?"datum":undefined;const s=A8(e,{expr:o,suffix:r});const a=n!==undefined?A8(n,{expr:o}):A8(e,{suffix:"end",expr:o});const f={};if(u===0||u===1){f.scale=t;const e=u===0?s:a;f.field=e}else{const e=f1(u)?`${u.signal} * ${s} + (1-${u.signal}) * ${a}`:`${u} * ${s} + ${1-u} * ${a}`;f.signal=`scale("${t}", ${e})`}if(i){f.offset=i}return f}function F6({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:u,scale:o,stack:s,offset:a,defaultRef:f,bandPosition:c}){var l;if(e){if(d8(e)){const f=o===null||o===void 0?void 0:o.get("type");if(h8(e)){c!==null&&c!==void 0?c:c=t8({fieldDef:e,fieldDef2:n,markDef:i,config:r});const{bin:o,timeUnit:l,type:d}=e;if(K0(o)||c&&l&&d===r5){if(s===null||s===void 0?void 0:s.impute){return x6(e,u,{binSuffix:"mid"},{offset:a})}if(c&&!w5(f)){return O6({scaleName:u,fieldOrDatumDef:e,bandPosition:c,offset:a})}return x6(e,u,X8(e,t)?{binSuffix:"range"}:{},{offset:a})}else if(t1(o)){if(s8(n)){return O6({scaleName:u,fieldOrDatumDef:e,fieldOrDatumDef2:n,bandPosition:c,offset:a})}else{const e=t===pK?gK:bK;c3(i3(e))}}}return x6(e,u,w5(f)?{binSuffix:"range"}:{},{offset:a,band:f==="band"?(l=c!==null&&c!==void 0?c:e.bandPosition)!==null&&l!==void 0?l:.5:undefined})}else if(p8(e)){const n=e.value;const i=a?{offset:a}:{};return Object.assign(Object.assign({},D6(t,n)),i)}}if(Ge(f)){f=f()}if(f){return Object.assign(Object.assign({},f),a?{offset:a}:{})}return f}function D6(t,e){if(jZ(["x","x2"],t)&&e==="width"){return{field:{group:"width"}}}else if(jZ(["y","y2"],t)&&e==="height"){return{field:{group:"height"}}}return x1(e)}function k6(t){return t&&t!=="number"&&t!=="time"}function E6(t,e,n){return`${t}(${e}${n?`, ${kZ(n)}`:""})`}const $6=" – ";function j6({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:u}){var o,s;if(k6(n)){return M6({fieldOrDatumDef:t,format:e,formatType:n,expr:i,config:u})}const a=C6(t,i,r);if(G8(t)){const n=L6(a,s8(t)?(o=z3(t.timeUnit))===null||o===void 0?void 0:o.unit:undefined,e,u.timeFormat,m8(t)&&((s=t.scale)===null||s===void 0?void 0:s.type)===f5.UTC);return n?{signal:n}:undefined}e=_6(a8(t),e,u);if(s8(t)&&K0(t.bin)){const r=A8(t,{expr:i,binSuffix:"end"});return{signal:P6(a,r,e,n,u)}}else if(e||a8(t)==="quantitative"){return{signal:`${z6(a,e)}`}}else{return{signal:`isValid(${a}) ? ${a} : ""+${a}`}}}function C6(t,e,n){if(s8(t)){if(n){return`${A8(t,{expr:e,suffix:"end"})}-${A8(t,{expr:e,suffix:"start"})}`}else{return A8(t,{expr:e})}}else{return A6(t)}}function M6({fieldOrDatumDef:t,format:e,formatType:n,expr:i,normalizeStack:r,config:u,field:o}){o!==null&&o!==void 0?o:o=C6(t,i,r);if(s8(t)&&K0(t.bin)){const r=A8(t,{expr:i,binSuffix:"end"});return{signal:P6(o,r,e,n,u)}}return{signal:E6(n,o,e)}}function B6(t,e,n,i,r,u){var o;if(k6(i)){return undefined}if(G8(t)){const e=s8(t)?(o=z3(t.timeUnit))===null||o===void 0?void 0:o.unit:undefined;return N6(n,e,r,u)}return _6(e,n,r)}function S6(t,e,n){if(t&&(f1(t)||t==="number"||t==="time")){return t}if(G8(e)&&n!=="time"&&n!=="utc"){return"time"}return undefined}function _6(t,e,n){if(gn(e)){return e}if(t===n5){return n.numberFormat}return undefined}function N6(t,e,n,i){if(t){return t}if(e){return{signal:_3(e)}}return i?undefined:n.timeFormat}function z6(t,e){return`format(${t}, "${e||""}")`}function T6(t,e,n,i){var r;if(k6(n)){return E6(n,t,e)}return z6(t,(r=gn(e)?e:undefined)!==null&&r!==void 0?r:i.numberFormat)}function P6(t,e,n,i,r){const u=T6(t,n,i,r);const o=T6(e,n,i,r);return`${Q3(t,false)} ? "null" : ${u} + "${$6}" + ${o}`}function L6(t,e,n,i,r){if(!e||n){n=gn(n)?n:i;return`${r?"utc":"time"}Format(${t}, '${n}')`}else{return N3(e,t,r)}}const I6="min";const R6={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function q6(t){return t in R6}function U6(t){return!!t&&!!t["encoding"]}function W6(t){return!!t&&(t["op"]==="count"||!!t["field"])}function G6(t){return!!t&&ve(t)}function H6(t){return"row"in t||"column"in t}function V6(t){return!!t&&"header"in t}function Y6(t){return"facet"in t}var X6=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function J6(t){return t["param"]}function Q6(t){return t&&!gn(t)&&"repeat"in t}function Z6(t){const{field:e,timeUnit:n,bin:i,aggregate:r}=t;return Object.assign(Object.assign(Object.assign(Object.assign({},n?{timeUnit:n}:{}),i?{bin:i}:{}),r?{aggregate:r}:{}),{field:e})}function K6(t){return"sort"in t}function t8({fieldDef:t,fieldDef2:e,markDef:n,config:i}){if(d8(t)&&t.bandPosition!==undefined){return t.bandPosition}if(s8(t)){const{timeUnit:r,bin:u}=t;if(r&&!e){return Z5(n.type)?0:j1("timeUnitBandPosition",n,i)}else if(K0(u)){return.5}}return undefined}function e8({channel:t,fieldDef:e,fieldDef2:n,markDef:i,config:r,scaleType:u,useVlSizeChannel:o}){var s,a,f;const c=m0(t);const l=$1(o?"size":c,i,r,{vgChannel:c});if(l!==undefined){return l}if(s8(e)){const{timeUnit:t,bin:o}=e;if(t&&!n){return{band:j1("timeUnitBandSize",i,r)}}else if(K0(o)&&!w5(u)){return{band:1}}}if(Z5(i.type)){if(u){if(w5(u)){return((s=r[i.type])===null||s===void 0?void 0:s.discreteBandSize)||{band:1}}else{return(a=r[i.type])===null||a===void 0?void 0:a.continuousBandSize}}return(f=r[i.type])===null||f===void 0?void 0:f.discreteBandSize}return undefined}function n8(t,e,n,i){if(K0(t.bin)||t.timeUnit&&h8(t)&&t.type==="temporal"){return t8({fieldDef:t,fieldDef2:e,markDef:n,config:i})!==undefined}return false}function i8(t){return t&&"condition"in t}function r8(t){const e=t&&t["condition"];return!!e&&!ve(e)&&s8(e)}function u8(t){const e=t&&t["condition"];return!!e&&!ve(e)&&d8(e)}function o8(t){const e=t&&t["condition"];return!!e&&(ve(e)||p8(e))}function s8(t){return t&&(!!t["field"]||t["aggregate"]==="count")}function a8(t){return t&&t["type"]}function f8(t){return t&&"datum"in t}function c8(t){return h8(t)&&!x8(t)||l8(t)}function l8(t){return f8(t)&&pn(t.datum)}function d8(t){return s8(t)||f8(t)}function h8(t){return t&&("field"in t||t["aggregate"]==="count")&&"type"in t}function p8(t){return t&&"value"in t&&"value"in t}function m8(t){return t&&("scale"in t||"sort"in t)}function g8(t){return t&&("axis"in t||"stack"in t||"impute"in t)}function b8(t){return t&&"legend"in t}function v8(t){return t&&("format"in t||"formatType"in t)}function y8(t){return DZ(t,["legend","axis","header","scale"])}function w8(t){return"op"in t}function A8(t,e={}){var n,i,r;let u=t.field;const o=e.prefix;let s=e.suffix;let a="";if(F8(t)){u=oK("count")}else{let o;if(!e.nofn){if(w8(t)){o=t.op}else{const{bin:f,aggregate:c,timeUnit:l}=t;if(K0(f)){o=Z0(f);s=((n=e.binSuffix)!==null&&n!==void 0?n:"")+((i=e.suffix)!==null&&i!==void 0?i:"")}else if(c){if(G0(c)){a=`["${u}"]`;u=`argmax_${c.argmax}`}else if(W0(c)){a=`["${u}"]`;u=`argmin_${c.argmin}`}else{o=String(c)}}else if(l){o=T3(l);s=(!["range","mid"].includes(e.binSuffix)&&e.binSuffix||"")+((r=e.suffix)!==null&&r!==void 0?r:"")}}}if(o){u=u?`${o}_${u}`:o}}if(s){u=`${u}_${s}`}if(o){u=`${o}_${u}`}if(e.forAs){return tK(u)}else if(e.expr){return JZ(u,e.expr)+a}else{return ZZ(u)+a}}function x8(t){switch(t.type){case"nominal":case"ordinal":case"geojson":return true;case"quantitative":return s8(t)&&!!t.bin;case"temporal":return false}throw new Error(h2(t.type))}function O8(t){var e;return m8(t)&&O5((e=t.scale)===null||e===void 0?void 0:e.type)}function F8(t){return t.aggregate==="count"}function D8(t,e){var n;const{field:i,bin:r,timeUnit:u,aggregate:o}=t;if(o==="count"){return e.countTitle}else if(K0(r)){return`${i} (binned)`}else if(u){const t=(n=z3(u))===null||n===void 0?void 0:n.unit;if(t){return`${i} (${M3(t).join("-")})`}}else if(o){if(G0(o)){return`${i} for max ${o.argmax}`}else if(W0(o)){return`${i} for min ${o.argmin}`}else{return`${YZ(o)} of ${i}`}}return i}function k8(t){const{aggregate:e,bin:n,timeUnit:i,field:r}=t;if(G0(e)){return`${r} for argmax(${e.argmax})`}else if(W0(e)){return`${r} for argmin(${e.argmin})`}const u=z3(i);const o=e||(u===null||u===void 0?void 0:u.unit)||(u===null||u===void 0?void 0:u.maxbins)&&"timeunit"||K0(n)&&"bin";if(o){return`${o.toUpperCase()}(${r})`}else{return r}}const E8=(t,e)=>{switch(e.fieldTitle){case"plain":return t.field;case"functional":return k8(t);default:return D8(t,e)}};let $8=E8;function j8(t){$8=t}function C8(){j8(E8)}function M8(t,e,{allowDisabling:n,includeDefault:i=true}){var r,u;const o=(r=B8(t))===null||r===void 0?void 0:r.title;if(!s8(t)){return o!==null&&o!==void 0?o:t.title}const s=t;const a=i?S8(s,e):undefined;if(n){return nK(o,s.title,a)}else{return(u=o!==null&&o!==void 0?o:s.title)!==null&&u!==void 0?u:a}}function B8(t){if(g8(t)&&t.axis){return t.axis}else if(b8(t)&&t.legend){return t.legend}else if(V6(t)&&t.header){return t.header}return undefined}function S8(t,e){return $8(t,e)}function _8(t){var e;if(v8(t)){const{format:e,formatType:n}=t;return{format:e,formatType:n}}else{const n=(e=B8(t))!==null&&e!==void 0?e:{};const{format:i,formatType:r}=n;return{format:i,formatType:r}}}function N8(t,e){var n;switch(e){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(K6(t)&&ve(t.sort)){return"ordinal"}const{aggregate:i,bin:r,timeUnit:u}=t;if(u){return"temporal"}if(r||i&&!G0(i)&&!W0(i)){return"quantitative"}if(m8(t)&&((n=t.scale)===null||n===void 0?void 0:n.type)){switch(c5[t.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}}return"nominal"}function z8(t){if(s8(t)){return t}else if(r8(t)){return t.condition}return undefined}function T8(t){if(d8(t)){return t}else if(u8(t)){return t.condition}return undefined}function P8(t,e,n,i={}){if(gn(t)||pn(t)||ln(t)){const n=gn(t)?"string":pn(t)?"number":"boolean";c3(d2(e,n,t));return{value:t}}if(d8(t)){return L8(t,e,n,i)}else if(u8(t)){return Object.assign(Object.assign({},t),{condition:L8(t.condition,e,n,i)})}return t}function L8(t,e,n,i){if(v8(t)){const{format:r,formatType:u}=t,o=X6(t,["format","formatType"]);if(k6(u)&&!n.customFormatTypes){c3(s2(e));return L8(o,e,n,i)}}else{const r=g8(t)?"axis":b8(t)?"legend":V6(t)?"header":null;if(r&&t[r]){const u=t[r],{format:o,formatType:s}=u,a=X6(u,["format","formatType"]);if(k6(s)&&!n.customFormatTypes){c3(s2(e));return L8(Object.assign(Object.assign({},t),{[r]:a}),e,n,i)}}}if(s8(t)){return R8(t,e,i)}return I8(t)}function I8(t){let e=t["type"];if(e){return t}const{datum:n}=t;e=pn(n)?"quantitative":gn(n)?"nominal":d3(n)?"temporal":undefined;return Object.assign(Object.assign({},t),{type:e})}function R8(t,e,{compositeMark:n=false}={}){const{aggregate:i,timeUnit:r,bin:u,field:o}=t;const s=Object.assign({},t);if(!n&&i&&!H0(i)&&!G0(i)&&!W0(i)){c3(m2(i));delete s.aggregate}if(r){s.timeUnit=z3(r)}if(o){s.field=`${o}`}if(K0(u)){s.bin=q8(u,e)}if(t1(u)&&!F0(e)){c3(r3(e))}if(h8(s)){const{type:t}=s;const e=s5(t);if(t!==e){s.type=e}if(t!=="quantitative"){if(Y0(i)){c3(p2(t,i));s.type="quantitative"}}}else if(!l0(e)){const t=N8(s,e);s["type"]=t}if(h8(s)){const{compatible:t,warning:n}=W8(s,e)||{};if(t===false){c3(n)}}if(K6(s)&&gn(s.sort)){const{sort:t}=s;if(q6(t)){return Object.assign(Object.assign({},s),{sort:{encoding:t}})}const e=t.substr(1);if(t.charAt(0)==="-"&&q6(e)){return Object.assign(Object.assign({},s),{sort:{encoding:e,order:"descending"}})}}if(V6(s)){const{header:t}=s;if(t){const{orient:e}=t,n=X6(t,["orient"]);if(e){return Object.assign(Object.assign({},s),{header:Object.assign(Object.assign({},n),{labelOrient:t.labelOrient||e,titleOrient:t.titleOrient||e})})}}}return s}function q8(t,e){if(ln(t)){return{maxbins:i1(e)}}else if(t==="binned"){return{binned:true}}else if(!t.maxbins&&!t.step){return Object.assign(Object.assign({},t),{maxbins:i1(e)})}else{return t}}const U8={compatible:true};function W8(t,e){const n=t.type;if(n==="geojson"&&e!=="shape"){return{compatible:false,warning:`Channel ${e} should not be used with a geojson data.`}}switch(e){case lK:case dK:case hK:if(!x8(t)){return{compatible:false,warning:O2(e)}}return U8;case pK:case mK:case vK:case yK:case $K:case jK:case CK:case LK:case RK:case qK:case UK:case WK:case GK:case SK:case xK:case wK:case HK:return U8;case DK:case EK:case FK:case kK:if(n!==n5){return{compatible:false,warning:`Channel ${e} should be used with a quantitative field only, not ${t.type} field.`}}return U8;case _K:case NK:case zK:case TK:case BK:case OK:case AK:case gK:case bK:if(n==="nominal"&&!t["sort"]){return{compatible:false,warning:`Channel ${e} should not be used with an unsorted discrete field.`}}return U8;case MK:case PK:if(!x8(t)&&!O8(t)){return{compatible:false,warning:F2(e)}}return U8;case IK:if(t.type==="nominal"&&!("sort"in t)){return{compatible:false,warning:`Channel order is inappropriate for nominal field, which has no inherent order.`}}return U8}}function G8(t){const{formatType:e}=_8(t);return e==="time"||!e&&H8(t)}function H8(t){return t&&(t["type"]==="temporal"||s8(t)&&!!t.timeUnit)}function V8(t,{timeUnit:e,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var u;const o=e&&((u=z3(e))===null||u===void 0?void 0:u.unit);let s=o||n==="temporal";let a;if(r1(t)){a=t.expr}else if(f1(t)){a=t.signal}else if(d3(t)){s=true;a=A3(t)}else if(gn(t)||pn(t)){if(s){a=`datetime(${kZ(t)})`;if(E3(o)){if(pn(t)&&t<1e4||gn(t)&&isNaN(Date.parse(t))){a=A3({[o]:t})}}}}if(a){return i&&s?`time(${a})`:a}return r?undefined:kZ(t)}function Y8(t,e){const{type:n}=t;return e.map((e=>{const i=V8(e,{timeUnit:s8(t)?t.timeUnit:undefined,type:n,undefinedIfExprNotRequired:true});if(i!==undefined){return{signal:i}}return e}))}function X8(t,e){if(!K0(t.bin)){console.warn("Only call this method for binned field defs.");return false}return z0(e)&&["ordinal","nominal"].includes(t.type)}const J8={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function Q8(t){return t&&t["condition"]}const Z8=["domain","grid","labels","ticks","title"];const K8={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"};const t9={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1};const e9=Object.assign(Object.assign({},t9),{style:1,labelExpr:1,encoding:1});function n9(t){return!!e9[t]}const i9={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1};const r9=RZ(i9);function u9(t){return"mark"in t}class o9{constructor(t,e){this.name=t;this.run=e}hasMatchingType(t){if(u9(t)){return g6(t.mark)===this.name}return false}}var s9=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function a9(t,e){const n=t&&t[e];if(n){if(ve(n)){return CZ(n,(t=>!!t.field))}else{return s8(n)||r8(n)}}return false}function f9(t,e){const n=t&&t[e];if(n){if(ve(n)){return CZ(n,(t=>!!t.field))}else{return s8(n)||f8(n)||u8(n)}}return false}function c9(t,e){if(F0(e)){const n=t[e];if((s8(n)||f8(n))&&e5(n.type)){const n=b0(e);return f9(t,n)}}return false}function l9(t){return CZ(u0,(e=>{if(a9(t,e)){const n=t[e];if(ve(n)){return CZ(n,(t=>!!t.aggregate))}else{const t=z8(n);return t&&!!t.aggregate}}return false}))}function d9(t,e){const n=[];const i=[];const r=[];const u=[];const o={};b9(t,((s,a)=>{if(s8(s)){const{field:f,aggregate:c,bin:l,timeUnit:d}=s,h=s9(s,["field","aggregate","bin","timeUnit"]);if(c||d||l){const t=B8(s);const p=t===null||t===void 0?void 0:t.title;let m=A8(s,{forAs:true});const g=Object.assign(Object.assign(Object.assign({},p?[]:{title:M8(s,e,{allowDisabling:true})}),h),{field:m});if(c){let t;if(G0(c)){t="argmax";m=A8({op:"argmax",field:c.argmax},{forAs:true});g.field=`${m}.${f}`}else if(W0(c)){t="argmin";m=A8({op:"argmin",field:c.argmin},{forAs:true});g.field=`${m}.${f}`}else if(c!=="boxplot"&&c!=="errorbar"&&c!=="errorband"){t=c}if(t){const e={op:t,as:m};if(f){e.field=f}u.push(e)}}else{n.push(m);if(h8(s)&&K0(l)){i.push({bin:l,field:f,as:m});n.push(A8(s,{binSuffix:"end"}));if(X8(s,a)){n.push(A8(s,{binSuffix:"range"}))}if(F0(a)){const t={field:`${m}_end`};o[`${a}2`]=t}g.bin="binned";if(!l0(a)){g["type"]=n5}}else if(d){r.push({timeUnit:d,field:f,as:m});const t=h8(s)&&s.type!==r5&&"time";if(t){if(a===LK||a===UK){g["formatType"]=t}else if(B0(a)){g["legend"]=Object.assign({formatType:t},g["legend"])}else if(F0(a)){g["axis"]=Object.assign({formatType:t},g["axis"])}}}}o[a]=g}else{n.push(f);o[a]=t[a]}}else{o[a]=t[a]}}));return{bins:i,timeUnits:r,aggregate:u,groupby:n,encoding:o}}function h9(t,e,n){const i=T0(e,n);if(!i){return false}else if(i==="binned"){const n=t[e===gK?pK:mK];if(s8(n)&&s8(t[e])&&t1(n.bin)){return true}else{return false}}return true}function p9(t,e,n,i){const r={};for(const u of RZ(t)){if(!f0(u)){c3(x2(u))}}for(let u of y0){if(!t[u]){continue}const o=t[u];if(j0(u)){const t=v0(u);const e=r[t];if(s8(e)){if(t5(e.type)){if(s8(o)){c3(c2(t));continue}}}else{u=t;c3(l2(t))}}if(u==="angle"&&e==="arc"&&!t.theta){c3(f2);u=xK}if(!h9(t,u,e)){c3(w2(u,e));continue}if(u===BK&&e==="line"){const e=z8(t[u]);if(e===null||e===void 0?void 0:e.aggregate){c3(y2);continue}}if(u===$K&&(n?"fill"in t:"stroke"in t)){c3(g2("encoding",{fill:"fill"in t,stroke:"stroke"in t}));continue}if(u===RK||u===IK&&!ve(o)&&!p8(o)||u===UK&&ve(o)){if(o){r[u]=Ue(o).reduce(((t,e)=>{if(!s8(e)){c3(v2(e,u))}else{t.push(R8(e,u))}return t}),[])}}else{if(u===UK&&o===null){r[u]=null}else if(!s8(o)&&!f8(o)&&!p8(o)&&!i8(o)&&!f1(o)){c3(v2(o,u));continue}r[u]=P8(o,u,i)}}return r}function m9(t,e){const n={};for(const i of RZ(t)){const r=P8(t[i],i,e,{compositeMark:true});n[i]=r}return n}function g9(t){const e=[];for(const n of RZ(t)){if(a9(t,n)){const i=t[n];const r=Ue(i);for(const t of r){if(s8(t)){e.push(t)}else if(r8(t)){e.push(t.condition)}}}}return e}function b9(t,e,n){if(!t){return}for(const i of RZ(t)){const r=t[i];if(ve(r)){for(const t of r){e.call(n,t,i)}}else{e.call(n,r,i)}}}function v9(t,e,n,i){if(!t){return n}return RZ(t).reduce(((n,r)=>{const u=t[r];if(ve(u)){return u.reduce(((t,n)=>e.call(i,t,n,r)),n)}else{return e.call(i,n,u,r)}}),n)}function y9(t,e){return RZ(e).reduce(((n,i)=>{switch(i){case pK:case mK:case WK:case HK:case GK:case gK:case bK:case vK:case yK:case xK:case OK:case wK:case AK:case FK:case DK:case kK:case EK:case LK:case MK:case SK:case UK:return n;case IK:if(t==="line"||t==="trail"){return n}case RK:case qK:{const t=e[i];if(ve(t)||s8(t)){for(const e of Ue(t)){if(!e.aggregate){n.push(A8(e,{}))}}}return n}case BK:if(t==="trail"){return n}case $K:case jK:case CK:case _K:case NK:case zK:case PK:case TK:{const t=z8(e[i]);if(t&&!t.aggregate){n.push(A8(t,{}))}return n}}}),[])}var w9=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function A9(t){const{tooltip:e}=t,n=w9(t,["tooltip"]);if(!e){return{filteredEncoding:n}}let i;let r;if(ve(e)){for(const t of e){if(t.aggregate){if(!i){i=[]}i.push(t)}else{if(!r){r=[]}r.push(t)}}if(i){n.tooltip=i}}else{if(e["aggregate"]){n.tooltip=e}else{r=e}}if(ve(r)&&r.length===1){r=r[0]}return{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function x9(t,e,n,i=true){if("tooltip"in n){return{tooltip:n.tooltip}}const r=t.map((({fieldPrefix:t,titlePrefix:n})=>{const r=i?` of ${O9(e)}`:"";return{field:t+e.field,type:e.type,title:f1(n)?{signal:`${n}"${escape(r)}"`}:n+r}}));const u=g9(n).map(y8);return{tooltip:[...r,..._Z(u,EZ)]}}function O9(t){const{title:e,field:n}=t;return nK(e,n)}function F9(t,e,n,i,r){const{scale:u,axis:o}=n;return({partName:s,mark:a,positionPrefix:f,endPositionPrefix:c=undefined,extraEncoding:l={}})=>{const d=O9(n);return D9(t,s,r,{mark:a,encoding:Object.assign(Object.assign(Object.assign({[e]:Object.assign(Object.assign(Object.assign({field:`${f}_${n.field}`,type:n.type},d!==undefined?{title:d}:{}),u!==undefined?{scale:u}:{}),o!==undefined?{axis:o}:{})},gn(c)?{[`${e}2`]:{field:`${c}_${n.field}`}}:{}),i),l)})}}function D9(t,e,n,i){const{clip:r,color:u,opacity:o}=t;const s=t.type;if(t[e]||t[e]===undefined&&n[e]){return[Object.assign(Object.assign({},i),{mark:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n[e]),r?{clip:r}:{}),u?{color:u}:{}),o?{opacity:o}:{}),t6(i.mark)?i.mark:{type:i.mark}),{style:`${s}-${e}`}),ln(t[e])?{}:t[e])})]}return[]}function k9(t,e,n){const{encoding:i}=t;const r=e==="vertical"?"y":"x";const u=i[r];const o=i[`${r}2`];const s=i[`${r}Error`];const a=i[`${r}Error2`];return{continuousAxisChannelDef:E9(u,n),continuousAxisChannelDef2:E9(o,n),continuousAxisChannelDefError:E9(s,n),continuousAxisChannelDefError2:E9(a,n),continuousAxis:r}}function E9(t,e){if(t===null||t===void 0?void 0:t.aggregate){const{aggregate:n}=t,i=w9(t,["aggregate"]);if(n!==e){c3(e3(n,e))}return i}else{return t}}function $9(t,e){const{mark:n,encoding:i}=t;const{x:r,y:u}=i;if(t6(n)&&n.orient){return n.orient}if(c8(r)){if(c8(u)){const t=s8(r)&&r.aggregate;const n=s8(u)&&u.aggregate;if(!t&&n===e){return"vertical"}else if(!n&&t===e){return"horizontal"}else if(t===e&&n===e){throw new Error("Both x and y cannot have aggregate")}else{if(G8(u)&&!G8(r)){return"horizontal"}return"vertical"}}return"horizontal"}else if(c8(u)){return"vertical"}else{throw new Error(`Need a valid continuous axis for ${e}s`)}}var j9=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const C9="boxplot";const M9=["box","median","outliers","rule","ticks"];const B9=new o9(C9,_9);function S9(t){if(pn(t)){return"tukey"}return t}function _9(t,{config:e}){var n,i;t=Object.assign(Object.assign({},t),{encoding:m9(t.encoding,e)});const{mark:r,encoding:u,params:o,projection:s}=t,a=j9(t,["mark","encoding","params","projection"]);const f=t6(r)?r:{type:r};if(o){c3(G1("boxplot"))}const c=(n=f.extent)!==null&&n!==void 0?n:e.boxplot.extent;const l=$1("size",f,e);const d=S9(c);const{bins:h,timeUnits:p,transform:m,continuousAxisChannelDef:g,continuousAxis:b,groupby:v,aggregate:y,encodingWithoutContinuousAxis:w,ticksOrient:A,boxOrient:x,customTooltipWithoutAggregatedField:O}=z9(t,c,e);const{color:F,size:D}=w,k=j9(w,["color","size"]);const E=t=>F9(f,b,g,t,e.boxplot);const $=E(k);const j=E(w);const C=E(Object.assign(Object.assign({},k),D?{size:D}:{}));const M=x9([{fieldPrefix:d==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:d==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],g,w);const B={type:"tick",color:"black",opacity:1,orient:A,invalid:null,aria:false};const S=d==="min-max"?M:x9([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],g,w);const _=[...$({partName:"rule",mark:{type:"rule",invalid:null,aria:false},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:S}),...$({partName:"rule",mark:{type:"rule",invalid:null,aria:false},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:S}),...$({partName:"ticks",mark:B,positionPrefix:"lower_whisker",extraEncoding:S}),...$({partName:"ticks",mark:B,positionPrefix:"upper_whisker",extraEncoding:S})];const N=[...d!=="tukey"?_:[],...j({partName:"box",mark:Object.assign(Object.assign({type:"bar"},l?{size:l}:{}),{orient:x,invalid:null,ariaRoleDescription:"box"}),positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:M}),...C({partName:"median",mark:Object.assign(Object.assign(Object.assign({type:"tick",invalid:null},ye(e.boxplot.median)&&e.boxplot.median.color?{color:e.boxplot.median.color}:{}),l?{size:l}:{}),{orient:A,aria:false}),positionPrefix:"mid_box",extraEncoding:M})];if(d==="min-max"){return Object.assign(Object.assign({},a),{transform:((i=a.transform)!==null&&i!==void 0?i:[]).concat(m),layer:N})}const z=`datum["lower_box_${g.field}"]`;const T=`datum["upper_box_${g.field}"]`;const P=`(${T} - ${z})`;const L=`${z} - ${c} * ${P}`;const I=`${T} + ${c} * ${P}`;const R=`datum["${g.field}"]`;const q={joinaggregate:N9(g.field),groupby:v};const U={transform:[{filter:`(${L} <= ${R}) && (${R} <= ${I})`},{aggregate:[{op:"min",field:g.field,as:`lower_whisker_${g.field}`},{op:"max",field:g.field,as:`upper_whisker_${g.field}`},{op:"min",field:`lower_box_${g.field}`,as:`lower_box_${g.field}`},{op:"max",field:`upper_box_${g.field}`,as:`upper_box_${g.field}`},...y],groupby:v}],layer:_};const W=j9(k,["tooltip"]);const{scale:G,axis:H}=g;const V=O9(g);const Y=DZ(H,["title"]);const X=D9(f,"outliers",e.boxplot,{transform:[{filter:`(${R} < ${L}) || (${R} > ${I})`}],mark:"point",encoding:Object.assign(Object.assign(Object.assign({[b]:Object.assign(Object.assign(Object.assign({field:g.field,type:g.type},V!==undefined?{title:V}:{}),G!==undefined?{scale:G}:{}),IZ(Y)?{}:{axis:Y})},W),F?{color:F}:{}),O?{tooltip:O}:{})})[0];let J;const Q=[...h,...p,q];if(X){J={transform:Q,layer:[X,U]}}else{J=U;J.transform.unshift(...Q)}return Object.assign(Object.assign({},a),{layer:[J,{transform:m,layer:N}]})}function N9(t){return[{op:"q1",field:t,as:`lower_box_${t}`},{op:"q3",field:t,as:`upper_box_${t}`}]}function z9(t,e,n){const i=$9(t,C9);const{continuousAxisChannelDef:r,continuousAxis:u}=k9(t,i,C9);const o=r.field;const s=S9(e);const a=[...N9(o),{op:"median",field:o,as:`mid_box_${o}`},{op:"min",field:o,as:(s==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(s==="min-max"?"upper_whisker_":"max_")+o}];const f=s==="min-max"||s==="tukey"?[]:[{calculate:`datum["upper_box_${o}"] - datum["lower_box_${o}"]`,as:`iqr_${o}`},{calculate:`min(datum["upper_box_${o}"] + datum["iqr_${o}"] * ${e}, datum["max_${o}"])`,as:`upper_whisker_${o}`},{calculate:`max(datum["lower_box_${o}"] - datum["iqr_${o}"] * ${e}, datum["min_${o}"])`,as:`lower_whisker_${o}`}];const c=t.encoding,l=u,d=j9(c,[typeof l==="symbol"?l:l+""]);const{customTooltipWithoutAggregatedField:h,filteredEncoding:p}=A9(d);const{bins:m,timeUnits:g,aggregate:b,groupby:v,encoding:y}=d9(p,n);const w=i==="vertical"?"horizontal":"vertical";const A=i;const x=[...m,...g,{aggregate:[...b,...a],groupby:v},...f];return{bins:m,timeUnits:g,transform:x,groupby:v,aggregate:b,continuousAxisChannelDef:r,continuousAxis:u,encodingWithoutContinuousAxis:y,ticksOrient:w,boxOrient:A,customTooltipWithoutAggregatedField:h}}var T9=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const P9="errorbar";const L9=["ticks","rule"];const I9=new o9(P9,R9);function R9(t,{config:e}){t=Object.assign(Object.assign({},t),{encoding:m9(t.encoding,e)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:u,ticksOrient:o,markDef:s,outerSpec:a,tooltipEncoding:f}=H9(t,P9,e);delete u["size"];const c=F9(s,r,i,u,e.errorbar);const l=s.thickness;const d=s.size;const h=Object.assign(Object.assign({type:"tick",orient:o,aria:false},l!==undefined?{thickness:l}:{}),d!==undefined?{size:d}:{});const p=[...c({partName:"ticks",mark:h,positionPrefix:"lower",extraEncoding:f}),...c({partName:"ticks",mark:h,positionPrefix:"upper",extraEncoding:f}),...c({partName:"rule",mark:Object.assign({type:"rule",ariaRoleDescription:"errorbar"},l!==undefined?{size:l}:{}),positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:f})];return Object.assign(Object.assign(Object.assign({},a),{transform:n}),p.length>1?{layer:p}:Object.assign({},p[0]))}function q9(t,e){const{encoding:n}=t;if(U9(n)){return{orient:$9(t,e),inputType:"raw"}}const i=W9(n);const r=G9(n);const u=n.x;const o=n.y;if(i){if(r){throw new Error(`${e} cannot be both type aggregated-upper-lower and aggregated-error`)}const t=n.x2;const i=n.y2;if(d8(t)&&d8(i)){throw new Error(`${e} cannot have both x2 and y2`)}else if(d8(t)){if(c8(u)){return{orient:"horizontal",inputType:"aggregated-upper-lower"}}else{throw new Error(`Both x and x2 have to be quantitative in ${e}`)}}else if(d8(i)){if(c8(o)){return{orient:"vertical",inputType:"aggregated-upper-lower"}}else{throw new Error(`Both y and y2 have to be quantitative in ${e}`)}}throw new Error("No ranged axis")}else{const t=n.xError;const i=n.xError2;const r=n.yError;const s=n.yError2;if(d8(i)&&!d8(t)){throw new Error(`${e} cannot have xError2 without xError`)}if(d8(s)&&!d8(r)){throw new Error(`${e} cannot have yError2 without yError`)}if(d8(t)&&d8(r)){throw new Error(`${e} cannot have both xError and yError with both are quantiative`)}else if(d8(t)){if(c8(u)){return{orient:"horizontal",inputType:"aggregated-error"}}else{throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}}else if(d8(r)){if(c8(o)){return{orient:"vertical",inputType:"aggregated-error"}}else{throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}}throw new Error("No ranged axis")}}function U9(t){return(d8(t.x)||d8(t.y))&&!d8(t.x2)&&!d8(t.y2)&&!d8(t.xError)&&!d8(t.xError2)&&!d8(t.yError)&&!d8(t.yError2)}function W9(t){return d8(t.x2)||d8(t.y2)}function G9(t){return d8(t.xError)||d8(t.xError2)||d8(t.yError)||d8(t.yError2)}function H9(t,e,n){var i;const{mark:r,encoding:u,params:o,projection:s}=t,a=T9(t,["mark","encoding","params","projection"]);const f=t6(r)?r:{type:r};if(o){c3(G1(e))}const{orient:c,inputType:l}=q9(t,e);const{continuousAxisChannelDef:d,continuousAxisChannelDef2:h,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:m,continuousAxis:g}=k9(t,c,e);const{errorBarSpecificAggregate:b,postAggregateCalculates:v,tooltipSummary:y,tooltipTitleWithFieldName:w}=V9(f,d,h,p,m,l,e,n);const A=u,x=g,O=g==="x"?"x2":"y2",F=g==="x"?"xError":"yError",D=g==="x"?"xError2":"yError2",k=T9(A,[typeof x==="symbol"?x:x+"",typeof O==="symbol"?O:O+"",typeof F==="symbol"?F:F+"",typeof D==="symbol"?D:D+""]);const{bins:E,timeUnits:$,aggregate:j,groupby:C,encoding:M}=d9(k,n);const B=[...j,...b];const S=l!=="raw"?[]:C;const _=x9(y,d,M,w);return{transform:[...(i=a.transform)!==null&&i!==void 0?i:[],...E,...$,...B.length===0?[]:[{aggregate:B,groupby:S}],...v],groupby:S,continuousAxisChannelDef:d,continuousAxis:g,encodingWithoutContinuousAxis:M,ticksOrient:c==="vertical"?"horizontal":"vertical",markDef:f,outerSpec:a,tooltipEncoding:_}}function V9(t,e,n,i,r,u,o,s){let a=[];let f=[];const c=e.field;let l;let d=false;if(u==="raw"){const e=t.center?t.center:t.extent?t.extent==="iqr"?"median":"mean":s.errorbar.center;const n=t.extent?t.extent:e==="mean"?"stderr":"iqr";if(e==="median"!==(n==="iqr")){c3(t3(e,n,o))}if(n==="stderr"||n==="stdev"){a=[{op:n,field:c,as:`extent_${c}`},{op:e,field:c,as:`center_${c}`}];f=[{calculate:`datum["center_${c}"] + datum["extent_${c}"]`,as:`upper_${c}`},{calculate:`datum["center_${c}"] - datum["extent_${c}"]`,as:`lower_${c}`}];l=[{fieldPrefix:"center_",titlePrefix:YZ(e)},{fieldPrefix:"upper_",titlePrefix:Y9(e,n,"+")},{fieldPrefix:"lower_",titlePrefix:Y9(e,n,"-")}];d=true}else{let t;let e;let i;if(n==="ci"){t="mean";e="ci0";i="ci1"}else{t="median";e="q1";i="q3"}a=[{op:e,field:c,as:`lower_${c}`},{op:i,field:c,as:`upper_${c}`},{op:t,field:c,as:`center_${c}`}];l=[{fieldPrefix:"upper_",titlePrefix:M8({field:c,aggregate:i,type:"quantitative"},s,{allowDisabling:false})},{fieldPrefix:"lower_",titlePrefix:M8({field:c,aggregate:e,type:"quantitative"},s,{allowDisabling:false})},{fieldPrefix:"center_",titlePrefix:M8({field:c,aggregate:t,type:"quantitative"},s,{allowDisabling:false})}]}}else{if(t.center||t.extent){c3(K2(t.center,t.extent))}if(u==="aggregated-upper-lower"){l=[];f=[{calculate:`datum["${n.field}"]`,as:`upper_${c}`},{calculate:`datum["${c}"]`,as:`lower_${c}`}]}else if(u==="aggregated-error"){l=[{fieldPrefix:"",titlePrefix:c}];f=[{calculate:`datum["${c}"] + datum["${i.field}"]`,as:`upper_${c}`}];if(r){f.push({calculate:`datum["${c}"] + datum["${r.field}"]`,as:`lower_${c}`})}else{f.push({calculate:`datum["${c}"] - datum["${i.field}"]`,as:`lower_${c}`})}}for(const t of f){l.push({fieldPrefix:t.as.substring(0,6),titlePrefix:KZ(KZ(t.calculate,'datum["',""),'"]',"")})}}return{postAggregateCalculates:f,errorBarSpecificAggregate:a,tooltipSummary:l,tooltipTitleWithFieldName:d}}function Y9(t,e,n){return`${YZ(t)} ${n} ${e}`}const X9="errorband";const J9=["band","borders"];const Q9=new o9(X9,Z9);function Z9(t,{config:e}){t=Object.assign(Object.assign({},t),{encoding:m9(t.encoding,e)});const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:u,markDef:o,outerSpec:s,tooltipEncoding:a}=H9(t,X9,e);const f=o;const c=F9(f,r,i,u,e.errorband);const l=t.encoding.x!==undefined&&t.encoding.y!==undefined;let d={type:l?"area":"rect"};let h={type:l?"line":"rule"};const p=Object.assign(Object.assign({},f.interpolate?{interpolate:f.interpolate}:{}),f.tension&&f.interpolate?{tension:f.tension}:{});if(l){d=Object.assign(Object.assign(Object.assign({},d),p),{ariaRoleDescription:"errorband"});h=Object.assign(Object.assign(Object.assign({},h),p),{aria:false})}else if(f.interpolate){c3(n3("interpolate"))}else if(f.tension){c3(n3("tension"))}return Object.assign(Object.assign({},s),{transform:n,layer:[...c({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:a}),...c({partName:"borders",mark:h,positionPrefix:"lower",extraEncoding:a}),...c({partName:"borders",mark:h,positionPrefix:"upper",extraEncoding:a})]})}const K9={};function t4(t,e,n){const i=new o9(t,e);K9[t]={normalizer:i,parts:n}}function e4(){return RZ(K9)}t4(C9,_9,M9);t4(P9,R9,L9);t4(X9,Z9,J9);const n4=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"];const i4={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"};const r4={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"};const u4=RZ(i4);const o4=RZ(r4);const s4={header:1,headerRow:1,headerColumn:1,headerFacet:1};const a4=RZ(s4);const f4=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"];const c4={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35};const l4={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1};const d4="_vgsid_";const h4={point:{on:"click",fields:[d4],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function p4(t){return!!t&&(t==="legend"||!!t.legend)}function m4(t){return p4(t)&&ye(t)}function g4(t){return!!t["select"]}var b4=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function v4(t){const e=[];for(const n of t||[]){if(g4(n))continue;const{expr:t,bind:i}=n,r=b4(n,["expr","bind"]);if(i&&t){const n=Object.assign(Object.assign({},r),{bind:i,init:t});e.push(n)}else{const n=Object.assign(Object.assign(Object.assign({},r),t?{update:t}:{}),i?{bind:i}:{});e.push(n)}}return e}function y4(t){return A4(t)||x4(t)||w4(t)}function w4(t){return"concat"in t}function A4(t){return"vconcat"in t}function x4(t){return"hconcat"in t}function O4({step:t,offsetIsDiscrete:e}){var n;if(e){return(n=t.for)!==null&&n!==void 0?n:"offset"}else{return"position"}}function F4(t){return ye(t)&&t["step"]!==undefined}function D4(t){return t["view"]||t["width"]||t["height"]}const k4=20;const E4={align:1,bounds:1,center:1,columns:1,spacing:1};const $4=RZ(E4);function j4(t,e,n){var i,r;const u=n[e];const o={};const{spacing:s,columns:a}=u;if(s!==undefined){o.spacing=s}if(a!==undefined){if(Y6(t)&&!H6(t.facet)||w4(t)){o.columns=a}}if(A4(t)){o.columns=1}for(const f of $4){if(t[f]!==undefined){if(f==="spacing"){const e=t[f];o[f]=pn(e)?e:{row:(i=e.row)!==null&&i!==void 0?i:s,column:(r=e.column)!==null&&r!==void 0?r:s}}else{o[f]=t[f]}}}return o}var C4=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function M4(t,e){var n;return(n=t[e])!==null&&n!==void 0?n:t[e==="width"?"continuousWidth":"continuousHeight"]}function B4(t,e){const n=S4(t,e);return F4(n)?n.step:_4}function S4(t,e){var n;const i=(n=t[e])!==null&&n!==void 0?n:t[e==="width"?"discreteWidth":"discreteHeight"];return nK(i,{step:t.step})}const _4=20;const N4={continuousWidth:200,continuousHeight:200,step:_4};const z4={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:N4,mark:s6,arc:{},area:{},bar:h6,circle:{},geoshape:{},image:{},line:{},point:{},rect:p6,rule:{color:"black"},square:{},text:{color:"black"},tick:m6,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:true,ticks:false},errorband:{band:{opacity:.3},borders:false},scale:F5,projection:{},legend:c4,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:h4,style:{},title:{},facet:{spacing:k4},concat:{spacing:k4}};const T4=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"];const P4={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12};const L4={blue:T4[0],orange:T4[1],red:T4[2],teal:T4[3],green:T4[4],yellow:T4[5],purple:T4[6],pink:T4[7],brown:T4[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function I4(t={}){return{signals:[{name:"color",value:ye(t)?Object.assign(Object.assign({},L4),t):L4}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function R4(t){return{signals:[{name:"fontSize",value:ye(t)?Object.assign(Object.assign({},P4),t):P4}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function q4(t){return{text:{font:t},style:{"guide-label":{font:t},"guide-title":{font:t},"group-title":{font:t},"group-subtitle":{font:t}}}}function U4(t){const e=RZ(t||{});const n={};for(const i of e){const e=t[i];n[i]=Q8(e)?y1(e):w1(e)}return n}function W4(t){const e=RZ(t);const n={};for(const i of e){n[i]=U4(t[i])}return n}const G4=[...f6,...r9,...a4,"background","padding","legend","lineBreak","scale","style","title","view"];function H4(t={}){const{color:e,font:n,fontSize:i,selection:r}=t,u=C4(t,["color","font","fontSize","selection"]);const o=Ae({},xZ(z4),n?q4(n):{},e?I4(e):{},i?R4(i):{},u||{});if(r){xe(o,"selection",r,true)}const s=DZ(o,G4);for(const a of["background","lineBreak","padding"]){if(o[a]){s[a]=w1(o[a])}}for(const a of f6){if(o[a]){s[a]=u1(o[a])}}for(const a of r9){if(o[a]){s[a]=U4(o[a])}}for(const a of a4){if(o[a]){s[a]=u1(o[a])}}if(o.legend){s.legend=u1(o.legend)}if(o.scale){s.scale=u1(o.scale)}if(o.style){s.style=W4(o.style)}if(o.title){s.title=u1(o.title)}if(o.view){s.view=u1(o.view)}return s}const V4=new Set(["view",...K5]);const Y4=["color","fontSize","background","padding","facet","concat","numberFormat","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"];const X4=Object.assign({view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"]},o6);function J4(t){t=xZ(t);for(const e of Y4){delete t[e]}if(t.axis){for(const e in t.axis){if(Q8(t.axis[e])){delete t.axis[e]}}}if(t.legend){for(const e of n4){delete t.legend[e]}}if(t.mark){for(const e of u6){delete t.mark[e]}if(t.mark.tooltip&&ye(t.mark.tooltip)){delete t.mark.tooltip}}if(t.params){t.signals=(t.signals||[]).concat(v4(t.params));delete t.params}for(const e of V4){for(const i of u6){delete t[e][i]}const n=X4[e];if(n){for(const i of n){delete t[e][i]}}Z4(t,e)}for(const e of e4()){delete t[e]}Q4(t);for(const e in t){if(ye(t[e])&&IZ(t[e])){delete t[e]}}return IZ(t)?undefined:t}function Q4(t){const{titleMarkConfig:e,subtitleMarkConfig:n,subtitle:i}=s1(t.title);if(!IZ(e)){t.style["group-title"]=Object.assign(Object.assign({},t.style["group-title"]),e)}if(!IZ(n)){t.style["group-subtitle"]=Object.assign(Object.assign({},t.style["group-subtitle"]),n)}if(!IZ(i)){t.title=i}else{delete t.title}}function Z4(t,e,n,i){const r=i?t[e][i]:t[e];if(e==="view"){n="cell"}const u=Object.assign(Object.assign({},r),t.style[n!==null&&n!==void 0?n:e]);if(!IZ(u)){t.style[n!==null&&n!==void 0?n:e]=u}if(!i){delete t[e]}}function K4(t){return"layer"in t}function t7(t){return"repeat"in t}function e7(t){return!ve(t.repeat)&&t.repeat["layer"]}var n7=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class i7{map(t,e){if(Y6(t)){return this.mapFacet(t,e)}else if(t7(t)){return this.mapRepeat(t,e)}else if(x4(t)){return this.mapHConcat(t,e)}else if(A4(t)){return this.mapVConcat(t,e)}else if(w4(t)){return this.mapConcat(t,e)}else{return this.mapLayerOrUnit(t,e)}}mapLayerOrUnit(t,e){if(K4(t)){return this.mapLayer(t,e)}else if(u9(t)){return this.mapUnit(t,e)}throw new Error(z1(t))}mapLayer(t,e){return Object.assign(Object.assign({},t),{layer:t.layer.map((t=>this.mapLayerOrUnit(t,e)))})}mapHConcat(t,e){return Object.assign(Object.assign({},t),{hconcat:t.hconcat.map((t=>this.map(t,e)))})}mapVConcat(t,e){return Object.assign(Object.assign({},t),{vconcat:t.vconcat.map((t=>this.map(t,e)))})}mapConcat(t,e){const{concat:n}=t,i=n7(t,["concat"]);return Object.assign(Object.assign({},i),{concat:n.map((t=>this.map(t,e)))})}mapFacet(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}mapRepeat(t,e){return Object.assign(Object.assign({},t),{spec:this.map(t.spec,e)})}}const r7={zero:1,center:1,normalize:1};function u7(t){return t in r7}const o7=new Set([T5,L5,P5,W5,q5,Y5,X5,R5,G5,H5]);const s7=new Set([L5,P5,T5]);function a7(t){return s8(t)&&a8(t)==="quantitative"&&!t.bin}function f7(t,e){var n,i;const r=e==="x"?"y":"radius";const u=t[e];const o=t[r];if(s8(u)&&s8(o)){if(a7(u)&&a7(o)){if(u.stack){return e}else if(o.stack){return r}const t=s8(u)&&!!u.aggregate;const s=s8(o)&&!!o.aggregate;if(t!==s){return t?e:r}else{const t=(n=u.scale)===null||n===void 0?void 0:n.type;const s=(i=o.scale)===null||i===void 0?void 0:i.type;if(t&&t!=="linear"){return r}else if(s&&s!=="linear"){return e}}}else if(a7(u)){return e}else if(a7(o)){return r}}else if(a7(u)){return e}else if(a7(o)){return r}return undefined}function c7(t){switch(t){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function l7(t,e,n={}){var i,r;const u=t6(t)?t.type:t;if(!o7.has(u)){return null}const o=f7(e,"x")||f7(e,"theta");if(!o){return null}const s=e[o];const a=s8(s)?A8(s,{}):undefined;const f=c7(o);const c=[];const l=new Set;if(e[f]){const t=e[f];const n=s8(t)?A8(t,{}):undefined;if(n&&n!==a){c.push(f);l.add(n)}const i=f==="x"?"xOffset":"yOffset";const r=e[i];const u=s8(r)?A8(r,{}):undefined;if(u&&u!==a){c.push(i);l.add(u)}}const d=A0.reduce(((t,n)=>{if(n!=="tooltip"&&a9(e,n)){const i=e[n];for(const e of Ue(i)){const i=z8(e);if(i.aggregate){continue}const r=A8(i,{});if(!r||!l.has(r)){t.push({channel:n,fieldDef:i})}}}return t}),[]);let h;if(s.stack!==undefined){if(ln(s.stack)){h=s.stack?"zero":null}else{h=s.stack}}else if(s7.has(u)){h="zero"}if(!h||!u7(h)){return null}if(l9(e)&&d.length===0){return null}if(((i=s===null||s===void 0?void 0:s.scale)===null||i===void 0?void 0:i.type)&&((r=s===null||s===void 0?void 0:s.scale)===null||r===void 0?void 0:r.type)!==f5.LINEAR){if(n.disallowNonLinearStack){return null}else{c3(X2(s.scale.type))}}if(d8(e[p0(o)])){if(s.stack!==undefined){c3(Y2(o))}return null}if(s8(s)&&s.aggregate&&!J0.has(s.aggregate)){c3(J2(s.aggregate))}return{groupbyChannels:c,groupbyFields:l,fieldChannel:o,impute:s.impute===null?false:Q5(u),stackBy:d,offset:h}}var d7=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function h7(t){const e=d7(t,["point","line"]);return RZ(e).length>1?e:e.type}function p7(t){for(const e of["line","area","rule","trail"]){if(t[e]){t=Object.assign(Object.assign({},t),{[e]:DZ(t[e],["point","line"])})}}return t}function m7(t,e={},n){if(t.point==="transparent"){return{opacity:0}}else if(t.point){return ye(t.point)?t.point:{}}else if(t.point!==undefined){return null}else{if(e.point||n.shape){return ye(e.point)?e.point:{}}return undefined}}function g7(t,e={}){if(t.line){return t.line===true?{}:t.line}else if(t.line!==undefined){return null}else{if(e.line){return e.line===true?{}:e.line}return undefined}}class b7{constructor(){this.name="path-overlay"}hasMatchingType(t,e){if(u9(t)){const{mark:n,encoding:i}=t;const r=t6(n)?n:{type:n};switch(r.type){case"line":case"rule":case"trail":return!!m7(r,e[r.type],i);case"area":return!!m7(r,e[r.type],i)||!!g7(r,e[r.type])}}return false}run(t,e,n){const{config:i}=e;const{params:r,projection:u,mark:o,encoding:s}=t,a=d7(t,["params","projection","mark","encoding"]);const f=m9(s,i);const c=t6(o)?o:{type:o};const l=m7(c,i[c.type],f);const d=c.type==="area"&&g7(c,i[c.type]);const h=[Object.assign(Object.assign({},r?{params:r}:{}),{mark:h7(Object.assign(Object.assign({},c.type==="area"&&c.opacity===undefined&&c.fillOpacity===undefined?{opacity:.7}:{}),c)),encoding:DZ(f,["shape"])})];const p=l7(c,f);let m=f;if(p){const{fieldChannel:t,offset:e}=p;m=Object.assign(Object.assign({},f),{[t]:Object.assign(Object.assign({},f[t]),e?{stack:e}:{})})}if(d){h.push(Object.assign(Object.assign({},u?{projection:u}:{}),{mark:Object.assign(Object.assign({type:"line"},FZ(c,["clip","interpolate","tension","tooltip"])),d),encoding:m}))}if(l){h.push(Object.assign(Object.assign({},u?{projection:u}:{}),{mark:Object.assign(Object.assign({type:"point",opacity:1,filled:true},FZ(c,["clip","tooltip"])),l),encoding:m}))}return n(Object.assign(Object.assign({},a),{layer:h}),Object.assign(Object.assign({},e),{config:p7(i)}))}}var v7=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function y7(t,e){if(!e){return t}if(H6(t)){return D7(t,e)}return x7(t,e)}function w7(t,e){if(!e){return t}return D7(t,e)}function A7(t,e,n){const i=e[t];if(Q6(i)){if(i.repeat in n){return Object.assign(Object.assign({},e),{[t]:n[i.repeat]})}else{c3(K1(i.repeat));return undefined}}return e}function x7(t,e){t=A7("field",t,e);if(t===undefined){return undefined}else if(t===null){return null}if(K6(t)&&W6(t.sort)){const n=A7("field",t.sort,e);t=Object.assign(Object.assign({},t),n?{sort:n}:{})}return t}function O7(t,e){if(s8(t)){return x7(t,e)}else{const n=A7("datum",t,e);if(n!==t&&!n.type){n.type="nominal"}return n}}function F7(t,e){if(d8(t)){const n=O7(t,e);if(n){return n}else if(i8(t)){return{condition:t.condition}}}else{if(u8(t)){const n=O7(t.condition,e);if(n){return Object.assign(Object.assign({},t),{condition:n})}else{const e=v7(t,["condition"]);return e}}return t}return undefined}function D7(t,e){const n={};for(const i in t){if(un(t,i)){const r=t[i];if(ve(r)){n[i]=r.map((t=>F7(t,e))).filter((t=>t))}else{const t=F7(r,e);if(t!==undefined){n[i]=t}}}}return n}class k7{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(u9(t)){const{encoding:e,mark:n}=t;if(n==="line"||t6(n)&&n.type==="line"){for(const t of c0){const n=d0(t);const i=e[n];if(e[t]){if(s8(i)&&!t1(i.bin)||f8(i)){return true}}}}}return false}run(t,e,n){const{encoding:i,mark:r}=t;c3($2(!!i.x2,!!i.y2));return n(Object.assign(Object.assign({},t),{mark:ye(r)?Object.assign(Object.assign({},r),{type:"rule"}):"rule"}),e)}}var E7=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class $7 extends i7{constructor(){super(...arguments);this.nonFacetUnitNormalizers=[B9,I9,Q9,new b7,new k7]}map(t,e){if(u9(t)){const n=a9(t.encoding,lK);const i=a9(t.encoding,dK);const r=a9(t.encoding,hK);if(n||i||r){return this.mapFacetedUnit(t,e)}}return super.map(t,e)}mapUnit(t,e){const{parentEncoding:n,parentProjection:i}=e;const r=w7(t.encoding,e.repeater);const u=Object.assign(Object.assign({},t),r?{encoding:r}:{});if(n||i){return this.mapUnitWithParentEncodingOrProjection(u,e)}const o=this.mapLayerOrUnit.bind(this);for(const s of this.nonFacetUnitNormalizers){if(s.hasMatchingType(u,e.config)){return s.run(u,e,o)}}return u}mapRepeat(t,e){if(e7(t)){return this.mapLayerRepeat(t,e)}else{return this.mapNonLayerRepeat(t,e)}}mapLayerRepeat(t,e){const{repeat:n,spec:i}=t,r=E7(t,["repeat","spec"]);const{row:u,column:o,layer:s}=n;const{repeater:a={},repeaterPrefix:f=""}=e;if(u||o){return this.mapRepeat(Object.assign(Object.assign({},t),{repeat:Object.assign(Object.assign({},u?{row:u}:{}),o?{column:o}:{}),spec:{repeat:{layer:s},spec:i}}),e)}else{return Object.assign(Object.assign({},r),{layer:s.map((t=>{const n=Object.assign(Object.assign({},a),{layer:t});const r=`${(i.name||"")+f}child__layer_${GZ(t)}`;const u=this.mapLayerOrUnit(i,Object.assign(Object.assign({},e),{repeater:n,repeaterPrefix:r}));u.name=r;return u}))})}}mapNonLayerRepeat(t,e){var n;const{repeat:i,spec:r,data:u}=t,o=E7(t,["repeat","spec","data"]);if(!ve(i)&&t.columns){t=DZ(t,["columns"]);c3(t2("repeat"))}const s=[];const{repeater:a={},repeaterPrefix:f=""}=e;const c=!ve(i)&&i.row||[a?a.row:null];const l=!ve(i)&&i.column||[a?a.column:null];const d=ve(i)&&i||[a?a.repeat:null];for(const p of d){for(const t of c){for(const n of l){const u={repeat:p,row:t,column:n,layer:a.layer};const o=(r.name||"")+f+"child__"+(ve(i)?`${GZ(p)}`:(i.row?`row_${GZ(t)}`:"")+(i.column?`column_${GZ(n)}`:""));const c=this.map(r,Object.assign(Object.assign({},e),{repeater:u,repeaterPrefix:o}));c.name=o;s.push(DZ(c,["data"]))}}}const h=ve(i)?t.columns:i.column?i.column.length:1;return Object.assign(Object.assign({data:(n=r.data)!==null&&n!==void 0?n:u,align:"all"},o),{columns:h,concat:s})}mapFacet(t,e){const{facet:n}=t;if(H6(n)&&t.columns){t=DZ(t,["columns"]);c3(t2("facet"))}return super.mapFacet(t,e)}mapUnitWithParentEncodingOrProjection(t,e){const{encoding:n,projection:i}=t;const{parentEncoding:r,parentProjection:u,config:o}=e;const s=C7({parentProjection:u,projection:i});const a=j7({parentEncoding:r,encoding:w7(n,e.repeater)});return this.mapUnit(Object.assign(Object.assign(Object.assign({},t),s?{projection:s}:{}),a?{encoding:a}:{}),{config:o})}mapFacetedUnit(t,e){const n=t.encoding,{row:i,column:r,facet:u}=n,o=E7(n,["row","column","facet"]);const{mark:s,width:a,projection:f,height:c,view:l,params:d,encoding:h}=t,p=E7(t,["mark","width","projection","height","view","params","encoding"]);const{facetMapping:m,layout:g}=this.getFacetMappingAndLayout({row:i,column:r,facet:u},e);const b=w7(o,e.repeater);return this.mapFacet(Object.assign(Object.assign(Object.assign({},p),g),{facet:m,spec:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a?{width:a}:{}),c?{height:c}:{}),l?{view:l}:{}),f?{projection:f}:{}),{mark:s,encoding:b}),d?{params:d}:{})}),e)}getFacetMappingAndLayout(t,e){var n;const{row:i,column:r,facet:u}=t;if(i||r){if(u){c3(D2([...i?[lK]:[],...r?[dK]:[]]))}const e={};const o={};for(const i of[lK,dK]){const r=t[i];if(r){const t=E7(r,["align","center","spacing","columns"]);e[i]=t;for(const e of["align","center","spacing"]){if(r[e]!==undefined){(n=o[e])!==null&&n!==void 0?n:o[e]={};o[e][i]=r[e]}}}}return{facetMapping:e,layout:o}}else{const{align:t,center:n,spacing:i,columns:r}=u,o=E7(u,["align","center","spacing","columns"]);return{facetMapping:y7(o,e.repeater),layout:Object.assign(Object.assign(Object.assign(Object.assign({},t?{align:t}:{}),n?{center:n}:{}),i?{spacing:i}:{}),r?{columns:r}:{})}}}mapLayer(t,e){var{parentEncoding:n,parentProjection:i}=e,r=E7(e,["parentEncoding","parentProjection"]);const{encoding:u,projection:o}=t,s=E7(t,["encoding","projection"]);const a=Object.assign(Object.assign({},r),{parentEncoding:j7({parentEncoding:n,encoding:u,layer:true}),parentProjection:C7({parentProjection:i,projection:o})});return super.mapLayer(s,a)}}function j7({parentEncoding:t,encoding:e={},layer:n}){let i={};if(t){const r=new Set([...RZ(t),...RZ(e)]);for(const u of r){const r=e[u];const o=t[u];if(d8(r)){const t=Object.assign(Object.assign({},o),r);i[u]=t}else if(u8(r)){i[u]=Object.assign(Object.assign({},r),{condition:Object.assign(Object.assign({},o),r.condition)})}else if(r||r===null){i[u]=r}else if(n||p8(o)||f1(o)||d8(o)||ve(o)){i[u]=o}}}else{i=e}return!i||IZ(i)?undefined:i}function C7(t){const{parentProjection:e,projection:n}=t;if(e&&n){c3(a2({parentProjection:e,projection:n}))}return n!==null&&n!==void 0?n:e}function M7(t){return"filter"in t}function B7(t){return(t===null||t===void 0?void 0:t["stop"])!==undefined}function S7(t){return"lookup"in t}function _7(t){return"data"in t}function N7(t){return"param"in t}function z7(t){return"pivot"in t}function T7(t){return"density"in t}function P7(t){return"quantile"in t}function L7(t){return"regression"in t}function I7(t){return"loess"in t}function R7(t){return"sample"in t}function q7(t){return"window"in t}function U7(t){return"joinaggregate"in t}function W7(t){return"flatten"in t}function G7(t){return"calculate"in t}function H7(t){return"bin"in t}function V7(t){return"impute"in t}function Y7(t){return"timeUnit"in t}function X7(t){return"aggregate"in t}function J7(t){return"stack"in t}function Q7(t){return"fold"in t}function Z7(t){return t.map((t=>{if(M7(t)){return{filter:wZ(t.filter,Z3)}}return t}))}var K7=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class ttt extends i7{map(t,e){var n,i;(n=e.emptySelections)!==null&&n!==void 0?n:e.emptySelections={};(i=e.selectionPredicates)!==null&&i!==void 0?i:e.selectionPredicates={};t=ett(t,e);return super.map(t,e)}mapLayerOrUnit(t,e){t=ett(t,e);if(t.encoding){const n={};for(const[i,r]of UZ(t.encoding)){n[i]=ntt(r,e)}t=Object.assign(Object.assign({},t),{encoding:n})}return super.mapLayerOrUnit(t,e)}mapUnit(t,e){const n=t,{selection:i}=n,r=K7(n,["selection"]);if(i){return Object.assign(Object.assign({},r),{params:UZ(i).map((([t,n])=>{var i;const r=n,{init:u,bind:o,empty:s}=r,a=K7(r,["init","bind","empty"]);if(a.type==="single"){a.type="point";a.toggle=false}else if(a.type==="multi"){a.type="point"}e.emptySelections[t]=s!=="none";for(const f of qZ((i=e.selectionPredicates[t])!==null&&i!==void 0?i:{})){f.empty=s!=="none"}return{name:t,value:u,select:a,bind:o}}))})}return t}}function ett(t,e){const{transform:n}=t,i=K7(t,["transform"]);if(n){const t=n.map((t=>{if(M7(t)){return{filter:rtt(t,e)}}else if(H7(t)&&e1(t.bin)){return Object.assign(Object.assign({},t),{bin:itt(t.bin)})}else if(S7(t)){const e=t.from,{selection:n}=e,i=K7(e,["selection"]);return n?Object.assign(Object.assign({},t),{from:Object.assign({param:n},i)}):t}return t}));return Object.assign(Object.assign({},i),{transform:t})}return t}function ntt(t,e){var n,i;const r=xZ(t);if(s8(r)&&e1(r.bin)){r.bin=itt(r.bin)}if(m8(r)&&((i=(n=r.scale)===null||n===void 0?void 0:n.domain)===null||i===void 0?void 0:i.selection)){const t=r.scale.domain,{selection:e}=t,n=K7(t,["selection"]);r.scale.domain=Object.assign(Object.assign({},n),e?{param:e}:{})}if(i8(r)){if(ve(r.condition)){r.condition=r.condition.map((t=>{const{selection:n,param:i,test:r}=t,u=K7(t,["selection","param","test"]);return i?t:Object.assign(Object.assign({},u),{test:rtt(t,e)})}))}else{const t=ntt(r.condition,e),{selection:n,param:i,test:u}=t,o=K7(t,["selection","param","test"]);r.condition=i?r.condition:Object.assign(Object.assign({},o),{test:rtt(r.condition,e)})}}return r}function itt(t){const e=t.extent;if(e===null||e===void 0?void 0:e.selection){const{selection:n}=e,i=K7(e,["selection"]);return Object.assign(Object.assign({},t),{extent:Object.assign(Object.assign({},i),{param:n})})}return t}function rtt(t,e){const n=t=>wZ(t,(t=>{var n,i;var r;const u=(n=e.emptySelections[t])!==null&&n!==void 0?n:true;const o={param:t,empty:u};(i=(r=e.selectionPredicates)[t])!==null&&i!==void 0?i:r[t]=[];e.selectionPredicates[t].push(o);return o}));return t.selection?n(t.selection):wZ(t.test||t.filter,(t=>t.selection?n(t.selection):t))}class utt extends i7{map(t,e){var n;const i=(n=e.selections)!==null&&n!==void 0?n:[];if(t.params&&!u9(t)){const e=[];for(const n of t.params){if(g4(n)){i.push(n)}else{e.push(n)}}t.params=e}e.selections=i;return super.map(t,ott(t,e))}mapUnit(t,e){var n;const i=e.selections;if(!i||!i.length)return t;const r=((n=e.path)!==null&&n!==void 0?n:[]).concat(t.name);const u=[];for(const o of i){if(!o.views||!o.views.length){u.push(o)}else{for(const e of o.views){if(gn(e)&&(e===t.name||r.indexOf(e)>=0)||ve(e)&&e.map((t=>r.indexOf(t))).every(((t,e,n)=>t!==-1&&(e===0||t>n[e-1])))){u.push(o)}}}}if(u.length)t.params=u;return t}}for(const Set of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=utt.prototype[Set];utt.prototype[Set]=function(e,n){return t.call(this,e,ott(e,n))}}function ott(t,e){var n;return t.name?Object.assign(Object.assign({},e),{path:((n=e.path)!==null&&n!==void 0?n:[]).concat(t.name)}):e}function stt(t,e){if(e===undefined){e=H4(t.config)}const n=ltt(t,e);const{width:i,height:r}=t;const u=htt(n,{width:i,height:r,autosize:t.autosize},e);return Object.assign(Object.assign({},n),u?{autosize:u}:{})}const att=new $7;const ftt=new ttt;const ctt=new utt;function ltt(t,e={}){const n={config:e};return ctt.map(att.map(ftt.map(t,n),n),n)}function dtt(t){return gn(t)?{type:t}:t!==null&&t!==void 0?t:{}}function htt(t,e,n){let{width:i,height:r}=e;const u=u9(t)||K4(t);const o={};if(!u){if(i=="container"){c3(P1("width"));i=undefined}if(r=="container"){c3(P1("height"));r=undefined}}else{if(i=="container"&&r=="container"){o.type="fit";o.contains="padding"}else if(i=="container"){o.type="fit-x";o.contains="padding"}else if(r=="container"){o.type="fit-y";o.contains="padding"}}const s=Object.assign(Object.assign(Object.assign({type:"pad"},o),n?dtt(n.autosize):{}),dtt(t.autosize));if(s.type==="fit"&&!u){c3(T1);s.type="pad"}if(i=="container"&&!(s.type=="fit"||s.type=="fit-x")){c3(L1("width"))}if(r=="container"&&!(s.type=="fit"||s.type=="fit-y")){c3(L1("height"))}if(AZ(s,{type:"pad"})){return undefined}return s}function ptt(t){return t==="fit"||t==="fit-x"||t==="fit-y"}function mtt(t){return t?`fit-${E0(t)}`:"fit"}const gtt=["background","padding"];function btt(t,e){const n={};for(const i of gtt){if(t&&t[i]!==undefined){n[i]=w1(t[i])}}if(e){n.params=t.params}return n}class vtt{constructor(t={},e={}){this.explicit=t;this.implicit=e}clone(){return new vtt(xZ(this.explicit),xZ(this.implicit))}combine(){return Object.assign(Object.assign({},this.explicit),this.implicit)}get(t){return nK(this.explicit[t],this.implicit[t])}getWithExplicit(t){if(this.explicit[t]!==undefined){return{explicit:true,value:this.explicit[t]}}else if(this.implicit[t]!==undefined){return{explicit:false,value:this.implicit[t]}}return{explicit:false,value:undefined}}setWithExplicit(t,{value:e,explicit:n}){if(e!==undefined){this.set(t,e,n)}}set(t,e,n){delete this[n?"implicit":"explicit"][t];this[n?"explicit":"implicit"][t]=e;return this}copyKeyFromSplit(t,{explicit:e,implicit:n}){if(e[t]!==undefined){this.set(t,e[t],true)}else if(n[t]!==undefined){this.set(t,n[t],false)}}copyKeyFromObject(t,e){if(e[t]!==undefined){this.set(t,e[t],true)}}copyAll(t){for(const e of RZ(t.combine())){const n=t.getWithExplicit(e);this.setWithExplicit(e,n)}}}function ytt(t){return{explicit:true,value:t}}function wtt(t){return{explicit:false,value:t}}function Att(t){return(e,n,i,r)=>{const u=t(e.value,n.value);if(u>0){return e}else if(u<0){return n}return xtt(e,n,i,r)}}function xtt(t,e,n,i){if(t.explicit&&e.explicit){c3(I2(n,i,t.value,e.value))}return t}function Ott(t,e,n,i,r=xtt){if(t===undefined||t.value===undefined){return e}if(t.explicit&&!e.explicit){return t}else if(e.explicit&&!t.explicit){return e}else if(AZ(t.value,e.value)){return t}else{return r(t,e,n,i)}}class Ftt extends vtt{constructor(t={},e={},n=false){super(t,e);this.explicit=t;this.implicit=e;this.parseNothing=n}clone(){const t=super.clone();t.parseNothing=this.parseNothing;return t}}function Dtt(t){return"url"in t}function ktt(t){return"values"in t}function Ett(t){return"name"in t&&!Dtt(t)&&!ktt(t)&&!$tt(t)}function $tt(t){return t&&(jtt(t)||Ctt(t)||Mtt(t))}function jtt(t){return"sequence"in t}function Ctt(t){return"sphere"in t}function Mtt(t){return"graticule"in t}var Btt;(function(t){t[t["Raw"]=0]="Raw";t[t["Main"]=1]="Main";t[t["Row"]=2]="Row";t[t["Column"]=3]="Column";t[t["Lookup"]=4]="Lookup"})(Btt||(Btt={}));var Stt=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function _tt(t,e=true,n=oe){if(ve(t)){const i=t.map((t=>_tt(t,e,n)));return e?`[${i.join(", ")}]`:i}else if(d3(t)){if(e){return n(A3(t))}else{return n(O3(t))}}return e?n(kZ(t)):t}function Ntt(t,e){var n;for(const i of qZ((n=t.component.selection)!==null&&n!==void 0?n:{})){const n=i.name;let r=`${n}${cnt}, ${i.resolve==="global"?"true":`{unit: ${mnt(t)}}`}`;for(const u of hnt){if(!u.defined(i))continue;if(u.signals)e=u.signals(t,i,e);if(u.modifyExpr)r=u.modifyExpr(t,i,r)}e.push({name:n+lnt,on:[{events:{signal:i.name+cnt},update:`modify(${Dn(i.name+fnt)}, ${r})`}]})}return qtt(e)}function ztt(t,e){if(t.component.selection&&RZ(t.component.selection).length){const n=Dn(t.getName("cell"));e.unshift({name:"facet",value:{},on:[{events:oH("mousemove","scope"),update:`isTuple(facet) ? facet : group(${n}).datum`}]})}return qtt(e)}function Ttt(t,e){var n;let i=false;for(const r of qZ((n=t.component.selection)!==null&&n!==void 0?n:{})){const n=r.name;const u=Dn(n+fnt);const o=e.filter((t=>t.name===n));if(o.length===0){const t=r.resolve==="global"?"union":r.resolve;const n=r.type==="point"?", true, true)":")";e.push({name:r.name,update:`${dnt}(${u}, ${Dn(t)}${n}`})}i=true;for(const i of hnt){if(i.defined(r)&&i.topLevelSignals){e=i.topLevelSignals(t,r,e)}}}if(i){const t=e.filter((t=>t.name==="unit"));if(t.length===0){e.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]})}}return qtt(e)}function Ptt(t,e){var n;const i=[...e];for(const r of qZ((n=t.component.selection)!==null&&n!==void 0?n:{})){const e={name:r.name+fnt};if(r.init){const n=r.project.items.map((t=>{const e=Stt(t,["signals"]);return e}));e.values=r.init.map((e=>({unit:mnt(t,{escape:false}),fields:n,values:_tt(e,false)})))}const n=i.filter((t=>t.name===r.name+fnt));if(!n.length){i.push(e)}}return i}function Ltt(t,e){var n;for(const i of qZ((n=t.component.selection)!==null&&n!==void 0?n:{})){for(const n of hnt){if(n.defined(i)&&n.marks){e=n.marks(t,i,e)}}}return e}function Itt(t,e){for(const n of t.children){if(wot(n)){e=Ltt(n,e)}}return e}function Rtt(t,e,n,i){const r=Fnt(t,e.param,e);return{signal:A5(n.get("type"))&&ve(i)&&i[0]>i[1]?`isValid(${r}) && reverse(${r})`:r}}function qtt(t){return t.map((t=>{if(t.on&&!t.on.length)delete t.on;return t}))}class Utt{constructor(t,e){this.debugName=e;this._children=[];this._parent=null;if(t){this.parent=t}}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t;if(t){t.addChild(this)}}get children(){return this._children}numChildren(){return this._children.length}addChild(t,e){if(this._children.includes(t)){c3(r2);return}if(e!==undefined){this._children.splice(e,0,t)}else{this._children.push(t)}}removeChild(t){const e=this._children.indexOf(t);this._children.splice(e,1);return e}remove(){let t=this._parent.removeChild(this);for(const e of this._children){e._parent=this._parent;this._parent.addChild(e,t++)}}insertAsParentOf(t){const e=t.parent;e.removeChild(this);this.parent=e;t.parent=this}swapWithParent(){const t=this._parent;const e=t.parent;for(const n of this._children){n.parent=t}this._children=[];t.removeChild(this);t.parent.removeChild(t);this.parent=e;t.parent=this}}class Wtt extends Utt{constructor(t,e,n,i){super(t,e);this.type=n;this.refCounts=i;this._source=this._name=e;if(this.refCounts&&!(this._name in this.refCounts)){this.refCounts[this._name]=0}}clone(){const t=new this.constructor;t.debugName=`clone_${this.debugName}`;t._source=this._source;t._name=`clone_${this._name}`;t.type=this.type;t.refCounts=this.refCounts;t.refCounts[t._name]=0;return t}dependentFields(){return new Set}producedFields(){return new Set}hash(){if(this._hash===undefined){this._hash=`Output ${rK()}`}return this._hash}getSource(){this.refCounts[this._name]++;return this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}var Gtt=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class Htt extends Utt{constructor(t,e){super(t);this.formula=e}clone(){return new Htt(null,xZ(this.formula))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,e)=>{const{field:n,timeUnit:i}=e;if(i){const r=A8(e,{forAs:true});t[EZ({as:r,field:n,timeUnit:i})]={as:r,field:n,timeUnit:i}}return t}),{});if(IZ(n)){return null}return new Htt(t,n)}static makeFromTransform(t,e){const n=Object.assign({},e),{timeUnit:i}=n,r=Gtt(n,["timeUnit"]);const u=z3(i);const o=Object.assign(Object.assign({},r),{timeUnit:u});return new Htt(t,{[EZ(o)]:o})}merge(t){this.formula=Object.assign({},this.formula);for(const e in t.formula){if(!this.formula[e]){this.formula[e]=t.formula[e]}}for(const e of t.children){t.removeChild(e);e.parent=this}t.remove()}removeFormulas(t){const e={};for(const[n,i]of UZ(this.formula)){if(!t.has(i.as)){e[n]=i}}this.formula=e}producedFields(){return new Set(qZ(this.formula).map((t=>t.as)))}dependentFields(){return new Set(qZ(this.formula).map((t=>t.field)))}hash(){return`TimeUnit ${EZ(this.formula)}`}assemble(){const t=[];for(const e of qZ(this.formula)){const{field:n,as:i,timeUnit:r}=e;const u=z3(r),{unit:o,utc:s}=u,a=Gtt(u,["unit","utc"]);t.push(Object.assign(Object.assign(Object.assign(Object.assign({field:ZZ(n),type:"timeunit"},o?{units:M3(o)}:{}),s?{timezone:"utc"}:{}),a),{as:[i,`${i}_end`]}))}return t}}var Vtt=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const Ytt="_tuple_fields";class Xtt{constructor(...t){this.items=t;this.hasChannel={};this.hasField={}}}const Jtt={defined:()=>true,parse:(t,e,n)=>{var i;const r=e.name;const u=(i=e.project)!==null&&i!==void 0?i:e.project=new Xtt;const o={};const s={};const a=new Set;const f=(t,e)=>{const n=e==="visual"?t.channel:t.field;let i=GZ(`${r}_${n}`);for(let u=1;a.has(i);u++){i=GZ(`${r}_${n}_${u}`)}a.add(i);return{[e]:i}};const c=e.type;const l=t.config.selection[c];const d=n.value!==undefined?Ue(n.value):null;let{fields:h,encodings:p}=ye(n.select)?n.select:{};if(!h&&!p&&d){for(const t of d){if(!ye(t)){continue}for(const e of RZ(t)){if(a0(e)){(p||(p=[])).push(e)}else{if(c==="interval"){c3(Z1);p=l.encodings}else{(h||(h=[])).push(e)}}}}}if(!h&&!p){p=l.encodings;if("fields"in l){h=l.fields}}for(const m of p!==null&&p!==void 0?p:[]){const e=t.fieldDef(m);if(e){let n=e.field;if(e.aggregate){c3(U1(m,e.aggregate));continue}else if(!n){c3(q1(m));continue}if(e.timeUnit){n=t.vgField(m);const i={timeUnit:e.timeUnit,as:n,field:e.field};s[EZ(i)]=i}if(!o[n]){let i="E";if(c==="interval"){const e=t.getScaleComponent(m).get("type");if(A5(e)){i="R"}}else if(e.bin){i="R-RE"}const r={field:n,channel:m,type:i};r.signals=Object.assign(Object.assign({},f(r,"data")),f(r,"visual"));u.items.push(o[n]=r);u.hasField[n]=u.hasChannel[m]=o[n]}}else{c3(q1(m))}}for(const m of h!==null&&h!==void 0?h:[]){if(u.hasField[m])continue;const t={type:"E",field:m};t.signals=Object.assign({},f(t,"data"));u.items.push(t);u.hasField[m]=t}if(d){e.init=d.map((t=>u.items.map((e=>ye(t)?t[e.channel]!==undefined?t[e.channel]:t[e.field]:t))))}if(!IZ(s)){u.timeUnit=new Htt(null,s)}},signals:(t,e,n)=>{const i=e.name+Ytt;const r=n.filter((t=>t.name===i));return r.length>0?n:n.concat({name:i,value:e.project.items.map((t=>{const e=Vtt(t,["signals","hasLegend"]);e.field=ZZ(e.field);return e}))})}};const Qtt={defined:t=>t.type==="interval"&&t.resolve==="global"&&t.bind&&t.bind==="scales",parse:(t,e)=>{const n=e.scales=[];for(const i of e.project.items){const r=i.channel;if(!z0(r)){continue}const u=t.getScaleComponent(r);const o=u?u.get("type"):undefined;if(!u||!A5(o)){c3(V1);continue}u.set("selectionExtent",{param:e.name,field:i.field},true);n.push(i)}},topLevelSignals:(t,e,n)=>{const i=e.scales.filter((t=>n.filter((e=>e.name===t.signals.data)).length===0));if(!t.parent||Ktt(t)||i.length===0){return n}const r=n.filter((t=>t.name===e.name))[0];let u=r.update;if(u.indexOf(dnt)>=0){r.update=`{${i.map((t=>`${Dn(ZZ(t.field))}: ${t.signals.data}`)).join(", ")}}`}else{for(const t of i){const e=`${Dn(ZZ(t.field))}: ${t.signals.data}`;if(!u.includes(e)){u=`${u.substring(0,u.length-1)}, ${e}}`}}r.update=u}return n.concat(i.map((t=>({name:t.signals.data}))))},signals:(t,e,n)=>{if(t.parent&&!Ktt(t)){for(const t of e.scales){const e=n.filter((e=>e.name===t.signals.data))[0];e.push="outer";delete e.value;delete e.update}}return n}};function Ztt(t,e){const n=Dn(t.scaleName(e));return`domain(${n})`}function Ktt(t){var e;return t.parent&&Oot(t.parent)&&((e=!t.parent.parent)!==null&&e!==void 0?e:Ktt(t.parent.parent))}var tet=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};const eet="_brush";const net="_scale_trigger";const iet={defined:t=>t.type==="interval",signals:(t,e,n)=>{const i=e.name;const r=i+Ytt;const u=Qtt.defined(e);const o=e.init?e.init[0]:null;const s=[];const a=[];if(e.translate&&!u){const t=`!event.item || event.item.mark.name !== ${Dn(i+eet)}`;uet(e,((e,n)=>{var i;var r;const u=Ue((i=(r=n.between[0]).filter)!==null&&i!==void 0?i:r.filter=[]);if(!u.includes(t)){u.push(t)}return e}))}e.project.items.forEach(((i,r)=>{const u=i.channel;if(u!==pK&&u!==mK){c3("Interval selections only support x and y encoding channels.");return}const f=o?o[r]:null;const c=ret(t,e,i,f);const l=i.signals.data;const d=i.signals.visual;const h=Dn(t.scaleName(u));const p=t.getScaleComponent(u).get("type");const m=A5(p)?"+":"";n.push(...c);s.push(l);a.push({scaleName:t.scaleName(u),expr:`(!isArray(${l}) || `+`(${m}invert(${h}, ${d})[0] === ${m}${l}[0] && `+`${m}invert(${h}, ${d})[1] === ${m}${l}[1]))`})}));if(!u&&a.length){n.push({name:i+net,value:{},on:[{events:a.map((t=>({scale:t.scaleName}))),update:`${a.map((t=>t.expr)).join(" && ")} ? ${i+net} : {}`}]})}const f=`unit: ${mnt(t)}, fields: ${r}, values`;return n.concat(Object.assign(Object.assign({name:i+cnt},o?{init:`{${f}: ${_tt(o)}}`}:{}),s.length?{on:[{events:[{signal:s.join(" || ")}],update:`${s.join(" && ")} ? {${f}: [${s}]} : null`}]}:{}))},marks:(t,e,n)=>{const i=e.name;const{x:r,y:u}=e.project.hasChannel;const o=r===null||r===void 0?void 0:r.signals.visual;const s=u===null||u===void 0?void 0:u.signals.visual;const a=`data(${Dn(e.name+fnt)})`;if(Qtt.defined(e)||!r&&!u){return n}const f={x:r!==undefined?{signal:`${o}[0]`}:{value:0},y:u!==undefined?{signal:`${s}[0]`}:{value:0},x2:r!==undefined?{signal:`${o}[1]`}:{field:{group:"width"}},y2:u!==undefined?{signal:`${s}[1]`}:{field:{group:"height"}}};if(e.resolve==="global"){for(const e of RZ(f)){f[e]=[Object.assign({test:`${a}.length && ${a}[0].unit === ${mnt(t)}`},f[e]),{value:0}]}}const c=e.mark,{fill:l,fillOpacity:d,cursor:h}=c,p=tet(c,["fill","fillOpacity","cursor"]);const m=RZ(p).reduce(((t,e)=>{t[e]=[{test:[r!==undefined&&`${o}[0] !== ${o}[1]`,u!==undefined&&`${s}[0] !== ${s}[1]`].filter((t=>t)).join(" && "),value:p[e]},{value:null}];return t}),{});return[{name:`${i+eet}_bg`,type:"rect",clip:true,encode:{enter:{fill:{value:l},fillOpacity:{value:d}},update:f}},...n,{name:i+eet,type:"rect",clip:true,encode:{enter:Object.assign(Object.assign({},h?{cursor:{value:h}}:{}),{fill:{value:"transparent"}}),update:Object.assign(Object.assign({},f),m)}}]}};function ret(t,e,n,i){const r=n.channel;const u=n.signals.visual;const o=n.signals.data;const s=Qtt.defined(e);const a=Dn(t.scaleName(r));const f=t.getScaleComponent(r);const c=f?f.get("type"):undefined;const l=t=>`scale(${a}, ${t})`;const d=t.getSizeSignalRef(r===pK?"width":"height").signal;const h=`${r}(unit)`;const p=uet(e,((t,e)=>[...t,{events:e.between[0],update:`[${h}, ${h}]`},{events:e,update:`[${u}[0], clamp(${h}, 0, ${d})]`}]));p.push({events:{signal:e.name+net},update:A5(c)?`[${l(`${o}[0]`)}, ${l(`${o}[1]`)}]`:`[0, 0]`});return s?[{name:o,on:[]}]:[Object.assign(Object.assign({name:u},i?{init:_tt(i,true,l)}:{value:[]}),{on:p}),Object.assign(Object.assign({name:o},i?{init:_tt(i)}:{}),{on:[{events:{signal:u},update:`${u}[0] === ${u}[1] ? null : invert(${a}, ${u})`}]})]}function uet(t,e){return t.events.reduce(((t,n)=>{if(!n.between){c3(`${n} is not an ordered event stream for interval selections.`);return t}return e(t,n)}),[])}const oet={defined:t=>t.type==="point",signals:(t,e,n)=>{var i;const r=e.name;const u=r+Ytt;const o=e.project;const s="(item().isVoronoi ? datum.datum : datum)";const a=o.items.map((e=>{const n=t.fieldDef(e.channel);return(n===null||n===void 0?void 0:n.bin)?`[${s}[${Dn(t.vgField(e.channel,{}))}], `+`${s}[${Dn(t.vgField(e.channel,{binSuffix:"end"}))}]]`:`${s}[${Dn(e.field)}]`})).join(", ");const f=`unit: ${mnt(t)}, fields: ${u}, values`;const c=e.events;const l=qZ((i=t.component.selection)!==null&&i!==void 0?i:{}).reduce(((t,e)=>e.type==="interval"?t.concat(e.name+eet):t),[]).map((t=>`indexof(item().mark.name, '${t}') < 0`)).join(" && ");const d=`datum && item().mark.marktype !== 'group'${l?` && ${l}`:""}`;return n.concat([{name:r+cnt,on:c?[{events:c,update:`${d} ? {${f}: [${a}]} : null`,force:true}]:[]}])}};function set(t,e,n,i){const r=i8(e)&&e.condition;const u=i(e);if(r){const e=Ue(r);const o=e.map((e=>{const n=i(e);if(J6(e)){const{param:i,empty:r}=e;const u=Ont(t,{param:i,empty:r});return Object.assign({test:u},n)}else{const i=knt(t,e.test);return Object.assign({test:i},n)}}));return{[n]:[...o,...u!==undefined?[u]:[]]}}else{return u!==undefined?{[n]:u}:{}}}function aet(t,e="text"){const n=t.encoding[e];return set(t,n,e,(e=>fet(e,t.config)))}function fet(t,e,n="datum"){if(t){if(p8(t)){return x1(t.value)}if(d8(t)){const{format:i,formatType:r}=_8(t);return j6({fieldOrDatumDef:t,format:i,formatType:r,expr:n,config:e})}}return undefined}function cet(t,e={}){const{encoding:n,markDef:i,config:r,stack:u}=t;const o=n.tooltip;if(ve(o)){return{tooltip:het({tooltip:o},u,r,e)}}else{const s=e.reactiveGeom?"datum.datum":"datum";return set(t,o,"tooltip",(t=>{const o=fet(t,r,s);if(o){return o}if(t===null){return undefined}let a=$1("tooltip",i,r);if(a===true){a={content:"encoding"}}if(gn(a)){return{value:a}}else if(ye(a)){if(f1(a)){return a}else if(a.content==="encoding"){return het(n,u,r,e)}else{return{signal:s}}}return undefined}))}}function det(t,e,n,{reactiveGeom:i}={}){const r={};const u=i?"datum.datum":"datum";const o=[];function s(i,s){const a=d0(s);const f=h8(i)?i:Object.assign(Object.assign({},i),{type:t[a].type});const c=f.title||S8(f,n);const l=Ue(c).join(", ");let d;if(F0(s)){const i=s==="x"?"x2":"y2";const o=z8(t[i]);if(t1(f.bin)&&o){const t=A8(f,{expr:u});const e=A8(o,{expr:u});const{format:s,formatType:a}=_8(f);d=P6(t,e,s,a,n);r[i]=true}else if(e&&e.fieldChannel===s&&e.offset==="normalize"){const{format:t,formatType:e}=_8(f);d=j6({fieldOrDatumDef:f,format:t,formatType:e,expr:u,config:n,normalizeStack:true}).signal}}d!==null&&d!==void 0?d:d=fet(f,n,u).signal;o.push({channel:s,key:l,value:d})}b9(t,((t,e)=>{if(s8(t)){s(t,e)}else if(r8(t)){s(t.condition,e)}}));const a={};for(const{channel:f,key:c,value:l}of o){if(!r[f]&&!a[c]){a[c]=l}}return a}function het(t,e,n,{reactiveGeom:i}={}){const r=det(t,e,n,{reactiveGeom:i});const u=UZ(r).map((([t,e])=>`"${t}": ${e}`));return u.length>0?{signal:`{${u.join(", ")}}`}:undefined}function pet(t){const{markDef:e,config:n}=t;const i=$1("aria",e,n);if(i===false){return{}}return Object.assign(Object.assign(Object.assign({},i?{aria:i}:{}),met(t)),get(t))}function met(t){const{mark:e,markDef:n,config:i}=t;if(i.aria===false){return{}}const r=$1("ariaRoleDescription",n,i);if(r!=null){return{ariaRoleDescription:{value:r}}}return e in g1?{}:{ariaRoleDescription:{value:e}}}function get(t){const{encoding:e,markDef:n,config:i,stack:r}=t;const u=e.description;if(u){return set(t,u,"description",(e=>fet(e,t.config)))}const o=$1("description",n,i);if(o!=null){return{description:x1(o)}}if(i.aria===false){return{}}const s=det(e,r,i);if(IZ(s)){return undefined}return{description:{signal:UZ(s).map((([t,e],n)=>`"${n>0?"; ":""}${t}: " + (${e})`)).join(" + ")}}}function bet(t,e,n={}){const{markDef:i,encoding:r,config:u}=e;const{vgChannel:o}=n;let{defaultRef:s,defaultValue:a}=n;if(s===undefined){a!==null&&a!==void 0?a:a=$1(t,i,u,{vgChannel:o,ignoreVgConfig:true});if(a!==undefined){s=x1(a)}}const f=r[t];return set(e,f,o!==null&&o!==void 0?o:t,(n=>F6({channel:t,channelDef:n,markDef:i,config:u,scaleName:e.scaleName(t),scale:e.getScaleComponent(t),stack:null,defaultRef:s})))}function vet(t,e={filled:undefined}){var n,i,r,u;const{markDef:o,encoding:s,config:a}=t;const{type:f}=o;const c=(n=e.filled)!==null&&n!==void 0?n:$1("filled",o,a);const l=jZ(["bar","point","circle","square","geoshape"],f)?"transparent":undefined;const d=(r=(i=$1(c===true?"color":undefined,o,a,{vgChannel:"fill"}))!==null&&i!==void 0?i:a.mark[c===true&&"color"])!==null&&r!==void 0?r:l;const h=(u=$1(c===false?"color":undefined,o,a,{vgChannel:"stroke"}))!==null&&u!==void 0?u:a.mark[c===false&&"color"];const p=c?"fill":"stroke";const m=Object.assign(Object.assign({},d?{fill:x1(d)}:{}),h?{stroke:x1(h)}:{});if(o.color&&(c?o.fill:o.stroke)){c3(g2("property",{fill:"fill"in o,stroke:"stroke"in o}))}return Object.assign(Object.assign(Object.assign(Object.assign({},m),bet("color",t,{vgChannel:p,defaultValue:c?d:h})),bet("fill",t,{defaultValue:s.fill?d:undefined})),bet("stroke",t,{defaultValue:s.stroke?h:undefined}))}function yet(t){const{encoding:e,mark:n}=t;const i=e.order;if(!Q5(n)&&p8(i)){return set(t,i,"zindex",(t=>x1(t.value)))}return{}}function wet({channel:t,markDef:e,encoding:n={},model:i,bandPosition:r}){const u=`${t}Offset`;const o=e[u];const s=n[u];if((u==="xOffset"||u==="yOffset")&&s){const t=F6({channel:u,channelDef:s,markDef:e,config:i===null||i===void 0?void 0:i.config,scaleName:i.scaleName(u),scale:i.getScaleComponent(u),stack:null,defaultRef:x1(o),bandPosition:r});return{offsetType:"encoding",offset:t}}const a=e[u];if(a){return{offsetType:"visual",offset:a}}return{}}function Aet(t,e,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:u,config:o,stack:s}=e;const a=r[t];const f=r[p0(t)];const c=e.scaleName(t);const l=e.getScaleComponent(t);const{offset:d,offsetType:h}=wet({channel:t,markDef:u,encoding:r,model:e,bandPosition:.5});const p=Oet({model:e,defaultPos:n,channel:t,scaleName:c,scale:l});const m=!a&&F0(t)&&(r.latitude||r.longitude)?{field:e.getName(t)}:xet({channel:t,channelDef:a,channel2Def:f,markDef:u,config:o,scaleName:c,scale:l,stack:s,offset:d,defaultRef:p,bandPosition:h==="encoding"?0:undefined});return m?{[i||t]:m}:undefined}function xet(t){const{channel:e,channelDef:n,scaleName:i,stack:r,offset:u,markDef:o}=t;if(d8(n)&&r&&e===r.fieldChannel){if(s8(n)){let t=n.bandPosition;if(t===undefined&&o.type==="text"&&(e==="radius"||e==="theta")){t=.5}if(t!==undefined){return O6({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:t,offset:u})}}return x6(n,i,{suffix:"end"},{offset:u})}return b6(t)}function Oet({model:t,defaultPos:e,channel:n,scaleName:i,scale:r}){const{markDef:u,config:o}=t;return()=>{const s=d0(n);const a=h0(n);const f=$1(n,u,o,{vgChannel:a});if(f!==undefined){return D6(n,f)}switch(e){case"zeroOrMin":case"zeroOrMax":if(i){const t=r.get("type");if(jZ([f5.LOG,f5.TIME,f5.UTC],t));else{if(r.domainDefinitelyIncludesZero()){return{scale:i,value:0}}}}if(e==="zeroOrMin"){return s==="y"?{field:{group:"height"}}:{value:0}}else{switch(s){case"radius":return{signal:`min(${t.width.signal},${t.height.signal})/2`};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}}break;case"mid":{const e=t[m0(n)];return Object.assign(Object.assign({},e),{mult:.5})}}return undefined}}const Fet={left:"x",center:"xc",right:"x2"};const Det={top:"y",middle:"yc",bottom:"y2"};function ket(t,e,n,i="middle"){if(t==="radius"||t==="theta"){return h0(t)}const r=t==="x"?"align":"baseline";const u=$1(r,e,n);let o;if(f1(u)){c3(E2(r));o=undefined}else{o=u}if(t==="x"){return Fet[o||(i==="top"?"left":"center")]}else{return Det[o||i]}}function Eet(t,e,{defaultPos:n,defaultPos2:i,range:r}){if(r){return $et(t,e,{defaultPos:n,defaultPos2:i})}return Aet(t,e,{defaultPos:n})}function $et(t,e,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:u}=e;const o=p0(t);const s=m0(t);const a=jet(e,i,o);const f=a[s]?ket(t,r,u):h0(t);return Object.assign(Object.assign({},Aet(t,e,{defaultPos:n,vgChannel:f})),a)}function jet(t,e,n){const{encoding:i,mark:r,markDef:u,stack:o,config:s}=t;const a=d0(n);const f=m0(n);const c=h0(n);const l=i[a];const d=t.scaleName(a);const h=t.getScaleComponent(a);const{offset:p}=n in i||n in u?wet({channel:n,markDef:u,encoding:i,model:t}):wet({channel:a,markDef:u,encoding:i,model:t});if(!l&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const e=m0(n);const i=t.markDef[e];if(i!=null){return{[e]:{value:i}}}else{return{[c]:{field:t.getName(n)}}}}const m=Cet({channel:n,channelDef:l,channel2Def:i[n],markDef:u,config:s,scaleName:d,scale:h,stack:o,offset:p,defaultRef:undefined});if(m!==undefined){return{[c]:m}}return Met(n,u)||Met(n,{[n]:C1(n,u,s.style),[f]:C1(f,u,s.style)})||Met(n,s[r])||Met(n,s.mark)||{[c]:Oet({model:t,defaultPos:e,channel:n,scaleName:d,scale:h})()}}function Cet({channel:t,channelDef:e,channel2Def:n,markDef:i,config:r,scaleName:u,scale:o,stack:s,offset:a,defaultRef:f}){if(d8(e)&&s&&t.charAt(0)===s.fieldChannel.charAt(0)){return x6(e,u,{suffix:"start"},{offset:a})}return b6({channel:t,channelDef:n,scaleName:u,scale:o,stack:s,markDef:i,config:r,offset:a,defaultRef:f})}function Met(t,e){const n=m0(t);const i=h0(t);if(e[i]!==undefined){return{[i]:D6(t,e[i])}}else if(e[t]!==undefined){return{[i]:D6(t,e[t])}}else if(e[n]){const i=e[n];if(c6(i)){c3(b2(n))}else{return{[n]:D6(t,i)}}}return undefined}function Bet(t,e){var n,i;const{config:r,encoding:u,markDef:o}=t;const s=o.type;const a=p0(e);const f=m0(e);const c=u[e];const l=u[a];const d=t.getScaleComponent(e);const h=d?d.get("type"):undefined;const p=o.orient;const m=(i=(n=u[f])!==null&&n!==void 0?n:u.size)!==null&&i!==void 0?i:$1("size",o,r,{vgChannel:f});const g=s==="bar"&&(e==="x"?p==="vertical":p==="horizontal");if(s8(c)&&(K0(c.bin)||t1(c.bin)||c.timeUnit&&!l)&&!(m&&!c6(m))&&!w5(h)){return Tet({fieldDef:c,fieldDef2:l,channel:e,model:t})}else if((d8(c)&&w5(h)||g)&&!l){return Net(c,e,t)}else{return $et(e,t,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}}function _et(t,e,n,i,r){if(c6(r)){if(n){const t=n.get("type");if(t==="band"){return{scale:e,band:r.band}}else if(r.band!==1){c3(M2(t));r=undefined}}else{return{mult:r.band,field:{group:t}}}}else if(f1(r)){return r}else if(r){return{value:r}}if(n){const t=n.get("range");if(c1(t)&&pn(t.step)){return{value:t.step-2}}}const u=B4(i.view,t);return{value:u-2}}function Net(t,e,n){const{markDef:i,encoding:r,config:u,stack:o}=n;const s=i.orient;const a=n.scaleName(e);const f=n.getScaleComponent(e);const c=m0(e);const l=p0(e);const d=g0(e);const h=n.scaleName(d);const p=s==="horizontal"&&e==="y"||s==="vertical"&&e==="x";let m;if(r.size||i.size){if(p){m=bet("size",n,{vgChannel:c,defaultRef:x1(i.size)})}else{c3(N2(i.type))}}const g=e8({channel:e,fieldDef:t,markDef:i,config:u,scaleType:f===null||f===void 0?void 0:f.get("type"),useVlSizeChannel:p});m=m||{[c]:_et(c,h||a,f,u,g)};const b=(f===null||f===void 0?void 0:f.get("type"))!=="band"||!("band"in m[c])?"middle":"top";const v=ket(e,i,u,b);const y=v==="xc"||v==="yc";const{offset:w,offsetType:A}=wet({channel:e,markDef:i,encoding:r,model:n,bandPosition:y?.5:0});const x=b6({channel:e,channelDef:t,markDef:i,config:u,scaleName:a,scale:f,stack:o,offset:w,defaultRef:Oet({model:n,defaultPos:"mid",channel:e,scaleName:a,scale:f}),bandPosition:y?A==="encoding"?0:.5:f1(g)?{signal:`(1-${g})/2`}:c6(g)?(1-g.band)/2:0});if(c){return Object.assign({[v]:x},m)}else{const t=h0(l);const e=m[c];const n=w?Object.assign(Object.assign({},e),{offset:w}):e;return{[v]:x,[t]:ve(x)?[x[0],Object.assign(Object.assign({},x[1]),{offset:n})]:Object.assign(Object.assign({},x),{offset:n})}}}function zet(t,e,n,i,r){if(XK(t)){return 0}const u=t==="x"||t==="y2"?-e/2:e/2;if(f1(n)||f1(r)||f1(i)){const t=D1(n);const e=D1(r);const o=D1(i);const s=o?`${o} + `:"";const a=t?`(${t} ? -1 : 1) * `:"";const f=e?`(${e} + ${u})`:u;return{signal:s+a+f}}else{r=r||0;return i+(n?-r-u:+r+u)}}function Tet({fieldDef:t,fieldDef2:e,channel:n,model:i}){var r,u,o;const{config:s,markDef:a,encoding:f}=i;const c=i.getScaleComponent(n);const l=i.scaleName(n);const d=c?c.get("type"):undefined;const h=c.get("reverse");const p=e8({channel:n,fieldDef:t,markDef:a,config:s,scaleType:d});const m=(r=i.component.axes[n])===null||r===void 0?void 0:r[0];const g=(u=m===null||m===void 0?void 0:m.get("translate"))!==null&&u!==void 0?u:.5;const b=F0(n)?(o=$1("binSpacing",a,s))!==null&&o!==void 0?o:0:0;const v=p0(n);const y=h0(n);const w=h0(v);const{offset:A}=wet({channel:n,markDef:a,encoding:f,model:i,bandPosition:0});const x=f1(p)?{signal:`(1-${p.signal})/2`}:c6(p)?(1-p.band)/2:.5;if(K0(t.bin)||t.timeUnit){return{[w]:Pet({fieldDef:t,scaleName:l,bandPosition:x,offset:zet(v,b,h,g,A)}),[y]:Pet({fieldDef:t,scaleName:l,bandPosition:f1(x)?{signal:`1-${x.signal}`}:1-x,offset:zet(n,b,h,g,A)})}}else if(t1(t.bin)){const i=x6(t,l,{},{offset:zet(v,b,h,g,A)});if(s8(e)){return{[w]:i,[y]:x6(e,l,{},{offset:zet(n,b,h,g,A)})}}else if(e1(t.bin)&&t.bin.step){return{[w]:i,[y]:{signal:`scale("${l}", ${A8(t,{expr:"datum"})} + ${t.bin.step})`,offset:zet(n,b,h,g,A)}}}}c3(i3(v));return undefined}function Pet({fieldDef:t,scaleName:e,bandPosition:n,offset:i}){return O6({scaleName:e,fieldOrDatumDef:t,bandPosition:n,offset:i})}const Let=new Set(["aria","width","height"]);function Iet(t,e){const{fill:n=undefined,stroke:i=undefined}=e.color==="include"?vet(t):{};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},qet(t.markDef,e)),Ret(t,"fill",n)),Ret(t,"stroke",i)),bet("opacity",t)),bet("fillOpacity",t)),bet("strokeOpacity",t)),bet("strokeWidth",t)),bet("strokeDash",t)),yet(t)),cet(t)),aet(t,"href")),pet(t))}function Ret(t,e,n){const{config:i,mark:r,markDef:u}=t;const o=$1("invalid",u,i);if(o==="hide"&&n&&!Q5(r)){const i=Uet(t,{invalid:true,channels:N0});if(i){return{[e]:[{test:i,value:null},...Ue(n)]}}}return n?{[e]:n}:{}}function qet(t,e){return m1.reduce(((n,i)=>{if(!Let.has(i)&&t[i]!==undefined&&e[i]!=="ignore"){n[i]=x1(t[i])}return n}),{})}function Uet(t,{invalid:e=false,channels:n}){const i=n.reduce(((e,n)=>{const i=t.getScaleComponent(n);if(i){const r=i.get("type");const u=t.vgField(n,{expr:"datum"});if(u&&A5(r)){e[u]=true}}return e}),{});const r=RZ(i);if(r.length>0){const t=e?"||":"&&";return r.map((t=>w6(t,e))).join(` ${t} `)}return undefined}function Wet(t){const{config:e,markDef:n}=t;const i=$1("invalid",n,e);if(i){const e=Get(t,{channels:O0});if(e){return{defined:{signal:e}}}}return{}}function Get(t,{invalid:e=false,channels:n}){const i=n.reduce(((e,n)=>{const i=t.getScaleComponent(n);if(i){const r=i.get("type");const u=t.vgField(n,{expr:"datum"});if(u&&A5(r)){e[u]=true}}return e}),{});const r=RZ(i);if(r.length>0){const t=e?"||":"&&";return r.map((t=>w6(t,e))).join(` ${t} `)}return undefined}function Het(t,e){if(e!==undefined){return{[t]:x1(e)}}return undefined}const Vet="voronoi";const Yet={defined:t=>t.type==="point"&&t.nearest,parse:(t,e)=>{if(e.events){for(const n of e.events){n.markname=t.getName(Vet)}}},marks:(t,e,n)=>{const{x:i,y:r}=e.project.hasChannel;const u=t.mark;if(Q5(u)){c3(W1(u));return n}const o={name:t.getName(Vet),type:"path",interactive:true,from:{data:t.getName("marks")},encode:{update:Object.assign({fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:true}},cet(t,{reactiveGeom:true}))},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]}]};let s=0;let a=false;n.forEach(((e,n)=>{var i;const r=(i=e.name)!==null&&i!==void 0?i:"";if(r===t.component.mark[0].name){s=n}else if(r.indexOf(Vet)>=0){a=true}}));if(!a){n.splice(s+1,0,o)}return n}};const Xet={defined:t=>t.type==="point"&&t.resolve==="global"&&t.bind&&t.bind!=="scales"&&!p4(t.bind),parse:(t,e,n)=>bnt(e,n),topLevelSignals:(t,e,n)=>{const i=e.name;const r=e.project;const u=e.bind;const o=e.init&&e.init[0];const s=Yet.defined(e)?"(item().isVoronoi ? datum.datum : datum)":"datum";r.items.forEach(((t,r)=>{var a,f;const c=GZ(`${i}_${t.field}`);const l=n.filter((t=>t.name===c));if(!l.length){n.unshift(Object.assign(Object.assign({name:c},o?{init:_tt(o[r])}:{value:null}),{on:e.events?[{events:e.events,update:`datum && item().mark.marktype !== 'group' ? ${s}[${Dn(t.field)}] : null`}]:[],bind:(f=(a=u[t.field])!==null&&a!==void 0?a:u[t.channel])!==null&&f!==void 0?f:u}))}}));return n},signals:(t,e,n)=>{const i=e.name;const r=e.project;const u=n.filter((t=>t.name===i+cnt))[0];const o=i+Ytt;const s=r.items.map((t=>GZ(`${i}_${t.field}`)));const a=s.map((t=>`${t} !== null`)).join(" && ");if(s.length){u.update=`${a} ? {fields: ${o}, values: [${s.join(", ")}]} : null`}delete u.value;delete u.on;return n}};const Jet="_toggle";const Qet={defined:t=>t.type==="point"&&!!t.toggle,signals:(t,e,n)=>n.concat({name:e.name+Jet,value:false,on:[{events:e.events,update:e.toggle}]}),modifyExpr:(t,e)=>{const n=e.name+cnt;const i=e.name+Jet;return`${i} ? null : ${n}, `+(e.resolve==="global"?`${i} ? null : true, `:`${i} ? null : {unit: ${mnt(t)}}, `)+`${i} ? ${n} : null`}};const Zet={defined:t=>t.clear!==undefined&&t.clear!==false,parse:(t,e)=>{if(e.clear){e.clear=gn(e.clear)?oH(e.clear,"view"):e.clear}},topLevelSignals:(t,e,n)=>{if(Xet.defined(e)){for(const t of e.project.items){const i=n.findIndex((n=>n.name===GZ(`${e.name}_${t.field}`)));if(i!==-1){n[i].on.push({events:e.clear,update:"null"})}}}return n},signals:(t,e,n)=>{function i(t,i){if(t!==-1&&n[t].on){n[t].on.push({events:e.clear,update:i})}}if(e.type==="interval"){for(const t of e.project.items){const e=n.findIndex((e=>e.name===t.signals.visual));i(e,"[0, 0]");if(e===-1){const e=n.findIndex((e=>e.name===t.signals.data));i(e,"null")}}}else{let t=n.findIndex((t=>t.name===e.name+cnt));i(t,"null");if(Qet.defined(e)){t=n.findIndex((t=>t.name===e.name+Jet));i(t,"false")}}return n}};const Ket={defined:t=>{const e=t.resolve==="global"&&t.bind&&p4(t.bind);const n=t.project.items.length===1&&t.project.items[0].field!==d4;if(e&&!n){c3(Y1)}return e&&n},parse:(t,e,n)=>{var i;const r=xZ(n);r.select=gn(r.select)?{type:r.select,toggle:e.toggle}:Object.assign(Object.assign({},r.select),{toggle:e.toggle});bnt(e,r);if(ye(n.select)&&(n.select.on||n.select.clear)){const t='event.item && indexof(event.item.mark.role, "legend") < 0';for(const n of e.events){n.filter=Ue((i=n.filter)!==null&&i!==void 0?i:[]);if(!n.filter.includes(t)){n.filter.push(t)}}}const u=m4(e.bind)?e.bind.legend:"click";const o=gn(u)?oH(u,"view"):Ue(u);e.bind={legend:{merge:o}}},topLevelSignals:(t,e,n)=>{const i=e.name;const r=m4(e.bind)&&e.bind.legend;const u=t=>e=>{const n=xZ(e);n.markname=t;return n};for(const o of e.project.items){if(!o.hasLegend)continue;const t=`${GZ(o.field)}_legend`;const s=`${i}_${t}`;const a=n.filter((t=>t.name===s));if(a.length===0){const i=r.merge.map(u(`${t}_symbols`)).concat(r.merge.map(u(`${t}_labels`))).concat(r.merge.map(u(`${t}_entries`)));n.unshift(Object.assign(Object.assign({name:s},!e.init?{value:null}:{}),{on:[{events:i,update:"datum.value || item().items[0].items[0].datum.value",force:true},{events:r.merge,update:`!event.item || !datum ? null : ${s}`,force:true}]}))}}return n},signals:(t,e,n)=>{const i=e.name;const r=e.project;const u=n.find((t=>t.name===i+cnt));const o=i+Ytt;const s=r.items.filter((t=>t.hasLegend)).map((t=>GZ(`${i}_${GZ(t.field)}_legend`)));const a=s.map((t=>`${t} !== null`)).join(" && ");const f=`${a} ? {fields: ${o}, values: [${s.join(", ")}]} : null`;if(e.events&&s.length>0){u.on.push({events:s.map((t=>({signal:t}))),update:f})}else if(s.length>0){u.update=f;delete u.value;delete u.on}const c=n.find((t=>t.name===i+Jet));const l=m4(e.bind)&&e.bind.legend;if(c){if(!e.events)c.on[0].events=l;else c.on.push(Object.assign(Object.assign({},c.on[0]),{events:l}))}return n}};function tnt(t,e,n){var i,r,u,o;const s=(i=t.fieldDef(e))===null||i===void 0?void 0:i.field;for(const a of qZ((r=t.component.selection)!==null&&r!==void 0?r:{})){const t=(u=a.project.hasField[s])!==null&&u!==void 0?u:a.project.hasChannel[e];if(t&&Ket.defined(a)){const e=(o=n.get("selections"))!==null&&o!==void 0?o:[];e.push(a.name);n.set("selections",e,false);t.hasLegend=true}}}const ent="_translate_anchor";const nnt="_translate_delta";const int={defined:t=>t.type==="interval"&&t.translate,signals:(t,e,n)=>{const i=e.name;const r=Qtt.defined(e);const u=i+ent;const{x:o,y:s}=e.project.hasChannel;let a=oH(e.translate,"scope");if(!r){a=a.map((t=>(t.between[0].markname=i+eet,t)))}n.push({name:u,value:{},on:[{events:a.map((t=>t.between[0])),update:"{x: x(unit), y: y(unit)"+(o!==undefined?`, extent_x: ${r?Ztt(t,pK):`slice(${o.signals.visual})`}`:"")+(s!==undefined?`, extent_y: ${r?Ztt(t,mK):`slice(${s.signals.visual})`}`:"")+"}"}]},{name:i+nnt,value:{},on:[{events:a,update:`{x: ${u}.x - x(unit), y: ${u}.y - y(unit)}`}]});if(o!==undefined){rnt(t,e,o,"width",n)}if(s!==undefined){rnt(t,e,s,"height",n)}return n}};function rnt(t,e,n,i,r){var u,o;const s=e.name;const a=s+ent;const f=s+nnt;const c=n.channel;const l=Qtt.defined(e);const d=r.filter((t=>t.name===n.signals[l?"data":"visual"]))[0];const h=t.getSizeSignalRef(i).signal;const p=t.getScaleComponent(c);const m=p.get("type");const g=p.get("reverse");const b=!l?"":c===pK?g?"":"-":g?"-":"";const v=`${a}.extent_${c}`;const y=`${b}${f}.${c} / ${l?`${h}`:`span(${v})`}`;const w=!l?"panLinear":m==="log"?"panLog":m==="symlog"?"panSymlog":m==="pow"?"panPow":"panLinear";const A=!l?"":m==="pow"?`, ${(u=p.get("exponent"))!==null&&u!==void 0?u:1}`:m==="symlog"?`, ${(o=p.get("constant"))!==null&&o!==void 0?o:1}`:"";const x=`${w}(${v}, ${y}${A})`;d.on.push({events:{signal:f},update:l?x:`clampRange(${x}, 0, ${h})`})}const unt="_zoom_anchor";const ont="_zoom_delta";const snt={defined:t=>t.type==="interval"&&t.zoom,signals:(t,e,n)=>{const i=e.name;const r=Qtt.defined(e);const u=i+ont;const{x:o,y:s}=e.project.hasChannel;const a=Dn(t.scaleName(pK));const f=Dn(t.scaleName(mK));let c=oH(e.zoom,"scope");if(!r){c=c.map((t=>(t.markname=i+eet,t)))}n.push({name:i+unt,on:[{events:c,update:!r?`{x: x(unit), y: y(unit)}`:"{"+[a?`x: invert(${a}, x(unit))`:"",f?`y: invert(${f}, y(unit))`:""].filter((t=>!!t)).join(", ")+"}"}]},{name:u,on:[{events:c,force:true,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]});if(o!==undefined){ant(t,e,o,"width",n)}if(s!==undefined){ant(t,e,s,"height",n)}return n}};function ant(t,e,n,i,r){var u,o;const s=e.name;const a=n.channel;const f=Qtt.defined(e);const c=r.filter((t=>t.name===n.signals[f?"data":"visual"]))[0];const l=t.getSizeSignalRef(i).signal;const d=t.getScaleComponent(a);const h=d.get("type");const p=f?Ztt(t,a):c.name;const m=s+ont;const g=`${s}${unt}.${a}`;const b=!f?"zoomLinear":h==="log"?"zoomLog":h==="symlog"?"zoomSymlog":h==="pow"?"zoomPow":"zoomLinear";const v=!f?"":h==="pow"?`, ${(u=d.get("exponent"))!==null&&u!==void 0?u:1}`:h==="symlog"?`, ${(o=d.get("constant"))!==null&&o!==void 0?o:1}`:"";const y=`${b}(${p}, ${g}, ${m}${v})`;c.on.push({events:{signal:m},update:f?y:`clampRange(${y}, 0, ${l})`})}const fnt="_store";const cnt="_tuple";const lnt="_modify";const dnt="vlSelectionResolve";const hnt=[oet,iet,Jtt,Qet,Xet,Qtt,Ket,Zet,int,snt,Yet];function pnt(t){let e=t.parent;while(e){if(Aot(e))break;e=e.parent}return e}function mnt(t,{escape:e}={escape:true}){let n=e?Dn(t.name):t.name;const i=pnt(t);if(i){const{facet:t}=i;for(const e of i0){if(t[e]){n+=` + '__facet_${e}_' + (facet[${Dn(i.vgField(e))}])`}}}return n}function gnt(t){var e;return qZ((e=t.component.selection)!==null&&e!==void 0?e:{}).reduce(((t,e)=>t||e.project.items.some((t=>t.field===d4))),false)}function bnt(t,e){if(gn(e.select)||!e.select.on)delete t.events;if(gn(e.select)||!e.select.clear)delete t.clear;if(gn(e.select)||!e.select.toggle)delete t.toggle}function vnt(t){const e=[];if(t.type==="Identifier"){return[t.name]}if(t.type==="Literal"){return[t.value]}if(t.type==="MemberExpression"){e.push(...vnt(t.object));e.push(...vnt(t.property))}return e}function ynt(t){if(t.object.type==="MemberExpression"){return ynt(t.object)}return t.object.name==="datum"}function wnt(t){const e=ER(t);const n=new Set;e.visit((t=>{if(t.type==="MemberExpression"&&ynt(t)){n.add(vnt(t).slice(1).join("."))}}));return n}class Ant extends Utt{constructor(t,e,n){super(t);this.model=e;this.filter=n;this.expr=knt(this.model,this.filter,this);this._dependentFields=wnt(this.expr)}clone(){return new Ant(null,this.model,xZ(this.filter))}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return`Filter ${this.expr}`}}function xnt(t,e){var n;const i={};const r=t.config.selection;if(!e||!e.length)return i;for(const u of e){const e=GZ(u.name);const o=u.select;const s=gn(o)?o:o.type;const a=ye(o)?xZ(o):{type:s};const f=r[s];for(const t in f){if(t==="fields"||t==="encodings"){continue}if(t==="mark"){a[t]=Object.assign(Object.assign({},f[t]),a[t])}if(a[t]===undefined||a[t]===true){a[t]=(n=f[t])!==null&&n!==void 0?n:a[t]}}const c=i[e]=Object.assign(Object.assign({},a),{name:e,type:s,init:u.value,bind:u.bind,events:gn(a.on)?oH(a.on,"scope"):Ue(xZ(a.on))});for(const n of hnt){if(n.defined(c)&&n.parse){n.parse(t,c,u)}}}return i}function Ont(t,e,n,i="datum"){const r=gn(e)?e:e.param;const u=GZ(r);const o=Dn(u+fnt);let s;try{s=t.getSelectionComponent(u,r)}catch(mat){return`!!${u}`}if(s.project.timeUnit){const e=n!==null&&n!==void 0?n:t.component.data.raw;const i=s.project.timeUnit.clone();if(e.parent){i.insertAsParentOf(e)}else{e.parent=i}}const a=`vlSelectionTest(${o}, ${i}${s.resolve==="global"?")":`, ${Dn(s.resolve)})`}`;const f=`length(data(${o}))`;return e.empty===false?`${f} && ${a}`:`!${f} || ${a}`}function Fnt(t,e,n){const i=GZ(e);const r=n["encoding"];let u=n["field"];let o;try{o=t.getSelectionComponent(i,e)}catch(mat){return i}if(!r&&!u){u=o.project.items[0].field;if(o.project.items.length>1){c3('A "field" or "encoding" must be specified when using a selection as a scale domain. '+`Using "field": ${Dn(u)}.`)}}else if(r&&!u){const t=o.project.items.filter((t=>t.channel===r));if(!t.length||t.length>1){u=o.project.items[0].field;c3((!t.length?"No ":"Multiple ")+`matching ${Dn(r)} encoding found for selection ${Dn(n.param)}. `+`Using "field": ${Dn(u)}.`)}else{u=t[0].field}}return`${o.name}[${Dn(ZZ(u))}]`}function Dnt(t,e){var n;for(const[i,r]of UZ((n=t.component.selection)!==null&&n!==void 0?n:{})){const n=t.getName(`lookup_${i}`);t.component.data.outputNodes[n]=r.materialized=new Wtt(new Ant(e,t,{param:i}),n,Btt.Lookup,t.component.data.outputNodeRefCounts)}}function knt(t,e,n){return HZ(e,(e=>{if(gn(e)){return e}else if(P3(e)){return Ont(t,e,n)}else{return J3(e)}}))}var Ent=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function $nt(t,e){if(!t){return undefined}if(ve(t)&&!a1(t)){return t.map((t=>S8(t,e))).join(", ")}return t}function jnt(t,e,n,i){var r,u,o;var s,a;(r=t.encode)!==null&&r!==void 0?r:t.encode={};(u=(s=t.encode)[e])!==null&&u!==void 0?u:s[e]={};(o=(a=t.encode[e]).update)!==null&&o!==void 0?o:a.update={};t.encode[e].update[n]=i}function Cnt(t,e,n,i={header:false}){var r,u;const o=t.combine(),{disable:s,orient:a,scale:f,labelExpr:c,title:l,zindex:d}=o,h=Ent(o,["disable","orient","scale","labelExpr","title","zindex"]);if(s){return undefined}for(const p in h){const t=K8[p];const n=h[p];if(t&&t!==e&&t!=="both"){delete h[p]}else if(Q8(n)){const{condition:t}=n,e=Ent(n,["condition"]);const i=Ue(t);const r=J8[p];if(r){const{vgProp:t,part:n}=r;const u=[...i.map((t=>{const{test:e}=t,n=Ent(t,["test"]);return Object.assign({test:knt(null,e)},n)})),e];jnt(h,n,t,u);delete h[p]}else if(r===null){const t={signal:i.map((t=>{const{test:e}=t,n=Ent(t,["test"]);return`${knt(null,e)} ? ${F1(n)} : `})).join("")+F1(e)};h[p]=t}}else if(f1(n)){const t=J8[p];if(t){const{vgProp:e,part:i}=t;jnt(h,i,e,n);delete h[p]}}if(jZ(["labelAlign","labelBaseline"],p)&&h[p]===null){delete h[p]}}if(e==="grid"){if(!h.grid){return undefined}if(h.encode){const{grid:t}=h.encode;h.encode=Object.assign({},t?{grid:t}:{});if(IZ(h.encode)){delete h.encode}}return Object.assign(Object.assign({scale:f,orient:a},h),{domain:false,labels:false,aria:false,maxExtent:0,minExtent:0,ticks:false,zindex:nK(d,0)})}else{if(!i.header&&t.mainExtracted){return undefined}if(c!==undefined){let t=c;if(((u=(r=h.encode)===null||r===void 0?void 0:r.labels)===null||u===void 0?void 0:u.update)&&f1(h.encode.labels.update.text)){t=KZ(c,"datum.label",h.encode.labels.update.text.signal)}jnt(h,"labels","text",{signal:t})}if(h.labelAlign===null){delete h.labelAlign}if(h.encode){for(const e of Z8){if(!t.hasAxisPart(e)){delete h.encode[e]}}if(IZ(h.encode)){delete h.encode}}const e=$nt(l,n);return Object.assign(Object.assign(Object.assign(Object.assign({scale:f,orient:a,grid:false},e?{title:e}:{}),h),n.aria===false?{aria:false}:{}),{zindex:nK(d,0)})}}function Mnt(t){const{axes:e}=t.component;const n=[];for(const i of O0){if(e[i]){for(const r of e[i]){if(!r.get("disable")&&!r.get("gridScale")){const e=i==="x"?"height":"width";const r=t.getSizeSignalRef(e).signal;if(e!==r){n.push({name:e,update:r})}}}}}return n}function Bnt(t,e){const{x:n=[],y:i=[]}=t;return[...n.map((t=>Cnt(t,"grid",e))),...i.map((t=>Cnt(t,"grid",e))),...n.map((t=>Cnt(t,"main",e))),...i.map((t=>Cnt(t,"main",e)))].filter((t=>t))}function Snt(t,e,n,i){return Object.assign.apply(null,[{},...t.map((t=>{if(t==="axisOrient"){const t=n==="x"?"bottom":"left";const r=e[n==="x"?"axisBottom":"axisLeft"]||{};const u=e[n==="x"?"axisTop":"axisRight"]||{};const o=new Set([...RZ(r),...RZ(u)]);const s={};for(const e of o.values()){s[e]={signal:`${i["signal"]} === "${t}" ? ${D1(r[e])} : ${D1(u[e])}`}}return s}return e[t]}))])}function _nt(t,e,n,i){const r=e==="band"?["axisDiscrete","axisBand"]:e==="point"?["axisDiscrete","axisPoint"]:g5(e)?["axisQuantitative"]:e==="time"||e==="utc"?["axisTemporal"]:[];const u=t==="x"?"axisX":"axisY";const o=f1(n)?"axisOrient":`axis${YZ(n)}`;const s=[...r,...r.map((t=>u+t.substr(4)))];const a=["axis",o,u];return{vlOnlyAxisConfig:Snt(s,i,t,n),vgAxisConfig:Snt(a,i,t,n),axisConfigStyle:Nnt([...a,...s],i)}}function Nnt(t,e){var n;const i=[{}];for(const r of t){let t=(n=e[r])===null||n===void 0?void 0:n.style;if(t){t=Ue(t);for(const n of t){i.push(e.style[n])}}}return Object.assign.apply(null,i)}function znt(t,e,n,i={}){var r;const u=M1(t,n,e);if(u!==undefined){return{configFrom:"style",configValue:u}}for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"]){if(((r=i[o])===null||r===void 0?void 0:r[t])!==undefined){return{configFrom:o,configValue:i[o][t]}}}return{}}const Tnt={scale:({model:t,channel:e})=>t.scaleName(e),format:({fieldOrDatumDef:t,config:e,axis:n})=>{const{format:i,formatType:r}=n;return B6(t,t.type,i,r,e,true)},formatType:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return S6(i,e,n)},grid:({fieldOrDatumDef:t,axis:e,scaleType:n})=>{var i;return(i=e.grid)!==null&&i!==void 0?i:Pnt(n,t)},gridScale:({model:t,channel:e})=>Lnt(t,e),labelAlign:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelAlign||Unt(e,n,i),labelAngle:({labelAngle:t})=>t,labelBaseline:({axis:t,labelAngle:e,orient:n,channel:i})=>t.labelBaseline||qnt(e,n,i),labelFlush:({axis:t,fieldOrDatumDef:e,channel:n})=>{var i;return(i=t.labelFlush)!==null&&i!==void 0?i:Wnt(e.type,n)},labelOverlap:({axis:t,fieldOrDatumDef:e,scaleType:n})=>{var i;return(i=t.labelOverlap)!==null&&i!==void 0?i:Gnt(e.type,n,s8(e)&&!!e.timeUnit,s8(e)?e.sort:undefined)},orient:({orient:t})=>t,tickCount:({channel:t,model:e,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var u;const o=t==="x"?"width":t==="y"?"height":undefined;const s=o?e.getSizeSignalRef(o):undefined;return(u=n.tickCount)!==null&&u!==void 0?u:Vnt({fieldOrDatumDef:i,scaleType:r,size:s,values:n.values})},title:({axis:t,model:e,channel:n})=>{if(t.title!==undefined){return t.title}const i=Ynt(e,n);if(i!==undefined){return i}const r=e.typedFieldDef(n);const u=n==="x"?"x2":"y2";const o=e.fieldDef(u);return S1(r?[Z6(r)]:[],s8(o)?[Z6(o)]:[])},values:({axis:t,fieldOrDatumDef:e})=>Xnt(t,e),zindex:({axis:t,fieldOrDatumDef:e,mark:n})=>{var i;return(i=t.zindex)!==null&&i!==void 0?i:Jnt(n,e)}};function Pnt(t,e){return!w5(t)&&s8(e)&&!K0(e===null||e===void 0?void 0:e.bin)&&!t1(e===null||e===void 0?void 0:e.bin)}function Lnt(t,e){const n=e==="x"?"y":"x";if(t.getScaleComponent(n)){return t.scaleName(n)}return undefined}function Int(t,e,n,i,r){const u=e===null||e===void 0?void 0:e.labelAngle;if(u!==undefined){return f1(u)?u:aK(u)}else{const{configValue:u}=znt("labelAngle",i,e===null||e===void 0?void 0:e.style,r);if(u!==undefined){return aK(u)}else{if(n===pK&&jZ([u5,i5],t.type)&&!(s8(t)&&t.timeUnit)){return 270}return undefined}}}function Rnt(t){return`(((${t.signal} % 360) + 360) % 360)`}function qnt(t,e,n,i){if(t!==undefined){if(n==="x"){if(f1(t)){const n=Rnt(t);const i=f1(e)?`(${e.signal} === "top")`:e==="top";return{signal:`(45 < ${n} && ${n} < 135) || (225 < ${n} && ${n} < 315) ? "middle" :`+`(${n} <= 45 || 315 <= ${n}) === ${i} ? "bottom" : "top"`}}if(45<t&&t<135||225<t&&t<315){return"middle"}if(f1(e)){const n=t<=45||315<=t?"===":"!==";return{signal:`${e.signal} ${n} "top" ? "bottom" : "top"`}}return(t<=45||315<=t)===(e==="top")?"bottom":"top"}else{if(f1(t)){const n=Rnt(t);const r=f1(e)?`(${e.signal} === "left")`:e==="left";const u=i?'"middle"':"null";return{signal:`${n} <= 45 || 315 <= ${n} || (135 <= ${n} && ${n} <= 225) ? ${u} : (45 <= ${n} && ${n} <= 135) === ${r} ? "top" : "bottom"`}}if(t<=45||315<=t||135<=t&&t<=225){return i?"middle":null}if(f1(e)){const n=45<=t&&t<=135?"===":"!==";return{signal:`${e.signal} ${n} "left" ? "top" : "bottom"`}}return(45<=t&&t<=135)===(e==="left")?"top":"bottom"}}return undefined}function Unt(t,e,n){if(t===undefined){return undefined}const i=n==="x";const r=i?0:90;const u=i?"bottom":"left";if(f1(t)){const n=Rnt(t);const o=f1(e)?`(${e.signal} === "${u}")`:e===u;return{signal:`(${r?`(${n} + 90)`:n} % 180 === 0) ? ${i?null:'"center"'} :`+`(${r} < ${n} && ${n} < ${180+r}) === ${o} ? "left" : "right"`}}if((t+r)%180===0){return i?null:"center"}if(f1(e)){const n=r<t&&t<180+r?"===":"!==";const i=`${e.signal} ${n} "${u}"`;return{signal:`${i} ? "left" : "right"`}}if((r<t&&t<180+r)===(e===u)){return"left"}return"right"}function Wnt(t,e){if(e==="x"&&jZ(["quantitative","temporal"],t)){return true}return undefined}function Gnt(t,e,n,i){if(n&&!ye(i)||t!=="nominal"&&t!=="ordinal"){if(e==="log"||e==="symlog"){return"greedy"}return true}return undefined}function Hnt(t){return t==="x"?"bottom":"left"}function Vnt({fieldOrDatumDef:t,scaleType:e,size:n,values:i}){var r;if(!i&&!w5(e)&&e!=="log"){if(s8(t)){if(K0(t.bin)){return{signal:`ceil(${n.signal}/10)`}}if(t.timeUnit&&jZ(["month","hours","day","quarter"],(r=z3(t.timeUnit))===null||r===void 0?void 0:r.unit)){return undefined}}return{signal:`ceil(${n.signal}/40)`}}return undefined}function Ynt(t,e){const n=e==="x"?"x2":"y2";const i=t.fieldDef(e);const r=t.fieldDef(n);const u=i?i.title:undefined;const o=r?r.title:undefined;if(u&&o){return _1(u,o)}else if(u){return u}else if(o){return o}else if(u!==undefined){return u}else if(o!==undefined){return o}return undefined}function Xnt(t,e){const n=t.values;if(ve(n)){return Y8(e,n)}else if(f1(n)){return n}return undefined}function Jnt(t,e){if(t==="rect"&&x8(e)){return 1}return 0}class Qnt extends Utt{constructor(t,e){super(t);this.transform=e;this._dependentFields=wnt(this.transform.calculate)}clone(){return new Qnt(null,xZ(this.transform))}static parseAllForSortIndex(t,e){e.forEachFieldDef(((e,n)=>{if(!m8(e)){return}if(G6(e.sort)){const{field:i,timeUnit:r}=e;const u=e.sort;const o=u.map(((t,e)=>`${J3({field:i,timeUnit:r,equal:t})} ? ${e} : `)).join("")+u.length;t=new Qnt(t,{calculate:o,as:Znt(e,n,{forAs:true})})}}));return t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return`Calculate ${EZ(this.transform)}`}}function Znt(t,e,n){return A8(t,Object.assign({prefix:e,suffix:"sort_index"},n!==null&&n!==void 0?n:{}))}function Knt(t,e){if(jZ(["top","bottom"],e)){return"column"}else if(jZ(["left","right"],e)){return"row"}return t==="row"?"row":"column"}function tit(t,e,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return nK((e||{})[t],r[t],n.header[t])}function eit(t,e,n,i){const r={};for(const u of t){const t=tit(u,e||{},n,i);if(t!==undefined){r[u]=t}}return r}const nit=["row","column"];const iit=["header","footer"];function rit(t,e){const n=t.component.layoutHeaders[e].title;const i=t.config?t.config:undefined;const r=t.component.layoutHeaders[e].facetFieldDef?t.component.layoutHeaders[e].facetFieldDef:undefined;const{titleAnchor:u,titleAngle:o,titleOrient:s}=eit(["titleAnchor","titleAngle","titleOrient"],r.header,i,e);const a=Knt(e,s);const f=aK(o);return{name:`${e}-title`,type:"group",role:`${a}-title`,title:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:n},e==="row"?{orient:"left"}:{}),{style:"guide-title"}),oit(f,a)),uit(a,f,u)),pit(i,r,e,u4,i4))}}function uit(t,e,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=Unt(e,t==="row"?"left":"top",t==="row"?"y":"x");return i?{align:i}:{}}function oit(t,e){const n=qnt(t,e==="row"?"left":"top",e==="row"?"y":"x",true);return n?{baseline:n}:{}}function sit(t,e){const n=t.component.layoutHeaders[e];const i=[];for(const r of iit){if(n[r]){for(const u of n[r]){const o=cit(t,e,r,n,u);if(o!=null){i.push(o)}}}}return i}function ait(t,e){var n;const{sort:i}=t;if(W6(i)){return{field:A8(i,{expr:"datum"}),order:(n=i.order)!==null&&n!==void 0?n:"ascending"}}else if(ve(i)){return{field:Znt(t,e,{expr:"datum"}),order:"ascending"}}else{return{field:A8(t,{expr:"datum"}),order:i!==null&&i!==void 0?i:"ascending"}}}function fit(t,e,n){const{format:i,formatType:r,labelAngle:u,labelAnchor:o,labelOrient:s,labelExpr:a}=eit(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],t.header,n,e);const f=j6({fieldOrDatumDef:t,format:i,formatType:r,expr:"parent",config:n}).signal;const c=Knt(e,s);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({text:{signal:a?KZ(KZ(a,"datum.label",f),"datum.value",A8(t,{expr:"parent"})):f}},e==="row"?{orient:"left"}:{}),{style:"guide-label",frame:"group"}),oit(u,c)),uit(c,u,o)),pit(n,t,e,o4,r4))}function cit(t,e,n,i,r){if(r){let u=null;const{facetFieldDef:o}=i;const s=t.config?t.config:undefined;if(o&&r.labels){const{labelOrient:t}=eit(["labelOrient"],o.header,s,e);if(e==="row"&&!jZ(["top","bottom"],t)||e==="column"&&!jZ(["left","right"],t)){u=fit(o,e,s)}}const a=Aot(t)&&!H6(t.facet);const f=r.axes;const c=(f===null||f===void 0?void 0:f.length)>0;if(u||c){const s=e==="row"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName(`${e}_${n}`),type:"group",role:`${e}-${n}`},i.facetFieldDef?{from:{data:t.getName(`${e}_domain`)},sort:ait(o,e)}:{}),c&&a?{from:{data:t.getName(`facet_domain_${e}`)}}:{}),u?{title:u}:{}),r.sizeSignal?{encode:{update:{[s]:r.sizeSignal}}}:{}),c?{axes:f}:{})}}return null}const lit={column:{start:0,end:1},row:{start:1,end:0}};function dit(t,e){return lit[e][t]}function hit(t,e){const n={};for(const i of i0){const r=t[i];if(r===null||r===void 0?void 0:r.facetFieldDef){const{titleAnchor:t,titleOrient:u}=eit(["titleAnchor","titleOrient"],r.facetFieldDef.header,e,i);const o=Knt(i,u);const s=dit(t,o);if(s!==undefined){n[o]=s}}}return IZ(n)?undefined:n}function pit(t,e,n,i,r){const u={};for(const o of i){if(!r[o]){continue}const i=tit(o,e===null||e===void 0?void 0:e.header,t,n);if(i!==undefined){u[r[o]]=i}}return u}function mit(t){return[...git(t,"width"),...git(t,"height"),...git(t,"childWidth"),...git(t,"childHeight")]}function git(t,e){const n=e==="width"?"x":"y";const i=t.component.layoutSize.get(e);if(!i||i==="merged"){return[]}const r=t.getSizeSignalRef(e).signal;if(i==="step"){const e=t.getScaleComponent(n);if(e){const i=e.get("type");const u=e.get("range");if(w5(i)&&c1(u)){const i=t.scaleName(n);if(Aot(t.parent)){const e=t.parent.component.resolve;if(e.scale[n]==="independent"){return[bit(i,u)]}}return[bit(i,u),{name:r,update:vit(i,e,`domain('${i}').length`)}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const e=r.endsWith("width");const n=e?"containerSize()[0]":"containerSize()[1]";const i=M4(t.config.view,e?"width":"height");const u=`isFinite(${n}) ? ${n} : ${i}`;return[{name:r,init:u,on:[{update:u,events:"window:resize"}]}]}else{return[{name:r,value:i}]}}function bit(t,e){const n=`${t}_step`;if(f1(e.step)){return{name:n,update:e.step.signal}}else{return{name:n,value:e.step}}}function vit(t,e,n){const i=e.get("type");const r=e.get("padding");const u=nK(e.get("paddingOuter"),r);let o=e.get("paddingInner");o=i==="band"?o!==undefined?o:r:1;return`bandspace(${n}, ${D1(o)}, ${D1(u)}) * ${t}_step`}function yit(t){return t==="childWidth"?"width":t==="childHeight"?"height":t}function wit(t,e){return RZ(t).reduce(((n,i)=>{const r=t[i];return Object.assign(Object.assign({},n),set(e,r,i,(t=>x1(t.value))))}),{})}function Ait(t,e){if(Aot(e)){return t==="theta"?"independent":"shared"}else if(Oot(e)){return"shared"}else if(xot(e)){return F0(t)||t==="theta"||t==="radius"?"independent":"shared"}throw new Error("invalid model type for resolve")}function xit(t,e){const n=t.scale[e];const i=F0(e)?"axis":"legend";if(n==="independent"){if(t[i][e]==="shared"){c3(q2(e))}return"independent"}return t[i][e]||"shared"}const Oit=Object.assign(Object.assign({},l4),{disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1});const Fit=RZ(Oit);class Dit extends vtt{}const kit={symbols:Eit,gradient:$it,labels:jit,entries:Cit};function Eit(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r,legendType:u}){var o,s,a,f,c,l,d,h;if(u!=="symbol"){return undefined}const{markDef:p,encoding:m,config:g,mark:b}=n;const v=p.filled&&b!=="trail";let y=Object.assign(Object.assign({},k1({},n,i6)),vet(n,{filled:v}));const w=(o=r.get("symbolOpacity"))!==null&&o!==void 0?o:g.legend.symbolOpacity;const A=(s=r.get("symbolFillColor"))!==null&&s!==void 0?s:g.legend.symbolFillColor;const x=(a=r.get("symbolStrokeColor"))!==null&&a!==void 0?a:g.legend.symbolStrokeColor;const O=w===undefined?(f=Mit(m.opacity))!==null&&f!==void 0?f:p.opacity:undefined;if(y.fill){if(i==="fill"||v&&i===$K){delete y.fill}else{if(y.fill["field"]){if(A){delete y.fill}else{y.fill=x1((c=g.legend.symbolBaseFillColor)!==null&&c!==void 0?c:"black");y.fillOpacity=x1(O!==null&&O!==void 0?O:1)}}else if(ve(y.fill)){const t=(h=(d=Bit((l=m.fill)!==null&&l!==void 0?l:m.color))!==null&&d!==void 0?d:p.fill)!==null&&h!==void 0?h:v&&p.color;if(t){y.fill=x1(t)}}}}if(y.stroke){if(i==="stroke"||!v&&i===$K){delete y.stroke}else{if(y.stroke["field"]||x){delete y.stroke}else if(ve(y.stroke)){const t=nK(Bit(m.stroke||m.color),p.stroke,v?p.color:undefined);if(t){y.stroke={value:t}}}}}if(i!==_K){const t=s8(e)&&_it(n,r,e);if(t){y.opacity=[Object.assign({test:t},x1(O!==null&&O!==void 0?O:1)),x1(g.legend.unselectedOpacity)]}else if(O){y.opacity=x1(O)}}y=Object.assign(Object.assign({},y),t);return IZ(y)?undefined:y}function $it(t,{model:e,legendType:n,legendCmpt:i}){var r;if(n!=="gradient"){return undefined}const{config:u,markDef:o,encoding:s}=e;let a={};const f=(r=i.get("gradientOpacity"))!==null&&r!==void 0?r:u.legend.gradientOpacity;const c=f===undefined?Mit(s.opacity)||o.opacity:undefined;if(c){a.opacity=x1(c)}a=Object.assign(Object.assign({},a),t);return IZ(a)?undefined:a}function jit(t,{fieldOrDatumDef:e,model:n,channel:i,legendCmpt:r}){const u=n.legend(i)||{};const o=n.config;const s=s8(e)?_it(n,r,e):undefined;const a=s?[{test:s,value:1},{value:o.legend.unselectedOpacity}]:undefined;const{format:f,formatType:c}=u;const l=k6(c)?M6({fieldOrDatumDef:e,field:"datum.value",format:f,formatType:c,config:o}):undefined;const d=Object.assign(Object.assign(Object.assign({},a?{opacity:a}:{}),l?{text:l}:{}),t);return IZ(d)?undefined:d}function Cit(t,{legendCmpt:e}){const n=e.get("selections");return(n===null||n===void 0?void 0:n.length)?Object.assign(Object.assign({},t),{fill:{value:"transparent"}}):t}function Mit(t){return Sit(t,((t,e)=>Math.max(t,e.value)))}function Bit(t){return Sit(t,((t,e)=>nK(t,e.value)))}function Sit(t,e){if(o8(t)){return Ue(t.condition).reduce(e,t.value)}else if(p8(t)){return t.value}return undefined}function _it(t,e,n){const i=e.get("selections");if(!(i===null||i===void 0?void 0:i.length))return undefined;const r=Dn(n.field);return i.map((t=>{const e=Dn(GZ(t)+fnt);return`(!length(data(${e})) || (${t}[${r}] && indexof(${t}[${r}], datum.value) >= 0))`})).join(" || ")}const Nit={direction:({direction:t})=>t,format:({fieldOrDatumDef:t,legend:e,config:n})=>{const{format:i,formatType:r}=e;return B6(t,t.type,i,r,n,false)},formatType:({legend:t,fieldOrDatumDef:e,scaleType:n})=>{const{formatType:i}=t;return S6(i,e,n)},gradientLength:t=>{var e,n;const{legend:i,legendConfig:r}=t;return(n=(e=i.gradientLength)!==null&&e!==void 0?e:r.gradientLength)!==null&&n!==void 0?n:qit(t)},labelOverlap:({legend:t,legendConfig:e,scaleType:n})=>{var i,r;return(r=(i=t.labelOverlap)!==null&&i!==void 0?i:e.labelOverlap)!==null&&r!==void 0?r:Wit(n)},symbolType:({legend:t,markDef:e,channel:n,encoding:i})=>{var r;return(r=t.symbolType)!==null&&r!==void 0?r:Tit(e.type,n,i.shape,e.shape)},title:({fieldOrDatumDef:t,config:e})=>M8(t,e,{allowDisabling:true}),type:({legendType:t,scaleType:e,channel:n})=>{if(e0(n)&&x5(e)){if(t==="gradient"){return undefined}}else if(t==="symbol"){return undefined}return t},values:({fieldOrDatumDef:t,legend:e})=>zit(e,t)};function zit(t,e){const n=t.values;if(ve(n)){return Y8(e,n)}else if(f1(n)){return n}return undefined}function Tit(t,e,n,i){var r;if(e!=="shape"){const t=(r=Bit(n))!==null&&r!==void 0?r:i;if(t){return t}}switch(t){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function Pit(t){const{legend:e}=t;return nK(e.type,Lit(t))}function Lit({channel:t,timeUnit:e,scaleType:n}){if(e0(t)){if(jZ(["quarter","month","day"],e)){return"symbol"}if(x5(n)){return"gradient"}}return"symbol"}function Iit({legendConfig:t,legendType:e,orient:n,legend:i}){var r,u;return(u=(r=i.direction)!==null&&r!==void 0?r:t[e?"gradientDirection":"symbolDirection"])!==null&&u!==void 0?u:Rit(n,e)}function Rit(t,e){switch(t){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case undefined:return undefined;default:return e==="gradient"?"horizontal":undefined}}function qit({legendConfig:t,model:e,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:u,gradientHorizontalMinLength:o,gradientVerticalMaxLength:s,gradientVerticalMinLength:a}=t;if(x5(r)){if(n==="horizontal"){if(i==="top"||i==="bottom"){return Uit(e,"width",o,u)}else{return o}}else{return Uit(e,"height",a,s)}}return undefined}function Uit(t,e,n,i){const r=t.getSizeSignalRef(e).signal;return{signal:`clamp(${r}, ${n}, ${i})`}}function Wit(t){if(jZ(["quantile","threshold","log","symlog"],t)){return"greedy"}return undefined}function Git(t){const e=wot(t)?Hit(t):Jit(t);t.component.legends=e;return e}function Hit(t){const{encoding:e}=t;const n={};for(const i of[$K,...f4]){const r=T8(e[i]);if(!r||!t.getScaleComponent(i)){continue}if(i===MK&&s8(r)&&r.type===o5){continue}n[i]=Xit(t,i)}return n}function Vit(t,e){const n=t.scaleName(e);if(t.mark==="trail"){if(e==="color"){return{stroke:n}}else if(e==="size"){return{strokeWidth:n}}}if(e==="color"){return t.markDef.filled?{fill:n}:{stroke:n}}return{[e]:n}}function Yit(t,e,n,i){switch(e){case"disable":return n!==undefined;case"values":return!!(n===null||n===void 0?void 0:n.values);case"title":if(e==="title"&&t===(i===null||i===void 0?void 0:i.title)){return true}}return t===(n||{})[e]}function Xit(t,e){var n,i,r;let u=t.legend(e);const{markDef:o,encoding:s,config:a}=t;const f=a.legend;const c=new Dit({},Vit(t,e));tnt(t,e,c);const l=u!==undefined?!u:f.disable;c.set("disable",l,u!==undefined);if(l){return c}u=u||{};const d=t.getScaleComponent(e).get("type");const h=T8(s[e]);const p=s8(h)?(n=z3(h.timeUnit))===null||n===void 0?void 0:n.unit:undefined;const m=u.orient||a.legend.orient||"right";const g=Pit({legend:u,channel:e,timeUnit:p,scaleType:d});const b=Iit({legend:u,legendType:g,orient:m,legendConfig:f});const v={legend:u,channel:e,model:t,markDef:o,encoding:s,fieldOrDatumDef:h,legendConfig:f,config:a,scaleType:d,orient:m,legendType:g,direction:b};for(const O of Fit){if(g==="gradient"&&O.startsWith("symbol")||g==="symbol"&&O.startsWith("gradient")){continue}const n=O in Nit?Nit[O](v):u[O];if(n!==undefined){const i=Yit(n,O,u,t.fieldDef(e));if(i||a.legend[O]===undefined){c.set(O,n,i)}}}const y=(i=u===null||u===void 0?void 0:u.encoding)!==null&&i!==void 0?i:{};const w=c.get("selections");const A={};const x={fieldOrDatumDef:h,model:t,channel:e,legendCmpt:c,legendType:g};for(const O of["labels","legend","title","symbols","gradient","entries"]){const e=wit((r=y[O])!==null&&r!==void 0?r:{},t);const n=O in kit?kit[O](e,x):e;if(n!==undefined&&!IZ(n)){A[O]=Object.assign(Object.assign(Object.assign({},(w===null||w===void 0?void 0:w.length)&&s8(h)?{name:`${GZ(h.field)}_legend_${O}`}:{}),(w===null||w===void 0?void 0:w.length)?{interactive:!!w}:{}),{update:n})}}if(!IZ(A)){c.set("encode",A,!!(u===null||u===void 0?void 0:u.encoding))}return c}function Jit(t){const{legends:e,resolve:n}=t.component;for(const i of t.children){Git(i);for(const r of RZ(i.component.legends)){n.legend[r]=xit(t.component.resolve,r);if(n.legend[r]==="shared"){e[r]=Qit(e[r],i.component.legends[r]);if(!e[r]){n.legend[r]="independent";delete e[r]}}}}for(const i of RZ(e)){for(const e of t.children){if(!e.component.legends[i]){continue}if(n.legend[i]==="shared"){delete e.component.legends[i]}}}return e}function Qit(t,e){var n,i,r,u;if(!t){return e.clone()}const o=t.getWithExplicit("orient");const s=e.getWithExplicit("orient");if(o.explicit&&s.explicit&&o.value!==s.value){return undefined}let a=false;for(const f of Fit){const n=Ott(t.getWithExplicit(f),e.getWithExplicit(f),f,"legend",((t,e)=>{switch(f){case"symbolType":return Zit(t,e);case"title":return N1(t,e);case"type":a=true;return wtt("symbol")}return xtt(t,e,f,"legend")}));t.setWithExplicit(f,n)}if(a){if((i=(n=t.implicit)===null||n===void 0?void 0:n.encode)===null||i===void 0?void 0:i.gradient){VZ(t.implicit,["encode","gradient"])}if((u=(r=t.explicit)===null||r===void 0?void 0:r.encode)===null||u===void 0?void 0:u.gradient){VZ(t.explicit,["encode","gradient"])}}return t}function Zit(t,e){if(e.value==="circle"){return e}return t}var Kit=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function trt(t,e,n,i){var r,u,o;var s,a;(r=t.encode)!==null&&r!==void 0?r:t.encode={};(u=(s=t.encode)[e])!==null&&u!==void 0?u:s[e]={};(o=(a=t.encode[e]).update)!==null&&o!==void 0?o:a.update={};t.encode[e].update[n]=i}function ert(t){const e=t.component.legends;const n={};for(const r of RZ(e)){const i=t.getScaleComponent(r);const u=kZ(i.get("domains"));if(n[u]){for(const t of n[u]){const i=Qit(t,e[r]);if(!i){n[u].push(e[r])}}}else{n[u]=[e[r].clone()]}}const i=qZ(n).flat().map((e=>nrt(e,t.config))).filter((t=>t!==undefined));return i}function nrt(t,e){var n,i,r;const u=t.combine(),{disable:o,labelExpr:s,selections:a}=u,f=Kit(u,["disable","labelExpr","selections"]);if(o){return undefined}if(e.aria===false&&f.aria==undefined){f.aria=false}if((n=f.encode)===null||n===void 0?void 0:n.symbols){const t=f.encode.symbols.update;if(t.fill&&t.fill["value"]!=="transparent"&&!t.stroke&&!f.stroke){t.stroke={value:"transparent"}}for(const e of f4){if(f[e]){delete t[e]}}}if(!f.title){delete f.title}if(s!==undefined){let t=s;if(((r=(i=f.encode)===null||i===void 0?void 0:i.labels)===null||r===void 0?void 0:r.update)&&f1(f.encode.labels.update.text)){t=KZ(s,"datum.label",f.encode.labels.update.text.signal)}trt(f,"labels","text",{signal:t})}return f}function irt(t){if(Oot(t)||xot(t)){return rrt(t)}else{return urt(t)}}function rrt(t){return t.children.reduce(((t,e)=>t.concat(e.assembleProjections())),urt(t))}function urt(t){const e=t.component.projection;if(!e||e.merged){return[]}const n=e.combine();const{name:i}=n;if(!e.data){return[Object.assign(Object.assign({name:i},{translate:{signal:"[width / 2, height / 2]"}}),n)]}else{const r={signal:`[${e.size.map((t=>t.signal)).join(", ")}]`};const u=e.data.reduce(((e,n)=>{const i=f1(n)?n.signal:`data('${t.lookupDataSource(n)}')`;if(!jZ(e,i)){e.push(i)}return e}),[]);if(u.length<=0){throw new Error("Projection's fit didn't find any data sources")}return[Object.assign({name:i,size:r,fit:{signal:u.length>1?`[${u.join(", ")}]`:u[0]}},n)]}}const ort=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class srt extends vtt{constructor(t,e,n,i){super(Object.assign({},e),{name:t});this.specifiedProjection=e;this.size=n;this.data=i;this.merged=false}get isFit(){return!!this.data}}function art(t){t.component.projection=wot(t)?frt(t):drt(t)}function frt(t){var e;if(t.hasProjection){const n=u1(t.specifiedProjection);const i=!(n&&(n.scale!=null||n.translate!=null));const r=i?[t.getSizeSignalRef("width"),t.getSizeSignalRef("height")]:undefined;const u=i?crt(t):undefined;const o=new srt(t.projectionName(true),Object.assign(Object.assign({},(e=u1(t.config.projection))!==null&&e!==void 0?e:{}),n!==null&&n!==void 0?n:{}),r,u);if(!o.get("type")){o.set("type","equalEarth",false)}return o}return undefined}function crt(t){const e=[];const{encoding:n}=t;for(const i of[[DK,FK],[EK,kK]]){if(T8(n[i[0]])||T8(n[i[1]])){e.push({signal:t.getName(`geojson_${e.length}`)})}}if(t.channelHasField(MK)&&t.typedFieldDef(MK).type===o5){e.push({signal:t.getName(`geojson_${e.length}`)})}if(e.length===0){e.push(t.requestDataName(Btt.Main))}return e}function lrt(t,e){const n=MZ(ort,(n=>{if(!un(t.explicit,n)&&!un(e.explicit,n)){return true}if(un(t.explicit,n)&&un(e.explicit,n)&&AZ(t.get(n),e.get(n))){return true}return false}));const i=AZ(t.size,e.size);if(i){if(n){return t}else if(AZ(t.explicit,{})){return e}else if(AZ(e.explicit,{})){return t}}return null}function drt(t){if(t.children.length===0){return undefined}let e;for(const i of t.children){art(i)}const n=MZ(t.children,(t=>{const n=t.component.projection;if(!n){return true}else if(!e){e=n;return true}else{const t=lrt(e,n);if(t){e=t}return!!t}}));if(e&&n){const n=t.projectionName(true);const i=new srt(n,e.specifiedProjection,e.size,xZ(e.data));for(const e of t.children){const t=e.component.projection;if(t){if(t.isFit){i.data.push(...e.component.projection.data)}e.renameProjection(t.get("name"),n);t.merged=true}}return i}return undefined}var hrt=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function prt(t,e,n,i){var r,u;if(X8(e,n)){const o=wot(t)?(u=(r=t.axis(n))!==null&&r!==void 0?r:t.legend(n))!==null&&u!==void 0?u:{}:{};const s=A8(e,{expr:"datum"});const a=A8(e,{expr:"datum",binSuffix:"end"});return{formulaAs:A8(e,{binSuffix:"range",forAs:true}),formula:P6(s,a,o.format,o.formatType,i)}}return{}}function mrt(t,e){return`${Z0(t)}_${e}`}function grt(t,e){return{signal:t.getName(`${e}_bins`),extentSignal:t.getName(`${e}_extent`)}}function brt(t,e,n){var i;const r=(i=q8(n,undefined))!==null&&i!==void 0?i:{};const u=mrt(r,e);return t.getName(`${u}_bins`)}function vrt(t){return"as"in t}function yrt(t,e,n){let i;let r;if(vrt(t)){i=gn(t.as)?[t.as,`${t.as}_end`]:[t.as[0],t.as[1]]}else{i=[A8(t,{forAs:true}),A8(t,{binSuffix:"end",forAs:true})]}const u=Object.assign({},q8(e,undefined));const o=mrt(u,t.field);const{signal:s,extentSignal:a}=grt(n,o);if(n1(u.extent)){const t=u.extent;r=Fnt(n,t.param,t);delete u.extent}const f=Object.assign(Object.assign(Object.assign({bin:u,field:t.field,as:[i]},s?{signal:s}:{}),a?{extentSignal:a}:{}),r?{span:r}:{});return{key:o,binComponent:f}}class wrt extends Utt{constructor(t,e){super(t);this.bins=e}clone(){return new wrt(null,xZ(this.bins))}static makeFromEncoding(t,e){const n=e.reduceFieldDef(((t,n,i)=>{if(h8(n)&&K0(n.bin)){const{key:r,binComponent:u}=yrt(n,n.bin,e);t[r]=Object.assign(Object.assign(Object.assign({},u),t[r]),prt(e,n,i,e.config))}return t}),{});if(IZ(n)){return null}return new wrt(t,n)}static makeFromTransform(t,e,n){const{key:i,binComponent:r}=yrt(e,e.bin,n);return new wrt(t,{[i]:r})}merge(t,e){for(const n of RZ(t.bins)){if(n in this.bins){e(t.bins[n].signal,this.bins[n].signal);this.bins[n].as=_Z([...this.bins[n].as,...t.bins[n].as],EZ)}else{this.bins[n]=t.bins[n]}}for(const n of t.children){t.removeChild(n);n.parent=this}t.remove()}producedFields(){return new Set(qZ(this.bins).map((t=>t.as)).flat(2))}dependentFields(){return new Set(qZ(this.bins).map((t=>t.field)))}hash(){return`Bin ${EZ(this.bins)}`}assemble(){return qZ(this.bins).flatMap((t=>{const e=[];const[n,...i]=t.as;const r=t.bin,{extent:u}=r,o=hrt(r,["extent"]);const s=Object.assign(Object.assign(Object.assign({type:"bin",field:ZZ(t.field),as:n,signal:t.signal},!n1(u)?{extent:u}:{extent:null}),t.span?{span:{signal:`span(${t.span})`}}:{}),o);if(!u&&t.extentSignal){e.push({type:"extent",field:ZZ(t.field),signal:t.extentSignal});s.extent={signal:t.extentSignal}}e.push(s);for(const a of i){for(let t=0;t<2;t++){e.push({type:"formula",expr:A8({field:n[t]},{expr:"datum"}),as:a[t]})}}if(t.formula){e.push({type:"formula",expr:t.formula,as:t.formulaAs})}return e}))}}function Art(t,e,n,i){var r;const u=wot(i)?i.encoding[p0(e)]:undefined;if(h8(n)&&wot(i)&&n8(n,u,i.markDef,i.config)){t.add(A8(n,{}));t.add(A8(n,{suffix:"end"}));if(n.bin&&X8(n,e)){t.add(A8(n,{binSuffix:"range"}))}}else if(ZK(e)){const n=QK(e);t.add(i.getName(n))}else{t.add(A8(n))}if(m8(n)&&$5((r=n.scale)===null||r===void 0?void 0:r.range)){t.add(n.scale.range.field)}return t}function xrt(t,e){var n;for(const i of RZ(e)){const r=e[i];for(const e of RZ(r)){if(i in t){t[i][e]=new Set([...(n=t[i][e])!==null&&n!==void 0?n:[],...r[e]])}else{t[i]={[e]:r[e]}}}}}class Ort extends Utt{constructor(t,e,n){super(t);this.dimensions=e;this.measures=n}clone(){return new Ort(null,new Set(this.dimensions),xZ(this.measures))}get groupBy(){return this.dimensions}static makeFromEncoding(t,e){let n=false;e.forEachFieldDef((t=>{if(t.aggregate){n=true}}));const i={};const r=new Set;if(!n){return null}e.forEachFieldDef(((t,n)=>{var u,o,s,a;const{aggregate:f,field:c}=t;if(f){if(f==="count"){(u=i["*"])!==null&&u!==void 0?u:i["*"]={};i["*"]["count"]=new Set([A8(t,{forAs:true})])}else{if(W0(f)||G0(f)){const t=W0(f)?"argmin":"argmax";const e=f[t];(o=i[e])!==null&&o!==void 0?o:i[e]={};i[e][t]=new Set([A8({op:t,field:e},{forAs:true})])}else{(s=i[c])!==null&&s!==void 0?s:i[c]={};i[c][f]=new Set([A8(t,{forAs:true})])}if(z0(n)&&e.scaleDomain(n)==="unaggregated"){(a=i[c])!==null&&a!==void 0?a:i[c]={};i[c]["min"]=new Set([A8({field:c,aggregate:"min"},{forAs:true})]);i[c]["max"]=new Set([A8({field:c,aggregate:"max"},{forAs:true})])}}}else{Art(r,n,t,e)}}));if(r.size+RZ(i).length===0){return null}return new Ort(t,r,i)}static makeFromTransform(t,e){var n,i,r;const u=new Set;const o={};for(const s of e.aggregate){const{op:t,field:e,as:r}=s;if(t){if(t==="count"){(n=o["*"])!==null&&n!==void 0?n:o["*"]={};o["*"]["count"]=new Set([r?r:A8(s,{forAs:true})])}else{(i=o[e])!==null&&i!==void 0?i:o[e]={};o[e][t]=new Set([r?r:A8(s,{forAs:true})])}}}for(const s of(r=e.groupby)!==null&&r!==void 0?r:[]){u.add(s)}if(u.size+RZ(o).length===0){return null}return new Ort(t,u,o)}merge(t){if(zZ(this.dimensions,t.dimensions)){xrt(this.measures,t.measures);return true}l3("different dimensions, cannot merge");return false}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...RZ(this.measures)])}producedFields(){const t=new Set;for(const e of RZ(this.measures)){for(const n of RZ(this.measures[e])){const i=this.measures[e][n];if(i.size===0){t.add(`${n}_${e}`)}else{i.forEach(t.add,t)}}}return t}hash(){return`Aggregate ${EZ({dimensions:this.dimensions,measures:this.measures})}`}assemble(){const t=[];const e=[];const n=[];for(const r of RZ(this.measures)){for(const i of RZ(this.measures[r])){for(const u of this.measures[r][i]){n.push(u);t.push(i);e.push(r==="*"?null:ZZ(r))}}}const i={type:"aggregate",groupby:[...this.dimensions].map(ZZ),ops:t,fields:e,as:n};return i}}class Frt extends Utt{constructor(t,e,n,i){super(t);this.model=e;this.name=n;this.data=i;for(const r of i0){const t=e.facet[r];if(t){const{bin:n,sort:i}=t;this[r]=Object.assign({name:e.getName(`${r}_domain`),fields:[A8(t),...K0(n)?[A8(t,{binSuffix:"end"})]:[]]},W6(i)?{sortField:i}:ve(i)?{sortIndexField:Znt(t,r)}:{})}}this.childModel=e.child}hash(){let t=`Facet`;for(const e of i0){if(this[e]){t+=` ${e.charAt(0)}:${EZ(this[e])}`}}return t}get fields(){var t;const e=[];for(const n of i0){if((t=this[n])===null||t===void 0?void 0:t.fields){e.push(...this[n].fields)}}return e}dependentFields(){const t=new Set(this.fields);for(const e of i0){if(this[e]){if(this[e].sortField){t.add(this[e].sortField.field)}if(this[e].sortIndexField){t.add(this[e].sortIndexField)}}}return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const e of O0){const n=this.childModel.component.scales[e];if(n&&!n.merged){const i=n.get("type");const r=n.get("range");if(w5(i)&&c1(r)){const n=Cut(this.childModel,e);const i=jut(n);if(i){t[e]=i}else{c3(R1(e))}}}}return t}assembleRowColumnHeaderData(t,e,n){const i={row:"y",column:"x",facet:undefined}[t];const r=[];const u=[];const o=[];if(i&&n&&n[i]){if(e){r.push(`distinct_${n[i]}`);u.push("max")}else{r.push(n[i]);u.push("distinct")}o.push(`distinct_${n[i]}`)}const{sortField:s,sortIndexField:a}=this[t];if(s){const{op:t=I6,field:e}=s;r.push(e);u.push(t);o.push(A8(s,{forAs:true}))}else if(a){r.push(a);u.push("max");o.push(a)}return{name:this[t].name,source:e!==null&&e!==void 0?e:this.data,transform:[Object.assign({type:"aggregate",groupby:this[t].fields},r.length?{fields:r,ops:u,as:o}:{})]}}assembleFacetHeaderData(t){var e,n;const{columns:i}=this.model.layout;const{layoutHeaders:r}=this.model.component;const u=[];const o={};for(const f of nit){for(const t of iit){const i=(e=r[f]&&r[f][t])!==null&&e!==void 0?e:[];for(const t of i){if(((n=t.axes)===null||n===void 0?void 0:n.length)>0){o[f]=true;break}}}if(o[f]){const t=`length(data("${this.facet.name}"))`;const e=f==="row"?i?{signal:`ceil(${t} / ${i})`}:1:i?{signal:`min(${t}, ${i})`}:{signal:t};u.push({name:`${this.facet.name}_${f}`,transform:[{type:"sequence",start:0,stop:e}]})}}const{row:s,column:a}=o;if(s||a){u.unshift(this.assembleRowColumnHeaderData("facet",null,t))}return u}assemble(){var t,e;const n=[];let i=null;const r=this.getChildIndependentFieldsWithStep();const{column:u,row:o,facet:s}=this;if(u&&o&&(r.x||r.y)){i=`cross_${this.column.name}_${this.row.name}`;const u=[].concat((t=r.x)!==null&&t!==void 0?t:[],(e=r.y)!==null&&e!==void 0?e:[]);const o=u.map((()=>"distinct"));n.push({name:i,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:u,ops:o}]})}for(const a of[dK,lK]){if(this[a]){n.push(this.assembleRowColumnHeaderData(a,i,r))}}if(s){const t=this.assembleFacetHeaderData(r);if(t){n.push(...t)}}return n}}function Drt(t){if(t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"')){return t.slice(1,-1)}return t}function krt(t,e){const n=XZ(t);if(e==="number"){return`toNumber(${n})`}else if(e==="boolean"){return`toBoolean(${n})`}else if(e==="string"){return`toString(${n})`}else if(e==="date"){return`toDate(${n})`}else if(e==="flatten"){return n}else if(e.startsWith("date:")){const t=Drt(e.slice(5,e.length));return`timeParse(${n},'${t}')`}else if(e.startsWith("utc:")){const t=Drt(e.slice(4,e.length));return`utcParse(${n},'${t}')`}else{c3(n2(e));return null}}function Ert(t){const e={};yZ(t.filter,(t=>{var n;if(V3(t)){let i=null;if(L3(t)){i=w1(t.equal)}else if(R3(t)){i=w1(t.lte)}else if(I3(t)){i=w1(t.lt)}else if(q3(t)){i=w1(t.gt)}else if(U3(t)){i=w1(t.gte)}else if(W3(t)){i=t.range[0]}else if(G3(t)){i=((n=t.oneOf)!==null&&n!==void 0?n:t["in"])[0]}if(i){if(d3(i)){e[t.field]="date"}else if(pn(i)){e[t.field]="number"}else if(gn(i)){e[t.field]="string"}}if(t.timeUnit){e[t.field]="date"}}}));return e}function $rt(t){const e={};function n(t){if(G8(t)){e[t.field]="date"}else if(t.type==="quantitative"&&X0(t.aggregate)){e[t.field]="number"}else if(eK(t.field)>1){if(!(t.field in e)){e[t.field]="flatten"}}else if(m8(t)&&W6(t.sort)&&eK(t.sort.field)>1){if(!(t.sort.field in e)){e[t.sort.field]="flatten"}}}if(wot(t)||Aot(t)){t.forEachFieldDef(((e,i)=>{if(h8(e)){n(e)}else{const r=d0(i);const u=t.fieldDef(r);n(Object.assign(Object.assign({},e),{type:u.type}))}}))}if(wot(t)){const{mark:n,markDef:i,encoding:r}=t;if(Q5(n)&&!t.encoding.order){const t=i.orient==="horizontal"?"y":"x";const n=r[t];if(s8(n)&&n.type==="quantitative"&&!(n.field in e)){e[n.field]="number"}}}return e}function jrt(t){const e={};if(wot(t)&&t.component.selection){for(const n of RZ(t.component.selection)){const i=t.component.selection[n];for(const t of i.project.items){if(!t.channel&&eK(t.field)>1){e[t.field]="flatten"}}}}return e}class Crt extends Utt{constructor(t,e){super(t);this._parse=e}clone(){return new Crt(null,xZ(this._parse))}hash(){return`Parse ${EZ(this._parse)}`}static makeExplicit(t,e,n){var i;let r={};const u=e.data;if(!$tt(u)&&((i=u===null||u===void 0?void 0:u.format)===null||i===void 0?void 0:i.parse)){r=u.format.parse}return this.makeWithAncestors(t,r,{},n)}static makeWithAncestors(t,e,n,i){for(const o of RZ(n)){const t=i.getWithExplicit(o);if(t.value!==undefined){if(t.explicit||t.value===n[o]||t.value==="derived"||n[o]==="flatten"){delete n[o]}else{c3(i2(o,n[o],t.value))}}}for(const o of RZ(e)){const t=i.get(o);if(t!==undefined){if(t===e[o]){delete e[o]}else{c3(i2(o,e[o],t))}}}const r=new vtt(e,n);i.copyAll(r);const u={};for(const o of RZ(r.combine())){const t=r.get(o);if(t!==null){u[o]=t}}if(RZ(u).length===0||i.parseNothing){return null}return new Crt(t,u)}get parse(){return this._parse}merge(t){this._parse=Object.assign(Object.assign({},this._parse),t.parse);t.remove()}assembleFormatParse(){const t={};for(const e of RZ(this._parse)){const n=this._parse[e];if(eK(e)===1){t[e]=n}}return t}producedFields(){return new Set(RZ(this._parse))}dependentFields(){return new Set(RZ(this._parse))}assembleTransforms(t=false){return RZ(this._parse).filter((e=>t?eK(e)>1:true)).map((t=>{const e=krt(t,this._parse[t]);if(!e){return null}const n={type:"formula",expr:e,as:tK(t)};return n})).filter((t=>t!==null))}}class Mrt extends Utt{clone(){return new Mrt(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([d4])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:d4}}}class Brt extends Utt{constructor(t,e){super(t);this.params=e}clone(){return new Brt(null,this.params)}dependentFields(){return new Set}producedFields(){return undefined}hash(){return`Graticule ${EZ(this.params)}`}assemble(){return Object.assign({type:"graticule"},this.params===true?{}:this.params)}}class Srt extends Utt{constructor(t,e){super(t);this.params=e}clone(){return new Srt(null,this.params)}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!==null&&t!==void 0?t:"data"])}hash(){return`Hash ${EZ(this.params)}`}assemble(){return Object.assign({type:"sequence"},this.params)}}class _rt extends Utt{constructor(t){super(null);t!==null&&t!==void 0?t:t={name:"source"};let e;if(!$tt(t)){e=t.format?Object.assign({},DZ(t.format,["parse"])):{}}if(ktt(t)){this._data={values:t.values}}else if(Dtt(t)){this._data={url:t.url};if(!e.type){let n=/(?:\.([^.]+))?$/.exec(t.url)[1];if(!jZ(["json","csv","tsv","dsv","topojson"],n)){n="json"}e.type=n}}else if(Ctt(t)){this._data={values:[{type:"Sphere"}]}}else if(Ett(t)||$tt(t)){this._data={}}this._generator=$tt(t);if(t.name){this._name=t.name}if(e&&!IZ(e)){this._data.format=e}}dependentFields(){return new Set}producedFields(){return undefined}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return Object.assign(Object.assign({name:this._name},this._data),{transform:[]})}}var Nrt=undefined&&undefined.__classPrivateFieldSet||function(t,e,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof e==="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(t,n):r?r.value=n:e.set(t,n),n};var zrt=undefined&&undefined.__classPrivateFieldGet||function(t,e,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e==="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(t):i?i.value:e.get(t)};var Trt;function Prt(t){return t instanceof _rt||t instanceof Brt||t instanceof Srt}class Lrt{constructor(){Trt.set(this,void 0);Nrt(this,Trt,false,"f")}setModified(){Nrt(this,Trt,true,"f")}get modifiedFlag(){return zrt(this,Trt,"f")}}Trt=new WeakMap;class Irt extends Lrt{getNodeDepths(t,e,n){n.set(t,e);for(const i of t.children){this.getNodeDepths(i,e+1,n)}return n}optimize(t){const e=this.getNodeDepths(t,0,new Map);const n=[...e.entries()].sort(((t,e)=>e[1]-t[1]));for(const i of n){this.run(i[0])}return this.modifiedFlag}}class Rrt extends Lrt{optimize(t){this.run(t);for(const e of t.children){this.optimize(e)}return this.modifiedFlag}}class qrt extends Rrt{mergeNodes(t,e){const n=e.shift();for(const i of e){t.removeChild(i);i.parent=n;i.remove()}}run(t){const e=t.children.map((t=>t.hash()));const n={};for(let i=0;i<e.length;i++){if(n[e[i]]===undefined){n[e[i]]=[t.children[i]]}else{n[e[i]].push(t.children[i])}}for(const i of RZ(n)){if(n[i].length>1){this.setModified();this.mergeNodes(t,n[i])}}}}class Urt extends Rrt{constructor(t){super();this.requiresSelectionId=t&&gnt(t)}run(t){if(t instanceof Mrt){if(!(this.requiresSelectionId&&(Prt(t.parent)||t.parent instanceof Ort||t.parent instanceof Crt))){this.setModified();t.remove()}}}}class Wrt extends Lrt{optimize(t){this.run(t,new Set);return this.modifiedFlag}run(t,e){let n=new Set;if(t instanceof Htt){n=t.producedFields();if(TZ(n,e)){this.setModified();t.removeFormulas(e);if(t.producedFields.length===0){t.remove()}}}for(const i of t.children){this.run(i,new Set([...e,...n]))}}}class Grt extends Rrt{constructor(){super()}run(t){if(t instanceof Wtt&&!t.isRequired()){this.setModified();t.remove()}}}class Hrt extends Irt{run(t){if(Prt(t)){return}if(t.numChildren()>1){return}for(const e of t.children){if(e instanceof Crt){if(t instanceof Crt){this.setModified();t.merge(e)}else{if(LZ(t.producedFields(),e.dependentFields())){continue}this.setModified();e.swapWithParent()}}}return}}class Vrt extends Irt{run(t){const e=[...t.children];const n=t.children.filter((t=>t instanceof Crt));if(t.numChildren()>1&&n.length>=1){const i={};const r=new Set;for(const t of n){const e=t.parse;for(const t of RZ(e)){if(!(t in i)){i[t]=e[t]}else if(i[t]!==e[t]){r.add(t)}}}for(const t of r){delete i[t]}if(!IZ(i)){this.setModified();const n=new Crt(t,i);for(const r of e){if(r instanceof Crt){for(const t of RZ(i)){delete r.parse[t]}}t.removeChild(r);r.parent=n;if(r instanceof Crt&&RZ(r.parse).length===0){r.remove()}}}}}}class Yrt extends Irt{run(t){if(t instanceof Wtt||t.numChildren()>0||t instanceof Frt);else if(t instanceof _rt);else{this.setModified();t.remove()}}}class Xrt extends Irt{run(t){const e=t.children.filter((t=>t instanceof Htt));const n=e.pop();for(const i of e){this.setModified();n.merge(i)}}}class Jrt extends Irt{run(t){const e=t.children.filter((t=>t instanceof Ort));const n={};for(const i of e){const t=EZ(i.groupBy);if(!(t in n)){n[t]=[]}n[t].push(i)}for(const i of RZ(n)){const e=n[i];if(e.length>1){const n=e.pop();for(const i of e){if(n.merge(i)){t.removeChild(i);i.parent=n;i.remove();this.setModified()}}}}}}class Qrt extends Irt{constructor(t){super();this.model=t}run(t){const e=!(Prt(t)||t instanceof Ant||t instanceof Crt||t instanceof Mrt);const n=[];const i=[];for(const r of t.children){if(r instanceof wrt){if(e&&!LZ(t.producedFields(),r.dependentFields())){n.push(r)}else{i.push(r)}}}if(n.length>0){const e=n.pop();for(const t of n){e.merge(t,this.model.renameSignal.bind(this.model))}this.setModified();if(t instanceof wrt){t.merge(e,this.model.renameSignal.bind(this.model))}else{e.swapWithParent()}}if(i.length>1){const t=i.pop();for(const e of i){t.merge(e,this.model.renameSignal.bind(this.model))}this.setModified()}}}class Zrt extends Irt{run(t){const e=[...t.children];const n=CZ(e,(t=>t instanceof Wtt));if(!n||t.numChildren()<=1){return}const i=[];let r;for(const u of e){if(u instanceof Wtt){let e=u;while(e.numChildren()===1){const[t]=e.children;if(t instanceof Wtt){e=t}else{break}}i.push(...e.children);if(r){t.removeChild(u);u.parent=r.parent;r.parent.removeChild(r);r.parent=e;this.setModified()}else{r=e}}else{i.push(u)}}if(i.length){this.setModified();for(const t of i){t.parent.removeChild(t);t.parent=r}}}}class Krt extends Utt{constructor(t,e){super(t);this.transform=e}clone(){return new Krt(null,xZ(this.transform))}addDimensions(t){this.transform.groupby=_Z(this.transform.groupby.concat(t),(t=>t))}dependentFields(){const t=new Set;if(this.transform.groupby){this.transform.groupby.forEach(t.add,t)}this.transform.joinaggregate.map((t=>t.field)).filter((t=>t!==undefined)).forEach(t.add,t);return t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var e;return(e=t.as)!==null&&e!==void 0?e:A8(t)}hash(){return`JoinAggregateTransform ${EZ(this.transform)}`}assemble(){const t=[];const e=[];const n=[];for(const r of this.transform.joinaggregate){e.push(r.op);n.push(this.getDefaultName(r));t.push(r.field===undefined?null:r.field)}const i=this.transform.groupby;return Object.assign({type:"joinaggregate",as:n,ops:e,fields:t},i!==undefined?{groupby:i}:{})}}function tut(t){return t.stack.stackBy.reduce(((t,e)=>{const n=e.fieldDef;const i=A8(n);if(i){t.push(i)}return t}),[])}function eut(t){return ve(t)&&t.every((t=>gn(t)))&&t.length>1}class nut extends Utt{constructor(t,e){super(t);this._stack=e}clone(){return new nut(null,xZ(this._stack))}static makeFromTransform(t,e){const{stack:n,groupby:i,as:r,offset:u="zero"}=e;const o=[];const s=[];if(e.sort!==undefined){for(const t of e.sort){o.push(t.field);s.push(nK(t.order,"ascending"))}}const a={field:o,order:s};let f;if(eut(r)){f=r}else if(gn(r)){f=[r,`${r}_end`]}else{f=[`${e.stack}_start`,`${e.stack}_end`]}return new nut(t,{dimensionFieldDefs:[],stackField:n,groupby:i,offset:u,sort:a,facetby:[],as:f})}static makeFromEncoding(t,e){const n=e.stack;const{encoding:i}=e;if(!n){return null}const{groupbyChannels:r,fieldChannel:u,offset:o,impute:s}=n;const a=r.map((t=>{const e=i[t];return z8(e)})).filter((t=>!!t));const f=tut(e);const c=e.encoding.order;let l;if(ve(c)||s8(c)){l=B1(c)}else{l=f.reduce(((t,e)=>{t.field.push(e);t.order.push(u==="y"?"descending":"ascending");return t}),{field:[],order:[]})}return new nut(t,{dimensionFieldDefs:a,stackField:e.vgField(u),facetby:[],stackby:f,sort:l,offset:o,impute:s,as:[e.vgField(u,{suffix:"start",forAs:true}),e.vgField(u,{suffix:"end",forAs:true})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;t.add(this._stack.stackField);this.getGroupbyFields().forEach(t.add,t);this._stack.facetby.forEach(t.add,t);this._stack.sort.field.forEach(t.add,t);return t}producedFields(){return new Set(this._stack.as)}hash(){return`Stack ${EZ(this._stack)}`}getGroupbyFields(){const{dimensionFieldDefs:t,impute:e,groupby:n}=this._stack;if(t.length>0){return t.map((t=>{if(t.bin){if(e){return[A8(t,{binSuffix:"mid"})]}return[A8(t,{}),A8(t,{binSuffix:"end"})]}return[A8(t)]})).flat()}return n!==null&&n!==void 0?n:[]}assemble(){const t=[];const{facetby:e,dimensionFieldDefs:n,stackField:i,stackby:r,sort:u,offset:o,impute:s,as:a}=this._stack;if(s){for(const u of n){const{bandPosition:n=.5,bin:o}=u;if(o){const e=A8(u,{expr:"datum"});const i=A8(u,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:`${n}*${e}+${1-n}*${i}`,as:A8(u,{binSuffix:"mid",forAs:true})})}t.push({type:"impute",field:i,groupby:[...r,...e],key:A8(u,{binSuffix:"mid"}),method:"value",value:0})}}t.push({type:"stack",groupby:[...this.getGroupbyFields(),...e],field:i,sort:u,as:a,offset:o});return t}}class iut extends Utt{constructor(t,e){super(t);this.transform=e}clone(){return new iut(null,xZ(this.transform))}addDimensions(t){this.transform.groupby=_Z(this.transform.groupby.concat(t),(t=>t))}dependentFields(){var t,e;const n=new Set;((t=this.transform.groupby)!==null&&t!==void 0?t:[]).forEach(n.add,n);((e=this.transform.sort)!==null&&e!==void 0?e:[]).forEach((t=>n.add(t.field)));this.transform.window.map((t=>t.field)).filter((t=>t!==undefined)).forEach(n.add,n);return n}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var e;return(e=t.as)!==null&&e!==void 0?e:A8(t)}hash(){return`WindowTransform ${EZ(this.transform)}`}assemble(){var t;const e=[];const n=[];const i=[];const r=[];for(const l of this.transform.window){n.push(l.op);i.push(this.getDefaultName(l));r.push(l.param===undefined?null:l.param);e.push(l.field===undefined?null:l.field)}const u=this.transform.frame;const o=this.transform.groupby;if(u&&u[0]===null&&u[1]===null&&n.every((t=>H0(t)))){return Object.assign({type:"joinaggregate",as:i,ops:n,fields:e},o!==undefined?{groupby:o}:{})}const s=[];const a=[];if(this.transform.sort!==undefined){for(const e of this.transform.sort){s.push(e.field);a.push((t=e.order)!==null&&t!==void 0?t:"ascending")}}const f={field:s,order:a};const c=this.transform.ignorePeers;return Object.assign(Object.assign(Object.assign({type:"window",params:r,as:i,ops:n,fields:e,sort:f},c!==undefined?{ignorePeers:c}:{}),o!==undefined?{groupby:o}:{}),u!==undefined?{frame:u}:{})}}function rut(t){function e(n){if(!(n instanceof Frt)){const i=n.clone();if(i instanceof Wtt){const e=sut+i.getSource();i.setSource(e);t.model.component.data.outputNodes[e]=i}else if(i instanceof Ort||i instanceof nut||i instanceof iut||i instanceof Krt){i.addDimensions(t.fields)}for(const t of n.children.flatMap(e)){t.parent=i}return[i]}return n.children.flatMap(e)}return e}function uut(t){if(t instanceof Frt){if(t.numChildren()===1&&!(t.children[0]instanceof Wtt)){const e=t.children[0];if(e instanceof Ort||e instanceof nut||e instanceof iut||e instanceof Krt){e.addDimensions(t.fields)}e.swapWithParent();uut(t)}else{const e=t.model.component.data.main;out(e);const n=rut(t);const i=t.children.map(n).flat();for(const t of i){t.parent=e}}}else{t.children.map(uut)}}function out(t){if(t instanceof Wtt&&t.type===Btt.Main){if(t.numChildren()===1){const e=t.children[0];if(!(e instanceof Frt)){e.swapWithParent();out(t)}}}}const sut="scale_";const aut=5;function fut(t){for(const e of t){for(const t of e.children){if(t.parent!==e){return false}}if(!fut(e.children)){return false}}return true}function cut(t,e){let n=false;for(const i of e){n=t.optimize(i)||n}return n}function lut(t,e,n){let i=t.sources;let r=false;r=cut(new Grt,i)||r;r=cut(new Urt(e),i)||r;i=i.filter((t=>t.numChildren()>0));r=cut(new Yrt,i)||r;i=i.filter((t=>t.numChildren()>0));if(!n){r=cut(new Hrt,i)||r;r=cut(new Qrt(e),i)||r;r=cut(new Wrt,i)||r;r=cut(new Vrt,i)||r;r=cut(new Jrt,i)||r;r=cut(new Xrt,i)||r;r=cut(new qrt,i)||r;r=cut(new Zrt,i)||r}t.sources=i;return r}function dut(t,e){fut(t.sources);let n=0;let i=0;for(let r=0;r<aut;r++){if(!lut(t,e,true)){break}n++}t.sources.map(uut);for(let r=0;r<aut;r++){if(!lut(t,e,false)){break}i++}fut(t.sources);if(Math.max(n,i)===aut){c3(`Maximum optimization runs(${aut}) reached.`)}}class hut{constructor(t){Object.defineProperty(this,"signal",{enumerable:true,get:t})}static fromName(t,e){return new hut((()=>t(e)))}}var put=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function mut(t){if(wot(t)){gut(t)}else{but(t)}}function gut(t){const e=t.component.scales;for(const n of RZ(e)){const i=yut(t,n);const r=e[n];r.setWithExplicit("domains",i);Fut(t,n);if(t.component.data.isFaceted){let e=t;while(!Aot(e)&&e.parent){e=e.parent}const r=e.component.resolve.scale[n];if(r==="shared"){for(const t of i.value){if(h1(t)){t.data=sut+t.data.replace(sut,"")}}}}}}function but(t){for(const n of t.children){mut(n)}const e=t.component.scales;for(const n of RZ(e)){let i;let r=null;for(const e of t.children){const t=e.component.scales[n];if(t){if(i===undefined){i=t.getWithExplicit("domains")}else{i=Ott(i,t.getWithExplicit("domains"),"domains","scale",Eut)}const e=t.get("selectionExtent");if(r&&e&&r.param!==e.param){c3(Q1)}r=e}}e[n].setWithExplicit("domains",i);if(r){e[n].set("selectionExtent",r,true)}}}function vut(t,e,n,i){if(t==="unaggregated"){const{valid:t,reason:i}=kut(e,n);if(!t){c3(i);return undefined}}else if(t===undefined&&i.useUnaggregatedDomain){const{valid:t}=kut(e,n);if(t){return"unaggregated"}}return t}function yut(t,e){const n=t.getScaleComponent(e).get("type");const{encoding:i}=t;const r=vut(t.scaleDomain(e),t.typedFieldDef(e),n,t.config.scale);if(r!==t.scaleDomain(e)){t.specifiedScales[e]=Object.assign(Object.assign({},t.specifiedScales[e]),{domain:r})}if(e==="x"&&T8(i.x2)){if(T8(i.x)){return Ott(xut(n,r,t,"x"),xut(n,r,t,"x2"),"domain","scale",Eut)}else{return xut(n,r,t,"x2")}}else if(e==="y"&&T8(i.y2)){if(T8(i.y)){return Ott(xut(n,r,t,"y"),xut(n,r,t,"y2"),"domain","scale",Eut)}else{return xut(n,r,t,"y2")}}return xut(n,r,t,e)}function wut(t,e,n){return t.map((t=>{const i=V8(t,{timeUnit:n,type:e});return{signal:`{data: ${i}}`}}))}function Aut(t,e,n){var i;const r=(i=z3(n))===null||i===void 0?void 0:i.unit;if(e==="temporal"||r){return wut(t,e,r)}return[t]}function xut(t,e,n,i){const{encoding:r}=n;const u=T8(r[i]);const{type:o}=u;const s=u["timeUnit"];if(E5(e)){const r=xut(t,undefined,n,i);const u=Aut(e.unionWith,o,s);return ytt([...r.value,...u])}else if(f1(e)){return ytt([e])}else if(e&&e!=="unaggregated"&&!k5(e)){return ytt(Aut(e,o,s))}const a=n.stack;if(a&&i===a.fieldChannel){if(a.offset==="normalize"){return wtt([[0,1]])}const t=n.requestDataName(Btt.Main);return wtt([{data:t,field:n.vgField(i,{suffix:"start"})},{data:t,field:n.vgField(i,{suffix:"end"})}])}const f=z0(i)&&s8(u)?Dut(n,i,t):undefined;if(f8(u)){const t=Aut([u.datum],o,s);return wtt(t)}const c=u;if(e==="unaggregated"){const t=n.requestDataName(Btt.Main);const{field:e}=u;return wtt([{data:t,field:A8({field:e,aggregate:"min"})},{data:t,field:A8({field:e,aggregate:"max"})}])}else if(K0(c.bin)){if(w5(t)){if(t==="bin-ordinal"){return wtt([])}return wtt([{data:WZ(f)?n.requestDataName(Btt.Main):n.requestDataName(Btt.Raw),field:n.vgField(i,X8(c,i)?{binSuffix:"range"}:{}),sort:f===true||!ye(f)?{field:n.vgField(i,{}),op:"min"}:f}])}else{const{bin:t}=c;if(K0(t)){const e=brt(n,c.field,t);return wtt([new hut((()=>{const t=n.getSignalName(e);return`[${t}.start, ${t}.stop]`}))])}else{return wtt([{data:n.requestDataName(Btt.Main),field:n.vgField(i,{})}])}}}else if(c.timeUnit&&jZ(["time","utc"],t)&&n8(c,wot(n)?n.encoding[p0(i)]:undefined,n.markDef,n.config)){const t=n.requestDataName(Btt.Main);return wtt([{data:t,field:n.vgField(i)},{data:t,field:n.vgField(i,{suffix:"end"})}])}else if(f){return wtt([{data:WZ(f)?n.requestDataName(Btt.Main):n.requestDataName(Btt.Raw),field:n.vgField(i),sort:f}])}else{return wtt([{data:n.requestDataName(Btt.Main),field:n.vgField(i)}])}}function Out(t,e){const{op:n,field:i,order:r}=t;return Object.assign(Object.assign({op:n!==null&&n!==void 0?n:e?"sum":I6},i?{field:ZZ(i)}:{}),r?{order:r}:{})}function Fut(t,e){var n;const i=t.component.scales[e];const r=t.specifiedScales[e].domain;const u=(n=t.fieldDef(e))===null||n===void 0?void 0:n.bin;const o=k5(r)&&r;const s=e1(u)&&n1(u.extent)&&u.extent;if(o||s){i.set("selectionExtent",o!==null&&o!==void 0?o:s,true)}}function Dut(t,e,n){if(!w5(n)){return undefined}const i=t.fieldDef(e);const r=i.sort;if(G6(r)){return{op:"min",field:Znt(i,e),order:"ascending"}}const{stack:u}=t;const o=u?new Set([...u.groupbyFields,...u.stackBy.map((t=>t.fieldDef.field))]):undefined;if(W6(r)){const t=u&&!o.has(r.field);return Out(r,t)}else if(U6(r)){const{encoding:e,order:n}=r;const i=t.fieldDef(e);const{aggregate:s,field:a}=i;const f=u&&!o.has(a);if(W0(s)||G0(s)){return Out({field:A8(i),order:n},f)}else if(H0(s)||!s){return Out({op:s,field:a,order:n},f)}}else if(r==="descending"){return{op:"min",field:t.vgField(e),order:"descending"}}else if(jZ(["ascending",undefined],r)){return true}return undefined}function kut(t,e){const{aggregate:n,type:i}=t;if(!n){return{valid:false,reason:B2(t)}}if(gn(n)&&!Q0.has(n)){return{valid:false,reason:S2(n)}}if(i==="quantitative"){if(e==="log"){return{valid:false,reason:_2(t)}}}return{valid:true}}function Eut(t,e,n,i){if(t.explicit&&e.explicit){c3(R2(n,i,t.value,e.value))}return{explicit:t.explicit,value:[...t.value,...e.value]}}function $ut(t){const e=_Z(t.map((t=>{if(h1(t)){const e=put(t,["sort"]);return e}return t})),EZ);const n=_Z(t.map((t=>{if(h1(t)){const e=t.sort;if(e!==undefined&&!WZ(e)){if("op"in e&&e.op==="count"){delete e.field}if(e.order==="ascending"){delete e.order}}return e}return undefined})).filter((t=>t!==undefined)),EZ);if(e.length===0){return undefined}else if(e.length===1){const e=t[0];if(h1(e)&&n.length>0){let t=n[0];if(n.length>1){c3(W2);t=true}else{if(ye(t)&&"field"in t){const n=t.field;if(e.field===n){t=t.order?{order:t.order}:true}}}return Object.assign(Object.assign({},e),{sort:t})}return e}const i=_Z(n.map((t=>{if(WZ(t)||!("op"in t)||gn(t.op)&&t.op in U0){return t}c3(U2(t));return true})),EZ);let r;if(i.length===1){r=i[0]}else if(i.length>1){c3(W2);r=true}const u=_Z(t.map((t=>{if(h1(t)){return t.data}return null})),(t=>t));if(u.length===1&&u[0]!==null){const t=Object.assign({data:u[0],fields:e.map((t=>t.field))},r?{sort:r}:{});return t}return Object.assign({fields:e},r?{sort:r}:{})}function jut(t){if(h1(t)&&gn(t.field)){return t.field}else if(l1(t)){let e;for(const n of t.fields){if(h1(n)&&gn(n.field)){if(!e){e=n.field}else if(e!==n.field){c3(G2);return e}}}c3(H2);return e}else if(d1(t)){c3(V2);const e=t.fields[0];return gn(e)?e:undefined}return undefined}function Cut(t,e){const n=t.component.scales[e];const i=n.get("domains").map((e=>{if(h1(e)){e.data=t.lookupDataSource(e.data)}return e}));return $ut(i)}var Mut=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function But(t){if(Oot(t)||xot(t)){return t.children.reduce(((t,e)=>t.concat(But(e))),Sut(t))}else{return Sut(t)}}function Sut(t){return RZ(t.component.scales).reduce(((e,n)=>{const i=t.component.scales[n];if(i.merged){return e}const r=i.combine();const{name:u,type:o,selectionExtent:s,domains:a,range:f,reverse:c}=r,l=Mut(r,["name","type","selectionExtent","domains","range","reverse"]);const d=_ut(r.range,u,n,t);const h=Cut(t,n);const p=s?Rtt(t,s,i,h):null;e.push(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:u,type:o},h?{domain:h}:{}),p?{domainRaw:p}:{}),{range:d}),c!==undefined?{reverse:c}:{}),l));return e}),[])}function _ut(t,e,n,i){if(F0(n)){if(c1(t)){return{step:{signal:`${e}_step`}}}}else if(ye(t)&&h1(t)){return Object.assign(Object.assign({},t),{data:i.lookupDataSource(t.data)})}return t}class Nut extends vtt{constructor(t,e){super({},{name:t});this.merged=false;this.setWithExplicit("type",e)}domainDefinitelyIncludesZero(){if(this.get("zero")!==false){return true}return CZ(this.get("domains"),(t=>ve(t)&&t.length===2&&t[0]<=0&&t[1]>=0))}}const zut=["range","scheme"];function Tut(t){const e=t.component.scales;for(const n of N0){const i=e[n];if(!i){continue}const r=Lut(n,t);i.setWithExplicit("range",r)}}function Put(t,e){const n=t.fieldDef(e);if(n===null||n===void 0?void 0:n.bin){const{bin:i,field:r}=n;const u=m0(e);const o=t.getName(u);if(ye(i)&&i.binned&&i.step!==undefined){return new hut((()=>{const n=t.scaleName(e);const r=`(domain("${n}")[1] - domain("${n}")[0]) / ${i.step}`;return`${t.getSignalName(o)} / (${r})`}))}else if(K0(i)){const e=brt(t,r,i);return new hut((()=>{const n=t.getSignalName(e);const i=`(${n}.stop - ${n}.start) / ${n}.step`;return`${t.getSignalName(o)} / (${i})`}))}}return undefined}function Lut(t,e){const n=e.specifiedScales[t];const{size:i}=e;const r=e.getScaleComponent(t);const u=r.get("type");for(const l of zut){if(n[l]!==undefined){const i=B5(u,l);const r=S5(t,l);if(!i){c3(P2(u,l,t))}else if(r){c3(r)}else{switch(l){case"range":{const i=n.range;if(ve(i)){if(F0(t)){return ytt(i.map((t=>{if(t==="width"||t==="height"){const n=e.getName(t);const i=e.getSignalName.bind(e);return hut.fromName(i,n)}return t})))}}else if(ye(i)){return ytt({data:e.requestDataName(Btt.Main),field:i.field,sort:{op:"min",field:e.vgField(t)}})}return ytt(i)}case"scheme":return ytt(Iut(n[l]))}}}}const o=t===pK||t==="xOffset"?"width":"height";const s=i[o];if(F4(s)){if(F0(t)){if(w5(u)){const n=qut(s,e,t);if(n){return ytt({step:n})}}else{c3(L2(o))}}else if(j0(t)){const n=t===vK?"x":"y";const i=e.getScaleComponent(n);const r=i.get("type");if(r==="band"){const t=Uut(s,u);if(t){return ytt(t)}}}}const{rangeMin:a,rangeMax:f}=n;const c=Rut(t,e);if((a!==undefined||f!==undefined)&&B5(u,"rangeMin")&&ve(c)&&c.length===2){return ytt([a!==null&&a!==void 0?a:c[0],f!==null&&f!==void 0?f:c[1]])}return wtt(c)}function Iut(t){if(D5(t)){return Object.assign({scheme:t.name},DZ(t,["name"]))}return{scheme:t}}function Rut(t,e){const{size:n,config:i,mark:r,encoding:u}=e;const o=e.getSignalName.bind(e);const{type:s}=T8(u[t]);const a=e.getScaleComponent(t);const f=a.get("type");const{domain:c,domainMid:l}=e.specifiedScales[t];switch(t){case pK:case mK:{if(jZ(["point","band"],f)){const r=Gut(t,n,i.view);if(F4(r)){const n=qut(r,e,t);return{step:n}}}const r=m0(t);const u=e.getName(r);if(t===mK&&A5(f)){return[hut.fromName(o,u),0]}else{return[0,hut.fromName(o,u)]}}case vK:case yK:return Wut(t,e,f);case BK:{const u=e.component.scales[t].get("zero");const o=Yut(r,u,i);const s=Jut(r,n,e,i);if(O5(f)){return Vut(o,s,Hut(f,i,c,t))}else{return[o,s]}}case xK:return[0,Math.PI*2];case SK:return[0,360];case wK:{return[0,new hut((()=>{const t=e.getSignalName("width");const n=e.getSignalName("height");return`min(${t},${n})/2`}))]}case TK:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case PK:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case MK:return"symbol";case $K:case jK:case CK:if(f==="ordinal"){return s==="nominal"?"category":"ordinal"}else{if(l!==undefined){return"diverging"}else{return r==="rect"||r==="geoshape"?"heatmap":"ramp"}}case _K:case NK:case zK:return[i.scale.minOpacity,i.scale.maxOpacity]}}function qut(t,e,n){var i,r,u,o,s;const{encoding:a}=e;const f=e.getScaleComponent(n);const c=b0(n);const l=a[c];const d=O4({step:t,offsetIsDiscrete:d8(l)&&e5(l.type)});if(d==="offset"&&f9(a,c)){const n=e.getScaleComponent(c);const a=e.scaleName(c);let l=`domain('${a}').length`;if(n.get("type")==="band"){const t=(r=(i=n.get("paddingInner"))!==null&&i!==void 0?i:n.get("padding"))!==null&&r!==void 0?r:0;const e=(o=(u=n.get("paddingOuter"))!==null&&u!==void 0?u:n.get("padding"))!==null&&o!==void 0?o:0;l=`bandspace(${l}, ${t}, ${e})`}const d=(s=f.get("paddingInner"))!==null&&s!==void 0?s:f.get("padding");return{signal:`${t.step} * ${l} / (1-${O1(d)})`}}else{return t.step}}function Uut(t,e){const n=O4({step:t,offsetIsDiscrete:w5(e)});if(n==="offset"){return{step:t.step}}return undefined}function Wut(t,e,n){const i=t===vK?"x":"y";const r=e.getScaleComponent(i);const u=r.get("type");const o=e.scaleName(i);if(u==="band"){const t=Gut(i,e.size,e.config.view);if(F4(t)){const e=Uut(t,n);if(e){return e}}return[0,{signal:`bandwidth('${o}')`}]}else{return OZ(`Cannot use ${t} scale if ${i} scale is not discrete.`)}}function Gut(t,e,n){const i=t===pK?"width":"height";const r=e[i];if(r){return r}return S4(n,i)}function Hut(t,e,n,i){switch(t){case"quantile":return e.scale.quantileCount;case"quantize":return e.scale.quantizeCount;case"threshold":if(n!==undefined&&ve(n)){return n.length+1}else{c3(u3(i));return 3}}}function Vut(t,e,n){const i=()=>{const i=D1(e);const r=D1(t);const u=`(${i} - ${r}) / (${n} - 1)`;return`sequence(${r}, ${i} + ${u}, ${u})`};if(f1(e)){return new hut(i)}else{return{signal:i()}}}function Yut(t,e,n){if(e){if(f1(e)){return{signal:`${e.signal} ? 0 : ${Yut(t,false,n)}`}}else{return 0}}switch(t){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(w2("size",t))}const Xut=.95;function Jut(t,e,n,i){const r={x:Put(n,"x"),y:Put(n,"y")};switch(t){case"bar":case"tick":{if(i.scale.maxBandSize!==undefined){return i.scale.maxBandSize}const t=Qut(e,r,i.view);if(pn(t)){return t-1}else{return new hut((()=>`${t.signal} - 1`))}}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize){return i.scale.maxSize}const t=Qut(e,r,i.view);if(pn(t)){return Math.pow(Xut*t,2)}else{return new hut((()=>`pow(${Xut} * ${t.signal}, 2)`))}}}throw new Error(w2("size",t))}function Qut(t,e,n){const i=F4(t.width)?t.width.step:B4(n,"width");const r=F4(t.height)?t.height.step:B4(n,"height");if(e.x||e.y){return new hut((()=>{const t=[e.x?e.x.signal:i,e.y?e.y.signal:r];return`min(${t.join(", ")})`}))}return Math.min(i,r)}function Zut(t,e){if(wot(t)){Kut(t,e)}else{not(t,e)}}function Kut(t,e){const n=t.component.scales;const{config:i,encoding:r,markDef:u,specifiedScales:o}=t;for(const s of RZ(n)){const a=o[s];const f=n[s];const c=t.getScaleComponent(s);const l=T8(r[s]);const d=a[e];const h=c.get("type");const p=c.get("padding");const m=c.get("paddingInner");const g=B5(h,e);const b=S5(s,e);if(d!==undefined){if(!g){c3(P2(h,e,s))}else if(b){c3(b)}}if(g&&b===undefined){if(d!==undefined){const t=l["timeUnit"];const n=l.type;switch(e){case"domainMax":case"domainMin":if(d3(a[e])||n==="temporal"||t){f.set(e,{signal:V8(a[e],{type:n,timeUnit:t})},true)}else{f.set(e,a[e],true)}break;default:f.copyKeyFromObject(e,a)}}else{const n=e in tot?tot[e]({model:t,channel:s,fieldOrDatumDef:l,scaleType:h,scalePadding:p,scalePaddingInner:m,domain:a.domain,domainMin:a.domainMin,domainMax:a.domainMax,markDef:u,config:i,hasNestedOffsetScale:c9(r,s)}):i.scale[e];if(n!==undefined){f.set(e,n,false)}}}}}const tot={bins:({model:t,fieldOrDatumDef:e})=>s8(e)?iot(t,e):undefined,interpolate:({channel:t,fieldOrDatumDef:e})=>rot(t,e.type),nice:({scaleType:t,channel:e,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:u})=>uot(t,e,n,i,r,u),padding:({channel:t,scaleType:e,fieldOrDatumDef:n,markDef:i,config:r})=>oot(t,e,r.scale,n,i,r.bar),paddingInner:({scalePadding:t,channel:e,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:u})=>sot(t,e,n.type,i,r.scale,u),paddingOuter:({scalePadding:t,channel:e,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:u})=>aot(t,e,n,i,r.scale,u),reverse:({fieldOrDatumDef:t,scaleType:e,channel:n,config:i})=>{const r=s8(t)?t.sort:undefined;return fot(e,r,n,i.scale)},zero:({channel:t,fieldOrDatumDef:e,domain:n,markDef:i,scaleType:r})=>cot(t,e,n,i,r)};function eot(t){if(wot(t)){Tut(t)}else{not(t,"range")}}function not(t,e){const n=t.component.scales;for(const i of t.children){if(e==="range"){eot(i)}else{Zut(i,e)}}for(const i of RZ(n)){let r;for(const n of t.children){const t=n.component.scales[i];if(t){const n=t.getWithExplicit(e);r=Ott(r,n,e,"scale",Att(((t,n)=>{switch(e){case"range":if(t.step&&n.step){return t.step-n.step}return 0}return 0})))}}n[i].setWithExplicit(e,r)}}function iot(t,e){const n=e.bin;if(K0(n)){const i=brt(t,e.field,n);return new hut((()=>t.getSignalName(i)))}else if(t1(n)&&e1(n)&&n.step!==undefined){return{step:n.step}}return undefined}function rot(t,e){if(jZ([$K,jK,CK],t)&&e!=="nominal"){return"hcl"}return undefined}function uot(t,e,n,i,r,u){var o;if(((o=z8(u))===null||o===void 0?void 0:o.bin)||ve(n)||r!=null||i!=null||jZ([f5.TIME,f5.UTC],t)){return undefined}return F0(e)?true:undefined}function oot(t,e,n,i,r,u){if(F0(t)){if(x5(e)){if(n.continuousPadding!==undefined){return n.continuousPadding}const{type:e,orient:o}=r;if(e==="bar"&&!(s8(i)&&(i.bin||i.timeUnit))){if(o==="vertical"&&t==="x"||o==="horizontal"&&t==="y"){return u.continuousBandSize}}}if(e===f5.POINT){return n.pointPadding}}return undefined}function sot(t,e,n,i,r,u=false){if(t!==undefined){return undefined}if(F0(e)){const{bandPaddingInner:t,barBandPaddingInner:e,rectBandPaddingInner:i,bandWithNestedOffsetPaddingInner:o}=r;if(u){return o}return nK(t,n==="bar"?e:i)}else if(j0(e)){if(i===f5.BAND){return r.offsetBandPaddingInner}}return undefined}function aot(t,e,n,i,r,u=false){if(t!==undefined){return undefined}if(F0(e)){const{bandPaddingOuter:t,bandWithNestedOffsetPaddingOuter:e}=r;if(u){return e}if(n===f5.BAND){return nK(t,f1(i)?{signal:`${i.signal}/2`}:i/2)}}else if(j0(e)){if(n===f5.POINT){return.5}else if(n===f5.BAND){return r.offsetBandPaddingOuter}}return undefined}function fot(t,e,n,i){if(n==="x"&&i.xReverse!==undefined){if(A5(t)&&e==="descending"){if(f1(i.xReverse)){return{signal:`!${i.xReverse.signal}`}}else{return!i.xReverse}}return i.xReverse}if(A5(t)&&e==="descending"){return true}return undefined}function cot(t,e,n,i,r){const u=!!n&&n!=="unaggregated";if(u){if(A5(r)){if(ve(n)){const t=n[0];const e=n[n.length-1];if(t<=0&&e>=0){return true}}return false}}if(t==="size"&&e.type==="quantitative"&&!O5(r)){return true}if(!(s8(e)&&e.bin)&&jZ([...O0,...k0],t)){const{orient:e,type:n}=i;if(jZ(["bar","area","line","trail"],n)){if(e==="horizontal"&&t==="y"||e==="vertical"&&t==="x"){return false}}return true}return false}function lot(t,e,n,i,r=false){const u=dot(e,n,i,r);const{type:o}=t;if(!z0(e)){return null}if(o!==undefined){if(!N5(e,o)){c3(z2(e,o,u));return u}if(s8(n)&&!_5(o,n.type)){c3(T2(o,u));return u}return o}return u}function dot(t,e,n,i){var r;switch(e.type){case"nominal":case"ordinal":{if(e0(t)||R0(t)==="discrete"){if(t==="shape"&&e.type==="ordinal"){c3(k2(t,"ordinal"))}return"ordinal"}if(F0(t)||j0(t)){if(jZ(["rect","bar","image","rule"],n.type)){return"band"}if(i){return"band"}}else if(n.type==="arc"&&t in D0){return"band"}const u=n[m0(t)];if(c6(u)){return"band"}if(g8(e)&&((r=e.axis)===null||r===void 0?void 0:r.tickBand)){return"band"}return"point"}case"temporal":if(e0(t)){return"time"}else if(R0(t)==="discrete"){c3(k2(t,"temporal"));return"ordinal"}else if(s8(e)&&e.timeUnit&&z3(e.timeUnit).utc){return"utc"}return"time";case"quantitative":if(e0(t)){if(s8(e)&&K0(e.bin)){return"bin-ordinal"}return"linear"}else if(R0(t)==="discrete"){c3(k2(t,"quantitative"));return"ordinal"}return"linear";case"geojson":return undefined}throw new Error(h2(e.type))}function hot(t,{ignoreRange:e}={}){pot(t);mut(t);for(const n of M5){Zut(t,n)}if(!e){eot(t)}}function pot(t){if(wot(t)){t.component.scales=mot(t)}else{t.component.scales=bot(t)}}function mot(t){const{encoding:e,mark:n,markDef:i}=t;const r={};for(const u of N0){const o=T8(e[u]);if(o&&n===J5&&u===MK&&o.type===o5){continue}let s=o&&o["scale"];if(j0(u)){const t=v0(u);if(!c9(e,t)){if(s){c3(A2(u))}continue}}if(o&&s!==null&&s!==false){s!==null&&s!==void 0?s:s={};const n=c9(e,u);const a=lot(s,u,o,i,n);r[u]=new Nut(t.scaleName(`${u}`,true),{value:a,explicit:s.type===a})}}return r}const got=Att(((t,e)=>h5(t)-h5(e)));function bot(t){var e;var n;const i=t.component.scales={};const r={};const u=t.component.resolve;for(const o of t.children){pot(o);for(const i of RZ(o.component.scales)){(e=(n=u.scale)[i])!==null&&e!==void 0?e:n[i]=Ait(i,t);if(u.scale[i]==="shared"){const t=r[i];const e=o.component.scales[i].getWithExplicit("type");if(t){if(l5(t.value,e.value)){r[i]=Ott(t,e,"type","scale",got)}else{u.scale[i]="independent";delete r[i]}}else{r[i]=e}}}}for(const o of RZ(r)){const e=t.scaleName(o,true);const n=r[o];i[o]=new Nut(e,n);for(const i of t.children){const t=i.component.scales[o];if(t){i.renameScale(t.get("name"),e);t.merged=true}}}return i}var vot=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class yot{constructor(){this.nameMap={}}rename(t,e){this.nameMap[t]=e}has(t){return this.nameMap[t]!==undefined}get(t){while(this.nameMap[t]&&t!==this.nameMap[t]){t=this.nameMap[t]}return t}}function wot(t){return(t===null||t===void 0?void 0:t.type)==="unit"}function Aot(t){return(t===null||t===void 0?void 0:t.type)==="facet"}function xot(t){return(t===null||t===void 0?void 0:t.type)==="concat"}function Oot(t){return(t===null||t===void 0?void 0:t.type)==="layer"}class Fot{constructor(t,e,n,i,r,u,o){var s,a;this.type=e;this.parent=n;this.config=r;this.correctDataNames=t=>{var e,n,i;if((e=t.from)===null||e===void 0?void 0:e.data){t.from.data=this.lookupDataSource(t.from.data)}if((i=(n=t.from)===null||n===void 0?void 0:n.facet)===null||i===void 0?void 0:i.data){t.from.facet.data=this.lookupDataSource(t.from.facet.data)}return t};this.parent=n;this.config=r;this.view=u1(o);this.name=(s=t.name)!==null&&s!==void 0?s:i;this.title=a1(t.title)?{text:t.title}:t.title?u1(t.title):undefined;this.scaleNameMap=n?n.scaleNameMap:new yot;this.projectionNameMap=n?n.projectionNameMap:new yot;this.signalNameMap=n?n.signalNameMap:new yot;this.data=t.data;this.description=t.description;this.transforms=Z7((a=t.transform)!==null&&a!==void 0?a:[]);this.layout=e==="layer"||e==="unit"?{}:j4(t,e,r);this.component={data:{sources:n?n.component.data.sources:[],outputNodes:n?n.component.data.outputNodes:{},outputNodeRefCounts:n?n.component.data.outputNodeRefCounts:{},isFaceted:Y6(t)||(n===null||n===void 0?void 0:n.component.data.isFaceted)&&t.data===undefined},layoutSize:new vtt,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:Object.assign({scale:{},axis:{},legend:{}},u?xZ(u):{}),selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale();this.parseLayoutSize();this.renameTopLevelLayoutSizeSignal();this.parseSelections();this.parseProjection();this.parseData();this.parseAxesAndHeaders();this.parseLegends();this.parseMarkGroup()}parseScale(){hot(this)}parseProjection(){art(this)}renameTopLevelLayoutSizeSignal(){if(this.getName("width")!=="width"){this.renameSignal(this.getName("width"),"width")}if(this.getName("height")!=="height"){this.renameSignal(this.getName("height"),"height")}}parseLegends(){Git(this)}assembleEncodeFromView(t){const e=vot(t,["style"]);const n={};for(const i of RZ(e)){const t=e[i];if(t!==undefined){n[i]=x1(t)}}return n}assembleGroupEncodeEntry(t){let e={};if(this.view){e=this.assembleEncodeFromView(this.view)}if(!t){if(this.description){e["description"]=x1(this.description)}if(this.type==="unit"||this.type==="layer"){return Object.assign({width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height")},e!==null&&e!==void 0?e:{})}}return IZ(e)?undefined:e}assembleLayout(){if(!this.layout){return undefined}const t=this.layout,{spacing:e}=t,n=vot(t,["spacing"]);const{component:i,config:r}=this;const u=hit(i.layoutHeaders,r);return Object.assign(Object.assign(Object.assign({padding:e},this.assembleDefaultLayout()),n),u?{titleBand:u}:{})}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let e=[];for(const n of i0){if(t[n].title){e.push(rit(this,n))}}for(const n of nit){e=e.concat(sit(this,n))}return e}assembleAxes(){return Bnt(this.component.axes,this.config)}assembleLegends(){return ert(this)}assembleProjections(){return irt(this)}assembleTitle(){var t,e,n;const i=(t=this.title)!==null&&t!==void 0?t:{},{encoding:r}=i,u=vot(i,["encoding"]);const o=Object.assign(Object.assign(Object.assign({},s1(this.config.title).nonMarkTitleProperties),u),r?{encode:{update:r}}:{});if(o.text){if(jZ(["unit","layer"],this.type)){if(jZ(["middle",undefined],o.anchor)){(e=o.frame)!==null&&e!==void 0?e:o.frame="group"}}else{(n=o.anchor)!==null&&n!==void 0?n:o.anchor="start"}return IZ(o)?undefined:o}return undefined}assembleGroup(t=[]){const e={};t=t.concat(this.assembleSignals());if(t.length>0){e.signals=t}const n=this.assembleLayout();if(n){e.layout=n}e.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const i=!this.parent||Aot(this.parent)?But(this):[];if(i.length>0){e.scales=i}const r=this.assembleAxes();if(r.length>0){e.axes=r}const u=this.assembleLegends();if(u.length>0){e.legends=u}return e}getName(t){return GZ((this.name?`${this.name}_`:"")+t)}getDataName(t){return this.getName(Btt[t].toLowerCase())}requestDataName(t){const e=this.getDataName(t);const n=this.component.data.outputNodeRefCounts;n[e]=(n[e]||0)+1;return e}getSizeSignalRef(t){if(Aot(this.parent)){const e=yit(t);const n=E0(e);const i=this.component.scales[n];if(i&&!i.merged){const t=i.get("type");const e=i.get("range");if(w5(t)&&c1(e)){const t=i.get("name");const e=Cut(this,n);const r=jut(e);if(r){const e=A8({aggregate:"distinct",field:r},{expr:"datum"});return{signal:vit(t,i,e)}}else{c3(R1(n));return null}}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const e=this.component.data.outputNodes[t];if(!e){return t}return e.getSource()}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,e){this.signalNameMap.rename(t,e)}renameScale(t,e){this.scaleNameMap.rename(t,e)}renameProjection(t,e){this.projectionNameMap.rename(t,e)}scaleName(t,e){if(e){return this.getName(t)}if(f0(t)&&z0(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t))){return this.scaleNameMap.get(this.getName(t))}return undefined}projectionName(t){if(t){return this.getName("projection")}if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection"))){return this.projectionNameMap.get(this.getName("projection"))}return undefined}getScaleComponent(t){if(!this.component.scales){throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().")}const e=this.component.scales[t];if(e&&!e.merged){return e}return this.parent?this.parent.getScaleComponent(t):undefined}getSelectionComponent(t,e){let n=this.component.selection[t];if(!n&&this.parent){n=this.parent.getSelectionComponent(t,e)}if(!n){throw new Error(H1(e))}return n}hasAxisOrientSignalRef(){var t,e;return((t=this.component.axes.x)===null||t===void 0?void 0:t.some((t=>t.hasOrientSignalRef())))||((e=this.component.axes.y)===null||e===void 0?void 0:e.some((t=>t.hasOrientSignalRef())))}}class Dot extends Fot{vgField(t,e={}){const n=this.fieldDef(t);if(!n){return undefined}return A8(n,e)}reduceFieldDef(t,e){return v9(this.getMapping(),((e,n,i)=>{const r=z8(n);if(r){return t(e,r,i)}return e}),e)}forEachFieldDef(t,e){b9(this.getMapping(),((e,n)=>{const i=z8(e);if(i){t(i,n)}}),e)}}var kot=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class Eot extends Utt{constructor(t,e){var n,i,r;super(t);this.transform=e;this.transform=xZ(e);const u=(n=this.transform.as)!==null&&n!==void 0?n:[undefined,undefined];this.transform.as=[(i=u[0])!==null&&i!==void 0?i:"value",(r=u[1])!==null&&r!==void 0?r:"density"]}clone(){return new Eot(null,xZ(this.transform))}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`DensityTransform ${EZ(this.transform)}`}assemble(){const t=this.transform,{density:e}=t,n=kot(t,["density"]);const i=Object.assign({type:"kde",field:e},n);return i}}class $ot extends Utt{constructor(t,e){super(t);this.filter=e}clone(){return new $ot(null,Object.assign({},this.filter))}static make(t,e){const{config:n,mark:i,markDef:r}=e;const u=$1("invalid",r,n);if(u!=="filter"){return null}const o=e.reduceFieldDef(((t,n,r)=>{const u=z0(r)&&e.getScaleComponent(r);if(u){const e=u.get("type");if(A5(e)&&n.aggregate!=="count"&&!Q5(i)){t[n.field]=n}}return t}),{});if(!RZ(o).length){return null}return new $ot(t,o)}dependentFields(){return new Set(RZ(this.filter))}producedFields(){return new Set}hash(){return`FilterInvalid ${EZ(this.filter)}`}assemble(){const t=RZ(this.filter).reduce(((t,e)=>{const n=this.filter[e];const i=A8(n,{expr:"datum"});if(n!==null){if(n.type==="temporal"){t.push(`(isDate(${i}) || (isValid(${i}) && isFinite(+${i})))`)}else if(n.type==="quantitative"){t.push(`isValid(${i})`);t.push(`isFinite(+${i})`)}else;}return t}),[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class jot extends Utt{constructor(t,e){super(t);this.transform=e;this.transform=xZ(e);const{flatten:n,as:i=[]}=this.transform;this.transform.as=n.map(((t,e)=>{var n;return(n=i[e])!==null&&n!==void 0?n:t}))}clone(){return new jot(this.parent,xZ(this.transform))}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return`FlattenTransform ${EZ(this.transform)}`}assemble(){const{flatten:t,as:e}=this.transform;const n={type:"flatten",fields:t,as:e};return n}}class Cot extends Utt{constructor(t,e){var n,i,r;super(t);this.transform=e;this.transform=xZ(e);const u=(n=this.transform.as)!==null&&n!==void 0?n:[undefined,undefined];this.transform.as=[(i=u[0])!==null&&i!==void 0?i:"key",(r=u[1])!==null&&r!==void 0?r:"value"]}clone(){return new Cot(null,xZ(this.transform))}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return`FoldTransform ${EZ(this.transform)}`}assemble(){const{fold:t,as:e}=this.transform;const n={type:"fold",fields:t,as:e};return n}}class Mot extends Utt{constructor(t,e,n,i){super(t);this.fields=e;this.geojson=n;this.signal=i}clone(){return new Mot(null,xZ(this.fields),this.geojson,this.signal)}static parseAll(t,e){if(e.component.projection&&!e.component.projection.isFit){return t}let n=0;for(const i of[[DK,FK],[EK,kK]]){const r=i.map((t=>{const n=T8(e.encoding[t]);return s8(n)?n.field:f8(n)?{expr:`${n.datum}`}:p8(n)?{expr:`${n["value"]}`}:undefined}));if(r[0]||r[1]){t=new Mot(t,r,null,e.getName(`geojson_${n++}`))}}if(e.channelHasField(MK)){const i=e.typedFieldDef(MK);if(i.type===o5){t=new Mot(t,null,i.field,e.getName(`geojson_${n++}`))}}return t}dependentFields(){var t;const e=((t=this.fields)!==null&&t!==void 0?t:[]).filter(gn);return new Set([...this.geojson?[this.geojson]:[],...e])}producedFields(){return new Set}hash(){return`GeoJSON ${this.geojson} ${this.signal} ${EZ(this.fields)}`}assemble(){return[...this.geojson?[{type:"filter",expr:`isValid(datum["${this.geojson}"])`}]:[],Object.assign(Object.assign(Object.assign({type:"geojson"},this.fields?{fields:this.fields}:{}),this.geojson?{geojson:this.geojson}:{}),{signal:this.signal})]}}class Bot extends Utt{constructor(t,e,n,i){super(t);this.projection=e;this.fields=n;this.as=i}clone(){return new Bot(null,this.projection,xZ(this.fields),xZ(this.as))}static parseAll(t,e){if(!e.projectionName()){return t}for(const n of[[DK,FK],[EK,kK]]){const i=n.map((t=>{const n=T8(e.encoding[t]);return s8(n)?n.field:f8(n)?{expr:`${n.datum}`}:p8(n)?{expr:`${n["value"]}`}:undefined}));const r=n[0]===EK?"2":"";if(i[0]||i[1]){t=new Bot(t,e.projectionName(),i,[e.getName(`x${r}`),e.getName(`y${r}`)])}}return t}dependentFields(){return new Set(this.fields.filter(gn))}producedFields(){return new Set(this.as)}hash(){return`Geopoint ${this.projection} ${EZ(this.fields)} ${EZ(this.as)}`}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class Sot extends Utt{constructor(t,e){super(t);this.transform=e}clone(){return new Sot(null,xZ(this.transform))}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:e=0,stop:n,step:i}=t;const r=[e,n,...i?[i]:[]].join(",");return{signal:`sequence(${r})`}}static makeFromTransform(t,e){return new Sot(t,e)}static makeFromEncoding(t,e){const n=e.encoding;const i=n.x;const r=n.y;if(s8(i)&&s8(r)){const u=i.impute?i:r.impute?r:undefined;if(u===undefined){return undefined}const o=i.impute?r:r.impute?i:undefined;const{method:s,value:a,frame:f,keyvals:c}=u.impute;const l=y9(e.mark,n);return new Sot(t,Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({impute:u.field,key:o.field},s?{method:s}:{}),a!==undefined?{value:a}:{}),f?{frame:f}:{}),c!==undefined?{keyvals:c}:{}),l.length?{groupby:l}:{}))}return null}hash(){return`Impute ${EZ(this.transform)}`}assemble(){const{impute:t,key:e,keyvals:n,method:i,groupby:r,value:u,frame:o=[null,null]}=this.transform;const s=Object.assign(Object.assign(Object.assign(Object.assign({type:"impute",field:t,key:e},n?{keyvals:B7(n)?this.processSequence(n):n}:{}),{method:"value"}),r?{groupby:r}:{}),{value:!i||i==="value"?u:null});if(i&&i!=="value"){const e=Object.assign({type:"window",as:[`imputed_${t}_value`],ops:[i],fields:[t],frame:o,ignorePeers:false},r?{groupby:r}:{});const n={type:"formula",expr:`datum.${t} === null ? datum.imputed_${t}_value : datum.${t}`,as:t};return[s,e,n]}else{return[s]}}}var _ot=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class Not extends Utt{constructor(t,e){var n,i,r;super(t);this.transform=e;this.transform=xZ(e);const u=(n=this.transform.as)!==null&&n!==void 0?n:[undefined,undefined];this.transform.as=[(i=u[0])!==null&&i!==void 0?i:e.on,(r=u[1])!==null&&r!==void 0?r:e.loess]}clone(){return new Not(null,xZ(this.transform))}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`LoessTransform ${EZ(this.transform)}`}assemble(){const t=this.transform,{loess:e,on:n}=t,i=_ot(t,["loess","on"]);const r=Object.assign({type:"loess",x:n,y:e},i);return r}}class zot extends Utt{constructor(t,e,n){super(t);this.transform=e;this.secondary=n}clone(){return new zot(null,xZ(this.transform),this.secondary)}static make(t,e,n,i){const r=e.component.data.sources;const{from:u}=n;let o=null;if(_7(u)){let t=ost(u.data,r);if(!t){t=new _rt(u.data);r.push(t)}const n=e.getName(`lookup_${i}`);o=new Wtt(t,n,Btt.Lookup,e.component.data.outputNodeRefCounts);e.component.data.outputNodes[n]=o}else if(N7(u)){const t=u.param;n=Object.assign({as:t},n);let i;try{i=e.getSelectionComponent(GZ(t),t)}catch(mat){throw new Error(X1(t))}o=i.materialized;if(!o){throw new Error(J1(t))}}return new zot(t,n,o.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?Ue(this.transform.as):this.transform.from.fields)}hash(){return`Lookup ${EZ({transform:this.transform,secondary:this.secondary})}`}assemble(){let t;if(this.transform.from.fields){t=Object.assign({values:this.transform.from.fields},this.transform.as?{as:Ue(this.transform.as)}:{})}else{let e=this.transform.as;if(!gn(e)){c3(o2);e="_lookup"}t={as:[e]}}return Object.assign(Object.assign({type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup]},t),this.transform.default?{default:this.transform.default}:{})}}var Tot=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class Pot extends Utt{constructor(t,e){var n,i,r;super(t);this.transform=e;this.transform=xZ(e);const u=(n=this.transform.as)!==null&&n!==void 0?n:[undefined,undefined];this.transform.as=[(i=u[0])!==null&&i!==void 0?i:"prob",(r=u[1])!==null&&r!==void 0?r:"value"]}clone(){return new Pot(null,xZ(this.transform))}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`QuantileTransform ${EZ(this.transform)}`}assemble(){const t=this.transform,{quantile:e}=t,n=Tot(t,["quantile"]);const i=Object.assign({type:"quantile",field:e},n);return i}}var Lot=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};class Iot extends Utt{constructor(t,e){var n,i,r;super(t);this.transform=e;this.transform=xZ(e);const u=(n=this.transform.as)!==null&&n!==void 0?n:[undefined,undefined];this.transform.as=[(i=u[0])!==null&&i!==void 0?i:e.on,(r=u[1])!==null&&r!==void 0?r:e.regression]}clone(){return new Iot(null,xZ(this.transform))}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return`RegressionTransform ${EZ(this.transform)}`}assemble(){const t=this.transform,{regression:e,on:n}=t,i=Lot(t,["regression","on"]);const r=Object.assign({type:"regression",x:n,y:e},i);return r}}class Rot extends Utt{constructor(t,e){super(t);this.transform=e}clone(){return new Rot(null,xZ(this.transform))}addDimensions(t){var e;this.transform.groupby=_Z(((e=this.transform.groupby)!==null&&e!==void 0?e:[]).concat(t),(t=>t))}producedFields(){return undefined}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!==null&&t!==void 0?t:[]])}hash(){return`PivotTransform ${EZ(this.transform)}`}assemble(){const{pivot:t,value:e,groupby:n,limit:i,op:r}=this.transform;return Object.assign(Object.assign(Object.assign({type:"pivot",field:t,value:e},i!==undefined?{limit:i}:{}),r!==undefined?{op:r}:{}),n!==undefined?{groupby:n}:{})}}class qot extends Utt{constructor(t,e){super(t);this.transform=e}clone(){return new qot(null,xZ(this.transform))}dependentFields(){return new Set}producedFields(){return new Set}hash(){return`SampleTransform ${EZ(this.transform)}`}assemble(){return{type:"sample",size:this.transform.sample}}}function Uot(t){let e=0;function n(i,r){var u;if(i instanceof _rt){if(!i.isGenerator&&!Dtt(i.data)){t.push(r);const e={name:null,source:r.name,transform:[]};r=e}}if(i instanceof Crt){if(i.parent instanceof _rt&&!r.source){r.format=Object.assign(Object.assign({},(u=r.format)!==null&&u!==void 0?u:{}),{parse:i.assembleFormatParse()});r.transform.push(...i.assembleTransforms(true))}else{r.transform.push(...i.assembleTransforms())}}if(i instanceof Frt){if(!r.name){r.name=`data_${e++}`}if(!r.source||r.transform.length>0){t.push(r);i.data=r.name}else{i.data=r.source}t.push(...i.assemble());return}if(i instanceof Brt||i instanceof Srt||i instanceof $ot||i instanceof Ant||i instanceof Qnt||i instanceof Bot||i instanceof Ort||i instanceof zot||i instanceof iut||i instanceof Krt||i instanceof Cot||i instanceof jot||i instanceof Eot||i instanceof Not||i instanceof Pot||i instanceof Iot||i instanceof Mrt||i instanceof qot||i instanceof Rot){r.transform.push(i.assemble())}if(i instanceof wrt||i instanceof Htt||i instanceof Sot||i instanceof nut||i instanceof Mot){r.transform.push(...i.assemble())}if(i instanceof Wtt){if(r.source&&r.transform.length===0){i.setSource(r.source)}else if(i.parent instanceof Wtt){i.setSource(r.name)}else{if(!r.name){r.name=`data_${e++}`}i.setSource(r.name);if(i.numChildren()===1){t.push(r);const e={name:null,source:r.name,transform:[]};r=e}}}switch(i.numChildren()){case 0:if(i instanceof Wtt&&(!r.source||r.transform.length>0)){t.push(r)}break;case 1:n(i.children[0],r);break;default:{if(!r.name){r.name=`data_${e++}`}let u=r.name;if(!r.source||r.transform.length>0){t.push(r)}else{u=r.source}for(const t of i.children){const e={name:null,source:u,transform:[]};n(t,e)}break}}}return n}function Wot(t){const e=[];const n=Uot(e);for(const i of t.children){n(i,{source:t.name,name:null,transform:[]})}return e}function Got(t,e){var n,i;const r=[];const u=Uot(r);let o=0;for(const a of t.sources){if(!a.hasName()){a.dataName=`source_${o++}`}const t=a.assemble();u(a,t)}for(const a of r){if(a.transform.length===0){delete a.transform}}let s=0;for(const[a,f]of r.entries()){if(((n=f.transform)!==null&&n!==void 0?n:[]).length===0&&!f.source){r.splice(s++,0,r.splice(a,1)[0])}}for(const a of r){for(const e of(i=a.transform)!==null&&i!==void 0?i:[]){if(e.type==="lookup"){e.from=t.outputNodes[e.from].getSource()}}}for(const a of r){if(a.name in e){a.values=e[a.name]}}return r}function Hot(t){if(t==="top"||t==="left"||f1(t)){return"header"}return"footer"}function Vot(t){for(const e of i0){Yot(t,e)}Jot(t,"x");Jot(t,"y")}function Yot(t,e){var n;const{facet:i,config:r,child:u,component:o}=t;if(t.channelHasField(e)){const s=i[e];const a=tit("title",null,r,e);let f=M8(s,r,{allowDisabling:true,includeDefault:a===undefined||!!a});if(u.component.layoutHeaders[e].title){f=ve(f)?f.join(", "):f;f+=` / ${u.component.layoutHeaders[e].title}`;u.component.layoutHeaders[e].title=null}const c=tit("labelOrient",s.header,r,e);const l=s.header!==null?nK((n=s.header)===null||n===void 0?void 0:n.labels,r.header.labels,true):false;const d=jZ(["bottom","right"],c)?"footer":"header";o.layoutHeaders[e]={title:s.header!==null?f:null,facetFieldDef:s,[d]:e==="facet"?[]:[Xot(t,e,l)]}}}function Xot(t,e,n){const i=e==="row"?"height":"width";return{labels:n,sizeSignal:t.child.component.layoutSize.get(i)?t.child.getSizeSignalRef(i):undefined,axes:[]}}function Jot(t,e){var n;const{child:i}=t;if(i.component.axes[e]){const{layoutHeaders:r,resolve:u}=t.component;u.axis[e]=xit(u,e);if(u.axis[e]==="shared"){const u=e==="x"?"column":"row";const o=r[u];for(const r of i.component.axes[e]){const e=Hot(r.get("orient"));(n=o[e])!==null&&n!==void 0?n:o[e]=[Xot(t,u,false)];const i=Cnt(r,"main",t.config,{header:true});if(i){o[e][0].axes.push(i)}r.mainExtracted=true}}}}function Qot(t){Kot(t);tst(t,"width");tst(t,"height")}function Zot(t){Kot(t);const e=t.layout.columns===1?"width":"childWidth";const n=t.layout.columns===undefined?"height":"childHeight";tst(t,e);tst(t,n)}function Kot(t){for(const e of t.children){e.parseLayoutSize()}}function tst(t,e){var n;const i=yit(e);const r=E0(i);const u=t.component.resolve;const o=t.component.layoutSize;let s;for(const a of t.children){const e=a.component.layoutSize.getWithExplicit(i);const o=(n=u.scale[r])!==null&&n!==void 0?n:Ait(r,t);if(o==="independent"&&e.value==="step"){s=undefined;break}if(s){if(o==="independent"&&s.value!==e.value){s=undefined;break}s=Ott(s,e,i,"")}else{s=e}}if(s){for(const n of t.children){t.renameSignal(n.getName(i),t.getName(e));n.component.layoutSize.set(i,"merged",false)}o.setWithExplicit(e,s)}else{o.setWithExplicit(e,{explicit:false,value:undefined})}}function est(t){const{size:e,component:n}=t;for(const i of O0){const r=m0(i);if(e[r]){const t=e[r];n.layoutSize.set(r,F4(t)?"step":t,true)}else{const e=nst(t,r);n.layoutSize.set(r,e,false)}}}function nst(t,e){const n=e==="width"?"x":"y";const i=t.config;const r=t.getScaleComponent(n);if(r){const t=r.get("type");const n=r.get("range");if(w5(t)){const t=S4(i.view,e);if(c1(n)||F4(t)){return"step"}else{return t}}else{return M4(i.view,e)}}else if(t.hasProjection||t.mark==="arc"){return M4(i.view,e)}else{const t=S4(i.view,e);return F4(t)?t.step:t}}function ist(t,e,n){return A8(e,Object.assign({suffix:`by_${A8(t)}`},n!==null&&n!==void 0?n:{}))}class rst extends Dot{constructor(t,e,n,i){super(t,"facet",e,n,i,t.resolve);this.child=aat(t.spec,this,this.getName("child"),undefined,i);this.children=[this.child];this.facet=this.initFacet(t.facet)}initFacet(t){if(!H6(t)){return{facet:this.initFacetFieldDef(t,"facet")}}const e=RZ(t);const n={};for(const i of e){if(![lK,dK].includes(i)){c3(w2(i,"facet"));break}const e=t[i];if(e.field===undefined){c3(v2(e,i));break}n[i]=this.initFacetFieldDef(e,i)}return n}initFacetFieldDef(t,e){const n=R8(t,e);if(n.header){n.header=u1(n.header)}else if(n.header===null){n.header=null}return n}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=fst(this);this.child.parseData()}parseLayoutSize(){Kot(this)}parseSelections(){this.child.parseSelections();this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders();Vot(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){this.child.assembleSignals();return[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var t,e,n;const i={};for(const r of i0){for(const u of iit){const o=this.component.layoutHeaders[r];const s=o[u];const{facetFieldDef:a}=o;if(a){const e=tit("titleOrient",a.header,this.config,r);if(["right","bottom"].includes(e)){const n=Knt(r,e);(t=i.titleAnchor)!==null&&t!==void 0?t:i.titleAnchor={};i.titleAnchor[n]="end"}}if(s===null||s===void 0?void 0:s[0]){const t=r==="row"?"height":"width";const s=u==="header"?"headerBand":"footerBand";if(r!=="facet"&&!this.child.component.layoutSize.get(t)){(e=i[s])!==null&&e!==void 0?e:i[s]={};i[s][r]=.5}if(o.title){(n=i.offset)!==null&&n!==void 0?n:i.offset={};i.offset[r==="row"?"rowTitle":"columnTitle"]=10}}}}return i}assembleDefaultLayout(){const{column:t,row:e}=this.facet;const n=t?this.columnDistinctSignal():e?1:undefined;let i="all";if(!e&&this.component.resolve.scale.x==="independent"){i="none"}else if(!t&&this.component.resolve.scale.y==="independent"){i="none"}return Object.assign(Object.assign(Object.assign({},this.getHeaderLayoutMixins()),n?{columns:n}:{}),{bounds:"full",align:i})}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(this.parent&&this.parent instanceof rst){return undefined}else{const t=this.getName("column_domain");return{signal:`length(data('${t}'))`}}}assembleGroupStyle(){return undefined}assembleGroup(t){if(this.parent&&this.parent instanceof rst){return Object.assign(Object.assign({},this.channelHasField("column")?{encode:{update:{columns:{field:A8(this.facet.column,{prefix:"distinct"})}}}}:{}),super.assembleGroup(t))}return super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[];const e=[];const n=[];if(this.child instanceof rst){if(this.child.channelHasField("column")){const i=A8(this.child.facet.column);t.push(i);e.push("distinct");n.push(`distinct_${i}`)}}else{for(const i of O0){const r=this.child.component.scales[i];if(r&&!r.merged){const u=r.get("type");const o=r.get("range");if(w5(u)&&c1(o)){const r=Cut(this.child,i);const u=jut(r);if(u){t.push(u);e.push("distinct");n.push(`distinct_${u}`)}else{c3(R1(i))}}}}}return{fields:t,ops:e,as:n}}assembleFacet(){const{name:t,data:e}=this.component.data.facetRoot;const{row:n,column:i}=this.facet;const{fields:r,ops:u,as:o}=this.getCardinalityAggregateForChild();const s=[];for(const f of i0){const t=this.facet[f];if(t){s.push(A8(t));const{bin:e,sort:a}=t;if(K0(e)){s.push(A8(t,{binSuffix:"end"}))}if(W6(a)){const{field:e,op:s=I6}=a;const f=ist(t,a);if(n&&i){r.push(f);u.push("max");o.push(f)}else{r.push(e);u.push(s);o.push(f)}}else if(ve(a)){const e=Znt(t,f);r.push(e);u.push("max");o.push(e)}}}const a=!!n&&!!i;return Object.assign({name:t,data:e,groupby:s},a||r.length>0?{aggregate:Object.assign(Object.assign({},a?{cross:a}:{}),r.length?{fields:r,ops:u,as:o}:{})}:{})}facetSortFields(t){const{facet:e}=this;const n=e[t];if(n){if(W6(n.sort)){return[ist(n,n.sort,{expr:"datum"})]}else if(ve(n.sort)){return[Znt(n,t,{expr:"datum"})]}return[A8(n,{expr:"datum"})]}return[]}facetSortOrder(t){const{facet:e}=this;const n=e[t];if(n){const{sort:t}=n;const e=(W6(t)?t.order:!ve(t)&&t)||"ascending";return[e]}return[]}assembleLabelTitle(){var t;const{facet:e,config:n}=this;if(e.facet){return fit(e.facet,"facet",n)}const i={row:["top","bottom"],column:["left","right"]};for(const r of nit){if(e[r]){const u=tit("labelOrient",(t=e[r])===null||t===void 0?void 0:t.header,n,r);if(i[r].includes(u)){return fit(e[r],r,n)}}}return undefined}assembleMarks(){const{child:t}=this;const e=this.component.data.facetRoot;const n=Wot(e);const i=t.assembleGroupEncodeEntry(false);const r=this.assembleLabelTitle()||t.assembleTitle();const u=t.assembleGroupStyle();const o=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:this.getName("cell"),type:"group"},r?{title:r}:{}),u?{style:u}:{}),{from:{facet:this.assembleFacet()},sort:{field:i0.map((t=>this.facetSortFields(t))).flat(),order:i0.map((t=>this.facetSortOrder(t))).flat()}}),n.length>0?{data:n}:{}),i?{encode:{update:i}}:{}),t.assembleGroup(ztt(this,[])));return[o]}getMapping(){return this.facet}}function ust(t,e){const{row:n,column:i}=e;if(n&&i){let e=null;for(const r of[n,i]){if(W6(r.sort)){const{field:n,op:i=I6}=r.sort;t=e=new Krt(t,{joinaggregate:[{op:i,field:n,as:ist(r,r.sort,{forAs:true})}],groupby:[A8(r)]})}}return e}return null}function ost(t,e){var n,i,r,u;for(const o of e){const e=o.data;if(t.name&&o.hasName()&&t.name!==o.dataName){continue}const s=(n=t["format"])===null||n===void 0?void 0:n.mesh;const a=(i=e.format)===null||i===void 0?void 0:i.feature;if(s&&a){continue}const f=(r=t["format"])===null||r===void 0?void 0:r.feature;if((f||a)&&f!==a){continue}const c=(u=e.format)===null||u===void 0?void 0:u.mesh;if((s||c)&&s!==c){continue}if(ktt(t)&&ktt(e)){if(AZ(t.values,e.values)){return o}}else if(Dtt(t)&&Dtt(e)){if(t.url===e.url){return o}}else if(Ett(t)){if(t.name===o.dataName){return o}}}return null}function sst(t,e){if(t.data||!t.parent){if(t.data===null){const t=new _rt({values:[]});e.push(t);return t}const n=ost(t.data,e);if(n){if(!$tt(t.data)){n.data.format=BZ({},t.data.format,n.data.format)}if(!n.hasName()&&t.data.name){n.dataName=t.data.name}return n}else{const n=new _rt(t.data);e.push(n);return n}}else{return t.parent.component.data.facetRoot?t.parent.component.data.facetRoot:t.parent.component.data.main}}function ast(t,e,n){var i,r;let u=0;for(const o of e.transforms){let s=undefined;let a;if(G7(o)){a=t=new Qnt(t,o);s="derived"}else if(M7(o)){const r=Ert(o);a=t=(i=Crt.makeWithAncestors(t,{},r,n))!==null&&i!==void 0?i:t;t=new Ant(t,e,o.filter)}else if(H7(o)){a=t=wrt.makeFromTransform(t,o,e);s="number"}else if(Y7(o)){s="date";const e=n.getWithExplicit(o.field);if(e.value===undefined){t=new Crt(t,{[o.field]:s});n.set(o.field,s,false)}a=t=Htt.makeFromTransform(t,o)}else if(X7(o)){a=t=Ort.makeFromTransform(t,o);s="number";if(gnt(e)){t=new Mrt(t)}}else if(S7(o)){a=t=zot.make(t,e,o,u++);s="derived"}else if(q7(o)){a=t=new iut(t,o);s="number"}else if(U7(o)){a=t=new Krt(t,o);s="number"}else if(J7(o)){a=t=nut.makeFromTransform(t,o);s="derived"}else if(Q7(o)){a=t=new Cot(t,o);s="derived"}else if(W7(o)){a=t=new jot(t,o);s="derived"}else if(z7(o)){a=t=new Rot(t,o);s="derived"}else if(R7(o)){t=new qot(t,o)}else if(V7(o)){a=t=Sot.makeFromTransform(t,o);s="derived"}else if(T7(o)){a=t=new Eot(t,o);s="derived"}else if(P7(o)){a=t=new Pot(t,o);s="derived"}else if(L7(o)){a=t=new Iot(t,o);s="derived"}else if(I7(o)){a=t=new Not(t,o);s="derived"}else{c3(u2(o));continue}if(a&&s!==undefined){for(const t of(r=a.producedFields())!==null&&r!==void 0?r:[]){n.set(t,s,false)}}}return t}function fst(t){var e,n,i,r,u,o,s,a,f,c;let l=sst(t,t.component.data.sources);const{outputNodes:d,outputNodeRefCounts:h}=t.component.data;const p=t.data;const m=p&&($tt(p)||Dtt(p)||ktt(p));const g=!m&&t.parent?t.parent.component.data.ancestorParse.clone():new Ftt;if($tt(p)){if(jtt(p)){l=new Srt(l,p.sequence)}else if(Mtt(p)){l=new Brt(l,p.graticule)}g.parseNothing=true}else if(((e=p===null||p===void 0?void 0:p.format)===null||e===void 0?void 0:e.parse)===null){g.parseNothing=true}l=(n=Crt.makeExplicit(l,t,g))!==null&&n!==void 0?n:l;l=new Mrt(l);const b=t.parent&&Oot(t.parent);if(wot(t)||Aot(t)){if(b){l=(i=wrt.makeFromEncoding(l,t))!==null&&i!==void 0?i:l}}if(t.transforms.length>0){l=ast(l,t,g)}const v=jrt(t);const y=$rt(t);l=(r=Crt.makeWithAncestors(l,{},Object.assign(Object.assign({},v),y),g))!==null&&r!==void 0?r:l;if(wot(t)){l=Mot.parseAll(l,t);l=Bot.parseAll(l,t)}if(wot(t)||Aot(t)){if(!b){l=(u=wrt.makeFromEncoding(l,t))!==null&&u!==void 0?u:l}l=(o=Htt.makeFromEncoding(l,t))!==null&&o!==void 0?o:l;l=Qnt.parseAllForSortIndex(l,t)}const w=t.getDataName(Btt.Raw);const A=new Wtt(l,w,Btt.Raw,h);d[w]=A;l=A;if(wot(t)){const e=Ort.makeFromEncoding(l,t);if(e){l=e;if(gnt(t)){l=new Mrt(l)}}l=(s=Sot.makeFromEncoding(l,t))!==null&&s!==void 0?s:l;l=(a=nut.makeFromEncoding(l,t))!==null&&a!==void 0?a:l}if(wot(t)){l=(f=$ot.make(l,t))!==null&&f!==void 0?f:l}const x=t.getDataName(Btt.Main);const O=new Wtt(l,x,Btt.Main,h);d[x]=O;l=O;if(wot(t)){Dnt(t,O)}let F=null;if(Aot(t)){const e=t.getName("facet");l=(c=ust(l,t.facet))!==null&&c!==void 0?c:l;F=new Frt(l,t,e,O.getSource());d[e]=F}return Object.assign(Object.assign({},t.component.data),{outputNodes:d,outputNodeRefCounts:h,raw:A,main:O,facetRoot:F,ancestorParse:g})}class cst extends Fot{constructor(t,e,n,i){var r,u,o,s;super(t,"concat",e,n,i,t.resolve);if(((u=(r=t.resolve)===null||r===void 0?void 0:r.axis)===null||u===void 0?void 0:u.x)==="shared"||((s=(o=t.resolve)===null||o===void 0?void 0:o.axis)===null||s===void 0?void 0:s.y)==="shared"){c3(e2)}this.children=this.getChildren(t).map(((t,e)=>aat(t,this,this.getName(`concat_${e}`),undefined,i)))}parseData(){this.component.data=fst(this);for(const t of this.children){t.parseData()}}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of RZ(t.component.selection)){this.component.selection[e]=t.component.selection[e]}}}parseMarkGroup(){for(const t of this.children){t.parseMarkGroup()}}parseAxesAndHeaders(){for(const t of this.children){t.parseAxesAndHeaders()}}getChildren(t){if(A4(t)){return t.vconcat}else if(x4(t)){return t.hconcat}return t.concat}parseLayoutSize(){Zot(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){this.children.forEach((t=>t.assembleSignals()));return[]}assembleLayoutSignals(){const t=mit(this);for(const e of this.children){t.push(...e.assembleLayoutSignals())}return t}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleMarks(){return this.children.map((t=>{const e=t.assembleTitle();const n=t.assembleGroupStyle();const i=t.assembleGroupEncodeEntry(false);return Object.assign(Object.assign(Object.assign(Object.assign({type:"group",name:t.getName("group")},e?{title:e}:{}),n?{style:n}:{}),i?{encode:{update:i}}:{}),t.assembleGroup())}))}assembleGroupStyle(){return undefined}assembleDefaultLayout(){const t=this.layout.columns;return Object.assign(Object.assign({},t!=null?{columns:t}:{}),{bounds:"full",align:"each"})}}function lst(t){return t===false||t===null}const dst=Object.assign(Object.assign({disable:1,gridScale:1,scale:1},t9),{labelExpr:1,encode:1});const hst=RZ(dst);class pst extends vtt{constructor(t={},e={},n=false){super();this.explicit=t;this.implicit=e;this.mainExtracted=n}clone(){return new pst(xZ(this.explicit),xZ(this.implicit),this.mainExtracted)}hasAxisPart(t){if(t==="axis"){return true}if(t==="grid"||t==="title"){return!!this.get(t)}return!lst(this.get(t))}hasOrientSignalRef(){return f1(this.explicit.orient)}}function mst(t,e,n){var i;const{encoding:r,config:u}=t;const o=(i=T8(r[e]))!==null&&i!==void 0?i:T8(r[p0(e)]);const s=t.axis(e)||{};const{format:a,formatType:f}=s;if(k6(f)){return Object.assign({text:M6({fieldOrDatumDef:o,field:"datum.value",format:a,formatType:f,config:u})},n)}return n}function gst(t){return O0.reduce(((e,n)=>{if(t.component.scales[n]){e[n]=[Ost(n,t)]}return e}),{})}const bst={bottom:"top",top:"bottom",left:"right",right:"left"};function vst(t){var e;const{axes:n,resolve:i}=t.component;const r={top:0,bottom:0,right:0,left:0};for(const u of t.children){u.parseAxesAndHeaders();for(const e of RZ(u.component.axes)){i.axis[e]=xit(t.component.resolve,e);if(i.axis[e]==="shared"){n[e]=yst(n[e],u.component.axes[e]);if(!n[e]){i.axis[e]="independent";delete n[e]}}}}for(const u of O0){for(const o of t.children){if(!o.component.axes[u]){continue}if(i.axis[u]==="independent"){n[u]=((e=n[u])!==null&&e!==void 0?e:[]).concat(o.component.axes[u]);for(const t of o.component.axes[u]){const{value:e,explicit:n}=t.getWithExplicit("orient");if(f1(e)){continue}if(r[e]>0&&!n){const n=bst[e];if(r[e]>r[n]){t.set("orient",n,false)}}r[e]++}}delete o.component.axes[u]}if(i.axis[u]==="independent"&&n[u]&&n[u].length>1){for(const t of n[u]){if(!!t.get("grid")&&!t.explicit.grid){t.implicit.grid=false}}}}}function yst(t,e){if(t){if(t.length!==e.length){return undefined}const n=t.length;for(let i=0;i<n;i++){const n=t[i];const r=e[i];if(!!n!==!!r){return undefined}else if(n&&r){const e=n.getWithExplicit("orient");const u=r.getWithExplicit("orient");if(e.explicit&&u.explicit&&e.value!==u.value){return undefined}else{t[i]=wst(n,r)}}}}else{return e.map((t=>t.clone()))}return t}function wst(t,e){for(const n of hst){const i=Ott(t.getWithExplicit(n),e.getWithExplicit(n),n,"axis",((t,e)=>{switch(n){case"title":return N1(t,e);case"gridScale":return{explicit:t.explicit,value:nK(t.value,e.value)}}return xtt(t,e,n,"axis")}));t.setWithExplicit(n,i)}return t}function Ast(t,e,n,i,r){if(e==="disable"){return n!==undefined}n=n||{};switch(e){case"titleAngle":case"labelAngle":return t===(f1(n.labelAngle)?n.labelAngle:aK(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(t===Ynt(i,r)){return true}}return t===n[e]}const xst=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function Ost(t,e){var n,i,r;let u=e.axis(t);const o=new pst;const s=T8(e.encoding[t]);const{mark:a,config:f}=e;const c=(u===null||u===void 0?void 0:u.orient)||((n=f[t==="x"?"axisX":"axisY"])===null||n===void 0?void 0:n.orient)||((i=f.axis)===null||i===void 0?void 0:i.orient)||Hnt(t);const l=e.getScaleComponent(t).get("type");const d=_nt(t,l,c,e.config);const h=u!==undefined?!u:znt("disable",f.style,u===null||u===void 0?void 0:u.style,d).configValue;o.set("disable",h,u!==undefined);if(h){return o}u=u||{};const p=Int(s,u,t,f.style,d);const m={fieldOrDatumDef:s,axis:u,channel:t,model:e,scaleType:l,orient:c,labelAngle:p,mark:a,config:f};for(const v of hst){const n=v in Tnt?Tnt[v](m):n9(v)?u[v]:undefined;const i=n!==undefined;const r=Ast(n,v,u,e,t);if(i&&r){o.set(v,n,r)}else{const{configValue:t=undefined,configFrom:e=undefined}=n9(v)&&v!=="values"?znt(v,f.style,u.style,d):{};const s=t!==undefined;if(i&&!s){o.set(v,n,r)}else if(!(e==="vgAxisConfig")||xst.has(v)&&s||Q8(t)||f1(t)){o.set(v,t,false)}}}const g=(r=u.encoding)!==null&&r!==void 0?r:{};const b=Z8.reduce(((n,i)=>{var r;if(!o.hasAxisPart(i)){return n}const u=wit((r=g[i])!==null&&r!==void 0?r:{},e);const s=i==="labels"?mst(e,t,u):u;if(s!==undefined&&!IZ(s)){n[i]={update:s}}return n}),{});if(!IZ(b)){o.set("encode",b,!!u.encoding||u.labelAngle!==undefined)}return o}function Fst({encoding:t,size:e}){for(const n of O0){const i=m0(n);if(F4(e[i])){if(c8(t[n])){delete e[i];c3(L2(i))}}}return e}function Dst(t,e,n){const i=u1(t);const r=$1("orient",i,n);i.orient=jst(i.type,e,r);if(r!==undefined&&r!==i.orient){c3(j2(i.orient,r))}if(i.type==="bar"&&i.orient){const t=$1("cornerRadiusEnd",i,n);if(t!==undefined){const n=i.orient==="horizontal"&&e.x2||i.orient==="vertical"&&e.y2?["cornerRadius"]:l6[i.orient];for(const e of n){i[e]=t}if(i.cornerRadiusEnd!==undefined){delete i.cornerRadiusEnd}}}const u=$1("opacity",i,n);if(u===undefined){i.opacity=Est(i.type,e)}const o=$1("cursor",i,n);if(o===undefined){i.cursor=kst(i,e,n)}return i}function kst(t,e,n){if(e.href||t.href||$1("href",t,n)){return"pointer"}return t.cursor}function Est(t,e){if(jZ([q5,H5,Y5,X5],t)){if(!l9(e)){return.7}}return undefined}function $st(t,e,{graticule:n}){if(n){return false}const i=j1("filled",t,e);const r=t.type;return nK(i,r!==q5&&r!==R5&&r!==W5)}function jst(t,e,n){switch(t){case q5:case Y5:case X5:case G5:case U5:case I5:return undefined}const{x:i,y:r,x2:u,y2:o}=e;switch(t){case L5:if(s8(i)&&(t1(i.bin)||s8(r)&&r.aggregate&&!i.aggregate)){return"vertical"}if(s8(r)&&(t1(r.bin)||s8(i)&&i.aggregate&&!r.aggregate)){return"horizontal"}if(o||u){if(n){return n}if(!u){if(s8(i)&&i.type===n5&&!K0(i.bin)||l8(i)){return"horizontal"}}if(!o){if(s8(r)&&r.type===n5&&!K0(r.bin)||l8(r)){return"vertical"}}}case W5:if(u&&!(s8(i)&&t1(i.bin))&&o&&!(s8(r)&&t1(r.bin))){return undefined}case P5:if(o){if(s8(r)&&t1(r.bin)){return"horizontal"}else{return"vertical"}}else if(u){if(s8(i)&&t1(i.bin)){return"vertical"}else{return"horizontal"}}else if(t===W5){if(i&&!r){return"vertical"}else if(r&&!i){return"horizontal"}}case R5:case H5:{const e=c8(i);const u=c8(r);if(n){return n}else if(e&&!u){return t!=="tick"?"horizontal":"vertical"}else if(!e&&u){return t!=="tick"?"vertical":"horizontal"}else if(e&&u){const e=i;const n=r;const u=e.type===r5;const o=n.type===r5;if(u&&!o){return t!=="tick"?"vertical":"horizontal"}else if(!u&&o){return t!=="tick"?"horizontal":"vertical"}if(!e.aggregate&&n.aggregate){return t!=="tick"?"vertical":"horizontal"}else if(e.aggregate&&!n.aggregate){return t!=="tick"?"horizontal":"vertical"}return"vertical"}else{return undefined}}}return"vertical"}const Cst={vgMark:"arc",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Aet("x",t,{defaultPos:"mid"})),Aet("y",t,{defaultPos:"mid"})),Bet(t,"radius")),Bet(t,"theta"))};const Mst={vgMark:"area",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"})),Eet("x",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="horizontal"})),Eet("y",t,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:t.markDef.orient==="vertical"})),Wet(t))};const Bst={vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Bet(t,"x")),Bet(t,"y"))};const Sst={vgMark:"shape",encodeEntry:t=>Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),postEncodingTransform:t=>{const{encoding:e}=t;const n=e.shape;const i=Object.assign({type:"geoshape",projection:t.projectionName()},n&&s8(n)&&n.type===o5?{field:A8(n,{expr:"datum"})}:{});return[i]}};const _st={vgMark:"image",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"})),Bet(t,"x")),Bet(t,"y")),aet(t,"url"))};const Nst={vgMark:"line",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})),Aet("x",t,{defaultPos:"mid"})),Aet("y",t,{defaultPos:"mid"})),bet("size",t,{vgChannel:"strokeWidth"})),Wet(t))};const zst={vgMark:"trail",encodeEntry:t=>Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Aet("x",t,{defaultPos:"mid"})),Aet("y",t,{defaultPos:"mid"})),bet("size",t)),Wet(t))};function Tst(t,e){const{config:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"})),Aet("x",t,{defaultPos:"mid"})),Aet("y",t,{defaultPos:"mid"})),bet("size",t)),bet("angle",t)),Pst(t,n,e))}function Pst(t,e,n){if(n){return{shape:{value:n}}}return bet("shape",t)}const Lst={vgMark:"symbol",encodeEntry:t=>Tst(t)};const Ist={vgMark:"symbol",encodeEntry:t=>Tst(t,"circle")};const Rst={vgMark:"symbol",encodeEntry:t=>Tst(t,"square")};const qst={vgMark:"rect",encodeEntry:t=>Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Bet(t,"x")),Bet(t,"y"))};const Ust={vgMark:"rule",encodeEntry:t=>{const{markDef:e}=t;const n=e.orient;if(!t.encoding.x&&!t.encoding.y&&!t.encoding.latitude&&!t.encoding.longitude){return{}}return Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Eet("x",t,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"})),Eet("y",t,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"})),bet("size",t,{vgChannel:"strokeWidth"}))}};const Wst={vgMark:"text",encodeEntry:t=>{const{config:e,encoding:n}=t;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"})),Aet("x",t,{defaultPos:"mid"})),Aet("y",t,{defaultPos:"mid"})),aet(t)),bet("size",t,{vgChannel:"fontSize"})),bet("angle",t)),Het("align",Gst(t.markDef,n,e))),Het("baseline",Hst(t.markDef,n,e))),Aet("radius",t,{defaultPos:null})),Aet("theta",t,{defaultPos:null}))}};function Gst(t,e,n){const i=$1("align",t,n);if(i===undefined){return"center"}return undefined}function Hst(t,e,n){const i=$1("baseline",t,n);if(i===undefined){return"middle"}return undefined}const Vst={vgMark:"rect",encodeEntry:t=>{const{config:e,markDef:n}=t;const i=n.orient;const r=i==="horizontal"?"width":"height";const u=i==="horizontal"?"height":"width";return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},Iet(t,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"})),Aet("x",t,{defaultPos:"mid",vgChannel:"xc"})),Aet("y",t,{defaultPos:"mid",vgChannel:"yc"})),bet("size",t,{defaultValue:Yst(t),vgChannel:r})),{[u]:x1($1("thickness",n,e))})}};function Yst(t){var e;const{config:n,markDef:i}=t;const{orient:r}=i;const u=r==="horizontal"?"width":"height";const o=t.getScaleComponent(r==="horizontal"?"x":"y");const s=(e=$1("size",i,n,{vgChannel:u}))!==null&&e!==void 0?e:n.tick.bandSize;if(s!==undefined){return s}else{const t=o?o.get("range"):undefined;if(t&&c1(t)&&pn(t.step)){return t.step*3/4}const e=B4(n.view,u);return e*3/4}}const Xst={arc:Cst,area:Mst,bar:Bst,circle:Ist,geoshape:Sst,image:_st,line:Nst,point:Lst,rect:qst,rule:Ust,square:Rst,text:Wst,tick:Vst,trail:zst};function Jst(t){if(jZ([R5,P5,V5],t.mark)){const e=y9(t.mark,t.encoding);if(e.length>0){return Zst(t,e)}}else if(t.mark===L5){const e=b1.some((e=>$1(e,t.markDef,t.config)));if(t.stack&&!t.fieldDef("size")&&e){return tat(t)}}return nat(t)}const Qst="faceted_path_";function Zst(t,e){return[{name:t.getName("pathgroup"),type:"group",from:{facet:{name:Qst+t.requestDataName(Btt.Main),data:t.requestDataName(Btt.Main),groupby:e}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:nat(t,{fromPrefix:Qst})}]}const Kst="stack_group_";function tat(t){var e;const[n]=nat(t,{fromPrefix:Kst});const i=t.scaleName(t.stack.fieldChannel);const r=(e={})=>t.vgField(t.stack.fieldChannel,e);const u=(t,e)=>{const n=[r({prefix:"min",suffix:"start",expr:e}),r({prefix:"max",suffix:"start",expr:e}),r({prefix:"min",suffix:"end",expr:e}),r({prefix:"max",suffix:"end",expr:e})];return`${t}(${n.map((t=>`scale('${i}',${t})`)).join(",")})`};let o;let s;if(t.stack.fieldChannel==="x"){o=Object.assign(Object.assign({},FZ(n.encode.update,["y","yc","y2","height",...b1])),{x:{signal:u("min","datum")},x2:{signal:u("max","datum")},clip:{value:true}});s={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}};n.encode.update=Object.assign(Object.assign({},DZ(n.encode.update,["y","yc","y2"])),{height:{field:{group:"height"}}})}else{o=Object.assign(Object.assign({},FZ(n.encode.update,["x","xc","x2","width"])),{y:{signal:u("min","datum")},y2:{signal:u("max","datum")},clip:{value:true}});s={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}};n.encode.update=Object.assign(Object.assign({},DZ(n.encode.update,["x","xc","x2"])),{width:{field:{group:"width"}}})}for(const c of b1){const e=j1(c,t.markDef,t.config);if(n.encode.update[c]){o[c]=n.encode.update[c];delete n.encode.update[c]}else if(e){o[c]=x1(e)}if(e){n.encode.update[c]={value:0}}}const a=[];if(((e=t.stack.groupbyChannels)===null||e===void 0?void 0:e.length)>0){for(const e of t.stack.groupbyChannels){const n=t.fieldDef(e);const i=A8(n);if(i){a.push(i)}if((n===null||n===void 0?void 0:n.bin)||(n===null||n===void 0?void 0:n.timeUnit)){a.push(A8(n,{binSuffix:"end"}))}}}const f=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"];o=f.reduce(((e,i)=>{if(n.encode.update[i]){return Object.assign(Object.assign({},e),{[i]:n.encode.update[i]})}else{const n=j1(i,t.markDef,t.config);if(n!==undefined){return Object.assign(Object.assign({},e),{[i]:x1(n)})}else{return e}}}),o);if(o.stroke){o.strokeForeground={value:true};o.strokeOffset={value:0}}return[{type:"group",from:{facet:{data:t.requestDataName(Btt.Main),name:Kst+t.requestDataName(Btt.Main),groupby:a,aggregate:{fields:[r({suffix:"start"}),r({suffix:"start"}),r({suffix:"end"}),r({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:o},marks:[{type:"group",encode:{update:s},marks:[n]}]}]}function eat(t){var e;const{encoding:n,stack:i,mark:r,markDef:u,config:o}=t;const s=n.order;if(!ve(s)&&p8(s)&&$Z(s.value)||!s&&$Z($1("order",u,o))){return undefined}else if((ve(s)||s8(s))&&!i){return B1(s,{expr:"datum"})}else if(Q5(r)){const i=u.orient==="horizontal"?"y":"x";const r=n[i];if(s8(r)){const n=r.sort;if(ve(n)){return{field:A8(r,{prefix:i,suffix:"sort_index",expr:"datum"})}}else if(W6(n)){return{field:A8({aggregate:l9(t.encoding)?n.op:undefined,field:n.field},{expr:"datum"})}}else if(U6(n)){const e=t.fieldDef(n.encoding);return{field:A8(e,{expr:"datum"}),order:n.order}}else if(n===null){return undefined}else{return{field:A8(r,{binSuffix:((e=t.stack)===null||e===void 0?void 0:e.impute)?"mid":undefined,expr:"datum"})}}}return undefined}return undefined}function nat(t,e={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:u}=t;const o=nK(i.clip,iat(t),rat(t));const s=E1(i);const a=r.key;const f=eat(t);const c=uat(t);const l=$1("aria",i,u);const d=Xst[n].postEncodingTransform?Xst[n].postEncodingTransform(t):null;return[Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({name:t.getName("marks"),type:Xst[n].vgMark},o?{clip:true}:{}),s?{style:s}:{}),a?{key:a.field}:{}),f?{sort:f}:{}),c?c:{}),l===false?{aria:l}:{}),{from:{data:e.fromPrefix+t.requestDataName(Btt.Main)},encode:{update:Xst[n].encodeEntry(t)}}),d?{transform:d}:{})]}function iat(t){const e=t.getScaleComponent("x");const n=t.getScaleComponent("y");return(e===null||e===void 0?void 0:e.get("selectionExtent"))||(n===null||n===void 0?void 0:n.get("selectionExtent"))?true:undefined}function rat(t){const e=t.component.projection;return e&&!e.isFit?true:undefined}function uat(t){if(!t.component.selection)return null;const e=RZ(t.component.selection).length;let n=e;let i=t.parent;while(i&&n===0){n=RZ(i.component.selection).length;i=i.parent}return n?{interactive:e>0||!!t.encoding.tooltip}:null}class oat extends Dot{constructor(t,e,n,i={},r){var u;super(t,"unit",e,n,r,undefined,D4(t)?t.view:undefined);this.specifiedScales={};this.specifiedAxes={};this.specifiedLegends={};this.specifiedProjection={};this.selection=[];this.children=[];const o=t6(t.mark)?Object.assign({},t.mark):{type:t.mark};const s=o.type;if(o.filled===undefined){o.filled=$st(o,r,{graticule:t.data&&Mtt(t.data)})}const a=this.encoding=p9(t.encoding||{},s,o.filled,r);this.markDef=Dst(o,a,r);this.size=Fst({encoding:a,size:D4(t)?Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{}):i});this.stack=l7(s,a);this.specifiedScales=this.initScales(s,a);this.specifiedAxes=this.initAxes(a);this.specifiedLegends=this.initLegends(a);this.specifiedProjection=t.projection;this.selection=((u=t.params)!==null&&u!==void 0?u:[]).filter((t=>g4(t)))}get hasProjection(){const{encoding:t}=this;const e=this.mark===J5;const n=t&&KK.some((e=>d8(t[e])));return e||n}scaleDomain(t){const e=this.specifiedScales[t];return e?e.domain:undefined}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,e){return N0.reduce(((t,n)=>{var i;const r=T8(e[n]);if(r){t[n]=this.initScale((i=r.scale)!==null&&i!==void 0?i:{})}return t}),{})}initScale(t){const{domain:e,range:n}=t;const i=u1(t);if(ve(e)){i.domain=e.map(w1)}if(ve(n)){i.range=n.map(w1)}return i}initAxes(t){return O0.reduce(((e,n)=>{const i=t[n];if(d8(i)||n===pK&&d8(t.x2)||n===mK&&d8(t.y2)){const t=d8(i)?i.axis:undefined;e[n]=t?this.initAxis(Object.assign({},t)):t}return e}),{})}initAxis(t){const e=RZ(t);const n={};for(const i of e){const e=t[i];n[i]=Q8(e)?y1(e):w1(e)}return n}initLegends(t){return M0.reduce(((e,n)=>{const i=T8(t[n]);if(i&&S0(n)){const t=i.legend;e[n]=t?u1(t):t}return e}),{})}parseData(){this.component.data=fst(this)}parseLayoutSize(){est(this)}parseSelections(){this.component.selection=xnt(this,this.selection)}parseMarkGroup(){this.component.mark=Jst(this)}parseAxesAndHeaders(){this.component.axes=gst(this)}assembleSelectionTopLevelSignals(t){return Ttt(this,t)}assembleSignals(){return[...Mnt(this),...Ntt(this,[])]}assembleSelectionData(t){return Ptt(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return mit(this)}assembleMarks(){var t;let e=(t=this.component.mark)!==null&&t!==void 0?t:[];if(!this.parent||!Oot(this.parent)){e=Ltt(this,e)}return e.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};if(t!==undefined){return t}if(this.encoding.x||this.encoding.y){return"cell"}else{return undefined}}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return a9(this.encoding,t)}fieldDef(t){const e=this.encoding[t];return z8(e)}typedFieldDef(t){const e=this.fieldDef(t);if(h8(e)){return e}return null}}class sat extends Fot{constructor(t,e,n,i,r){super(t,"layer",e,n,r,t.resolve,t.view);const u=Object.assign(Object.assign(Object.assign({},i),t.width?{width:t.width}:{}),t.height?{height:t.height}:{});this.children=t.layer.map(((t,e)=>{if(K4(t)){return new sat(t,this,this.getName(`layer_${e}`),u,r)}else if(u9(t)){return new oat(t,this,this.getName(`layer_${e}`),u,r)}throw new Error(z1(t))}))}parseData(){this.component.data=fst(this);for(const t of this.children){t.parseData()}}parseLayoutSize(){Qot(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const e of RZ(t.component.selection)){this.component.selection[e]=t.component.selection[e]}}}parseMarkGroup(){for(const t of this.children){t.parseMarkGroup()}}parseAxesAndHeaders(){vst(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce(((t,e)=>e.assembleSelectionTopLevelSignals(t)),t)}assembleSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleSignals())),Mnt(this))}assembleLayoutSignals(){return this.children.reduce(((t,e)=>t.concat(e.assembleLayoutSignals())),mit(this))}assembleSelectionData(t){return this.children.reduce(((t,e)=>e.assembleSelectionData(t)),t)}assembleGroupStyle(){const t=new Set;for(const n of this.children){for(const e of Ue(n.assembleGroupStyle())){t.add(e)}}const e=Array.from(t);return e.length>1?e:e.length===1?e[0]:undefined}assembleTitle(){let t=super.assembleTitle();if(t){return t}for(const e of this.children){t=e.assembleTitle();if(t){return t}}return undefined}assembleLayout(){return null}assembleMarks(){return Itt(this,this.children.flatMap((t=>t.assembleMarks())))}assembleLegends(){return this.children.reduce(((t,e)=>t.concat(e.assembleLegends())),ert(this))}}function aat(t,e,n,i,r){if(Y6(t)){return new rst(t,e,n,r)}else if(K4(t)){return new sat(t,e,n,i,r)}else if(u9(t)){return new oat(t,e,n,i,r)}else if(y4(t)){return new cst(t,e,n,r)}throw new Error(z1(t))}var fat=undefined&&undefined.__rest||function(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n};function cat(t,e={}){if(e.logger){a3(e.logger)}if(e.fieldTitle){j8(e.fieldTitle)}try{const n=H4(Ae(e.config,t.config));const i=stt(t,n);const r=aat(i,null,"",undefined,n);r.parse();dut(r.component.data,r);const u=dat(r,lat(t,i.autosize,n,r),t.datasets,t.usermeta);return{spec:u,normalized:i}}finally{if(e.logger){f3()}if(e.fieldTitle){C8()}}}function lat(t,e,n,i){const r=i.component.layoutSize.get("width");const u=i.component.layoutSize.get("height");if(e===undefined){e={type:"pad"};if(i.hasAxisOrientSignalRef()){e.resize=true}}else if(gn(e)){e={type:e}}if(r&&u&&ptt(e.type)){if(r==="step"&&u==="step"){c3(I1());e.type="pad"}else if(r==="step"||u==="step"){const t=r==="step"?"width":"height";c3(I1(E0(t)));const n=t==="width"?"height":"width";e.type=mtt(n)}}return Object.assign(Object.assign(Object.assign({},RZ(e).length===1&&e.type?e.type==="pad"?{}:{autosize:e.type}:{autosize:e}),btt(n,false)),btt(t,true))}function dat(t,e,n={},i){const r=t.config?J4(t.config):undefined;const u=[].concat(t.assembleSelectionData([]),Got(t.component.data,n));const o=t.assembleProjections();const s=t.assembleTitle();const a=t.assembleGroupStyle();const f=t.assembleGroupEncodeEntry(true);let c=t.assembleLayoutSignals();c=c.filter((t=>{if((t.name==="width"||t.name==="height")&&t.value!==undefined){e[t.name]=+t.value;return false}return true}));const{params:l}=e,d=fat(e,["params"]);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({$schema:"https://vega.github.io/schema/vega/v5.json"},t.description?{description:t.description}:{}),d),s?{title:s}:{}),a?{style:a}:{}),f?{encode:{update:f}}:{}),{data:u}),o.length>0?{projections:o}:{}),t.assembleGroup([...c,...t.assembleSelectionTopLevelSignals([]),...v4(l)])),r?{config:r}:{}),i?{usermeta:i}:{})}const hat=dZ.version;const pat=Object.freeze({__proto__:null,version:hat,compile:cat,normalize:stt,deepEqual:AZ,duplicate:xZ,never:OZ,pick:FZ,omit:DZ,stringify:kZ,hash:EZ,isNullOrFalse:$Z,contains:jZ,some:CZ,every:MZ,mergeDeep:BZ,unique:_Z,isEqual:NZ,setEqual:zZ,hasIntersection:TZ,prefixGenerator:PZ,fieldIntersection:LZ,isEmpty:IZ,keys:RZ,vals:qZ,entries:UZ,isBoolean:WZ,varName:GZ,logicalExpr:HZ,deleteNestedProperty:VZ,titleCase:YZ,accessPathWithDatum:XZ,flatAccessWithDatum:JZ,replacePathInField:ZZ,replaceAll:KZ,removePathFromField:tK,accessPathDepth:eK,getFirstDefined:nK,uniqueId:rK,resetIdCounter:uK,internalField:oK,isInternalField:sK,normalizeAngle:aK,isNumeric:fK});function mat(t){const[e,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(t).slice(1,3);return{library:e,version:n}}var gat="vega-themes";var bat="2.10.0";var vat="Themes for stylized Vega and Vega-Lite visualizations.";var yat=["vega","vega-lite","themes","style"];var wat="BSD-3-Clause";var Aat={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"};var xat=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}];var Oat="build/vega-themes.js";var Fat="build/vega-themes.module.js";var Dat="build/vega-themes.min.js";var kat="build/vega-themes.min.js";var Eat="build/vega-themes.module.d.ts";var $at={type:"git",url:"https://github.com/vega/vega-themes.git"};var jat=["src","build"];var Cat={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",prepare:"beemo create-config",eslintbase:"beemo eslint .",format:"yarn eslintbase --fix",lint:"yarn eslintbase"};var Mat={"@rollup/plugin-json":"^4.1.0","@rollup/plugin-node-resolve":"^11.2.0","@wessberg/rollup-plugin-ts":"^1.3.8","browser-sync":"^2.26.14",concurrently:"^6.0.0","gh-pages":"^3.1.0",rollup:"^2.39.1","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-terser":"^7.0.2",typescript:"^4.2.2",vega:"^5.19.1","vega-lite":"^5.0.0","vega-lite-dev-config":"^0.16.1"};var Bat={vega:"*","vega-lite":"*"};var Sat={name:gat,version:bat,description:vat,keywords:yat,license:wat,author:Aat,contributors:xat,main:Oat,module:Fat,unpkg:Dat,jsdelivr:kat,types:Eat,repository:$at,files:jat,scripts:Cat,devDependencies:Mat,peerDependencies:Bat};const _at="#fff";const Nat="#888";const zat={background:"#333",title:{color:_at,subtitleColor:_at},style:{"guide-label":{fill:_at},"guide-title":{fill:_at}},axis:{domainColor:_at,gridColor:Nat,tickColor:_at}};const Tat="#4572a7";const Pat={background:"#fff",arc:{fill:Tat},area:{fill:Tat},line:{stroke:Tat,strokeWidth:2},path:{stroke:Tat},rect:{fill:Tat},shape:{stroke:Tat},symbol:{fill:Tat,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:true,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:false,tickExtra:true},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}};const Lat="#30a2da";const Iat="#cbcbcb";const Rat="#999";const qat="#333";const Uat="#f0f0f0";const Wat="#333";const Gat={arc:{fill:Lat},area:{fill:Lat},axis:{domainColor:Iat,grid:true,gridColor:Iat,gridWidth:1,labelColor:Rat,labelFontSize:10,titleColor:qat,tickColor:Iat,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:false},background:Uat,group:{fill:Uat},legend:{labelColor:Wat,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:Wat,titleFontSize:14,titlePadding:10},line:{stroke:Lat,strokeWidth:2},path:{stroke:Lat,strokeWidth:.5},rect:{fill:Lat},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:true,shape:"circle"},shape:{stroke:Lat},bar:{binSpacing:2,fill:Lat,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}};const Hat="#000";const Vat={group:{fill:"#e5e5e5"},arc:{fill:Hat},area:{fill:Hat},line:{stroke:Hat},path:{stroke:Hat},rect:{fill:Hat},shape:{stroke:Hat},symbol:{fill:Hat,size:40},axis:{domain:false,grid:true,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}};const Yat=22;const Xat="normal";const Jat="Benton Gothic, sans-serif";const Qat=11.5;const Zat="normal";const Kat="#82c6df";const tft="Benton Gothic Bold, sans-serif";const eft="normal";const nft=13;const ift={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]};const rft={background:"#ffffff",title:{anchor:"start",color:"#000000",font:tft,fontSize:Yat,fontWeight:Xat},arc:{fill:Kat},area:{fill:Kat},line:{stroke:Kat,strokeWidth:2},path:{stroke:Kat},rect:{fill:Kat},shape:{stroke:Kat},symbol:{fill:Kat,size:30},axis:{labelFont:Jat,labelFontSize:Qat,labelFontWeight:Zat,titleFont:tft,titleFontSize:nft,titleFontWeight:eft},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:Jat,labelFontSize:Qat,symbolType:"square",titleFont:tft,titleFontSize:nft,titleFontWeight:eft},range:{category:ift["category-6"],diverging:ift["fireandice-6"],heatmap:ift["fire-7"],ordinal:ift["fire-7"],ramp:ift["fire-7"]}};const uft="#ab5787";const oft="#979797";const sft={background:"#f9f9f9",arc:{fill:uft},area:{fill:uft},line:{stroke:uft},path:{stroke:uft},rect:{fill:uft},shape:{stroke:uft},symbol:{fill:uft,size:30},axis:{domainColor:oft,domainWidth:.5,gridWidth:.2,labelColor:oft,tickColor:oft,tickWidth:.2,titleColor:oft},axisBand:{grid:false},axisX:{grid:true,tickSize:10},axisY:{domain:false,grid:true,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}};const aft="#3e5c69";const fft={background:"#fff",arc:{fill:aft},area:{fill:aft},line:{stroke:aft},path:{stroke:aft},rect:{fill:aft},shape:{stroke:aft},symbol:{fill:aft},axis:{domainWidth:.5,grid:true,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:false},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}};const cft="#1696d2";const lft="#000000";const dft="#FFFFFF";const hft="Lato";const pft="Lato";const mft="Lato";const gft="#DEDDDD";const bft=18;const vft={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]};const yft={background:dft,title:{anchor:"start",fontSize:bft,font:hft},axisX:{domain:true,domainColor:lft,domainWidth:1,grid:false,labelFontSize:12,labelFont:pft,labelAngle:0,tickColor:lft,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:hft},axisY:{domain:false,domainWidth:1,grid:true,gridColor:gft,gridWidth:1,labelFontSize:12,labelFont:pft,labelPadding:8,ticks:false,titleFontSize:12,titlePadding:10,titleFont:hft,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:pft,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:hft,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:vft["six-groups-cat-1"],diverging:vft["diverging-colors"],heatmap:vft["diverging-colors"],ordinal:vft["six-groups-seq"],ramp:vft["shades-blue"]},area:{fill:cft},rect:{fill:cft},line:{color:cft,stroke:cft,strokeWidth:5},trail:{color:cft,stroke:cft,strokeWidth:0,size:1},path:{stroke:cft,strokeWidth:.5},point:{filled:true},text:{font:mft,color:cft,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:cft,stroke:null}},arc:{fill:cft},shape:{stroke:cft},symbol:{fill:cft,size:30}};const wft="#3366CC";const Aft="#ccc";const xft="Arial, sans-serif";const Oft={arc:{fill:wft},area:{fill:wft},path:{stroke:wft},rect:{fill:wft},shape:{stroke:wft},symbol:{stroke:wft},circle:{fill:wft},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:xft,fontSize:12},"guide-title":{font:xft,fontSize:12},"group-title":{font:xft,fontSize:12}},title:{font:xft,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:Aft,tickColor:Aft,domain:false,grid:true},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}};const Fft=Sat.version;const Dft=Object.freeze({__proto__:null,dark:zat,excel:Pat,fivethirtyeight:Gat,ggplot2:Vat,googlecharts:Oft,latimes:rft,quartz:sft,urbaninstitute:yft,version:Fft,vox:fft});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function kft(t,e){var n={};for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0)n[i]=t[i];if(t!=null&&typeof Object.getOwnPropertySymbols==="function")for(var r=0,i=Object.getOwnPropertySymbols(t);r<i.length;r++){if(e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r]))n[i[r]]=t[i[r]]}return n}function Eft(t,e,n){if(ve(t)){return`[${t.map((t=>e(gn(t)?t:jft(t,n)))).join(", ")}]`}if(ye(t)){let i="";const r=t,{title:u,image:o}=r,s=kft(r,["title","image"]);if(u){i+=`<h2>${e(u)}</h2>`}if(o){i+=`<img src="${e(o)}">`}const a=Object.keys(s);if(a.length>0){i+="<table>";for(const t of a){let r=s[t];if(r===undefined){continue}if(ye(r)){r=jft(r,n)}i+=`<tr><td class="key">${e(t)}:</td><td class="value">${e(r)}</td></tr>`}i+=`</table>`}return i||"{}"}return e(t)}function $ft(t){const e=[];return function(n,i){if(typeof i!=="object"||i===null){return i}const r=e.indexOf(this)+1;e.length=r;if(e.length>t){return"[Object]"}if(e.indexOf(i)>=0){return"[Circular]"}e.push(i);return i}}function jft(t,e){return JSON.stringify(t,$ft(e))}var Cft=`#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black;\n}\n#vg-tooltip-element.visible {\n  visibility: visible;\n}\n#vg-tooltip-element h2 {\n  margin-top: 0;\n  margin-bottom: 10px;\n  font-size: 13px;\n}\n#vg-tooltip-element img {\n  max-width: 200px;\n  max-height: 200px;\n}\n#vg-tooltip-element table {\n  border-spacing: 0;\n}\n#vg-tooltip-element table tr {\n  border: none;\n}\n#vg-tooltip-element table tr td {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-top: 2px;\n  padding-bottom: 2px;\n}\n#vg-tooltip-element table tr td.key {\n  color: #808080;\n  max-width: 150px;\n  text-align: right;\n  padding-right: 4px;\n}\n#vg-tooltip-element table tr td.value {\n  display: block;\n  max-width: 300px;\n  max-height: 7em;\n  text-align: left;\n}\n#vg-tooltip-element.dark-theme {\n  background-color: rgba(32, 32, 32, 0.9);\n  border: 1px solid #f5f5f5;\n  color: white;\n}\n#vg-tooltip-element.dark-theme td.key {\n  color: #bfbfbf;\n}\n`;const Mft="vg-tooltip-element";const Bft={offsetX:10,offsetY:10,id:Mft,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:false,sanitize:Sft,maxDepth:2,formatTooltip:Eft};function Sft(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function _ft(t){if(!/^[A-Za-z]+[-:.\w]*$/.test(t)){throw new Error("Invalid HTML ID")}return Cft.toString().replace(Mft,t)}function Nft(t,e,n,i){let r=t.clientX+n;if(r+e.width>window.innerWidth){r=+t.clientX-n-e.width}let u=t.clientY+i;if(u+e.height>window.innerHeight){u=+t.clientY-i-e.height}return{x:r,y:u}}class zft{constructor(t){this.options=Object.assign(Object.assign({},Bft),t);const e=this.options.id;this.el=null;this.call=this.tooltipHandler.bind(this);if(!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const t=document.createElement("style");t.setAttribute("id",this.options.styleId);t.innerHTML=_ft(e);const n=document.head;if(n.childNodes.length>0){n.insertBefore(t,n.childNodes[0])}else{n.appendChild(t)}}}tooltipHandler(t,e,n,i){var r;this.el=document.getElementById(this.options.id);if(!this.el){this.el=document.createElement("div");this.el.setAttribute("id",this.options.id);this.el.classList.add("vg-tooltip");const t=(r=document.fullscreenElement)!==null&&r!==void 0?r:document.body;t.appendChild(this.el)}if(i==null||i===""){this.el.classList.remove("visible",`${this.options.theme}-theme`);return}this.el.innerHTML=this.options.formatTooltip(i,this.options.sanitize,this.options.maxDepth);this.el.classList.add("visible",`${this.options.theme}-theme`);const{x:u,y:o}=Nft(e,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.setAttribute("style",`top: ${o}px; left: ${u}px`)}}function Tft(t,e,n){if(e in t){Object.defineProperty(t,e,{value:n,enumerable:true,configurable:true,writable:true})}else{t[e]=n}return t}function Pft(t,e,n,i,r,u,o){try{var s=t[u](o);var a=s.value}catch(ne){n(ne);return}if(s.done){e(a)}else{Promise.resolve(a).then(i,r)}}function Lft(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var u=t.apply(e,n);function o(t){Pft(u,i,r,o,s,"next",t)}function s(t){Pft(u,i,r,o,s,"throw",t)}o(undefined)}))}}var Ift=Object.prototype;var Rft=Ift.hasOwnProperty;var qft;var Uft=typeof Symbol==="function"?Symbol:{};var Wft=Uft.iterator||"@@iterator";var Gft=Uft.asyncIterator||"@@asyncIterator";var Hft=Uft.toStringTag||"@@toStringTag";function Vft(t,e,n,i){var r=e&&e.prototype instanceof tct?e:tct;var u=Object.create(r.prototype);var o=new bct(i||[]);u._invoke=hct(t,n,o);return u}function Yft(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(i){return{type:"throw",arg:i}}}var Xft="suspendedStart";var Jft="suspendedYield";var Qft="executing";var Zft="completed";var Kft={};function tct(){}function ect(){}function nct(){}var ict={};ict[Wft]=function(){return this};var rct=Object.getPrototypeOf;var uct=rct&&rct(rct(yct([])));if(uct&&uct!==Ift&&Rft.call(uct,Wft)){ict=uct}var oct=nct.prototype=tct.prototype=Object.create(ict);ect.prototype=oct.constructor=nct;nct.constructor=ect;nct[Hft]=ect.displayName="GeneratorFunction";function sct(t){["next","throw","return"].forEach((function(e){t[e]=function(t){return this._invoke(e,t)}}))}function act(t){var e=typeof t==="function"&&t.constructor;return e?e===ect||(e.displayName||e.name)==="GeneratorFunction":false}function fct(t){if(Object.setPrototypeOf){Object.setPrototypeOf(t,nct)}else{t.__proto__=nct;if(!(Hft in t)){t[Hft]="GeneratorFunction"}}t.prototype=Object.create(oct);return t}function cct(t){return{__await:t}}function lct(t,e){function n(i,r,u,o){var s=Yft(t[i],t,r);if(s.type==="throw"){o(s.arg)}else{var a=s.arg;var f=a.value;if(f&&typeof f==="object"&&Rft.call(f,"__await")){return e.resolve(f.__await).then((function(t){n("next",t,u,o)}),(function(t){n("throw",t,u,o)}))}return e.resolve(f).then((function(t){a.value=t;u(a)}),(function(t){return n("throw",t,u,o)}))}}var i;function r(t,r){function u(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(u,u):u()}this._invoke=r}sct(lct.prototype);lct.prototype[Gft]=function(){return this};function dct(t,e,n,i,r){if(r===void 0)r=Promise;var u=new lct(Vft(t,e,n,i),r);return act(e)?u:u.next().then((function(t){return t.done?t.value:u.next()}))}function hct(t,e,n){var i=Xft;return function r(u,o){if(i===Qft){throw new Error("Generator is already running")}if(i===Zft){if(u==="throw"){throw o}return wct()}n.method=u;n.arg=o;while(true){var s=n.delegate;if(s){var a=pct(s,n);if(a){if(a===Kft)continue;return a}}if(n.method==="next"){n.sent=n._sent=n.arg}else if(n.method==="throw"){if(i===Xft){i=Zft;throw n.arg}n.dispatchException(n.arg)}else if(n.method==="return"){n.abrupt("return",n.arg)}i=Qft;var f=Yft(t,e,n);if(f.type==="normal"){i=n.done?Zft:Jft;if(f.arg===Kft){continue}return{value:f.arg,done:n.done}}else if(f.type==="throw"){i=Zft;n.method="throw";n.arg=f.arg}}}}function pct(t,e){var n=t.iterator[e.method];if(n===qft){e.delegate=null;if(e.method==="throw"){if(t.iterator["return"]){e.method="return";e.arg=qft;pct(t,e);if(e.method==="throw"){return Kft}}e.method="throw";e.arg=new TypeError("The iterator does not provide a 'throw' method")}return Kft}var i=Yft(n,t.iterator,e.arg);if(i.type==="throw"){e.method="throw";e.arg=i.arg;e.delegate=null;return Kft}var r=i.arg;if(!r){e.method="throw";e.arg=new TypeError("iterator result is not an object");e.delegate=null;return Kft}if(r.done){e[t.resultName]=r.value;e.next=t.nextLoc;if(e.method!=="return"){e.method="next";e.arg=qft}}else{return r}e.delegate=null;return Kft}sct(oct);oct[Hft]="Generator";oct[Wft]=function(){return this};oct.toString=function(){return"[object Generator]"};function mct(t){var e={tryLoc:t[0]};if(1 in t){e.catchLoc=t[1]}if(2 in t){e.finallyLoc=t[2];e.afterLoc=t[3]}this.tryEntries.push(e)}function gct(t){var e=t.completion||{};e.type="normal";delete e.arg;t.completion=e}function bct(t){this.tryEntries=[{tryLoc:"root"}];t.forEach(mct,this);this.reset(true)}function vct(t){var e=[];for(var n in t){e.push(n)}e.reverse();return function n(){while(e.length){var i=e.pop();if(i in t){n.value=i;n.done=false;return n}}n.done=true;return n}}function yct(t){if(t){var e=t[Wft];if(e){return e.call(t)}if(typeof t.next==="function"){return t}if(!isNaN(t.length)){var n=-1,i=function e(){while(++n<t.length){if(Rft.call(t,n)){e.value=t[n];e.done=false;return e}}e.value=qft;e.done=true;return e};return i.next=i}}return{next:wct}}function wct(){return{value:qft,done:true}}bct.prototype={constructor:bct,reset:function t(e){this.prev=0;this.next=0;this.sent=this._sent=qft;this.done=false;this.delegate=null;this.method="next";this.arg=qft;this.tryEntries.forEach(gct);if(!e){for(var n in this){if(n.charAt(0)==="t"&&Rft.call(this,n)&&!isNaN(+n.slice(1))){this[n]=qft}}}},stop:function t(){this.done=true;var e=this.tryEntries[0];var n=e.completion;if(n.type==="throw"){throw n.arg}return this.rval},dispatchException:function t(e){if(this.done){throw e}var n=this;function i(t,i){o.type="throw";o.arg=e;n.next=t;if(i){n.method="next";n.arg=qft}return!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var u=this.tryEntries[r];var o=u.completion;if(u.tryLoc==="root"){return i("end")}if(u.tryLoc<=this.prev){var s=Rft.call(u,"catchLoc");var a=Rft.call(u,"finallyLoc");if(s&&a){if(this.prev<u.catchLoc){return i(u.catchLoc,true)}else if(this.prev<u.finallyLoc){return i(u.finallyLoc)}}else if(s){if(this.prev<u.catchLoc){return i(u.catchLoc,true)}}else if(a){if(this.prev<u.finallyLoc){return i(u.finallyLoc)}}else{throw new Error("try statement without catch or finally")}}}},abrupt:function t(e,n){for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i];if(r.tryLoc<=this.prev&&Rft.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var u=r;break}}if(u&&(e==="break"||e==="continue")&&u.tryLoc<=n&&n<=u.finallyLoc){u=null}var o=u?u.completion:{};o.type=e;o.arg=n;if(u){this.method="next";this.next=u.finallyLoc;return Kft}return this.complete(o)},complete:function t(e,n){if(e.type==="throw"){throw e.arg}if(e.type==="break"||e.type==="continue"){this.next=e.arg}else if(e.type==="return"){this.rval=this.arg=e.arg;this.method="return";this.next="end"}else if(e.type==="normal"&&n){this.next=n}return Kft},finish:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.finallyLoc===e){this.complete(i.completion,i.afterLoc);gct(i);return Kft}}},catch:function t(e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc===e){var r=i.completion;if(r.type==="throw"){var u=r.arg;gct(i)}return u}}throw new Error("illegal catch attempt")},delegateYield:function t(e,n,i){this.delegate={iterator:yct(e),resultName:n,nextLoc:i};if(this.method==="next"){this.arg=qft}return Kft}};var Act={wrap:Vft,isGeneratorFunction:act,AsyncIterator:lct,mark:fct,awrap:cct,async:dct,keys:vct,values:yct};var xct=Oct;Oct.Node=Ect;Oct.create=Oct;function Oct(t){var e=this;if(!(e instanceof Oct)){e=new Oct}e.tail=null;e.head=null;e.length=0;if(t&&typeof t.forEach==="function"){t.forEach((function(t){e.push(t)}))}else if(arguments.length>0){for(var n=0,i=arguments.length;n<i;n++){e.push(arguments[n])}}return e}Oct.prototype.removeNode=function(t){if(t.list!==this){throw new Error("removing node which does not belong to this list")}var e=t.next;var n=t.prev;if(e){e.prev=n}if(n){n.next=e}if(t===this.head){this.head=e}if(t===this.tail){this.tail=n}t.list.length--;t.next=null;t.prev=null;t.list=null;return e};Oct.prototype.unshiftNode=function(t){if(t===this.head){return}if(t.list){t.list.removeNode(t)}var e=this.head;t.list=this;t.next=e;if(e){e.prev=t}this.head=t;if(!this.tail){this.tail=t}this.length++};Oct.prototype.pushNode=function(t){if(t===this.tail){return}if(t.list){t.list.removeNode(t)}var e=this.tail;t.list=this;t.prev=e;if(e){e.next=t}this.tail=t;if(!this.head){this.head=t}this.length++};Oct.prototype.push=function(){for(var t=0,e=arguments.length;t<e;t++){Dct(this,arguments[t])}return this.length};Oct.prototype.unshift=function(){for(var t=0,e=arguments.length;t<e;t++){kct(this,arguments[t])}return this.length};Oct.prototype.pop=function(){if(!this.tail){return undefined}var t=this.tail.value;this.tail=this.tail.prev;if(this.tail){this.tail.next=null}else{this.head=null}this.length--;return t};Oct.prototype.shift=function(){if(!this.head){return undefined}var t=this.head.value;this.head=this.head.next;if(this.head){this.head.prev=null}else{this.tail=null}this.length--;return t};Oct.prototype.forEach=function(t,e){e=e||this;for(var n=this.head,i=0;n!==null;i++){t.call(e,n.value,i,this);n=n.next}};Oct.prototype.forEachReverse=function(t,e){e=e||this;for(var n=this.tail,i=this.length-1;n!==null;i--){t.call(e,n.value,i,this);n=n.prev}};Oct.prototype.get=function(t){for(var e=0,n=this.head;n!==null&&e<t;e++){n=n.next}if(e===t&&n!==null){return n.value}};Oct.prototype.getReverse=function(t){for(var e=0,n=this.tail;n!==null&&e<t;e++){n=n.prev}if(e===t&&n!==null){return n.value}};Oct.prototype.map=function(t,e){e=e||this;var n=new Oct;for(var i=this.head;i!==null;){n.push(t.call(e,i.value,this));i=i.next}return n};Oct.prototype.mapReverse=function(t,e){e=e||this;var n=new Oct;for(var i=this.tail;i!==null;){n.push(t.call(e,i.value,this));i=i.prev}return n};Oct.prototype.reduce=function(t,e){var n;var i=this.head;if(arguments.length>1){n=e}else if(this.head){i=this.head.next;n=this.head.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var r=0;i!==null;r++){n=t(n,i.value,r);i=i.next}return n};Oct.prototype.reduceReverse=function(t,e){var n;var i=this.tail;if(arguments.length>1){n=e}else if(this.tail){i=this.tail.prev;n=this.tail.value}else{throw new TypeError("Reduce of empty list with no initial value")}for(var r=this.length-1;i!==null;r--){n=t(n,i.value,r);i=i.prev}return n};Oct.prototype.toArray=function(){var t=new Array(this.length);for(var e=0,n=this.head;n!==null;e++){t[e]=n.value;n=n.next}return t};Oct.prototype.toArrayReverse=function(){var t=new Array(this.length);for(var e=0,n=this.tail;n!==null;e++){t[e]=n.value;n=n.prev}return t};Oct.prototype.slice=function(t,e){e=e||this.length;if(e<0){e+=this.length}t=t||0;if(t<0){t+=this.length}var n=new Oct;if(e<t||e<0){return n}if(t<0){t=0}if(e>this.length){e=this.length}for(var i=0,r=this.head;r!==null&&i<t;i++){r=r.next}for(;r!==null&&i<e;i++,r=r.next){n.push(r.value)}return n};Oct.prototype.sliceReverse=function(t,e){e=e||this.length;if(e<0){e+=this.length}t=t||0;if(t<0){t+=this.length}var n=new Oct;if(e<t||e<0){return n}if(t<0){t=0}if(e>this.length){e=this.length}for(var i=this.length,r=this.tail;r!==null&&i>e;i--){r=r.prev}for(;r!==null&&i>t;i--,r=r.prev){n.push(r.value)}return n};Oct.prototype.splice=function(t,e){if(t>this.length){t=this.length-1}if(t<0){t=this.length+t}for(var n=0,i=this.head;i!==null&&n<t;n++){i=i.next}var r=[];for(var n=0;i&&n<e;n++){r.push(i.value);i=this.removeNode(i)}if(i===null){i=this.tail}if(i!==this.head&&i!==this.tail){i=i.prev}for(var n=0;n<(arguments.length<=2?0:arguments.length-2);n++){i=Fct(this,i,n+2<2||arguments.length<=n+2?undefined:arguments[n+2])}return r};Oct.prototype.reverse=function(){var t=this.head;var e=this.tail;for(var n=t;n!==null;n=n.prev){var i=n.prev;n.prev=n.next;n.next=i}this.head=e;this.tail=t;return this};function Fct(t,e,n){var i=e===t.head?new Ect(n,null,e,t):new Ect(n,e,e.next,t);if(i.next===null){t.tail=i}if(i.prev===null){t.head=i}t.length++;return i}function Dct(t,e){t.tail=new Ect(e,t.tail,null,t);if(!t.head){t.head=t.tail}t.length++}function kct(t,e){t.head=new Ect(e,null,t.head,t);if(!t.tail){t.tail=t.head}t.length++}function Ect(t,e,n,i){if(!(this instanceof Ect)){return new Ect(t,e,n,i)}this.list=i;this.value=t;if(e){e.next=this;this.prev=e}else{this.prev=null}if(n){n.prev=this;this.next=n}else{this.next=null}}try{Oct.prototype[Symbol.iterator]=Act.mark((function t(){var e;return Act.wrap((function t(n){while(1){switch(n.prev=n.next){case 0:e=this.head;case 1:if(!e){n.next=7;break}n.next=4;return e.value;case 4:e=e.next;n.next=1;break;case 7:case"end":return n.stop()}}}),t,this)}))}catch(xht){}var $ct=xct;var jct=Symbol("max");var Cct=Symbol("length");var Mct=Symbol("lengthCalculator");var Bct=Symbol("allowStale");var Sct=Symbol("maxAge");var _ct=Symbol("dispose");var Nct=Symbol("noDisposeOnSet");var zct=Symbol("lruList");var Tct=Symbol("cache");var Pct=Symbol("updateAgeOnGet");var Lct=()=>1;class Ict{constructor(t){if(typeof t==="number")t={max:t};if(!t)t={};if(t.max&&(typeof t.max!=="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[jct]=t.max||Infinity;var e=t.length||Lct;this[Mct]=typeof e!=="function"?Lct:e;this[Bct]=t.stale||false;if(t.maxAge&&typeof t.maxAge!=="number")throw new TypeError("maxAge must be a number");this[Sct]=t.maxAge||0;this[_ct]=t.dispose;this[Nct]=t.noDisposeOnSet||false;this[Pct]=t.updateAgeOnGet||false;this.reset()}set max(t){if(typeof t!=="number"||t<0)throw new TypeError("max must be a non-negative number");this[jct]=t||Infinity;Uct(this)}get max(){return this[jct]}set allowStale(t){this[Bct]=!!t}get allowStale(){return this[Bct]}set maxAge(t){if(typeof t!=="number")throw new TypeError("maxAge must be a non-negative number");this[Sct]=t;Uct(this)}get maxAge(){return this[Sct]}set lengthCalculator(t){if(typeof t!=="function")t=Lct;if(t!==this[Mct]){this[Mct]=t;this[Cct]=0;this[zct].forEach((t=>{t.length=this[Mct](t.value,t.key);this[Cct]+=t.length}))}Uct(this)}get lengthCalculator(){return this[Mct]}get length(){return this[Cct]}get itemCount(){return this[zct].length}rforEach(t,e){e=e||this;for(var n=this[zct].tail;n!==null;){var i=n.prev;Hct(this,t,n,e);n=i}}forEach(t,e){e=e||this;for(var n=this[zct].head;n!==null;){var i=n.next;Hct(this,t,n,e);n=i}}keys(){return this[zct].toArray().map((t=>t.key))}values(){return this[zct].toArray().map((t=>t.value))}reset(){if(this[_ct]&&this[zct]&&this[zct].length){this[zct].forEach((t=>this[_ct](t.key,t.value)))}this[Tct]=new Map;this[zct]=new $ct;this[Cct]=0}dump(){return this[zct].map((t=>qct(this,t)?false:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)})).toArray().filter((t=>t))}dumpLru(){return this[zct]}set(t,e,n){n=n||this[Sct];if(n&&typeof n!=="number")throw new TypeError("maxAge must be a number");var i=n?Date.now():0;var r=this[Mct](e,t);if(this[Tct].has(t)){if(r>this[jct]){Wct(this,this[Tct].get(t));return false}var u=this[Tct].get(t);var o=u.value;if(this[_ct]){if(!this[Nct])this[_ct](t,o.value)}o.now=i;o.maxAge=n;o.value=e;this[Cct]+=r-o.length;o.length=r;this.get(t);Uct(this);return true}var s=new Gct(t,e,r,i,n);if(s.length>this[jct]){if(this[_ct])this[_ct](t,e);return false}this[Cct]+=s.length;this[zct].unshift(s);this[Tct].set(t,this[zct].head);Uct(this);return true}has(t){if(!this[Tct].has(t))return false;var e=this[Tct].get(t).value;return!qct(this,e)}get(t){return Rct(this,t,true)}peek(t){return Rct(this,t,false)}pop(){var t=this[zct].tail;if(!t)return null;Wct(this,t);return t.value}del(t){Wct(this,this[Tct].get(t))}load(t){this.reset();var e=Date.now();for(var n=t.length-1;n>=0;n--){var i=t[n];var r=i.e||0;if(r===0)this.set(i.k,i.v);else{var u=r-e;if(u>0){this.set(i.k,i.v,u)}}}}prune(){this[Tct].forEach(((t,e)=>Rct(this,e,false)))}}var Rct=(t,e,n)=>{var i=t[Tct].get(e);if(i){var r=i.value;if(qct(t,r)){Wct(t,i);if(!t[Bct])return undefined}else{if(n){if(t[Pct])i.value.now=Date.now();t[zct].unshiftNode(i)}}return r.value}};var qct=(t,e)=>{if(!e||!e.maxAge&&!t[Sct])return false;var n=Date.now()-e.now;return e.maxAge?n>e.maxAge:t[Sct]&&n>t[Sct]};var Uct=t=>{if(t[Cct]>t[jct]){for(var e=t[zct].tail;t[Cct]>t[jct]&&e!==null;){var n=e.prev;Wct(t,e);e=n}}};var Wct=(t,e)=>{if(e){var n=e.value;if(t[_ct])t[_ct](n.key,n.value);t[Cct]-=n.length;t[Tct].delete(n.key);t[zct].removeNode(e)}};class Gct{constructor(t,e,n,i,r){this.key=t;this.value=e;this.length=n;this.now=i;this.maxAge=r||0}}var Hct=(t,e,n,i)=>{var r=n.value;if(qct(t,r)){Wct(t,n);if(!t[Bct])r=undefined}if(r)e.call(i,r.value,r.key,t)};var Vct=Ict;var Yct=["includePrerelease","loose","rtl"];var Xct=t=>!t?{}:typeof t!=="object"?{loose:true}:Yct.filter((e=>t[e])).reduce(((t,e)=>{t[e]=true;return t}),{});var Jct=Xct;var Qct={exports:{}};var Zct="2.0.0";var Kct=256;var tlt=Number.MAX_SAFE_INTEGER||9007199254740991;var elt=16;var nlt={SEMVER_SPEC_VERSION:Zct,MAX_LENGTH:Kct,MAX_SAFE_INTEGER:tlt,MAX_SAFE_COMPONENT_LENGTH:elt};var ilt=typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++){e[n]=arguments[n]}return console.error("SEMVER",...e)}:()=>{};var rlt=ilt;(function(t,e){var n=nlt.MAX_SAFE_COMPONENT_LENGTH;var i=rlt;e=t.exports={};var r=e.re=[];var u=e.src=[];var o=e.t={};var s=0;var a=(t,e,n)=>{var a=s++;i(a,e);o[t]=a;u[a]=e;r[a]=new RegExp(e,n?"g":undefined)};a("NUMERICIDENTIFIER","0|[1-9]\\d*");a("NUMERICIDENTIFIERLOOSE","[0-9]+");a("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*");a("MAINVERSION","(".concat(u[o.NUMERICIDENTIFIER],")\\.")+"(".concat(u[o.NUMERICIDENTIFIER],")\\.")+"(".concat(u[o.NUMERICIDENTIFIER],")"));a("MAINVERSIONLOOSE","(".concat(u[o.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(u[o.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(u[o.NUMERICIDENTIFIERLOOSE],")"));a("PRERELEASEIDENTIFIER","(?:".concat(u[o.NUMERICIDENTIFIER],"|").concat(u[o.NONNUMERICIDENTIFIER],")"));a("PRERELEASEIDENTIFIERLOOSE","(?:".concat(u[o.NUMERICIDENTIFIERLOOSE],"|").concat(u[o.NONNUMERICIDENTIFIER],")"));a("PRERELEASE","(?:-(".concat(u[o.PRERELEASEIDENTIFIER],"(?:\\.").concat(u[o.PRERELEASEIDENTIFIER],")*))"));a("PRERELEASELOOSE","(?:-?(".concat(u[o.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(u[o.PRERELEASEIDENTIFIERLOOSE],")*))"));a("BUILDIDENTIFIER","[0-9A-Za-z-]+");a("BUILD","(?:\\+(".concat(u[o.BUILDIDENTIFIER],"(?:\\.").concat(u[o.BUILDIDENTIFIER],")*))"));a("FULLPLAIN","v?".concat(u[o.MAINVERSION]).concat(u[o.PRERELEASE],"?").concat(u[o.BUILD],"?"));a("FULL","^".concat(u[o.FULLPLAIN],"$"));a("LOOSEPLAIN","[v=\\s]*".concat(u[o.MAINVERSIONLOOSE]).concat(u[o.PRERELEASELOOSE],"?").concat(u[o.BUILD],"?"));a("LOOSE","^".concat(u[o.LOOSEPLAIN],"$"));a("GTLT","((?:<|>)?=?)");a("XRANGEIDENTIFIERLOOSE","".concat(u[o.NUMERICIDENTIFIERLOOSE],"|x|X|\\*"));a("XRANGEIDENTIFIER","".concat(u[o.NUMERICIDENTIFIER],"|x|X|\\*"));a("XRANGEPLAIN","[v=\\s]*(".concat(u[o.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(u[o.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(u[o.XRANGEIDENTIFIER],")")+"(?:".concat(u[o.PRERELEASE],")?").concat(u[o.BUILD],"?")+")?)?");a("XRANGEPLAINLOOSE","[v=\\s]*(".concat(u[o.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(u[o.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(u[o.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(u[o.PRERELEASELOOSE],")?").concat(u[o.BUILD],"?")+")?)?");a("XRANGE","^".concat(u[o.GTLT],"\\s*").concat(u[o.XRANGEPLAIN],"$"));a("XRANGELOOSE","^".concat(u[o.GTLT],"\\s*").concat(u[o.XRANGEPLAINLOOSE],"$"));a("COERCE","".concat("(^|[^\\d])"+"(\\d{1,").concat(n,"})")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:$|[^\\d])");a("COERCERTL",u[o.COERCE],true);a("LONETILDE","(?:~>?)");a("TILDETRIM","(\\s*)".concat(u[o.LONETILDE],"\\s+"),true);e.tildeTrimReplace="$1~";a("TILDE","^".concat(u[o.LONETILDE]).concat(u[o.XRANGEPLAIN],"$"));a("TILDELOOSE","^".concat(u[o.LONETILDE]).concat(u[o.XRANGEPLAINLOOSE],"$"));a("LONECARET","(?:\\^)");a("CARETTRIM","(\\s*)".concat(u[o.LONECARET],"\\s+"),true);e.caretTrimReplace="$1^";a("CARET","^".concat(u[o.LONECARET]).concat(u[o.XRANGEPLAIN],"$"));a("CARETLOOSE","^".concat(u[o.LONECARET]).concat(u[o.XRANGEPLAINLOOSE],"$"));a("COMPARATORLOOSE","^".concat(u[o.GTLT],"\\s*(").concat(u[o.LOOSEPLAIN],")$|^$"));a("COMPARATOR","^".concat(u[o.GTLT],"\\s*(").concat(u[o.FULLPLAIN],")$|^$"));a("COMPARATORTRIM","(\\s*)".concat(u[o.GTLT],"\\s*(").concat(u[o.LOOSEPLAIN],"|").concat(u[o.XRANGEPLAIN],")"),true);e.comparatorTrimReplace="$1$2$3";a("HYPHENRANGE","^\\s*(".concat(u[o.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(u[o.XRANGEPLAIN],")")+"\\s*$");a("HYPHENRANGELOOSE","^\\s*(".concat(u[o.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(u[o.XRANGEPLAINLOOSE],")")+"\\s*$");a("STAR","(<|>)?=?\\s*\\*");a("GTE0","^\\s*>=\\s*0.0.0\\s*$");a("GTE0PRE","^\\s*>=\\s*0.0.0-0\\s*$")})(Qct,Qct.exports);var ult=/^[0-9]+$/;var olt=(t,e)=>{var n=ult.test(t);var i=ult.test(e);if(n&&i){t=+t;e=+e}return t===e?0:n&&!i?-1:i&&!n?1:t<e?-1:1};var slt=(t,e)=>olt(e,t);var alt={compareIdentifiers:olt,rcompareIdentifiers:slt};var flt=rlt;var clt=nlt.MAX_LENGTH,llt=nlt.MAX_SAFE_INTEGER;var dlt=Qct.exports.re,hlt=Qct.exports.t;var plt=Jct;var mlt=alt.compareIdentifiers;class glt{constructor(t,e){e=plt(e);if(t instanceof glt){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease){return t}else{t=t.version}}else if(typeof t!=="string"){throw new TypeError("Invalid Version: ".concat(t))}if(t.length>clt){throw new TypeError("version is longer than ".concat(clt," characters"))}flt("SemVer",t,e);this.options=e;this.loose=!!e.loose;this.includePrerelease=!!e.includePrerelease;var n=t.trim().match(e.loose?dlt[hlt.LOOSE]:dlt[hlt.FULL]);if(!n){throw new TypeError("Invalid Version: ".concat(t))}this.raw=t;this.major=+n[1];this.minor=+n[2];this.patch=+n[3];if(this.major>llt||this.major<0){throw new TypeError("Invalid major version")}if(this.minor>llt||this.minor<0){throw new TypeError("Invalid minor version")}if(this.patch>llt||this.patch<0){throw new TypeError("Invalid patch version")}if(!n[4]){this.prerelease=[]}else{this.prerelease=n[4].split(".").map((t=>{if(/^[0-9]+$/.test(t)){var e=+t;if(e>=0&&e<llt){return e}}return t}))}this.build=n[5]?n[5].split("."):[];this.format()}format(){this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch);if(this.prerelease.length){this.version+="-".concat(this.prerelease.join("."))}return this.version}toString(){return this.version}compare(t){flt("SemVer.compare",this.version,this.options,t);if(!(t instanceof glt)){if(typeof t==="string"&&t===this.version){return 0}t=new glt(t,this.options)}if(t.version===this.version){return 0}return this.compareMain(t)||this.comparePre(t)}compareMain(t){if(!(t instanceof glt)){t=new glt(t,this.options)}return mlt(this.major,t.major)||mlt(this.minor,t.minor)||mlt(this.patch,t.patch)}comparePre(t){if(!(t instanceof glt)){t=new glt(t,this.options)}if(this.prerelease.length&&!t.prerelease.length){return-1}else if(!this.prerelease.length&&t.prerelease.length){return 1}else if(!this.prerelease.length&&!t.prerelease.length){return 0}var e=0;do{var n=this.prerelease[e];var i=t.prerelease[e];flt("prerelease compare",e,n,i);if(n===undefined&&i===undefined){return 0}else if(i===undefined){return 1}else if(n===undefined){return-1}else if(n===i){continue}else{return mlt(n,i)}}while(++e)}compareBuild(t){if(!(t instanceof glt)){t=new glt(t,this.options)}var e=0;do{var n=this.build[e];var i=t.build[e];flt("prerelease compare",e,n,i);if(n===undefined&&i===undefined){return 0}else if(i===undefined){return 1}else if(n===undefined){return-1}else if(n===i){continue}else{return mlt(n,i)}}while(++e)}inc(t,e){switch(t){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",e);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",e);break;case"prepatch":this.prerelease.length=0;this.inc("patch",e);this.inc("pre",e);break;case"prerelease":if(this.prerelease.length===0){this.inc("patch",e)}this.inc("pre",e);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0){this.major++}this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0){this.minor++}this.patch=0;this.prerelease=[];break;case"patch":if(this.prerelease.length===0){this.patch++}this.prerelease=[];break;case"pre":if(this.prerelease.length===0){this.prerelease=[0]}else{var n=this.prerelease.length;while(--n>=0){if(typeof this.prerelease[n]==="number"){this.prerelease[n]++;n=-2}}if(n===-1){this.prerelease.push(0)}}if(e){if(this.prerelease[0]===e){if(isNaN(this.prerelease[1])){this.prerelease=[e,0]}}else{this.prerelease=[e,0]}}break;default:throw new Error("invalid increment argument: ".concat(t))}this.format();this.raw=this.version;return this}}var blt=glt;var vlt=blt;var ylt=(t,e,n)=>new vlt(t,n).compare(new vlt(e,n));var wlt=ylt;var Alt=wlt;var xlt=(t,e,n)=>Alt(t,e,n)===0;var Olt=xlt;var Flt=wlt;var Dlt=(t,e,n)=>Flt(t,e,n)!==0;var klt=Dlt;var Elt=wlt;var $lt=(t,e,n)=>Elt(t,e,n)>0;var jlt=$lt;var Clt=wlt;var Mlt=(t,e,n)=>Clt(t,e,n)>=0;var Blt=Mlt;var Slt=wlt;var _lt=(t,e,n)=>Slt(t,e,n)<0;var Nlt=_lt;var zlt=wlt;var Tlt=(t,e,n)=>zlt(t,e,n)<=0;var Plt=Tlt;var Llt=Olt;var Ilt=klt;var Rlt=jlt;var qlt=Blt;var Ult=Nlt;var Wlt=Plt;var Glt=(t,e,n,i)=>{switch(e){case"===":if(typeof t==="object")t=t.version;if(typeof n==="object")n=n.version;return t===n;case"!==":if(typeof t==="object")t=t.version;if(typeof n==="object")n=n.version;return t!==n;case"":case"=":case"==":return Llt(t,n,i);case"!=":return Ilt(t,n,i);case">":return Rlt(t,n,i);case">=":return qlt(t,n,i);case"<":return Ult(t,n,i);case"<=":return Wlt(t,n,i);default:throw new TypeError("Invalid operator: ".concat(e))}};var Hlt=Glt;var Vlt=Symbol("SemVer ANY");class Ylt{static get ANY(){return Vlt}constructor(t,e){e=Jlt(e);if(t instanceof Ylt){if(t.loose===!!e.loose){return t}else{t=t.value}}tdt("comparator",t,e);this.options=e;this.loose=!!e.loose;this.parse(t);if(this.semver===Vlt){this.value=""}else{this.value=this.operator+this.semver.version}tdt("comp",this)}parse(t){var e=this.options.loose?Qlt[Zlt.COMPARATORLOOSE]:Qlt[Zlt.COMPARATOR];var n=t.match(e);if(!n){throw new TypeError("Invalid comparator: ".concat(t))}this.operator=n[1]!==undefined?n[1]:"";if(this.operator==="="){this.operator=""}if(!n[2]){this.semver=Vlt}else{this.semver=new edt(n[2],this.options.loose)}}toString(){return this.value}test(t){tdt("Comparator.test",t,this.options.loose);if(this.semver===Vlt||t===Vlt){return true}if(typeof t==="string"){try{t=new edt(t,this.options)}catch(xht){return false}}return Klt(t,this.operator,this.semver,this.options)}intersects(t,e){if(!(t instanceof Ylt)){throw new TypeError("a Comparator is required")}if(!e||typeof e!=="object"){e={loose:!!e,includePrerelease:false}}if(this.operator===""){if(this.value===""){return true}return new ndt(t.value,e).test(this.value)}else if(t.operator===""){if(t.value===""){return true}return new ndt(this.value,e).test(t.semver)}var n=(this.operator===">="||this.operator===">")&&(t.operator===">="||t.operator===">");var i=(this.operator==="<="||this.operator==="<")&&(t.operator==="<="||t.operator==="<");var r=this.semver.version===t.semver.version;var u=(this.operator===">="||this.operator==="<=")&&(t.operator===">="||t.operator==="<=");var o=Klt(this.semver,"<",t.semver,e)&&(this.operator===">="||this.operator===">")&&(t.operator==="<="||t.operator==="<");var s=Klt(this.semver,">",t.semver,e)&&(this.operator==="<="||this.operator==="<")&&(t.operator===">="||t.operator===">");return n||i||r&&u||o||s}}var Xlt=Ylt;var Jlt=Jct;var Qlt=Qct.exports.re,Zlt=Qct.exports.t;var Klt=Hlt;var tdt=rlt;var edt=blt;var ndt=sdt;function idt(t,e){var n=typeof Symbol!=="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=rdt(t))||e&&t&&typeof t.length==="number"){if(n)t=n;var i=0;var r=function t(){};return{s:r,n:function e(){if(i>=t.length)return{done:true};return{done:false,value:t[i++]}},e:function t(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u=true,o=false,s;return{s:function e(){n=n.call(t)},n:function t(){var e=n.next();u=e.done;return e},e:function t(e){o=true;s=e},f:function t(){try{if(!u&&n.return!=null)n.return()}finally{if(o)throw s}}}}function rdt(t,e){if(!t)return;if(typeof t==="string")return udt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor)n=t.constructor.name;if(n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return udt(t,e)}function udt(t,e){if(e==null||e>t.length)e=t.length;for(var n=0,i=new Array(e);n<e;n++){i[n]=t[n]}return i}class odt{constructor(t,e){e=cdt(e);if(t instanceof odt){if(t.loose===!!e.loose&&t.includePrerelease===!!e.includePrerelease){return t}else{return new odt(t.raw,e)}}if(t instanceof ldt){this.raw=t.value;this.set=[[t]];this.format();return this}this.options=e;this.loose=!!e.loose;this.includePrerelease=!!e.includePrerelease;this.raw=t;this.set=t.split(/\s*\|\|\s*/).map((t=>this.parseRange(t.trim()))).filter((t=>t.length));if(!this.set.length){throw new TypeError("Invalid SemVer Range: ".concat(t))}if(this.set.length>1){var n=this.set[0];this.set=this.set.filter((t=>!ydt(t[0])));if(this.set.length===0)this.set=[n];else if(this.set.length>1){var i=idt(this.set),r;try{for(i.s();!(r=i.n()).done;){var u=r.value;if(u.length===1&&wdt(u[0])){this.set=[u];break}}}catch(o){i.e(o)}finally{i.f()}}}this.format()}format(){this.range=this.set.map((t=>t.join(" ").trim())).join("||").trim();return this.range}toString(){return this.range}parseRange(t){t=t.trim();var e=Object.keys(this.options).join(",");var n="parseRange:".concat(e,":").concat(t);var i=fdt.get(n);if(i)return i;var r=this.options.loose;var u=r?pdt[mdt.HYPHENRANGELOOSE]:pdt[mdt.HYPHENRANGE];t=t.replace(u,Bdt(this.options.includePrerelease));ddt("hyphen replace",t);t=t.replace(pdt[mdt.COMPARATORTRIM],gdt);ddt("comparator trim",t,pdt[mdt.COMPARATORTRIM]);t=t.replace(pdt[mdt.TILDETRIM],bdt);t=t.replace(pdt[mdt.CARETTRIM],vdt);t=t.split(/\s+/).join(" ");var o=r?pdt[mdt.COMPARATORLOOSE]:pdt[mdt.COMPARATOR];var s=t.split(" ").map((t=>xdt(t,this.options))).join(" ").split(/\s+/).map((t=>Mdt(t,this.options))).filter(this.options.loose?t=>!!t.match(o):()=>true).map((t=>new ldt(t,this.options)));var a=new Map;var f=idt(s),c;try{for(f.s();!(c=f.n()).done;){var l=c.value;if(ydt(l))return[l];a.set(l.value,l)}}catch(h){f.e(h)}finally{f.f()}if(a.size>1&&a.has(""))a.delete("");var d=[...a.values()];fdt.set(n,d);return d}intersects(t,e){if(!(t instanceof odt)){throw new TypeError("a Range is required")}return this.set.some((n=>Adt(n,e)&&t.set.some((t=>Adt(t,e)&&n.every((n=>t.every((t=>n.intersects(t,e)))))))))}test(t){if(!t){return false}if(typeof t==="string"){try{t=new hdt(t,this.options)}catch(xht){return false}}for(var e=0;e<this.set.length;e++){if(Sdt(this.set[e],t,this.options)){return true}}return false}}var sdt=odt;var adt=Vct;var fdt=new adt({max:1e3});var cdt=Jct;var ldt=Xlt;var ddt=rlt;var hdt=blt;var pdt=Qct.exports.re,mdt=Qct.exports.t,gdt=Qct.exports.comparatorTrimReplace,bdt=Qct.exports.tildeTrimReplace,vdt=Qct.exports.caretTrimReplace;var ydt=t=>t.value==="<0.0.0-0";var wdt=t=>t.value==="";var Adt=(t,e)=>{var n=true;var i=t.slice();var r=i.pop();while(n&&i.length){n=i.every((t=>r.intersects(t,e)));r=i.pop()}return n};var xdt=(t,e)=>{ddt("comp",t,e);t=kdt(t,e);ddt("caret",t);t=Fdt(t,e);ddt("tildes",t);t=$dt(t,e);ddt("xrange",t);t=Cdt(t,e);ddt("stars",t);return t};var Odt=t=>!t||t.toLowerCase()==="x"||t==="*";var Fdt=(t,e)=>t.trim().split(/\s+/).map((t=>Ddt(t,e))).join(" ");var Ddt=(t,e)=>{var n=e.loose?pdt[mdt.TILDELOOSE]:pdt[mdt.TILDE];return t.replace(n,((e,n,i,r,u)=>{ddt("tilde",t,e,n,i,r,u);var o;if(Odt(n)){o=""}else if(Odt(i)){o=">=".concat(n,".0.0 <").concat(+n+1,".0.0-0")}else if(Odt(r)){o=">=".concat(n,".").concat(i,".0 <").concat(n,".").concat(+i+1,".0-0")}else if(u){ddt("replaceTilde pr",u);o=">=".concat(n,".").concat(i,".").concat(r,"-").concat(u," <").concat(n,".").concat(+i+1,".0-0")}else{o=">=".concat(n,".").concat(i,".").concat(r," <").concat(n,".").concat(+i+1,".0-0")}ddt("tilde return",o);return o}))};var kdt=(t,e)=>t.trim().split(/\s+/).map((t=>Edt(t,e))).join(" ");var Edt=(t,e)=>{ddt("caret",t,e);var n=e.loose?pdt[mdt.CARETLOOSE]:pdt[mdt.CARET];var i=e.includePrerelease?"-0":"";return t.replace(n,((e,n,r,u,o)=>{ddt("caret",t,e,n,r,u,o);var s;if(Odt(n)){s=""}else if(Odt(r)){s=">=".concat(n,".0.0").concat(i," <").concat(+n+1,".0.0-0")}else if(Odt(u)){if(n==="0"){s=">=".concat(n,".").concat(r,".0").concat(i," <").concat(n,".").concat(+r+1,".0-0")}else{s=">=".concat(n,".").concat(r,".0").concat(i," <").concat(+n+1,".0.0-0")}}else if(o){ddt("replaceCaret pr",o);if(n==="0"){if(r==="0"){s=">=".concat(n,".").concat(r,".").concat(u,"-").concat(o," <").concat(n,".").concat(r,".").concat(+u+1,"-0")}else{s=">=".concat(n,".").concat(r,".").concat(u,"-").concat(o," <").concat(n,".").concat(+r+1,".0-0")}}else{s=">=".concat(n,".").concat(r,".").concat(u,"-").concat(o," <").concat(+n+1,".0.0-0")}}else{ddt("no pr");if(n==="0"){if(r==="0"){s=">=".concat(n,".").concat(r,".").concat(u).concat(i," <").concat(n,".").concat(r,".").concat(+u+1,"-0")}else{s=">=".concat(n,".").concat(r,".").concat(u).concat(i," <").concat(n,".").concat(+r+1,".0-0")}}else{s=">=".concat(n,".").concat(r,".").concat(u," <").concat(+n+1,".0.0-0")}}ddt("caret return",s);return s}))};var $dt=(t,e)=>{ddt("replaceXRanges",t,e);return t.split(/\s+/).map((t=>jdt(t,e))).join(" ")};var jdt=(t,e)=>{t=t.trim();var n=e.loose?pdt[mdt.XRANGELOOSE]:pdt[mdt.XRANGE];return t.replace(n,((n,i,r,u,o,s)=>{ddt("xRange",t,n,i,r,u,o,s);var a=Odt(r);var f=a||Odt(u);var c=f||Odt(o);var l=c;if(i==="="&&l){i=""}s=e.includePrerelease?"-0":"";if(a){if(i===">"||i==="<"){n="<0.0.0-0"}else{n="*"}}else if(i&&l){if(f){u=0}o=0;if(i===">"){i=">=";if(f){r=+r+1;u=0;o=0}else{u=+u+1;o=0}}else if(i==="<="){i="<";if(f){r=+r+1}else{u=+u+1}}if(i==="<")s="-0";n="".concat(i+r,".").concat(u,".").concat(o).concat(s)}else if(f){n=">=".concat(r,".0.0").concat(s," <").concat(+r+1,".0.0-0")}else if(c){n=">=".concat(r,".").concat(u,".0").concat(s," <").concat(r,".").concat(+u+1,".0-0")}ddt("xRange return",n);return n}))};var Cdt=(t,e)=>{ddt("replaceStars",t,e);return t.trim().replace(pdt[mdt.STAR],"")};var Mdt=(t,e)=>{ddt("replaceGTE0",t,e);return t.trim().replace(pdt[e.includePrerelease?mdt.GTE0PRE:mdt.GTE0],"")};var Bdt=t=>(e,n,i,r,u,o,s,a,f,c,l,d,h)=>{if(Odt(i)){n=""}else if(Odt(r)){n=">=".concat(i,".0.0").concat(t?"-0":"")}else if(Odt(u)){n=">=".concat(i,".").concat(r,".0").concat(t?"-0":"")}else if(o){n=">=".concat(n)}else{n=">=".concat(n).concat(t?"-0":"")}if(Odt(f)){a=""}else if(Odt(c)){a="<".concat(+f+1,".0.0-0")}else if(Odt(l)){a="<".concat(f,".").concat(+c+1,".0-0")}else if(d){a="<=".concat(f,".").concat(c,".").concat(l,"-").concat(d)}else if(t){a="<".concat(f,".").concat(c,".").concat(+l+1,"-0")}else{a="<=".concat(a)}return"".concat(n," ").concat(a).trim()};var Sdt=(t,e,n)=>{for(var i=0;i<t.length;i++){if(!t[i].test(e)){return false}}if(e.prerelease.length&&!n.includePrerelease){for(var r=0;r<t.length;r++){ddt(t[r].semver);if(t[r].semver===ldt.ANY){continue}if(t[r].semver.prerelease.length>0){var u=t[r].semver;if(u.major===e.major&&u.minor===e.minor&&u.patch===e.patch){return true}}}return false}return true};var _dt=sdt;var Ndt=(t,e,n)=>{try{e=new _dt(e,n)}catch(xht){return false}return e.test(t)};var zdt=Ndt;function Tdt(t,e,n){var i=t.open(e);var r=1e4;var u=250;var o=new URL(e),s=o.origin;var a=~~(r/u);function f(e){if(e.source===i){a=0;t.removeEventListener("message",f,false)}}t.addEventListener("message",f,false);function c(){if(a<=0){return}i.postMessage(n,s);setTimeout(c,u);a-=1}setTimeout(c,u)}var Pdt='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n}\n.vega-embed.has-actions {\n  padding-right: 38px;\n}\n.vega-embed details:not([open]) > :not(summary) {\n  display: none !important;\n}\n.vega-embed summary {\n  list-style: none;\n  position: absolute;\n  top: 0;\n  right: 0;\n  padding: 6px;\n  z-index: 1000;\n  background: white;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n  color: #1b1e23;\n  border: 1px solid #aaa;\n  border-radius: 999px;\n  opacity: 0.2;\n  transition: opacity 0.4s ease-in;\n  cursor: pointer;\n  line-height: 0px;\n}\n.vega-embed summary::-webkit-details-marker {\n  display: none;\n}\n.vega-embed summary:active {\n  box-shadow: #aaa 0px 0px 0px 1px inset;\n}\n.vega-embed summary svg {\n  width: 14px;\n  height: 14px;\n}\n.vega-embed details[open] summary {\n  opacity: 0.7;\n}\n.vega-embed:hover summary, .vega-embed:focus-within summary {\n  opacity: 1 !important;\n  transition: opacity 0.2s ease;\n}\n.vega-embed .vega-actions {\n  position: absolute;\n  z-index: 1001;\n  top: 35px;\n  right: -9px;\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 8px;\n  padding-top: 8px;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n  border: 1px solid #d9d9d9;\n  background: white;\n  animation-duration: 0.15s;\n  animation-name: scale-in;\n  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n  text-align: left;\n}\n.vega-embed .vega-actions a {\n  padding: 8px 16px;\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: 600;\n  white-space: nowrap;\n  color: #434a56;\n  text-decoration: none;\n}\n.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {\n  background-color: #f7f7f9;\n  color: black;\n}\n.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n  content: "";\n  display: inline-block;\n  position: absolute;\n}\n.vega-embed .vega-actions::before {\n  left: auto;\n  right: 14px;\n  top: -16px;\n  border: 8px solid #0000;\n  border-bottom-color: #d9d9d9;\n}\n.vega-embed .vega-actions::after {\n  left: auto;\n  right: 15px;\n  top: -14px;\n  border: 7px solid #0000;\n  border-bottom-color: #fff;\n}\n.vega-embed .chart-wrapper.fit-x {\n  width: 100%;\n}\n.vega-embed .chart-wrapper.fit-y {\n  height: 100%;\n}\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px;\n}\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n';if(!String.prototype.startsWith){String.prototype.startsWith=function(t,e){return this.substr(!e||e<0?0:+e,t.length)===t}}function Ldt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++){n[i-1]=arguments[i]}for(var r=0,u=n;r<u.length;r++){var o=u[r];Idt(t,o)}return t}function Idt(t,e){for(var n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];xe(t,r,e[r],true)}}var Rdt;function qdt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Udt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?qdt(Object(n),!0).forEach((function(e){Tft(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qdt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Wdt=MQ;var Gdt=pat;var Hdt=typeof window!=="undefined"?window:undefined;if(Gdt===undefined&&Hdt!==null&&Hdt!==void 0&&(Rdt=Hdt.vl)!==null&&Rdt!==void 0&&Rdt.compile){Gdt=Hdt.vl}var Vdt={export:{svg:true,png:true},source:true,compiled:true,editor:true};var Ydt={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"};var Xdt={vega:"Vega","vega-lite":"Vega-Lite"};var Jdt={vega:Wdt.version,"vega-lite":Gdt?Gdt.version:"not available"};var Qdt={vega:t=>t,"vega-lite":(t,e)=>Gdt.compile(t,{config:e}).spec};var Zdt='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>';var Kdt="chart-wrapper";function tht(t){return typeof t==="function"}function eht(t,e,n,i){var r="<html><head>".concat(e,'</head><body><pre><code class="json">');var u="</code></pre>".concat(n,"</body></html>");var o=window.open("");o.document.write(r+t+u);o.document.title="".concat(Xdt[i]," JSON Source")}function nht(t,e){if(t.$schema){var n=mat(t.$schema);if(e&&e!==n.library){var i;console.warn("The given visualization spec is written in ".concat(Xdt[n.library],", but mode argument sets ").concat((i=Xdt[e])!==null&&i!==void 0?i:e,"."))}var r=n.library;if(!zdt(Jdt[r],"^".concat(n.version.slice(1)))){console.warn("The input spec uses ".concat(Xdt[r]," ").concat(n.version,", but the current version of ").concat(Xdt[r]," is v").concat(Jdt[r],"."))}return r}if("mark"in t||"encoding"in t||"layer"in t||"hconcat"in t||"vconcat"in t||"facet"in t||"repeat"in t){return"vega-lite"}if("marks"in t||"signals"in t||"scales"in t||"axes"in t){return"vega"}return e!==null&&e!==void 0?e:"vega"}function iht(t){return!!(t&&"load"in t)}function rht(t){return iht(t)?t:Wdt.loader(t)}function uht(t){var e,n;var i=(e=(n=t.usermeta)===null||n===void 0?void 0:n.embedOptions)!==null&&e!==void 0?e:{};if(gn(i.defaultStyle)){i.defaultStyle=false}return i}function oht(t,e){return sht.apply(this,arguments)}function sht(){sht=Lft(Act.mark((function t(e,n){var i,r;var u,o,s,a,f,c,l,d,h,p=arguments;return Act.wrap((function t(m){while(1){switch(m.prev=m.next){case 0:u=p.length>2&&p[2]!==undefined?p[2]:{};if(!gn(n)){m.next=10;break}s=rht(u.loader);m.t0=JSON;m.next=6;return s.load(n);case 6:m.t1=m.sent;o=m.t0.parse.call(m.t0,m.t1);m.next=11;break;case 10:o=n;case 11:a=uht(o);f=a.loader;if(!s||f){s=rht((c=u.loader)!==null&&c!==void 0?c:f)}m.next=16;return aht(a,s);case 16:l=m.sent;m.next=19;return aht(u,s);case 19:d=m.sent;h=Udt(Udt({},Ldt(d,l)),{},{config:Ae((i=d.config)!==null&&i!==void 0?i:{},(r=l.config)!==null&&r!==void 0?r:{})});m.next=23;return lht(e,o,h,s);case 23:return m.abrupt("return",m.sent);case 24:case"end":return m.stop()}}}),t)})));return sht.apply(this,arguments)}function aht(t,e){return fht.apply(this,arguments)}function fht(){fht=Lft(Act.mark((function t(e,n){var i;var r,u;return Act.wrap((function t(o){while(1){switch(o.prev=o.next){case 0:if(!gn(e.config)){o.next=8;break}o.t1=JSON;o.next=4;return n.load(e.config);case 4:o.t2=o.sent;o.t0=o.t1.parse.call(o.t1,o.t2);o.next=9;break;case 8:o.t0=(i=e.config)!==null&&i!==void 0?i:{};case 9:r=o.t0;if(!gn(e.patch)){o.next=18;break}o.t4=JSON;o.next=14;return n.load(e.patch);case 14:o.t5=o.sent;o.t3=o.t4.parse.call(o.t4,o.t5);o.next=19;break;case 18:o.t3=e.patch;case 19:u=o.t3;return o.abrupt("return",Udt(Udt(Udt({},e),u?{patch:u}:{}),r?{config:r}:{}));case 21:case"end":return o.stop()}}}),t)})));return fht.apply(this,arguments)}function cht(t){var e;var n=t.getRootNode?t.getRootNode():document;return n instanceof ShadowRoot?{root:n,rootContainer:n}:{root:document,rootContainer:(e=document.head)!==null&&e!==void 0?e:document.body}}function lht(t,e){return dht.apply(this,arguments)}function dht(){dht=Lft(Act.mark((function t(e,n){var i,r,u,o,s,a,f;var c,l,d,h,p,m,g,b,v,y,w,A,x,O,F,D,k,E,$,j,C,M,B,S,_,N,z,T,P,L,I,R,q,U,W,G,H,V,Y,X,J,Q,Z=arguments;return Act.wrap((function t(K){while(1){switch(K.prev=K.next){case 0:Q=function t(){if(P){document.removeEventListener("click",P)}B.finalize()};c=Z.length>2&&Z[2]!==undefined?Z[2]:{};l=Z.length>3?Z[3]:undefined;d=c.theme?Ae(Dft[c.theme],(i=c.config)!==null&&i!==void 0?i:{}):c.config;h=ln(c.actions)?c.actions:Ldt({},Vdt,(r=c.actions)!==null&&r!==void 0?r:{});p=Udt(Udt({},Ydt),c.i18n);m=(u=c.renderer)!==null&&u!==void 0?u:"canvas";g=(o=c.logLevel)!==null&&o!==void 0?o:Wdt.Warn;b=(s=c.downloadFileName)!==null&&s!==void 0?s:"visualization";v=typeof e==="string"?document.querySelector(e):e;if(v){K.next=12;break}throw new Error("".concat(e," does not exist"));case 12:if(c.defaultStyle!==false){y="vega-embed-style";w=cht(v),A=w.root,x=w.rootContainer;if(!A.getElementById(y)){O=document.createElement("style");O.id=y;O.innerHTML=c.defaultStyle===undefined||c.defaultStyle===true?Pdt.toString():c.defaultStyle;x.appendChild(O)}}F=nht(n,c.mode);D=Qdt[F](n,d);if(F==="vega-lite"){if(D.$schema){k=mat(D.$schema);if(!zdt(Jdt.vega,"^".concat(k.version.slice(1)))){console.warn("The compiled spec uses Vega ".concat(k.version,", but current version is v").concat(Jdt.vega,"."))}}}v.classList.add("vega-embed");if(h){v.classList.add("has-actions")}v.innerHTML="";E=v;if(h){$=document.createElement("div");$.classList.add(Kdt);v.appendChild($);E=$}j=c.patch;if(j){D=j instanceof Function?j(D):Ct(D,j,true,false).newDocument}if(c.formatLocale){Wdt.formatLocale(c.formatLocale)}if(c.timeFormatLocale){Wdt.timeFormatLocale(c.timeFormatLocale)}C=c.ast;M=Wdt.parse(D,F==="vega-lite"?{}:d,{ast:C});B=new(c.viewClass||Wdt.View)(M,Udt({loader:l,logLevel:g,renderer:m},C?{expr:(a=(f=Wdt.expressionInterpreter)!==null&&f!==void 0?f:c.expr)!==null&&a!==void 0?a:UQ}:{}));B.addSignalListener("autosize",((t,e)=>{var n=e.type;if(n=="fit-x"){E.classList.add("fit-x");E.classList.remove("fit-y")}else if(n=="fit-y"){E.classList.remove("fit-x");E.classList.add("fit-y")}else if(n=="fit"){E.classList.add("fit-x","fit-y")}else{E.classList.remove("fit-x","fit-y")}}));if(c.tooltip!==false){S=tht(c.tooltip)?c.tooltip:new zft(c.tooltip===true?{}:c.tooltip).call;B.tooltip(S)}_=c.hover;if(_===undefined){_=F==="vega"}if(_){N=typeof _==="boolean"?{}:_,z=N.hoverSet,T=N.updateSet;B.hover(z,T)}if(c){if(c.width!=null){B.width(c.width)}if(c.height!=null){B.height(c.height)}if(c.padding!=null){B.padding(c.padding)}}K.next=36;return B.initialize(E,c.bind).runAsync();case 36:if(h!==false){L=v;if(c.defaultStyle!==false){I=document.createElement("details");I.title=p.CLICK_TO_VIEW_ACTIONS;v.append(I);L=I;R=document.createElement("summary");R.innerHTML=Zdt;I.append(R);P=t=>{if(!I.contains(t.target)){I.removeAttribute("open")}};document.addEventListener("click",P)}q=document.createElement("div");L.append(q);q.classList.add("vega-actions");if(h===true||h.export!==false){U=function t(){var e=G[W];if(h===true||h.export===true||h.export[e]){var n=p["".concat(e.toUpperCase(),"_ACTION")];var i=document.createElement("a");i.text=n;i.href="#";i.target="_blank";i.download="".concat(b,".").concat(e);i.addEventListener("mousedown",function(){var t=Lft(Act.mark((function t(n){var i;return Act.wrap((function t(r){while(1){switch(r.prev=r.next){case 0:n.preventDefault();r.next=3;return B.toImageURL(e,c.scaleFactor);case 3:i=r.sent;this.href=i;case 5:case"end":return r.stop()}}}),t,this)})));return function(e){return t.apply(this,arguments)}}());q.append(i)}};for(W=0,G=["svg","png"];W<G.length;W++){U()}}if(h===true||h.source!==false){H=document.createElement("a");H.text=p.SOURCE_ACTION;H.href="#";H.addEventListener("click",(function(t){var e,i;eht(Xt(n),(e=c.sourceHeader)!==null&&e!==void 0?e:"",(i=c.sourceFooter)!==null&&i!==void 0?i:"",F);t.preventDefault()}));q.append(H)}if(F==="vega-lite"&&(h===true||h.compiled!==false)){V=document.createElement("a");V.text=p.COMPILED_ACTION;V.href="#";V.addEventListener("click",(function(t){var e,n;eht(Xt(D),(e=c.sourceHeader)!==null&&e!==void 0?e:"",(n=c.sourceFooter)!==null&&n!==void 0?n:"","vega");t.preventDefault()}));q.append(V)}if(h===true||h.editor!==false){X=(Y=c.editorUrl)!==null&&Y!==void 0?Y:"https://vega.github.io/editor/";J=document.createElement("a");J.text=p.EDITOR_ACTION;J.href="#";J.addEventListener("click",(function(t){Tdt(window,X,{config:d,mode:F,renderer:m,spec:Xt(n)});t.preventDefault()}));q.append(J)}}return K.abrupt("return",{view:B,spec:n,vgSpec:D,finalize:Q,embedOptions:c});case 38:case"end":return K.stop()}}}),t)})));return dht.apply(this,arguments)}const hht="application/vnd.vega+json";const pht=/(vega|vega-?lite)[/.]v([0-9]+(?:\.[0-9]){0,2})/;const mht=t=>t==="vega"||t==="vega-lite"?t:"vega";const ght=(t="")=>{var e;const[,n="vega",i="latest"]=(e=pht.exec(t))!==null&&e!==void 0?e:[];const r=n.replace("vegalite","vega-lite");const u=mht(r);return{library:u,version:i}};const bht=({library:t,version:e})=>`https://unpkg.com/${t}@${e}`;const vht=".sc-stencila-image-vega-default-h{display:block}.sc-stencila-image-vega-default-h.imgHidden.sc-stencila-image-vega-default-s>picture>:not(.vega-embed){display:none}";const yht=".sc-stencila-image-vega-material-h{display:block}.sc-stencila-image-vega-material-h.imgHidden.sc-stencila-image-vega-material-s>picture>:not(.vega-embed){display:none}";const wht={vega:undefined,"vega-lite":undefined};const Aht=class{constructor(n){t(this,n);this.vegaLoad=e(this,"stencila-vega-load",7);this.detectVegaDependency=t=>{const e=ght(typeof t==="object"?t.$schema:t);this.vegaDependency=e;return e};this.options={};this.plotIsRendered=false;this.getPlotContent=()=>{if(this.spec!==undefined&&this.spec!==""){return this.spec}const t=this.el.querySelector(`[type^="${hht}"]`);if(t){try{const e=t.textContent;const n=JSON.parse(e!==null&&e!==void 0?e:"");return n}catch(e){console.error("Could not parse plot data")}}return undefined};this.renderPlot=()=>{var t;const e=this.getPlotContent();this.plotContainer=(t=this.plotContainer)!==null&&t!==void 0?t:lt(this.el);if(e!==undefined){return oht(this.plotContainer,e,Object.assign({actions:{compiled:false,editor:false}},this.options)).then((t=>{this.plotIsRendered=true;return t}))}return Promise.resolve()}}onVegaLoad(t){if(!this.plotIsRendered&&t.detail.library===this.vegaDependency.library){this.renderPlot().catch((t=>{console.log(t)}))}}componentWillLoad(){this.detectVegaDependency(this.getPlotContent());if(!this.plotIsRendered&&wht[this.vegaDependency.library]){return this.renderPlot()}else{dt({src:bht(this.vegaDependency),onLoad:()=>{wht[this.vegaDependency.library]=true;this.vegaLoad.emit({library:this.vegaDependency.library})}})}}componentShouldUpdate(t,e,n){if(n==="plotIsRendered"&&e===t){return false}return true}componentWillUpdate(){this.renderPlot().catch((t=>{console.log(t)}))}render(){return n(r,{class:{imgHidden:this.plotIsRendered}})}get el(){return i(this)}};Aht.style={default:vht,material:yht};export{Aht as stencila_image_vega};
//# sourceMappingURL=p-ac2db98f.entry.js.map